<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: クラス テンプレート nsExpirationTracker&lt; T, K &gt;</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li><a href="../../classes.html"><span>データ構造索引</span></a></li>
      <li><a href="../../inherits.html"><span>クラス階層</span></a></li>
      <li><a href="../../functions.html"><span>データフィールド</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d5/da0/classns_expiration_tracker.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">データ構造</a> &#124;
<a href="#pub-methods">Public メソッド</a> &#124;
<a href="#pro-methods">Protected メソッド</a> &#124;
<a href="#friends">フレンド</a>  </div>
  <div class="headertitle">
<div class="title">クラス テンプレート nsExpirationTracker&lt; T, K &gt;</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="nsExpirationTracker" -->
<p><code>#include &lt;<a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a>&gt;</code></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
データ構造</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d6b/classns_expiration_tracker_1_1_iterator.html">Iterator</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><b>MOZ_FINAL</b></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#aadf15e5925f49b0bc433c6926e5c5016">nsExpirationTracker</a> (uint32_t aTimerPeriod)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#a047ae4887878dcba8300b2fa3628a984">~nsExpirationTracker</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#a68beda4ca87ecf2f90ebe20bdc7a178c">AddObject</a> (T *aObj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dc/d2c/prtpool_8h.html#a7797d332996f57719d6d316bee73873d">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#a191b919e011b8a6a0c186b0f3ae7ebf3">RemoveObject</a> (T *aObj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#aac2a6f7dadfec6cf7a5a33c00187aa54">MarkUsed</a> (T *aObj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dc/d2c/prtpool_8h.html#a7797d332996f57719d6d316bee73873d">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#aae9028672a589b8ddb85610ef6c029bc">AgeOneGeneration</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dc/d2c/prtpool_8h.html#a7797d332996f57719d6d316bee73873d">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#a80ebe909d8058fb9ba8681f0e8066f6b">AgeAllGenerations</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d7/dd2/qcmstypes_8h.html#acac1f8caeb95c0bd16fe8c0743249831">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#a4a13a5d94e837cd88e884c7f4ec1f8ad">IsEmpty</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected メソッド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../dc/d2c/prtpool_8h.html#a7797d332996f57719d6d316bee73873d">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#a97348aec6eb77e8454b78f71c6945de8">NotifyExpired</a> (T *aObj)=0</td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
フレンド</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da0/classns_expiration_tracker.html#a9830fc407400559db7e7783cc10a9394">Iterator</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>説明</h2>
<div class="textblock"><h3>template&lt;class T, uint32_t K&gt;<br/>
class nsExpirationTracker&lt; T, K &gt;</h3>

<p><a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a> can track the lifetimes and usage of a large number of objects, and send a notification some window of time after a live object was last used. This is very useful when you manage a large number of objects and want to flush some after they haven't been used for a while. <a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a> is designed to be very space and time efficient.</p>
<p>The type parameter T is the object type that we will track pointers to. T must include an accessible method GetExpirationState() that returns a pointer to an <a class="el" href="../../d9/d67/structns_expiration_state.html">nsExpirationState</a> associated with the object (preferably, stored in a field of the object).</p>
<p>The parameter K is the number of generations that will be used. Increasing the number of generations narrows the window within which we promise to fire notifications, at a slight increase in space cost for the tracker. We require 2 &lt;= K &lt;= <a class="el" href="../../d9/d67/structns_expiration_state.html#ad99681e2bd9fc6d7cbae6594ad727b6aa8cdb115975968c9d8f52b4c2753ff9a5">nsExpirationState::NOT_TRACKED</a> (currently 15).</p>
<p>To use this class, you need to inherit from it and override the <a class="el" href="../../d5/da0/classns_expiration_tracker.html#a97348aec6eb77e8454b78f71c6945de8">NotifyExpired()</a> method.</p>
<p>The approach is to track objects in K generations. When an object is accessed it moves from its current generation to the newest generation. Generations are stored in a cyclic array; when a timer interrupt fires, we advance the current generation pointer to effectively age all objects very efficiently. By storing information in each object about its generation and index within its generation array, we make removal of objects from a generation very cheap.</p>
<p>Future work: -- Add a method to change the timer period? </p>

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00071">71</a> 行で定義されています。</p>
</div><hr/><h2>コンストラクタとデストラクタ</h2>
<a class="anchor" id="aadf15e5925f49b0bc433c6926e5c5016"></a><!-- doxytag: member="nsExpirationTracker::nsExpirationTracker" ref="aadf15e5925f49b0bc433c6926e5c5016" args="(uint32_t aTimerPeriod)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::<a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a> </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>aTimerPeriod</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize the tracker. </p>
<dl class="params"><dt><b>引数:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">aTimerPeriod</td><td>the timer period in milliseconds. The guarantees provided by the tracker are defined in terms of this period. If the period is zero, then we don't use a timer and rely on someone calling AgeOneGeneration explicitly. </td></tr>
  </table>
  </dd>
</dl>

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00080">80</a> 行で定義されています。</p>
<div class="fragment"><pre class="fragment">      : mTimerPeriod(aTimerPeriod), mNewestGeneration(0),
        mInAgeOneGeneration(<span class="keyword">false</span>) {
      <a class="code" href="../../d3/d68/_value_8h.html#a3b52e66790b3e7fa53b9794163d633e5">static_assert</a>(K &gt;= 2 &amp;&amp; K &lt;= <a class="code" href="../../d9/d67/structns_expiration_state.html#ad99681e2bd9fc6d7cbae6594ad727b6aa8cdb115975968c9d8f52b4c2753ff9a5">nsExpirationState::NOT_TRACKED</a>,
                    <span class="stringliteral">&quot;Unsupported number of generations (must be 2 &lt;= K &lt;= 15)&quot;</span>);
      mObserver = <span class="keyword">new</span> ExpirationTrackerObserver();
      mObserver-&gt;Init(<span class="keyword">this</span>);
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a047ae4887878dcba8300b2fa3628a984"></a><!-- doxytag: member="nsExpirationTracker::~nsExpirationTracker" ref="a047ae4887878dcba8300b2fa3628a984" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::~<a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00088">88</a> 行で定義されています。</p>
<div class="fragment"><pre class="fragment">                           {
      <span class="keywordflow">if</span> (mTimer) {
        mTimer-&gt;Cancel();
      }
      mObserver-&gt;Destroy();
    }
</pre></div>
</div>
</div>
<hr/><h2>メソッド</h2>
<a class="anchor" id="a68beda4ca87ecf2f90ebe20bdc7a178c"></a><!-- doxytag: member="nsExpirationTracker::AddObject" ref="a68beda4ca87ecf2f90ebe20bdc7a178c" args="(T *aObj)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::<a class="el" href="../../d5/da0/classns_expiration_tracker.html#a68beda4ca87ecf2f90ebe20bdc7a178c">AddObject</a> </td>
          <td>(</td>
          <td class="paramtype">T *&#160;</td>
          <td class="paramname"><em>aObj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Add an object to be tracked. It must not already be tracked. It will be added to the newest generation, i.e., as if it was just used. </p>
<dl class="return"><dt><b>戻り値:</b></dt><dd>an error on out-of-memory </dd></dl>

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00100">100</a> 行で定義されています。</p>

<p>参照元 <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00150">nsExpirationTracker&lt; gfxFont, 3 &gt;::MarkUsed()</a>.</p>
<div class="fragment"><pre class="fragment">                                {
      <a class="code" href="../../d9/d67/structns_expiration_state.html">nsExpirationState</a>* <a class="code" href="../../d2/d7d/jsapi_8h.html#afa45f986123242ddd418c959eb87e242">state</a> = aObj-&gt;GetExpirationState();
      <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!state-&gt;<a class="code" href="../../d9/d67/structns_expiration_state.html#a57b58343d270c5c4e39e28637f4fbe1f">IsTracked</a>(), <span class="stringliteral">&quot;Tried to add an object that&#39;s already tracked&quot;</span>);
      <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;T*&gt;</a>&amp; generation = mGenerations[mNewestGeneration];
      uint32_t <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> = generation.Length();
      <span class="keywordflow">if</span> (index &gt; <a class="code" href="../../d9/d67/structns_expiration_state.html#ad99681e2bd9fc6d7cbae6594ad727b6aaf64f8b22b3cbb09337c54b9a2ce1bea6">nsExpirationState::MAX_INDEX_IN_GENERATION</a>) {
        <a class="code" href="../../dc/d6d/ns_debug_8h.html#aa7f3deb23fbcb284ef465fd28ccaaa35">NS_WARNING</a>(<span class="stringliteral">&quot;More than 256M elements tracked, this is probably a problem&quot;</span>);
        <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a92ab988083ecf3206773169bf6b11d06">NS_ERROR_OUT_OF_MEMORY</a>;
      }
      <span class="keywordflow">if</span> (index == 0) {
        <span class="comment">// We might need to start the timer</span>
        <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = CheckStartTimer();
        <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
          <span class="keywordflow">return</span> rv;
      }
      <span class="keywordflow">if</span> (!generation.AppendElement(aObj))
        <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a92ab988083ecf3206773169bf6b11d06">NS_ERROR_OUT_OF_MEMORY</a>;
      state-&gt;<a class="code" href="../../d9/d67/structns_expiration_state.html#afd699cf63809a59c28773ee90d43de00">mGeneration</a> = mNewestGeneration;
      state-&gt;<a class="code" href="../../d9/d67/structns_expiration_state.html#ac6e3e36575aaf82cce6fef229f34e6de">mIndexInGeneration</a> = <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>;
      <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
    }
</pre></div>
<p><div class="dynheader">
呼出しグラフ:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d5/da0/classns_expiration_tracker_a68beda4ca87ecf2f90ebe20bdc7a178c_icgraph.svg" width="558" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a80ebe909d8058fb9ba8681f0e8066f6b"></a><!-- doxytag: member="nsExpirationTracker::AgeAllGenerations" ref="a80ebe909d8058fb9ba8681f0e8066f6b" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dc/d2c/prtpool_8h.html#a7797d332996f57719d6d316bee73873d">void</a> <a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::<a class="el" href="../../d5/da0/classns_expiration_tracker.html#a80ebe909d8058fb9ba8681f0e8066f6b">AgeAllGenerations</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This just calls AgeOneGeneration K times. Under normal circumstances this will result in all objects getting NotifyExpired called on them, but if NotifyExpired itself marks some objects as used, then those objects might not expire. This would be a good thing to call if we get into a critically-low memory situation. </p>

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00209">209</a> 行で定義されています。</p>
<div class="fragment"><pre class="fragment">                             {
      uint32_t <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>;
      <span class="keywordflow">for</span> (i = 0; i &lt; K; ++<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>) {
        <a class="code" href="../../d5/da0/classns_expiration_tracker.html#aae9028672a589b8ddb85610ef6c029bc">AgeOneGeneration</a>();
      }
    }
</pre></div>
</div>
</div>
<a class="anchor" id="aae9028672a589b8ddb85610ef6c029bc"></a><!-- doxytag: member="nsExpirationTracker::AgeOneGeneration" ref="aae9028672a589b8ddb85610ef6c029bc" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dc/d2c/prtpool_8h.html#a7797d332996f57719d6d316bee73873d">void</a> <a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::<a class="el" href="../../d5/da0/classns_expiration_tracker.html#aae9028672a589b8ddb85610ef6c029bc">AgeOneGeneration</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The timer calls this, but it can also be manually called if you want to age objects "artifically". This can result in calls to NotifyExpired. </p>

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00162">162</a> 行で定義されています。</p>

<p>参照元 <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00209">nsExpirationTracker&lt; gfxFont, 3 &gt;::AgeAllGenerations()</a>.</p>
<div class="fragment"><pre class="fragment">                            {
      <span class="keywordflow">if</span> (mInAgeOneGeneration) {
        <a class="code" href="../../dc/d6d/ns_debug_8h.html#aa7f3deb23fbcb284ef465fd28ccaaa35">NS_WARNING</a>(<span class="stringliteral">&quot;Can&#39;t reenter AgeOneGeneration from NotifyExpired&quot;</span>);
        <span class="keywordflow">return</span>;
      }
      
      mInAgeOneGeneration = <span class="keyword">true</span>;
      uint32_t reapGeneration = 
        mNewestGeneration &gt; 0 ? mNewestGeneration - 1 : K - 1;
      <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;T*&gt;</a>&amp; generation = mGenerations[reapGeneration];
      <span class="comment">// The following is rather tricky. We have to cope with objects being</span>
      <span class="comment">// removed from this generation either because of a call to RemoveObject</span>
      <span class="comment">// (or indirectly via MarkUsed) inside NotifyExpired. Fortunately no</span>
      <span class="comment">// objects can be added to this generation because it&#39;s not the newest</span>
      <span class="comment">// generation. We depend on the fact that RemoveObject can only cause</span>
      <span class="comment">// the indexes of objects in this generation to *decrease*, not increase.</span>
      <span class="comment">// So if we start from the end and work our way backwards we are guaranteed</span>
      <span class="comment">// to see each object at least once.</span>
      uint32_t <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> = generation.<a class="code" href="../../db/d9f/classns_t_array__base.html#a9ff8fa91fb766d44982e50ac82558141">Length</a>();
      <span class="keywordflow">for</span> (;;) {
        <span class="comment">// Objects could have been removed so index could be outside</span>
        <span class="comment">// the array</span>
        index = <a class="code" href="../../d6/dbf/ns_algorithm_8h.html#aa8c38b22f99b4a73606f7d4f0d093646">XPCOM_MIN</a>(index, generation.<a class="code" href="../../db/d9f/classns_t_array__base.html#a9ff8fa91fb766d44982e50ac82558141">Length</a>());
        <span class="keywordflow">if</span> (index == 0)
          <span class="keywordflow">break</span>;
        --<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>;
        <a class="code" href="../../d5/da0/classns_expiration_tracker.html#a97348aec6eb77e8454b78f71c6945de8">NotifyExpired</a>(generation[index]);
      }
      <span class="comment">// Any leftover objects from reapGeneration just end up in the new</span>
      <span class="comment">// newest-generation. This is bad form, though, so warn if there are any.</span>
      <span class="keywordflow">if</span> (!generation.<a class="code" href="../../db/d9f/classns_t_array__base.html#ae1f48111b444c3c0a8bc113f2a38f2cf">IsEmpty</a>()) {
        <a class="code" href="../../dc/d6d/ns_debug_8h.html#aa7f3deb23fbcb284ef465fd28ccaaa35">NS_WARNING</a>(<span class="stringliteral">&quot;Expired objects were not removed or marked used&quot;</span>);
      }
      <span class="comment">// Free excess memory used by the generation array, since we probably</span>
      <span class="comment">// just removed most or all of its elements.</span>
      generation.<a class="code" href="../../d4/dd8/classns_t_array___impl.html#aa4bafea0f89ebe567a616e41416e3df8">Compact</a>();
      mNewestGeneration = reapGeneration;
      mInAgeOneGeneration = <span class="keyword">false</span>;
    }
</pre></div>
<p><div class="dynheader">
呼出しグラフ:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d5/da0/classns_expiration_tracker_aae9028672a589b8ddb85610ef6c029bc_icgraph.svg" width="654" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4a13a5d94e837cd88e884c7f4ec1f8ad"></a><!-- doxytag: member="nsExpirationTracker::IsEmpty" ref="a4a13a5d94e837cd88e884c7f4ec1f8ad" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d7/dd2/qcmstypes_8h.html#acac1f8caeb95c0bd16fe8c0743249831">bool</a> <a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::<a class="el" href="../../d5/da0/classns_expiration_tracker.html#a4a13a5d94e837cd88e884c7f4ec1f8ad">IsEmpty</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00240">240</a> 行で定義されています。</p>

<p>参照元 <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00240">nsExpirationTracker&lt; gfxFont, 3 &gt;::IsEmpty()</a>.</p>
<div class="fragment"><pre class="fragment">                   {
      <span class="keywordflow">for</span> (uint32_t <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = 0; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; K; ++<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>) {
        <span class="keywordflow">if</span> (!mGenerations[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].<a class="code" href="../../d5/da0/classns_expiration_tracker.html#a4a13a5d94e837cd88e884c7f4ec1f8ad">IsEmpty</a>())
          <span class="keywordflow">return</span> <span class="keyword">false</span>;
      }
      <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
</pre></div>
<p><div class="dynheader">
呼出しグラフ:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d5/da0/classns_expiration_tracker_a4a13a5d94e837cd88e884c7f4ec1f8ad_icgraph.svg" width="206" height="64"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="aac2a6f7dadfec6cf7a5a33c00187aa54"></a><!-- doxytag: member="nsExpirationTracker::MarkUsed" ref="aac2a6f7dadfec6cf7a5a33c00187aa54" args="(T *aObj)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::<a class="el" href="../../d5/da0/classns_expiration_tracker.html#aac2a6f7dadfec6cf7a5a33c00187aa54">MarkUsed</a> </td>
          <td>(</td>
          <td class="paramtype">T *&#160;</td>
          <td class="paramname"><em>aObj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Notify that an object has been used. </p>
<dl class="return"><dt><b>戻り値:</b></dt><dd>an error if we lost the object from the tracker... </dd></dl>

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00150">150</a> 行で定義されています。</p>
<div class="fragment"><pre class="fragment">                               {
      <a class="code" href="../../d9/d67/structns_expiration_state.html">nsExpirationState</a>* <a class="code" href="../../d2/d7d/jsapi_8h.html#afa45f986123242ddd418c959eb87e242">state</a> = aObj-&gt;GetExpirationState();
      <span class="keywordflow">if</span> (mNewestGeneration == state-&gt;<a class="code" href="../../d9/d67/structns_expiration_state.html#afd699cf63809a59c28773ee90d43de00">mGeneration</a>)
        <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
      <a class="code" href="../../d5/da0/classns_expiration_tracker.html#a191b919e011b8a6a0c186b0f3ae7ebf3">RemoveObject</a>(aObj);
      <span class="keywordflow">return</span> <a class="code" href="../../d5/da0/classns_expiration_tracker.html#a68beda4ca87ecf2f90ebe20bdc7a178c">AddObject</a>(aObj);
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a97348aec6eb77e8454b78f71c6945de8"></a><!-- doxytag: member="nsExpirationTracker::NotifyExpired" ref="a97348aec6eb77e8454b78f71c6945de8" args="(T *aObj)=0" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="../../dc/d2c/prtpool_8h.html#a7797d332996f57719d6d316bee73873d">void</a> <a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::<a class="el" href="../../d5/da0/classns_expiration_tracker.html#a97348aec6eb77e8454b78f71c6945de8">NotifyExpired</a> </td>
          <td>(</td>
          <td class="paramtype">T *&#160;</td>
          <td class="paramname"><em>aObj</em></td><td>)</td>
          <td><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This must be overridden to catch notifications. It is called whenever we detect that an object has not been used for at least (K-1)*mTimerPeriod milliseconds. If timer events are not delayed, it will be called within roughly K*mTimerPeriod milliseconds after the last use. (Unless AgeOneGeneration or AgeAllGenerations have been called to accelerate the aging process.)</p>
<p>NOTE: These bounds ignore delays in timer firings due to actual work being performed by the browser. We use a slack timer so there is always at least mTimerPeriod milliseconds between firings, which gives us (K-1)*mTimerPeriod as a pretty solid lower bound. The upper bound is rather loose, however. If the maximum amount by which any given timer firing is delayed is D, then the upper bound before NotifyExpired is called is K*(mTimerPeriod + D).</p>
<p>The NotifyExpired call is expected to remove the object from the tracker, but it need not. The object (or other objects) could be "resurrected" by calling <a class="el" href="../../d5/da0/classns_expiration_tracker.html#aac2a6f7dadfec6cf7a5a33c00187aa54">MarkUsed()</a> on them, or they might just not be removed. Any objects left over that have not been resurrected or removed are placed in the new newest-generation, but this is considered "bad form" and should be avoided (we'll issue a warning). (This recycling counts as "a use" for the purposes of the expiry guarantee above...)</p>
<p>For robustness and simplicity, we allow objects to be notified more than once here in the same timer tick. </p>

<p><a class="el" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#a24c035fb1a14d4393035ea4edc338ca1">MOZ_FINAL&lt; T &gt;</a>で実装されています。</p>

<p>参照元 <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00162">nsExpirationTracker&lt; gfxFont, 3 &gt;::AgeOneGeneration()</a>.</p>

<p><div class="dynheader">
呼出しグラフ:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d5/da0/classns_expiration_tracker_a97348aec6eb77e8454b78f71c6945de8_icgraph.svg" width="624" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a191b919e011b8a6a0c186b0f3ae7ebf3"></a><!-- doxytag: member="nsExpirationTracker::RemoveObject" ref="a191b919e011b8a6a0c186b0f3ae7ebf3" args="(T *aObj)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dc/d2c/prtpool_8h.html#a7797d332996f57719d6d316bee73873d">void</a> <a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt; T, K &gt;::<a class="el" href="../../d5/da0/classns_expiration_tracker.html#a191b919e011b8a6a0c186b0f3ae7ebf3">RemoveObject</a> </td>
          <td>(</td>
          <td class="paramtype">T *&#160;</td>
          <td class="paramname"><em>aObj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Remove an object from the tracker. It must currently be tracked. </p>

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00125">125</a> 行で定義されています。</p>

<p>参照元 <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00150">nsExpirationTracker&lt; gfxFont, 3 &gt;::MarkUsed()</a>.</p>
<div class="fragment"><pre class="fragment">                               {
      <a class="code" href="../../d9/d67/structns_expiration_state.html">nsExpirationState</a>* <a class="code" href="../../d2/d7d/jsapi_8h.html#afa45f986123242ddd418c959eb87e242">state</a> = aObj-&gt;GetExpirationState();
      <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(state-&gt;<a class="code" href="../../d9/d67/structns_expiration_state.html#a57b58343d270c5c4e39e28637f4fbe1f">IsTracked</a>(), <span class="stringliteral">&quot;Tried to remove an object that&#39;s not tracked&quot;</span>);
      <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;T*&gt;</a>&amp; generation = mGenerations[state-&gt;<a class="code" href="../../d9/d67/structns_expiration_state.html#afd699cf63809a59c28773ee90d43de00">mGeneration</a>];
      uint32_t <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> = state-&gt;<a class="code" href="../../d9/d67/structns_expiration_state.html#ac6e3e36575aaf82cce6fef229f34e6de">mIndexInGeneration</a>;
      <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(generation.Length() &gt; index &amp;&amp;
                   generation[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>] == aObj, <span class="stringliteral">&quot;Object is lying about its index&quot;</span>);
      <span class="comment">// Move the last object to fill the hole created by removing aObj</span>
      uint32_t last = generation.Length() - 1;
      T* lastObj = generation[last];
      generation[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>] = lastObj;
      lastObj-&gt;GetExpirationState()-&gt;mIndexInGeneration = <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>;
      generation.RemoveElementAt(last);
      state-&gt;<a class="code" href="../../d9/d67/structns_expiration_state.html#afd699cf63809a59c28773ee90d43de00">mGeneration</a> = <a class="code" href="../../d9/d67/structns_expiration_state.html#ad99681e2bd9fc6d7cbae6594ad727b6aa8cdb115975968c9d8f52b4c2753ff9a5">nsExpirationState::NOT_TRACKED</a>;
      <span class="comment">// We do not check whether we need to stop the timer here. The timer</span>
      <span class="comment">// will check that itself next time it fires. Checking here would not</span>
      <span class="comment">// be efficient since we&#39;d need to track all generations. Also we could</span>
      <span class="comment">// thrash by incessantly creating and destroying timers if someone</span>
      <span class="comment">// kept adding and removing an object from the tracker.</span>
    }
</pre></div>
<p><div class="dynheader">
呼出しグラフ:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d5/da0/classns_expiration_tracker_a191b919e011b8a6a0c186b0f3ae7ebf3_icgraph.svg" width="584" height="40"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<hr/><h2>フレンドと関連する関数</h2>
<a class="anchor" id="a9830fc407400559db7e7783cc10a9394"></a><!-- doxytag: member="nsExpirationTracker::Iterator" ref="a9830fc407400559db7e7783cc10a9394" args="" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T, uint32_t K&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="../../da/d6b/classns_expiration_tracker_1_1_iterator.html">Iterator</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p> <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a> の <a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html#l00238">238</a> 行で定義されています。</p>

</div>
</div>
<hr/>このクラスの説明は次のファイルから生成されました:<ul>
<li><a class="el" href="../../d4/dd5/ns_expiration_tracker_8h_source.html">nsExpirationTracker.h</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:59:32に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
