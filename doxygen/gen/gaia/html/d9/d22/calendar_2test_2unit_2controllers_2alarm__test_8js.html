<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: alarm_test.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d9/d22/calendar_2test_2unit_2controllers_2alarm__test_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a>  </div>
  <div class="headertitle">
<div class="title">alarm_test.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../d9/d22/calendar_2test_2unit_2controllers_2alarm__test_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d22/calendar_2test_2unit_2controllers_2alarm__test_8js.html#a2808e5f758eeed1e893968dda9db1745">requireApp</a> ('calendar/<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a88b8a0ec29ea19ab8a79e10dd9cf3c04">shared</a>/js/notification_helper.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d22/calendar_2test_2unit_2controllers_2alarm__test_8js.html#a5cade444b7bfa57b0994b39d3f44dab1">requireLib</a> ('notification.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d22/calendar_2test_2unit_2controllers_2alarm__test_8js.html#a5d8440377a49e6f79c9098fd35660434">suiteGroup</a> ('Controllers.Alarm', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> mockRequestWakeLock(<a class="el" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">handler</a>){var realApi;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> lockMock(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>{mAquired:false, mIsUnlocked:false, unlock:function(){this.mIsUnlocked=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;}};}suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){realApi=navigator.requestWakeLock;navigator.requestWakeLock=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>){var <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>=lockMock();<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">lock.type</a>=<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>;lock.mAquired=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;<a class="el" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">handler</a> &amp;&amp;<a class="el" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">handler</a>(<a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>);<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>;};});suiteTeardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){navigator.requestWakeLock=realApi;});}var <a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>;var <a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>;var <a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>;var alarmStore;var busytimeStore;var eventStore;var settingStore;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../df/d6d/prpdce_8h.html#a244bf4809fa769d3064852f1f46df24f">this.timeout</a>(10000);<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>=<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">testSupport.calendar.app</a>();<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>=<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">app.db</a>;<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>=new Calendar.Controllers.Alarm(<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>);alarmStore=app.store('Alarm');busytimeStore=app.store('Busytime');eventStore=app.store('<a class="el" href="../../d8/dd1/test_2marionette_2event_8js.html#aded1d021a890cccaab7c7ebd7450f106">Event</a>');settingStore=app.store('Setting');<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">db.open</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){testSupport.calendar.clearStore(<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.unobserve();var defaults=settingStore.defaults;var trans=db.transaction('settings', 'readwrite');<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">settingStore.remove</a>('syncFrequency', trans);<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">settingStore.remove</a>('syncAlarm', trans);trans.oncomplete=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">db.close</a>();<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">observe</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> sendId(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>){<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">mockRequest.onsuccess</a>({target:{result:id}});}var worksQueue;var realApi;var handleMessagesCalled;var realAlarmApi;var currentAlarmTime=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;var removed=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;var mockRequest={};suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){realApi=<a class="el" href="../../d5/de8/showcase__apps_2twittershare_2js_2activities_8js.html#a001e8b9b0ba824aea0b0061c184cb3bb">navigator.mozSetMessageHandler</a>;<a class="el" href="../../d5/de8/showcase__apps_2twittershare_2js_2activities_8js.html#a001e8b9b0ba824aea0b0061c184cb3bb">navigator.mozSetMessageHandler</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">handleMessagesCalled.push</a>(arguments);};realAlarmApi=navigator.mozAlarms;var mockAlarms=navigator.mozAlarms={add:function(endTime, <a class="el" href="../../db/df4/geoloc_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a> &amp;&amp;<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">data.type</a>=== '<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>') currentAlarmTime=endTime;<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(mockAlarms.onadd){<a class="el" href="../../d6/dec/mocha-bin_8js.html#a537e168ad693c5794e1977de944002a0">Calendar.nextTick</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){mockAlarms.onadd();});}<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> mockRequest;}, remove:function(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>){removed=<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>;currentAlarmTime=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;}};});suiteTeardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/de8/showcase__apps_2twittershare_2js_2activities_8js.html#a001e8b9b0ba824aea0b0061c184cb3bb">navigator.mozSetMessageHandler</a>=realApi;navigator.mozAlarms=realAlarmApi;});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){handleMessagesCalled=[];worksQueue=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;alarmStore.workQueue=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){worksQueue=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;};});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){navigator.mozAlarms.onadd=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;mockRequest={};});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('alarm messages', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();var handleAlarmMessages=handleMessagesCalled[0];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(handleAlarmMessages);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(handleAlarmMessages[0], 'alarm');subject.handleAlarmMessage=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d5/dde/plerror_8h.html#a2c3cb87d009c003069b9a90f020f8a9f">msg</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d5/dde/plerror_8h.html#a2c3cb87d009c003069b9a90f020f8a9f">msg</a>, 'foo');});};handleAlarmMessages[1]('foo');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('notification messages', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();var handleNotificationMessages=handleMessagesCalled[1];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(handleNotificationMessages);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(handleNotificationMessages[0], 'notification');subject.handleNotificationMessage=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d5/dde/plerror_8h.html#a2c3cb87d009c003069b9a90f020f8a9f">msg</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d5/dde/plerror_8h.html#a2c3cb87d009c003069b9a90f020f8a9f">msg</a>, 'foo');});};handleNotificationMessages[1]('foo');});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#_sendAlarmNotification', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var realApi;var sent=[];var onsend;var MockNotifications={send:function(){var <a class="el" href="../../d2/d7d/jsapi_8h.html#a52c9936fee3329d49b2cdede9b0fd7c8">args</a>=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">Array.slice</a>(arguments);var <a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>=<a class="el" href="../../d2/d7d/jsapi_8h.html#a52c9936fee3329d49b2cdede9b0fd7c8">args</a>[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">args.length</a>-1];<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">sent.push</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#a52c9936fee3329d49b2cdede9b0fd7c8">args</a>);<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#adf7ce41cd256eda7ce1f6adeea723bd3">setTimeout</a>(<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>);}};suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){realApi=<a class="el" href="../../db/d43/apps_2email_2test_2marionette_2lib_2notification_8js.html#a78cbc74dbdf02040cdf744e9633bea2c">Calendar.Notification</a>;<a class="el" href="../../db/d43/apps_2email_2test_2marionette_2lib_2notification_8js.html#a78cbc74dbdf02040cdf744e9633bea2c">Calendar.Notification</a>=MockNotifications;});suiteTeardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../db/d43/apps_2email_2test_2marionette_2lib_2notification_8js.html#a78cbc74dbdf02040cdf744e9633bea2c">Calendar.Notification</a>=realApi;});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('issues notification', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');var busytime=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{_id: '1'});var <a class="el" href="../../de/d8f/jsdebug_8h.html#a39bb9861b2cb39f94badb5db778de746">url</a>=subject.displayURL+busytime._id;subject._sendAlarmNotification({}, <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, busytime, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var notification=sent[0];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(notification, 'sends notification');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(notification[0], 'has <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a051e403214cb6872ad3fe4e50302a6ee">title</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(notification[1], event.remote.description, 'description');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(notification[2], <a class="el" href="../../de/d8f/jsdebug_8h.html#a39bb9861b2cb39f94badb5db778de746">url</a>, 'sends <a class="el" href="../../de/d8f/jsdebug_8h.html#a39bb9861b2cb39f94badb5db778de746">url</a>');});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#handleAlarm', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var sent=[];var busytime;var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>;var alarm;var transPending=0;var worksQueue;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> createTrans(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=eventStore.db.transaction(['busytimes', 'events', 'alarms'], 'readwrite');<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d1/d51/test__external__apps_2packstubtest_2js_2app_8js.html#ac189c42168797aa80d7a298a9394ff0b">trans.addEventListener</a>('complete', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#adf7ce41cd256eda7ce1f6adeea723bd3">setTimeout</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}, 0);});}<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> trans;}var <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>;mockRequestWakeLock(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(_lock){<a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>=_lock;});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;worksQueue=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();transPending=0;<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">sent.length</a>=0;<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;busytime=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;alarmStore.workQueue=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){worksQueue=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;var <a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">Array.slice</a>(arguments).pop();<a class="el" href="../../d6/dec/mocha-bin_8js.html#a537e168ad693c5794e1977de944002a0">Calendar.nextTick</a>(<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>);};subject._sendAlarmNotification=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">sent.push</a>(arguments);};});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> setupAlarms(<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=createTrans(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(trans);<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(alarm){alarmStore.persist(alarm, trans);}<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>){eventStore.persist(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, trans);}<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(busytime){busytimeStore.persist(busytime, trans);}});}<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('busytime in the past', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){setupAlarms(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(trans){var <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>=new Date();time.setMinutes(time.getMinutes()-3);<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');busytime=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:event._id, startTime:new Date(2012, 0, 1), endDate:time});alarm=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('alarm',{startDate:new Date(2012, 0, 2), eventId:event._id, busytimeId:busytime._id});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.handleAlarm(alarm, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d6/dec/mocha-bin_8js.html#a537e168ad693c5794e1977de944002a0">Calendar.nextTick</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(sent, 0);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(lock.mIsUnlocked, 'frees <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(worksQueue, 'works alarm queue');});});});<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(lock.mAquired, 'aquired <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>');});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('missing records', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){alarm={eventId:12, busytimeId:12};subject.handleAlarm(alarm, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">sent.length</a>, 0);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(worksQueue, 'works alarm queue');});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('valid busytime', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){setupAlarms(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(trans){var ends=new Date();ends.setMinutes(ends.getMinutes()+100);<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');busytime=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:event._id, startTime:new Date(2012, 0, 1), endDate:ends});alarm=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('alarm',{eventId:event._id, busytimeId:busytime._id});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var isComplete=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;var sent;subject._sendAlarmNotification=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){sent=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">Array.slice</a>(arguments);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#a8e4d922ae3532f8bdfcadccef0881707">assert.isFalse</a>(lock.mIsUnlocked, 'is locked <a class="el" href="../../d8/dd3/head_8js.html#a08ccbec53d45462b72eedf1db271b1a2">until</a> notification is <a class="el" href="../../d8/d2f/tests_2python_2gaia-ui-tests_2gaiatest_2resources_2report_2main_8js.html#aef1ea6a0d973b3d3596eee2e910c93dc">ready</a>');var <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>=sent[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">sent.length</a>-1];<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>();isComplete=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;};subject.handleAlarm(alarm, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d6/dec/mocha-bin_8js.html#a537e168ad693c5794e1977de944002a0">Calendar.nextTick</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(isComplete);assert.deepEqual(sent[0], alarm);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(worksQueue, 'works alarm queue');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(lock.mIsUnlocked, 'frees <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>');});});});<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(lock.mAquired, 'aquired <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>');});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('(perodic) <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> alarms', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> willChangeAlarmId(newId, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){navigator.mozAlarms.onadd=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d6/da5/libpinyin_8js.html#a3462cc6eb617727abfabace38088095d">settingStore.getValue</a>('syncAlarm', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(value.alarmId, newId, 'changes alarm <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>');});});};}var initialFreq;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d6/da5/libpinyin_8js.html#a3462cc6eb617727abfabace38088095d">settingStore.getValue</a>('syncFrequency', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, freq){initialFreq=freq;<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});var initialAlarmId=1;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){navigator.mozAlarms.onadd=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){sendId(initialAlarmId);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('initial alarms', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d6/da5/libpinyin_8js.html#a3462cc6eb617727abfabace38088095d">settingStore.getValue</a>('syncAlarm', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(value.alarmId, initialAlarmId, 'saves alarm reference');var duration=((value.end.valueOf()-value.start.valueOf())/1000/60);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(Math.ceil(duration), initialFreq, 'sets correct duration');});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a> alarm by changing syncFrequency', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#a7d50e9587913d4f6634c0b0c8de693c7">settingStore.set</a>('syncFrequency', <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(removed, initialAlarmId, 'removes alarm from mozAlarms');<a class="el" href="../../d6/da5/libpinyin_8js.html#a3462cc6eb617727abfabace38088095d">settingStore.getValue</a>('syncAlarm', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/d08/assertions_8js.html#a8e00d9840873f843252e77018da707c3">assert.hasProperties</a>(<a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>,{alarmId:null, end:null, start:null});});});});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> testChangesToTime(freqDiff){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('changing syncFrequency by: '+freqDiff, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var newAlarmId=2;var newFreq=initialFreq+freqDiff;willChangeAlarmId(newAlarmId, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#a7d50e9587913d4f6634c0b0c8de693c7">settingStore.set</a>('syncFrequency', newFreq);var difference=Math.round((currentAlarmTime-new Date())/1000/60);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(difference, newFreq);sendId(2);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(removed, initialAlarmId, 'removes <a class="el" href="../../d3/db2/prmwait_8h.html#a6aed8eca8bc323929991ebdb1a48929e">previous</a> alarm <a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">on</a> <a class="el" href="../../d9/dd6/_r_e_a_d_m_e_8md.html#ac1934db4e0289fcc2a08b0c7de017cf2">change</a>');});}testChangesToTime(10);testChangesToTime(-5);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#handleAlarmMessage', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('type:sync', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var locks=[];var realLockApi;mockRequestWakeLock(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">lock.type</a>=== 'wifi'){<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">locks.push</a>(<a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>);}});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">locks.length</a>=0;navigator.mozAlarms.onadd=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){sendId(1);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('reschedules <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){app.syncController.all=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>){<a class="el" href="../../d6/dec/mocha-bin_8js.html#a537e168ad693c5794e1977de944002a0">Calendar.nextTick</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>);};var lastAlarmTime=new Date(currentAlarmTime);navigator.mozAlarms.onadd=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(removed, 1, 'removes initial alarm');sendId(55);<a class="el" href="../../d6/da5/libpinyin_8js.html#a3462cc6eb617727abfabace38088095d">settingStore.getValue</a>('syncAlarm', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(value.alarmId, 55, 'creates new alarm');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(lastAlarmTime&lt; currentAlarmTime, 'alarm <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a> changes');});});};subject.handleAlarmMessage({data:{type: '<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>'}});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('multiple syncs', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var pending=4;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> onComplete(){<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(locks, 4, 'has correct number of locks');var freedAll=locks.every(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> lock.mIsUnlocked===<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;});<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(freedAll, 'all locks are freed.');}app.syncController.all=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>){var <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>=locks[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">locks.length</a>-1];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>, 'has <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#a8e4d922ae3532f8bdfcadccef0881707">assert.isFalse</a>(lock.mIsUnlocked, 'is locked');<a class="el" href="../../d6/dec/mocha-bin_8js.html#a537e168ad693c5794e1977de944002a0">Calendar.nextTick</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>();<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(lock.mIsUnlocked, 'unlocks itself');<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!(--pending)) <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(onComplete);});};var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../d3/d4b/lockscreen_8js.html#a5ad25e705333134dd79a0ba0e766f6bc">while</a>(<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++&lt; pending) subject.handleAlarmMessage({data:{type: '<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>'}});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#handleNotificationMessage', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var realGo;var <a class="el" href="../../d2/d7d/jsapi_8h.html#a254bf0858da09c96a48daf64404eb4f8">message</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d2/d7d/jsapi_8h.html#a254bf0858da09c96a48daf64404eb4f8">message</a>={clicked:true, imageURL: 'app:};realGo=<a class="el" href="../../d7/d8a/list_8js.html#a25e7026ed54a4f203c2c06c4aef7011a">app.go</a>;<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d7/d8a/list_8js.html#a25e7026ed54a4f203c2c06c4aef7011a">Calendar.App.go</a>=realGo;});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('receive <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> notification <a class="el" href="../../d2/d7d/jsapi_8h.html#a254bf0858da09c96a48daf64404eb4f8">message</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d7/d8a/list_8js.html#a25e7026ed54a4f203c2c06c4aef7011a">app.go</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(place){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(place, '/alarm-display/foo', 'redirects <a class="el" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> alarm display <a class="el" href="../../d7/d9d/time__test_8js.html#a9b03e8a9f4440c3c0c605b05ef1b0885">page</a>');<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};subject.handleNotificationMessage(<a class="el" href="../../d2/d7d/jsapi_8h.html#a254bf0858da09c96a48daf64404eb4f8">message</a>);});});});})</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="a2808e5f758eeed1e893968dda9db1745"></a><!-- doxytag: member="calendar/test/unit/controllers/alarm_test.js::requireApp" ref="a2808e5f758eeed1e893968dda9db1745" args="('calendar/shared/js/notification_helper.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d16/shared_2test_2unit_2mocks_2mock__settings__listener_8js.html#ada5f8f0f77028802cd46c92cb1ce8fce">requireApp</a> </td>
          <td>(</td>
          <td class="paramtype">'calendar/<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a88b8a0ec29ea19ab8a79e10dd9cf3c04">shared</a>/js/notification_helper.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5cade444b7bfa57b0994b39d3f44dab1"></a><!-- doxytag: member="calendar/test/unit/controllers/alarm_test.js::requireLib" ref="a5cade444b7bfa57b0994b39d3f44dab1" args="('notification.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/d0e/manager__test_8js.html#a160383846e1e348b6643e19d5c153d05">requireLib</a> </td>
          <td>(</td>
          <td class="paramtype">'notification.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5d8440377a49e6f79c9098fd35660434"></a><!-- doxytag: member="calendar/test/unit/controllers/alarm_test.js::suiteGroup" ref="a5d8440377a49e6f79c9098fd35660434" args="('Controllers.Alarm', function(){function mockRequestWakeLock(handler){var realApi;function lockMock(){return{mAquired:false, mIsUnlocked:false, unlock:function(){this.mIsUnlocked=true;}};}suiteSetup(function(){realApi=navigator.requestWakeLock;navigator.requestWakeLock=function(type){var lock=lockMock();lock.type=type;lock.mAquired=true;handler &amp;&amp;handler(lock);return lock;};});suiteTeardown(function(){navigator.requestWakeLock=realApi;});}var subject;var app;var db;var alarmStore;var busytimeStore;var eventStore;var settingStore;setup(function(done){this.timeout(10000);app=testSupport.calendar.app();db=app.db;subject=new Calendar.Controllers.Alarm(app);alarmStore=app.store('Alarm');busytimeStore=app.store('Busytime');eventStore=app.store('Event');settingStore=app.store('Setting');db.open(function(){done();});});teardown(function(done){testSupport.calendar.clearStore(db, done);});teardown(function(done){subject.unobserve();var defaults=settingStore.defaults;var trans=db.transaction('settings', 'readwrite');settingStore.remove('syncFrequency', trans);settingStore.remove('syncAlarm', trans);trans.oncomplete=function(){db.close();done();};});suite('#observe', function(){function sendId(id){mockRequest.onsuccess({target:{result:id}});}var worksQueue;var realApi;var handleMessagesCalled;var realAlarmApi;var currentAlarmTime=null;var removed=null;var mockRequest={};suiteSetup(function(){realApi=navigator.mozSetMessageHandler;navigator.mozSetMessageHandler=function(){handleMessagesCalled.push(arguments);};realAlarmApi=navigator.mozAlarms;var mockAlarms=navigator.mozAlarms={add:function(endTime, _, data){if(data &amp;&amp;data.type=== 'sync') currentAlarmTime=endTime;if(mockAlarms.onadd){Calendar.nextTick(function(){mockAlarms.onadd();});}return mockRequest;}, remove:function(id){removed=id;currentAlarmTime=null;}};});suiteTeardown(function(){navigator.mozSetMessageHandler=realApi;navigator.mozAlarms=realAlarmApi;});setup(function(){handleMessagesCalled=[];worksQueue=false;alarmStore.workQueue=function(){worksQueue=true;};});teardown(function(){navigator.mozAlarms.onadd=null;mockRequest={};});test('alarm messages', function(done){subject.observe();var handleAlarmMessages=handleMessagesCalled[0];assert.ok(handleAlarmMessages);assert.equal(handleAlarmMessages[0], 'alarm');subject.handleAlarmMessage=function(msg){done(function(){assert.equal(msg, 'foo');});};handleAlarmMessages[1]('foo');});test('notification messages', function(done){subject.observe();var handleNotificationMessages=handleMessagesCalled[1];assert.ok(handleNotificationMessages);assert.equal(handleNotificationMessages[0], 'notification');subject.handleNotificationMessage=function(msg){done(function(){assert.equal(msg, 'foo');});};handleNotificationMessages[1]('foo');});suite('#_sendAlarmNotification', function(){var realApi;var sent=[];var onsend;var MockNotifications={send:function(){var args=Array.slice(arguments);var callback=args[args.length&#45;1];sent.push(args);setTimeout(callback);}};suiteSetup(function(){realApi=Calendar.Notification;Calendar.Notification=MockNotifications;});suiteTeardown(function(){Calendar.Notification=realApi;});test('issues notification', function(done){var event=Factory('event');var busytime=Factory('busytime',{_id: '1'});var url=subject.displayURL+busytime._id;subject._sendAlarmNotification({}, event, busytime, function(){done(function(){var notification=sent[0];assert.ok(notification, 'sends notification');assert.ok(notification[0], 'has title');assert.equal(notification[1], event.remote.description, 'description');assert.equal(notification[2], url, 'sends url');});});});});suite('#handleAlarm', function(){var sent=[];var busytime;var event;var alarm;var transPending=0;var worksQueue;function createTrans(done){var trans=eventStore.db.transaction(['busytimes', 'events', 'alarms'], 'readwrite');if(done){trans.addEventListener('complete', function(){setTimeout(function(){done();}, 0);});}return trans;}var lock;mockRequestWakeLock(function(_lock){lock=_lock;});setup(function(){lock=null;worksQueue=false;subject.observe();transPending=0;sent.length=0;event=null;busytime=null;alarmStore.workQueue=function(){worksQueue=true;var callback=Array.slice(arguments).pop();Calendar.nextTick(callback);};subject._sendAlarmNotification=function(){sent.push(arguments);};});function setupAlarms(cb){setup(function(done){var trans=createTrans(done);cb(trans);if(alarm){alarmStore.persist(alarm, trans);}if(event){eventStore.persist(event, trans);}if(busytime){busytimeStore.persist(busytime, trans);}});}suite('busytime in the past', function(){setupAlarms(function(trans){var time=new Date();time.setMinutes(time.getMinutes()&#45;3);event=Factory('event');busytime=Factory('busytime',{eventId:event._id, startTime:new Date(2012, 0, 1), endDate:time});alarm=Factory('alarm',{startDate:new Date(2012, 0, 2), eventId:event._id, busytimeId:busytime._id});});test('result', function(done){subject.handleAlarm(alarm, function(){Calendar.nextTick(function(){done(function(){assert.length(sent, 0);assert.ok(lock.mIsUnlocked, 'frees lock');assert.ok(worksQueue, 'works alarm queue');});});});assert.ok(lock.mAquired, 'aquired lock');});});test('missing records', function(done){alarm={eventId:12, busytimeId:12};subject.handleAlarm(alarm, function(){done(function(){assert.equal(sent.length, 0);assert.ok(worksQueue, 'works alarm queue');});});});suite('valid busytime', function(){setupAlarms(function(trans){var ends=new Date();ends.setMinutes(ends.getMinutes()+100);event=Factory('event');busytime=Factory('busytime',{eventId:event._id, startTime:new Date(2012, 0, 1), endDate:ends});alarm=Factory('alarm',{eventId:event._id, busytimeId:busytime._id});});test('result', function(done){var isComplete=false;var sent;subject._sendAlarmNotification=function(){sent=Array.slice(arguments);assert.isFalse(lock.mIsUnlocked, 'is locked until notification is ready');var cb=sent[sent.length&#45;1];cb();isComplete=true;};subject.handleAlarm(alarm, function(){Calendar.nextTick(function(){done(function(){assert.ok(isComplete);assert.deepEqual(sent[0], alarm);assert.ok(worksQueue, 'works alarm queue');assert.ok(lock.mIsUnlocked, 'frees lock');});});});assert.ok(lock.mAquired, 'aquired lock');});});});suite('(perodic) sync alarms', function(){function willChangeAlarmId(newId, done){navigator.mozAlarms.onadd=function(){settingStore.getValue('syncAlarm', function(err, value){done(function(){assert.equal(value.alarmId, newId, 'changes alarm id');});});};}var initialFreq;setup(function(done){settingStore.getValue('syncFrequency', function(err, freq){initialFreq=freq;done();});});var initialAlarmId=1;setup(function(done){navigator.mozAlarms.onadd=function(){sendId(initialAlarmId);done();};subject.observe();});test('initial alarms', function(done){settingStore.getValue('syncAlarm', function(err, value){done(function(){assert.equal(value.alarmId, initialAlarmId, 'saves alarm reference');var duration=((value.end.valueOf()&#45;value.start.valueOf())/1000/60);assert.equal(Math.ceil(duration), initialFreq, 'sets correct duration');});});});test('remove alarm by changing syncFrequency', function(done){settingStore.set('syncFrequency', null);assert.equal(removed, initialAlarmId, 'removes alarm from mozAlarms');settingStore.getValue('syncAlarm', function(err, value){done(function(){assert.hasProperties(value,{alarmId:null, end:null, start:null});});});});function testChangesToTime(freqDiff){test('changing syncFrequency by: '+freqDiff, function(done){var newAlarmId=2;var newFreq=initialFreq+freqDiff;willChangeAlarmId(newAlarmId, done);settingStore.set('syncFrequency', newFreq);var difference=Math.round((currentAlarmTime&#45;new Date())/1000/60);assert.equal(difference, newFreq);sendId(2);assert.equal(removed, initialAlarmId, 'removes previous alarm on change');});}testChangesToTime(10);testChangesToTime(&#45;5);});suite('#handleAlarmMessage', function(){suite('type:sync', function(){var locks=[];var realLockApi;mockRequestWakeLock(function(lock){if(lock.type=== 'wifi'){locks.push(lock);}});setup(function(done){locks.length=0;navigator.mozAlarms.onadd=function(){sendId(1);done();};subject.observe();});test('reschedules sync', function(done){app.syncController.all=function(cb){Calendar.nextTick(cb);};var lastAlarmTime=new Date(currentAlarmTime);navigator.mozAlarms.onadd=function(){assert.equal(removed, 1, 'removes initial alarm');sendId(55);settingStore.getValue('syncAlarm', function(err, value){done(function(){assert.equal(value.alarmId, 55, 'creates new alarm');assert.ok(lastAlarmTime&lt; currentAlarmTime, 'alarm time changes');});});};subject.handleAlarmMessage({data:{type: 'sync'}});});test('multiple syncs', function(done){var pending=4;function onComplete(){assert.length(locks, 4, 'has correct number of locks');var freedAll=locks.every(function(lock){return lock.mIsUnlocked===true;});assert.ok(freedAll, 'all locks are freed.');}app.syncController.all=function(callback){var lock=locks[locks.length&#45;1];assert.ok(lock, 'has lock');assert.isFalse(lock.mIsUnlocked, 'is locked');Calendar.nextTick(function(){callback();assert.isTrue(lock.mIsUnlocked, 'unlocks itself');if(!(&#45;&#45;pending)) done(onComplete);});};var i=0;while(i++&lt; pending) subject.handleAlarmMessage({data:{type: 'sync'}});});});});suite('#handleNotificationMessage', function(){var realGo;var message;setup(function(done){message={clicked:true, imageURL: 'app:};realGo=app.go;done();});teardown(function(){Calendar.App.go=realGo;});test('receive a notification message', function(done){app.go=function(place){assert.equal(place, '/alarm&#45;display/foo', 'redirects to alarm display page');done();};subject.handleNotificationMessage(message);});});});})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d5e/views_2week__test_8js.html#ac63109f8f0c5b5ff6964f5d42af22de9">suiteGroup</a> </td>
          <td>(</td>
          <td class="paramtype">'Controllers.Alarm'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d9/d22/calendar_2test_2unit_2controllers_2alarm__test_8js.html">alarm_test.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:42に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
