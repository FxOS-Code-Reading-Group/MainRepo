<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: nsNetUtil.h ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d9/d5b/ns_net_util_8h.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">nsNetUtil.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d9/d5b/ns_net_util_8h.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a name="l00002"></a>00002 <span class="comment">/* vim:set ts=4 sw=4 sts=4 et cin: */</span>
<a name="l00003"></a>00003 <span class="comment">/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a name="l00004"></a>00004 <span class="comment"> * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a name="l00005"></a>00005 <span class="comment"> * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#ifndef nsNetUtil_h__</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#define nsNetUtil_h__</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dcf/ns_error_8h.html">nsError.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html">nsNetCID.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d55/ns_string_glue_8h.html">nsStringGlue.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dfd/ns_memory_8h.html">nsMemory.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html">nsCOMPtr.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d32/prio_8h.html">prio.h</a>&quot;</span> <span class="comment">// for read/write flags, permissions, etc.</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dcf/ns_hash_keys_8h.html">nsHashKeys.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d72/plstr_8h.html">plstr.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d08/ns_i_u_r_i_8h.html">nsIURI.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d46/ns_i_standard_u_r_l_8h.html">nsIStandardURL.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d9a/ns_i_u_r_l_parser_8h.html">nsIURLParser.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dc2/ns_i_u_u_i_d_generator_8h.html">nsIUUIDGenerator.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/dcf/ns_i_input_stream_8h.html">nsIInputStream.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="../../db/da8/ns_i_output_stream_8h.html">nsIOutputStream.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d58/ns_i_safe_output_stream_8h.html">nsISafeOutputStream.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dcf/ns_i_stream_listener_8h.html">nsIStreamListener.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da9/ns_i_request_observer_proxy_8h.html">nsIRequestObserverProxy.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d46/ns_i_simple_stream_listener_8h.html">nsISimpleStreamListener.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/dea/ns_i_load_group_8h.html">nsILoadGroup.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d30/ns_i_interface_requestor_8h.html">nsIInterfaceRequestor.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d59/ns_i_interface_requestor_utils_8h.html">nsIInterfaceRequestorUtils.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dba/ns_i_i_o_service_8h.html">nsIIOService.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d5b/ns_i_service_manager_8h.html">nsIServiceManager.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d65/ns_i_channel_8h.html">nsIChannel.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d41/ns_channel_properties_8h.html">nsChannelProperties.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d7c/ns_i_input_stream_channel_8h.html">nsIInputStreamChannel.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/def/ns_i_transport_8h.html">nsITransport.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d62/ns_i_stream_transport_service_8h.html">nsIStreamTransportService.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d9d/ns_i_http_channel_8h.html">nsIHttpChannel.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d7c/ns_i_downloader_8h.html">nsIDownloader.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d7e/ns_i_stream_loader_8h.html">nsIStreamLoader.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8f/ns_i_unichar_stream_loader_8h.html">nsIUnicharStreamLoader.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d2e/ns_i_pipe_8h.html">nsIPipe.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/da0/ns_i_protocol_handler_8h.html">nsIProtocolHandler.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d59/ns_i_file_protocol_handler_8h.html">nsIFileProtocolHandler.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d9a/ns_i_string_stream_8h.html">nsIStringStream.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d6a/ns_i_file_8h.html">nsIFile.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d19/ns_i_file_streams_8h.html">nsIFileStreams.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d66/ns_i_file_u_r_l_8h.html">nsIFileURL.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dc2/ns_i_protocol_proxy_service_8h.html">nsIProtocolProxyService.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d9a/ns_i_proxy_info_8h.html">nsIProxyInfo.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d19/ns_i_file_streams_8h.html">nsIFileStreams.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/df3/ns_i_buffered_streams_8h.html">nsIBufferedStreams.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d99/ns_i_input_stream_pump_8h.html">nsIInputStreamPump.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d61/ns_i_async_stream_copier_8h.html">nsIAsyncStreamCopier.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dc7/ns_i_persistent_properties2_8h.html">nsIPersistentProperties2.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d20/ns_i_sync_stream_listener_8h.html">nsISyncStreamListener.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d1d/ns_interface_requestor_agg_8h.html">nsInterfaceRequestorAgg.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0c/ns_i_net_util_8h.html">nsINetUtil.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/db3/ns_i_u_r_i_with_principal_8h.html">nsIURIWithPrincipal.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d89/ns_i_auth_prompt_8h.html">nsIAuthPrompt.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d33/ns_i_auth_prompt2_8h.html">nsIAuthPrompt2.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/df3/ns_i_auth_prompt_adapter_factory_8h.html">nsIAuthPromptAdapterFactory.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html">nsComponentManagerUtils.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html">nsServiceManagerUtils.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d31/ns_i_nested_u_r_i_8h.html">nsINestedURI.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d80/ns_i_mutable_8h.html">nsIMutable.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d4b/ns_i_property_bag2_8h.html">nsIPropertyBag2.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d96/ns_i_writable_property_bag2_8h.html">nsIWritablePropertyBag2.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d26/ns_i_i_d_n_service_8h.html">nsIIDNService.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d2a/ns_i_channel_event_sink_8h.html">nsIChannelEventSink.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/df7/ns_i_channel_policy_8h.html">nsIChannelPolicy.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d66/ns_i_socket_provider_service_8h.html">nsISocketProviderService.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dd3/ns_i_socket_provider_8h.html">nsISocketProvider.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dbd/ns_i_redirect_channel_registrar_8h.html">nsIRedirectChannelRegistrar.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d27/ns_i_m_i_m_e_header_param_8h.html">nsIMIMEHeaderParam.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d38/ns_i_load_context_8h.html">nsILoadContext.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d13/_services_8h.html">mozilla/Services.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d1a/ns_i_private_browsing_channel_8h.html">nsIPrivateBrowsingChannel.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dce/moz_i_application_clear_private_data_params_8h.html">mozIApplicationClearPrivateDataParams.h</a>&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d21/ns_i_offline_cache_update_8h.html">nsIOfflineCacheUpdate.h</a>&quot;</span>
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d88/ns_i_content_sniffer_8h.html">nsIContentSniffer.h</a>&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/df6/ns_category_cache_8h.html">nsCategoryCache.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d5c/ns_string_stream_8h.html">nsStringStream.h</a>&quot;</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="preprocessor">#ifdef MOZILLA_INTERNAL_API</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/ddd/ns_readable_utils_8h.html">nsReadableUtils.h</a>&quot;</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="keyword">inline</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;nsIIOService&gt;</a>
<a name="l00093"></a>00093 <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0add396a07df9701587b1c3ce42f4012">do_GetIOService</a>(<a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>* <a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a> = 0)
<a name="l00094"></a>00094 {
<a name="l00095"></a>00095     <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;nsIIOService&gt;</a> <a class="code" href="../../d6/da5/libpinyin_8js.html#a2a7ba084dafcf16766cf163d1f5fbbba">ret</a> = mozilla::services::GetIOService();
<a name="l00096"></a>00096     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a>)
<a name="l00097"></a>00097         *<a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a> = ret.<a class="code" href="../../d3/d17/structalready___add_refed.html#a557d752ab3af020ccb891056d6959050">get</a>() ? <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a> : <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a9de321fc4356efa6a090b3b736a206c2">NS_ERROR_FAILURE</a>;
<a name="l00098"></a>00098     <span class="keywordflow">return</span> <a class="code" href="../../d6/da5/libpinyin_8js.html#a2a7ba084dafcf16766cf163d1f5fbbba">ret</a>;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="keyword">inline</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;nsINetUtil&gt;</a>
<a name="l00102"></a>00102 <a class="code" href="../../d9/d5b/ns_net_util_8h.html#abb429ed76240101cb5df9d581ad4e652">do_GetNetUtil</a>(<a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> *<a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a> = 0) 
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104     nsCOMPtr&lt;nsIIOService&gt; io = mozilla::services::GetIOService();
<a name="l00105"></a>00105     <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;nsINetUtil&gt;</a> ret = <span class="keyword">nullptr</span>;
<a name="l00106"></a>00106     <span class="keywordflow">if</span> (io)
<a name="l00107"></a>00107         <a class="code" href="../../da/d0a/ns_i_x_p_c_scriptable_8idl.html#aa4f78e380eabb13ae05feb33602d6525">CallQueryInterface</a>(io, &amp;ret.<a class="code" href="../../d3/d17/structalready___add_refed.html#a5ea6dded3e3d4b54a10aad15a591e4c9">mRawPtr</a>);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a>)
<a name="l00110"></a>00110         *<a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a> = ret.<a class="code" href="../../d3/d17/structalready___add_refed.html#a557d752ab3af020ccb891056d6959050">get</a>() ? <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a> : <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a9de321fc4356efa6a090b3b736a206c2">NS_ERROR_FAILURE</a>;
<a name="l00111"></a>00111     <span class="keywordflow">return</span> <a class="code" href="../../d6/da5/libpinyin_8js.html#a2a7ba084dafcf16766cf163d1f5fbbba">ret</a>;
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 <span class="preprocessor">#else</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="comment">// Helper, to simplify getting the I/O service.</span>
<a name="l00115"></a>00115 <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="../../dd/d10/classns_get_service_by_contract_i_d_with_error.html">nsGetServiceByContractIDWithError</a>
<a name="l00116"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0add396a07df9701587b1c3ce42f4012">00116</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0add396a07df9701587b1c3ce42f4012">do_GetIOService</a>(<a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>* <a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a> = 0)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <span class="keywordflow">return</span> <a class="code" href="../../dd/d10/classns_get_service_by_contract_i_d_with_error.html">nsGetServiceByContractIDWithError</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#ae1ea4e805d28a589e9a674655d37c13d">NS_IOSERVICE_CONTRACTID</a>, <a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a>);
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">// An alias to do_GetIOService</span>
<a name="l00122"></a>00122 <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="../../dd/d10/classns_get_service_by_contract_i_d_with_error.html">nsGetServiceByContractIDWithError</a>
<a name="l00123"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#abb429ed76240101cb5df9d581ad4e652">00123</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#abb429ed76240101cb5df9d581ad4e652">do_GetNetUtil</a>(<a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>* <a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a> = 0)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0add396a07df9701587b1c3ce42f4012">do_GetIOService</a>(<a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a>);
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 <span class="preprocessor">#endif</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a>00129 <span class="comment">// private little helper function... don&#39;t call this directly!</span>
<a name="l00130"></a>00130 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00131"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#afaeb22bb1df6ee5397be07bf58529546">00131</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#afaeb22bb1df6ee5397be07bf58529546">net_EnsureIOService</a>(<a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a> **ios, nsCOMPtr&lt;nsIIOService&gt; &amp;grip)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l00134"></a>00134     <span class="keywordflow">if</span> (!*ios) {
<a name="l00135"></a>00135         grip = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0add396a07df9701587b1c3ce42f4012">do_GetIOService</a>(&amp;rv);
<a name="l00136"></a>00136         *ios = grip;
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138     <span class="keywordflow">return</span> rv;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00142"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a29e53f80743f9d78ab7db1b457d68f23">00142</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a29e53f80743f9d78ab7db1b457d68f23">NS_NewURI</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> **<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>, 
<a name="l00143"></a>00143           <span class="keyword">const</span> nsACString &amp;spec, 
<a name="l00144"></a>00144           <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d6b/make__gaia__shared_8js.html#a336889a89adb268f4371b970141c0bb7">charset</a> = <span class="keyword">nullptr</span>,
<a name="l00145"></a>00145           <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> *baseURI = <span class="keyword">nullptr</span>,
<a name="l00146"></a>00146           <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a> *ioService = <span class="keyword">nullptr</span>)     <span class="comment">// pass in nsIIOService to optimize callers</span>
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00149"></a>00149     nsCOMPtr&lt;nsIIOService&gt; grip;
<a name="l00150"></a>00150     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#afaeb22bb1df6ee5397be07bf58529546">net_EnsureIOService</a>(&amp;ioService, grip);
<a name="l00151"></a>00151     <span class="keywordflow">if</span> (ioService)
<a name="l00152"></a>00152         rv = ioService-&gt;NewURI(spec, <a class="code" href="../../db/d6b/make__gaia__shared_8js.html#a336889a89adb268f4371b970141c0bb7">charset</a>, baseURI, result);
<a name="l00153"></a>00153     <span class="keywordflow">return</span> rv; 
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00157"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a70c9bb9f8f0be98ca6d21623c1e07376">00157</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a29e53f80743f9d78ab7db1b457d68f23">NS_NewURI</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* *<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>, 
<a name="l00158"></a>00158           <span class="keyword">const</span> nsAString&amp; spec, 
<a name="l00159"></a>00159           <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d6b/make__gaia__shared_8js.html#a336889a89adb268f4371b970141c0bb7">charset</a> = <span class="keyword">nullptr</span>,
<a name="l00160"></a>00160           <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* baseURI = <span class="keyword">nullptr</span>,
<a name="l00161"></a>00161           <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>* ioService = <span class="keyword">nullptr</span>)     <span class="comment">// pass in nsIIOService to optimize callers</span>
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a29e53f80743f9d78ab7db1b457d68f23">NS_NewURI</a>(result, <a class="code" href="../../d0/de8/class_n_s___convert_u_t_f16to_u_t_f8.html">NS_ConvertUTF16toUTF8</a>(spec), <a class="code" href="../../db/d6b/make__gaia__shared_8js.html#a336889a89adb268f4371b970141c0bb7">charset</a>, baseURI, ioService);
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00167"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#adec6de02c5d828cd09afa56104216081">00167</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a29e53f80743f9d78ab7db1b457d68f23">NS_NewURI</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* *<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>, 
<a name="l00168"></a>00168           <span class="keyword">const</span> <span class="keywordtype">char</span> *spec,
<a name="l00169"></a>00169           <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* baseURI = <span class="keyword">nullptr</span>,
<a name="l00170"></a>00170           <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>* ioService = <span class="keyword">nullptr</span>)     <span class="comment">// pass in nsIIOService to optimize callers</span>
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a29e53f80743f9d78ab7db1b457d68f23">NS_NewURI</a>(result, nsDependentCString(spec), <span class="keyword">nullptr</span>, baseURI, ioService);
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00176"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a2e490a5df5cbaf9b6689262ee5c7786f">00176</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a2e490a5df5cbaf9b6689262ee5c7786f">NS_NewFileURI</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* *<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>, 
<a name="l00177"></a>00177               <a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>* spec, 
<a name="l00178"></a>00178               <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>* ioService = <span class="keyword">nullptr</span>)     <span class="comment">// pass in nsIIOService to optimize callers</span>
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00181"></a>00181     nsCOMPtr&lt;nsIIOService&gt; grip;
<a name="l00182"></a>00182     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#afaeb22bb1df6ee5397be07bf58529546">net_EnsureIOService</a>(&amp;ioService, grip);
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (ioService)
<a name="l00184"></a>00184         rv = ioService-&gt;NewFileURI(spec, result);
<a name="l00185"></a>00185     <span class="keywordflow">return</span> rv;
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00189"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae4782d8818efb2adee7c063fc0adee62">00189</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae4782d8818efb2adee7c063fc0adee62">NS_NewChannel</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>           **<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>,
<a name="l00190"></a>00190               <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>                *<a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>,
<a name="l00191"></a>00191               <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>          *ioService = <span class="keyword">nullptr</span>,    <span class="comment">// pass in nsIIOService to optimize callers</span>
<a name="l00192"></a>00192               <a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>          *loadGroup = <span class="keyword">nullptr</span>,
<a name="l00193"></a>00193               <a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a> *<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a> = <span class="keyword">nullptr</span>,
<a name="l00194"></a>00194               uint32_t               loadFlags = <a class="code" href="../../d8/d9e/interfacens_i_request.html#a2982c86df17a7e8a1778542f7b65f3bc">nsIRequest::LOAD_NORMAL</a>,
<a name="l00195"></a>00195               <a class="code" href="../../d6/d16/interfacens_i_channel_policy.html">nsIChannelPolicy</a>      *channelPolicy = <span class="keyword">nullptr</span>)
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00198"></a>00198     nsCOMPtr&lt;nsIIOService&gt; grip;
<a name="l00199"></a>00199     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#afaeb22bb1df6ee5397be07bf58529546">net_EnsureIOService</a>(&amp;ioService, grip);
<a name="l00200"></a>00200     <span class="keywordflow">if</span> (ioService) {
<a name="l00201"></a>00201         nsCOMPtr&lt;nsIChannel&gt; chan;
<a name="l00202"></a>00202         rv = ioService-&gt;NewChannelFromURI(uri, <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(chan));
<a name="l00203"></a>00203         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00204"></a>00204             <span class="keywordflow">if</span> (loadGroup) {
<a name="l00205"></a>00205                 rv = chan-&gt;SetLoadGroup(loadGroup);
<a name="l00206"></a>00206             }
<a name="l00207"></a>00207             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>) {
<a name="l00208"></a>00208                 <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="code" href="../../db/de5/namespacedefault__timezones.html#ac494636c41cb282619c68c44af233bc7">tmp</a> = chan-&gt;SetNotificationCallbacks(<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>);
<a name="l00209"></a>00209                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(tmp)) {
<a name="l00210"></a>00210                     rv = <a class="code" href="../../db/de5/namespacedefault__timezones.html#ac494636c41cb282619c68c44af233bc7">tmp</a>;
<a name="l00211"></a>00211                 }
<a name="l00212"></a>00212             }
<a name="l00213"></a>00213             <span class="keywordflow">if</span> (loadFlags != <a class="code" href="../../d8/d9e/interfacens_i_request.html#a2982c86df17a7e8a1778542f7b65f3bc">nsIRequest::LOAD_NORMAL</a>) {
<a name="l00214"></a>00214                 <span class="comment">// Retain the LOAD_REPLACE load flag if set.</span>
<a name="l00215"></a>00215                 <a class="code" href="../../d7/dcd/ns_i_request_8idl.html#a3be91dfb6721923fabaec023c2567af8">nsLoadFlags</a> normalLoadFlags = 0;
<a name="l00216"></a>00216                 chan-&gt;GetLoadFlags(&amp;normalLoadFlags);
<a name="l00217"></a>00217                 <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="code" href="../../db/de5/namespacedefault__timezones.html#ac494636c41cb282619c68c44af233bc7">tmp</a> = chan-&gt;SetLoadFlags(loadFlags |
<a name="l00218"></a>00218                                                   (normalLoadFlags &amp;
<a name="l00219"></a>00219                                                    <a class="code" href="../../d1/d2d/interfacens_i_channel.html#a08be4213093c14df645120d668082427">nsIChannel::LOAD_REPLACE</a>));
<a name="l00220"></a>00220                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(tmp)) {
<a name="l00221"></a>00221                     rv = <a class="code" href="../../db/de5/namespacedefault__timezones.html#ac494636c41cb282619c68c44af233bc7">tmp</a>;
<a name="l00222"></a>00222                 }
<a name="l00223"></a>00223             }
<a name="l00224"></a>00224             <span class="keywordflow">if</span> (channelPolicy) {
<a name="l00225"></a>00225                 nsCOMPtr&lt;nsIWritablePropertyBag2&gt; <a class="code" href="../../de/dc5/jsfriendapi_8h.html#a0c4e9efe1571ce3ef20a0baf42a47be9">props</a> = <a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(chan);
<a name="l00226"></a>00226                 <span class="keywordflow">if</span> (props) {
<a name="l00227"></a>00227                     props-&gt;SetPropertyAsInterface(<a class="code" href="../../d2/d41/ns_channel_properties_8h.html#ae30f3c14eaa2e07444490e464fd1bda5">NS_CHANNEL_PROP_CHANNEL_POLICY</a>,
<a name="l00228"></a>00228                                                   channelPolicy);
<a name="l00229"></a>00229                 }
<a name="l00230"></a>00230             }
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00232"></a>00232                 chan.forget(result);
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     <span class="keywordflow">return</span> rv;
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment">// Use this function with CAUTION. It creates a stream that blocks when you</span>
<a name="l00239"></a>00239 <span class="comment">// Read() from it and blocking the UI thread is a bad idea. If you don&#39;t want</span>
<a name="l00240"></a>00240 <span class="comment">// to implement a full blown asynchronous consumer (via nsIStreamListener) look</span>
<a name="l00241"></a>00241 <span class="comment">// at nsIStreamLoader instead.</span>
<a name="l00242"></a>00242 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00243"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a893de01dd017920d550efe136db0afd0">00243</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a893de01dd017920d550efe136db0afd0">NS_OpenURI</a>(<a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>       **<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>,
<a name="l00244"></a>00244            <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>                *<a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>,
<a name="l00245"></a>00245            <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>          *ioService = <span class="keyword">nullptr</span>,     <span class="comment">// pass in nsIIOService to optimize callers</span>
<a name="l00246"></a>00246            <a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>          *loadGroup = <span class="keyword">nullptr</span>,
<a name="l00247"></a>00247            <a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a> *<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a> = <span class="keyword">nullptr</span>,
<a name="l00248"></a>00248            uint32_t               loadFlags = <a class="code" href="../../d8/d9e/interfacens_i_request.html#a2982c86df17a7e8a1778542f7b65f3bc">nsIRequest::LOAD_NORMAL</a>,
<a name="l00249"></a>00249            <a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>           **channelOut = <span class="keyword">nullptr</span>)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00252"></a>00252     nsCOMPtr&lt;nsIChannel&gt; channel;
<a name="l00253"></a>00253     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae4782d8818efb2adee7c063fc0adee62">NS_NewChannel</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(channel), uri, ioService,
<a name="l00254"></a>00254                        loadGroup, <a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>, loadFlags);
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00256"></a>00256         <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a> *stream;
<a name="l00257"></a>00257         rv = channel-&gt;Open(&amp;stream);
<a name="l00258"></a>00258         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00259"></a>00259             *result = stream;
<a name="l00260"></a>00260             <span class="keywordflow">if</span> (channelOut) {
<a name="l00261"></a>00261                 *channelOut = <span class="keyword">nullptr</span>;
<a name="l00262"></a>00262                 channel.swap(*channelOut);
<a name="l00263"></a>00263             }
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266     <span class="keywordflow">return</span> rv;
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00270"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a317451edf014fe907bdfbfbbc088d26b">00270</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a893de01dd017920d550efe136db0afd0">NS_OpenURI</a>(<a class="code" href="../../d5/d6e/interfacens_i_stream_listener.html">nsIStreamListener</a>     *listener, 
<a name="l00271"></a>00271            <a class="code" href="../../d4/d6a/classns_i_supports.html">nsISupports</a>           *<a class="code" href="../../d9/d04/expat_8h.html#afe0934df1732463fe5378d8c8724edc6">context</a>, 
<a name="l00272"></a>00272            <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>                *<a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>,
<a name="l00273"></a>00273            <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>          *ioService = <span class="keyword">nullptr</span>,     <span class="comment">// pass in nsIIOService to optimize callers</span>
<a name="l00274"></a>00274            <a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>          *loadGroup = <span class="keyword">nullptr</span>,
<a name="l00275"></a>00275            <a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a> *<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a> = <span class="keyword">nullptr</span>,
<a name="l00276"></a>00276            uint32_t               loadFlags = <a class="code" href="../../d8/d9e/interfacens_i_request.html#a2982c86df17a7e8a1778542f7b65f3bc">nsIRequest::LOAD_NORMAL</a>)
<a name="l00277"></a>00277 {
<a name="l00278"></a>00278     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00279"></a>00279     nsCOMPtr&lt;nsIChannel&gt; channel;
<a name="l00280"></a>00280     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae4782d8818efb2adee7c063fc0adee62">NS_NewChannel</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(channel), uri, ioService,
<a name="l00281"></a>00281                        loadGroup, <a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>, loadFlags);
<a name="l00282"></a>00282     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00283"></a>00283         rv = channel-&gt;AsyncOpen(listener, context);
<a name="l00284"></a>00284     <span class="keywordflow">return</span> rv;
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00288"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7e218cc7ee74a5255e61164e52c759a0">00288</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7e218cc7ee74a5255e61164e52c759a0">NS_MakeAbsoluteURI</a>(nsACString       &amp;<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>,
<a name="l00289"></a>00289                    <span class="keyword">const</span> nsACString &amp;spec, 
<a name="l00290"></a>00290                    <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>           *baseURI)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00293"></a>00293     <span class="keywordflow">if</span> (!baseURI) {
<a name="l00294"></a>00294         <a class="code" href="../../dc/d6d/ns_debug_8h.html#aa7f3deb23fbcb284ef465fd28ccaaa35">NS_WARNING</a>(<span class="stringliteral">&quot;It doesn&#39;t make sense to not supply a base URI&quot;</span>);
<a name="l00295"></a>00295         result = spec;
<a name="l00296"></a>00296         rv = <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spec.IsEmpty())
<a name="l00299"></a>00299         rv = baseURI-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#a1ca7898fa50ad2c3660f6949968fb653">GetSpec</a>(result);
<a name="l00300"></a>00300     <span class="keywordflow">else</span>
<a name="l00301"></a>00301         rv = baseURI-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#ad4e97567245244b90944e07adf2934df">Resolve</a>(spec, result);
<a name="l00302"></a>00302     <span class="keywordflow">return</span> rv;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00306"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a5267cfbce50c8408574470ee7fec6920">00306</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7e218cc7ee74a5255e61164e52c759a0">NS_MakeAbsoluteURI</a>(<span class="keywordtype">char</span>        **<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>,
<a name="l00307"></a>00307                    <span class="keyword">const</span> <span class="keywordtype">char</span>   *spec, 
<a name="l00308"></a>00308                    <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>       *baseURI)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00311"></a>00311     nsAutoCString resultBuf;
<a name="l00312"></a>00312     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7e218cc7ee74a5255e61164e52c759a0">NS_MakeAbsoluteURI</a>(resultBuf, nsDependentCString(spec), baseURI);
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00314"></a>00314         *result = <a class="code" href="../../dd/ddd/ns_readable_utils_8h.html#a009f353314049fddcb262fc582c79d3c">ToNewCString</a>(resultBuf);
<a name="l00315"></a>00315         <span class="keywordflow">if</span> (!*result)
<a name="l00316"></a>00316             rv = <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a92ab988083ecf3206773169bf6b11d06">NS_ERROR_OUT_OF_MEMORY</a>;
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318     <span class="keywordflow">return</span> rv;
<a name="l00319"></a>00319 }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00322"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aba62bb799dfeeeac5a5ecdc7dfd747a4">00322</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7e218cc7ee74a5255e61164e52c759a0">NS_MakeAbsoluteURI</a>(nsAString       &amp;<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>,
<a name="l00323"></a>00323                    <span class="keyword">const</span> nsAString &amp;spec, 
<a name="l00324"></a>00324                    <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>          *baseURI)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (!baseURI) {
<a name="l00328"></a>00328         <a class="code" href="../../dc/d6d/ns_debug_8h.html#aa7f3deb23fbcb284ef465fd28ccaaa35">NS_WARNING</a>(<span class="stringliteral">&quot;It doesn&#39;t make sense to not supply a base URI&quot;</span>);
<a name="l00329"></a>00329         result = spec;
<a name="l00330"></a>00330         rv = <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332     <span class="keywordflow">else</span> {
<a name="l00333"></a>00333         nsAutoCString resultBuf;
<a name="l00334"></a>00334         <span class="keywordflow">if</span> (spec.IsEmpty())
<a name="l00335"></a>00335             rv = baseURI-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#a1ca7898fa50ad2c3660f6949968fb653">GetSpec</a>(resultBuf);
<a name="l00336"></a>00336         <span class="keywordflow">else</span>
<a name="l00337"></a>00337             rv = baseURI-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#ad4e97567245244b90944e07adf2934df">Resolve</a>(<a class="code" href="../../d0/de8/class_n_s___convert_u_t_f16to_u_t_f8.html">NS_ConvertUTF16toUTF8</a>(spec), resultBuf);
<a name="l00338"></a>00338         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00339"></a>00339             <a class="code" href="../../dd/ddd/ns_readable_utils_8h.html#a0acad83c7216962447935d4b7fb7e0b6">CopyUTF8toUTF16</a>(resultBuf, result);
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341     <span class="keywordflow">return</span> rv;
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00347"></a>00347 <span class="keyword">inline</span> int32_t
<a name="l00348"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a69f6ce6126b70fcaa3a86086544399bd">00348</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a69f6ce6126b70fcaa3a86086544399bd">NS_GetDefaultPort</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a53a9d930408d37f30165c41cd723f581">scheme</a>,
<a name="l00349"></a>00349                   <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>* ioService = <span class="keyword">nullptr</span>)
<a name="l00350"></a>00350 {
<a name="l00351"></a>00351   <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353   nsCOMPtr&lt;nsIIOService&gt; grip;
<a name="l00354"></a>00354   <a class="code" href="../../d9/d5b/ns_net_util_8h.html#afaeb22bb1df6ee5397be07bf58529546">net_EnsureIOService</a>(&amp;ioService, grip);
<a name="l00355"></a>00355   <span class="keywordflow">if</span> (!ioService)
<a name="l00356"></a>00356       <span class="keywordflow">return</span> -1;
<a name="l00357"></a>00357  
<a name="l00358"></a>00358   nsCOMPtr&lt;nsIProtocolHandler&gt; <a class="code" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">handler</a>;
<a name="l00359"></a>00359   rv = ioService-&gt;GetProtocolHandler(scheme, <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(handler));
<a name="l00360"></a>00360   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00361"></a>00361     <span class="keywordflow">return</span> -1;
<a name="l00362"></a>00362   int32_t <a class="code" href="../../df/d9e/prnetdb_8h.html#a2442718810e8bab593a8ef904979ca72">port</a>;
<a name="l00363"></a>00363   rv = handler-&gt;GetDefaultPort(&amp;port);
<a name="l00364"></a>00364   <span class="keywordflow">return</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) ? port : -1;
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00371"></a>00371 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l00372"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad802843c559750a17594d665a626397a">00372</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad802843c559750a17594d665a626397a">NS_StringToACE</a>(<span class="keyword">const</span> nsACString &amp;idn, nsACString &amp;<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>)
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374   nsCOMPtr&lt;nsIIDNService&gt; idnSrv = <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a2a883e4889cb26fc9b21267ef4d37abd">NS_IDNSERVICE_CONTRACTID</a>);
<a name="l00375"></a>00375   <span class="keywordflow">if</span> (!idnSrv)
<a name="l00376"></a>00376     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00377"></a>00377   <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = idnSrv-&gt;ConvertUTF8toACE(idn, result);
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00379"></a>00379     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00380"></a>00380   
<a name="l00381"></a>00381   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00389"></a>00389 <span class="keyword">inline</span> int32_t
<a name="l00390"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ab2978bcc694fb6f4c194f9e25e701ca4">00390</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ab2978bcc694fb6f4c194f9e25e701ca4">NS_GetRealPort</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* aURI)
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392     int32_t <a class="code" href="../../df/d9e/prnetdb_8h.html#a2442718810e8bab593a8ef904979ca72">port</a>;
<a name="l00393"></a>00393     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = aURI-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#a490c235bfa12c443fcb11b45268ef3bd">GetPort</a>(&amp;port);
<a name="l00394"></a>00394     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00395"></a>00395         <span class="keywordflow">return</span> -1;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="keywordflow">if</span> (port != -1)
<a name="l00398"></a>00398         <span class="keywordflow">return</span> <a class="code" href="../../df/d9e/prnetdb_8h.html#a2442718810e8bab593a8ef904979ca72">port</a>; <span class="comment">// explicitly specified</span>
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="comment">// Otherwise, we have to get the default port from the protocol handler</span>
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     <span class="comment">// Need the scheme first</span>
<a name="l00403"></a>00403     nsAutoCString <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a53a9d930408d37f30165c41cd723f581">scheme</a>;
<a name="l00404"></a>00404     rv = aURI-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#a7b732e2c4ae1283c75def54af24b5358">GetScheme</a>(scheme);
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00406"></a>00406         <span class="keywordflow">return</span> -1;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a69f6ce6126b70fcaa3a86086544399bd">NS_GetDefaultPort</a>(scheme.get());
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00412"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a211fef17a4046bd9651a670f243506fb">00412</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a211fef17a4046bd9651a670f243506fb">NS_NewInputStreamChannel</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>      **<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>,
<a name="l00413"></a>00413                          <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>           *<a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>,
<a name="l00414"></a>00414                          <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>   *stream,
<a name="l00415"></a>00415                          <span class="keyword">const</span> nsACString &amp;contentType,
<a name="l00416"></a>00416                          <span class="keyword">const</span> nsACString *contentCharset)
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00419"></a>00419     nsCOMPtr&lt;nsIInputStreamChannel&gt; isc =
<a name="l00420"></a>00420         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a80d3abf2536ed75067ef744ee48b95e7">NS_INPUTSTREAMCHANNEL_CONTRACTID</a>, &amp;rv);
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00422"></a>00422         <span class="keywordflow">return</span> rv;
<a name="l00423"></a>00423     rv = isc-&gt;SetURI(uri);
<a name="l00424"></a>00424     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="code" href="../../db/de5/namespacedefault__timezones.html#ac494636c41cb282619c68c44af233bc7">tmp</a> = isc-&gt;SetContentStream(stream);
<a name="l00425"></a>00425     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(tmp)) {
<a name="l00426"></a>00426         rv = <a class="code" href="../../db/de5/namespacedefault__timezones.html#ac494636c41cb282619c68c44af233bc7">tmp</a>;
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00429"></a>00429         <span class="keywordflow">return</span> rv;
<a name="l00430"></a>00430     nsCOMPtr&lt;nsIChannel&gt; chan = <a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(isc, &amp;rv);
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00432"></a>00432         <span class="keywordflow">return</span> rv;
<a name="l00433"></a>00433     <span class="keywordflow">if</span> (!contentType.IsEmpty())
<a name="l00434"></a>00434         rv = chan-&gt;SetContentType(contentType);
<a name="l00435"></a>00435     <span class="keywordflow">if</span> (contentCharset &amp;&amp; !contentCharset-&gt;IsEmpty()) {
<a name="l00436"></a>00436         tmp = chan-&gt;SetContentCharset(*contentCharset);
<a name="l00437"></a>00437         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(tmp)) {
<a name="l00438"></a>00438             rv = <a class="code" href="../../db/de5/namespacedefault__timezones.html#ac494636c41cb282619c68c44af233bc7">tmp</a>;
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00442"></a>00442         *result = <span class="keyword">nullptr</span>;
<a name="l00443"></a>00443         chan.swap(*result);
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445     <span class="keywordflow">return</span> rv;
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00449"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa94efb1816daf629ac346b5f5461ebc0">00449</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a211fef17a4046bd9651a670f243506fb">NS_NewInputStreamChannel</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>      **<a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>,
<a name="l00450"></a>00450                          <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>           *<a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>,
<a name="l00451"></a>00451                          <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>   *stream,
<a name="l00452"></a>00452                          <span class="keyword">const</span> nsACString &amp;contentType    = <a class="code" href="../../dd/ddd/ns_readable_utils_8h.html#a1c08b07ad9003485fa805689d5feb432">EmptyCString</a>())
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a211fef17a4046bd9651a670f243506fb">NS_NewInputStreamChannel</a>(result, uri, stream, contentType, <span class="keyword">nullptr</span>);
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00458"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a078df44147ee942514ad58a9f8492c1a">00458</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a211fef17a4046bd9651a670f243506fb">NS_NewInputStreamChannel</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>      **result,
<a name="l00459"></a>00459                          <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>           *uri,
<a name="l00460"></a>00460                          <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>   *stream,
<a name="l00461"></a>00461                          <span class="keyword">const</span> nsACString &amp;contentType,
<a name="l00462"></a>00462                          <span class="keyword">const</span> nsACString &amp;contentCharset)
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a211fef17a4046bd9651a670f243506fb">NS_NewInputStreamChannel</a>(result, uri, stream, contentType,
<a name="l00465"></a>00465                                     &amp;contentCharset);
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00469"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0905ca555592015c00ba298bf9829265">00469</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a211fef17a4046bd9651a670f243506fb">NS_NewInputStreamChannel</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>      **result,
<a name="l00470"></a>00470                          <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>           *uri,
<a name="l00471"></a>00471                          <span class="keyword">const</span> nsAString  &amp;<a class="code" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>,
<a name="l00472"></a>00472                          <span class="keyword">const</span> nsACString &amp;contentType,
<a name="l00473"></a>00473                          <span class="keywordtype">bool</span>              isSrcdocChannel = <span class="keyword">false</span>)
<a name="l00474"></a>00474 {
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     nsCOMPtr&lt;nsIStringInputStream&gt; stream;
<a name="l00479"></a>00479     stream = <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../dd/d5c/ns_string_stream_8h.html#a7f845eda9a022a649724ad5445656053">NS_STRINGINPUTSTREAM_CONTRACTID</a>, &amp;rv);
<a name="l00480"></a>00480     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 <span class="preprocessor">#ifdef MOZILLA_INTERNAL_API</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>    uint32_t <a class="code" href="../../d9/d04/expat_8h.html#a5df20ff5bc70fb664abe3912796e90df">len</a>;
<a name="l00484"></a>00484     <span class="keywordtype">char</span>* utf8Bytes = <a class="code" href="../../dd/ddd/ns_readable_utils_8h.html#a398691bae1b5c949e291c110701d638d">ToNewUTF8String</a>(data, &amp;len);
<a name="l00485"></a>00485     rv = stream-&gt;AdoptData(utf8Bytes, len);
<a name="l00486"></a>00486 <span class="preprocessor">#else</span>
<a name="l00487"></a>00487 <span class="preprocessor"></span>    <span class="keywordtype">char</span>* utf8Bytes = <a class="code" href="../../dd/ddd/ns_readable_utils_8h.html#a398691bae1b5c949e291c110701d638d">ToNewUTF8String</a>(data);
<a name="l00488"></a>00488     rv = stream-&gt;AdoptData(utf8Bytes, strlen(utf8Bytes));
<a name="l00489"></a>00489 <span class="preprocessor">#endif</span>
<a name="l00490"></a>00490 <span class="preprocessor"></span>
<a name="l00491"></a>00491     nsCOMPtr&lt;nsIChannel&gt; chan;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a211fef17a4046bd9651a670f243506fb">NS_NewInputStreamChannel</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(chan), uri, stream,
<a name="l00494"></a>00494                                   contentType, <a class="code" href="../../d5/d6e/ns_literal_string_8h.html#a1b94856de9615a4e9ad6debc722217db">NS_LITERAL_CSTRING</a>(<span class="stringliteral">&quot;UTF-8&quot;</span>));
<a name="l00495"></a>00495     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="keywordflow">if</span> (isSrcdocChannel) {
<a name="l00498"></a>00498         nsCOMPtr&lt;nsIInputStreamChannel&gt; inStrmChan = <a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(chan);
<a name="l00499"></a>00499         <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3292fd518c403022b5a9cbf11dd45f9a">NS_ENSURE_TRUE</a>(inStrmChan, <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a9de321fc4356efa6a090b3b736a206c2">NS_ERROR_FAILURE</a>);
<a name="l00500"></a>00500         inStrmChan-&gt;SetSrcdocData(data);
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     *result = <span class="keyword">nullptr</span>;
<a name="l00504"></a>00504     chan.swap(*result);
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l00507"></a>00507 }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00510"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a54e898ec36f52a340fd6e01f02dafd9b">00510</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a54e898ec36f52a340fd6e01f02dafd9b">NS_NewInputStreamPump</a>(<a class="code" href="../../de/df0/interfacens_i_input_stream_pump.html">nsIInputStreamPump</a> **result,
<a name="l00511"></a>00511                       <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>      *stream,
<a name="l00512"></a>00512                       int64_t              streamPos = int64_t(-1),
<a name="l00513"></a>00513                       int64_t              streamLen = int64_t(-1),
<a name="l00514"></a>00514                       uint32_t             segsize = 0,
<a name="l00515"></a>00515                       uint32_t             segcount = 0,
<a name="l00516"></a>00516                       <span class="keywordtype">bool</span>                 closeWhenDone = <span class="keyword">false</span>)
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00519"></a>00519     nsCOMPtr&lt;nsIInputStreamPump&gt; pump =
<a name="l00520"></a>00520         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a4eeec5650e872c8b97e479bc1bc3ab06">NS_INPUTSTREAMPUMP_CONTRACTID</a>, &amp;rv);
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00522"></a>00522         rv = pump-&gt;Init(stream, streamPos, streamLen,
<a name="l00523"></a>00523                         segsize, segcount, closeWhenDone);
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00525"></a>00525             *result = <span class="keyword">nullptr</span>;
<a name="l00526"></a>00526             pump.swap(*result);
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529     <span class="keywordflow">return</span> rv;
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="comment">// NOTE: you will need to specify whether or not your streams are buffered</span>
<a name="l00533"></a>00533 <span class="comment">// (i.e., do they implement ReadSegments/WriteSegments).  the default</span>
<a name="l00534"></a>00534 <span class="comment">// assumption of TRUE for both streams might not be right for you!</span>
<a name="l00535"></a>00535 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00536"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0c02cd9354db6919ed50744d4f95c928">00536</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0c02cd9354db6919ed50744d4f95c928">NS_NewAsyncStreamCopier</a>(<a class="code" href="../../d1/d13/interfacens_i_async_stream_copier.html">nsIAsyncStreamCopier</a> **result,
<a name="l00537"></a>00537                         <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>        *source,
<a name="l00538"></a>00538                         <a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a>       *sink,
<a name="l00539"></a>00539                         <a class="code" href="../../d0/da2/interfacens_i_event_target.html">nsIEventTarget</a>        *<a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>,
<a name="l00540"></a>00540                         <span class="keywordtype">bool</span>                   sourceBuffered = <span class="keyword">true</span>,
<a name="l00541"></a>00541                         <span class="keywordtype">bool</span>                   sinkBuffered = <span class="keyword">true</span>,
<a name="l00542"></a>00542                         uint32_t               chunkSize = 0,
<a name="l00543"></a>00543                         <span class="keywordtype">bool</span>                   closeSource = <span class="keyword">true</span>,
<a name="l00544"></a>00544                         <span class="keywordtype">bool</span>                   closeSink = <span class="keyword">true</span>)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00547"></a>00547     nsCOMPtr&lt;nsIAsyncStreamCopier&gt; copier =
<a name="l00548"></a>00548         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#ab225139d2d8068811720e2f2449074cb">NS_ASYNCSTREAMCOPIER_CONTRACTID</a>, &amp;rv);
<a name="l00549"></a>00549     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00550"></a>00550         rv = copier-&gt;Init(source, sink, target, sourceBuffered, sinkBuffered,
<a name="l00551"></a>00551                           chunkSize, closeSource, closeSink);
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00553"></a>00553             *result = <span class="keyword">nullptr</span>;
<a name="l00554"></a>00554             copier.swap(*result);
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557     <span class="keywordflow">return</span> rv;
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00561"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a90d4333b97ca7d7c54a4c2781c1bf0b3">00561</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a90d4333b97ca7d7c54a4c2781c1bf0b3">NS_NewLoadGroup</a>(<a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>      **result,
<a name="l00562"></a>00562                 <a class="code" href="../../d1/dc4/interfacens_i_request_observer.html">nsIRequestObserver</a> *obs)
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00565"></a>00565     nsCOMPtr&lt;nsILoadGroup&gt; group =
<a name="l00566"></a>00566         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a975e1f7fd1ed2cad35794b4aabe065f5">NS_LOADGROUP_CONTRACTID</a>, &amp;rv);
<a name="l00567"></a>00567     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00568"></a>00568         rv = group-&gt;SetGroupObserver(obs);
<a name="l00569"></a>00569         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00570"></a>00570             *result = <span class="keyword">nullptr</span>;
<a name="l00571"></a>00571             group.swap(*result);
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573     }
<a name="l00574"></a>00574     <span class="keywordflow">return</span> rv;
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00578"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ada4719fac6ac39e37ea081de79399929">00578</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ada4719fac6ac39e37ea081de79399929">NS_NewDownloader</a>(<a class="code" href="../../d5/d6e/interfacens_i_stream_listener.html">nsIStreamListener</a>   **result,
<a name="l00579"></a>00579                  <a class="code" href="../../d7/d7f/interfacens_i_download_observer.html">nsIDownloadObserver</a>  *observer,
<a name="l00580"></a>00580                  <a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>              *downloadLocation = <span class="keyword">nullptr</span>)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00583"></a>00583     nsCOMPtr&lt;nsIDownloader&gt; downloader =
<a name="l00584"></a>00584         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#af64331dae679efed06579f7f2d8ba0f1">NS_DOWNLOADER_CONTRACTID</a>, &amp;rv);
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00586"></a>00586         rv = downloader-&gt;Init(observer, downloadLocation);
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00588"></a>00588             <a class="code" href="../../d9/d4b/ns_i_supports_utils_8h.html#aa03d5ab87bebd65d9b5539de117f5590">NS_ADDREF</a>(*result = downloader);
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590     <span class="keywordflow">return</span> rv;
<a name="l00591"></a>00591 }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00594"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0344a0d2fa4f76edf453b5f2243de050">00594</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0344a0d2fa4f76edf453b5f2243de050">NS_NewStreamLoader</a>(<a class="code" href="../../d2/d79/interfacens_i_stream_loader.html">nsIStreamLoader</a>        **result,
<a name="l00595"></a>00595                    <a class="code" href="../../df/dc9/interfacens_i_stream_loader_observer.html">nsIStreamLoaderObserver</a> *observer)
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00598"></a>00598     nsCOMPtr&lt;nsIStreamLoader&gt; <a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a78601e1f2fe929d6470d82a205ad2382">loader</a> =
<a name="l00599"></a>00599         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#af0e4e214ebb8a383fd3b85fca10806ff">NS_STREAMLOADER_CONTRACTID</a>, &amp;rv);
<a name="l00600"></a>00600     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00601"></a>00601         rv = loader-&gt;Init(observer);
<a name="l00602"></a>00602         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00603"></a>00603             *result = <span class="keyword">nullptr</span>;
<a name="l00604"></a>00604             loader.swap(*result);
<a name="l00605"></a>00605         }
<a name="l00606"></a>00606     }
<a name="l00607"></a>00607     <span class="keywordflow">return</span> rv;
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00611"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad94a0a92d640d84be5043d951c6ba62f">00611</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0344a0d2fa4f76edf453b5f2243de050">NS_NewStreamLoader</a>(<a class="code" href="../../d2/d79/interfacens_i_stream_loader.html">nsIStreamLoader</a>        **result,
<a name="l00612"></a>00612                    <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>                  *uri,
<a name="l00613"></a>00613                    <a class="code" href="../../df/dc9/interfacens_i_stream_loader_observer.html">nsIStreamLoaderObserver</a> *observer,
<a name="l00614"></a>00614                    <a class="code" href="../../d4/d6a/classns_i_supports.html">nsISupports</a>             *<a class="code" href="../../d9/d04/expat_8h.html#afe0934df1732463fe5378d8c8724edc6">context</a>   = <span class="keyword">nullptr</span>,
<a name="l00615"></a>00615                    <a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>            *loadGroup = <span class="keyword">nullptr</span>,
<a name="l00616"></a>00616                    <a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a>   *<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a> = <span class="keyword">nullptr</span>,
<a name="l00617"></a>00617                    uint32_t                 loadFlags = <a class="code" href="../../d8/d9e/interfacens_i_request.html#a2982c86df17a7e8a1778542f7b65f3bc">nsIRequest::LOAD_NORMAL</a>,
<a name="l00618"></a>00618                    <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>                  *referrer  = <span class="keyword">nullptr</span>)
<a name="l00619"></a>00619 {
<a name="l00620"></a>00620     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00621"></a>00621     nsCOMPtr&lt;nsIChannel&gt; channel;
<a name="l00622"></a>00622     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae4782d8818efb2adee7c063fc0adee62">NS_NewChannel</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(channel),
<a name="l00623"></a>00623                        uri,
<a name="l00624"></a>00624                        <span class="keyword">nullptr</span>,
<a name="l00625"></a>00625                        loadGroup,
<a name="l00626"></a>00626                        <a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>,
<a name="l00627"></a>00627                        loadFlags);
<a name="l00628"></a>00628     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00629"></a>00629         nsCOMPtr&lt;nsIHttpChannel&gt; httpChannel(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(channel));
<a name="l00630"></a>00630         <span class="keywordflow">if</span> (httpChannel)
<a name="l00631"></a>00631             httpChannel-&gt;SetReferrer(referrer);
<a name="l00632"></a>00632         rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0344a0d2fa4f76edf453b5f2243de050">NS_NewStreamLoader</a>(result, observer);
<a name="l00633"></a>00633         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00634"></a>00634           rv = channel-&gt;AsyncOpen(*result, <a class="code" href="../../d9/d04/expat_8h.html#afe0934df1732463fe5378d8c8724edc6">context</a>);
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636     <span class="keywordflow">return</span> rv;
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00640"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a08971f98e53b9643ad81aac1edcd8c86">00640</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a08971f98e53b9643ad81aac1edcd8c86">NS_NewUnicharStreamLoader</a>(<a class="code" href="../../d2/d3e/interfacens_i_unichar_stream_loader.html">nsIUnicharStreamLoader</a>        **result,
<a name="l00641"></a>00641                           <a class="code" href="../../d4/d55/interfacens_i_unichar_stream_loader_observer.html">nsIUnicharStreamLoaderObserver</a> *observer)
<a name="l00642"></a>00642 {
<a name="l00643"></a>00643     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00644"></a>00644     nsCOMPtr&lt;nsIUnicharStreamLoader&gt; <a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a78601e1f2fe929d6470d82a205ad2382">loader</a> =
<a name="l00645"></a>00645         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a082f32e160fadb45de0d177aa626af71">NS_UNICHARSTREAMLOADER_CONTRACTID</a>, &amp;rv);
<a name="l00646"></a>00646     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00647"></a>00647         rv = loader-&gt;Init(observer);
<a name="l00648"></a>00648         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00649"></a>00649             *result = <span class="keyword">nullptr</span>;
<a name="l00650"></a>00650             loader.swap(*result);
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652     }
<a name="l00653"></a>00653     <span class="keywordflow">return</span> rv;
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00657"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a27a0ded8c6c561db221d7ee69196c58a">00657</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a27a0ded8c6c561db221d7ee69196c58a">NS_NewSyncStreamListener</a>(<a class="code" href="../../d5/d6e/interfacens_i_stream_listener.html">nsIStreamListener</a> **result,
<a name="l00658"></a>00658                          <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>    **stream)
<a name="l00659"></a>00659 {
<a name="l00660"></a>00660     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00661"></a>00661     nsCOMPtr&lt;nsISyncStreamListener&gt; listener =
<a name="l00662"></a>00662         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a6031c7c5d086ae8dd4a276a4b0f9b388">NS_SYNCSTREAMLISTENER_CONTRACTID</a>, &amp;rv);
<a name="l00663"></a>00663     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00664"></a>00664         rv = listener-&gt;GetInputStream(stream);
<a name="l00665"></a>00665         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00666"></a>00666             <a class="code" href="../../d9/d4b/ns_i_supports_utils_8h.html#aa03d5ab87bebd65d9b5539de117f5590">NS_ADDREF</a>(*result = listener);  <span class="comment">// cannot use nsCOMPtr::swap</span>
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668     <span class="keywordflow">return</span> rv;
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00678"></a>00678 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00679"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ac5f4207cc77b4a6472b0985918752f36">00679</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ac5f4207cc77b4a6472b0985918752f36">NS_ImplementChannelOpen</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>      *channel,
<a name="l00680"></a>00680                         <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a> **result)
<a name="l00681"></a>00681 {
<a name="l00682"></a>00682     nsCOMPtr&lt;nsIStreamListener&gt; listener;
<a name="l00683"></a>00683     nsCOMPtr&lt;nsIInputStream&gt; stream;
<a name="l00684"></a>00684     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a27a0ded8c6c561db221d7ee69196c58a">NS_NewSyncStreamListener</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(listener),
<a name="l00685"></a>00685                                            <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(stream));
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00687"></a>00687         rv = channel-&gt;<a class="code" href="../../d1/d2d/interfacens_i_channel.html#a9a67794717dea3546858f4f1fd91e0c3">AsyncOpen</a>(listener, <span class="keyword">nullptr</span>);
<a name="l00688"></a>00688         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00689"></a>00689             uint64_t <a class="code" href="../../d2/d7d/jsapi_8h.html#aa5a8b9a2d5edc8e2e7ba67d7e2ee4e69">n</a>;
<a name="l00690"></a>00690             <span class="comment">// block until the initial response is received or an error occurs.</span>
<a name="l00691"></a>00691             rv = stream-&gt;Available(&amp;n);
<a name="l00692"></a>00692             <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00693"></a>00693                 *result = <span class="keyword">nullptr</span>;
<a name="l00694"></a>00694                 stream.swap(*result);
<a name="l00695"></a>00695             }
<a name="l00696"></a>00696         }
<a name="l00697"></a>00697     }
<a name="l00698"></a>00698     <span class="keywordflow">return</span> rv;
<a name="l00699"></a>00699 }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00702"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a337c4df194af93c32d5ba77f2af132c3">00702</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a337c4df194af93c32d5ba77f2af132c3">NS_NewRequestObserverProxy</a>(<a class="code" href="../../d1/dc4/interfacens_i_request_observer.html">nsIRequestObserver</a> **result,
<a name="l00703"></a>00703                            <a class="code" href="../../d1/dc4/interfacens_i_request_observer.html">nsIRequestObserver</a>  *observer,
<a name="l00704"></a>00704                            <a class="code" href="../../d4/d6a/classns_i_supports.html">nsISupports</a>         *<a class="code" href="../../d9/d04/expat_8h.html#afe0934df1732463fe5378d8c8724edc6">context</a>)
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00707"></a>00707     nsCOMPtr&lt;nsIRequestObserverProxy&gt; proxy =
<a name="l00708"></a>00708         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#acc0a7a568a00c59f4a6c86e48e5d9d7c">NS_REQUESTOBSERVERPROXY_CONTRACTID</a>, &amp;rv);
<a name="l00709"></a>00709     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00710"></a>00710         rv = proxy-&gt;Init(observer, context);
<a name="l00711"></a>00711         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00712"></a>00712             <a class="code" href="../../d9/d4b/ns_i_supports_utils_8h.html#aa03d5ab87bebd65d9b5539de117f5590">NS_ADDREF</a>(*result = proxy);  <span class="comment">// cannot use nsCOMPtr::swap</span>
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714     <span class="keywordflow">return</span> rv;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00718"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae77fb55be5f6f6407bee02d5a1fb2c81">00718</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae77fb55be5f6f6407bee02d5a1fb2c81">NS_NewSimpleStreamListener</a>(<a class="code" href="../../d5/d6e/interfacens_i_stream_listener.html">nsIStreamListener</a> **result,
<a name="l00719"></a>00719                            <a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a>    *sink,
<a name="l00720"></a>00720                            <a class="code" href="../../d1/dc4/interfacens_i_request_observer.html">nsIRequestObserver</a> *observer = <span class="keyword">nullptr</span>)
<a name="l00721"></a>00721 {
<a name="l00722"></a>00722     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00723"></a>00723     nsCOMPtr&lt;nsISimpleStreamListener&gt; listener = 
<a name="l00724"></a>00724         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a66176aaf65290dda42f9aad4d8d2a779">NS_SIMPLESTREAMLISTENER_CONTRACTID</a>, &amp;rv);
<a name="l00725"></a>00725     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00726"></a>00726         rv = listener-&gt;Init(sink, observer);
<a name="l00727"></a>00727         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00728"></a>00728             <a class="code" href="../../d9/d4b/ns_i_supports_utils_8h.html#aa03d5ab87bebd65d9b5539de117f5590">NS_ADDREF</a>(*result = listener);  <span class="comment">// cannot use nsCOMPtr::swap</span>
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730     <span class="keywordflow">return</span> rv;
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00734"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a8da906772d4093b6f5aa2a7a13bd5a53">00734</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a8da906772d4093b6f5aa2a7a13bd5a53">NS_CheckPortSafety</a>(int32_t       <a class="code" href="../../df/d9e/prnetdb_8h.html#a2442718810e8bab593a8ef904979ca72">port</a>,
<a name="l00735"></a>00735                    <span class="keyword">const</span> <span class="keywordtype">char</span>   *<a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a53a9d930408d37f30165c41cd723f581">scheme</a>,
<a name="l00736"></a>00736                    <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a> *ioService = <span class="keyword">nullptr</span>)
<a name="l00737"></a>00737 {
<a name="l00738"></a>00738     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00739"></a>00739     nsCOMPtr&lt;nsIIOService&gt; grip;
<a name="l00740"></a>00740     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#afaeb22bb1df6ee5397be07bf58529546">net_EnsureIOService</a>(&amp;ioService, grip);
<a name="l00741"></a>00741     <span class="keywordflow">if</span> (ioService) {
<a name="l00742"></a>00742         <span class="keywordtype">bool</span> allow;
<a name="l00743"></a>00743         rv = ioService-&gt;AllowPort(port, scheme, &amp;allow);
<a name="l00744"></a>00744         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; !allow) {
<a name="l00745"></a>00745             <a class="code" href="../../dc/d6d/ns_debug_8h.html#aa7f3deb23fbcb284ef465fd28ccaaa35">NS_WARNING</a>(<span class="stringliteral">&quot;port blocked&quot;</span>);
<a name="l00746"></a>00746             rv = <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a7f6147ca14c57044465b368b9b471086">NS_ERROR_PORT_ACCESS_NOT_ALLOWED</a>;
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748     }
<a name="l00749"></a>00749     <span class="keywordflow">return</span> rv;
<a name="l00750"></a>00750 }
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 <span class="comment">// Determine if this URI is using a safe port.</span>
<a name="l00753"></a>00753 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00754"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a474e59b7853601d03c89f881272d54e3">00754</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a8da906772d4093b6f5aa2a7a13bd5a53">NS_CheckPortSafety</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> *uri) {
<a name="l00755"></a>00755     int32_t <a class="code" href="../../df/d9e/prnetdb_8h.html#a2442718810e8bab593a8ef904979ca72">port</a>;
<a name="l00756"></a>00756     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = uri-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#a490c235bfa12c443fcb11b45268ef3bd">GetPort</a>(&amp;port);
<a name="l00757"></a>00757     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv) || port == -1)  <span class="comment">// port undefined or default-valued</span>
<a name="l00758"></a>00758         <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l00759"></a>00759     nsAutoCString <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a53a9d930408d37f30165c41cd723f581">scheme</a>;
<a name="l00760"></a>00760     uri-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#a7b732e2c4ae1283c75def54af24b5358">GetScheme</a>(scheme);
<a name="l00761"></a>00761     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a8da906772d4093b6f5aa2a7a13bd5a53">NS_CheckPortSafety</a>(port, scheme.get());
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00765"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a68f551dd8f38b53935c2b70702a3294b">00765</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a68f551dd8f38b53935c2b70702a3294b">NS_NewProxyInfo</a>(<span class="keyword">const</span> nsACString &amp;<a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>,
<a name="l00766"></a>00766                 <span class="keyword">const</span> nsACString &amp;host,
<a name="l00767"></a>00767                 int32_t           <a class="code" href="../../df/d9e/prnetdb_8h.html#a2442718810e8bab593a8ef904979ca72">port</a>,
<a name="l00768"></a>00768                 uint32_t          <a class="code" href="../../da/d32/prio_8h.html#aa2585d779da0ab21273a8d92de9a0ebe">flags</a>,
<a name="l00769"></a>00769                 <a class="code" href="../../dd/d26/interfacens_i_proxy_info.html">nsIProxyInfo</a>    **result)
<a name="l00770"></a>00770 {
<a name="l00771"></a>00771     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00772"></a>00772     nsCOMPtr&lt;nsIProtocolProxyService&gt; pps =
<a name="l00773"></a>00773             <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a2fdba028051d4d4092f833d9f6ccd713">NS_PROTOCOLPROXYSERVICE_CONTRACTID</a>, &amp;rv);
<a name="l00774"></a>00774     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00775"></a>00775         rv = pps-&gt;NewProxyInfo(type, host, port, flags, UINT32_MAX, <span class="keyword">nullptr</span>,
<a name="l00776"></a>00776                                result);
<a name="l00777"></a>00777     <span class="keywordflow">return</span> rv; 
<a name="l00778"></a>00778 }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00781"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa79019da38d81fd6e7315090cde5e07f">00781</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa79019da38d81fd6e7315090cde5e07f">NS_GetFileProtocolHandler</a>(<a class="code" href="../../d6/d3b/interfacens_i_file_protocol_handler.html">nsIFileProtocolHandler</a> **result,
<a name="l00782"></a>00782                           <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>            *ioService = <span class="keyword">nullptr</span>)
<a name="l00783"></a>00783 {
<a name="l00784"></a>00784     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00785"></a>00785     nsCOMPtr&lt;nsIIOService&gt; grip;
<a name="l00786"></a>00786     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#afaeb22bb1df6ee5397be07bf58529546">net_EnsureIOService</a>(&amp;ioService, grip);
<a name="l00787"></a>00787     <span class="keywordflow">if</span> (ioService) {
<a name="l00788"></a>00788         nsCOMPtr&lt;nsIProtocolHandler&gt; <a class="code" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">handler</a>;
<a name="l00789"></a>00789         rv = ioService-&gt;GetProtocolHandler(<span class="stringliteral">&quot;file&quot;</span>, <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(handler));
<a name="l00790"></a>00790         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00791"></a>00791             rv = <a class="code" href="../../da/d0a/ns_i_x_p_c_scriptable_8idl.html#aa4f78e380eabb13ae05feb33602d6525">CallQueryInterface</a>(handler, result);
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793     <span class="keywordflow">return</span> rv;
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00797"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a11ea153805b4ce66090bb2074e9fb327">00797</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a11ea153805b4ce66090bb2074e9fb327">NS_GetFileFromURLSpec</a>(<span class="keyword">const</span> nsACString  &amp;inURL,
<a name="l00798"></a>00798                       <a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>          **result,
<a name="l00799"></a>00799                       <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>      *ioService = <span class="keyword">nullptr</span>)
<a name="l00800"></a>00800 {
<a name="l00801"></a>00801     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00802"></a>00802     nsCOMPtr&lt;nsIFileProtocolHandler&gt; fileHandler;
<a name="l00803"></a>00803     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa79019da38d81fd6e7315090cde5e07f">NS_GetFileProtocolHandler</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(fileHandler), ioService);
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00805"></a>00805         rv = fileHandler-&gt;GetFileFromURLSpec(inURL, result);
<a name="l00806"></a>00806     <span class="keywordflow">return</span> rv;
<a name="l00807"></a>00807 }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00810"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0cc07243020b1c82c199aaa653ab195d">00810</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0cc07243020b1c82c199aaa653ab195d">NS_GetURLSpecFromFile</a>(<a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>      *<a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>,
<a name="l00811"></a>00811                       nsACString   &amp;<a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>,
<a name="l00812"></a>00812                       <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a> *ioService = <span class="keyword">nullptr</span>)
<a name="l00813"></a>00813 {
<a name="l00814"></a>00814     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00815"></a>00815     nsCOMPtr&lt;nsIFileProtocolHandler&gt; fileHandler;
<a name="l00816"></a>00816     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa79019da38d81fd6e7315090cde5e07f">NS_GetFileProtocolHandler</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(fileHandler), ioService);
<a name="l00817"></a>00817     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00818"></a>00818         rv = fileHandler-&gt;GetURLSpecFromFile(file, url);
<a name="l00819"></a>00819     <span class="keywordflow">return</span> rv;
<a name="l00820"></a>00820 }
<a name="l00821"></a>00821 
<a name="l00829"></a>00829 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00830"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#acdb5cd28f1a538429e5e7397627dab73">00830</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#acdb5cd28f1a538429e5e7397627dab73">NS_GetURLSpecFromActualFile</a>(<a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>      *<a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>,
<a name="l00831"></a>00831                             nsACString   &amp;<a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>,
<a name="l00832"></a>00832                             <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a> *ioService = <span class="keyword">nullptr</span>)
<a name="l00833"></a>00833 {
<a name="l00834"></a>00834     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00835"></a>00835     nsCOMPtr&lt;nsIFileProtocolHandler&gt; fileHandler;
<a name="l00836"></a>00836     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa79019da38d81fd6e7315090cde5e07f">NS_GetFileProtocolHandler</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(fileHandler), ioService);
<a name="l00837"></a>00837     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00838"></a>00838         rv = fileHandler-&gt;GetURLSpecFromActualFile(file, url);
<a name="l00839"></a>00839     <span class="keywordflow">return</span> rv;
<a name="l00840"></a>00840 }
<a name="l00841"></a>00841 
<a name="l00849"></a>00849 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00850"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0f10fc43220cbd91a5f8430d7ced8662">00850</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0f10fc43220cbd91a5f8430d7ced8662">NS_GetURLSpecFromDir</a>(<a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>      *<a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>,
<a name="l00851"></a>00851                      nsACString   &amp;<a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>,
<a name="l00852"></a>00852                      <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a> *ioService = <span class="keyword">nullptr</span>)
<a name="l00853"></a>00853 {
<a name="l00854"></a>00854     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00855"></a>00855     nsCOMPtr&lt;nsIFileProtocolHandler&gt; fileHandler;
<a name="l00856"></a>00856     rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa79019da38d81fd6e7315090cde5e07f">NS_GetFileProtocolHandler</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(fileHandler), ioService);
<a name="l00857"></a>00857     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00858"></a>00858         rv = fileHandler-&gt;GetURLSpecFromDir(file, url);
<a name="l00859"></a>00859     <span class="keywordflow">return</span> rv;
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00869"></a>00869 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00870"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a08653932c636fac56642fd61acdc8f79">00870</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a08653932c636fac56642fd61acdc8f79">NS_GetReferrerFromChannel</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a> *channel,
<a name="l00871"></a>00871                           <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> **referrer)
<a name="l00872"></a>00872 {
<a name="l00873"></a>00873     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#add557738778e863a1381883ae4864c6d">NS_ERROR_NOT_AVAILABLE</a>;
<a name="l00874"></a>00874     *referrer = <span class="keyword">nullptr</span>;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876     nsCOMPtr&lt;nsIPropertyBag2&gt; <a class="code" href="../../de/dc5/jsfriendapi_8h.html#a0c4e9efe1571ce3ef20a0baf42a47be9">props</a>(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(channel));
<a name="l00877"></a>00877     <span class="keywordflow">if</span> (props) {
<a name="l00878"></a>00878       <span class="comment">// We have to check for a property on a property bag because the</span>
<a name="l00879"></a>00879       <span class="comment">// referrer may be empty for security reasons (for example, when loading</span>
<a name="l00880"></a>00880       <span class="comment">// an http page with an https referrer).</span>
<a name="l00881"></a>00881       rv = props-&gt;GetPropertyAsInterface(<a class="code" href="../../d5/d6e/ns_literal_string_8h.html#af4d2105e3a561d34eaa52d399a745a8e">NS_LITERAL_STRING</a>(<span class="stringliteral">&quot;docshell.internalReferrer&quot;</span>),
<a name="l00882"></a>00882                                          <a class="code" href="../../d9/d0a/ns_i_d_8h.html#a0539f3fe70e2bfddae0ed75c869dfdf4">NS_GET_IID</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>),
<a name="l00883"></a>00883                                          reinterpret_cast&lt;void **&gt;(referrer));
<a name="l00884"></a>00884       <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00885"></a>00885         *referrer = <span class="keyword">nullptr</span>;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888     <span class="comment">// if that didn&#39;t work, we can still try to get the referrer from the</span>
<a name="l00889"></a>00889     <span class="comment">// nsIHttpChannel (if we can QI to it)</span>
<a name="l00890"></a>00890     <span class="keywordflow">if</span> (!(*referrer)) {
<a name="l00891"></a>00891       nsCOMPtr&lt;nsIHttpChannel&gt; chan(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(channel));
<a name="l00892"></a>00892       <span class="keywordflow">if</span> (chan) {
<a name="l00893"></a>00893         rv = chan-&gt;GetReferrer(referrer);
<a name="l00894"></a>00894         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l00895"></a>00895           *referrer = <span class="keyword">nullptr</span>;
<a name="l00896"></a>00896       }
<a name="l00897"></a>00897     }
<a name="l00898"></a>00898     <span class="keywordflow">return</span> rv;
<a name="l00899"></a>00899 }
<a name="l00900"></a>00900 
<a name="l00901"></a>00901 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00902"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae178ff0914b1a125a166241a8aeb04a9">00902</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae178ff0914b1a125a166241a8aeb04a9">NS_ParseContentType</a>(<span class="keyword">const</span> nsACString &amp;rawContentType,
<a name="l00903"></a>00903                     nsCString        &amp;contentType,
<a name="l00904"></a>00904                     nsCString        &amp;contentCharset)
<a name="l00905"></a>00905 {
<a name="l00906"></a>00906     <span class="comment">// contentCharset is left untouched if not present in rawContentType</span>
<a name="l00907"></a>00907     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00908"></a>00908     nsCOMPtr&lt;nsINetUtil&gt; <a class="code" href="../../db/deb/apps_2system_2test_2marionette_2lib_2notification_8js.html#a8f5b2e09d5197e9d28f6032dff542d44">util</a> = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#abb429ed76240101cb5df9d581ad4e652">do_GetNetUtil</a>(&amp;rv);
<a name="l00909"></a>00909     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l00910"></a>00910     nsCString <a class="code" href="../../db/d6b/make__gaia__shared_8js.html#a336889a89adb268f4371b970141c0bb7">charset</a>;
<a name="l00911"></a>00911     <span class="keywordtype">bool</span> hadCharset;
<a name="l00912"></a>00912     rv = util-&gt;ParseContentType(rawContentType, charset, &amp;hadCharset,
<a name="l00913"></a>00913                                 contentType);
<a name="l00914"></a>00914     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; hadCharset)
<a name="l00915"></a>00915         contentCharset = <a class="code" href="../../db/d6b/make__gaia__shared_8js.html#a336889a89adb268f4371b970141c0bb7">charset</a>;
<a name="l00916"></a>00916     <span class="keywordflow">return</span> rv;
<a name="l00917"></a>00917 }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00920"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#abda056275b923f1a8445d6b3842fbf30">00920</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#abda056275b923f1a8445d6b3842fbf30">NS_ExtractCharsetFromContentType</a>(<span class="keyword">const</span> nsACString &amp;rawContentType,
<a name="l00921"></a>00921                                  nsCString        &amp;contentCharset,
<a name="l00922"></a>00922                                  <span class="keywordtype">bool</span>             *hadCharset,
<a name="l00923"></a>00923                                  int32_t          *charsetStart,
<a name="l00924"></a>00924                                  int32_t          *charsetEnd)
<a name="l00925"></a>00925 {
<a name="l00926"></a>00926     <span class="comment">// contentCharset is left untouched if not present in rawContentType</span>
<a name="l00927"></a>00927     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00928"></a>00928     nsCOMPtr&lt;nsINetUtil&gt; <a class="code" href="../../db/deb/apps_2system_2test_2marionette_2lib_2notification_8js.html#a8f5b2e09d5197e9d28f6032dff542d44">util</a> = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#abb429ed76240101cb5df9d581ad4e652">do_GetNetUtil</a>(&amp;rv);
<a name="l00929"></a>00929     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <span class="keywordflow">return</span> util-&gt;ExtractCharsetFromContentType(rawContentType,
<a name="l00932"></a>00932                                                contentCharset,
<a name="l00933"></a>00933                                                charsetStart,
<a name="l00934"></a>00934                                                charsetEnd,
<a name="l00935"></a>00935                                                hadCharset);
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00939"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae9b3b19f3c2b2a1f3160c23fa7e8e557">00939</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae9b3b19f3c2b2a1f3160c23fa7e8e557">NS_NewLocalFileInputStream</a>(<a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a> **result,
<a name="l00940"></a>00940                            <a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>         *<a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>,
<a name="l00941"></a>00941                            int32_t          ioFlags       = -1,
<a name="l00942"></a>00942                            int32_t          perm          = -1,
<a name="l00943"></a>00943                            int32_t          behaviorFlags = 0)
<a name="l00944"></a>00944 {
<a name="l00945"></a>00945     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00946"></a>00946     nsCOMPtr&lt;nsIFileInputStream&gt; in =
<a name="l00947"></a>00947         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#adabede87faa22a79fce34850578fdf5b">NS_LOCALFILEINPUTSTREAM_CONTRACTID</a>, &amp;rv);
<a name="l00948"></a>00948     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00949"></a>00949         rv = in-&gt;Init(file, ioFlags, perm, behaviorFlags);
<a name="l00950"></a>00950         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00951"></a>00951             in.forget(result);
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953     <span class="keywordflow">return</span> rv;
<a name="l00954"></a>00954 }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00957"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a5f40db21cb429bc789fb9f013e5d2777">00957</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a5f40db21cb429bc789fb9f013e5d2777">NS_NewPartialLocalFileInputStream</a>(<a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a> **result,
<a name="l00958"></a>00958                                   <a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>         *<a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>,
<a name="l00959"></a>00959                                   uint64_t         <a class="code" href="../../da/d32/prio_8h.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a>,
<a name="l00960"></a>00960                                   uint64_t         <a class="code" href="../../d3/d91/j3d_8js.html#a3f87557d7488bfe7545844c394baa854">length</a>,
<a name="l00961"></a>00961                                   int32_t          ioFlags       = -1,
<a name="l00962"></a>00962                                   int32_t          perm          = -1,
<a name="l00963"></a>00963                                   int32_t          behaviorFlags = 0)
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00966"></a>00966     nsCOMPtr&lt;nsIPartialFileInputStream&gt; in =
<a name="l00967"></a>00967         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#ac3c6552453dbcab6372345c87f3846fd">NS_PARTIALLOCALFILEINPUTSTREAM_CONTRACTID</a>, &amp;rv);
<a name="l00968"></a>00968     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00969"></a>00969         rv = in-&gt;Init(file, offset, length, ioFlags, perm, behaviorFlags);
<a name="l00970"></a>00970         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00971"></a>00971             rv = <a class="code" href="../../da/d0a/ns_i_x_p_c_scriptable_8idl.html#aa4f78e380eabb13ae05feb33602d6525">CallQueryInterface</a>(in, result);
<a name="l00972"></a>00972     }
<a name="l00973"></a>00973     <span class="keywordflow">return</span> rv;
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00977"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1f0f9c0d651a1875f7dc8cf428d32579">00977</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1f0f9c0d651a1875f7dc8cf428d32579">NS_NewLocalFileOutputStream</a>(<a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a> **result,
<a name="l00978"></a>00978                             <a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>          *<a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>,
<a name="l00979"></a>00979                             int32_t           ioFlags       = -1,
<a name="l00980"></a>00980                             int32_t           perm          = -1,
<a name="l00981"></a>00981                             int32_t           behaviorFlags = 0)
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l00984"></a>00984     nsCOMPtr&lt;nsIFileOutputStream&gt; <a class="code" href="../../db/da2/namespacejs.html#ae38c69c83e560d6765bddb6b3d53cc46">out</a> =
<a name="l00985"></a>00985         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#ad563de2d2bb8148d83360e56b85d283f">NS_LOCALFILEOUTPUTSTREAM_CONTRACTID</a>, &amp;rv);
<a name="l00986"></a>00986     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l00987"></a>00987         rv = out-&gt;Init(file, ioFlags, perm, behaviorFlags);
<a name="l00988"></a>00988         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l00989"></a>00989             out.forget(result);
<a name="l00990"></a>00990     }
<a name="l00991"></a>00991     <span class="keywordflow">return</span> rv;
<a name="l00992"></a>00992 }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994 <span class="comment">// returns a file output stream which can be QI&#39;ed to nsISafeOutputStream.</span>
<a name="l00995"></a>00995 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l00996"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7ac98ec828cc829a3bfc28173bb20ee4">00996</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7ac98ec828cc829a3bfc28173bb20ee4">NS_NewSafeLocalFileOutputStream</a>(<a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a> **result,
<a name="l00997"></a>00997                                 <a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>          *<a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>,
<a name="l00998"></a>00998                                 int32_t           ioFlags       = -1,
<a name="l00999"></a>00999                                 int32_t           perm          = -1,
<a name="l01000"></a>01000                                 int32_t           behaviorFlags = 0)
<a name="l01001"></a>01001 {
<a name="l01002"></a>01002     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01003"></a>01003     nsCOMPtr&lt;nsIFileOutputStream&gt; <a class="code" href="../../db/da2/namespacejs.html#ae38c69c83e560d6765bddb6b3d53cc46">out</a> =
<a name="l01004"></a>01004         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#adf0cfc6edcd187b181987b298b9426a9">NS_SAFELOCALFILEOUTPUTSTREAM_CONTRACTID</a>, &amp;rv);
<a name="l01005"></a>01005     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01006"></a>01006         rv = out-&gt;Init(file, ioFlags, perm, behaviorFlags);
<a name="l01007"></a>01007         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l01008"></a>01008             out.forget(result);
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010     <span class="keywordflow">return</span> rv;
<a name="l01011"></a>01011 }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01014"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7cfdc6e3168fb35edfc1f72b98cd3998">01014</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a7cfdc6e3168fb35edfc1f72b98cd3998">NS_NewLocalFileStream</a>(<a class="code" href="../../d9/d62/interfacens_i_file_stream.html">nsIFileStream</a> **result,
<a name="l01015"></a>01015                       <a class="code" href="../../d0/d3e/interfacens_i_file.html">nsIFile</a>        *<a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>,
<a name="l01016"></a>01016                       int32_t         ioFlags       = -1,
<a name="l01017"></a>01017                       int32_t         perm          = -1,
<a name="l01018"></a>01018                       int32_t         behaviorFlags = 0)
<a name="l01019"></a>01019 {
<a name="l01020"></a>01020     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01021"></a>01021     nsCOMPtr&lt;nsIFileStream&gt; stream =
<a name="l01022"></a>01022         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a435c2b59a8ecc358656622ca61920274">NS_LOCALFILESTREAM_CONTRACTID</a>, &amp;rv);
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01024"></a>01024         rv = stream-&gt;Init(file, ioFlags, perm, behaviorFlags);
<a name="l01025"></a>01025         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l01026"></a>01026             stream.forget(result);
<a name="l01027"></a>01027     }
<a name="l01028"></a>01028     <span class="keywordflow">return</span> rv;
<a name="l01029"></a>01029 }
<a name="l01030"></a>01030 
<a name="l01031"></a>01031 <span class="comment">// returns the input end of a pipe.  the output end of the pipe</span>
<a name="l01032"></a>01032 <span class="comment">// is attached to the original stream.  data from the original</span>
<a name="l01033"></a>01033 <span class="comment">// stream is read into the pipe on a background thread.</span>
<a name="l01034"></a>01034 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01035"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a53b3875252c52701a35c7387f7b10f72">01035</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a53b3875252c52701a35c7387f7b10f72">NS_BackgroundInputStream</a>(<a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a> **result,
<a name="l01036"></a>01036                          <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>  *stream,
<a name="l01037"></a>01037                          uint32_t         segmentSize  = 0,
<a name="l01038"></a>01038                          uint32_t         segmentCount = 0)
<a name="l01039"></a>01039 {
<a name="l01040"></a>01040     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01041"></a>01041     nsCOMPtr&lt;nsIStreamTransportService&gt; sts =
<a name="l01042"></a>01042         <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#accdd98d11c88bd85482990084dfc43fa">NS_STREAMTRANSPORTSERVICE_CONTRACTID</a>, &amp;rv);
<a name="l01043"></a>01043     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01044"></a>01044         nsCOMPtr&lt;nsITransport&gt; inTransport;
<a name="l01045"></a>01045         rv = sts-&gt;CreateInputTransport(stream, int64_t(-1), int64_t(-1),
<a name="l01046"></a>01046                                        <span class="keyword">true</span>, <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(inTransport));
<a name="l01047"></a>01047         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l01048"></a>01048             rv = inTransport-&gt;OpenInputStream(<a class="code" href="../../d9/d9b/interfacens_i_transport.html#ae791154b4b35d9c66bf7987a8a7314e3">nsITransport::OPEN_BLOCKING</a>,
<a name="l01049"></a>01049                                               segmentSize, segmentCount,
<a name="l01050"></a>01050                                               result);
<a name="l01051"></a>01051     }
<a name="l01052"></a>01052     <span class="keywordflow">return</span> rv;
<a name="l01053"></a>01053 }
<a name="l01054"></a>01054 
<a name="l01055"></a>01055 <span class="comment">// returns the output end of a pipe.  the input end of the pipe</span>
<a name="l01056"></a>01056 <span class="comment">// is attached to the original stream.  data written to the pipe</span>
<a name="l01057"></a>01057 <span class="comment">// is copied to the original stream on a background thread.</span>
<a name="l01058"></a>01058 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01059"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa6be74547cf3e51620c7d04f3832d058">01059</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa6be74547cf3e51620c7d04f3832d058">NS_BackgroundOutputStream</a>(<a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a> **result,
<a name="l01060"></a>01060                           <a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a>  *stream,
<a name="l01061"></a>01061                           uint32_t          segmentSize  = 0,
<a name="l01062"></a>01062                           uint32_t          segmentCount = 0)
<a name="l01063"></a>01063 {
<a name="l01064"></a>01064     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01065"></a>01065     nsCOMPtr&lt;nsIStreamTransportService&gt; sts =
<a name="l01066"></a>01066         <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#accdd98d11c88bd85482990084dfc43fa">NS_STREAMTRANSPORTSERVICE_CONTRACTID</a>, &amp;rv);
<a name="l01067"></a>01067     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01068"></a>01068         nsCOMPtr&lt;nsITransport&gt; inTransport;
<a name="l01069"></a>01069         rv = sts-&gt;CreateOutputTransport(stream, int64_t(-1), int64_t(-1),
<a name="l01070"></a>01070                                         <span class="keyword">true</span>, <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(inTransport));
<a name="l01071"></a>01071         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l01072"></a>01072             rv = inTransport-&gt;OpenOutputStream(<a class="code" href="../../d9/d9b/interfacens_i_transport.html#ae791154b4b35d9c66bf7987a8a7314e3">nsITransport::OPEN_BLOCKING</a>,
<a name="l01073"></a>01073                                                segmentSize, segmentCount,
<a name="l01074"></a>01074                                                result);
<a name="l01075"></a>01075     }
<a name="l01076"></a>01076     <span class="keywordflow">return</span> rv;
<a name="l01077"></a>01077 }
<a name="l01078"></a>01078 
<a name="l01079"></a>01079 MOZ_WARN_UNUSED_RESULT <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01080"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#acc12db04d8775bbdfad8243a17b23872">01080</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#acc12db04d8775bbdfad8243a17b23872">NS_NewBufferedInputStream</a>(<a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a> **result,
<a name="l01081"></a>01081                           <a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>  *<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>,
<a name="l01082"></a>01082                           uint32_t         <a class="code" href="../../d2/d7d/jsapi_8h.html#a73735a9c0baeec37e5199b842e00f99d">bufferSize</a>)
<a name="l01083"></a>01083 {
<a name="l01084"></a>01084     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01085"></a>01085     nsCOMPtr&lt;nsIBufferedInputStream&gt; in =
<a name="l01086"></a>01086         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a02d97d677e10b42f7d3307eded12f33b">NS_BUFFEREDINPUTSTREAM_CONTRACTID</a>, &amp;rv);
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01088"></a>01088         rv = in-&gt;Init(str, bufferSize);
<a name="l01089"></a>01089         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l01090"></a>01090             <a class="code" href="../../d9/d4b/ns_i_supports_utils_8h.html#aa03d5ab87bebd65d9b5539de117f5590">NS_ADDREF</a>(*result = in);  <span class="comment">// cannot use nsCOMPtr::swap</span>
<a name="l01091"></a>01091     }
<a name="l01092"></a>01092     <span class="keywordflow">return</span> rv;
<a name="l01093"></a>01093 }
<a name="l01094"></a>01094 
<a name="l01095"></a>01095 <span class="comment">// note: the resulting stream can be QI&#39;ed to nsISafeOutputStream iff the</span>
<a name="l01096"></a>01096 <span class="comment">// provided stream supports it.</span>
<a name="l01097"></a>01097 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01098"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad56d89f4116632d27e10acf5c21378f5">01098</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad56d89f4116632d27e10acf5c21378f5">NS_NewBufferedOutputStream</a>(<a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a> **result,
<a name="l01099"></a>01099                            <a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a>  *<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>,
<a name="l01100"></a>01100                            uint32_t          <a class="code" href="../../d2/d7d/jsapi_8h.html#a73735a9c0baeec37e5199b842e00f99d">bufferSize</a>)
<a name="l01101"></a>01101 {
<a name="l01102"></a>01102     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01103"></a>01103     nsCOMPtr&lt;nsIBufferedOutputStream&gt; <a class="code" href="../../db/da2/namespacejs.html#ae38c69c83e560d6765bddb6b3d53cc46">out</a> =
<a name="l01104"></a>01104         <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a12b75ba3c3c5c4f73b74ac95505d9f59">NS_BUFFEREDOUTPUTSTREAM_CONTRACTID</a>, &amp;rv);
<a name="l01105"></a>01105     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01106"></a>01106         rv = out-&gt;Init(str, bufferSize);
<a name="l01107"></a>01107         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l01108"></a>01108             <a class="code" href="../../d9/d4b/ns_i_supports_utils_8h.html#aa03d5ab87bebd65d9b5539de117f5590">NS_ADDREF</a>(*result = out);  <span class="comment">// cannot use nsCOMPtr::swap</span>
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110     <span class="keywordflow">return</span> rv;
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 
<a name="l01124"></a>01124 <span class="keyword">inline</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;nsIOutputStream&gt;</a>
<a name="l01125"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ac2aa65a5c969d0e57e8417935fc702df">01125</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ac2aa65a5c969d0e57e8417935fc702df">NS_BufferOutputStream</a>(<a class="code" href="../../db/dd5/interfacens_i_output_stream.html">nsIOutputStream</a> *aOutputStream,
<a name="l01126"></a>01126                       uint32_t aBufferSize)
<a name="l01127"></a>01127 {
<a name="l01128"></a>01128     <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aOutputStream, <span class="stringliteral">&quot;No output stream given!&quot;</span>);
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     nsCOMPtr&lt;nsIOutputStream&gt; bos;
<a name="l01131"></a>01131     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad56d89f4116632d27e10acf5c21378f5">NS_NewBufferedOutputStream</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(bos), aOutputStream,
<a name="l01132"></a>01132                                              aBufferSize);
<a name="l01133"></a>01133     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l01134"></a>01134         <span class="keywordflow">return</span> bos.forget();
<a name="l01135"></a>01135 
<a name="l01136"></a>01136     bos = aOutputStream;
<a name="l01137"></a>01137     <span class="keywordflow">return</span> bos.forget();
<a name="l01138"></a>01138 }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 <span class="comment">// returns an input stream compatible with nsIUploadChannel::SetUploadStream()</span>
<a name="l01141"></a>01141 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01142"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aaed0c38241069d2cba6f8aebdc03c1c2">01142</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aaed0c38241069d2cba6f8aebdc03c1c2">NS_NewPostDataStream</a>(<a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a>  **result,
<a name="l01143"></a>01143                      <span class="keywordtype">bool</span>              isFile,
<a name="l01144"></a>01144                      <span class="keyword">const</span> nsACString &amp;<a class="code" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>)
<a name="l01145"></a>01145 {
<a name="l01146"></a>01146     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="keywordflow">if</span> (isFile) {
<a name="l01149"></a>01149         nsCOMPtr&lt;nsIFile&gt; <a class="code" href="../../db/d2a/_utility_8h.html#a5f21914f6755df23fc8ddbf42503beca">file</a>;
<a name="l01150"></a>01150         nsCOMPtr&lt;nsIInputStream&gt; fileStream;
<a name="l01151"></a>01151 
<a name="l01152"></a>01152         rv = NS_NewNativeLocalFile(data, <span class="keyword">false</span>, <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(file));
<a name="l01153"></a>01153         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01154"></a>01154             rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae9b3b19f3c2b2a1f3160c23fa7e8e557">NS_NewLocalFileInputStream</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(fileStream), file);
<a name="l01155"></a>01155             <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01156"></a>01156                 <span class="comment">// wrap the file stream with a buffered input stream</span>
<a name="l01157"></a>01157                 rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#acc12db04d8775bbdfad8243a17b23872">NS_NewBufferedInputStream</a>(result, fileStream, 8192);
<a name="l01158"></a>01158             }
<a name="l01159"></a>01159         }
<a name="l01160"></a>01160         <span class="keywordflow">return</span> rv;
<a name="l01161"></a>01161     }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163     <span class="comment">// otherwise, create a string stream for the data (copies)</span>
<a name="l01164"></a>01164     nsCOMPtr&lt;nsIStringInputStream&gt; stream
<a name="l01165"></a>01165         (<a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<span class="stringliteral">&quot;@mozilla.org/io/string-input-stream;1&quot;</span>, &amp;rv));
<a name="l01166"></a>01166     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l01167"></a>01167         <span class="keywordflow">return</span> rv;
<a name="l01168"></a>01168 
<a name="l01169"></a>01169     rv = stream-&gt;SetData(data.BeginReading(), data.Length());
<a name="l01170"></a>01170     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l01171"></a>01171         <span class="keywordflow">return</span> rv;
<a name="l01172"></a>01172 
<a name="l01173"></a>01173     <a class="code" href="../../d9/d4b/ns_i_supports_utils_8h.html#aa03d5ab87bebd65d9b5539de117f5590">NS_ADDREF</a>(*result = stream);
<a name="l01174"></a>01174     <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l01175"></a>01175 }
<a name="l01176"></a>01176 
<a name="l01177"></a>01177 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01178"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0a605e45db7861fdb73f5b577ed45da2">01178</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0a605e45db7861fdb73f5b577ed45da2">NS_ReadInputStreamToBuffer</a>(<a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a> *aInputStream, 
<a name="l01179"></a>01179                            <span class="keywordtype">void</span>** aDest,
<a name="l01180"></a>01180                            uint32_t aCount)
<a name="l01181"></a>01181 {
<a name="l01182"></a>01182     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01183"></a>01183 
<a name="l01184"></a>01184     <span class="keywordflow">if</span> (!*aDest) {
<a name="l01185"></a>01185         *aDest = <a class="code" href="../../d1/de4/mozalloc__macro__wrappers_8h.html#a68f164c7f434e3aba70e81776e28376f">malloc</a>(aCount);
<a name="l01186"></a>01186         <span class="keywordflow">if</span> (!*aDest)
<a name="l01187"></a>01187             <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a92ab988083ecf3206773169bf6b11d06">NS_ERROR_OUT_OF_MEMORY</a>;
<a name="l01188"></a>01188     }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <span class="keywordtype">char</span> * <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a> = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(*aDest);
<a name="l01191"></a>01191     uint32_t bytesRead;
<a name="l01192"></a>01192     uint32_t totalRead = 0;
<a name="l01193"></a>01193     <span class="keywordflow">while</span> (1) {
<a name="l01194"></a>01194         rv = aInputStream-&gt;<a class="code" href="../../da/d78/interfacens_i_input_stream.html#ab095c0c9e43eac3dd3eb1f1448078761">Read</a>(p + totalRead, aCount - totalRead, &amp;bytesRead);
<a name="l01195"></a>01195         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) 
<a name="l01196"></a>01196             <span class="keywordflow">return</span> rv;
<a name="l01197"></a>01197         totalRead += bytesRead;
<a name="l01198"></a>01198         <span class="keywordflow">if</span> (totalRead == aCount)
<a name="l01199"></a>01199             <span class="keywordflow">break</span>;
<a name="l01200"></a>01200         <span class="comment">// if Read reads 0 bytes, we&#39;ve hit EOF </span>
<a name="l01201"></a>01201         <span class="keywordflow">if</span> (bytesRead == 0)
<a name="l01202"></a>01202             <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#aee4be918fd92e0bf76a202e0afca46f2">NS_ERROR_UNEXPECTED</a>;
<a name="l01203"></a>01203     }
<a name="l01204"></a>01204     <span class="keywordflow">return</span> rv; 
<a name="l01205"></a>01205 }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207 <span class="comment">// external code can&#39;t see fallible_t</span>
<a name="l01208"></a>01208 <span class="preprocessor">#ifdef MOZILLA_INTERNAL_API</span>
<a name="l01209"></a>01209 <span class="preprocessor"></span>
<a name="l01210"></a>01210 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01211"></a>01211 NS_ReadInputStreamToString(<a class="code" href="../../da/d78/interfacens_i_input_stream.html">nsIInputStream</a> *aInputStream, 
<a name="l01212"></a>01212                            nsACString &amp;aDest,
<a name="l01213"></a>01213                            uint32_t aCount)
<a name="l01214"></a>01214 {
<a name="l01215"></a>01215     <span class="keywordflow">if</span> (!aDest.SetLength(aCount, <a class="code" href="../../dc/d9e/structmozilla_1_1fallible__t.html">mozilla::fallible_t</a>()))
<a name="l01216"></a>01216         <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a92ab988083ecf3206773169bf6b11d06">NS_ERROR_OUT_OF_MEMORY</a>;
<a name="l01217"></a>01217     <span class="keywordtype">void</span>* dest = aDest.BeginWriting();
<a name="l01218"></a>01218     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0a605e45db7861fdb73f5b577ed45da2">NS_ReadInputStreamToBuffer</a>(aInputStream, &amp;dest, aCount);
<a name="l01219"></a>01219 }
<a name="l01220"></a>01220 
<a name="l01221"></a>01221 <span class="preprocessor">#endif</span>
<a name="l01222"></a>01222 <span class="preprocessor"></span>
<a name="l01223"></a>01223 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01224"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a4d31a979fd4a39b760a4cfeb603ab13e">01224</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a4d31a979fd4a39b760a4cfeb603ab13e">NS_LoadPersistentPropertiesFromURI</a>(<a class="code" href="../../d0/d6d/interfacens_i_persistent_properties.html">nsIPersistentProperties</a> **result,
<a name="l01225"></a>01225                                    <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>                   *uri,
<a name="l01226"></a>01226                                    <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>             *ioService = <span class="keyword">nullptr</span>)
<a name="l01227"></a>01227 {
<a name="l01228"></a>01228     nsCOMPtr&lt;nsIInputStream&gt; in;
<a name="l01229"></a>01229     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a893de01dd017920d550efe136db0afd0">NS_OpenURI</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(in), uri, ioService);
<a name="l01230"></a>01230     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01231"></a>01231         nsCOMPtr&lt;nsIPersistentProperties&gt; <a class="code" href="../../d2/dd7/crystalskull_8js.html#a81642397fcb1906e32fc18e50e1c73d2">properties</a> = 
<a name="l01232"></a>01232             <a class="code" href="../../dc/db2/ns_component_manager_utils_8h.html#ac0eafe69a33e24b71c373986f7c449a6">do_CreateInstance</a>(<a class="code" href="../../d1/dd0/ns_i_persistent_properties2_8idl.html#aaf01eba292c25dbdff2cb2b87343c7f8">NS_PERSISTENTPROPERTIES_CONTRACTID</a>, &amp;rv);
<a name="l01233"></a>01233         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01234"></a>01234             rv = properties-&gt;Load(in);
<a name="l01235"></a>01235             <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01236"></a>01236                 *result = <span class="keyword">nullptr</span>;
<a name="l01237"></a>01237                 properties.swap(*result);
<a name="l01238"></a>01238             }
<a name="l01239"></a>01239         }
<a name="l01240"></a>01240     }
<a name="l01241"></a>01241     <span class="keywordflow">return</span> rv;
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01245"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ac4e2b4de052bf844c60ec5e27c457f79">01245</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ac4e2b4de052bf844c60ec5e27c457f79">NS_LoadPersistentPropertiesFromURISpec</a>(<a class="code" href="../../d0/d6d/interfacens_i_persistent_properties.html">nsIPersistentProperties</a> **result,
<a name="l01246"></a>01246                                        <span class="keyword">const</span> nsACString        &amp;spec,
<a name="l01247"></a>01247                                        <span class="keyword">const</span> <span class="keywordtype">char</span>              *<a class="code" href="../../db/d6b/make__gaia__shared_8js.html#a336889a89adb268f4371b970141c0bb7">charset</a> = <span class="keyword">nullptr</span>,
<a name="l01248"></a>01248                                        <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>                  *baseURI = <span class="keyword">nullptr</span>,
<a name="l01249"></a>01249                                        <a class="code" href="../../db/df1/interfacens_i_i_o_service.html">nsIIOService</a>            *ioService = <span class="keyword">nullptr</span>)     
<a name="l01250"></a>01250 {
<a name="l01251"></a>01251     nsCOMPtr&lt;nsIURI&gt; <a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>;
<a name="l01252"></a>01252     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = 
<a name="l01253"></a>01253         <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a29e53f80743f9d78ab7db1b457d68f23">NS_NewURI</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(uri), spec, <a class="code" href="../../db/d6b/make__gaia__shared_8js.html#a336889a89adb268f4371b970141c0bb7">charset</a>, baseURI, ioService);
<a name="l01254"></a>01254 
<a name="l01255"></a>01255     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv))
<a name="l01256"></a>01256         rv = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a4d31a979fd4a39b760a4cfeb603ab13e">NS_LoadPersistentPropertiesFromURI</a>(result, uri, ioService);
<a name="l01257"></a>01257 
<a name="l01258"></a>01258     <span class="keywordflow">return</span> rv;
<a name="l01259"></a>01259 }
<a name="l01260"></a>01260 
<a name="l01271"></a>01271 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01272"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">01272</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(T            *channel,
<a name="l01273"></a>01273                               <span class="keyword">const</span> <a class="code" href="../../d4/d3d/structns_i_d.html">nsIID</a>  &amp;<a class="code" href="../../de/d81/xpt__struct_8h.html#a17e977c639876eb577a75d2596797bd4">iid</a>,
<a name="l01274"></a>01274                               <span class="keywordtype">void</span>        **result)
<a name="l01275"></a>01275 {
<a name="l01276"></a>01276     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(channel, <span class="stringliteral">&quot;null channel&quot;</span>);
<a name="l01277"></a>01277     *result = <span class="keyword">nullptr</span>;
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     nsCOMPtr&lt;nsIInterfaceRequestor&gt; cbs;
<a name="l01280"></a>01280     channel-&gt;GetNotificationCallbacks(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(cbs));
<a name="l01281"></a>01281     <span class="keywordflow">if</span> (cbs)
<a name="l01282"></a>01282         cbs-&gt;GetInterface(iid, result);
<a name="l01283"></a>01283     <span class="keywordflow">if</span> (!*result) {
<a name="l01284"></a>01284         <span class="comment">// try load group&#39;s notification callbacks...</span>
<a name="l01285"></a>01285         nsCOMPtr&lt;nsILoadGroup&gt; loadGroup;
<a name="l01286"></a>01286         channel-&gt;GetLoadGroup(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(loadGroup));
<a name="l01287"></a>01287         <span class="keywordflow">if</span> (loadGroup) {
<a name="l01288"></a>01288             loadGroup-&gt;GetNotificationCallbacks(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(cbs));
<a name="l01289"></a>01289             <span class="keywordflow">if</span> (cbs)
<a name="l01290"></a>01290                 cbs-&gt;GetInterface(iid, result);
<a name="l01291"></a>01291         }
<a name="l01292"></a>01292     }
<a name="l01293"></a>01293 }
<a name="l01294"></a>01294 
<a name="l01295"></a>01295 <span class="comment">// template helper:</span>
<a name="l01296"></a>01296 <span class="comment">// Note: &quot;class C&quot; templatized only because nsIWebSocketChannel is currently not</span>
<a name="l01297"></a>01297 <span class="comment">// an nsIChannel.</span>
<a name="l01298"></a>01298 
<a name="l01299"></a>01299 <span class="keyword">template</span> &lt;<span class="keyword">class</span> C, <span class="keyword">class</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01300"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a9bf177169041ba6a375200dcb624a4d9">01300</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(C           *channel,
<a name="l01301"></a>01301                               nsCOMPtr&lt;T&gt; &amp;result)
<a name="l01302"></a>01302 {
<a name="l01303"></a>01303     <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(channel, <a class="code" href="../../d9/d0a/ns_i_d_8h.html#a6e6aa0f05621ba2cdd2f5fa8825a15b7">NS_GET_TEMPLATE_IID</a>(T),
<a name="l01304"></a>01304                                   <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(result));
<a name="l01305"></a>01305 }
<a name="l01306"></a>01306 
<a name="l01311"></a>01311 <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01312"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a2b7c7a3c8163dca9666c454e34479f8d">01312</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(<a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a>  *<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>,
<a name="l01313"></a>01313                               <a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>           *loadGroup,
<a name="l01314"></a>01314                               <span class="keyword">const</span> <a class="code" href="../../d4/d3d/structns_i_d.html">nsIID</a>            &amp;<a class="code" href="../../de/d81/xpt__struct_8h.html#a17e977c639876eb577a75d2596797bd4">iid</a>,
<a name="l01315"></a>01315                               <span class="keywordtype">void</span>                  **result)
<a name="l01316"></a>01316 {
<a name="l01317"></a>01317     *result = <span class="keyword">nullptr</span>;
<a name="l01318"></a>01318 
<a name="l01319"></a>01319     <span class="keywordflow">if</span> (callbacks)
<a name="l01320"></a>01320         callbacks-&gt;<a class="code" href="../../df/de7/interfacens_i_interface_requestor.html#a61cd07556fb83bb487574274be5dd9c1">GetInterface</a>(iid, result);
<a name="l01321"></a>01321     <span class="keywordflow">if</span> (!*result) {
<a name="l01322"></a>01322         <span class="comment">// try load group&#39;s notification callbacks...</span>
<a name="l01323"></a>01323         <span class="keywordflow">if</span> (loadGroup) {
<a name="l01324"></a>01324             nsCOMPtr&lt;nsIInterfaceRequestor&gt; cbs;
<a name="l01325"></a>01325             loadGroup-&gt;<a class="code" href="../../da/d0e/interfacens_i_load_group.html#ab14108a3d1e8a7c670036b2d59cbf3f5">GetNotificationCallbacks</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(cbs));
<a name="l01326"></a>01326             <span class="keywordflow">if</span> (cbs)
<a name="l01327"></a>01327                 cbs-&gt;GetInterface(iid, result);
<a name="l01328"></a>01328         }
<a name="l01329"></a>01329     }
<a name="l01330"></a>01330 }
<a name="l01331"></a>01331 
<a name="l01336"></a>01336 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01337"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a120c664ca725cf664b610ef6ff4c5bb1">01337</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a120c664ca725cf664b610ef6ff4c5bb1">NS_UsePrivateBrowsing</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a> *channel)
<a name="l01338"></a>01338 {
<a name="l01339"></a>01339     <span class="keywordtype">bool</span> isPrivate = <span class="keyword">false</span>;
<a name="l01340"></a>01340     <span class="keywordtype">bool</span> isOverriden = <span class="keyword">false</span>;
<a name="l01341"></a>01341     nsCOMPtr&lt;nsIPrivateBrowsingChannel&gt; pbChannel = <a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(channel);
<a name="l01342"></a>01342     <span class="keywordflow">if</span> (pbChannel &amp;&amp;
<a name="l01343"></a>01343         <a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(pbChannel-&gt;IsPrivateModeOverriden(&amp;isPrivate, &amp;isOverriden)) &amp;&amp;
<a name="l01344"></a>01344         isOverriden) {
<a name="l01345"></a>01345         <span class="keywordflow">return</span> isPrivate;
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347     nsCOMPtr&lt;nsILoadContext&gt; loadContext;
<a name="l01348"></a>01348     <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(channel, loadContext);
<a name="l01349"></a>01349     <span class="keywordflow">return</span> loadContext &amp;&amp; loadContext-&gt;UsePrivateBrowsing();
<a name="l01350"></a>01350 }
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 <span class="comment">// Constants duplicated from nsIScriptSecurityManager so we avoid having necko</span>
<a name="l01353"></a>01353 <span class="comment">// know about script security manager.</span>
<a name="l01354"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aa749f5456dcf73799cef6f197c766ea1">01354</a> <span class="preprocessor">#define NECKO_NO_APP_ID 0</span>
<a name="l01355"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a6f2a20fea51c14a9fb5c54f1f58ae388">01355</a> <span class="preprocessor"></span><span class="preprocessor">#define NECKO_UNKNOWN_APP_ID UINT32_MAX</span>
<a name="l01356"></a>01356 <span class="preprocessor"></span>
<a name="l01361"></a>01361 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01362"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a46748107e14dbd68903e2e12a4416714">01362</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a46748107e14dbd68903e2e12a4416714">NS_GetAppInfo</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a> *aChannel, uint32_t *aAppID, <span class="keywordtype">bool</span> *aIsInBrowserElement)
<a name="l01363"></a>01363 {
<a name="l01364"></a>01364     nsCOMPtr&lt;nsILoadContext&gt; loadContext;
<a name="l01365"></a>01365     <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(aChannel, loadContext);
<a name="l01366"></a>01366     <span class="keywordflow">if</span> (!loadContext) {
<a name="l01367"></a>01367         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01368"></a>01368     }
<a name="l01369"></a>01369 
<a name="l01370"></a>01370     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = loadContext-&gt;GetAppId(aAppID);
<a name="l01371"></a>01371     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, <span class="keyword">false</span>);
<a name="l01372"></a>01372 
<a name="l01373"></a>01373     rv = loadContext-&gt;GetIsInBrowserElement(aIsInBrowserElement);
<a name="l01374"></a>01374     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, <span class="keyword">false</span>);
<a name="l01375"></a>01375 
<a name="l01376"></a>01376     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 
<a name="l01384"></a>01384 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01385"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#acf27506dde3285c04dd4295aa1960030">01385</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#acf27506dde3285c04dd4295aa1960030">NS_GetAppInfoFromClearDataNotification</a>(<a class="code" href="../../d4/d6a/classns_i_supports.html">nsISupports</a> *aSubject,
<a name="l01386"></a>01386                                        uint32_t *aAppID, <span class="keywordtype">bool</span>* aBrowserOnly)
<a name="l01387"></a>01387 {
<a name="l01388"></a>01388     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01389"></a>01389 
<a name="l01390"></a>01390     nsCOMPtr&lt;mozIApplicationClearPrivateDataParams&gt;
<a name="l01391"></a>01391         clearParams(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(aSubject));
<a name="l01392"></a>01392     <a class="code" href="../../d9/de9/_assertions_8h.html#aa2fa77a048d036cb2f902299ace18165">MOZ_ASSERT</a>(clearParams);
<a name="l01393"></a>01393     <span class="keywordflow">if</span> (!clearParams) {
<a name="l01394"></a>01394         <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#aee4be918fd92e0bf76a202e0afca46f2">NS_ERROR_UNEXPECTED</a>;
<a name="l01395"></a>01395     }
<a name="l01396"></a>01396 
<a name="l01397"></a>01397     uint32_t appId;
<a name="l01398"></a>01398     rv = clearParams-&gt;GetAppId(&amp;appId);
<a name="l01399"></a>01399     <a class="code" href="../../d9/de9/_assertions_8h.html#aa2fa77a048d036cb2f902299ace18165">MOZ_ASSERT</a>(<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv));
<a name="l01400"></a>01400     <a class="code" href="../../d9/de9/_assertions_8h.html#aa2fa77a048d036cb2f902299ace18165">MOZ_ASSERT</a>(appId != <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a6f2a20fea51c14a9fb5c54f1f58ae388">NECKO_UNKNOWN_APP_ID</a>);
<a name="l01401"></a>01401     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l01402"></a>01402     <span class="keywordflow">if</span> (appId == <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a6f2a20fea51c14a9fb5c54f1f58ae388">NECKO_UNKNOWN_APP_ID</a>) {
<a name="l01403"></a>01403         <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#aee4be918fd92e0bf76a202e0afca46f2">NS_ERROR_UNEXPECTED</a>;
<a name="l01404"></a>01404     }
<a name="l01405"></a>01405 
<a name="l01406"></a>01406     <span class="keywordtype">bool</span> browserOnly = <span class="keyword">false</span>;
<a name="l01407"></a>01407     rv = clearParams-&gt;GetBrowserOnly(&amp;browserOnly);
<a name="l01408"></a>01408     <a class="code" href="../../d9/de9/_assertions_8h.html#aa2fa77a048d036cb2f902299ace18165">MOZ_ASSERT</a>(<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv));
<a name="l01409"></a>01409     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l01410"></a>01410 
<a name="l01411"></a>01411     *aAppID = appId;
<a name="l01412"></a>01412     *aBrowserOnly = browserOnly;
<a name="l01413"></a>01413     <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l01414"></a>01414 }
<a name="l01415"></a>01415 
<a name="l01419"></a>01419 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01420"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a06419e067bab34382808c3f1744a869a">01420</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a06419e067bab34382808c3f1744a869a">NS_ShouldCheckAppCache</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> *aURI, <span class="keywordtype">bool</span> usePrivateBrowsing)
<a name="l01421"></a>01421 {
<a name="l01422"></a>01422     <span class="keywordflow">if</span> (usePrivateBrowsing) {
<a name="l01423"></a>01423         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01424"></a>01424     }
<a name="l01425"></a>01425 
<a name="l01426"></a>01426     nsCOMPtr&lt;nsIOfflineCacheUpdateService&gt; offlineService =
<a name="l01427"></a>01427         <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<span class="stringliteral">&quot;@mozilla.org/offlinecacheupdate-service;1&quot;</span>);
<a name="l01428"></a>01428     <span class="keywordflow">if</span> (!offlineService) {
<a name="l01429"></a>01429         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01430"></a>01430     }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432     <span class="keywordtype">bool</span> allowed;
<a name="l01433"></a>01433     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = offlineService-&gt;OfflineAppAllowedForURI(aURI,
<a name="l01434"></a>01434                                                           <span class="keyword">nullptr</span>,
<a name="l01435"></a>01435                                                           &amp;allowed);
<a name="l01436"></a>01436     <span class="keywordflow">return</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; allowed;
<a name="l01437"></a>01437 }
<a name="l01438"></a>01438 
<a name="l01445"></a>01445 <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01446"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a9d71d6567bd5ed1f6646885ab03104b5">01446</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a9d71d6567bd5ed1f6646885ab03104b5">NS_WrapAuthPrompt</a>(<a class="code" href="../../db/d67/interfacens_i_auth_prompt.html">nsIAuthPrompt</a> *aAuthPrompt, <a class="code" href="../../df/db8/interfacens_i_auth_prompt2.html">nsIAuthPrompt2</a>** aAuthPrompt2)
<a name="l01447"></a>01447 {
<a name="l01448"></a>01448     nsCOMPtr&lt;nsIAuthPromptAdapterFactory&gt; factory =
<a name="l01449"></a>01449         <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a95f4657fb403233529bbcbc3d4e12996">NS_AUTHPROMPT_ADAPTER_FACTORY_CONTRACTID</a>);
<a name="l01450"></a>01450     <span class="keywordflow">if</span> (!factory)
<a name="l01451"></a>01451         <span class="keywordflow">return</span>;
<a name="l01452"></a>01452 
<a name="l01453"></a>01453     <a class="code" href="../../dc/d6d/ns_debug_8h.html#aa7f3deb23fbcb284ef465fd28ccaaa35">NS_WARNING</a>(<span class="stringliteral">&quot;Using deprecated nsIAuthPrompt&quot;</span>);
<a name="l01454"></a>01454     factory-&gt;CreateAdapter(aAuthPrompt, aAuthPrompt2);
<a name="l01455"></a>01455 }
<a name="l01456"></a>01456 
<a name="l01461"></a>01461 <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01462"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aea4d73be216b002e40efc5ed0e641f7c">01462</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aea4d73be216b002e40efc5ed0e641f7c">NS_QueryAuthPrompt2</a>(<a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a>  *aCallbacks,
<a name="l01463"></a>01463                     <a class="code" href="../../df/db8/interfacens_i_auth_prompt2.html">nsIAuthPrompt2</a>        **aAuthPrompt)
<a name="l01464"></a>01464 {
<a name="l01465"></a>01465     <a class="code" href="../../d4/d59/ns_i_interface_requestor_utils_8h.html#aa6e041f962434f7f53753d4515e297aa">CallGetInterface</a>(aCallbacks, aAuthPrompt);
<a name="l01466"></a>01466     <span class="keywordflow">if</span> (*aAuthPrompt)
<a name="l01467"></a>01467         <span class="keywordflow">return</span>;
<a name="l01468"></a>01468 
<a name="l01469"></a>01469     <span class="comment">// Maybe only nsIAuthPrompt is provided and we have to wrap it.</span>
<a name="l01470"></a>01470     nsCOMPtr&lt;nsIAuthPrompt&gt; prompt(<a class="code" href="../../d4/d59/ns_i_interface_requestor_utils_8h.html#a971297c0a2ae6c05769c0d453ef38bc5">do_GetInterface</a>(aCallbacks));
<a name="l01471"></a>01471     <span class="keywordflow">if</span> (!prompt)
<a name="l01472"></a>01472         <span class="keywordflow">return</span>;
<a name="l01473"></a>01473 
<a name="l01474"></a>01474     <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a9d71d6567bd5ed1f6646885ab03104b5">NS_WrapAuthPrompt</a>(prompt, aAuthPrompt);
<a name="l01475"></a>01475 }
<a name="l01476"></a>01476 
<a name="l01481"></a>01481 <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01482"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad4a2a12d18b8f81a723cd027a512f643">01482</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aea4d73be216b002e40efc5ed0e641f7c">NS_QueryAuthPrompt2</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>      *aChannel,
<a name="l01483"></a>01483                     <a class="code" href="../../df/db8/interfacens_i_auth_prompt2.html">nsIAuthPrompt2</a> **aAuthPrompt)
<a name="l01484"></a>01484 {
<a name="l01485"></a>01485     *aAuthPrompt = <span class="keyword">nullptr</span>;
<a name="l01486"></a>01486 
<a name="l01487"></a>01487     <span class="comment">// We want to use any auth prompt we can find on the channel&#39;s callbacks,</span>
<a name="l01488"></a>01488     <span class="comment">// and if that fails use the loadgroup&#39;s prompt (if any)</span>
<a name="l01489"></a>01489     <span class="comment">// Therefore, we can&#39;t just use NS_QueryNotificationCallbacks, because</span>
<a name="l01490"></a>01490     <span class="comment">// that would prefer a loadgroup&#39;s nsIAuthPrompt2 over a channel&#39;s</span>
<a name="l01491"></a>01491     <span class="comment">// nsIAuthPrompt.</span>
<a name="l01492"></a>01492     nsCOMPtr&lt;nsIInterfaceRequestor&gt; <a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>;
<a name="l01493"></a>01493     aChannel-&gt;<a class="code" href="../../d1/d2d/interfacens_i_channel.html#aa26f8b0c8ea05ae598dc2e3b18e028b5">GetNotificationCallbacks</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(callbacks));
<a name="l01494"></a>01494     <span class="keywordflow">if</span> (callbacks) {
<a name="l01495"></a>01495         <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aea4d73be216b002e40efc5ed0e641f7c">NS_QueryAuthPrompt2</a>(callbacks, aAuthPrompt);
<a name="l01496"></a>01496         <span class="keywordflow">if</span> (*aAuthPrompt)
<a name="l01497"></a>01497             <span class="keywordflow">return</span>;
<a name="l01498"></a>01498     }
<a name="l01499"></a>01499 
<a name="l01500"></a>01500     nsCOMPtr&lt;nsILoadGroup&gt; group;
<a name="l01501"></a>01501     aChannel-&gt;<a class="code" href="../../d8/d9e/interfacens_i_request.html#a1d08e8925f6f6c305615f817868fdc57">GetLoadGroup</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(group));
<a name="l01502"></a>01502     <span class="keywordflow">if</span> (!group)
<a name="l01503"></a>01503         <span class="keywordflow">return</span>;
<a name="l01504"></a>01504 
<a name="l01505"></a>01505     group-&gt;GetNotificationCallbacks(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(callbacks));
<a name="l01506"></a>01506     <span class="keywordflow">if</span> (!callbacks)
<a name="l01507"></a>01507         <span class="keywordflow">return</span>;
<a name="l01508"></a>01508     <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aea4d73be216b002e40efc5ed0e641f7c">NS_QueryAuthPrompt2</a>(callbacks, aAuthPrompt);
<a name="l01509"></a>01509 }
<a name="l01510"></a>01510 
<a name="l01511"></a>01511 <span class="comment">/* template helper */</span>
<a name="l01512"></a>01512 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01513"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#afb7f178a0f95e923506363344c719656">01513</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(<a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a> *<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>,
<a name="l01514"></a>01514                               <a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>          *loadGroup,
<a name="l01515"></a>01515                               nsCOMPtr&lt;T&gt;           &amp;result)
<a name="l01516"></a>01516 {
<a name="l01517"></a>01517     <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(callbacks, loadGroup,
<a name="l01518"></a>01518                                   <a class="code" href="../../d9/d0a/ns_i_d_8h.html#a6e6aa0f05621ba2cdd2f5fa8825a15b7">NS_GET_TEMPLATE_IID</a>(T),
<a name="l01519"></a>01519                                   <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(result));
<a name="l01520"></a>01520 }
<a name="l01521"></a>01521 
<a name="l01522"></a>01522 <span class="comment">/* template helper */</span>
<a name="l01523"></a>01523 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01524"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ac7af5ebae89ad14f29a881a8c04bde34">01524</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(<span class="keyword">const</span> nsCOMPtr&lt;nsIInterfaceRequestor&gt; &amp;aCallbacks,
<a name="l01525"></a>01525                               <span class="keyword">const</span> nsCOMPtr&lt;nsILoadGroup&gt;          &amp;aLoadGroup,
<a name="l01526"></a>01526                               nsCOMPtr&lt;T&gt;                           &amp;<a class="code" href="../../d9/d6a/ns_color_8h.html#a820357f645d7b0eaf62fd4994dda5a24">aResult</a>)
<a name="l01527"></a>01527 {
<a name="l01528"></a>01528     <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(aCallbacks.get(), aLoadGroup.get(), <a class="code" href="../../d9/d6a/ns_color_8h.html#a820357f645d7b0eaf62fd4994dda5a24">aResult</a>);
<a name="l01529"></a>01529 }
<a name="l01530"></a>01530 
<a name="l01531"></a>01531 <span class="comment">/* template helper */</span>
<a name="l01532"></a>01532 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01533"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a20063029ba02a1d1989fda521bb8260d">01533</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(<span class="keyword">const</span> nsCOMPtr&lt;nsIChannel&gt; &amp;aChannel,
<a name="l01534"></a>01534                               nsCOMPtr&lt;T&gt;                &amp;<a class="code" href="../../d9/d6a/ns_color_8h.html#a820357f645d7b0eaf62fd4994dda5a24">aResult</a>)
<a name="l01535"></a>01535 {
<a name="l01536"></a>01536     <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a83515d9585c8a0a7809c2f1faedffb40">NS_QueryNotificationCallbacks</a>(aChannel.get(), <a class="code" href="../../d9/d6a/ns_color_8h.html#a820357f645d7b0eaf62fd4994dda5a24">aResult</a>);
<a name="l01537"></a>01537 }
<a name="l01538"></a>01538 
<a name="l01544"></a>01544 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01545"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a8fd2db24f60e669d70947c7bdc9ff1fb">01545</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a8fd2db24f60e669d70947c7bdc9ff1fb">NS_NewNotificationCallbacksAggregation</a>(<a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a>  *<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>,
<a name="l01546"></a>01546                                        <a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>           *loadGroup,
<a name="l01547"></a>01547                                        <a class="code" href="../../d0/da2/interfacens_i_event_target.html">nsIEventTarget</a>         *<a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>,
<a name="l01548"></a>01548                                        <a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a> **result)
<a name="l01549"></a>01549 {
<a name="l01550"></a>01550     nsCOMPtr&lt;nsIInterfaceRequestor&gt; cbs;
<a name="l01551"></a>01551     <span class="keywordflow">if</span> (loadGroup)
<a name="l01552"></a>01552         loadGroup-&gt;<a class="code" href="../../da/d0e/interfacens_i_load_group.html#ab14108a3d1e8a7c670036b2d59cbf3f5">GetNotificationCallbacks</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(cbs));
<a name="l01553"></a>01553     <span class="keywordflow">return</span> <a class="code" href="../../df/d1d/ns_interface_requestor_agg_8h.html#a72468ab86883ceab41d8fb592a46bc9f">NS_NewInterfaceRequestorAggregation</a>(callbacks, cbs, target, result);
<a name="l01554"></a>01554 }
<a name="l01555"></a>01555 
<a name="l01556"></a>01556 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01557"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aac615196c21fb8a3c6815959d908b6c6">01557</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a8fd2db24f60e669d70947c7bdc9ff1fb">NS_NewNotificationCallbacksAggregation</a>(<a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a>  *<a class="code" href="../../d2/d7d/jsapi_8h.html#a25a0884792aa259d1818e7f66ffa3937">callbacks</a>,
<a name="l01558"></a>01558                                        <a class="code" href="../../da/d0e/interfacens_i_load_group.html">nsILoadGroup</a>           *loadGroup,
<a name="l01559"></a>01559                                        <a class="code" href="../../df/de7/interfacens_i_interface_requestor.html">nsIInterfaceRequestor</a> **result)
<a name="l01560"></a>01560 {
<a name="l01561"></a>01561     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a8fd2db24f60e669d70947c7bdc9ff1fb">NS_NewNotificationCallbacksAggregation</a>(callbacks, loadGroup, <span class="keyword">nullptr</span>, result);
<a name="l01562"></a>01562 }
<a name="l01563"></a>01563 
<a name="l01567"></a>01567 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01568"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a44e6841495407f205498462735fab2bf">01568</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a44e6841495407f205498462735fab2bf">NS_IsOffline</a>()
<a name="l01569"></a>01569 {
<a name="l01570"></a>01570     <span class="keywordtype">bool</span> offline = <span class="keyword">true</span>;
<a name="l01571"></a>01571     nsCOMPtr&lt;nsIIOService&gt; ios = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0add396a07df9701587b1c3ce42f4012">do_GetIOService</a>();
<a name="l01572"></a>01572     <span class="keywordflow">if</span> (ios)
<a name="l01573"></a>01573         ios-&gt;GetOffline(&amp;offline);
<a name="l01574"></a>01574     <span class="keywordflow">return</span> offline;
<a name="l01575"></a>01575 }
<a name="l01576"></a>01576 
<a name="l01583"></a>01583 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01584"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae1729eff1022d878793b6168e661a0a4">01584</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae1729eff1022d878793b6168e661a0a4">NS_DoImplGetInnermostURI</a>(<a class="code" href="../../d8/d7e/interfacens_i_nested_u_r_i.html">nsINestedURI</a>* nestedURI, <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>** result)
<a name="l01585"></a>01585 {
<a name="l01586"></a>01586     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(nestedURI, <span class="stringliteral">&quot;Must have a nested URI!&quot;</span>);
<a name="l01587"></a>01587     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(!*result, <span class="stringliteral">&quot;Must have null *result&quot;</span>);
<a name="l01588"></a>01588     
<a name="l01589"></a>01589     nsCOMPtr&lt;nsIURI&gt; inner;
<a name="l01590"></a>01590     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = nestedURI-&gt;<a class="code" href="../../d8/d7e/interfacens_i_nested_u_r_i.html#a919db0c0aef03dd12e8b11683516a838">GetInnerURI</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(inner));
<a name="l01591"></a>01591     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l01592"></a>01592 
<a name="l01593"></a>01593     <span class="comment">// We may need to loop here until we reach the innermost</span>
<a name="l01594"></a>01594     <span class="comment">// URI.</span>
<a name="l01595"></a>01595     nsCOMPtr&lt;nsINestedURI&gt; nestedInner(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(inner));
<a name="l01596"></a>01596     <span class="keywordflow">while</span> (nestedInner) {
<a name="l01597"></a>01597         rv = nestedInner-&gt;GetInnerURI(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(inner));
<a name="l01598"></a>01598         <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l01599"></a>01599         nestedInner = <a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(inner);
<a name="l01600"></a>01600     }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602     <span class="comment">// Found the innermost one if we reach here.</span>
<a name="l01603"></a>01603     inner.swap(*result);
<a name="l01604"></a>01604 
<a name="l01605"></a>01605     <span class="keywordflow">return</span> rv;
<a name="l01606"></a>01606 }
<a name="l01607"></a>01607 
<a name="l01608"></a>01608 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01609"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a052474bfcf5c8b35ba8efff8daef350a">01609</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a052474bfcf5c8b35ba8efff8daef350a">NS_ImplGetInnermostURI</a>(<a class="code" href="../../d8/d7e/interfacens_i_nested_u_r_i.html">nsINestedURI</a>* nestedURI, <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>** result)
<a name="l01610"></a>01610 {
<a name="l01611"></a>01611     <span class="comment">// Make it safe to use swap()</span>
<a name="l01612"></a>01612     *result = <span class="keyword">nullptr</span>;
<a name="l01613"></a>01613 
<a name="l01614"></a>01614     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ae1729eff1022d878793b6168e661a0a4">NS_DoImplGetInnermostURI</a>(nestedURI, result);
<a name="l01615"></a>01615 }
<a name="l01616"></a>01616 
<a name="l01622"></a>01622 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01623"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a423dad69698578d8f7021d1d70454939">01623</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a423dad69698578d8f7021d1d70454939">NS_EnsureSafeToReturn</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* uri, <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>** result)
<a name="l01624"></a>01624 {
<a name="l01625"></a>01625     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(uri, <span class="stringliteral">&quot;Must have a URI&quot;</span>);
<a name="l01626"></a>01626     
<a name="l01627"></a>01627     <span class="comment">// Assume mutable until told otherwise</span>
<a name="l01628"></a>01628     <span class="keywordtype">bool</span> isMutable = <span class="keyword">true</span>;
<a name="l01629"></a>01629     nsCOMPtr&lt;nsIMutable&gt; mutableObj(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(uri));
<a name="l01630"></a>01630     <span class="keywordflow">if</span> (mutableObj) {
<a name="l01631"></a>01631         <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = mutableObj-&gt;GetMutable(&amp;isMutable);
<a name="l01632"></a>01632         isMutable = <a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv) || isMutable;
<a name="l01633"></a>01633     }
<a name="l01634"></a>01634 
<a name="l01635"></a>01635     <span class="keywordflow">if</span> (!isMutable) {
<a name="l01636"></a>01636         <a class="code" href="../../d9/d4b/ns_i_supports_utils_8h.html#aa03d5ab87bebd65d9b5539de117f5590">NS_ADDREF</a>(*result = uri);
<a name="l01637"></a>01637         <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l01638"></a>01638     }
<a name="l01639"></a>01639 
<a name="l01640"></a>01640     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = uri-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#a94b769a5111eea00f0db98946d8dbd40">Clone</a>(result);
<a name="l01641"></a>01641     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; !*result) {
<a name="l01642"></a>01642         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ab105b12886cfa61141f617c05ce4a11b">NS_ERROR</a>(<span class="stringliteral">&quot;nsIURI.clone contract was violated&quot;</span>);
<a name="l01643"></a>01643         <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#aee4be918fd92e0bf76a202e0afca46f2">NS_ERROR_UNEXPECTED</a>;
<a name="l01644"></a>01644     }
<a name="l01645"></a>01645 
<a name="l01646"></a>01646     <span class="keywordflow">return</span> rv;
<a name="l01647"></a>01647 }
<a name="l01648"></a>01648 
<a name="l01652"></a>01652 <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01653"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a539f8e1a78e6e2a9c6292282695edacf">01653</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a539f8e1a78e6e2a9c6292282695edacf">NS_TryToSetImmutable</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* uri)
<a name="l01654"></a>01654 {
<a name="l01655"></a>01655     nsCOMPtr&lt;nsIMutable&gt; mutableObj(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(uri));
<a name="l01656"></a>01656     <span class="keywordflow">if</span> (mutableObj) {
<a name="l01657"></a>01657         mutableObj-&gt;SetMutable(<span class="keyword">false</span>);
<a name="l01658"></a>01658     }
<a name="l01659"></a>01659 }
<a name="l01660"></a>01660 
<a name="l01666"></a>01666 <span class="keyword">inline</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;nsIURI&gt;</a>
<a name="l01667"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a71f2254d8bb61286cbbb1d95960252a8">01667</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a71f2254d8bb61286cbbb1d95960252a8">NS_TryToMakeImmutable</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* uri,
<a name="l01668"></a>01668                       <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>* outRv = <span class="keyword">nullptr</span>)
<a name="l01669"></a>01669 {
<a name="l01670"></a>01670     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01671"></a>01671     nsCOMPtr&lt;nsINetUtil&gt; <a class="code" href="../../db/deb/apps_2system_2test_2marionette_2lib_2notification_8js.html#a8f5b2e09d5197e9d28f6032dff542d44">util</a> = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#abb429ed76240101cb5df9d581ad4e652">do_GetNetUtil</a>(&amp;rv);
<a name="l01672"></a>01672 
<a name="l01673"></a>01673     nsCOMPtr&lt;nsIURI&gt; <a class="code" href="../../da/d7d/cook_8js.html#a65ab37df1aa3fe0eb3d8e51a835fb617">result</a>;
<a name="l01674"></a>01674     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv)) {
<a name="l01675"></a>01675         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(util, <span class="stringliteral">&quot;do_GetNetUtil lied&quot;</span>);
<a name="l01676"></a>01676         rv = util-&gt;ToImmutableURI(uri, <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(result));
<a name="l01677"></a>01677     }
<a name="l01678"></a>01678 
<a name="l01679"></a>01679     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv)) {
<a name="l01680"></a>01680         result = <a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>;
<a name="l01681"></a>01681     }
<a name="l01682"></a>01682 
<a name="l01683"></a>01683     <span class="keywordflow">if</span> (outRv) {
<a name="l01684"></a>01684         *outRv = rv;
<a name="l01685"></a>01685     }
<a name="l01686"></a>01686 
<a name="l01687"></a>01687     <span class="keywordflow">return</span> result.forget();
<a name="l01688"></a>01688 }
<a name="l01689"></a>01689 
<a name="l01694"></a>01694 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01695"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a9a33f09efc7407a8157bc9445b4e5ce9">01695</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a9a33f09efc7407a8157bc9445b4e5ce9">NS_URIChainHasFlags</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>   *uri,
<a name="l01696"></a>01696                     uint32_t  <a class="code" href="../../da/d32/prio_8h.html#aa2585d779da0ab21273a8d92de9a0ebe">flags</a>,
<a name="l01697"></a>01697                     <span class="keywordtype">bool</span>     *result)
<a name="l01698"></a>01698 {
<a name="l01699"></a>01699     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l01700"></a>01700     nsCOMPtr&lt;nsINetUtil&gt; <a class="code" href="../../db/deb/apps_2system_2test_2marionette_2lib_2notification_8js.html#a8f5b2e09d5197e9d28f6032dff542d44">util</a> = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#abb429ed76240101cb5df9d581ad4e652">do_GetNetUtil</a>(&amp;rv);
<a name="l01701"></a>01701     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l01702"></a>01702 
<a name="l01703"></a>01703     <span class="keywordflow">return</span> util-&gt;URIChainHasFlags(uri, flags, result);
<a name="l01704"></a>01704 }
<a name="l01705"></a>01705 
<a name="l01710"></a>01710 <span class="keyword">inline</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;nsIURI&gt;</a>
<a name="l01711"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#acc951259c7074fc78a703e66eee6ad88">01711</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#acc951259c7074fc78a703e66eee6ad88">NS_GetInnermostURI</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* aURI)
<a name="l01712"></a>01712 {
<a name="l01713"></a>01713     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(aURI, <span class="stringliteral">&quot;Must have URI&quot;</span>);
<a name="l01714"></a>01714 
<a name="l01715"></a>01715     nsCOMPtr&lt;nsIURI&gt; uri = aURI;
<a name="l01716"></a>01716     
<a name="l01717"></a>01717     nsCOMPtr&lt;nsINestedURI&gt; nestedURI(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(uri));
<a name="l01718"></a>01718     <span class="keywordflow">if</span> (!nestedURI) {
<a name="l01719"></a>01719         <span class="keywordflow">return</span> uri.forget();
<a name="l01720"></a>01720     }
<a name="l01721"></a>01721 
<a name="l01722"></a>01722     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = nestedURI-&gt;GetInnermostURI(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(uri));
<a name="l01723"></a>01723     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv)) {
<a name="l01724"></a>01724         <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l01725"></a>01725     }
<a name="l01726"></a>01726 
<a name="l01727"></a>01727     <span class="keywordflow">return</span> uri.forget();
<a name="l01728"></a>01728 }
<a name="l01729"></a>01729 
<a name="l01737"></a>01737 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l01738"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a6df5ce89af76e57264f82f6f68b862f0">01738</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a6df5ce89af76e57264f82f6f68b862f0">NS_GetFinalChannelURI</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>* channel, <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>** uri)
<a name="l01739"></a>01739 {
<a name="l01740"></a>01740     *uri = <span class="keyword">nullptr</span>;
<a name="l01741"></a>01741     <a class="code" href="../../d7/dcd/ns_i_request_8idl.html#a3be91dfb6721923fabaec023c2567af8">nsLoadFlags</a> loadFlags = 0;
<a name="l01742"></a>01742     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = channel-&gt;<a class="code" href="../../d8/d9e/interfacens_i_request.html#a646018961bd545a9e5e126db4d45ca44">GetLoadFlags</a>(&amp;loadFlags);
<a name="l01743"></a>01743     <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l01744"></a>01744     
<a name="l01745"></a>01745     <span class="keywordflow">if</span> (loadFlags &amp; <a class="code" href="../../d1/d2d/interfacens_i_channel.html#a08be4213093c14df645120d668082427">nsIChannel::LOAD_REPLACE</a>) {
<a name="l01746"></a>01746         <span class="keywordflow">return</span> channel-&gt;<a class="code" href="../../d1/d2d/interfacens_i_channel.html#a7c8adb92fd73905ac21eb36b1480277f">GetURI</a>(uri);
<a name="l01747"></a>01747     }
<a name="l01748"></a>01748     
<a name="l01749"></a>01749     <span class="keywordflow">return</span> channel-&gt;<a class="code" href="../../d1/d2d/interfacens_i_channel.html#ac428548e06a82ca459b47cd60219ff4e">GetOriginalURI</a>(uri);
<a name="l01750"></a>01750 }
<a name="l01751"></a>01751 
<a name="l01752"></a>01752 <span class="comment">// NS_SecurityHashURI must return the same hash value for any two URIs that</span>
<a name="l01753"></a>01753 <span class="comment">// compare equal according to NS_SecurityCompareURIs.  Unfortunately, in the</span>
<a name="l01754"></a>01754 <span class="comment">// case of files, it&#39;s not clear we can do anything better than returning</span>
<a name="l01755"></a>01755 <span class="comment">// the schemeHash, so hashing files degenerates to storing them in a list.</span>
<a name="l01756"></a>01756 <span class="keyword">inline</span> uint32_t
<a name="l01757"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a34e6fe3deb104ec9de86ed14b8f3b0a7">01757</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a34e6fe3deb104ec9de86ed14b8f3b0a7">NS_SecurityHashURI</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* aURI)
<a name="l01758"></a>01758 {
<a name="l01759"></a>01759     nsCOMPtr&lt;nsIURI&gt; baseURI = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#acc951259c7074fc78a703e66eee6ad88">NS_GetInnermostURI</a>(aURI);
<a name="l01760"></a>01760 
<a name="l01761"></a>01761     nsAutoCString <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a53a9d930408d37f30165c41cd723f581">scheme</a>;
<a name="l01762"></a>01762     uint32_t schemeHash = 0;
<a name="l01763"></a>01763     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(baseURI-&gt;GetScheme(scheme)))
<a name="l01764"></a>01764         schemeHash = <a class="code" href="../../d2/d93/namespacemozilla.html#a54fb17ccb111a73e5129fec75798c099">mozilla::HashString</a>(scheme);
<a name="l01765"></a>01765 
<a name="l01766"></a>01766     <span class="comment">// TODO figure out how to hash file:// URIs</span>
<a name="l01767"></a>01767     <span class="keywordflow">if</span> (scheme.EqualsLiteral(<span class="stringliteral">&quot;file&quot;</span>))
<a name="l01768"></a>01768         <span class="keywordflow">return</span> schemeHash; <span class="comment">// sad face</span>
<a name="l01769"></a>01769 
<a name="l01770"></a>01770     <span class="keywordflow">if</span> (scheme.EqualsLiteral(<span class="stringliteral">&quot;imap&quot;</span>) ||
<a name="l01771"></a>01771         scheme.EqualsLiteral(<span class="stringliteral">&quot;mailbox&quot;</span>) ||
<a name="l01772"></a>01772         scheme.EqualsLiteral(<span class="stringliteral">&quot;news&quot;</span>))
<a name="l01773"></a>01773     {
<a name="l01774"></a>01774         nsAutoCString spec;
<a name="l01775"></a>01775         uint32_t specHash;
<a name="l01776"></a>01776         <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> res = baseURI-&gt;GetSpec(spec);
<a name="l01777"></a>01777         <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(res))
<a name="l01778"></a>01778             specHash = <a class="code" href="../../d2/d93/namespacemozilla.html#a54fb17ccb111a73e5129fec75798c099">mozilla::HashString</a>(spec);
<a name="l01779"></a>01779         <span class="keywordflow">else</span>
<a name="l01780"></a>01780             specHash = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(res);
<a name="l01781"></a>01781         <span class="keywordflow">return</span> specHash;
<a name="l01782"></a>01782     }
<a name="l01783"></a>01783 
<a name="l01784"></a>01784     nsAutoCString host;
<a name="l01785"></a>01785     uint32_t hostHash = 0;
<a name="l01786"></a>01786     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(baseURI-&gt;GetAsciiHost(host)))
<a name="l01787"></a>01787         hostHash = <a class="code" href="../../d2/d93/namespacemozilla.html#a54fb17ccb111a73e5129fec75798c099">mozilla::HashString</a>(host);
<a name="l01788"></a>01788 
<a name="l01789"></a>01789     <span class="keywordflow">return</span> mozilla::AddToHash(schemeHash, hostHash, <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ab2978bcc694fb6f4c194f9e25e701ca4">NS_GetRealPort</a>(baseURI));
<a name="l01790"></a>01790 }
<a name="l01791"></a>01791 
<a name="l01792"></a>01792 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01793"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#afc431a1ff5f151a2a0ccfcf4189590cd">01793</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#afc431a1ff5f151a2a0ccfcf4189590cd">NS_SecurityCompareURIs</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* aSourceURI,
<a name="l01794"></a>01794                        <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* aTargetURI,
<a name="l01795"></a>01795                        <span class="keywordtype">bool</span> aStrictFileOriginPolicy)
<a name="l01796"></a>01796 {
<a name="l01797"></a>01797     <span class="comment">// Note that this is not an Equals() test on purpose -- for URIs that don&#39;t</span>
<a name="l01798"></a>01798     <span class="comment">// support host/port, we want equality to basically be object identity, for</span>
<a name="l01799"></a>01799     <span class="comment">// security purposes.  Otherwise, for example, two javascript: URIs that</span>
<a name="l01800"></a>01800     <span class="comment">// are otherwise unrelated could end up &quot;same origin&quot;, which would be</span>
<a name="l01801"></a>01801     <span class="comment">// unfortunate.</span>
<a name="l01802"></a>01802     <span class="keywordflow">if</span> (aSourceURI &amp;&amp; aSourceURI == aTargetURI)
<a name="l01803"></a>01803     {
<a name="l01804"></a>01804         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01805"></a>01805     }
<a name="l01806"></a>01806 
<a name="l01807"></a>01807     <span class="keywordflow">if</span> (!aTargetURI || !aSourceURI)
<a name="l01808"></a>01808     {
<a name="l01809"></a>01809         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01810"></a>01810     }
<a name="l01811"></a>01811 
<a name="l01812"></a>01812     <span class="comment">// If either URI is a nested URI, get the base URI</span>
<a name="l01813"></a>01813     nsCOMPtr&lt;nsIURI&gt; sourceBaseURI = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#acc951259c7074fc78a703e66eee6ad88">NS_GetInnermostURI</a>(aSourceURI);
<a name="l01814"></a>01814     nsCOMPtr&lt;nsIURI&gt; targetBaseURI = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#acc951259c7074fc78a703e66eee6ad88">NS_GetInnermostURI</a>(aTargetURI);
<a name="l01815"></a>01815 
<a name="l01816"></a>01816     <span class="comment">// If either uri is an nsIURIWithPrincipal</span>
<a name="l01817"></a>01817     nsCOMPtr&lt;nsIURIWithPrincipal&gt; uriPrinc = <a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(sourceBaseURI);
<a name="l01818"></a>01818     <span class="keywordflow">if</span> (uriPrinc) {
<a name="l01819"></a>01819         uriPrinc-&gt;GetPrincipalUri(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(sourceBaseURI));
<a name="l01820"></a>01820     }
<a name="l01821"></a>01821 
<a name="l01822"></a>01822     uriPrinc = <a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(targetBaseURI);
<a name="l01823"></a>01823     <span class="keywordflow">if</span> (uriPrinc) {
<a name="l01824"></a>01824         uriPrinc-&gt;GetPrincipalUri(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(targetBaseURI));
<a name="l01825"></a>01825     }
<a name="l01826"></a>01826 
<a name="l01827"></a>01827     <span class="keywordflow">if</span> (!sourceBaseURI || !targetBaseURI)
<a name="l01828"></a>01828         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01829"></a>01829 
<a name="l01830"></a>01830     <span class="comment">// Compare schemes</span>
<a name="l01831"></a>01831     nsAutoCString targetScheme;
<a name="l01832"></a>01832     <span class="keywordtype">bool</span> sameScheme = <span class="keyword">false</span>;
<a name="l01833"></a>01833     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>( targetBaseURI-&gt;GetScheme(targetScheme) ) ||
<a name="l01834"></a>01834         <a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>( sourceBaseURI-&gt;SchemeIs(targetScheme.get(), &amp;sameScheme) ) ||
<a name="l01835"></a>01835         !sameScheme)
<a name="l01836"></a>01836     {
<a name="l01837"></a>01837         <span class="comment">// Not same-origin if schemes differ</span>
<a name="l01838"></a>01838         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01839"></a>01839     }
<a name="l01840"></a>01840 
<a name="l01841"></a>01841     <span class="comment">// For file scheme, reject unless the files are identical. See</span>
<a name="l01842"></a>01842     <span class="comment">// NS_RelaxStrictFileOriginPolicy for enforcing file same-origin checking</span>
<a name="l01843"></a>01843     <span class="keywordflow">if</span> (targetScheme.EqualsLiteral(<span class="stringliteral">&quot;file&quot;</span>))
<a name="l01844"></a>01844     {
<a name="l01845"></a>01845         <span class="comment">// in traditional unsafe behavior all files are the same origin</span>
<a name="l01846"></a>01846         <span class="keywordflow">if</span> (!aStrictFileOriginPolicy)
<a name="l01847"></a>01847             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01848"></a>01848 
<a name="l01849"></a>01849         nsCOMPtr&lt;nsIFileURL&gt; sourceFileURL(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(sourceBaseURI));
<a name="l01850"></a>01850         nsCOMPtr&lt;nsIFileURL&gt; targetFileURL(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(targetBaseURI));
<a name="l01851"></a>01851 
<a name="l01852"></a>01852         <span class="keywordflow">if</span> (!sourceFileURL || !targetFileURL)
<a name="l01853"></a>01853             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01854"></a>01854 
<a name="l01855"></a>01855         nsCOMPtr&lt;nsIFile&gt; <a class="code" href="../../da/d32/prio_8h.html#a88395eb54336cd5cd66cfe4bf4968e07">sourceFile</a>, targetFile;
<a name="l01856"></a>01856 
<a name="l01857"></a>01857         sourceFileURL-&gt;GetFile(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(sourceFile));
<a name="l01858"></a>01858         targetFileURL-&gt;GetFile(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(targetFile));
<a name="l01859"></a>01859 
<a name="l01860"></a>01860         <span class="keywordflow">if</span> (!sourceFile || !targetFile)
<a name="l01861"></a>01861             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01862"></a>01862 
<a name="l01863"></a>01863         <span class="comment">// Otherwise they had better match</span>
<a name="l01864"></a>01864         <span class="keywordtype">bool</span> filesAreEqual = <span class="keyword">false</span>;
<a name="l01865"></a>01865         <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = sourceFile-&gt;Equals(targetFile, &amp;filesAreEqual);
<a name="l01866"></a>01866         <span class="keywordflow">return</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; filesAreEqual;
<a name="l01867"></a>01867     }
<a name="l01868"></a>01868 
<a name="l01869"></a>01869     <span class="comment">// Special handling for mailnews schemes</span>
<a name="l01870"></a>01870     <span class="keywordflow">if</span> (targetScheme.EqualsLiteral(<span class="stringliteral">&quot;imap&quot;</span>) ||
<a name="l01871"></a>01871         targetScheme.EqualsLiteral(<span class="stringliteral">&quot;mailbox&quot;</span>) ||
<a name="l01872"></a>01872         targetScheme.EqualsLiteral(<span class="stringliteral">&quot;news&quot;</span>))
<a name="l01873"></a>01873     {
<a name="l01874"></a>01874         <span class="comment">// Each message is a distinct trust domain; use the</span>
<a name="l01875"></a>01875         <span class="comment">// whole spec for comparison</span>
<a name="l01876"></a>01876         nsAutoCString targetSpec;
<a name="l01877"></a>01877         nsAutoCString sourceSpec;
<a name="l01878"></a>01878         <span class="keywordflow">return</span> ( <a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>( targetBaseURI-&gt;GetSpec(targetSpec) ) &amp;&amp;
<a name="l01879"></a>01879                  <a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>( sourceBaseURI-&gt;GetSpec(sourceSpec) ) &amp;&amp;
<a name="l01880"></a>01880                  targetSpec.Equals(sourceSpec) );
<a name="l01881"></a>01881     }
<a name="l01882"></a>01882 
<a name="l01883"></a>01883     <span class="comment">// Compare hosts</span>
<a name="l01884"></a>01884     nsAutoCString targetHost;
<a name="l01885"></a>01885     nsAutoCString sourceHost;
<a name="l01886"></a>01886     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>( targetBaseURI-&gt;GetAsciiHost(targetHost) ) ||
<a name="l01887"></a>01887         <a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>( sourceBaseURI-&gt;GetAsciiHost(sourceHost) ))
<a name="l01888"></a>01888     {
<a name="l01889"></a>01889         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01890"></a>01890     }
<a name="l01891"></a>01891 
<a name="l01892"></a>01892     nsCOMPtr&lt;nsIStandardURL&gt; targetURL(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(targetBaseURI));
<a name="l01893"></a>01893     nsCOMPtr&lt;nsIStandardURL&gt; sourceURL(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(sourceBaseURI));
<a name="l01894"></a>01894     <span class="keywordflow">if</span> (!targetURL || !sourceURL)
<a name="l01895"></a>01895     {
<a name="l01896"></a>01896         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01897"></a>01897     }
<a name="l01898"></a>01898 
<a name="l01899"></a>01899 <span class="preprocessor">#ifdef MOZILLA_INTERNAL_API</span>
<a name="l01900"></a>01900 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!targetHost.Equals(sourceHost, <a class="code" href="../../d5/d11/classns_case_insensitive_c_string_comparator.html">nsCaseInsensitiveCStringComparator</a>() ))
<a name="l01901"></a>01901 #<span class="keywordflow">else</span>
<a name="l01902"></a>01902     <span class="keywordflow">if</span> (!targetHost.Equals(sourceHost, <a class="code" href="../../d1/d48/ns_unichar_utils_8h.html#a12d6926c042ab968c1ff6f665fd5de00">CaseInsensitiveCompare</a>))
<a name="l01903"></a>01903 #endif
<a name="l01904"></a>01904     {
<a name="l01905"></a>01905         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01906"></a>01906     }
<a name="l01907"></a>01907 
<a name="l01908"></a>01908     <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ab2978bcc694fb6f4c194f9e25e701ca4">NS_GetRealPort</a>(targetBaseURI) == <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ab2978bcc694fb6f4c194f9e25e701ca4">NS_GetRealPort</a>(sourceBaseURI);
<a name="l01909"></a>01909 }
<a name="l01910"></a>01910 
<a name="l01911"></a>01911 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01912"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1b3ba7dfa2bb1f4ff9be4ddd8b5ea8fe">01912</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1b3ba7dfa2bb1f4ff9be4ddd8b5ea8fe">NS_URIIsLocalFile</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> *aURI)
<a name="l01913"></a>01913 {
<a name="l01914"></a>01914   nsCOMPtr&lt;nsINetUtil&gt; <a class="code" href="../../db/deb/apps_2system_2test_2marionette_2lib_2notification_8js.html#a8f5b2e09d5197e9d28f6032dff542d44">util</a> = <a class="code" href="../../d9/d5b/ns_net_util_8h.html#abb429ed76240101cb5df9d581ad4e652">do_GetNetUtil</a>();
<a name="l01915"></a>01915 
<a name="l01916"></a>01916   <span class="keywordtype">bool</span> isFile;
<a name="l01917"></a>01917   <span class="keywordflow">return</span> util &amp;&amp; <a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(util-&gt;ProtocolHasFlags(aURI,
<a name="l01918"></a>01918                                 <a class="code" href="../../dc/d83/interfacens_i_protocol_handler.html#a7f84371a28d7bd6249d43998070703ab">nsIProtocolHandler::URI_IS_LOCAL_FILE</a>,
<a name="l01919"></a>01919                                 &amp;isFile)) &amp;&amp;
<a name="l01920"></a>01920          isFile;
<a name="l01921"></a>01921 }
<a name="l01922"></a>01922 
<a name="l01923"></a>01923 <span class="comment">// When strict file origin policy is enabled, SecurityCompareURIs will fail for</span>
<a name="l01924"></a>01924 <span class="comment">// file URIs that do not point to the same local file. This call provides an</span>
<a name="l01925"></a>01925 <span class="comment">// alternate file-specific origin check that allows target files that are</span>
<a name="l01926"></a>01926 <span class="comment">// contained in the same directory as the source.</span>
<a name="l01927"></a>01927 <span class="comment">//</span>
<a name="l01928"></a>01928 <span class="comment">// https://developer.mozilla.org/en-US/docs/Same-origin_policy_for_file:_URIs</span>
<a name="l01929"></a>01929 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01930"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ab07c800749df9a6593af6a37ab6eb2cf">01930</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ab07c800749df9a6593af6a37ab6eb2cf">NS_RelaxStrictFileOriginPolicy</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> *aTargetURI,
<a name="l01931"></a>01931                                <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> *aSourceURI,
<a name="l01932"></a>01932                                <span class="keywordtype">bool</span> aAllowDirectoryTarget = <span class="keyword">false</span>)
<a name="l01933"></a>01933 {
<a name="l01934"></a>01934   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1b3ba7dfa2bb1f4ff9be4ddd8b5ea8fe">NS_URIIsLocalFile</a>(aTargetURI)) {
<a name="l01935"></a>01935     <span class="comment">// This is probably not what the caller intended</span>
<a name="l01936"></a>01936     <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad3069ac6d831231df185636879a728ca">NS_NOTREACHED</a>(<span class="stringliteral">&quot;NS_RelaxStrictFileOriginPolicy called with non-file URI&quot;</span>);
<a name="l01937"></a>01937     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01938"></a>01938   }
<a name="l01939"></a>01939 
<a name="l01940"></a>01940   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1b3ba7dfa2bb1f4ff9be4ddd8b5ea8fe">NS_URIIsLocalFile</a>(aSourceURI)) {
<a name="l01941"></a>01941     <span class="comment">// If the source is not also a file: uri then forget it</span>
<a name="l01942"></a>01942     <span class="comment">// (don&#39;t want resource: principals in a file: doc)</span>
<a name="l01943"></a>01943     <span class="comment">//</span>
<a name="l01944"></a>01944     <span class="comment">// note: we&#39;re not de-nesting jar: uris here, we want to</span>
<a name="l01945"></a>01945     <span class="comment">// keep archive content bottled up in its own little island</span>
<a name="l01946"></a>01946     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01947"></a>01947   }
<a name="l01948"></a>01948 
<a name="l01949"></a>01949   <span class="comment">//</span>
<a name="l01950"></a>01950   <span class="comment">// pull out the internal files</span>
<a name="l01951"></a>01951   <span class="comment">//</span>
<a name="l01952"></a>01952   nsCOMPtr&lt;nsIFileURL&gt; targetFileURL(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(aTargetURI));
<a name="l01953"></a>01953   nsCOMPtr&lt;nsIFileURL&gt; sourceFileURL(<a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(aSourceURI));
<a name="l01954"></a>01954   nsCOMPtr&lt;nsIFile&gt; targetFile;
<a name="l01955"></a>01955   nsCOMPtr&lt;nsIFile&gt; <a class="code" href="../../da/d32/prio_8h.html#a88395eb54336cd5cd66cfe4bf4968e07">sourceFile</a>;
<a name="l01956"></a>01956   <span class="keywordtype">bool</span> targetIsDir;
<a name="l01957"></a>01957 
<a name="l01958"></a>01958   <span class="comment">// Make sure targetFile is not a directory (bug 209234)</span>
<a name="l01959"></a>01959   <span class="comment">// and that it exists w/out unescaping (bug 395343)</span>
<a name="l01960"></a>01960   <span class="keywordflow">if</span> (!sourceFileURL || !targetFileURL ||
<a name="l01961"></a>01961       <a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(targetFileURL-&gt;GetFile(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(targetFile))) ||
<a name="l01962"></a>01962       <a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(sourceFileURL-&gt;GetFile(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(sourceFile))) ||
<a name="l01963"></a>01963       !targetFile || !sourceFile ||
<a name="l01964"></a>01964       <a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(targetFile-&gt;Normalize()) ||
<a name="l01965"></a>01965 #ifndef MOZ_WIDGET_ANDROID
<a name="l01966"></a>01966       <a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(sourceFile-&gt;Normalize()) ||
<a name="l01967"></a>01967 #endif
<a name="l01968"></a>01968       (!aAllowDirectoryTarget &amp;&amp;
<a name="l01969"></a>01969        (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(targetFile-&gt;IsDirectory(&amp;targetIsDir)) || targetIsDir))) {
<a name="l01970"></a>01970     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01971"></a>01971   }
<a name="l01972"></a>01972 
<a name="l01973"></a>01973   <span class="comment">//</span>
<a name="l01974"></a>01974   <span class="comment">// If the file to be loaded is in a subdirectory of the source</span>
<a name="l01975"></a>01975   <span class="comment">// (or same-dir if source is not a directory) then it will</span>
<a name="l01976"></a>01976   <span class="comment">// inherit its source principal and be scriptable by that source.</span>
<a name="l01977"></a>01977   <span class="comment">//</span>
<a name="l01978"></a>01978   <span class="keywordtype">bool</span> sourceIsDir;
<a name="l01979"></a>01979   <span class="keywordtype">bool</span> contained = <span class="keyword">false</span>;
<a name="l01980"></a>01980   <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = sourceFile-&gt;IsDirectory(&amp;sourceIsDir);
<a name="l01981"></a>01981   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; sourceIsDir) {
<a name="l01982"></a>01982     rv = sourceFile-&gt;Contains(targetFile, <span class="keyword">true</span>, &amp;contained);
<a name="l01983"></a>01983   } <span class="keywordflow">else</span> {
<a name="l01984"></a>01984     nsCOMPtr&lt;nsIFile&gt; sourceParent;
<a name="l01985"></a>01985     rv = sourceFile-&gt;GetParent(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(sourceParent));
<a name="l01986"></a>01986     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; sourceParent) {
<a name="l01987"></a>01987       rv = sourceParent-&gt;Contains(targetFile, <span class="keyword">true</span>, &amp;contained);
<a name="l01988"></a>01988     }
<a name="l01989"></a>01989   }
<a name="l01990"></a>01990 
<a name="l01991"></a>01991   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; contained) {
<a name="l01992"></a>01992     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01993"></a>01993   }
<a name="l01994"></a>01994 
<a name="l01995"></a>01995   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01996"></a>01996 }
<a name="l01997"></a>01997 
<a name="l01998"></a>01998 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01999"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#add24f118773da49a45baa5f9b28db8a7">01999</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#add24f118773da49a45baa5f9b28db8a7">NS_IsInternalSameURIRedirect</a>(<a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a> *aOldChannel,
<a name="l02000"></a>02000                              <a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a> *aNewChannel,
<a name="l02001"></a>02001                              uint32_t aFlags)
<a name="l02002"></a>02002 {
<a name="l02003"></a>02003   <span class="keywordflow">if</span> (!(aFlags &amp; <a class="code" href="../../d5/d15/interfacens_i_channel_event_sink.html#a7ba7e2e36388baa50fca2cca19984aa7">nsIChannelEventSink::REDIRECT_INTERNAL</a>)) {
<a name="l02004"></a>02004     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02005"></a>02005   }
<a name="l02006"></a>02006 
<a name="l02007"></a>02007   nsCOMPtr&lt;nsIURI&gt; oldURI, newURI;
<a name="l02008"></a>02008   aOldChannel-&gt;<a class="code" href="../../d1/d2d/interfacens_i_channel.html#a7c8adb92fd73905ac21eb36b1480277f">GetURI</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(oldURI));
<a name="l02009"></a>02009   aNewChannel-&gt;<a class="code" href="../../d1/d2d/interfacens_i_channel.html#a7c8adb92fd73905ac21eb36b1480277f">GetURI</a>(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(newURI));
<a name="l02010"></a>02010 
<a name="l02011"></a>02011   <span class="keywordflow">if</span> (!oldURI || !newURI) {
<a name="l02012"></a>02012     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02013"></a>02013   }
<a name="l02014"></a>02014 
<a name="l02015"></a>02015   <span class="keywordtype">bool</span> res;
<a name="l02016"></a>02016   <span class="keywordflow">return</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(oldURI-&gt;Equals(newURI, &amp;res)) &amp;&amp; res;
<a name="l02017"></a>02017 }
<a name="l02018"></a>02018 
<a name="l02019"></a>02019 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l02020"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad7f2cafc859549af25ea4b37366b67d6">02020</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad7f2cafc859549af25ea4b37366b67d6">NS_LinkRedirectChannels</a>(uint32_t channelId,
<a name="l02021"></a>02021                         <a class="code" href="../../d5/d63/interfacens_i_parent_channel.html">nsIParentChannel</a> *parentChannel,
<a name="l02022"></a>02022                         <a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a>** _result)
<a name="l02023"></a>02023 {
<a name="l02024"></a>02024   <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l02025"></a>02025 
<a name="l02026"></a>02026   nsCOMPtr&lt;nsIRedirectChannelRegistrar&gt; registrar =
<a name="l02027"></a>02027       <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<span class="stringliteral">&quot;@mozilla.org/redirectchannelregistrar;1&quot;</span>, &amp;rv);
<a name="l02028"></a>02028   <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l02029"></a>02029 
<a name="l02030"></a>02030   <span class="keywordflow">return</span> registrar-&gt;LinkChannels(channelId,
<a name="l02031"></a>02031                                  parentChannel,
<a name="l02032"></a>02032                                  _result);
<a name="l02033"></a>02033 }
<a name="l02034"></a>02034 
<a name="l02039"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a178ba4a5857e397ff06962f2b8b8f27b">02039</a> <span class="preprocessor">#define NS_FAKE_SCHEME &quot;http://&quot;</span>
<a name="l02040"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a68602ef68936e176746d93ae28d774bc">02040</a> <span class="preprocessor"></span><span class="preprocessor">#define NS_FAKE_TLD &quot;.invalid&quot;</span>
<a name="l02041"></a>02041 <span class="preprocessor"></span><span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l02042"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a58173f1a876e21abafe713d162a066e5">02042</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a58173f1a876e21abafe713d162a066e5">NS_MakeRandomInvalidURLString</a>(nsCString&amp; result)
<a name="l02043"></a>02043 {
<a name="l02044"></a>02044   <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l02045"></a>02045   nsCOMPtr&lt;nsIUUIDGenerator&gt; uuidgen =
<a name="l02046"></a>02046     <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<span class="stringliteral">&quot;@mozilla.org/uuid-generator;1&quot;</span>, &amp;rv);
<a name="l02047"></a>02047   <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l02048"></a>02048 
<a name="l02049"></a>02049   <a class="code" href="../../d4/d3d/structns_i_d.html">nsID</a> idee;
<a name="l02050"></a>02050   rv = uuidgen-&gt;GenerateUUIDInPlace(&amp;idee);
<a name="l02051"></a>02051   <a class="code" href="../../dc/d6d/ns_debug_8h.html#a0d677d0a1fb618e227f48d08695b5317">NS_ENSURE_SUCCESS</a>(rv, rv);
<a name="l02052"></a>02052 
<a name="l02053"></a>02053   <span class="keywordtype">char</span> <a class="code" href="../../d2/d7d/jsapi_8h.html#a12861e8179d59cfac859595dde6475e3">chars</a>[<a class="code" href="../../d9/d0a/ns_i_d_8h.html#a4bf26adca291c29dce28742576fffe87">NSID_LENGTH</a>];
<a name="l02054"></a>02054   idee.<a class="code" href="../../d4/d3d/structns_i_d.html#a684608c48a7fdbe5db6339cff471664a">ToProvidedString</a>(chars);
<a name="l02055"></a>02055 
<a name="l02056"></a>02056   result.AssignLiteral(<a class="code" href="../../d9/d5b/ns_net_util_8h.html#a178ba4a5857e397ff06962f2b8b8f27b">NS_FAKE_SCHEME</a>);
<a name="l02057"></a>02057   <span class="comment">// Strip off the &#39;{&#39; and &#39;}&#39; at the beginning and end of the UUID</span>
<a name="l02058"></a>02058   result.Append(chars + 1, <a class="code" href="../../d9/d0a/ns_i_d_8h.html#a4bf26adca291c29dce28742576fffe87">NSID_LENGTH</a> - 3);
<a name="l02059"></a>02059   result.AppendLiteral(<a class="code" href="../../d9/d5b/ns_net_util_8h.html#a68602ef68936e176746d93ae28d774bc">NS_FAKE_TLD</a>);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061   <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l02062"></a>02062 }
<a name="l02063"></a>02063 <span class="preprocessor">#undef NS_FAKE_SCHEME</span>
<a name="l02064"></a>02064 <span class="preprocessor"></span><span class="preprocessor">#undef NS_FAKE_TLD</span>
<a name="l02065"></a>02065 <span class="preprocessor"></span>
<a name="l02073"></a>02073 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l02074"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a5760ce0b4c26539fabbe41a3b93f9f6d">02074</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a5760ce0b4c26539fabbe41a3b93f9f6d">NS_CheckIsJavaCompatibleURLString</a>(nsCString&amp; urlString, <span class="keywordtype">bool</span> *result)
<a name="l02075"></a>02075 {
<a name="l02076"></a>02076   *result = <span class="keyword">false</span>; <span class="comment">// Default to &quot;no&quot;</span>
<a name="l02077"></a>02077 
<a name="l02078"></a>02078   <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l02079"></a>02079   nsCOMPtr&lt;nsIURLParser&gt; urlParser =
<a name="l02080"></a>02080     <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#ace1a3e227a093800717499e9ac38f5c5">NS_STDURLPARSER_CONTRACTID</a>, &amp;rv);
<a name="l02081"></a>02081   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv) || !urlParser)
<a name="l02082"></a>02082     <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a9de321fc4356efa6a090b3b736a206c2">NS_ERROR_FAILURE</a>;
<a name="l02083"></a>02083 
<a name="l02084"></a>02084   <span class="keywordtype">bool</span> compatible = <span class="keyword">true</span>;
<a name="l02085"></a>02085   uint32_t schemePos = 0;
<a name="l02086"></a>02086   int32_t <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a1af123ac520d24f88501f512750f3d8a">schemeLen</a> = 0;
<a name="l02087"></a>02087   urlParser-&gt;ParseURL(urlString.get(), -1, &amp;schemePos, &amp;<a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a1af123ac520d24f88501f512750f3d8a">schemeLen</a>,
<a name="l02088"></a>02088                       <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);
<a name="l02089"></a>02089   <span class="keywordflow">if</span> (schemeLen != -1) {
<a name="l02090"></a>02090     nsCString <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a53a9d930408d37f30165c41cd723f581">scheme</a>;
<a name="l02091"></a>02091     scheme.Assign(urlString.get() + schemePos, <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#a1af123ac520d24f88501f512750f3d8a">schemeLen</a>);
<a name="l02092"></a>02092     <span class="comment">// By default Java only understands a small number of URL schemes, and of</span>
<a name="l02093"></a>02093     <span class="comment">// these only some can legitimately represent a browser page&#39;s &quot;origin&quot;</span>
<a name="l02094"></a>02094     <span class="comment">// (and be something we can legitimately expect Java to handle ... or not</span>
<a name="l02095"></a>02095     <span class="comment">// to mishandle).</span>
<a name="l02096"></a>02096     <span class="comment">//</span>
<a name="l02097"></a>02097     <span class="comment">// Besides those listed below, the OJI plugin understands the &quot;jar&quot;,</span>
<a name="l02098"></a>02098     <span class="comment">// &quot;mailto&quot;, &quot;netdoc&quot;, &quot;javascript&quot; and &quot;rmi&quot; schemes, and Java Plugin2</span>
<a name="l02099"></a>02099     <span class="comment">// also understands the &quot;about&quot; scheme.  We actually pass &quot;about&quot; URLs</span>
<a name="l02100"></a>02100     <span class="comment">// to Java (&quot;about:blank&quot; when processing a javascript: URL (one that</span>
<a name="l02101"></a>02101     <span class="comment">// calls Java) from the location bar of a blank page, and (in FF4 and up)</span>
<a name="l02102"></a>02102     <span class="comment">// &quot;about:home&quot; when processing a javascript: URL from the home page).</span>
<a name="l02103"></a>02103     <span class="comment">// And Java doesn&#39;t appear to mishandle them (for example it doesn&#39;t allow</span>
<a name="l02104"></a>02104     <span class="comment">// connections to &quot;about&quot; URLs).  But it doesn&#39;t make any sense to do</span>
<a name="l02105"></a>02105     <span class="comment">// same-origin checks on &quot;about&quot; URLs, so we don&#39;t include them in our</span>
<a name="l02106"></a>02106     <span class="comment">// scheme whitelist.</span>
<a name="l02107"></a>02107     <span class="comment">//</span>
<a name="l02108"></a>02108     <span class="comment">// The OJI plugin doesn&#39;t understand &quot;chrome&quot; URLs (only Java Plugin2</span>
<a name="l02109"></a>02109     <span class="comment">// does) -- so we mustn&#39;t pass them to the OJI plugin.  But we do need to</span>
<a name="l02110"></a>02110     <span class="comment">// pass &quot;chrome&quot; URLs to Java Plugin2:  Java Plugin2 grants additional</span>
<a name="l02111"></a>02111     <span class="comment">// privileges to chrome &quot;origins&quot;, and some extensions take advantage of</span>
<a name="l02112"></a>02112     <span class="comment">// this.  For more information see bug 620773.</span>
<a name="l02113"></a>02113     <span class="comment">//</span>
<a name="l02114"></a>02114     <span class="comment">// As of FF4, we no longer support the OJI plugin.</span>
<a name="l02115"></a>02115     <span class="keywordflow">if</span> (<a class="code" href="../../de/d72/plstr_8h.html#ad3f4ef41d670b6eda686b5be435e9677">PL_strcasecmp</a>(scheme.get(), <span class="stringliteral">&quot;http&quot;</span>) &amp;&amp;
<a name="l02116"></a>02116         <a class="code" href="../../de/d72/plstr_8h.html#ad3f4ef41d670b6eda686b5be435e9677">PL_strcasecmp</a>(scheme.get(), <span class="stringliteral">&quot;https&quot;</span>) &amp;&amp;
<a name="l02117"></a>02117         <a class="code" href="../../de/d72/plstr_8h.html#ad3f4ef41d670b6eda686b5be435e9677">PL_strcasecmp</a>(scheme.get(), <span class="stringliteral">&quot;file&quot;</span>) &amp;&amp;
<a name="l02118"></a>02118         <a class="code" href="../../de/d72/plstr_8h.html#ad3f4ef41d670b6eda686b5be435e9677">PL_strcasecmp</a>(scheme.get(), <span class="stringliteral">&quot;ftp&quot;</span>) &amp;&amp;
<a name="l02119"></a>02119         <a class="code" href="../../de/d72/plstr_8h.html#ad3f4ef41d670b6eda686b5be435e9677">PL_strcasecmp</a>(scheme.get(), <span class="stringliteral">&quot;gopher&quot;</span>) &amp;&amp;
<a name="l02120"></a>02120         <a class="code" href="../../de/d72/plstr_8h.html#ad3f4ef41d670b6eda686b5be435e9677">PL_strcasecmp</a>(scheme.get(), <span class="stringliteral">&quot;chrome&quot;</span>))
<a name="l02121"></a>02121       compatible = <span class="keyword">false</span>;
<a name="l02122"></a>02122   } <span class="keywordflow">else</span> {
<a name="l02123"></a>02123     compatible = <span class="keyword">false</span>;
<a name="l02124"></a>02124   }
<a name="l02125"></a>02125 
<a name="l02126"></a>02126   *result = compatible;
<a name="l02127"></a>02127 
<a name="l02128"></a>02128   <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l02129"></a>02129 }
<a name="l02130"></a>02130 
<a name="l02135"></a>02135 <span class="keyword">inline</span> uint32_t
<a name="l02136"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1b950e3619ae5f3ce3c497c7115354ce">02136</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1b950e3619ae5f3ce3c497c7115354ce">NS_GetContentDispositionFromToken</a>(<span class="keyword">const</span> nsAString&amp; aDispToken)
<a name="l02137"></a>02137 {
<a name="l02138"></a>02138   <span class="comment">// RFC 2183, section 2.8 says that an unknown disposition</span>
<a name="l02139"></a>02139   <span class="comment">// value should be treated as &quot;attachment&quot;</span>
<a name="l02140"></a>02140   <span class="comment">// If all of these tests eval to false, then we have a content-disposition of</span>
<a name="l02141"></a>02141   <span class="comment">// &quot;attachment&quot; or unknown</span>
<a name="l02142"></a>02142   <span class="keywordflow">if</span> (aDispToken.IsEmpty() ||
<a name="l02143"></a>02143       aDispToken.LowerCaseEqualsLiteral(<span class="stringliteral">&quot;inline&quot;</span>) ||
<a name="l02144"></a>02144       <span class="comment">// Broken sites just send</span>
<a name="l02145"></a>02145       <span class="comment">// Content-Disposition: filename=&quot;file&quot;</span>
<a name="l02146"></a>02146       <span class="comment">// without a disposition token... screen those out.</span>
<a name="l02147"></a>02147       <a class="code" href="../../df/dcc/ns_t_dependent_substring_8h.html#a2b819481efd0ebf8ac6a11b2a4eb919b">StringHead</a>(aDispToken, 8).<a class="code" href="../../d4/dc1/classns_t_substring___char_t.html#a1ae9e8693b5518a2d83650d3f4bd128d">LowerCaseEqualsLiteral</a>(<span class="stringliteral">&quot;filename&quot;</span>))
<a name="l02148"></a>02148     <span class="keywordflow">return</span> <a class="code" href="../../d1/d2d/interfacens_i_channel.html#aa9129f5040311b18bd15bc9c965b4377">nsIChannel::DISPOSITION_INLINE</a>;
<a name="l02149"></a>02149 
<a name="l02150"></a>02150   <span class="keywordflow">return</span> <a class="code" href="../../d1/d2d/interfacens_i_channel.html#a9e8ef3293445512d365115d8951dddd2">nsIChannel::DISPOSITION_ATTACHMENT</a>;
<a name="l02151"></a>02151 }
<a name="l02152"></a>02152 
<a name="l02158"></a>02158 <span class="keyword">inline</span> uint32_t
<a name="l02159"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a58d68c2a0f09fac84734b69c7c48a126">02159</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a58d68c2a0f09fac84734b69c7c48a126">NS_GetContentDispositionFromHeader</a>(<span class="keyword">const</span> nsACString&amp; <a class="code" href="../../de/d81/xpt__struct_8h.html#af71186e73cea4bee641c417dca50fe45">aHeader</a>, <a class="code" href="../../d1/d2d/interfacens_i_channel.html">nsIChannel</a> *aChan = <span class="keyword">nullptr</span>)
<a name="l02160"></a>02160 {
<a name="l02161"></a>02161   <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l02162"></a>02162   nsCOMPtr&lt;nsIMIMEHeaderParam&gt; mimehdrpar = <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a47b63fd57394c9981ab477f07ffa3cea">NS_MIMEHEADERPARAM_CONTRACTID</a>, &amp;rv);
<a name="l02163"></a>02163   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l02164"></a>02164     <span class="keywordflow">return</span> <a class="code" href="../../d1/d2d/interfacens_i_channel.html#a9e8ef3293445512d365115d8951dddd2">nsIChannel::DISPOSITION_ATTACHMENT</a>;
<a name="l02165"></a>02165 
<a name="l02166"></a>02166   nsAutoCString fallbackCharset;
<a name="l02167"></a>02167   <span class="keywordflow">if</span> (aChan) {
<a name="l02168"></a>02168     nsCOMPtr&lt;nsIURI&gt; <a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>;
<a name="l02169"></a>02169     aChan-&gt;GetURI(<a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(uri));
<a name="l02170"></a>02170     <span class="keywordflow">if</span> (uri)
<a name="l02171"></a>02171       uri-&gt;GetOriginCharset(fallbackCharset);
<a name="l02172"></a>02172   }
<a name="l02173"></a>02173 
<a name="l02174"></a>02174   nsAutoString dispToken;
<a name="l02175"></a>02175   rv = mimehdrpar-&gt;GetParameterHTTP(aHeader, <span class="stringliteral">&quot;&quot;</span>, fallbackCharset, <span class="keyword">true</span>, <span class="keyword">nullptr</span>,
<a name="l02176"></a>02176                                     dispToken);
<a name="l02177"></a>02177 
<a name="l02178"></a>02178   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv)) {
<a name="l02179"></a>02179     <span class="comment">// special case (see bug 272541): empty disposition type handled as &quot;inline&quot;</span>
<a name="l02180"></a>02180     <span class="keywordflow">if</span> (rv == <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a0c3149faa99bc96994c4fd615f2edaed">NS_ERROR_FIRST_HEADER_FIELD_COMPONENT_EMPTY</a>)
<a name="l02181"></a>02181         <span class="keywordflow">return</span> <a class="code" href="../../d1/d2d/interfacens_i_channel.html#aa9129f5040311b18bd15bc9c965b4377">nsIChannel::DISPOSITION_INLINE</a>;
<a name="l02182"></a>02182     <span class="keywordflow">return</span> <a class="code" href="../../d1/d2d/interfacens_i_channel.html#a9e8ef3293445512d365115d8951dddd2">nsIChannel::DISPOSITION_ATTACHMENT</a>;
<a name="l02183"></a>02183   }
<a name="l02184"></a>02184 
<a name="l02185"></a>02185   <span class="keywordflow">return</span> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a1b950e3619ae5f3ce3c497c7115354ce">NS_GetContentDispositionFromToken</a>(dispToken);
<a name="l02186"></a>02186 }
<a name="l02187"></a>02187 
<a name="l02194"></a>02194 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l02195"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a643048f95610b14587ef8139aeaa088c">02195</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a643048f95610b14587ef8139aeaa088c">NS_GetFilenameFromDisposition</a>(nsAString&amp; aFilename,
<a name="l02196"></a>02196                               <span class="keyword">const</span> nsACString&amp; aDisposition,
<a name="l02197"></a>02197                               <a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a>* aURI = <span class="keyword">nullptr</span>)
<a name="l02198"></a>02198 {
<a name="l02199"></a>02199   aFilename.Truncate();
<a name="l02200"></a>02200 
<a name="l02201"></a>02201   <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv;
<a name="l02202"></a>02202   nsCOMPtr&lt;nsIMIMEHeaderParam&gt; mimehdrpar =
<a name="l02203"></a>02203       <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a47b63fd57394c9981ab477f07ffa3cea">NS_MIMEHEADERPARAM_CONTRACTID</a>, &amp;rv);
<a name="l02204"></a>02204   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv))
<a name="l02205"></a>02205     <span class="keywordflow">return</span> rv;
<a name="l02206"></a>02206 
<a name="l02207"></a>02207   nsCOMPtr&lt;nsIURL&gt; <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a> = <a class="code" href="../../d5/d03/ns_c_o_m_ptr_8h.html#af95dba31e48b04c94928ebf8bd30bb0c">do_QueryInterface</a>(aURI);
<a name="l02208"></a>02208 
<a name="l02209"></a>02209   nsAutoCString fallbackCharset;
<a name="l02210"></a>02210   <span class="keywordflow">if</span> (url)
<a name="l02211"></a>02211     url-&gt;GetOriginCharset(fallbackCharset);
<a name="l02212"></a>02212   <span class="comment">// Get the value of &#39;filename&#39; parameter</span>
<a name="l02213"></a>02213   rv = mimehdrpar-&gt;GetParameterHTTP(aDisposition, <span class="stringliteral">&quot;filename&quot;</span>,
<a name="l02214"></a>02214                                     fallbackCharset, <span class="keyword">true</span>, <span class="keyword">nullptr</span>,
<a name="l02215"></a>02215                                     aFilename);
<a name="l02216"></a>02216 
<a name="l02217"></a>02217   <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(rv)) {
<a name="l02218"></a>02218     aFilename.Truncate();
<a name="l02219"></a>02219     <span class="keywordflow">return</span> rv;
<a name="l02220"></a>02220   }
<a name="l02221"></a>02221 
<a name="l02222"></a>02222   <span class="keywordflow">if</span> (aFilename.IsEmpty())
<a name="l02223"></a>02223     <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#add557738778e863a1381883ae4864c6d">NS_ERROR_NOT_AVAILABLE</a>;
<a name="l02224"></a>02224 
<a name="l02225"></a>02225   <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l02226"></a>02226 }
<a name="l02227"></a>02227 
<a name="l02231"></a>02231 <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l02232"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a38b24c6a4c4f082497d4879d0953be54">02232</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a38b24c6a4c4f082497d4879d0953be54">net_EnsurePSMInit</a>()
<a name="l02233"></a>02233 {
<a name="l02234"></a>02234     nsCOMPtr&lt;nsISocketProviderService&gt; spserv =
<a name="l02235"></a>02235             <a class="code" href="../../d4/d2f/ns_service_manager_utils_8h.html#aa748eea5e1aca70481a32f78ee8b8a5d">do_GetService</a>(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#ad87f3ceb6f10f1ee044a599ca9c679c9">NS_SOCKETPROVIDERSERVICE_CONTRACTID</a>);
<a name="l02236"></a>02236     <span class="keywordflow">if</span> (spserv) {
<a name="l02237"></a>02237         nsCOMPtr&lt;nsISocketProvider&gt; provider;
<a name="l02238"></a>02238         spserv-&gt;GetSocketProvider(<span class="stringliteral">&quot;ssl&quot;</span>, <a class="code" href="../../de/db2/ns_auto_ptr_8h.html#a3892f2732d861ecbf1e20826158db1b6">getter_AddRefs</a>(provider));
<a name="l02239"></a>02239     }
<a name="l02240"></a>02240 }
<a name="l02241"></a>02241 
<a name="l02245"></a>02245 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l02246"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0d2051c0e5d9e3ae0baefdb024578bb1">02246</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#a0d2051c0e5d9e3ae0baefdb024578bb1">NS_IsAboutBlank</a>(<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html">nsIURI</a> *uri)
<a name="l02247"></a>02247 {
<a name="l02248"></a>02248     <span class="comment">// GetSpec can be expensive for some URIs, so check the scheme first.</span>
<a name="l02249"></a>02249     <span class="keywordtype">bool</span> isAbout = <span class="keyword">false</span>;
<a name="l02250"></a>02250     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#aa93f0a70abc62748a73c451b59f02f35">NS_FAILED</a>(uri-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#ab8961f294ddfab8b4af8fe5a600a506c">SchemeIs</a>(<span class="stringliteral">&quot;about&quot;</span>, &amp;isAbout)) || !isAbout) {
<a name="l02251"></a>02251         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02252"></a>02252     }
<a name="l02253"></a>02253 
<a name="l02254"></a>02254     nsAutoCString <a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>;
<a name="l02255"></a>02255     uri-&gt;<a class="code" href="../../dd/d71/interfacens_i_u_r_i.html#a1ca7898fa50ad2c3660f6949968fb653">GetSpec</a>(str);
<a name="l02256"></a>02256     <span class="keywordflow">return</span> str.EqualsLiteral(<span class="stringliteral">&quot;about:blank&quot;</span>);
<a name="l02257"></a>02257 }
<a name="l02258"></a>02258 
<a name="l02259"></a>02259 
<a name="l02260"></a>02260 <span class="keyword">inline</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a>
<a name="l02261"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#aca11c80edfd5dce376b53e51c92c235d">02261</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#aca11c80edfd5dce376b53e51c92c235d">NS_GenerateHostPort</a>(<span class="keyword">const</span> nsCString&amp; host, int32_t <a class="code" href="../../df/d9e/prnetdb_8h.html#a2442718810e8bab593a8ef904979ca72">port</a>,
<a name="l02262"></a>02262                     nsCString&amp; hostLine)
<a name="l02263"></a>02263 {
<a name="l02264"></a>02264     <span class="keywordflow">if</span> (strchr(host.get(), <span class="charliteral">&#39;:&#39;</span>)) {
<a name="l02265"></a>02265         <span class="comment">// host is an IPv6 address literal and must be encapsulated in []&#39;s</span>
<a name="l02266"></a>02266         hostLine.Assign(<span class="charliteral">&#39;[&#39;</span>);
<a name="l02267"></a>02267         <span class="comment">// scope id is not needed for Host header.</span>
<a name="l02268"></a>02268         <span class="keywordtype">int</span> scopeIdPos = host.FindChar(<span class="charliteral">&#39;%&#39;</span>);
<a name="l02269"></a>02269         <span class="keywordflow">if</span> (scopeIdPos == -1)
<a name="l02270"></a>02270             hostLine.Append(host);
<a name="l02271"></a>02271         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (scopeIdPos &gt; 0)
<a name="l02272"></a>02272             hostLine.Append(<a class="code" href="../../df/dcc/ns_t_dependent_substring_8h.html#ad8f513313d25840a8edcfa54257f5f1a">Substring</a>(host, 0, scopeIdPos));
<a name="l02273"></a>02273         <span class="keywordflow">else</span>
<a name="l02274"></a>02274           <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a31b088e90e599cd2d6a92ab31a796159">NS_ERROR_MALFORMED_URI</a>;
<a name="l02275"></a>02275         hostLine.Append(<span class="charliteral">&#39;]&#39;</span>);
<a name="l02276"></a>02276     }
<a name="l02277"></a>02277     <span class="keywordflow">else</span>
<a name="l02278"></a>02278         hostLine.Assign(host);
<a name="l02279"></a>02279     <span class="keywordflow">if</span> (port != -1) {
<a name="l02280"></a>02280         hostLine.Append(<span class="charliteral">&#39;:&#39;</span>);
<a name="l02281"></a>02281         hostLine.AppendInt(port);
<a name="l02282"></a>02282     }
<a name="l02283"></a>02283     <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a03a7f9e8069d114c0495679caefca965">NS_OK</a>;
<a name="l02284"></a>02284 }
<a name="l02285"></a>02285 
<a name="l02294"></a>02294 <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l02295"></a><a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad98cc8af7a3cbc634ec02cfd4350b0a2">02295</a> <a class="code" href="../../d9/d5b/ns_net_util_8h.html#ad98cc8af7a3cbc634ec02cfd4350b0a2">NS_SniffContent</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* aSnifferType, <a class="code" href="../../d8/d9e/interfacens_i_request.html">nsIRequest</a>* aRequest,
<a name="l02296"></a>02296                 <span class="keyword">const</span> uint8_t* <a class="code" href="../../d6/d1d/ns_x_p_c_o_m_strings_8h.html#a580e3d1c78551e30e0c97ab45dc8a3b5">aData</a>, uint32_t aLength,
<a name="l02297"></a>02297                 nsACString&amp; aSniffedType)
<a name="l02298"></a>02298 {
<a name="l02299"></a>02299   <span class="keyword">typedef</span> nsCategoryCache&lt;nsIContentSniffer&gt; ContentSnifferCache;
<a name="l02300"></a>02300   <span class="keyword">extern</span> <a class="code" href="../../d3/dd8/nscore_8h.html#ac19fc71a78771eb7bf7dead68bc74db6">NS_HIDDEN_</a>(ContentSnifferCache*) gNetSniffers;
<a name="l02301"></a>02301   <span class="keyword">extern</span> <a class="code" href="../../d3/dd8/nscore_8h.html#ac19fc71a78771eb7bf7dead68bc74db6">NS_HIDDEN_</a>(ContentSnifferCache*) gDataSniffers;
<a name="l02302"></a>02302   ContentSnifferCache* <a class="code" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a> = <span class="keyword">nullptr</span>;
<a name="l02303"></a>02303   <span class="keywordflow">if</span> (!strcmp(aSnifferType, <a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#aac614b7310fea2aed3b3e72f08b73d21">NS_CONTENT_SNIFFER_CATEGORY</a>)) {
<a name="l02304"></a>02304     <span class="keywordflow">if</span> (!gNetSniffers) {
<a name="l02305"></a>02305       gNetSniffers = <span class="keyword">new</span> ContentSnifferCache(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#aac614b7310fea2aed3b3e72f08b73d21">NS_CONTENT_SNIFFER_CATEGORY</a>);
<a name="l02306"></a>02306     }
<a name="l02307"></a>02307     cache = gNetSniffers;
<a name="l02308"></a>02308   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(aSnifferType, <a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a4eb5155bdfbbd6e41e2bb0ef9904642b">NS_DATA_SNIFFER_CATEGORY</a>)) {
<a name="l02309"></a>02309     <span class="keywordflow">if</span> (!gDataSniffers) {
<a name="l02310"></a>02310       gDataSniffers = <span class="keyword">new</span> ContentSnifferCache(<a class="code" href="../../de/d9c/ns_net_c_i_d_8h.html#a4eb5155bdfbbd6e41e2bb0ef9904642b">NS_DATA_SNIFFER_CATEGORY</a>);
<a name="l02311"></a>02311     }
<a name="l02312"></a>02312     cache = gDataSniffers;
<a name="l02313"></a>02313   } <span class="keywordflow">else</span> {
<a name="l02314"></a>02314     <span class="comment">// Invalid content sniffer type was requested</span>
<a name="l02315"></a>02315     <a class="code" href="../../d9/de9/_assertions_8h.html#aa2fa77a048d036cb2f902299ace18165">MOZ_ASSERT</a>(<span class="keyword">false</span>);
<a name="l02316"></a>02316     <span class="keywordflow">return</span>;
<a name="l02317"></a>02317   }
<a name="l02318"></a>02318 
<a name="l02319"></a>02319   <span class="keyword">const</span> <a class="code" href="../../d3/d4e/classns_c_o_m_array.html">nsCOMArray&lt;nsIContentSniffer&gt;</a>&amp; sniffers = cache-&gt;GetEntries();
<a name="l02320"></a>02320   <span class="keywordflow">for</span> (int32_t <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = 0; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; sniffers.<a class="code" href="../../d7/d1e/classns_c_o_m_array__base.html#a583a8d6a00c087e66e601d00d3018fb9">Count</a>(); ++<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>) {
<a name="l02321"></a>02321     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> rv = sniffers[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>]-&gt;GetMIMETypeFromContent(aRequest, aData, aLength, aSniffedType);
<a name="l02322"></a>02322     <span class="keywordflow">if</span> (<a class="code" href="../../d8/dcf/ns_error_8h.html#acd00c826e726e26de788f186895a26b7">NS_SUCCEEDED</a>(rv) &amp;&amp; !aSniffedType.IsEmpty()) {
<a name="l02323"></a>02323       <span class="keywordflow">return</span>;
<a name="l02324"></a>02324     }
<a name="l02325"></a>02325   }
<a name="l02326"></a>02326 
<a name="l02327"></a>02327   aSniffedType.Truncate();
<a name="l02328"></a>02328 }
<a name="l02329"></a>02329 
<a name="l02330"></a>02330 <span class="preprocessor">#endif // !nsNetUtil_h__</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d9/d5b/ns_net_util_8h.html">nsNetUtil.h</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:53:40に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
