<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: thread_ui_test.js ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d9/d25/thread__ui__test_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">thread_ui_test.js</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d9/d25/thread__ui__test_8js.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../d9/d25/thread__ui__test_8js.html#ae2475e10618961c050dcba04e8c42331">00001</a> <span class="stringliteral">&#39;use strict&#39;</span>;
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 mocha.setup({ <a class="code" href="../../d8/d44/sd__test_8js.html#affd3010a3b7d833bb71f8362d310b81f">globals</a>: [<span class="stringliteral">&#39;alert&#39;</span>] });
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">// For Desktop testing</span>
<a name="l00006"></a><a class="code" href="../../d9/d25/thread__ui__test_8js.html#a65606686b3891822d17e1e523983fe07">00006</a> <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozContacts) {
<a name="l00007"></a>00007   <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/js/desktop_contact_mock.js&#39;</span>);
<a name="l00008"></a>00008 }
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/js/compose.js&#39;</span>);
<a name="l00011"></a>00011 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/js/threads.js&#39;</span>);
<a name="l00012"></a>00012 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/js/thread_ui.js&#39;</span>);
<a name="l00013"></a>00013 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/js/utils.js&#39;</span>);
<a name="l00014"></a>00014 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/js/message_manager.js&#39;</span>);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_alert.js&#39;</span>);
<a name="l00017"></a>00017 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_link_action_handler.js&#39;</span>);
<a name="l00018"></a>00018 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_attachment.js&#39;</span>);
<a name="l00019"></a>00019 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_attachment_menu.js&#39;</span>);
<a name="l00020"></a>00020 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_l10n.js&#39;</span>);
<a name="l00021"></a>00021 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_utils.js&#39;</span>);
<a name="l00022"></a>00022 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_navigatormoz_sms.js&#39;</span>);
<a name="l00023"></a>00023 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_moz_sms_filter.js&#39;</span>);
<a name="l00024"></a>00024 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_link_helper.js&#39;</span>);
<a name="l00025"></a>00025 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_moz_activity.js&#39;</span>);
<a name="l00026"></a>00026 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/shared/test/unit/mocks/mock_navigator_moz_settings.js&#39;</span>);
<a name="l00027"></a>00027 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_messages.js&#39;</span>);
<a name="l00028"></a>00028 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_contact.js&#39;</span>);
<a name="l00029"></a>00029 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_contacts.js&#39;</span>);
<a name="l00030"></a>00030 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_recipients.js&#39;</span>);
<a name="l00031"></a>00031 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_settings.js&#39;</span>);
<a name="l00032"></a>00032 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_activity_picker.js&#39;</span>);
<a name="l00033"></a>00033 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_action_menu.js&#39;</span>);
<a name="l00034"></a>00034 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_dialog.js&#39;</span>);
<a name="l00035"></a>00035 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_smil.js&#39;</span>);
<a name="l00036"></a>00036 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_custom_dialog.js&#39;</span>);
<a name="l00037"></a>00037 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_url.js&#39;</span>);
<a name="l00038"></a>00038 <a class="code" href="../../d9/d87/browser__db__test_8js.html#ad548b08f6e63e350af60da8702015c5d">requireApp</a>(<span class="stringliteral">&#39;sms/test/unit/mock_compose.js&#39;</span>);
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="../../d9/d25/thread__ui__test_8js.html#aebcc27c0d7c71338b1ecc8fcf07e85c7">00040</a> var <a class="code" href="../../d9/d25/thread__ui__test_8js.html#aebcc27c0d7c71338b1ecc8fcf07e85c7">mocksHelperForThreadUI</a> = <span class="keyword">new</span> <a class="code" href="../../d1/d67/apps_2communications_2test_2unit_2mocks__helper_8js.html#ac677357b5a0ce4a59a54e9a0a861f480">MocksHelper</a>([
<a name="l00041"></a>00041   <span class="stringliteral">&#39;Attachment&#39;</span>,
<a name="l00042"></a>00042   <span class="stringliteral">&#39;AttachmentMenu&#39;</span>,
<a name="l00043"></a>00043   <span class="stringliteral">&#39;Utils&#39;</span>,
<a name="l00044"></a>00044   <span class="stringliteral">&#39;Settings&#39;</span>,
<a name="l00045"></a>00045   <span class="stringliteral">&#39;Recipients&#39;</span>,
<a name="l00046"></a>00046   <span class="stringliteral">&#39;LinkActionHandler&#39;</span>,
<a name="l00047"></a>00047   <span class="stringliteral">&#39;LinkHelper&#39;</span>,
<a name="l00048"></a>00048   <span class="stringliteral">&#39;MozActivity&#39;</span>,
<a name="l00049"></a>00049   <span class="stringliteral">&#39;MozSmsFilter&#39;</span>,
<a name="l00050"></a>00050   <span class="stringliteral">&#39;ActivityPicker&#39;</span>,
<a name="l00051"></a>00051   <span class="stringliteral">&#39;OptionMenu&#39;</span>,
<a name="l00052"></a>00052   <span class="stringliteral">&#39;Dialog&#39;</span>,
<a name="l00053"></a>00053   <span class="stringliteral">&#39;Contacts&#39;</span>,
<a name="l00054"></a>00054   <span class="stringliteral">&#39;SMIL&#39;</span>
<a name="l00055"></a>00055 ]);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 mocksHelperForThreadUI.init();
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;thread_ui.js &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00060"></a>00060   var <a class="code" href="../../d6/da7/wire__format__lite_8h.html#a2965939d8d22ec60c89f74062f0c370c">input</a>;
<a name="l00061"></a>00061   var <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>;
<a name="l00062"></a>00062   var sendButton;
<a name="l00063"></a>00063   var composeForm;
<a name="l00064"></a>00064   var recipient;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   var <a class="code" href="../../d3/dd6/balance__view__test_8js.html#abdff2ecb3bab4f68645e0a4bada3ea4a">realMozL10n</a>;
<a name="l00067"></a>00067   var realMozMobileMessage;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   var <a class="code" href="../../d6/d9c/operator_variant__test_8js.html#a0febeec624e264448191b704321c7df1">mocksHelper</a> = <a class="code" href="../../d9/d25/thread__ui__test_8js.html#aebcc27c0d7c71338b1ecc8fcf07e85c7">mocksHelperForThreadUI</a>;
<a name="l00070"></a>00070   var testImageBlob;
<a name="l00071"></a>00071   var oversizedImageBlob;
<a name="l00072"></a>00072   var testAudioBlob;
<a name="l00073"></a>00073   var testVideoBlob;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075   <span class="keyword">function</span> mockAttachment(<a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a6d7e27eaec1e5f6600e65858be43c18b">size</a>) {
<a name="l00076"></a>00076     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../d2/d81/mock__attachment_8js.html#a2d551682f84186338b0fc2212832f508">MockAttachment</a>({
<a name="l00077"></a>00077       <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;video/ogg&#39;</span>,
<a name="l00078"></a>00078       <a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a6d7e27eaec1e5f6600e65858be43c18b">size</a>: <a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a6d7e27eaec1e5f6600e65858be43c18b">size</a>
<a name="l00079"></a>00079     }, <span class="stringliteral">&#39;video.ogv&#39;</span>);
<a name="l00080"></a>00080   }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <span class="keyword">function</span> mockImgAttachment(isOversized) {
<a name="l00083"></a>00083     var attachment = isOversized ?
<a name="l00084"></a>00084       <span class="keyword">new</span> <a class="code" href="../../d2/d81/mock__attachment_8js.html#a2d551682f84186338b0fc2212832f508">MockAttachment</a>(oversizedImageBlob, <span class="stringliteral">&#39;testOversized.jpg&#39;</span>) :
<a name="l00085"></a>00085       new MockAttachment(testImageBlob, <span class="stringliteral">&#39;test.jpg&#39;</span>);
<a name="l00086"></a>00086     <span class="keywordflow">return</span> attachment;
<a name="l00087"></a>00087   }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   suiteSetup(<span class="keyword">function</span>(<a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>) {
<a name="l00090"></a>00090     this.<a class="code" href="../../da/d32/prio_8h.html#a0f2163507f01dc9bb68ca5c72cacaa34">timeout</a>(5000);
<a name="l00091"></a>00091     mocksHelper.suiteSetup();
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     realMozL10n = <a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n;
<a name="l00094"></a>00094     <a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n = <a class="code" href="../../dd/d07/communications_2ftu_2test_2unit_2mock__l10n_8js.html#af9a9d6d42b9a7f8153f63783711f14c3">MockL10n</a>;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     var assetsNeeded = 0;
<a name="l00097"></a>00097     <span class="keyword">function</span> getAsset(<a class="code" href="../../d2/d7d/jsapi_8h.html#a9b61fad0b15688b43345d3f5c3a3d44b">filename</a>, loadCallback) {
<a name="l00098"></a>00098       assetsNeeded++;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100       var <a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a42c43c76081a7df8ae2954f16ee9338b">req</a> = <span class="keyword">new</span> <a class="code" href="../../d0/dfb/namespacemozilla_1_1dom_1_1prototypes_1_1id.html#addcec93baff9084aadf2519231ea4a28a2619068a621e6b22d7995161b2cea021">XMLHttpRequest</a>();
<a name="l00101"></a>00101       req.open(<span class="stringliteral">&#39;GET&#39;</span>, <a class="code" href="../../d2/d7d/jsapi_8h.html#a9b61fad0b15688b43345d3f5c3a3d44b">filename</a>, <span class="keyword">true</span>);
<a name="l00102"></a>00102       req.responseType = <span class="stringliteral">&#39;blob&#39;</span>;
<a name="l00103"></a>00103       req.onload = <span class="keyword">function</span>() {
<a name="l00104"></a>00104         loadCallback(req.response);
<a name="l00105"></a>00105         <span class="keywordflow">if</span> (--assetsNeeded === 0) {
<a name="l00106"></a>00106           <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108       };
<a name="l00109"></a>00109       req.send();
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111     getAsset(<span class="stringliteral">&#39;/test/unit/media/kitten-450.jpg&#39;</span>, <span class="keyword">function</span>(blob) {
<a name="l00112"></a>00112       testImageBlob = blob;
<a name="l00113"></a>00113     });
<a name="l00114"></a>00114     getAsset(<span class="stringliteral">&#39;/test/unit/media/IMG_0554.jpg&#39;</span>, <span class="keyword">function</span>(blob) {
<a name="l00115"></a>00115       oversizedImageBlob = blob;
<a name="l00116"></a>00116     });
<a name="l00117"></a>00117     getAsset(<span class="stringliteral">&#39;/test/unit/media/audio.oga&#39;</span>, <span class="keyword">function</span>(blob) {
<a name="l00118"></a>00118       testAudioBlob = blob;
<a name="l00119"></a>00119     });
<a name="l00120"></a>00120     getAsset(<span class="stringliteral">&#39;/test/unit/media/video.ogv&#39;</span>, <span class="keyword">function</span>(blob) {
<a name="l00121"></a>00121       testVideoBlob = blob;
<a name="l00122"></a>00122     });
<a name="l00123"></a>00123   });
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   suiteTeardown(<span class="keyword">function</span>() {
<a name="l00126"></a>00126     <a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n = <a class="code" href="../../d3/dd6/balance__view__test_8js.html#abdff2ecb3bab4f68645e0a4bada3ea4a">realMozL10n</a>;
<a name="l00127"></a>00127     mocksHelper.suiteTeardown();
<a name="l00128"></a>00128   });
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00131"></a>00131     mocksHelper.setup();
<a name="l00132"></a>00132     loadBodyHTML(<span class="stringliteral">&#39;/index.html&#39;</span>);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     input = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-input&#39;</span>);
<a name="l00135"></a>00135     container = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-container&#39;</span>);
<a name="l00136"></a>00136     sendButton = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-send-button&#39;</span>);
<a name="l00137"></a>00137     composeForm = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-compose-form&#39;</span>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     this.sinon.useFakeTimers();
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     ThreadUI.recipients = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00142"></a>00142     ThreadUI.init();
<a name="l00143"></a>00143     realMozMobileMessage = ThreadUI._mozMobileMessage;
<a name="l00144"></a>00144     ThreadUI._mozMobileMessage = <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>;
<a name="l00145"></a>00145   });
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   teardown(<span class="keyword">function</span>() {
<a name="l00148"></a>00148     <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTeardown();
<a name="l00151"></a>00151     mocksHelper.teardown();
<a name="l00152"></a>00152     ThreadUI._mozMobileMessage = realMozMobileMessage;
<a name="l00153"></a>00153   });
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;scrolling&#39;</span>, <span class="keyword">function</span>() {
<a name="l00156"></a>00156     teardown(<span class="keyword">function</span>() {
<a name="l00157"></a>00157       container.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00158"></a>00158     });
<a name="l00159"></a>00159     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00160"></a>00160       <span class="comment">// we don&#39;t have CSS so we must force the scroll here</span>
<a name="l00161"></a>00161       container.style.overflow = <span class="stringliteral">&#39;scroll&#39;</span>;
<a name="l00162"></a>00162       container.style.height = <span class="stringliteral">&#39;50px&#39;</span>;
<a name="l00163"></a>00163       <span class="comment">// fake content</span>
<a name="l00164"></a>00164       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#acd145aedb51101ac15a526f73673b0b9">innerHTML</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00165"></a>00165       <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = 0; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; 99; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++) {
<a name="l00166"></a>00166         innerHTML += ThreadUI.tmpl.message.interpolate({
<a name="l00167"></a>00167           <span class="keywordtype">id</span>: String(<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>),
<a name="l00168"></a>00168           bodyHTML: <span class="stringliteral">&#39;test #&#39;</span> + <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>
<a name="l00169"></a>00169         });
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171       container.innerHTML = <a class="code" href="../../d1/d04/app__install__manager_8js.html#acd145aedb51101ac15a526f73673b0b9">innerHTML</a>;
<a name="l00172"></a>00172       <span class="comment">// This crudely emulates the CSS styles applied to the message list</span>
<a name="l00173"></a>00173       container.lastElementChild.style.paddingBottom = <span class="stringliteral">&#39;16px&#39;</span>;
<a name="l00174"></a>00174     });
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;scroll 100px, should be detected as a manual scroll&#39;</span>, <span class="keyword">function</span>(<a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>) {
<a name="l00177"></a>00177       container.addEventListener(<span class="stringliteral">&#39;scroll&#39;</span>, <span class="keyword">function</span> onscroll() {
<a name="l00178"></a>00178         container.removeEventListener(<span class="stringliteral">&#39;scroll&#39;</span>, onscroll);
<a name="l00179"></a>00179         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(ThreadUI.isScrolledManually);
<a name="l00180"></a>00180         <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();
<a name="l00181"></a>00181       });
<a name="l00182"></a>00182       container.scrollTop = 100;
<a name="l00183"></a>00183     });
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;scroll to bottom, should be detected as an automatic scroll&#39;</span>,
<a name="l00186"></a>00186     <span class="keyword">function</span>(<a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>) {
<a name="l00187"></a>00187       container.addEventListener(<span class="stringliteral">&#39;scroll&#39;</span>, <span class="keyword">function</span> onscroll() {
<a name="l00188"></a>00188         container.removeEventListener(<span class="stringliteral">&#39;scroll&#39;</span>, onscroll);
<a name="l00189"></a>00189         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(ThreadUI.isScrolledManually);
<a name="l00190"></a>00190         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok((container.scrollTop + container.clientHeight) ==
<a name="l00191"></a>00191                   container.scrollHeight);
<a name="l00192"></a>00192         <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();
<a name="l00193"></a>00193       });
<a name="l00194"></a>00194       ThreadUI.isScrolledManually = <span class="keyword">false</span>;
<a name="l00195"></a>00195       ThreadUI.scrollViewToBottom();
<a name="l00196"></a>00196     });
<a name="l00197"></a>00197   });
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Search&#39;</span>, <span class="keyword">function</span>() {
<a name="l00200"></a>00200     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;search results cleared&#39;</span>, <span class="keyword">function</span>() {
<a name="l00201"></a>00201       Compose.clear();
<a name="l00202"></a>00202       Compose.append(<span class="stringliteral">&#39;foo&#39;</span>);
<a name="l00203"></a>00203       ThreadUI.cleanFields(<span class="keyword">true</span>);
<a name="l00204"></a>00204       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(Compose.getContent(), <span class="stringliteral">&#39;&#39;</span>);
<a name="l00205"></a>00205     });
<a name="l00206"></a>00206   });
<a name="l00207"></a>00207 
<a name="l00208"></a>00208   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;enableSend() &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00209"></a>00209     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00210"></a>00210       Compose.clear();
<a name="l00211"></a>00211       ThreadUI.updateCounter();
<a name="l00212"></a>00212       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread-1&#39;</span>;
<a name="l00213"></a>00213     });
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     teardown(<span class="keyword">function</span>() {
<a name="l00216"></a>00216       Compose.clear();
<a name="l00217"></a>00217       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00218"></a>00218     });
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Thread View&#39;</span>, <span class="keyword">function</span>() {
<a name="l00221"></a>00221       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00222"></a>00222         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread-1&#39;</span>;
<a name="l00223"></a>00223       });
<a name="l00224"></a>00224 
<a name="l00225"></a>00225       teardown(<span class="keyword">function</span>() {
<a name="l00226"></a>00226         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00227"></a>00227       });
<a name="l00228"></a>00228 
<a name="l00229"></a>00229       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should be disabled at the beginning&#39;</span>, <span class="keyword">function</span>() {
<a name="l00230"></a>00230         Compose.clear();
<a name="l00231"></a>00231         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(sendButton.disabled);
<a name="l00232"></a>00232       });
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should be enabled when there is some text&#39;</span>, <span class="keyword">function</span>() {
<a name="l00235"></a>00235         Compose.append(<span class="stringliteral">&#39;Hola&#39;</span>);
<a name="l00236"></a>00236         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.disabled);
<a name="l00237"></a>00237       });
<a name="l00238"></a>00238 
<a name="l00239"></a>00239       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should not be disabled if there is some text &#39;</span> +
<a name="l00240"></a>00240         <span class="stringliteral">&#39;but too many segments&#39;</span>, <span class="keyword">function</span>() {
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         Compose.append(<span class="stringliteral">&#39;Hola&#39;</span>);
<a name="l00243"></a>00243         this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         var segmentInfo = {
<a name="l00246"></a>00246           segments: 11,
<a name="l00247"></a>00247           charsAvailableInLastSegment: 10
<a name="l00248"></a>00248         };
<a name="l00249"></a>00249         <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.disabled);
<a name="l00252"></a>00252       });
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     });
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;#new mode &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00258"></a>00258       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00259"></a>00259         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#new&#39;</span>;
<a name="l00260"></a>00260         Compose.clear();
<a name="l00261"></a>00261         ThreadUI.recipients.length = 0;
<a name="l00262"></a>00262         ThreadUI.recipients.inputValue = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00263"></a>00263       });
<a name="l00264"></a>00264 
<a name="l00265"></a>00265       teardown(<span class="keyword">function</span>() {
<a name="l00266"></a>00266         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00267"></a>00267         Compose.clear();
<a name="l00268"></a>00268         ThreadUI.recipients.length = 0;
<a name="l00269"></a>00269         ThreadUI.recipients.inputValue = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00270"></a>00270       });
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should be disabled when there is neither contact or input&#39;</span>,
<a name="l00273"></a>00273         <span class="keyword">function</span>() {
<a name="l00274"></a>00274         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(sendButton.disabled);
<a name="l00275"></a>00275       });
<a name="l00276"></a>00276 
<a name="l00277"></a>00277       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should be disabled when there is no contact&#39;</span>, <span class="keyword">function</span>() {
<a name="l00278"></a>00278         Compose.append(<span class="stringliteral">&#39;Hola&#39;</span>);
<a name="l00279"></a>00279         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(sendButton.disabled);
<a name="l00280"></a>00280       });
<a name="l00281"></a>00281 
<a name="l00282"></a>00282       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should be enabled with recipient input&#39;</span>, <span class="keyword">function</span>() {
<a name="l00283"></a>00283         Compose.append(<span class="stringliteral">&#39;Hola&#39;</span>);
<a name="l00284"></a>00284         ThreadUI.recipients.inputValue = <span class="stringliteral">&#39;999&#39;</span>;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="comment">// Call directly since no input event will be triggered</span>
<a name="l00287"></a>00287         ThreadUI.enableSend();
<a name="l00288"></a>00288         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.disabled);
<a name="l00289"></a>00289       });
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should be enabled after adding a recipient when text exists&#39;</span>,
<a name="l00292"></a>00292         <span class="keyword">function</span>() {
<a name="l00293"></a>00293         Compose.append(<span class="stringliteral">&#39;Hola&#39;</span>);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         ThreadUI.recipients.add({
<a name="l00296"></a>00296           number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l00297"></a>00297         });
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.disabled);
<a name="l00300"></a>00300       });
<a name="l00301"></a>00301 
<a name="l00302"></a>00302       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should be enabled after adding text when recipient exists&#39;</span>,
<a name="l00303"></a>00303         <span class="keyword">function</span>() {
<a name="l00304"></a>00304 
<a name="l00305"></a>00305         ThreadUI.recipients.add({
<a name="l00306"></a>00306           number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l00307"></a>00307         });
<a name="l00308"></a>00308         Compose.append(<span class="stringliteral">&#39;Hola&#39;</span>);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.disabled);
<a name="l00311"></a>00311       });
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       <span class="comment">// TODO: Fix this test to be about being over the MMS limit inside #840035</span>
<a name="l00314"></a>00314 
<a name="l00315"></a>00315       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button should be disabled when there is both contact and &#39;</span> +
<a name="l00316"></a>00316           <span class="stringliteral">&#39;input, but too much data to send as mms&#39;</span>,
<a name="l00317"></a>00317         <span class="keyword">function</span>() {
<a name="l00318"></a>00318 
<a name="l00319"></a>00319         ThreadUI.recipients.add({
<a name="l00320"></a>00320           number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l00321"></a>00321         });
<a name="l00322"></a>00322 
<a name="l00323"></a>00323         Compose.append(mockAttachment(300 * 1024));
<a name="l00324"></a>00324 
<a name="l00325"></a>00325         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.disabled);
<a name="l00326"></a>00326         Compose.append(<span class="stringliteral">&#39;Hola&#39;</span>);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(sendButton.disabled);
<a name="l00329"></a>00329       });
<a name="l00330"></a>00330 
<a name="l00331"></a>00331       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;When adding an image that is under the limitation, button &#39;</span> +
<a name="l00332"></a>00332            <span class="stringliteral">&#39;should be enabled right after appended&#39;</span>,
<a name="l00333"></a>00333         <span class="keyword">function</span>() {
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         ThreadUI.recipients.add({
<a name="l00336"></a>00336           number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l00337"></a>00337         });
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         Compose.append(mockImgAttachment());
<a name="l00340"></a>00340         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.disabled);
<a name="l00341"></a>00341       });
<a name="l00342"></a>00342 
<a name="l00343"></a>00343       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;When adding an oversized image, button should be disabled while &#39;</span> +
<a name="l00344"></a>00344            <span class="stringliteral">&#39;resizing and enabled when resize complete&#39;</span>,
<a name="l00345"></a>00345         <span class="keyword">function</span>(<a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>) {
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         ThreadUI.recipients.add({
<a name="l00348"></a>00348           number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l00349"></a>00349         });
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         <span class="keyword">function</span> onInput() {
<a name="l00352"></a>00352           <span class="keywordflow">if</span> (!Compose.isResizing) {
<a name="l00353"></a>00353             Compose.off(<span class="stringliteral">&#39;input&#39;</span>, onInput);
<a name="l00354"></a>00354             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.disabled);
<a name="l00355"></a>00355             <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();
<a name="l00356"></a>00356           }
<a name="l00357"></a>00357         };
<a name="l00358"></a>00358         Compose.on(<span class="stringliteral">&#39;input&#39;</span>, onInput);
<a name="l00359"></a>00359         Compose.append(mockImgAttachment(<span class="keyword">true</span>));
<a name="l00360"></a>00360         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(sendButton.disabled);
<a name="l00361"></a>00361       });
<a name="l00362"></a>00362     });
<a name="l00363"></a>00363   });
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;updateCounter() &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00366"></a>00366     var banner, convertBanner, shouldEnableSend, form, <a class="code" href="../../d1/de1/apps_2settings_2js_2utils_8js.html#a32930d17cd0e3a8078d1a8e5207cfc4d">localize</a>;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00369"></a>00369       banner = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-max-length-notice&#39;</span>);
<a name="l00370"></a>00370       convertBanner = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-convert-notice&#39;</span>);
<a name="l00371"></a>00371       form = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-compose-form&#39;</span>);
<a name="l00372"></a>00372       localize = this.sinon.spy(<a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n, <span class="stringliteral">&#39;localize&#39;</span>);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374       <span class="comment">// let any update timeout play so that we don&#39;t have false errors</span>
<a name="l00375"></a>00375       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377       <span class="comment">// and reset any previous possible state</span>
<a name="l00378"></a>00378       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTeardown();
<a name="l00379"></a>00379     });
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <span class="keyword">function</span> updateCounter(segmentInfo) {
<a name="l00382"></a>00382       <span class="comment">// display the banner to check that it is correctly hidden</span>
<a name="l00383"></a>00383       banner.classList.remove(<span class="stringliteral">&#39;hide&#39;</span>);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385       <span class="comment">// add a lock to check that it is correctly removed</span>
<a name="l00386"></a>00386       Compose.lock = <span class="keyword">true</span>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388       shouldEnableSend = ThreadUI.updateCounter();
<a name="l00389"></a>00389       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00390"></a>00390       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     var initialText = <span class="stringliteral">&#39;some text&#39;</span>;
<a name="l00394"></a>00394     var followingText = <span class="stringliteral">&#39;some other text&#39;</span>;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;do not call getSegmentInfoForText twice in a row&#39;</span>, <span class="keyword">function</span>() {
<a name="l00397"></a>00397       var spy = this.sinon.spy(<a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>,
<a name="l00398"></a>00398         <span class="stringliteral">&#39;getSegmentInfoForText&#39;</span>);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400       Compose.append(initialText);
<a name="l00401"></a>00401       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY / 2);
<a name="l00402"></a>00402       Compose.append(followingText);
<a name="l00403"></a>00403       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(spy.callCount, 1);
<a name="l00406"></a>00406       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(spy.calledWith(initialText + followingText));
<a name="l00407"></a>00407     });
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;getSegmentInfoForText error hides the counter&#39;</span>, <span class="keyword">function</span>() {
<a name="l00410"></a>00410       sendButton.classList.add(<span class="stringliteral">&#39;has-counter&#39;</span>);
<a name="l00411"></a>00411       Compose.append(initialText);
<a name="l00412"></a>00412       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00413"></a>00413       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoError();
<a name="l00414"></a>00414 
<a name="l00415"></a>00415       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.classList.contains(<span class="stringliteral">&#39;has-counter&#39;</span>));
<a name="l00416"></a>00416     });
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;asynchronous tricky tests &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00419"></a>00419       var spy;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421       var segmentInfo1 = {
<a name="l00422"></a>00422         segments: 1,
<a name="l00423"></a>00423         charsAvailableInLastSegment: 50
<a name="l00424"></a>00424       };
<a name="l00425"></a>00425 
<a name="l00426"></a>00426       var segmentInfo2 = {
<a name="l00427"></a>00427         segments: 1,
<a name="l00428"></a>00428         charsAvailableInLastSegment: 40
<a name="l00429"></a>00429       };
<a name="l00430"></a>00430 
<a name="l00431"></a>00431       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00432"></a>00432         spy = this.sinon.spy(<a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>,
<a name="l00433"></a>00433           <span class="stringliteral">&#39;getSegmentInfoForText&#39;</span>);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435         Compose.append(initialText);
<a name="l00436"></a>00436         this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <span class="comment">// the user appends more text before the segment info request returns</span>
<a name="l00439"></a>00439         Compose.append(followingText);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441         <span class="comment">// wait for the next update delay =&gt; should fire</span>
<a name="l00442"></a>00442         this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444       });
<a name="l00445"></a>00445 
<a name="l00446"></a>00446       teardown(<span class="keyword">function</span>() {
<a name="l00447"></a>00447         Compose.clear();
<a name="l00448"></a>00448       });
<a name="l00449"></a>00449 
<a name="l00450"></a>00450       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;getSegmentInfoForText got called twice&#39;</span>, <span class="keyword">function</span>() {
<a name="l00451"></a>00451         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(spy.callCount, 2);
<a name="l00452"></a>00452         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(spy.getCall(0).calledWith(initialText));
<a name="l00453"></a>00453         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(spy.getCall(1).calledWith(initialText + followingText));
<a name="l00454"></a>00454       });
<a name="l00455"></a>00455 
<a name="l00456"></a>00456       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;segment info requests return ordered&#39;</span>, <span class="keyword">function</span>() {
<a name="l00457"></a>00457         <span class="comment">// answer the first request</span>
<a name="l00458"></a>00458         <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(
<a name="l00459"></a>00459           segmentInfo1, 0
<a name="l00460"></a>00460         );
<a name="l00461"></a>00461 
<a name="l00462"></a>00462         <span class="comment">// answer the second request</span>
<a name="l00463"></a>00463         <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(
<a name="l00464"></a>00464           segmentInfo2, 0
<a name="l00465"></a>00465         );
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         var <a class="code" href="../../da/dce/details__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a> = sendButton.dataset.counter;
<a name="l00468"></a>00468         var expected = segmentInfo2.charsAvailableInLastSegment + <span class="charliteral">&#39;/&#39;</span> +
<a name="l00469"></a>00469           segmentInfo2.segments;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(subject, expected);
<a name="l00472"></a>00472       });
<a name="l00473"></a>00473 
<a name="l00474"></a>00474       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;2 segment info requests return unordered&#39;</span>, <span class="keyword">function</span>() {
<a name="l00475"></a>00475         <span class="comment">// answer the last request</span>
<a name="l00476"></a>00476         <span class="comment">// the index argument is not necessary here but it&#39;s esaier to read</span>
<a name="l00477"></a>00477         <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(
<a name="l00478"></a>00478           segmentInfo2, 1
<a name="l00479"></a>00479         );
<a name="l00480"></a>00480 
<a name="l00481"></a>00481         <span class="comment">// then answer the first request</span>
<a name="l00482"></a>00482         <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(
<a name="l00483"></a>00483           segmentInfo1, 0
<a name="l00484"></a>00484         );
<a name="l00485"></a>00485 
<a name="l00486"></a>00486         var subject = sendButton.dataset.counter;
<a name="l00487"></a>00487         var expected = segmentInfo1.charsAvailableInLastSegment + <span class="charliteral">&#39;/&#39;</span> +
<a name="l00488"></a>00488           segmentInfo1.segments;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="comment">// note: this is wrong, but this won&#39;t happen in real life</span>
<a name="l00491"></a>00491         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(subject, expected);
<a name="l00492"></a>00492       });
<a name="l00493"></a>00493     });
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;type changed after the first segment info request &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00496"></a>00496       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00497"></a>00497         Compose.type = <span class="stringliteral">&#39;sms&#39;</span>;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         ThreadUI.updateCounter();
<a name="l00500"></a>00500         this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         <span class="comment">// change type to MMS</span>
<a name="l00503"></a>00503         Compose.type = <span class="stringliteral">&#39;mms&#39;</span>;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <span class="comment">// no characters were entered in the first call</span>
<a name="l00506"></a>00506         var segmentInfo = {
<a name="l00507"></a>00507           segments: 0,
<a name="l00508"></a>00508           charsAvailableInLastSegment: 0
<a name="l00509"></a>00509         };
<a name="l00510"></a>00510         <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00511"></a>00511       });
<a name="l00512"></a>00512 
<a name="l00513"></a>00513       teardown(<span class="keyword">function</span>() {
<a name="l00514"></a>00514         Compose.type = <span class="stringliteral">&#39;sms&#39;</span>;
<a name="l00515"></a>00515       });
<a name="l00516"></a>00516 
<a name="l00517"></a>00517       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;should not change the segment info&#39;</span>, <span class="keyword">function</span>() {
<a name="l00518"></a>00518         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(sendButton.classList.contains(<span class="stringliteral">&#39;has-counter&#39;</span>));
<a name="l00519"></a>00519       });
<a name="l00520"></a>00520     });
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;no characters entered &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00523"></a>00523       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00524"></a>00524         var segmentInfo = {
<a name="l00525"></a>00525           segments: 0,
<a name="l00526"></a>00526           charsAvailableInLastSegment: 0
<a name="l00527"></a>00527         };
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         updateCounter.call(<span class="keyword">this</span>, segmentInfo);
<a name="l00530"></a>00530       });
<a name="l00531"></a>00531 
<a name="l00532"></a>00532       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no counter is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00533"></a>00533         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.classList.contains(<span class="stringliteral">&#39;has-counter&#39;</span>));
<a name="l00534"></a>00534       });
<a name="l00535"></a>00535 
<a name="l00536"></a>00536       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no banner is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00537"></a>00537         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(banner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00538"></a>00538       });
<a name="l00539"></a>00539 
<a name="l00540"></a>00540       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is unset&#39;</span>, <span class="keyword">function</span>() {
<a name="l00541"></a>00541         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(Compose.lock);
<a name="l00542"></a>00542       });
<a name="l00543"></a>00543     });
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;in first segment &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00546"></a>00546       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00547"></a>00547         var segmentInfo = {
<a name="l00548"></a>00548           segments: 1,
<a name="l00549"></a>00549           charsAvailableInLastSegment: 20
<a name="l00550"></a>00550         };
<a name="l00551"></a>00551 
<a name="l00552"></a>00552         updateCounter.call(<span class="keyword">this</span>, segmentInfo);
<a name="l00553"></a>00553       });
<a name="l00554"></a>00554 
<a name="l00555"></a>00555       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no counter is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00556"></a>00556         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.classList.contains(<span class="stringliteral">&#39;has-counter&#39;</span>));
<a name="l00557"></a>00557       });
<a name="l00558"></a>00558 
<a name="l00559"></a>00559       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no banner is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00560"></a>00560         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(banner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00561"></a>00561       });
<a name="l00562"></a>00562 
<a name="l00563"></a>00563       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;the send button should be enabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00564"></a>00564         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(shouldEnableSend);
<a name="l00565"></a>00565       });
<a name="l00566"></a>00566 
<a name="l00567"></a>00567       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is unset&#39;</span>, <span class="keyword">function</span>() {
<a name="l00568"></a>00568         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(Compose.lock);
<a name="l00569"></a>00569       });
<a name="l00570"></a>00570     });
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;in first segment, less than 10 chars left &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00573"></a>00573       var segment = 1,
<a name="l00574"></a>00574           availableChars = 10;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00577"></a>00577         var segmentInfo = {
<a name="l00578"></a>00578           segments: segment,
<a name="l00579"></a>00579           charsAvailableInLastSegment: availableChars
<a name="l00580"></a>00580         };
<a name="l00581"></a>00581         updateCounter.call(<span class="keyword">this</span>, segmentInfo);
<a name="l00582"></a>00582       });
<a name="l00583"></a>00583 
<a name="l00584"></a>00584       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;a counter is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00585"></a>00585         var expected = availableChars + <span class="charliteral">&#39;/&#39;</span> + segment;
<a name="l00586"></a>00586         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(sendButton.dataset.counter, expected);
<a name="l00587"></a>00587       });
<a name="l00588"></a>00588 
<a name="l00589"></a>00589       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no banner is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00590"></a>00590         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(banner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00591"></a>00591       });
<a name="l00592"></a>00592 
<a name="l00593"></a>00593       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;the send button should be enabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00594"></a>00594         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(shouldEnableSend);
<a name="l00595"></a>00595       });
<a name="l00596"></a>00596 
<a name="l00597"></a>00597       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is unset&#39;</span>, <span class="keyword">function</span>() {
<a name="l00598"></a>00598         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(Compose.lock);
<a name="l00599"></a>00599       });
<a name="l00600"></a>00600     });
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;in second segment &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00603"></a>00603       var segment = 2,
<a name="l00604"></a>00604           availableChars = 20;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00607"></a>00607         var segmentInfo = {
<a name="l00608"></a>00608           segments: segment,
<a name="l00609"></a>00609           charsAvailableInLastSegment: availableChars
<a name="l00610"></a>00610         };
<a name="l00611"></a>00611         updateCounter.call(<span class="keyword">this</span>, segmentInfo);
<a name="l00612"></a>00612       });
<a name="l00613"></a>00613 
<a name="l00614"></a>00614       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;a counter is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00615"></a>00615         var expected = availableChars + <span class="charliteral">&#39;/&#39;</span> + segment;
<a name="l00616"></a>00616         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(sendButton.dataset.counter, expected);
<a name="l00617"></a>00617       });
<a name="l00618"></a>00618 
<a name="l00619"></a>00619       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no banner is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00620"></a>00620         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(banner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00621"></a>00621       });
<a name="l00622"></a>00622 
<a name="l00623"></a>00623       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;the send button should be enabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00624"></a>00624         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(shouldEnableSend);
<a name="l00625"></a>00625       });
<a name="l00626"></a>00626 
<a name="l00627"></a>00627       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is unset&#39;</span>, <span class="keyword">function</span>() {
<a name="l00628"></a>00628         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(Compose.lock);
<a name="l00629"></a>00629       });
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     });
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;in last segment &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00634"></a>00634       var segment = 10,
<a name="l00635"></a>00635           availableChars = 20;
<a name="l00636"></a>00636 
<a name="l00637"></a>00637       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00638"></a>00638         var segmentInfo = {
<a name="l00639"></a>00639           segments: segment,
<a name="l00640"></a>00640           charsAvailableInLastSegment: availableChars
<a name="l00641"></a>00641         };
<a name="l00642"></a>00642         updateCounter.call(<span class="keyword">this</span>, segmentInfo);
<a name="l00643"></a>00643       });
<a name="l00644"></a>00644 
<a name="l00645"></a>00645       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;a counter is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00646"></a>00646         var expected = availableChars + <span class="charliteral">&#39;/&#39;</span> + segment;
<a name="l00647"></a>00647         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(sendButton.dataset.counter, expected);
<a name="l00648"></a>00648       });
<a name="l00649"></a>00649 
<a name="l00650"></a>00650       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no banner is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00651"></a>00651         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(banner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00652"></a>00652       });
<a name="l00653"></a>00653 
<a name="l00654"></a>00654       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;the send button should be enabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00655"></a>00655         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(shouldEnableSend);
<a name="l00656"></a>00656       });
<a name="l00657"></a>00657 
<a name="l00658"></a>00658       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is unset&#39;</span>, <span class="keyword">function</span>() {
<a name="l00659"></a>00659         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(Compose.lock);
<a name="l00660"></a>00660       });
<a name="l00661"></a>00661     });
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;in last segment, no characters left &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00664"></a>00664       var segment = 10,
<a name="l00665"></a>00665           availableChars = 0;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00668"></a>00668         var segmentInfo = {
<a name="l00669"></a>00669           segments: segment,
<a name="l00670"></a>00670           charsAvailableInLastSegment: availableChars
<a name="l00671"></a>00671         };
<a name="l00672"></a>00672         updateCounter.call(<span class="keyword">this</span>, segmentInfo);
<a name="l00673"></a>00673       });
<a name="l00674"></a>00674 
<a name="l00675"></a>00675       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;a counter is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00676"></a>00676         var expected = availableChars + <span class="charliteral">&#39;/&#39;</span> + segment;
<a name="l00677"></a>00677         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(sendButton.dataset.counter, expected);
<a name="l00678"></a>00678       });
<a name="l00679"></a>00679 
<a name="l00680"></a>00680       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;the send button should be enabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00681"></a>00681         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(shouldEnableSend);
<a name="l00682"></a>00682       });
<a name="l00683"></a>00683 
<a name="l00684"></a>00684       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message type is sms&#39;</span>, <span class="keyword">function</span>() {
<a name="l00685"></a>00685         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(form.dataset.messageType, <span class="stringliteral">&#39;sms&#39;</span>);
<a name="l00686"></a>00686       });
<a name="l00687"></a>00687 
<a name="l00688"></a>00688       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is disabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00689"></a>00689         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(Compose.lock);
<a name="l00690"></a>00690       });
<a name="l00691"></a>00691     });
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;too many segments &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00694"></a>00694       var segmentInfo = {
<a name="l00695"></a>00695         segments: 11,
<a name="l00696"></a>00696         charsAvailableInLastSegment: 25
<a name="l00697"></a>00697       };
<a name="l00698"></a>00698 
<a name="l00699"></a>00699       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00700"></a>00700         updateCounter.call(<span class="keyword">this</span>, segmentInfo);
<a name="l00701"></a>00701       });
<a name="l00702"></a>00702 
<a name="l00703"></a>00703       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message type is mms&#39;</span>, <span class="keyword">function</span>() {
<a name="l00704"></a>00704         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(form.dataset.messageType, <span class="stringliteral">&#39;mms&#39;</span>);
<a name="l00705"></a>00705       });
<a name="l00706"></a>00706 
<a name="l00707"></a>00707       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is disabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00708"></a>00708         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(Compose.lock);
<a name="l00709"></a>00709       });
<a name="l00710"></a>00710 
<a name="l00711"></a>00711       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;trying to move back to sms &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00712"></a>00712         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00713"></a>00713           <span class="comment">// waiting some seconds so that the existing possible banner is hidden</span>
<a name="l00714"></a>00714           this.sinon.clock.tick(5000);
<a name="l00715"></a>00715           this.sinon.spy(<a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>,
<a name="l00716"></a>00716             <span class="stringliteral">&#39;getSegmentInfoForText&#39;</span>);
<a name="l00717"></a>00717           Compose.type = <span class="stringliteral">&#39;sms&#39;</span>;
<a name="l00718"></a>00718           <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00719"></a>00719         });
<a name="l00720"></a>00720 
<a name="l00721"></a>00721         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;getSegmentInfoForText was called&#39;</span>, <span class="keyword">function</span>() {
<a name="l00722"></a>00722           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.getSegmentInfoForText.called);
<a name="l00723"></a>00723         });
<a name="l00724"></a>00724 
<a name="l00725"></a>00725         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message type is still mms&#39;</span>, <span class="keyword">function</span>() {
<a name="l00726"></a>00726           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(Compose.type, <span class="stringliteral">&#39;mms&#39;</span>);
<a name="l00727"></a>00727           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(form.dataset.messageType, <span class="stringliteral">&#39;mms&#39;</span>);
<a name="l00728"></a>00728         });
<a name="l00729"></a>00729 
<a name="l00730"></a>00730         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;the convertion notice is not displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00731"></a>00731           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00732"></a>00732         });
<a name="l00733"></a>00733       });
<a name="l00734"></a>00734     });
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;at size limit in mms &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00737"></a>00737       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00738"></a>00738         <a class="code" href="../../de/d5e/apps_2browser_2js_2settings_8js.html#a2f596332cd75ad3af3b5639f64da6573">Settings</a>.mmsSizeLimitation = 1024;
<a name="l00739"></a>00739         Compose.append(mockAttachment(512));
<a name="l00740"></a>00740         Compose.append(mockAttachment(512));
<a name="l00741"></a>00741         shouldEnableSend = ThreadUI.updateCounter();
<a name="l00742"></a>00742       });
<a name="l00743"></a>00743 
<a name="l00744"></a>00744       teardown(<span class="keyword">function</span>() {
<a name="l00745"></a>00745         Compose.clear();
<a name="l00746"></a>00746       });
<a name="l00747"></a>00747 
<a name="l00748"></a>00748       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;shouldEnableSend&#39;</span>, <span class="keyword">function</span>() {
<a name="l00749"></a>00749         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(shouldEnableSend);
<a name="l00750"></a>00750       });
<a name="l00751"></a>00751 
<a name="l00752"></a>00752       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;banner is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00753"></a>00753         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(banner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00754"></a>00754       });
<a name="l00755"></a>00755 
<a name="l00756"></a>00756       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;banner localized&#39;</span>, <span class="keyword">function</span>() {
<a name="l00757"></a>00757         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l00758"></a>00758           localize.calledWith(banner.querySelector(<span class="charliteral">&#39;p&#39;</span>),
<a name="l00759"></a>00759             <span class="stringliteral">&#39;messages-max-length-text&#39;</span>)
<a name="l00760"></a>00760         );
<a name="l00761"></a>00761       });
<a name="l00762"></a>00762 
<a name="l00763"></a>00763       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message type is mms&#39;</span>, <span class="keyword">function</span>() {
<a name="l00764"></a>00764         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(form.dataset.messageType, <span class="stringliteral">&#39;mms&#39;</span>);
<a name="l00765"></a>00765       });
<a name="l00766"></a>00766 
<a name="l00767"></a>00767       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is enabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00768"></a>00768         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(Compose.lock);
<a name="l00769"></a>00769       });
<a name="l00770"></a>00770     });
<a name="l00771"></a>00771 
<a name="l00772"></a>00772     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;over size limit in mms &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00773"></a>00773       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00774"></a>00774         <a class="code" href="../../de/d5e/apps_2browser_2js_2settings_8js.html#a2f596332cd75ad3af3b5639f64da6573">Settings</a>.mmsSizeLimitation = 1024;
<a name="l00775"></a>00775         Compose.append(mockAttachment(512));
<a name="l00776"></a>00776         Compose.append(<span class="stringliteral">&#39;sigh&#39;</span>);
<a name="l00777"></a>00777         Compose.append(mockAttachment(512));
<a name="l00778"></a>00778         shouldEnableSend = ThreadUI.updateCounter();
<a name="l00779"></a>00779       });
<a name="l00780"></a>00780 
<a name="l00781"></a>00781       teardown(<span class="keyword">function</span>() {
<a name="l00782"></a>00782         Compose.clear();
<a name="l00783"></a>00783       });
<a name="l00784"></a>00784 
<a name="l00785"></a>00785       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;shouldEnableSend is false&#39;</span>, <span class="keyword">function</span>() {
<a name="l00786"></a>00786         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(shouldEnableSend);
<a name="l00787"></a>00787       });
<a name="l00788"></a>00788 
<a name="l00789"></a>00789       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;banner is displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l00790"></a>00790         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(banner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00791"></a>00791       });
<a name="l00792"></a>00792 
<a name="l00793"></a>00793       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;banner localized&#39;</span>, <span class="keyword">function</span>() {
<a name="l00794"></a>00794         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l00795"></a>00795           localize.calledWith(banner.querySelector(<span class="charliteral">&#39;p&#39;</span>),
<a name="l00796"></a>00796             <span class="stringliteral">&#39;messages-exceeded-length-text&#39;</span>)
<a name="l00797"></a>00797         );
<a name="l00798"></a>00798       });
<a name="l00799"></a>00799 
<a name="l00800"></a>00800       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message type is mms&#39;</span>, <span class="keyword">function</span>() {
<a name="l00801"></a>00801         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(form.dataset.messageType, <span class="stringliteral">&#39;mms&#39;</span>);
<a name="l00802"></a>00802       });
<a name="l00803"></a>00803 
<a name="l00804"></a>00804       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;lock is enabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l00805"></a>00805         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(Compose.lock);
<a name="l00806"></a>00806       });
<a name="l00807"></a>00807     });
<a name="l00808"></a>00808   });
<a name="l00809"></a>00809 
<a name="l00810"></a>00810   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;message type conversion &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l00811"></a>00811     var convertBanner, convertBannerText, form, <a class="code" href="../../d1/de1/apps_2settings_2js_2utils_8js.html#a32930d17cd0e3a8078d1a8e5207cfc4d">localize</a>;
<a name="l00812"></a>00812     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00813"></a>00813       convertBanner = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-convert-notice&#39;</span>);
<a name="l00814"></a>00814       convertBannerText = convertBanner.querySelector(<span class="charliteral">&#39;p&#39;</span>);
<a name="l00815"></a>00815       form = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;messages-compose-form&#39;</span>);
<a name="l00816"></a>00816       localize = this.sinon.spy(<a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n, <span class="stringliteral">&#39;localize&#39;</span>);
<a name="l00817"></a>00817     });
<a name="l00818"></a>00818     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;sms to mms and back displays banner&#39;</span>, <span class="keyword">function</span>() {
<a name="l00819"></a>00819       <span class="comment">// cause a type switch event to happen</span>
<a name="l00820"></a>00820       Compose.type = <span class="stringliteral">&#39;mms&#39;</span>;
<a name="l00821"></a>00821       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(sendButton.classList.contains(<span class="stringliteral">&#39;has-counter&#39;</span>));
<a name="l00822"></a>00822       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00823"></a>00823         <span class="stringliteral">&#39;conversion banner is shown for mms&#39;</span>);
<a name="l00824"></a>00824       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(composeForm.dataset.messageType, <span class="stringliteral">&#39;mms&#39;</span>,
<a name="l00825"></a>00825         <span class="stringliteral">&#39;the composer has type mms&#39;</span>);
<a name="l00826"></a>00826 
<a name="l00827"></a>00827       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l00828"></a>00828         localize.calledWith(convertBannerText, <span class="stringliteral">&#39;converted-to-mms&#39;</span>),
<a name="l00829"></a>00829         <span class="stringliteral">&#39;conversion banner has mms message&#39;</span>
<a name="l00830"></a>00830       );
<a name="l00831"></a>00831       localize.reset();
<a name="l00832"></a>00832 
<a name="l00833"></a>00833       this.sinon.clock.tick(2999);
<a name="l00834"></a>00834       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00835"></a>00835         <span class="stringliteral">&#39;conversion banner is shown for just shy of 3 seconds&#39;</span>);
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       this.sinon.clock.tick(1);
<a name="l00838"></a>00838       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00839"></a>00839         <span class="stringliteral">&#39;conversion banner is hidden at 3 seconds&#39;</span>);
<a name="l00840"></a>00840 
<a name="l00841"></a>00841       Compose.type = <span class="stringliteral">&#39;sms&#39;</span>;
<a name="l00842"></a>00842       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00843"></a>00843       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess();
<a name="l00844"></a>00844 
<a name="l00845"></a>00845       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(sendButton.classList.contains(<span class="stringliteral">&#39;has-counter&#39;</span>));
<a name="l00846"></a>00846       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00847"></a>00847         <span class="stringliteral">&#39;conversion banner is shown for sms&#39;</span>);
<a name="l00848"></a>00848       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(composeForm.dataset.messageType, <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l00849"></a>00849         <span class="stringliteral">&#39;the composer has type sms&#39;</span>);
<a name="l00850"></a>00850       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l00851"></a>00851         localize.calledWith(convertBannerText, <span class="stringliteral">&#39;converted-to-sms&#39;</span>),
<a name="l00852"></a>00852         <span class="stringliteral">&#39;conversion banner has sms message&#39;</span>
<a name="l00853"></a>00853       );
<a name="l00854"></a>00854 
<a name="l00855"></a>00855       this.sinon.clock.tick(2999);
<a name="l00856"></a>00856       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00857"></a>00857         <span class="stringliteral">&#39;conversion banner is shown for just shy of 3 seconds&#39;</span>);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859       this.sinon.clock.tick(1);
<a name="l00860"></a>00860       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00861"></a>00861         <span class="stringliteral">&#39;conversion banner is hidden at 3 seconds&#39;</span>);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863     });
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;character limit from sms to mms and back displays banner&#39;</span>,
<a name="l00866"></a>00866       <span class="keyword">function</span>() {
<a name="l00867"></a>00867       ThreadUI.updateCounter();
<a name="l00868"></a>00868       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870       <span class="comment">// go over the limit</span>
<a name="l00871"></a>00871       var segmentInfo = {
<a name="l00872"></a>00872         segments: 11,
<a name="l00873"></a>00873         charsAvailableInLastSegment: 0
<a name="l00874"></a>00874       };
<a name="l00875"></a>00875 
<a name="l00876"></a>00876       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00877"></a>00877 
<a name="l00878"></a>00878       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00879"></a>00879         <span class="stringliteral">&#39;conversion banner is shown for mms&#39;</span>);
<a name="l00880"></a>00880       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(composeForm.dataset.messageType, <span class="stringliteral">&#39;mms&#39;</span>,
<a name="l00881"></a>00881         <span class="stringliteral">&#39;the composer has type mms&#39;</span>);
<a name="l00882"></a>00882       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l00883"></a>00883         localize.calledWith(convertBannerText, <span class="stringliteral">&#39;converted-to-mms&#39;</span>),
<a name="l00884"></a>00884         <span class="stringliteral">&#39;conversion banner has mms message&#39;</span>
<a name="l00885"></a>00885       );
<a name="l00886"></a>00886       localize.reset();
<a name="l00887"></a>00887 
<a name="l00888"></a>00888       this.sinon.clock.tick(2999);
<a name="l00889"></a>00889       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00890"></a>00890         <span class="stringliteral">&#39;conversion banner is shown for just shy of 3 seconds&#39;</span>);
<a name="l00891"></a>00891 
<a name="l00892"></a>00892       this.sinon.clock.tick(1);
<a name="l00893"></a>00893       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00894"></a>00894         <span class="stringliteral">&#39;conversion banner is hidden at 3 seconds&#39;</span>);
<a name="l00895"></a>00895 
<a name="l00896"></a>00896       Compose.clear();
<a name="l00897"></a>00897       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00898"></a>00898       segmentInfo.segments = 0;
<a name="l00899"></a>00899       <span class="comment">// we have 2 requests, so we trigger twice</span>
<a name="l00900"></a>00900       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00901"></a>00901       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00904"></a>00904         <span class="stringliteral">&#39;conversion banner is shown for sms&#39;</span>);
<a name="l00905"></a>00905       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(composeForm.dataset.messageType, <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l00906"></a>00906         <span class="stringliteral">&#39;the composer has type sms&#39;</span>);
<a name="l00907"></a>00907       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l00908"></a>00908         localize.calledWith(convertBannerText, <span class="stringliteral">&#39;converted-to-sms&#39;</span>),
<a name="l00909"></a>00909         <span class="stringliteral">&#39;conversion banner has sms message&#39;</span>
<a name="l00910"></a>00910       );
<a name="l00911"></a>00911       localize.reset();
<a name="l00912"></a>00912 
<a name="l00913"></a>00913       this.sinon.clock.tick(2999);
<a name="l00914"></a>00914       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00915"></a>00915         <span class="stringliteral">&#39;conversion banner is shown for just shy of 3 seconds&#39;</span>);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917       this.sinon.clock.tick(1);
<a name="l00918"></a>00918       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00919"></a>00919         <span class="stringliteral">&#39;conversion banner is hidden at 3 seconds&#39;</span>);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     });
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;converting from sms to mms and back quickly&#39;</span>, <span class="keyword">function</span>() {
<a name="l00924"></a>00924       ThreadUI.updateCounter();
<a name="l00925"></a>00925       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00926"></a>00926 
<a name="l00927"></a>00927       <span class="comment">// go over the limit</span>
<a name="l00928"></a>00928       var segmentInfo = {
<a name="l00929"></a>00929         segments: 11,
<a name="l00930"></a>00930         charsAvailableInLastSegment: 0
<a name="l00931"></a>00931       };
<a name="l00932"></a>00932       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00933"></a>00933 
<a name="l00934"></a>00934       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00935"></a>00935         <span class="stringliteral">&#39;conversion banner is shown for mms&#39;</span>);
<a name="l00936"></a>00936       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l00937"></a>00937         localize.calledWith(convertBannerText, <span class="stringliteral">&#39;converted-to-mms&#39;</span>),
<a name="l00938"></a>00938         <span class="stringliteral">&#39;conversion banner has mms message&#39;</span>
<a name="l00939"></a>00939       );
<a name="l00940"></a>00940       localize.reset();
<a name="l00941"></a>00941 
<a name="l00942"></a>00942       this.sinon.clock.tick(1500);
<a name="l00943"></a>00943       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00944"></a>00944         <span class="stringliteral">&#39;conversion banner is still shown&#39;</span>);
<a name="l00945"></a>00945 
<a name="l00946"></a>00946       Compose.clear();
<a name="l00947"></a>00947       this.sinon.clock.tick(ThreadUI.UPDATE_DELAY);
<a name="l00948"></a>00948       segmentInfo.segments = 0;
<a name="l00949"></a>00949       <span class="comment">// we have 2 requests, so we trigger twice</span>
<a name="l00950"></a>00950       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00951"></a>00951       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess(segmentInfo);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00954"></a>00954         <span class="stringliteral">&#39;conversion banner is shown for sms&#39;</span>);
<a name="l00955"></a>00955       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l00956"></a>00956         localize.calledWith(convertBannerText, <span class="stringliteral">&#39;converted-to-sms&#39;</span>),
<a name="l00957"></a>00957         <span class="stringliteral">&#39;conversion banner has sms message&#39;</span>
<a name="l00958"></a>00958       );
<a name="l00959"></a>00959       localize.reset();
<a name="l00960"></a>00960 
<a name="l00961"></a>00961       <span class="comment">// long enough to go past the previous timeout 1500 + 2000 &gt; 3000</span>
<a name="l00962"></a>00962       this.sinon.clock.tick(2000);
<a name="l00963"></a>00963       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00964"></a>00964         <span class="stringliteral">&#39;conversion banner is still shown&#39;</span>);
<a name="l00965"></a>00965 
<a name="l00966"></a>00966       this.sinon.clock.tick(1000);
<a name="l00967"></a>00967       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>),
<a name="l00968"></a>00968         <span class="stringliteral">&#39;conversion banner is hidden at 3 seconds&#39;</span>);
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     });
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;we dont display the banner when cleaning fields&#39;</span>, <span class="keyword">function</span>() {
<a name="l00973"></a>00973 
<a name="l00974"></a>00974       <span class="comment">// let&#39;s move to MMS type</span>
<a name="l00975"></a>00975       Compose.type = <span class="stringliteral">&#39;mms&#39;</span>;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977       <span class="comment">// and ignore this banner which should be there</span>
<a name="l00978"></a>00978       this.sinon.clock.tick(ThreadUI.CONVERTED_MESSAGE_DURATION);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980       this.sinon.spy(Compose, <span class="stringliteral">&#39;clear&#39;</span>);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982       ThreadUI.cleanFields();
<a name="l00983"></a>00983       <a class="code" href="../../dc/d25/mock__navigatormoz__sms_8js.html#a9a87647c2d70008b5633cfef1aaaa25e">MockNavigatormozMobileMessage</a>.mTriggerSegmentInfoSuccess({
<a name="l00984"></a>00984         segments: 0,
<a name="l00985"></a>00985         charsAvailableInLastSegment: 0
<a name="l00986"></a>00986       });
<a name="l00987"></a>00987 
<a name="l00988"></a>00988       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(Compose.clear.called);
<a name="l00989"></a>00989       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(convertBanner.classList.contains(<span class="stringliteral">&#39;hide&#39;</span>));
<a name="l00990"></a>00990     });
<a name="l00991"></a>00991   });
<a name="l00992"></a>00992 
<a name="l00993"></a>00993   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Recipient Assimiliation&#39;</span>, <span class="keyword">function</span>() {
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l00996"></a>00996       this.sinon.spy(ThreadUI.recipients, <span class="stringliteral">&#39;visible&#39;</span>);
<a name="l00997"></a>00997       this.sinon.spy(ThreadUI.recipients, <span class="stringliteral">&#39;add&#39;</span>);
<a name="l00998"></a>00998 
<a name="l00999"></a>00999       Threads.set(1, {
<a name="l01000"></a>01000         participants: [<span class="stringliteral">&#39;999&#39;</span>]
<a name="l01001"></a>01001       });
<a name="l01002"></a>01002     });
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     teardown(<span class="keyword">function</span>() {
<a name="l01005"></a>01005       Threads.delete(1);
<a name="l01006"></a>01006       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01007"></a>01007     });
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;New Conversation&#39;</span>, <span class="keyword">function</span>() {
<a name="l01010"></a>01010       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01013"></a>01013         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#new&#39;</span>;
<a name="l01014"></a>01014 
<a name="l01015"></a>01015         node = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;span&#39;</span>);
<a name="l01016"></a>01016         node.isPlaceholder = <span class="keyword">true</span>;
<a name="l01017"></a>01017         node.textContent = <span class="stringliteral">&#39;999&#39;</span>;
<a name="l01018"></a>01018 
<a name="l01019"></a>01019         ThreadUI.recipientsList.appendChild(node);
<a name="l01020"></a>01020       });
<a name="l01021"></a>01021 
<a name="l01022"></a>01022       teardown(<span class="keyword">function</span>() {
<a name="l01023"></a>01023         ThreadUI.recipientsList.removeChild(node);
<a name="l01024"></a>01024       });
<a name="l01025"></a>01025 
<a name="l01026"></a>01026       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Will assimilate recipients&#39;</span>, <span class="keyword">function</span>() {
<a name="l01027"></a>01027         var <a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>, <a class="code" href="../../d3/d4a/mock__recipients_8js.html#a81b686bc164506c493dc722ce59d5b54">add</a>;
<a name="l01028"></a>01028 
<a name="l01029"></a>01029         ThreadUI.assimilateRecipients();
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         visible = ThreadUI.recipients.visible;
<a name="l01032"></a>01032         add = ThreadUI.recipients.add;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(visible.called);
<a name="l01035"></a>01035         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(visible.args[0][0], <span class="stringliteral">&#39;singleline&#39;</span>);
<a name="l01036"></a>01036 
<a name="l01037"></a>01037         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(add.called);
<a name="l01038"></a>01038         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(add.args[0][0], {
<a name="l01039"></a>01039           <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: <span class="stringliteral">&#39;999&#39;</span>,
<a name="l01040"></a>01040           number: <span class="stringliteral">&#39;999&#39;</span>,
<a name="l01041"></a>01041           source: <span class="stringliteral">&#39;manual&#39;</span>
<a name="l01042"></a>01042         });
<a name="l01043"></a>01043       });
<a name="l01044"></a>01044     });
<a name="l01045"></a>01045 
<a name="l01046"></a>01046     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Existing Conversation&#39;</span>, <span class="keyword">function</span>() {
<a name="l01047"></a>01047 
<a name="l01048"></a>01048       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01049"></a>01049         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l01050"></a>01050       });
<a name="l01051"></a>01051 
<a name="l01052"></a>01052       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Will not assimilate recipients &#39;</span>, <span class="keyword">function</span>() {
<a name="l01053"></a>01053         var <a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>, <a class="code" href="../../d3/d4a/mock__recipients_8js.html#a81b686bc164506c493dc722ce59d5b54">add</a>;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055         ThreadUI.assimilateRecipients();
<a name="l01056"></a>01056 
<a name="l01057"></a>01057         visible = ThreadUI.recipients.visible;
<a name="l01058"></a>01058         add = ThreadUI.recipients.add;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(visible.called);
<a name="l01061"></a>01061         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(add.called);
<a name="l01062"></a>01062       });
<a name="l01063"></a>01063     });
<a name="l01064"></a>01064   });
<a name="l01065"></a>01065 
<a name="l01066"></a>01066   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;message status update handlers &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01067"></a>01067     suiteSetup(<span class="keyword">function</span>() {
<a name="l01068"></a>01068       this.fakeMessage = {
<a name="l01069"></a>01069         <span class="keywordtype">id</span>: 24601
<a name="l01070"></a>01070       };
<a name="l01071"></a>01071     });
<a name="l01072"></a>01072     teardown(<span class="keyword">function</span>() {
<a name="l01073"></a>01073       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.removeChild(this.container);
<a name="l01074"></a>01074     });
<a name="l01075"></a>01075     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01076"></a>01076       this.container = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;div&#39;</span>);
<a name="l01077"></a>01077       this.container.id = <span class="stringliteral">&#39;message-&#39;</span> + this.fakeMessage.id;
<a name="l01078"></a>01078       this.container.className = <span class="stringliteral">&#39;sending&#39;</span>;
<a name="l01079"></a>01079       this.container.innerHTML = ThreadUI.tmpl.message.interpolate({});
<a name="l01080"></a>01080       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.appendChild(this.container);
<a name="l01081"></a>01081     });
<a name="l01082"></a>01082 
<a name="l01083"></a>01083     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;onMessageSent &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01084"></a>01084       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;removes the &quot;sending&quot; class from the message element&#39;</span>, <span class="keyword">function</span>() {
<a name="l01085"></a>01085         ThreadUI.onMessageSent(this.fakeMessage);
<a name="l01086"></a>01086         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(this.container.classList.contains(<span class="stringliteral">&#39;sending&#39;</span>));
<a name="l01087"></a>01087       });
<a name="l01088"></a>01088       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;adds the &quot;sent&quot; class to the message element&#39;</span>, <span class="keyword">function</span>() {
<a name="l01089"></a>01089         ThreadUI.onMessageSent(this.fakeMessage);
<a name="l01090"></a>01090         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(this.container.classList.contains(<span class="stringliteral">&#39;sent&#39;</span>));
<a name="l01091"></a>01091       });
<a name="l01092"></a>01092     });
<a name="l01093"></a>01093 
<a name="l01094"></a>01094     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;onMessageFailed &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01095"></a>01095       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;messages that were *not* previously in the &quot;error&quot; state &gt;&#39;</span>,
<a name="l01096"></a>01096         <span class="keyword">function</span>() {
<a name="l01097"></a>01097         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;removes the &quot;sending&quot; class from the message element&#39;</span>,
<a name="l01098"></a>01098           <span class="keyword">function</span>() {
<a name="l01099"></a>01099           ThreadUI.onMessageFailed(this.fakeMessage);
<a name="l01100"></a>01100           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(this.container.classList.contains(<span class="stringliteral">&#39;sending&#39;</span>));
<a name="l01101"></a>01101         });
<a name="l01102"></a>01102         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;adds the &quot;error&quot; class to the message element&#39;</span>, <span class="keyword">function</span>() {
<a name="l01103"></a>01103           ThreadUI.onMessageFailed(this.fakeMessage);
<a name="l01104"></a>01104           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(this.container.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01105"></a>01105         });
<a name="l01106"></a>01106       });
<a name="l01107"></a>01107       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;messages that were previously in the &quot;error&quot; state &gt;&#39;</span>,
<a name="l01108"></a>01108         <span class="keyword">function</span>() {
<a name="l01109"></a>01109         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01110"></a>01110           this.container.classList.add(<span class="stringliteral">&#39;error&#39;</span>);
<a name="l01111"></a>01111         });
<a name="l01112"></a>01112         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;does not remove the &quot;sending&quot; class to the message element&#39;</span>,
<a name="l01113"></a>01113           <span class="keyword">function</span>() {
<a name="l01114"></a>01114           ThreadUI.onMessageFailed(this.fakeMessage);
<a name="l01115"></a>01115           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(this.container.classList.contains(<span class="stringliteral">&#39;sending&#39;</span>));
<a name="l01116"></a>01116         });
<a name="l01117"></a>01117       });
<a name="l01118"></a>01118       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;show error message when send message unsuccessfully&#39;</span>, <span class="keyword">function</span>() {
<a name="l01119"></a>01119         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01120"></a>01120           <a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.mSetup();
<a name="l01121"></a>01121         });
<a name="l01122"></a>01122 
<a name="l01123"></a>01123         teardown(<span class="keyword">function</span>() {
<a name="l01124"></a>01124           <a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.mTeardown();
<a name="l01125"></a>01125         });
<a name="l01126"></a>01126 
<a name="l01127"></a>01127         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;show general error for no signal error&#39;</span>, <span class="keyword">function</span>() {
<a name="l01128"></a>01128           ThreadUI.showSendMessageError(<span class="stringliteral">&#39;NoSignalError&#39;</span>);
<a name="l01129"></a>01129           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.instances[0].show.called);
<a name="l01130"></a>01130           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].title.l10nId,
<a name="l01131"></a>01131                       <span class="stringliteral">&#39;sendGeneralErrorTitle&#39;</span>);
<a name="l01132"></a>01132           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].body.l10nId,
<a name="l01133"></a>01133                       <span class="stringliteral">&#39;sendGeneralErrorBody&#39;</span>);
<a name="l01134"></a>01134         });
<a name="l01135"></a>01135 
<a name="l01136"></a>01136         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;show general error for not found error&#39;</span>, <span class="keyword">function</span>() {
<a name="l01137"></a>01137           ThreadUI.showSendMessageError(<span class="stringliteral">&#39;NotFoundError&#39;</span>);
<a name="l01138"></a>01138           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.instances[0].show.called);
<a name="l01139"></a>01139           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].title.l10nId,
<a name="l01140"></a>01140                       <span class="stringliteral">&#39;sendGeneralErrorTitle&#39;</span>);
<a name="l01141"></a>01141           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].body.l10nId,
<a name="l01142"></a>01142                       <span class="stringliteral">&#39;sendGeneralErrorBody&#39;</span>);
<a name="l01143"></a>01143         });
<a name="l01144"></a>01144 
<a name="l01145"></a>01145         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;show general error for unknown error&#39;</span>, <span class="keyword">function</span>() {
<a name="l01146"></a>01146           ThreadUI.showSendMessageError(<span class="stringliteral">&#39;UnknownError&#39;</span>);
<a name="l01147"></a>01147           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.instances[0].show.called);
<a name="l01148"></a>01148           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].title.l10nId,
<a name="l01149"></a>01149                       <span class="stringliteral">&#39;sendGeneralErrorTitle&#39;</span>);
<a name="l01150"></a>01150           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].body.l10nId,
<a name="l01151"></a>01151                       <span class="stringliteral">&#39;sendGeneralErrorBody&#39;</span>);
<a name="l01152"></a>01152         });
<a name="l01153"></a>01153 
<a name="l01154"></a>01154         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;show general error for internal error&#39;</span>, <span class="keyword">function</span>() {
<a name="l01155"></a>01155           ThreadUI.showSendMessageError(<span class="stringliteral">&#39;InternalError&#39;</span>);
<a name="l01156"></a>01156           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.instances[0].show.called);
<a name="l01157"></a>01157           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].title.l10nId,
<a name="l01158"></a>01158                       <span class="stringliteral">&#39;sendGeneralErrorTitle&#39;</span>);
<a name="l01159"></a>01159           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].body.l10nId,
<a name="l01160"></a>01160                       <span class="stringliteral">&#39;sendGeneralErrorBody&#39;</span>);
<a name="l01161"></a>01161         });
<a name="l01162"></a>01162 
<a name="l01163"></a>01163         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;show general error for invalid address error&#39;</span>, <span class="keyword">function</span>() {
<a name="l01164"></a>01164           ThreadUI.showSendMessageError(<span class="stringliteral">&#39;InvalidAddressError&#39;</span>);
<a name="l01165"></a>01165           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.instances[0].show.called);
<a name="l01166"></a>01166           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].title.l10nId,
<a name="l01167"></a>01167                       <span class="stringliteral">&#39;sendGeneralErrorTitle&#39;</span>);
<a name="l01168"></a>01168           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].body.l10nId,
<a name="l01169"></a>01169                       <span class="stringliteral">&#39;sendGeneralErrorBody&#39;</span>);
<a name="l01170"></a>01170         });
<a name="l01171"></a>01171 
<a name="l01172"></a>01172         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;show no SIM card&#39;</span>, <span class="keyword">function</span>() {
<a name="l01173"></a>01173           ThreadUI.showSendMessageError(<span class="stringliteral">&#39;NoSimCardError&#39;</span>);
<a name="l01174"></a>01174           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.instances[0].show.called);
<a name="l01175"></a>01175           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].title.l10nId,
<a name="l01176"></a>01176                       <span class="stringliteral">&#39;sendNoSimCardTitle&#39;</span>);
<a name="l01177"></a>01177           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].body.l10nId,
<a name="l01178"></a>01178                       <span class="stringliteral">&#39;sendNoSimCardBody&#39;</span>);
<a name="l01179"></a>01179         });
<a name="l01180"></a>01180 
<a name="l01181"></a>01181         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;show air plane mode&#39;</span>, <span class="keyword">function</span>() {
<a name="l01182"></a>01182           ThreadUI.showSendMessageError(<span class="stringliteral">&#39;RadioDisabledError&#39;</span>);
<a name="l01183"></a>01183           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.instances[0].show.called);
<a name="l01184"></a>01184           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].title.l10nId,
<a name="l01185"></a>01185                       <span class="stringliteral">&#39;sendAirplaneModeTitle&#39;</span>);
<a name="l01186"></a>01186           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].body.l10nId,
<a name="l01187"></a>01187                       <span class="stringliteral">&#39;sendAirplaneModeBody&#39;</span>);
<a name="l01188"></a>01188         });
<a name="l01189"></a>01189 
<a name="l01190"></a>01190         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;show FDN blockage error&#39;</span>, <span class="keyword">function</span>() {
<a name="l01191"></a>01191           ThreadUI.showSendMessageError(
<a name="l01192"></a>01192               <span class="stringliteral">&#39;FdnCheckError&#39;</span>,
<a name="l01193"></a>01193               [<span class="stringliteral">&#39;123&#39;</span>, <span class="stringliteral">&#39;456&#39;</span>, <span class="stringliteral">&#39;789&#39;</span>]
<a name="l01194"></a>01194           );
<a name="l01195"></a>01195           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].title.l10nId,
<a name="l01196"></a>01196                       <span class="stringliteral">&#39;fdnBlockedTitle&#39;</span>);
<a name="l01197"></a>01197           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d3/d83/mock__dialog_8js.html#a12dd1eb577b5ecace983318a0e5b0f44">MockDialog</a>.calls[0].body.l10nId,
<a name="l01198"></a>01198                       <span class="stringliteral">&#39;fdnBlockedBody&#39;</span>);
<a name="l01199"></a>01199         });
<a name="l01200"></a>01200       });
<a name="l01201"></a>01201     });
<a name="l01202"></a>01202 
<a name="l01203"></a>01203     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;onDeliverySuccess &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01204"></a>01204       teardown(<span class="keyword">function</span>() {
<a name="l01205"></a>01205         this.fakeMessage.deliveryStatus = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l01206"></a>01206       });
<a name="l01207"></a>01207       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;sms delivery success&#39;</span>, <span class="keyword">function</span>() {
<a name="l01208"></a>01208         this.fakeMessage.deliveryStatus = <span class="stringliteral">&#39;success&#39;</span>;
<a name="l01209"></a>01209         ThreadUI.onDeliverySuccess(this.fakeMessage);
<a name="l01210"></a>01210         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(this.container.classList.contains(<span class="stringliteral">&#39;delivered&#39;</span>));
<a name="l01211"></a>01211       });
<a name="l01212"></a>01212       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;mms delivery success&#39;</span>, <span class="keyword">function</span>() {
<a name="l01213"></a>01213         this.fakeMessage.deliveryStatus = [<span class="stringliteral">&#39;success&#39;</span>];
<a name="l01214"></a>01214         ThreadUI.onDeliverySuccess(this.fakeMessage);
<a name="l01215"></a>01215         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(this.container.classList.contains(<span class="stringliteral">&#39;delivered&#39;</span>));
<a name="l01216"></a>01216       });
<a name="l01217"></a>01217       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;multiple recipients mms delivery success&#39;</span>, <span class="keyword">function</span>() {
<a name="l01218"></a>01218         this.fakeMessage.deliveryStatus = [<span class="stringliteral">&#39;success&#39;</span>, <span class="stringliteral">&#39;success&#39;</span>];
<a name="l01219"></a>01219         ThreadUI.onDeliverySuccess(this.fakeMessage);
<a name="l01220"></a>01220         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(this.container.classList.contains(<span class="stringliteral">&#39;delivered&#39;</span>));
<a name="l01221"></a>01221       });
<a name="l01222"></a>01222       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;not all recipients return mms delivery success&#39;</span>, <span class="keyword">function</span>() {
<a name="l01223"></a>01223         this.fakeMessage.deliveryStatus = [<span class="stringliteral">&#39;success&#39;</span>, <span class="stringliteral">&#39;pending&#39;</span>];
<a name="l01224"></a>01224         ThreadUI.onDeliverySuccess(this.fakeMessage);
<a name="l01225"></a>01225         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(this.container.classList.contains(<span class="stringliteral">&#39;delivered&#39;</span>));
<a name="l01226"></a>01226       });
<a name="l01227"></a>01227     });
<a name="l01228"></a>01228   });
<a name="l01229"></a>01229 
<a name="l01230"></a>01230   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;removeMessageDOM&#39;</span>, <span class="keyword">function</span>() {
<a name="l01231"></a>01231     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01232"></a>01232       ThreadUI.container.innerHTML = <span class="stringliteral">&#39;&lt;h2&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;/ul&gt;&#39;</span>;
<a name="l01233"></a>01233     });
<a name="l01234"></a>01234     teardown(<span class="keyword">function</span>() {
<a name="l01235"></a>01235       ThreadUI.container.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01236"></a>01236     });
<a name="l01237"></a>01237     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;removeMessageDOM removes a child&#39;</span>, <span class="keyword">function</span>() {
<a name="l01238"></a>01238       ThreadUI.removeMessageDOM(ThreadUI.container.querySelector(<span class="stringliteral">&#39;li&#39;</span>));
<a name="l01239"></a>01239       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;li&#39;</span>).length, 1);
<a name="l01240"></a>01240     });
<a name="l01241"></a>01241     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;removeMessageDOM removes headers and ul&#39;</span>, <span class="keyword">function</span>() {
<a name="l01242"></a>01242       ThreadUI.removeMessageDOM(ThreadUI.container.querySelector(<span class="stringliteral">&#39;li&#39;</span>));
<a name="l01243"></a>01243       ThreadUI.removeMessageDOM(ThreadUI.container.querySelector(<span class="stringliteral">&#39;li&#39;</span>));
<a name="l01244"></a>01244       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;h2&#39;</span>).length, 0);
<a name="l01245"></a>01245       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;ul&#39;</span>).length, 0);
<a name="l01246"></a>01246     });
<a name="l01247"></a>01247   });
<a name="l01248"></a>01248 
<a name="l01249"></a>01249   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;getMessageContainer &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01250"></a>01250     var lastYear, yesterday, today;
<a name="l01251"></a>01251     var fiveMinAgo, elevenMinAgo, oneHourAgo, oneHourFiveMinAgo;
<a name="l01252"></a>01252 
<a name="l01253"></a>01253     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01254"></a>01254       today = <span class="keyword">new</span> Date(2013, 11, 31, 23, 59);
<a name="l01255"></a>01255       this.sinon.clock.restore();
<a name="l01256"></a>01256       this.sinon.useFakeTimers(+today);
<a name="l01257"></a>01257 
<a name="l01258"></a>01258       lastYear = <span class="keyword">new</span> Date(2012, 11, 31);
<a name="l01259"></a>01259       yesterday = <span class="keyword">new</span> Date(2013, 11, 30, 12, 0);
<a name="l01260"></a>01260       fiveMinAgo = <span class="keyword">new</span> Date(2013, 11, 31, 23, 54);
<a name="l01261"></a>01261       elevenMinAgo = <span class="keyword">new</span> Date(2013, 11, 31, 23, 48);
<a name="l01262"></a>01262       oneHourAgo = <span class="keyword">new</span> Date(2013, 11, 31, 22, 59);
<a name="l01263"></a>01263       oneHourFiveMinAgo = <span class="keyword">new</span> Date(2013, 11, 31, 22, 54);
<a name="l01264"></a>01264     });
<a name="l01265"></a>01265 
<a name="l01266"></a>01266     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;last message block alone today &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01267"></a>01267       var <a class="code" href="../../da/dce/details__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>;
<a name="l01268"></a>01268 
<a name="l01269"></a>01269       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01270"></a>01270         subject = ThreadUI.getMessageContainer(+fiveMinAgo);
<a name="l01271"></a>01271       });
<a name="l01272"></a>01272 
<a name="l01273"></a>01273       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;has both the date and the time&#39;</span>, <span class="keyword">function</span>() {
<a name="l01274"></a>01274         var <a class="code" href="../../d8/dbd/namespaceheader.html#aa5b53e6fddfb0e2e76fa4f5cf837317b">header</a> = subject.previousElementSibling;
<a name="l01275"></a>01275         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.notEqual(header.dataset.timeOnly, <span class="stringliteral">&#39;true&#39;</span>);
<a name="l01276"></a>01276       });
<a name="l01277"></a>01277     });
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;last message block with another block today &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01280"></a>01280       var <a class="code" href="../../da/dce/details__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>;
<a name="l01281"></a>01281       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01282"></a>01282         ThreadUI.getMessageContainer(+elevenMinAgo);
<a name="l01283"></a>01283         subject = ThreadUI.getMessageContainer(+fiveMinAgo);
<a name="l01284"></a>01284       });
<a name="l01285"></a>01285 
<a name="l01286"></a>01286       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;has only the time&#39;</span>, <span class="keyword">function</span>() {
<a name="l01287"></a>01287         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(subject.previousElementSibling.dataset.timeOnly, <span class="stringliteral">&#39;true&#39;</span>);
<a name="l01288"></a>01288       });
<a name="l01289"></a>01289     });
<a name="l01290"></a>01290 
<a name="l01291"></a>01291     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;2 recent messages, different days &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01292"></a>01292       var firstContainer, secondContainer;
<a name="l01293"></a>01293       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01294"></a>01294         firstContainer = ThreadUI.getMessageContainer(Date.now());
<a name="l01295"></a>01295         <span class="comment">// 5 minutes to be next day, would be the same container if same day</span>
<a name="l01296"></a>01296         this.sinon.clock.tick(5 * 60 * 1000);
<a name="l01297"></a>01297 
<a name="l01298"></a>01298         secondContainer = ThreadUI.getMessageContainer(Date.now());
<a name="l01299"></a>01299       });
<a name="l01300"></a>01300 
<a name="l01301"></a>01301       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;different containers&#39;</span>, <span class="keyword">function</span>() {
<a name="l01302"></a>01302         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.notEqual(secondContainer, firstContainer);
<a name="l01303"></a>01303       });
<a name="l01304"></a>01304 
<a name="l01305"></a>01305       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;second container has both the date and the time&#39;</span>, <span class="keyword">function</span>() {
<a name="l01306"></a>01306         var secondHeader = secondContainer.previousElementSibling;
<a name="l01307"></a>01307         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.notEqual(secondHeader.dataset.timeOnly, <span class="stringliteral">&#39;true&#39;</span>);
<a name="l01308"></a>01308       });
<a name="l01309"></a>01309     });
<a name="l01310"></a>01310 
<a name="l01311"></a>01311     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;2 recent messages, same day, 15 minutes interval &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01312"></a>01312       var firstContainer, secondContainer, firstTimestamp;
<a name="l01313"></a>01313 
<a name="l01314"></a>01314       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01315"></a>01315         this.sinon.clock.tick(15 * 60 * 1000); <span class="comment">// 15 minutes to be the next day</span>
<a name="l01316"></a>01316         firstContainer = ThreadUI.getMessageContainer(Date.now());
<a name="l01317"></a>01317         firstTimestamp = firstContainer.dataset.timestamp;
<a name="l01318"></a>01318         this.sinon.clock.tick(15 * 60 * 1000);
<a name="l01319"></a>01319 
<a name="l01320"></a>01320         secondContainer = ThreadUI.getMessageContainer(Date.now());
<a name="l01321"></a>01321       });
<a name="l01322"></a>01322 
<a name="l01323"></a>01323       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;different containers&#39;</span>, <span class="keyword">function</span>() {
<a name="l01324"></a>01324         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.notEqual(secondContainer, firstContainer);
<a name="l01325"></a>01325       });
<a name="l01326"></a>01326 
<a name="l01327"></a>01327       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;has only the time&#39;</span>, <span class="keyword">function</span>() {
<a name="l01328"></a>01328         var secondHeader = secondContainer.previousElementSibling;
<a name="l01329"></a>01329         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(secondHeader.dataset.timeOnly, <span class="stringliteral">&#39;true&#39;</span>);
<a name="l01330"></a>01330       });
<a name="l01331"></a>01331 
<a name="l01332"></a>01332       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;first container has now a start-of-the-day timestamp&#39;</span>, <span class="keyword">function</span>() {
<a name="l01333"></a>01333         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.notEqual(firstContainer.dataset.timestamp, firstTimestamp);
<a name="l01334"></a>01334       });
<a name="l01335"></a>01335     });
<a name="l01336"></a>01336 
<a name="l01337"></a>01337     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;insert one non-last-message block at the end &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01338"></a>01338       var lastYearContainer, yesterdayContainer;
<a name="l01339"></a>01339 
<a name="l01340"></a>01340       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01341"></a>01341         lastYearContainer = ThreadUI.getMessageContainer(+lastYear);
<a name="l01342"></a>01342         yesterdayContainer = ThreadUI.getMessageContainer(+yesterday);
<a name="l01343"></a>01343       });
<a name="l01344"></a>01344 
<a name="l01345"></a>01345       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;should have 2 blocks&#39;</span>, <span class="keyword">function</span>() {
<a name="l01346"></a>01346         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;header&#39;</span>).length, 2);
<a name="l01347"></a>01347         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;ul&#39;</span>).length, 2);
<a name="l01348"></a>01348       });
<a name="l01349"></a>01349 
<a name="l01350"></a>01350       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;should be in the correct order&#39;</span>, <span class="keyword">function</span>() {
<a name="l01351"></a>01351         var containers = ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l01352"></a>01352         var expectedContainers = [
<a name="l01353"></a>01353           lastYearContainer,
<a name="l01354"></a>01354           yesterdayContainer
<a name="l01355"></a>01355         ];
<a name="l01356"></a>01356 
<a name="l01357"></a>01357         expectedContainers.forEach(<span class="keyword">function</span>(container, <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>) {
<a name="l01358"></a>01358           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(container, containers[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>]);
<a name="l01359"></a>01359         });
<a name="l01360"></a>01360       });
<a name="l01361"></a>01361 
<a name="l01362"></a>01362     });
<a name="l01363"></a>01363 
<a name="l01364"></a>01364     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;insert one non-last-message block at the end of a 2-item list &gt;&#39;</span>,
<a name="l01365"></a>01365       <span class="keyword">function</span>() {
<a name="l01366"></a>01366 
<a name="l01367"></a>01367       var lastYearContainer, yesterdayContainer, twoDaysAgoContainer;
<a name="l01368"></a>01368 
<a name="l01369"></a>01369       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01370"></a>01370         lastYearContainer = ThreadUI.getMessageContainer(+lastYear);
<a name="l01371"></a>01371         var twoDaysAgo = <span class="keyword">new</span> Date(2013, 11, 29);
<a name="l01372"></a>01372         twoDaysAgoContainer = ThreadUI.getMessageContainer(+twoDaysAgo);
<a name="l01373"></a>01373         yesterdayContainer = ThreadUI.getMessageContainer(+yesterday);
<a name="l01374"></a>01374       });
<a name="l01375"></a>01375 
<a name="l01376"></a>01376       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;should have 3 blocks&#39;</span>, <span class="keyword">function</span>() {
<a name="l01377"></a>01377         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;header&#39;</span>).length, 3);
<a name="l01378"></a>01378         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;ul&#39;</span>).length, 3);
<a name="l01379"></a>01379       });
<a name="l01380"></a>01380 
<a name="l01381"></a>01381       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;should be in the correct order&#39;</span>, <span class="keyword">function</span>() {
<a name="l01382"></a>01382         var containers = ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l01383"></a>01383         var expectedContainers = [
<a name="l01384"></a>01384           lastYearContainer,
<a name="l01385"></a>01385           twoDaysAgoContainer,
<a name="l01386"></a>01386           yesterdayContainer
<a name="l01387"></a>01387         ];
<a name="l01388"></a>01388 
<a name="l01389"></a>01389         expectedContainers.forEach(<span class="keyword">function</span>(container, <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>) {
<a name="l01390"></a>01390           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(container, containers[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>]);
<a name="l01391"></a>01391         });
<a name="l01392"></a>01392       });
<a name="l01393"></a>01393 
<a name="l01394"></a>01394     });
<a name="l01395"></a>01395 
<a name="l01396"></a>01396     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;4 blocks suite &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01397"></a>01397       var lastYearContainer, yesterdayContainer;
<a name="l01398"></a>01398       var elevenMinContainer, fiveMinContainer;
<a name="l01399"></a>01399       var oneHourContainer, oneHourFiveContainer;
<a name="l01400"></a>01400 
<a name="l01401"></a>01401       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01402"></a>01402         yesterdayContainer = ThreadUI.getMessageContainer(+yesterday);
<a name="l01403"></a>01403         fiveMinContainer = ThreadUI.getMessageContainer(+fiveMinAgo);
<a name="l01404"></a>01404         <span class="comment">// this one is asked after the last message block to see if the</span>
<a name="l01405"></a>01405         <span class="comment">// header are updated</span>
<a name="l01406"></a>01406         elevenMinContainer = ThreadUI.getMessageContainer(+elevenMinAgo);
<a name="l01407"></a>01407         oneHourContainer = ThreadUI.getMessageContainer(+oneHourAgo);
<a name="l01408"></a>01408         oneHourFiveContainer = ThreadUI.getMessageContainer(+oneHourFiveMinAgo);
<a name="l01409"></a>01409         <span class="comment">// this one requested at the end to check that we correctly put it at</span>
<a name="l01410"></a>01410         <span class="comment">// the start</span>
<a name="l01411"></a>01411         lastYearContainer = ThreadUI.getMessageContainer(+lastYear);
<a name="l01412"></a>01412       });
<a name="l01413"></a>01413 
<a name="l01414"></a>01414       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;should have 4 blocks&#39;</span>, <span class="keyword">function</span>() {
<a name="l01415"></a>01415         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;header&#39;</span>).length, 4);
<a name="l01416"></a>01416         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;ul&#39;</span>).length, 4);
<a name="l01417"></a>01417       });
<a name="l01418"></a>01418 
<a name="l01419"></a>01419       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;should be in the correct order&#39;</span>, <span class="keyword">function</span>() {
<a name="l01420"></a>01420         var containers = ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l01421"></a>01421         var expectedContainers = [
<a name="l01422"></a>01422           lastYearContainer,
<a name="l01423"></a>01423           yesterdayContainer,
<a name="l01424"></a>01424           elevenMinContainer,
<a name="l01425"></a>01425           fiveMinContainer
<a name="l01426"></a>01426         ];
<a name="l01427"></a>01427 
<a name="l01428"></a>01428         expectedContainers.forEach(<span class="keyword">function</span>(container, <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>) {
<a name="l01429"></a>01429           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(container, containers[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>]);
<a name="l01430"></a>01430         });
<a name="l01431"></a>01431       });
<a name="l01432"></a>01432 
<a name="l01433"></a>01433       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;some containers are the same&#39;</span>, <span class="keyword">function</span>() {
<a name="l01434"></a>01434         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(oneHourContainer, elevenMinContainer);
<a name="l01435"></a>01435         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(oneHourFiveContainer, elevenMinContainer);
<a name="l01436"></a>01436       });
<a name="l01437"></a>01437 
<a name="l01438"></a>01438       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;last message block should not show the date&#39;</span>, <span class="keyword">function</span>() {
<a name="l01439"></a>01439         <span class="comment">// because there is another earlier block the same day</span>
<a name="l01440"></a>01440         var <a class="code" href="../../d8/dbd/namespaceheader.html#aa5b53e6fddfb0e2e76fa4f5cf837317b">header</a> = fiveMinContainer.previousElementSibling;
<a name="l01441"></a>01441         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(header.dataset.timeOnly, <span class="stringliteral">&#39;true&#39;</span>);
<a name="l01442"></a>01442       });
<a name="l01443"></a>01443 
<a name="l01444"></a>01444       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;adding a new message in the last message block&#39;</span>, <span class="keyword">function</span>() {
<a name="l01445"></a>01445         var twoMinAgo = <span class="keyword">new</span> Date(2013, 11, 31, 23, 57);
<a name="l01446"></a>01446         var twoMinContainer = ThreadUI.getMessageContainer(+twoMinAgo);
<a name="l01447"></a>01447         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(twoMinContainer, fiveMinContainer);
<a name="l01448"></a>01448       });
<a name="l01449"></a>01449 
<a name="l01450"></a>01450       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;adding a new message for yesterday &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01451"></a>01451         var <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>;
<a name="l01452"></a>01452         var oldHeaderTimestamp;
<a name="l01453"></a>01453 
<a name="l01454"></a>01454         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01455"></a>01455           var header = yesterdayContainer.previousElementSibling;
<a name="l01456"></a>01456           oldHeaderTimestamp = header.dataset.time;
<a name="l01457"></a>01457 
<a name="l01458"></a>01458           var yesterdayEarlier = <span class="keyword">new</span> Date(+yesterday);
<a name="l01459"></a>01459           yesterdayEarlier.setHours(5, 5);
<a name="l01460"></a>01460           container = ThreadUI.getMessageContainer(+yesterdayEarlier);
<a name="l01461"></a>01461         });
<a name="l01462"></a>01462 
<a name="l01463"></a>01463         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;still 4 blocks&#39;</span>, <span class="keyword">function</span>() {
<a name="l01464"></a>01464           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;header&#39;</span>).length, 4);
<a name="l01465"></a>01465         });
<a name="l01466"></a>01466 
<a name="l01467"></a>01467         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;same container as the existing yesterday container&#39;</span>, <span class="keyword">function</span>() {
<a name="l01468"></a>01468           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(container, yesterdayContainer);
<a name="l01469"></a>01469         });
<a name="l01470"></a>01470 
<a name="l01471"></a>01471         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;the time header was updated&#39;</span>, <span class="keyword">function</span>() {
<a name="l01472"></a>01472           var header = container.previousElementSibling;
<a name="l01473"></a>01473           var headerTimestamp = header.dataset.time;
<a name="l01474"></a>01474           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.notEqual(headerTimestamp, oldHeaderTimestamp);
<a name="l01475"></a>01475         });
<a name="l01476"></a>01476       });
<a name="l01477"></a>01477     });
<a name="l01478"></a>01478 
<a name="l01479"></a>01479   });
<a name="l01480"></a>01480 
<a name="l01481"></a>01481   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;appendMessage removes old message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01482"></a>01482     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01483"></a>01483       this.targetMsg = {
<a name="l01484"></a>01484         <span class="keywordtype">id</span>: 23,
<a name="l01485"></a>01485         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l01486"></a>01486         receivers: this.receivers,
<a name="l01487"></a>01487         body: <span class="stringliteral">&#39;This is a test&#39;</span>,
<a name="l01488"></a>01488         delivery: <span class="stringliteral">&#39;error&#39;</span>,
<a name="l01489"></a>01489         timestamp: <span class="keyword">new</span> Date()
<a name="l01490"></a>01490       };
<a name="l01491"></a>01491       ThreadUI.appendMessage(this.targetMsg);
<a name="l01492"></a>01492       this.original = ThreadUI.container.querySelector(
<a name="l01493"></a>01493         <span class="stringliteral">&#39;[data-message-id=&quot;&#39;</span> + this.targetMsg.id + <span class="stringliteral">&#39;&quot;]&#39;</span>);
<a name="l01494"></a>01494       ThreadUI.appendMessage(this.targetMsg);
<a name="l01495"></a>01495     });
<a name="l01496"></a>01496     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;original message removed when rendered a second time&#39;</span>, <span class="keyword">function</span>() {
<a name="l01497"></a>01497       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a> = ThreadUI.container.querySelector(
<a name="l01498"></a>01498         <span class="stringliteral">&#39;[data-message-id=&quot;&#39;</span> + this.targetMsg.id + <span class="stringliteral">&#39;&quot;]&#39;</span>);
<a name="l01499"></a>01499       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.notEqual(message, this.original);
<a name="l01500"></a>01500     });
<a name="l01501"></a>01501   });
<a name="l01502"></a>01502 
<a name="l01503"></a>01503   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;buildMessageDOM &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l01504"></a>01504     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01505"></a>01505       this.sinon.spy(<a class="code" href="../../d6/d5f/build__stage_2email_2shared_2js_2template_8js.html#aab83dedcadf384ff4b12e9316e74d266">Template</a>, <span class="stringliteral">&#39;escape&#39;</span>);
<a name="l01506"></a>01506       this.sinon.stub(<a class="code" href="../../df/df0/mock__smil_8js.html#a6b381322ae0beb8383f9fc41d834dcd5">MockSMIL</a>, <span class="stringliteral">&#39;parse&#39;</span>);
<a name="l01507"></a>01507     });
<a name="l01508"></a>01508 
<a name="l01509"></a>01509     <span class="keyword">function</span> buildSMS(payload) {
<a name="l01510"></a>01510       <span class="keywordflow">return</span> <a class="code" href="../../df/d82/mock__messages_8js.html#acf5bc1c61de104c510fee84a151fb641">MockMessages</a>.sms({ body: payload });
<a name="l01511"></a>01511     }
<a name="l01512"></a>01512 
<a name="l01513"></a>01513     <span class="keyword">function</span> buildMMS(payload) {
<a name="l01514"></a>01514       <span class="keywordflow">return</span> <a class="code" href="../../df/d82/mock__messages_8js.html#acf5bc1c61de104c510fee84a151fb641">MockMessages</a>.mms({
<a name="l01515"></a>01515         attachments: [<span class="keyword">new</span> <a class="code" href="../../d7/d4b/namespacemozilla_1_1dom.html#a739d106dcb2584188674bb530d99233e">Blob</a>([payload], {<a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;text/plain&#39;</span>})]
<a name="l01516"></a>01516       });
<a name="l01517"></a>01517     }
<a name="l01518"></a>01518 
<a name="l01519"></a>01519     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;escapes the body for SMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01520"></a>01520       var payload = <span class="stringliteral">&#39;hello &lt;a href=&quot;world&quot;&gt;world&lt;/a&gt;&#39;</span>;
<a name="l01521"></a>01521       ThreadUI.buildMessageDOM(buildSMS(payload));
<a name="l01522"></a>01522       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d6/d5f/build__stage_2email_2shared_2js_2template_8js.html#aab83dedcadf384ff4b12e9316e74d266">Template</a>.escape.calledWith(payload));
<a name="l01523"></a>01523     });
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;escapes all text for MMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01526"></a>01526       var payload = <span class="stringliteral">&#39;hello &lt;a href=&quot;world&quot;&gt;world&lt;/a&gt;&#39;</span>;
<a name="l01527"></a>01527       <a class="code" href="../../df/df0/mock__smil_8js.html#a6b381322ae0beb8383f9fc41d834dcd5">MockSMIL</a>.parse.yields([{ <a class="code" href="../../dd/dfa/classtext.html">text</a>: payload }]);
<a name="l01528"></a>01528       ThreadUI.buildMessageDOM(buildMMS(payload));
<a name="l01529"></a>01529       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d6/d5f/build__stage_2email_2shared_2js_2template_8js.html#aab83dedcadf384ff4b12e9316e74d266">Template</a>.escape.calledWith(payload));
<a name="l01530"></a>01530     });
<a name="l01531"></a>01531   });
<a name="l01532"></a>01532 
<a name="l01533"></a>01533   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;renderMessages()&#39;</span>, <span class="keyword">function</span>() {
<a name="l01534"></a>01534     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01535"></a>01535       <span class="comment">// todo: use the MessageManager mock instead</span>
<a name="l01536"></a>01536       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;getMessages&#39;</span>);
<a name="l01537"></a>01537       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;markThreadRead&#39;</span>);
<a name="l01538"></a>01538       ThreadUI.renderMessages(1);
<a name="l01539"></a>01539     });
<a name="l01540"></a>01540 
<a name="l01541"></a>01541     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;we mark messages as read&#39;</span>, <span class="keyword">function</span>() {
<a name="l01542"></a>01542       <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.getMessages.yieldTo(<span class="stringliteral">&#39;done&#39;</span>);
<a name="l01543"></a>01543       this.sinon.clock.tick();
<a name="l01544"></a>01544       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.markThreadRead.calledWith(1));
<a name="l01545"></a>01545     });
<a name="l01546"></a>01546   });
<a name="l01547"></a>01547 
<a name="l01548"></a>01548   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;not-downloaded&#39;</span>, <span class="keyword">function</span>() {
<a name="l01549"></a>01549     var <a class="code" href="../../d1/de1/apps_2settings_2js_2utils_8js.html#a32930d17cd0e3a8078d1a8e5207cfc4d">localize</a>;
<a name="l01550"></a>01550     var ONE_DAY_TIME = 24 * 60 * 60 * 1000;
<a name="l01551"></a>01551 
<a name="l01552"></a>01552     <span class="keyword">function</span> getTestMessage(<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>) {
<a name="l01553"></a>01553       var testMessages = [{
<a name="l01554"></a>01554         <span class="keywordtype">id</span>: 1,
<a name="l01555"></a>01555         threadId: 8,
<a name="l01556"></a>01556         sender: <span class="stringliteral">&#39;123456&#39;</span>,
<a name="l01557"></a>01557         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;mms&#39;</span>,
<a name="l01558"></a>01558         delivery: <span class="stringliteral">&#39;not-downloaded&#39;</span>,
<a name="l01559"></a>01559         deliveryStatus: [<span class="stringliteral">&#39;pending&#39;</span>],
<a name="l01560"></a>01560         subject: <span class="stringliteral">&#39;Pending download&#39;</span>,
<a name="l01561"></a>01561         timestamp: <span class="keyword">new</span> Date(Date.now() - 150000),
<a name="l01562"></a>01562         expiryDate: <span class="keyword">new</span> Date(Date.now() + ONE_DAY_TIME)
<a name="l01563"></a>01563       },
<a name="l01564"></a>01564       {
<a name="l01565"></a>01565         <span class="keywordtype">id</span>: 2,
<a name="l01566"></a>01566         threadId: 8,
<a name="l01567"></a>01567         sender: <span class="stringliteral">&#39;123456&#39;</span>,
<a name="l01568"></a>01568         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;mms&#39;</span>,
<a name="l01569"></a>01569         delivery: <span class="stringliteral">&#39;not-downloaded&#39;</span>,
<a name="l01570"></a>01570         deliveryStatus: [<span class="stringliteral">&#39;manual&#39;</span>],
<a name="l01571"></a>01571         subject: <span class="stringliteral">&#39;manual download&#39;</span>,
<a name="l01572"></a>01572         timestamp: <span class="keyword">new</span> Date(Date.now() - 150000),
<a name="l01573"></a>01573         expiryDate: <span class="keyword">new</span> Date(Date.now() + ONE_DAY_TIME * 2)
<a name="l01574"></a>01574       },
<a name="l01575"></a>01575       {
<a name="l01576"></a>01576         <span class="keywordtype">id</span>: 3,
<a name="l01577"></a>01577         threadId: 8,
<a name="l01578"></a>01578         sender: <span class="stringliteral">&#39;123456&#39;</span>,
<a name="l01579"></a>01579         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;mms&#39;</span>,
<a name="l01580"></a>01580         delivery: <span class="stringliteral">&#39;not-downloaded&#39;</span>,
<a name="l01581"></a>01581         deliveryStatus: [<span class="stringliteral">&#39;error&#39;</span>],
<a name="l01582"></a>01582         subject: <span class="stringliteral">&#39;error download&#39;</span>,
<a name="l01583"></a>01583         timestamp: <span class="keyword">new</span> Date(Date.now() - 150000),
<a name="l01584"></a>01584         expiryDate: <span class="keyword">new</span> Date(Date.now() + ONE_DAY_TIME * 2)
<a name="l01585"></a>01585       },
<a name="l01586"></a>01586       {
<a name="l01587"></a>01587         <span class="keywordtype">id</span>: 4,
<a name="l01588"></a>01588         threadId: 8,
<a name="l01589"></a>01589         sender: <span class="stringliteral">&#39;123456&#39;</span>,
<a name="l01590"></a>01590         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;mms&#39;</span>,
<a name="l01591"></a>01591         delivery: <span class="stringliteral">&#39;not-downloaded&#39;</span>,
<a name="l01592"></a>01592         deliveryStatus: [<span class="stringliteral">&#39;error&#39;</span>],
<a name="l01593"></a>01593         subject: <span class="stringliteral">&#39;Error download&#39;</span>,
<a name="l01594"></a>01594         timestamp: <span class="keyword">new</span> Date(Date.now() - 150000),
<a name="l01595"></a>01595         expiryDate: <span class="keyword">new</span> Date(Date.now() - ONE_DAY_TIME)
<a name="l01596"></a>01596       }];
<a name="l01597"></a>01597 
<a name="l01598"></a>01598       <span class="keywordflow">return</span> testMessages[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>];
<a name="l01599"></a>01599     }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01602"></a>01602       <span class="comment">// we do this here because of sinon fake timers</span>
<a name="l01603"></a>01603       this.sinon.stub(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format, <span class="stringliteral">&#39;localeFormat&#39;</span>, <span class="keyword">function</span>() {
<a name="l01604"></a>01604         <span class="keywordflow">return</span> <span class="stringliteral">&#39;date_stub&#39;</span>;
<a name="l01605"></a>01605       });
<a name="l01606"></a>01606       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;retrieveMMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01607"></a>01607         <span class="keywordflow">return</span> {};
<a name="l01608"></a>01608       });
<a name="l01609"></a>01609       localize = this.sinon.spy(<a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n, <span class="stringliteral">&#39;localize&#39;</span>);
<a name="l01610"></a>01610     });
<a name="l01611"></a>01611     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;pending message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01612"></a>01612       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l01613"></a>01613       var element;
<a name="l01614"></a>01614       var notDownloadedMessage;
<a name="l01615"></a>01615       var <a class="code" href="../../d3/d4b/lockscreen_8js.html#a56a6742e738e925221d41ea45da5851d">button</a>;
<a name="l01616"></a>01616       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01617"></a>01617         message = getTestMessage(0);
<a name="l01618"></a>01618         ThreadUI.appendMessage(message);
<a name="l01619"></a>01619         element = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;message-&#39;</span> + message.id);
<a name="l01620"></a>01620         notDownloadedMessage = element.querySelector(<span class="stringliteral">&#39;.not-downloaded-message&#39;</span>);
<a name="l01621"></a>01621         button = element.querySelector(<span class="stringliteral">&#39;button&#39;</span>);
<a name="l01622"></a>01622 
<a name="l01623"></a>01623       });
<a name="l01624"></a>01624       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;element has correct data-message-id&#39;</span>, <span class="keyword">function</span>() {
<a name="l01625"></a>01625         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(element.dataset.messageId, message.id);
<a name="l01626"></a>01626       });
<a name="l01627"></a>01627       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;not-downloaded class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01628"></a>01628         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;not-downloaded&#39;</span>));
<a name="l01629"></a>01629       });
<a name="l01630"></a>01630       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01631"></a>01631         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01632"></a>01632       });
<a name="l01633"></a>01633       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;expired class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01634"></a>01634         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;expired&#39;</span>));
<a name="l01635"></a>01635       });
<a name="l01636"></a>01636       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01637"></a>01637         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01638"></a>01638       });
<a name="l01639"></a>01639       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l01640"></a>01640         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(notDownloadedMessage.dataset.l10nId,
<a name="l01641"></a>01641           <span class="stringliteral">&#39;not-downloaded-mms&#39;</span>,
<a name="l01642"></a>01642           <span class="stringliteral">&#39;localization id set correctly&#39;</span>);
<a name="l01643"></a>01643         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(notDownloadedMessage.dataset.l10nArgs,
<a name="l01644"></a>01644           <span class="stringliteral">&#39;{&quot;date&quot;:&quot;date_stub&quot;}&#39;</span>,
<a name="l01645"></a>01645           <span class="stringliteral">&#39;localization arguments set correctly&#39;</span>);
<a name="l01646"></a>01646       });
<a name="l01647"></a>01647       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;date is correctly determined&#39;</span>, <span class="keyword">function</span>() {
<a name="l01648"></a>01648         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format.localeFormat.args[0][0],
<a name="l01649"></a>01649           message.expiryDate);
<a name="l01650"></a>01650         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format.localeFormat.args[0][1],
<a name="l01651"></a>01651           <span class="stringliteral">&#39;dateTimeFormat_%x&#39;</span>);
<a name="l01652"></a>01652       });
<a name="l01653"></a>01653       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button text is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l01654"></a>01654         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(button.dataset.l10nId, <span class="stringliteral">&#39;downloading&#39;</span>);
<a name="l01655"></a>01655       });
<a name="l01656"></a>01656       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;clicking&#39;</span>, <span class="keyword">function</span>() {
<a name="l01657"></a>01657         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01658"></a>01658           ThreadUI.handleMessageClick({
<a name="l01659"></a>01659             <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: button
<a name="l01660"></a>01660           });
<a name="l01661"></a>01661         });
<a name="l01662"></a>01662         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;does not call retrieveMMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01663"></a>01663           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.args.length, 0);
<a name="l01664"></a>01664         });
<a name="l01665"></a>01665       });
<a name="l01666"></a>01666     });
<a name="l01667"></a>01667     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;manual message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01668"></a>01668       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l01669"></a>01669       var element;
<a name="l01670"></a>01670       var notDownloadedMessage;
<a name="l01671"></a>01671       var <a class="code" href="../../d3/d4b/lockscreen_8js.html#a56a6742e738e925221d41ea45da5851d">button</a>;
<a name="l01672"></a>01672       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01673"></a>01673         message = getTestMessage(1);
<a name="l01674"></a>01674         ThreadUI.appendMessage(message);
<a name="l01675"></a>01675         element = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;message-&#39;</span> + message.id);
<a name="l01676"></a>01676         notDownloadedMessage = element.querySelector(<span class="stringliteral">&#39;.not-downloaded-message&#39;</span>);
<a name="l01677"></a>01677         button = element.querySelector(<span class="stringliteral">&#39;button&#39;</span>);
<a name="l01678"></a>01678       });
<a name="l01679"></a>01679       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;element has correct data-message-id&#39;</span>, <span class="keyword">function</span>() {
<a name="l01680"></a>01680         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(element.dataset.messageId, message.id);
<a name="l01681"></a>01681       });
<a name="l01682"></a>01682       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;not-downloaded class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01683"></a>01683         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;not-downloaded&#39;</span>));
<a name="l01684"></a>01684       });
<a name="l01685"></a>01685       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01686"></a>01686         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01687"></a>01687       });
<a name="l01688"></a>01688       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;expired class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01689"></a>01689         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;expired&#39;</span>));
<a name="l01690"></a>01690       });
<a name="l01691"></a>01691       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01692"></a>01692         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01693"></a>01693       });
<a name="l01694"></a>01694       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l01695"></a>01695         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(notDownloadedMessage.dataset.l10nId,
<a name="l01696"></a>01696           <span class="stringliteral">&#39;not-downloaded-mms&#39;</span>,
<a name="l01697"></a>01697           <span class="stringliteral">&#39;localization id set correctly&#39;</span>);
<a name="l01698"></a>01698         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(notDownloadedMessage.dataset.l10nArgs,
<a name="l01699"></a>01699           <span class="stringliteral">&#39;{&quot;date&quot;:&quot;date_stub&quot;}&#39;</span>,
<a name="l01700"></a>01700           <span class="stringliteral">&#39;localization arguments set correctly&#39;</span>);
<a name="l01701"></a>01701       });
<a name="l01702"></a>01702       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;date is correctly determined&#39;</span>, <span class="keyword">function</span>() {
<a name="l01703"></a>01703         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format.localeFormat.args[0][0],
<a name="l01704"></a>01704           message.expiryDate);
<a name="l01705"></a>01705         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format.localeFormat.args[0][1],
<a name="l01706"></a>01706           <span class="stringliteral">&#39;dateTimeFormat_%x&#39;</span>);
<a name="l01707"></a>01707       });
<a name="l01708"></a>01708       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button text is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l01709"></a>01709         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(button.dataset.l10nId, <span class="stringliteral">&#39;download&#39;</span>);
<a name="l01710"></a>01710       });
<a name="l01711"></a>01711       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;clicking&#39;</span>, <span class="keyword">function</span>() {
<a name="l01712"></a>01712         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01713"></a>01713           localize.reset();
<a name="l01714"></a>01714           ThreadUI.handleMessageClick({
<a name="l01715"></a>01715             <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: button
<a name="l01716"></a>01716           });
<a name="l01717"></a>01717         });
<a name="l01718"></a>01718         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;changes download text&#39;</span>, <span class="keyword">function</span>() {
<a name="l01719"></a>01719           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(localize.calledWith(button, <span class="stringliteral">&#39;downloading&#39;</span>));
<a name="l01720"></a>01720         });
<a name="l01721"></a>01721         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01722"></a>01722           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01723"></a>01723         });
<a name="l01724"></a>01724         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01725"></a>01725           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01726"></a>01726         });
<a name="l01727"></a>01727         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;click calls retrieveMMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01728"></a>01728           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.calledWith(message.id));
<a name="l01729"></a>01729         });
<a name="l01730"></a>01730         <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;response error&#39;</span>, <span class="keyword">function</span>() {
<a name="l01731"></a>01731           <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01732"></a>01732             localize.reset();
<a name="l01733"></a>01733             <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.returnValues[0].onerror();
<a name="l01734"></a>01734           });
<a name="l01735"></a>01735           <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01736"></a>01736             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01737"></a>01737           });
<a name="l01738"></a>01738           <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01739"></a>01739             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01740"></a>01740           });
<a name="l01741"></a>01741           <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;changes download text&#39;</span>, <span class="keyword">function</span>() {
<a name="l01742"></a>01742             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(localize.calledWith(button, <span class="stringliteral">&#39;download&#39;</span>));
<a name="l01743"></a>01743           });
<a name="l01744"></a>01744         });
<a name="l01745"></a>01745         <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;response success&#39;</span>, <span class="keyword">function</span>() {
<a name="l01746"></a>01746           <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01747"></a>01747             <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.returnValues[0].onsuccess();
<a name="l01748"></a>01748           });
<a name="l01749"></a>01749           <span class="comment">// re-rendering message happens from a status handler</span>
<a name="l01750"></a>01750           <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;removes message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01751"></a>01751             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(element.parentNode, <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>);
<a name="l01752"></a>01752           });
<a name="l01753"></a>01753         });
<a name="l01754"></a>01754       });
<a name="l01755"></a>01755     });
<a name="l01756"></a>01756     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;error message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01757"></a>01757       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l01758"></a>01758       var element;
<a name="l01759"></a>01759       var notDownloadedMessage;
<a name="l01760"></a>01760       var <a class="code" href="../../d3/d4b/lockscreen_8js.html#a56a6742e738e925221d41ea45da5851d">button</a>;
<a name="l01761"></a>01761       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01762"></a>01762         message = getTestMessage(2);
<a name="l01763"></a>01763         ThreadUI.appendMessage(message);
<a name="l01764"></a>01764         element = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;message-&#39;</span> + message.id);
<a name="l01765"></a>01765         notDownloadedMessage = element.querySelector(<span class="stringliteral">&#39;.not-downloaded-message&#39;</span>);
<a name="l01766"></a>01766         button = element.querySelector(<span class="stringliteral">&#39;button&#39;</span>);
<a name="l01767"></a>01767       });
<a name="l01768"></a>01768       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;element has correct data-message-id&#39;</span>, <span class="keyword">function</span>() {
<a name="l01769"></a>01769         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(element.dataset.messageId, message.id);
<a name="l01770"></a>01770       });
<a name="l01771"></a>01771       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;not-downloaded class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01772"></a>01772         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;not-downloaded&#39;</span>));
<a name="l01773"></a>01773       });
<a name="l01774"></a>01774       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01775"></a>01775         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01776"></a>01776       });
<a name="l01777"></a>01777       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;expired class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01778"></a>01778         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;expired&#39;</span>));
<a name="l01779"></a>01779       });
<a name="l01780"></a>01780       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01781"></a>01781         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01782"></a>01782       });
<a name="l01783"></a>01783       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l01784"></a>01784         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(notDownloadedMessage.dataset.l10nId,
<a name="l01785"></a>01785           <span class="stringliteral">&#39;not-downloaded-mms&#39;</span>,
<a name="l01786"></a>01786           <span class="stringliteral">&#39;localization id set correctly&#39;</span>);
<a name="l01787"></a>01787         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(notDownloadedMessage.dataset.l10nArgs,
<a name="l01788"></a>01788           <span class="stringliteral">&#39;{&quot;date&quot;:&quot;date_stub&quot;}&#39;</span>,
<a name="l01789"></a>01789           <span class="stringliteral">&#39;localization arguments set correctly&#39;</span>);
<a name="l01790"></a>01790       });
<a name="l01791"></a>01791       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;date is correctly determined&#39;</span>, <span class="keyword">function</span>() {
<a name="l01792"></a>01792         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format.localeFormat.args[0][0],
<a name="l01793"></a>01793           message.expiryDate);
<a name="l01794"></a>01794         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format.localeFormat.args[0][1],
<a name="l01795"></a>01795           <span class="stringliteral">&#39;dateTimeFormat_%x&#39;</span>);
<a name="l01796"></a>01796       });
<a name="l01797"></a>01797       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;button text is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l01798"></a>01798         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(button.dataset.l10nId, <span class="stringliteral">&#39;download&#39;</span>);
<a name="l01799"></a>01799       });
<a name="l01800"></a>01800       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;clicking&#39;</span>, <span class="keyword">function</span>() {
<a name="l01801"></a>01801         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01802"></a>01802           localize.reset();
<a name="l01803"></a>01803           ThreadUI.handleMessageClick({
<a name="l01804"></a>01804             <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: button
<a name="l01805"></a>01805           });
<a name="l01806"></a>01806         });
<a name="l01807"></a>01807         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;changes download text&#39;</span>, <span class="keyword">function</span>() {
<a name="l01808"></a>01808           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(localize.calledWith(button, <span class="stringliteral">&#39;downloading&#39;</span>));
<a name="l01809"></a>01809         });
<a name="l01810"></a>01810         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01811"></a>01811           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01812"></a>01812         });
<a name="l01813"></a>01813         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01814"></a>01814           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01815"></a>01815         });
<a name="l01816"></a>01816         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;click calls retrieveMMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01817"></a>01817           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.calledWith(message.id));
<a name="l01818"></a>01818         });
<a name="l01819"></a>01819         <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;response error&#39;</span>, <span class="keyword">function</span>() {
<a name="l01820"></a>01820           <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01821"></a>01821             localize.reset();
<a name="l01822"></a>01822             <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.returnValues[0].onerror();
<a name="l01823"></a>01823           });
<a name="l01824"></a>01824           <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01825"></a>01825             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01826"></a>01826           });
<a name="l01827"></a>01827           <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01828"></a>01828             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01829"></a>01829           });
<a name="l01830"></a>01830           <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;changes download text&#39;</span>, <span class="keyword">function</span>() {
<a name="l01831"></a>01831             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(localize.calledWith(button, <span class="stringliteral">&#39;download&#39;</span>));
<a name="l01832"></a>01832           });
<a name="l01833"></a>01833         });
<a name="l01834"></a>01834         <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;response success&#39;</span>, <span class="keyword">function</span>() {
<a name="l01835"></a>01835           <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01836"></a>01836             <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.returnValues[0].onsuccess();
<a name="l01837"></a>01837           });
<a name="l01838"></a>01838           <span class="comment">// re-rendering message happens from a status handler</span>
<a name="l01839"></a>01839           <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;removes message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01840"></a>01840             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(element.parentNode, <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>);
<a name="l01841"></a>01841           });
<a name="l01842"></a>01842         });
<a name="l01843"></a>01843       });
<a name="l01844"></a>01844     });
<a name="l01845"></a>01845 
<a name="l01846"></a>01846     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;expired message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01847"></a>01847       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l01848"></a>01848       var element;
<a name="l01849"></a>01849       var notDownloadedMessage;
<a name="l01850"></a>01850       var <a class="code" href="../../d3/d4b/lockscreen_8js.html#a56a6742e738e925221d41ea45da5851d">button</a>;
<a name="l01851"></a>01851       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01852"></a>01852         message = getTestMessage(3);
<a name="l01853"></a>01853         ThreadUI.appendMessage(message);
<a name="l01854"></a>01854         element = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;message-&#39;</span> + message.id);
<a name="l01855"></a>01855         notDownloadedMessage = element.querySelector(<span class="stringliteral">&#39;.not-downloaded-message&#39;</span>);
<a name="l01856"></a>01856         button = element.querySelector(<span class="stringliteral">&#39;button&#39;</span>);
<a name="l01857"></a>01857       });
<a name="l01858"></a>01858       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;element has correct data-message-id&#39;</span>, <span class="keyword">function</span>() {
<a name="l01859"></a>01859         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(element.dataset.messageId, message.id);
<a name="l01860"></a>01860       });
<a name="l01861"></a>01861       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;not-downloaded class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01862"></a>01862         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;not-downloaded&#39;</span>));
<a name="l01863"></a>01863       });
<a name="l01864"></a>01864       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01865"></a>01865         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01866"></a>01866       });
<a name="l01867"></a>01867       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;expired class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01868"></a>01868         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;expired&#39;</span>));
<a name="l01869"></a>01869       });
<a name="l01870"></a>01870       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01871"></a>01871         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01872"></a>01872       });
<a name="l01873"></a>01873       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l01874"></a>01874         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(notDownloadedMessage.dataset.l10nId,
<a name="l01875"></a>01875           <span class="stringliteral">&#39;expired-mms&#39;</span>,
<a name="l01876"></a>01876           <span class="stringliteral">&#39;localization id set correctly&#39;</span>);
<a name="l01877"></a>01877         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(notDownloadedMessage.dataset.l10nArgs,
<a name="l01878"></a>01878           <span class="stringliteral">&#39;{&quot;date&quot;:&quot;date_stub&quot;}&#39;</span>,
<a name="l01879"></a>01879           <span class="stringliteral">&#39;localization arguments set correctly&#39;</span>);
<a name="l01880"></a>01880       });
<a name="l01881"></a>01881       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;date is correctly determined&#39;</span>, <span class="keyword">function</span>() {
<a name="l01882"></a>01882         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format.localeFormat.args[0][0],
<a name="l01883"></a>01883           message.expiryDate);
<a name="l01884"></a>01884         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format.localeFormat.args[0][1],
<a name="l01885"></a>01885           <span class="stringliteral">&#39;dateTimeFormat_%x&#39;</span>);
<a name="l01886"></a>01886       });
<a name="l01887"></a>01887       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;clicking&#39;</span>, <span class="keyword">function</span>() {
<a name="l01888"></a>01888         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01889"></a>01889           ThreadUI.handleMessageClick({
<a name="l01890"></a>01890             <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: button
<a name="l01891"></a>01891           });
<a name="l01892"></a>01892         });
<a name="l01893"></a>01893         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;does not call retrieveMMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01894"></a>01894           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.args.length, 0);
<a name="l01895"></a>01895         });
<a name="l01896"></a>01896       });
<a name="l01897"></a>01897     });
<a name="l01898"></a>01898   });
<a name="l01899"></a>01899 
<a name="l01900"></a>01900   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;No attachment error handling&#39;</span>, <span class="keyword">function</span>() {
<a name="l01901"></a>01901     <span class="keyword">function</span> getTestMessage(<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>) {
<a name="l01902"></a>01902       var testMessages = [{
<a name="l01903"></a>01903         <span class="keywordtype">id</span>: 1,
<a name="l01904"></a>01904         threadId: 8,
<a name="l01905"></a>01905         sender: <span class="stringliteral">&#39;123456&#39;</span>,
<a name="l01906"></a>01906         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;mms&#39;</span>,
<a name="l01907"></a>01907         delivery: <span class="stringliteral">&#39;received&#39;</span>,
<a name="l01908"></a>01908         deliveryStatus: [<span class="stringliteral">&#39;success&#39;</span>],
<a name="l01909"></a>01909         subject: <span class="stringliteral">&#39;No attachment testing&#39;</span>,
<a name="l01910"></a>01910         smil: <span class="stringliteral">&#39;&lt;smil&gt;&lt;body&gt;&lt;par&gt;&lt;text src=&quot;cid:1&quot;/&gt;&#39;</span> +
<a name="l01911"></a>01911               <span class="stringliteral">&#39;&lt;/par&gt;&lt;/body&gt;&lt;/smil&gt;&#39;</span>,
<a name="l01912"></a>01912         attachments: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01913"></a>01913         timestamp: <span class="keyword">new</span> Date(Date.now() - 150000),
<a name="l01914"></a>01914         expiryDate: <span class="keyword">new</span> Date(Date.now())
<a name="l01915"></a>01915       },
<a name="l01916"></a>01916       {
<a name="l01917"></a>01917         <span class="keywordtype">id</span>: 2,
<a name="l01918"></a>01918         threadId: 8,
<a name="l01919"></a>01919         sender: <span class="stringliteral">&#39;123456&#39;</span>,
<a name="l01920"></a>01920         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;mms&#39;</span>,
<a name="l01921"></a>01921         delivery: <span class="stringliteral">&#39;received&#39;</span>,
<a name="l01922"></a>01922         deliveryStatus: [<span class="stringliteral">&#39;success&#39;</span>],
<a name="l01923"></a>01923         subject: <span class="stringliteral">&#39;Empty attachment testing&#39;</span>,
<a name="l01924"></a>01924         smil: <span class="stringliteral">&#39;&lt;smil&gt;&lt;body&gt;&lt;par&gt;&lt;text src=&quot;cid:1&quot;/&gt;&#39;</span> +
<a name="l01925"></a>01925               <span class="stringliteral">&#39;&lt;/par&gt;&lt;/body&gt;&lt;/smil&gt;&#39;</span>,
<a name="l01926"></a>01926         attachments: [],
<a name="l01927"></a>01927         timestamp: <span class="keyword">new</span> Date(Date.now() - 100000),
<a name="l01928"></a>01928         expiryDate: <span class="keyword">new</span> Date(Date.now())
<a name="l01929"></a>01929       }];
<a name="l01930"></a>01930 
<a name="l01931"></a>01931       <span class="keywordflow">return</span> testMessages[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>];
<a name="l01932"></a>01932     }
<a name="l01933"></a>01933 
<a name="l01934"></a>01934     var <a class="code" href="../../d1/de1/apps_2settings_2js_2utils_8js.html#a32930d17cd0e3a8078d1a8e5207cfc4d">localize</a>;
<a name="l01935"></a>01935     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01936"></a>01936       this.sinon.stub(<a class="code" href="../../d1/db7/apps_2communications_2dialer_2js_2utils_8js.html#af21ebfdaa2ee891fa5788a82b2e2586c">Utils</a>.date.format, <span class="stringliteral">&#39;localeFormat&#39;</span>, <span class="keyword">function</span>() {
<a name="l01937"></a>01937         <span class="keywordflow">return</span> <span class="stringliteral">&#39;date_stub&#39;</span>;
<a name="l01938"></a>01938       });
<a name="l01939"></a>01939       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;retrieveMMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01940"></a>01940         <span class="keywordflow">return</span> {};
<a name="l01941"></a>01941       });
<a name="l01942"></a>01942       localize = this.sinon.spy(<a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n, <span class="stringliteral">&#39;localize&#39;</span>);
<a name="l01943"></a>01943     });
<a name="l01944"></a>01944 
<a name="l01945"></a>01945     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;no attachment message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01946"></a>01946       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l01947"></a>01947       var element;
<a name="l01948"></a>01948       var noAttachmentMessage;
<a name="l01949"></a>01949       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01950"></a>01950         message = getTestMessage(0);
<a name="l01951"></a>01951         ThreadUI.appendMessage(message);
<a name="l01952"></a>01952         element = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;message-&#39;</span> + message.id);
<a name="l01953"></a>01953         noAttachmentMessage = element.querySelector(<span class="charliteral">&#39;p&#39;</span>);
<a name="l01954"></a>01954       });
<a name="l01955"></a>01955       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;element has correct data-message-id&#39;</span>, <span class="keyword">function</span>() {
<a name="l01956"></a>01956         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(element.dataset.messageId, message.id);
<a name="l01957"></a>01957       });
<a name="l01958"></a>01958       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no-attachment class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01959"></a>01959         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;no-attachment&#39;</span>));
<a name="l01960"></a>01960       });
<a name="l01961"></a>01961       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01962"></a>01962         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l01963"></a>01963       });
<a name="l01964"></a>01964       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l01965"></a>01965         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l01966"></a>01966       });
<a name="l01967"></a>01967       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l01968"></a>01968         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l01969"></a>01969           localize.calledWith(noAttachmentMessage, <span class="stringliteral">&#39;no-attachment-text&#39;</span>)
<a name="l01970"></a>01970         );
<a name="l01971"></a>01971       });
<a name="l01972"></a>01972       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;clicking&#39;</span>, <span class="keyword">function</span>() {
<a name="l01973"></a>01973         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01974"></a>01974           ThreadUI.handleMessageClick({
<a name="l01975"></a>01975             <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: element
<a name="l01976"></a>01976           });
<a name="l01977"></a>01977         });
<a name="l01978"></a>01978         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Should not call retrieveMMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l01979"></a>01979           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.called);
<a name="l01980"></a>01980         });
<a name="l01981"></a>01981       });
<a name="l01982"></a>01982     });
<a name="l01983"></a>01983 
<a name="l01984"></a>01984     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Empty attachment message&#39;</span>, <span class="keyword">function</span>() {
<a name="l01985"></a>01985       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l01986"></a>01986       var element;
<a name="l01987"></a>01987       var noAttachmentMessage;
<a name="l01988"></a>01988       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l01989"></a>01989         message = getTestMessage(1);
<a name="l01990"></a>01990         ThreadUI.appendMessage(message);
<a name="l01991"></a>01991         element = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;message-&#39;</span> + message.id);
<a name="l01992"></a>01992         noAttachmentMessage = element.querySelector(<span class="charliteral">&#39;p&#39;</span>);
<a name="l01993"></a>01993       });
<a name="l01994"></a>01994       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;element has correct data-message-id&#39;</span>, <span class="keyword">function</span>() {
<a name="l01995"></a>01995         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(element.dataset.messageId, message.id);
<a name="l01996"></a>01996       });
<a name="l01997"></a>01997       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;no-attachment class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l01998"></a>01998         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;no-attachment&#39;</span>));
<a name="l01999"></a>01999       });
<a name="l02000"></a>02000       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;error class present&#39;</span>, <span class="keyword">function</span>() {
<a name="l02001"></a>02001         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(element.classList.contains(<span class="stringliteral">&#39;error&#39;</span>));
<a name="l02002"></a>02002       });
<a name="l02003"></a>02003       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pending class absent&#39;</span>, <span class="keyword">function</span>() {
<a name="l02004"></a>02004         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(element.classList.contains(<span class="stringliteral">&#39;pending&#39;</span>));
<a name="l02005"></a>02005       });
<a name="l02006"></a>02006       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;message is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l02007"></a>02007         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l02008"></a>02008           localize.calledWith(noAttachmentMessage, <span class="stringliteral">&#39;no-attachment-text&#39;</span>)
<a name="l02009"></a>02009         );
<a name="l02010"></a>02010       });
<a name="l02011"></a>02011       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;clicking&#39;</span>, <span class="keyword">function</span>() {
<a name="l02012"></a>02012         <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l02013"></a>02013           ThreadUI.handleMessageClick({
<a name="l02014"></a>02014             <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: element
<a name="l02015"></a>02015           });
<a name="l02016"></a>02016         });
<a name="l02017"></a>02017         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Should not call retrieveMMS&#39;</span>, <span class="keyword">function</span>() {
<a name="l02018"></a>02018           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.retrieveMMS.called);
<a name="l02019"></a>02019         });
<a name="l02020"></a>02020       });
<a name="l02021"></a>02021     });
<a name="l02022"></a>02022   });
<a name="l02023"></a>02023 
<a name="l02024"></a>02024   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;resendMessage&#39;</span>, <span class="keyword">function</span>() {
<a name="l02025"></a>02025     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l02026"></a>02026       this.receivers = [<span class="stringliteral">&#39;1234&#39;</span>];
<a name="l02027"></a>02027       this.targetMsg = {
<a name="l02028"></a>02028         <span class="keywordtype">id</span>: 23,
<a name="l02029"></a>02029         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l02030"></a>02030         receivers: this.receivers,
<a name="l02031"></a>02031         body: <span class="stringliteral">&#39;This is a test&#39;</span>,
<a name="l02032"></a>02032         delivery: <span class="stringliteral">&#39;error&#39;</span>,
<a name="l02033"></a>02033         timestamp: <span class="keyword">new</span> Date()
<a name="l02034"></a>02034       };
<a name="l02035"></a>02035       this.otherMsg = {
<a name="l02036"></a>02036         <span class="keywordtype">id</span>: 45,
<a name="l02037"></a>02037         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l02038"></a>02038         receivers: this.receivers,
<a name="l02039"></a>02039         body: <span class="stringliteral">&#39;this test&#39;</span>,
<a name="l02040"></a>02040         delivery: <span class="stringliteral">&#39;error&#39;</span>,
<a name="l02041"></a>02041         timestamp: <span class="keyword">new</span> Date()
<a name="l02042"></a>02042       };
<a name="l02043"></a>02043       ThreadUI.appendMessage(this.targetMsg);
<a name="l02044"></a>02044       ThreadUI.appendMessage(this.otherMsg);
<a name="l02045"></a>02045 
<a name="l02046"></a>02046       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.length(
<a name="l02047"></a>02047         ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;[data-message-id=&quot;23&quot;]&#39;</span>),
<a name="l02048"></a>02048         1);
<a name="l02049"></a>02049       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.length(
<a name="l02050"></a>02050         ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;[data-message-id=&quot;45&quot;]&#39;</span>),
<a name="l02051"></a>02051         1);
<a name="l02052"></a>02052 
<a name="l02053"></a>02053       this.getMessageReq = {};
<a name="l02054"></a>02054       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;getMessage&#39;</span>)
<a name="l02055"></a>02055         .returns(this.getMessageReq);
<a name="l02056"></a>02056       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;deleteMessage&#39;</span>).callsArgWith(1, <span class="keyword">true</span>);
<a name="l02057"></a>02057       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;resendMessage&#39;</span>);
<a name="l02058"></a>02058     });
<a name="l02059"></a>02059 
<a name="l02060"></a>02060     <span class="comment">// TODO: Implement this functionality in a specialized method and update</span>
<a name="l02061"></a>02061     <span class="comment">// this test accordingly.</span>
<a name="l02062"></a>02062     <span class="comment">// Bug 872725 - [MMS] Message deletion logic is duplicated</span>
<a name="l02063"></a>02063     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;removes the markup of only the specified message from the DOM&#39;</span>,
<a name="l02064"></a>02064       <span class="keyword">function</span>() {
<a name="l02065"></a>02065       ThreadUI.resendMessage(23);
<a name="l02066"></a>02066 
<a name="l02067"></a>02067       this.getMessageReq.result = this.targetMsg;
<a name="l02068"></a>02068       this.getMessageReq.onsuccess();
<a name="l02069"></a>02069 
<a name="l02070"></a>02070       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.length(
<a name="l02071"></a>02071         ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;[data-message-id=&quot;23&quot;]&#39;</span>),
<a name="l02072"></a>02072         0);
<a name="l02073"></a>02073       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.length(
<a name="l02074"></a>02074         ThreadUI.container.querySelectorAll(<span class="stringliteral">&#39;[data-message-id=&quot;45&quot;]&#39;</span>),
<a name="l02075"></a>02075         1);
<a name="l02076"></a>02076     });
<a name="l02077"></a>02077 
<a name="l02078"></a>02078     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;invokes MessageManager.resendMessage&#39;</span>, <span class="keyword">function</span>() {
<a name="l02079"></a>02079       ThreadUI.resendMessage(23);
<a name="l02080"></a>02080 
<a name="l02081"></a>02081       this.getMessageReq.result = this.targetMsg;
<a name="l02082"></a>02082       this.getMessageReq.onsuccess();
<a name="l02083"></a>02083 
<a name="l02084"></a>02084       var <a class="code" href="../../db/d7b/r_8js.html#a283fa4dd58795cf5b621404be6601e86">args</a> = <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.resendMessage.args[0];
<a name="l02085"></a>02085       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(args[0], this.targetMsg);
<a name="l02086"></a>02086     });
<a name="l02087"></a>02087   });
<a name="l02088"></a>02088 
<a name="l02089"></a>02089   <span class="comment">// Bug 890206 - Resending a message with delivery status</span>
<a name="l02090"></a>02090   <span class="comment">// error on a thread with just that message, should leave</span>
<a name="l02091"></a>02091   <span class="comment">// the thread with just one message.</span>
<a name="l02092"></a>02092   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Message error resent in thread with 1 message&#39;</span>, <span class="keyword">function</span>() {
<a name="l02093"></a>02093     var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>, <a class="code" href="../../df/d44/permission__manager_8js.html#ad9abb423164fcb98d6ad9333893e4682">request</a>;
<a name="l02094"></a>02094     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l02095"></a>02095       message = {
<a name="l02096"></a>02096         <span class="keywordtype">id</span>: 23,
<a name="l02097"></a>02097         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l02098"></a>02098         body: <span class="stringliteral">&#39;This is a error sms&#39;</span>,
<a name="l02099"></a>02099         delivery: <span class="stringliteral">&#39;error&#39;</span>,
<a name="l02100"></a>02100         timestamp: <span class="keyword">new</span> Date()
<a name="l02101"></a>02101       };
<a name="l02102"></a>02102       ThreadUI.appendMessage(message);
<a name="l02103"></a>02103 
<a name="l02104"></a>02104       this.sinon.stub(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>, <span class="stringliteral">&#39;confirm&#39;</span>);
<a name="l02105"></a>02105       <span class="comment">// TODO use MockMessageManager instead</span>
<a name="l02106"></a>02106       request = {};
<a name="l02107"></a>02107       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;getMessage&#39;</span>).returns(request);
<a name="l02108"></a>02108       this.sinon.stub(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>, <span class="stringliteral">&#39;resendMessage&#39;</span>);
<a name="l02109"></a>02109       this.errorMsg = ThreadUI.container.querySelector(<span class="stringliteral">&#39;.error&#39;</span>);
<a name="l02110"></a>02110     });
<a name="l02111"></a>02111 
<a name="l02112"></a>02112     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;clicking on an error message bubble in a thread with 1 message &#39;</span> +
<a name="l02113"></a>02113       <span class="stringliteral">&#39;should try to resend and remove the errored message&#39;</span>,
<a name="l02114"></a>02114       <span class="keyword">function</span>() {
<a name="l02115"></a>02115       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.confirm.returns(<span class="keyword">true</span>);
<a name="l02116"></a>02116       this.errorMsg.querySelector(<span class="stringliteral">&#39;.pack-end&#39;</span>).click();
<a name="l02117"></a>02117 
<a name="l02118"></a>02118       request.result = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l02119"></a>02119       request.onsuccess &amp;&amp; request.onsuccess.call(request);
<a name="l02120"></a>02120       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isNull(ThreadUI.container.querySelector(<span class="stringliteral">&#39;li&#39;</span>));
<a name="l02121"></a>02121       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.resendMessage.calledWith(message));
<a name="l02122"></a>02122     });
<a name="l02123"></a>02123   });
<a name="l02124"></a>02124 
<a name="l02125"></a>02125   <span class="comment">// TODO: Move these tests to an integration test suite.</span>
<a name="l02126"></a>02126   <span class="comment">// Bug 868056 - Clean up SMS test suite</span>
<a name="l02127"></a>02127 
<a name="l02128"></a>02128   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Actions on the links &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02129"></a>02129     var messageId = 23, link, phone = <span class="stringliteral">&#39;123123123&#39;</span>;
<a name="l02130"></a>02130     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l02131"></a>02131       this.sinon.spy(LinkActionHandler, <span class="stringliteral">&#39;onClick&#39;</span>);
<a name="l02132"></a>02132       this.sinon.spy(LinkActionHandler, <span class="stringliteral">&#39;onContextMenu&#39;</span>);
<a name="l02133"></a>02133 
<a name="l02134"></a>02134       this.sinon.stub(LinkHelper, <span class="stringliteral">&#39;searchAndLinkClickableData&#39;</span>, <span class="keyword">function</span>() {
<a name="l02135"></a>02135         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;a data-dial=&quot;&#39;</span> + phone +
<a name="l02136"></a>02136         <span class="stringliteral">&#39;&quot; data-action=&quot;dial-link&quot;&gt;&#39;</span> + phone + <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;
<a name="l02137"></a>02137       });
<a name="l02138"></a>02138 
<a name="l02139"></a>02139       ThreadUI.appendMessage({
<a name="l02140"></a>02140         <span class="keywordtype">id</span>: messageId,
<a name="l02141"></a>02141         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l02142"></a>02142         body: <span class="stringliteral">&#39;This is a test with 123123123&#39;</span>,
<a name="l02143"></a>02143         delivery: <span class="stringliteral">&#39;error&#39;</span>,
<a name="l02144"></a>02144         timestamp: <span class="keyword">new</span> Date()
<a name="l02145"></a>02145       });
<a name="l02146"></a>02146       <span class="comment">// Retrieve DOM element for executing the event</span>
<a name="l02147"></a>02147       var messageDOM = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;message-&#39;</span> + messageId);
<a name="l02148"></a>02148       link = messageDOM.querySelector(<span class="charliteral">&#39;a&#39;</span>);
<a name="l02149"></a>02149     });
<a name="l02150"></a>02150 
<a name="l02151"></a>02151     teardown(<span class="keyword">function</span>() {
<a name="l02152"></a>02152       ThreadUI.container.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02153"></a>02153       link = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l02154"></a>02154     });
<a name="l02155"></a>02155 
<a name="l02156"></a>02156     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39; &quot;click&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02157"></a>02157       <span class="comment">// In this case we are checking the &#39;click&#39; action on a link</span>
<a name="l02158"></a>02158       link.click();
<a name="l02159"></a>02159       <span class="comment">// This &#39;click&#39; was handled properly?</span>
<a name="l02160"></a>02160       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(LinkActionHandler.onClick.called);
<a name="l02161"></a>02161       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(LinkActionHandler.onContextMenu.called);
<a name="l02162"></a>02162     });
<a name="l02163"></a>02163 
<a name="l02164"></a>02164     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39; &quot;contextmenu&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02165"></a>02165       var contextMenuEvent = <span class="keyword">new</span> <a class="code" href="../../d0/dfb/namespacemozilla_1_1dom_1_1prototypes_1_1id.html#addcec93baff9084aadf2519231ea4a28a9a0643019c2e900911fe21538df95595">CustomEvent</a>(<span class="stringliteral">&#39;contextmenu&#39;</span>, {
<a name="l02166"></a>02166         <span class="stringliteral">&#39;bubbles&#39;</span>: <span class="keyword">true</span>,
<a name="l02167"></a>02167         <span class="stringliteral">&#39;cancelable&#39;</span>: <span class="keyword">true</span>
<a name="l02168"></a>02168       });
<a name="l02169"></a>02169       <span class="comment">// Dispatch custom event for testing long press</span>
<a name="l02170"></a>02170       link.dispatchEvent(contextMenuEvent);
<a name="l02171"></a>02171       <span class="comment">// The assertions that were removed from this</span>
<a name="l02172"></a>02172       <span class="comment">// test were relocated to link_action_handler_test.js</span>
<a name="l02173"></a>02173       <span class="comment">// This &#39;context-menu&#39; was handled properly?</span>
<a name="l02174"></a>02174       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(LinkActionHandler.onClick.called);
<a name="l02175"></a>02175       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(LinkActionHandler.onContextMenu.called);
<a name="l02176"></a>02176     });
<a name="l02177"></a>02177 
<a name="l02178"></a>02178     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39; &quot;contextmenu&quot; after &quot;click&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02179"></a>02179       var contextMenuEvent = <span class="keyword">new</span> <a class="code" href="../../d0/dfb/namespacemozilla_1_1dom_1_1prototypes_1_1id.html#addcec93baff9084aadf2519231ea4a28a9a0643019c2e900911fe21538df95595">CustomEvent</a>(<span class="stringliteral">&#39;contextmenu&#39;</span>, {
<a name="l02180"></a>02180         <span class="stringliteral">&#39;bubbles&#39;</span>: <span class="keyword">true</span>,
<a name="l02181"></a>02181         <span class="stringliteral">&#39;cancelable&#39;</span>: <span class="keyword">true</span>
<a name="l02182"></a>02182       });
<a name="l02183"></a>02183       <span class="comment">// Clicking on the element</span>
<a name="l02184"></a>02184       link.click();
<a name="l02185"></a>02185       <span class="comment">// After clicking, we dispatch a context menu</span>
<a name="l02186"></a>02186       link.dispatchEvent(contextMenuEvent);
<a name="l02187"></a>02187       <span class="comment">// Are &#39;click&#39; and &#39;contextmenu&#39; working properly?</span>
<a name="l02188"></a>02188       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(LinkActionHandler.onClick.called);
<a name="l02189"></a>02189       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(LinkActionHandler.onContextMenu.called);
<a name="l02190"></a>02190     });
<a name="l02191"></a>02191   });
<a name="l02192"></a>02192 
<a name="l02193"></a>02193   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Message resending UI&#39;</span>, <span class="keyword">function</span>() {
<a name="l02194"></a>02194     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l02195"></a>02195       ThreadUI.appendMessage({
<a name="l02196"></a>02196         <span class="keywordtype">id</span>: 23,
<a name="l02197"></a>02197         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l02198"></a>02198         body: <span class="stringliteral">&#39;This is a test&#39;</span>,
<a name="l02199"></a>02199         delivery: <span class="stringliteral">&#39;error&#39;</span>,
<a name="l02200"></a>02200         timestamp: <span class="keyword">new</span> Date()
<a name="l02201"></a>02201       });
<a name="l02202"></a>02202       ThreadUI.appendMessage({
<a name="l02203"></a>02203         <span class="keywordtype">id</span>: 45,
<a name="l02204"></a>02204         <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;sms&#39;</span>,
<a name="l02205"></a>02205         body: <span class="stringliteral">&#39;This is another test&#39;</span>,
<a name="l02206"></a>02206         delivery: <span class="stringliteral">&#39;sent&#39;</span>,
<a name="l02207"></a>02207         timestamp: <span class="keyword">new</span> Date()
<a name="l02208"></a>02208       });
<a name="l02209"></a>02209       this.sinon.stub(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>, <span class="stringliteral">&#39;confirm&#39;</span>);
<a name="l02210"></a>02210       this.sinon.stub(ThreadUI, <span class="stringliteral">&#39;resendMessage&#39;</span>);
<a name="l02211"></a>02211       this.elems = {
<a name="l02212"></a>02212         errorMsg: ThreadUI.container.querySelector(<span class="stringliteral">&#39;.error&#39;</span>),
<a name="l02213"></a>02213         sentMsg: ThreadUI.container.querySelector(<span class="stringliteral">&#39;.sent&#39;</span>)
<a name="l02214"></a>02214       };
<a name="l02215"></a>02215     });
<a name="l02216"></a>02216     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;clicking on &quot;pack-end&quot; aside in an error message&#39;</span> +
<a name="l02217"></a>02217       <span class="stringliteral">&#39;triggers a confirmation dialog&#39;</span>,
<a name="l02218"></a>02218       <span class="keyword">function</span>() {
<a name="l02219"></a>02219       this.elems.errorMsg.querySelector(<span class="stringliteral">&#39;.pack-end&#39;</span>).click();
<a name="l02220"></a>02220       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.confirm.callCount, 1);
<a name="l02221"></a>02221     });
<a name="l02222"></a>02222     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;clicking on p element in an error message&#39;</span> +
<a name="l02223"></a>02223       <span class="stringliteral">&#39;does not triggers a confirmation  dialog&#39;</span>,
<a name="l02224"></a>02224       <span class="keyword">function</span>() {
<a name="l02225"></a>02225       this.elems.errorMsg.querySelector(<span class="stringliteral">&#39;.bubble p&#39;</span>).click();
<a name="l02226"></a>02226       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.confirm.callCount, 0);
<a name="l02227"></a>02227     });
<a name="l02228"></a>02228     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;clicking on an error message does not trigger a confirmation dialog&#39;</span>,
<a name="l02229"></a>02229       <span class="keyword">function</span>() {
<a name="l02230"></a>02230       this.elems.errorMsg.click();
<a name="l02231"></a>02231       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.confirm.callCount, 0);
<a name="l02232"></a>02232     });
<a name="l02233"></a>02233     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;clicking on &quot;pack-end&quot; aside in an error message and accepting the &#39;</span> +
<a name="l02234"></a>02234       <span class="stringliteral">&#39;confirmation dialog triggers a message re-send operation&#39;</span>, <span class="keyword">function</span>() {
<a name="l02235"></a>02235       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.confirm.returns(<span class="keyword">true</span>);
<a name="l02236"></a>02236       this.elems.errorMsg.querySelector(<span class="stringliteral">&#39;.pack-end&#39;</span>).click();
<a name="l02237"></a>02237       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.resendMessage.callCount, 1);
<a name="l02238"></a>02238     });
<a name="l02239"></a>02239     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;clicking on an error message bubble and rejecting the &#39;</span> +
<a name="l02240"></a>02240       <span class="stringliteral">&#39;confirmation dialog does not trigger a message re-send operation&#39;</span>,
<a name="l02241"></a>02241       <span class="keyword">function</span>() {
<a name="l02242"></a>02242       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.confirm.returns(<span class="keyword">false</span>);
<a name="l02243"></a>02243       this.elems.errorMsg.querySelector(<span class="stringliteral">&#39;.bubble&#39;</span>).click();
<a name="l02244"></a>02244       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.resendMessage.callCount, 0);
<a name="l02245"></a>02245     });
<a name="l02246"></a>02246     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;clicking on a sent message does not trigger a confirmation dialog &#39;</span> +
<a name="l02247"></a>02247       <span class="stringliteral">&#39;nor a message re-send operation&#39;</span>, <span class="keyword">function</span>() {
<a name="l02248"></a>02248       this.elems.sentMsg.click();
<a name="l02249"></a>02249       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.confirm.callCount, 0);
<a name="l02250"></a>02250       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ThreadUI.resendMessage.callCount, 0);
<a name="l02251"></a>02251     });
<a name="l02252"></a>02252   });
<a name="l02253"></a>02253 
<a name="l02254"></a>02254   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;createMmsContent&#39;</span>, <span class="keyword">function</span>() {
<a name="l02255"></a>02255     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;generated html&#39;</span>, <span class="keyword">function</span>() {
<a name="l02256"></a>02256 
<a name="l02257"></a>02257       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;text content&#39;</span>, <span class="keyword">function</span>() {
<a name="l02258"></a>02258         var inputArray = [{
<a name="l02259"></a>02259           <a class="code" href="../../dd/dfa/classtext.html">text</a>: <span class="stringliteral">&#39;part 1&#39;</span>
<a name="l02260"></a>02260         }, {
<a name="l02261"></a>02261           <a class="code" href="../../dd/dfa/classtext.html">text</a>: <span class="stringliteral">&#39;part 2&#39;</span>
<a name="l02262"></a>02262         }];
<a name="l02263"></a>02263         var <a class="code" href="../../df/d12/latin__test_8js.html#a34687689873d42dec2c94cc27f36e1e9">output</a> = ThreadUI.createMmsContent(inputArray);
<a name="l02264"></a>02264 
<a name="l02265"></a>02265         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(output.childNodes.length, 2);
<a name="l02266"></a>02266         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(output.childNodes[0].innerHTML, <span class="stringliteral">&#39;part 1&#39;</span>);
<a name="l02267"></a>02267         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(output.childNodes[1].innerHTML, <span class="stringliteral">&#39;part 2&#39;</span>);
<a name="l02268"></a>02268       });
<a name="l02269"></a>02269 
<a name="l02270"></a>02270       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;blob content&#39;</span>, <span class="keyword">function</span>() {
<a name="l02271"></a>02271         var inputArray = [{
<a name="l02272"></a>02272           <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: <span class="stringliteral">&#39;imageTest.jpg&#39;</span>,
<a name="l02273"></a>02273           blob: testImageBlob
<a name="l02274"></a>02274         }, {
<a name="l02275"></a>02275           <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: <span class="stringliteral">&#39;imageTest.jpg&#39;</span>,
<a name="l02276"></a>02276           blob: testImageBlob
<a name="l02277"></a>02277         }];
<a name="l02278"></a>02278         var output = ThreadUI.createMmsContent(inputArray);
<a name="l02279"></a>02279 
<a name="l02280"></a>02280         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(output.childNodes.length, 2);
<a name="l02281"></a>02281         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.match(output.childNodes[0].nodeName, /iframe/<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>);
<a name="l02282"></a>02282         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.match(output.childNodes[1].nodeName, /iframe/<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>);
<a name="l02283"></a>02283       });
<a name="l02284"></a>02284 
<a name="l02285"></a>02285       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;mixed content&#39;</span>, <span class="keyword">function</span>() {
<a name="l02286"></a>02286         var inputArray = [{
<a name="l02287"></a>02287           <a class="code" href="../../dd/dfa/classtext.html">text</a>: <span class="stringliteral">&#39;text&#39;</span>,
<a name="l02288"></a>02288           <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: <span class="stringliteral">&#39;imageTest.jpg&#39;</span>,
<a name="l02289"></a>02289           blob: testImageBlob
<a name="l02290"></a>02290         }];
<a name="l02291"></a>02291         var output = ThreadUI.createMmsContent(inputArray);
<a name="l02292"></a>02292 
<a name="l02293"></a>02293         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(output.childNodes.length, 2);
<a name="l02294"></a>02294         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.match(output.childNodes[0].nodeName, /iframe/<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>);
<a name="l02295"></a>02295         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(output.childNodes[1].innerHTML, <span class="stringliteral">&#39;text&#39;</span>);
<a name="l02296"></a>02296       });
<a name="l02297"></a>02297     });
<a name="l02298"></a>02298 
<a name="l02299"></a>02299     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Clicking on an attachment triggers its `view` method&#39;</span>, <span class="keyword">function</span>() {
<a name="l02300"></a>02300       var messageContainer;
<a name="l02301"></a>02301       <span class="comment">// create an image mms DOM Element:</span>
<a name="l02302"></a>02302       var inputArray = [{
<a name="l02303"></a>02303         <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: <span class="stringliteral">&#39;imageTest.jpg&#39;</span>,
<a name="l02304"></a>02304         blob: testImageBlob
<a name="l02305"></a>02305       }];
<a name="l02306"></a>02306       var viewSpy = this.sinon.spy(Attachment.prototype, <span class="stringliteral">&#39;view&#39;</span>);
<a name="l02307"></a>02307 
<a name="l02308"></a>02308       <span class="comment">// quick dirty creation of a thread with image:</span>
<a name="l02309"></a>02309       var output = ThreadUI.createMmsContent(inputArray);
<a name="l02310"></a>02310       var attachmentDOM = output.childNodes[0];
<a name="l02311"></a>02311 
<a name="l02312"></a>02312       <span class="comment">// need to get a container from ThreadUI because event is delegated</span>
<a name="l02313"></a>02313       messageContainer = ThreadUI.getMessageContainer(Date.now(), <span class="keyword">false</span>);
<a name="l02314"></a>02314       messageContainer.appendChild(output);
<a name="l02315"></a>02315       this.sinon.stub(ThreadUI, <span class="stringliteral">&#39;handleMessageClick&#39;</span>);
<a name="l02316"></a>02316 
<a name="l02317"></a>02317       <span class="comment">// Start the test: simulate a click event</span>
<a name="l02318"></a>02318       attachmentDOM.click();
<a name="l02319"></a>02319 
<a name="l02320"></a>02320       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(viewSpy.callCount, 1);
<a name="l02321"></a>02321       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(viewSpy.calledWith, { allowSave: <span class="keyword">true</span> });
<a name="l02322"></a>02322     });
<a name="l02323"></a>02323   });
<a name="l02324"></a>02324 
<a name="l02325"></a>02325   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Render Contact&#39;</span>, <span class="keyword">function</span>() {
<a name="l02326"></a>02326     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact &quot;givenName familyName&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02327"></a>02327       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02328"></a>02328       var <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a> = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02329"></a>02329       var html;
<a name="l02330"></a>02330 
<a name="l02331"></a>02331       ThreadUI.renderContact({
<a name="l02332"></a>02332         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02333"></a>02333         input: <span class="stringliteral">&#39;foo&#39;</span>,
<a name="l02334"></a>02334         <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: ul,
<a name="l02335"></a>02335         isContact: <span class="keyword">true</span>,
<a name="l02336"></a>02336         isSuggestion: <span class="keyword">true</span>
<a name="l02337"></a>02337       });
<a name="l02338"></a>02338       html = ul.firstElementChild.innerHTML;
<a name="l02339"></a>02339       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.include(html, <span class="stringliteral">&#39;Pepito O\&#39;Hare&#39;</span>);
<a name="l02340"></a>02340     });
<a name="l02341"></a>02341 
<a name="l02342"></a>02342     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact highlighted &quot;givenName familyName&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02343"></a>02343       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02344"></a>02344       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02345"></a>02345       var html;
<a name="l02346"></a>02346 
<a name="l02347"></a>02347       ThreadUI.renderContact({
<a name="l02348"></a>02348         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02349"></a>02349         input: <span class="stringliteral">&#39;Pepito O\&#39;Hare&#39;</span>,
<a name="l02350"></a>02350         <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: ul,
<a name="l02351"></a>02351         isContact: <span class="keyword">true</span>,
<a name="l02352"></a>02352         isSuggestion: <span class="keyword">true</span>
<a name="l02353"></a>02353       });
<a name="l02354"></a>02354       html = ul.firstElementChild.innerHTML;
<a name="l02355"></a>02355 
<a name="l02356"></a>02356       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.include(html, <span class="stringliteral">&#39;&lt;span class=&quot;highlight&quot;&gt;Pepito&lt;/span&gt;&#39;</span>);
<a name="l02357"></a>02357       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.include(html, <span class="stringliteral">&#39;&lt;span class=&quot;highlight&quot;&gt;O\&#39;Hare&lt;/span&gt;&#39;</span>);
<a name="l02358"></a>02358     });
<a name="l02359"></a>02359 
<a name="l02360"></a>02360     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact &quot;number&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02361"></a>02361       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02362"></a>02362       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02363"></a>02363       var html;
<a name="l02364"></a>02364 
<a name="l02365"></a>02365       contact.tel[0].carrier = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l02366"></a>02366       contact.tel[0].type = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l02367"></a>02367 
<a name="l02368"></a>02368       ThreadUI.renderContact({
<a name="l02369"></a>02369         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02370"></a>02370         input: <span class="stringliteral">&#39;foo&#39;</span>,
<a name="l02371"></a>02371         <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: ul,
<a name="l02372"></a>02372         isContact: <span class="keyword">true</span>,
<a name="l02373"></a>02373         isSuggestion: <span class="keyword">true</span>
<a name="l02374"></a>02374       });
<a name="l02375"></a>02375       html = ul.firstElementChild.innerHTML;
<a name="l02376"></a>02376 
<a name="l02377"></a>02377       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(html.contains(<span class="stringliteral">&#39;+346578888888&#39;</span>));
<a name="l02378"></a>02378     });
<a name="l02379"></a>02379 
<a name="l02380"></a>02380     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact highlighted &quot;number&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02381"></a>02381       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02382"></a>02382       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02383"></a>02383       var html;
<a name="l02384"></a>02384 
<a name="l02385"></a>02385       contact.tel[0].carrier = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l02386"></a>02386       contact.tel[0].type = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l02387"></a>02387 
<a name="l02388"></a>02388       ThreadUI.renderContact({
<a name="l02389"></a>02389         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02390"></a>02390         input: <span class="stringliteral">&#39;346578888888&#39;</span>,
<a name="l02391"></a>02391         <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: ul,
<a name="l02392"></a>02392         isContact: <span class="keyword">true</span>,
<a name="l02393"></a>02393         isSuggestion: <span class="keyword">true</span>
<a name="l02394"></a>02394       });
<a name="l02395"></a>02395       html = ul.firstElementChild.innerHTML;
<a name="l02396"></a>02396 
<a name="l02397"></a>02397       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l02398"></a>02398         html.contains(<span class="stringliteral">&#39;+&lt;span class=&quot;highlight&quot;&gt;346578888888&lt;/span&gt;&#39;</span>)
<a name="l02399"></a>02399       );
<a name="l02400"></a>02400     });
<a name="l02401"></a>02401 
<a name="l02402"></a>02402     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact &quot;type | number&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02403"></a>02403       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02404"></a>02404       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02405"></a>02405       var html;
<a name="l02406"></a>02406 
<a name="l02407"></a>02407       contact.tel[0].carrier = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l02408"></a>02408 
<a name="l02409"></a>02409       ThreadUI.renderContact({
<a name="l02410"></a>02410         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02411"></a>02411         input: <span class="stringliteral">&#39;foo&#39;</span>,
<a name="l02412"></a>02412         <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: ul,
<a name="l02413"></a>02413         isContact: <span class="keyword">true</span>,
<a name="l02414"></a>02414         isSuggestion: <span class="keyword">true</span>
<a name="l02415"></a>02415       });
<a name="l02416"></a>02416       html = ul.firstElementChild.innerHTML;
<a name="l02417"></a>02417 
<a name="l02418"></a>02418       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(html.contains(<span class="stringliteral">&#39;&lt;span data-l10n-id=&quot;Mobile&quot;&gt;Mobile&lt;/span&gt; | &#39;</span> +
<a name="l02419"></a>02419         <span class="stringliteral">&#39;+346578888888&#39;</span>));
<a name="l02420"></a>02420     });
<a name="l02421"></a>02421 
<a name="l02422"></a>02422     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact highlighted &quot;type | number&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02423"></a>02423       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02424"></a>02424       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02425"></a>02425       var html;
<a name="l02426"></a>02426 
<a name="l02427"></a>02427       contact.tel[0].carrier = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l02428"></a>02428 
<a name="l02429"></a>02429       ThreadUI.renderContact({
<a name="l02430"></a>02430         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02431"></a>02431         input: <span class="stringliteral">&#39;346578888888&#39;</span>,
<a name="l02432"></a>02432         <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: ul,
<a name="l02433"></a>02433         isContact: <span class="keyword">true</span>,
<a name="l02434"></a>02434         isSuggestion: <span class="keyword">true</span>
<a name="l02435"></a>02435       });
<a name="l02436"></a>02436       html = ul.firstElementChild.innerHTML;
<a name="l02437"></a>02437 
<a name="l02438"></a>02438       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(html.contains(
<a name="l02439"></a>02439         <span class="stringliteral">&#39;&lt;span data-l10n-id=&quot;Mobile&quot;&gt;Mobile&lt;/span&gt; | &#39;</span> +
<a name="l02440"></a>02440         <span class="stringliteral">&#39;+&lt;span class=&quot;highlight&quot;&gt;346578888888&lt;/span&gt;&#39;</span>
<a name="l02441"></a>02441       ));
<a name="l02442"></a>02442     });
<a name="l02443"></a>02443 
<a name="l02444"></a>02444     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact &quot;type | carrier, number&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02445"></a>02445       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02446"></a>02446       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02447"></a>02447       var html;
<a name="l02448"></a>02448 
<a name="l02449"></a>02449       ThreadUI.renderContact({
<a name="l02450"></a>02450         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02451"></a>02451         input: <span class="stringliteral">&#39;foo&#39;</span>,
<a name="l02452"></a>02452         <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: ul,
<a name="l02453"></a>02453         isContact: <span class="keyword">true</span>,
<a name="l02454"></a>02454         isSuggestion: <span class="keyword">true</span>
<a name="l02455"></a>02455       });
<a name="l02456"></a>02456       html = ul.firstElementChild.innerHTML;
<a name="l02457"></a>02457 
<a name="l02458"></a>02458       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(html.contains(
<a name="l02459"></a>02459         <span class="stringliteral">&#39;&lt;span data-l10n-id=&quot;Mobile&quot;&gt;Mobile&lt;/span&gt; | &#39;</span> +
<a name="l02460"></a>02460         <span class="stringliteral">&#39;TEF, +346578888888&#39;</span>
<a name="l02461"></a>02461       ));
<a name="l02462"></a>02462     });
<a name="l02463"></a>02463 
<a name="l02464"></a>02464     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact highlighted &quot;type | carrier, number&quot;&#39;</span>, <span class="keyword">function</span>() {
<a name="l02465"></a>02465       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02466"></a>02466       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02467"></a>02467       var html;
<a name="l02468"></a>02468 
<a name="l02469"></a>02469       ThreadUI.renderContact({
<a name="l02470"></a>02470         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02471"></a>02471         input: <span class="stringliteral">&#39;346578888888&#39;</span>,
<a name="l02472"></a>02472         <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>: ul,
<a name="l02473"></a>02473         isContact: <span class="keyword">true</span>,
<a name="l02474"></a>02474         isSuggestion: <span class="keyword">true</span>
<a name="l02475"></a>02475       });
<a name="l02476"></a>02476       html = ul.firstElementChild.innerHTML;
<a name="l02477"></a>02477 
<a name="l02478"></a>02478       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(
<a name="l02479"></a>02479         html.contains(
<a name="l02480"></a>02480           <span class="stringliteral">&#39;&lt;span data-l10n-id=&quot;Mobile&quot;&gt;Mobile&lt;/span&gt; | &#39;</span> +
<a name="l02481"></a>02481           <span class="stringliteral">&#39;TEF, +&lt;span class=&quot;highlight&quot;&gt;346578888888&lt;/span&gt;&#39;</span>
<a name="l02482"></a>02482         )
<a name="l02483"></a>02483       );
<a name="l02484"></a>02484     });
<a name="l02485"></a>02485 
<a name="l02486"></a>02486     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact w/ multiple: one&#39;</span>, <span class="keyword">function</span>() {
<a name="l02487"></a>02487       var <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02488"></a>02488 
<a name="l02489"></a>02489       ThreadUI.renderContact({
<a name="l02490"></a>02490         contact: <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>(),
<a name="l02491"></a>02491         input: <span class="stringliteral">&#39;+12125559999&#39;</span>,
<a name="l02492"></a>02492         target: <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>,
<a name="l02493"></a>02493         isContact: <span class="keyword">true</span>,
<a name="l02494"></a>02494         isSuggestion: <span class="keyword">false</span>
<a name="l02495"></a>02495       });
<a name="l02496"></a>02496 
<a name="l02497"></a>02497       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(target.children.length, 1);
<a name="l02498"></a>02498     });
<a name="l02499"></a>02499 
<a name="l02500"></a>02500     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact w/ multiple: one w/ minimal match&#39;</span>, <span class="keyword">function</span>() {
<a name="l02501"></a>02501       var target = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02502"></a>02502 
<a name="l02503"></a>02503       ThreadUI.renderContact({
<a name="l02504"></a>02504         contact: <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>(),
<a name="l02505"></a>02505         input: <span class="stringliteral">&#39;5559999&#39;</span>,
<a name="l02506"></a>02506         target: <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>,
<a name="l02507"></a>02507         isContact: <span class="keyword">true</span>,
<a name="l02508"></a>02508         isSuggestion: <span class="keyword">false</span>
<a name="l02509"></a>02509       });
<a name="l02510"></a>02510 
<a name="l02511"></a>02511       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(target.children.length, 1);
<a name="l02512"></a>02512     });
<a name="l02513"></a>02513 
<a name="l02514"></a>02514     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact w/ multiple: all (isSuggestion)&#39;</span>, <span class="keyword">function</span>() {
<a name="l02515"></a>02515       var target = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02516"></a>02516 
<a name="l02517"></a>02517       ThreadUI.renderContact({
<a name="l02518"></a>02518         contact: <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>(),
<a name="l02519"></a>02519         input: <span class="stringliteral">&#39;+12125559999&#39;</span>,
<a name="l02520"></a>02520         target: <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>,
<a name="l02521"></a>02521         isContact: <span class="keyword">true</span>,
<a name="l02522"></a>02522         isSuggestion: <span class="keyword">true</span>
<a name="l02523"></a>02523       });
<a name="l02524"></a>02524 
<a name="l02525"></a>02525       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(target.children.length, 2);
<a name="l02526"></a>02526     });
<a name="l02527"></a>02527 
<a name="l02528"></a>02528     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Rendered Contact omit numbers already in recipient list&#39;</span>, <span class="keyword">function</span>() {
<a name="l02529"></a>02529       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02530"></a>02530       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02531"></a>02531       var html;
<a name="l02532"></a>02532 
<a name="l02533"></a>02533       ThreadUI.recipients.add({
<a name="l02534"></a>02534         number: <span class="stringliteral">&#39;+346578888888&#39;</span>
<a name="l02535"></a>02535       });
<a name="l02536"></a>02536 
<a name="l02537"></a>02537       <span class="comment">// This contact has two tel entries.</span>
<a name="l02538"></a>02538       ThreadUI.renderContact({
<a name="l02539"></a>02539         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02540"></a>02540         input: <span class="stringliteral">&#39;+346578888888&#39;</span>,
<a name="l02541"></a>02541         target: ul,
<a name="l02542"></a>02542         isContact: <span class="keyword">true</span>,
<a name="l02543"></a>02543         isSuggestion: <span class="keyword">true</span>
<a name="l02544"></a>02544       });
<a name="l02545"></a>02545 
<a name="l02546"></a>02546       html = ul.innerHTML;
<a name="l02547"></a>02547 
<a name="l02548"></a>02548       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(!html.contains(<span class="stringliteral">&#39;346578888888&#39;</span>));
<a name="l02549"></a>02549       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ul.children.length, 1);
<a name="l02550"></a>02550     });
<a name="l02551"></a>02551 
<a name="l02552"></a>02552     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Render contact does not include photo by default&#39;</span>, <span class="keyword">function</span>() {
<a name="l02553"></a>02553       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02554"></a>02554       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02555"></a>02555       var html;
<a name="l02556"></a>02556 
<a name="l02557"></a>02557       ThreadUI.renderContact({
<a name="l02558"></a>02558         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02559"></a>02559         input: <span class="stringliteral">&#39;foo&#39;</span>,
<a name="l02560"></a>02560         target: ul,
<a name="l02561"></a>02561         isContact: <span class="keyword">true</span>,
<a name="l02562"></a>02562         isSuggestion: <span class="keyword">true</span>,
<a name="l02563"></a>02563         renderPhoto: <span class="keyword">false</span>
<a name="l02564"></a>02564       });
<a name="l02565"></a>02565       html = ul.firstElementChild.innerHTML;
<a name="l02566"></a>02566 
<a name="l02567"></a>02567       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(html.contains(<span class="stringliteral">&#39;img&#39;</span>));
<a name="l02568"></a>02568     });
<a name="l02569"></a>02569     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Render contact without photo keeps avatar invisible&#39;</span>, <span class="keyword">function</span>() {
<a name="l02570"></a>02570       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02571"></a>02571       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02572"></a>02572       var html;
<a name="l02573"></a>02573       contact.photo = testImageBlob;
<a name="l02574"></a>02574 
<a name="l02575"></a>02575       ThreadUI.renderContact({
<a name="l02576"></a>02576         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02577"></a>02577         input: <span class="stringliteral">&#39;foo&#39;</span>,
<a name="l02578"></a>02578         target: ul,
<a name="l02579"></a>02579         isContact: <span class="keyword">true</span>,
<a name="l02580"></a>02580         isSuggestion: <span class="keyword">true</span>,
<a name="l02581"></a>02581         renderPhoto: <span class="keyword">true</span>
<a name="l02582"></a>02582       });
<a name="l02583"></a>02583       html = ul.firstElementChild.innerHTML;
<a name="l02584"></a>02584 
<a name="l02585"></a>02585       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(html.contains(<span class="stringliteral">&#39;img&#39;</span>));
<a name="l02586"></a>02586       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ul.querySelector(<span class="stringliteral">&#39;img&#39;</span>).style.opacity, 0);
<a name="l02587"></a>02587 
<a name="l02588"></a>02588     });
<a name="l02589"></a>02589     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Render contact with photo shows the image&#39;</span>, <span class="keyword">function</span>() {
<a name="l02590"></a>02590       var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l02591"></a>02591       var contact = <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>();
<a name="l02592"></a>02592       var html;
<a name="l02593"></a>02593       contact.photo = testImageBlob;
<a name="l02594"></a>02594 
<a name="l02595"></a>02595       ThreadUI.renderContact({
<a name="l02596"></a>02596         contact: <a class="code" href="../../d7/d91/contacts__matcher__test_8js.html#abbe82a925239cd8211cf7e835d3d20e1">contact</a>,
<a name="l02597"></a>02597         input: <span class="stringliteral">&#39;foo&#39;</span>,
<a name="l02598"></a>02598         target: ul,
<a name="l02599"></a>02599         isContact: <span class="keyword">true</span>,
<a name="l02600"></a>02600         isSuggestion: <span class="keyword">true</span>,
<a name="l02601"></a>02601         renderPhoto: <span class="keyword">true</span>
<a name="l02602"></a>02602       });
<a name="l02603"></a>02603       html = ul.firstElementChild.innerHTML;
<a name="l02604"></a>02604 
<a name="l02605"></a>02605       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(html.contains(<span class="stringliteral">&#39;img&#39;</span>));
<a name="l02606"></a>02606       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(ul.querySelector(<span class="stringliteral">&#39;img&#39;</span>).style.opacity, <span class="stringliteral">&#39;&#39;</span>);
<a name="l02607"></a>02607     });
<a name="l02608"></a>02608   });
<a name="l02609"></a>02609 
<a name="l02610"></a>02610   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Header Actions/Display&#39;</span>, <span class="keyword">function</span>() {
<a name="l02611"></a>02611     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l02612"></a>02612       Threads.delete(1);
<a name="l02613"></a>02613       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02614"></a>02614       <a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.mSetup();
<a name="l02615"></a>02615       <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.mSetup();
<a name="l02616"></a>02616     });
<a name="l02617"></a>02617 
<a name="l02618"></a>02618     teardown(<span class="keyword">function</span>() {
<a name="l02619"></a>02619       Threads.delete(1);
<a name="l02620"></a>02620       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02621"></a>02621       <a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.mTeardown();
<a name="l02622"></a>02622       <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.mTeardown();
<a name="l02623"></a>02623     });
<a name="l02624"></a>02624 
<a name="l02625"></a>02625     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;OptionMenu&#39;</span>, <span class="keyword">function</span>() {
<a name="l02626"></a>02626 
<a name="l02627"></a>02627       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;prompt&#39;</span>, <span class="keyword">function</span>() {
<a name="l02628"></a>02628         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Single known&#39;</span>, <span class="keyword">function</span>() {
<a name="l02629"></a>02629 
<a name="l02630"></a>02630           Threads.set(1, {
<a name="l02631"></a>02631             participants: [<span class="stringliteral">&#39;999&#39;</span>]
<a name="l02632"></a>02632           });
<a name="l02633"></a>02633 
<a name="l02634"></a>02634           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02635"></a>02635 
<a name="l02636"></a>02636           ThreadUI.prompt({
<a name="l02637"></a>02637             number: <span class="stringliteral">&#39;999&#39;</span>,
<a name="l02638"></a>02638             isContact: <span class="keyword">true</span>
<a name="l02639"></a>02639           });
<a name="l02640"></a>02640 
<a name="l02641"></a>02641           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls.length, 0);
<a name="l02642"></a>02642           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.called);
<a name="l02643"></a>02643           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.calledWith, <span class="stringliteral">&#39;999&#39;</span>);
<a name="l02644"></a>02644         });
<a name="l02645"></a>02645 
<a name="l02646"></a>02646         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Single unknown (phone)&#39;</span>, <span class="keyword">function</span>() {
<a name="l02647"></a>02647 
<a name="l02648"></a>02648           Threads.set(1, {
<a name="l02649"></a>02649             participants: [<span class="stringliteral">&#39;999&#39;</span>]
<a name="l02650"></a>02650           });
<a name="l02651"></a>02651 
<a name="l02652"></a>02652           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02653"></a>02653 
<a name="l02654"></a>02654           ThreadUI.prompt({
<a name="l02655"></a>02655             number: <span class="stringliteral">&#39;999&#39;</span>,
<a name="l02656"></a>02656             isContact: <span class="keyword">false</span>
<a name="l02657"></a>02657           });
<a name="l02658"></a>02658 
<a name="l02659"></a>02659           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls.length, 1);
<a name="l02660"></a>02660 
<a name="l02661"></a>02661           var <a class="code" href="../../d3/d4b/lockscreen_8js.html#a8b146780469f40ff2867e5067d0d33f5">call</a> = <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls[0];
<a name="l02662"></a>02662           var items = call.items;
<a name="l02663"></a>02663 
<a name="l02664"></a>02664           <span class="comment">// Ensures that the OptionMenu was given</span>
<a name="l02665"></a>02665           <span class="comment">// the phone number to diplay</span>
<a name="l02666"></a>02666           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(call.header, <span class="stringliteral">&#39;999&#39;</span>);
<a name="l02667"></a>02667 
<a name="l02668"></a>02668           <span class="comment">// Only known Contact details should appear in the &quot;section&quot;</span>
<a name="l02669"></a>02669           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(call.section, <span class="stringliteral">&#39;&#39;</span>);
<a name="l02670"></a>02670 
<a name="l02671"></a>02671           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items.length, 4);
<a name="l02672"></a>02672 
<a name="l02673"></a>02673           <span class="comment">// The first item is a &quot;call&quot; option</span>
<a name="l02674"></a>02674           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[0].l10nId, <span class="stringliteral">&#39;call&#39;</span>);
<a name="l02675"></a>02675 
<a name="l02676"></a>02676           <span class="comment">// The second item is a &quot;createNewContact&quot; option</span>
<a name="l02677"></a>02677           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[1].l10nId, <span class="stringliteral">&#39;createNewContact&#39;</span>);
<a name="l02678"></a>02678 
<a name="l02679"></a>02679           <span class="comment">// The third item is a &quot;addToExistingContact&quot; option</span>
<a name="l02680"></a>02680           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[2].l10nId, <span class="stringliteral">&#39;addToExistingContact&#39;</span>);
<a name="l02681"></a>02681 
<a name="l02682"></a>02682           <span class="comment">// The fourth and last item is a &quot;cancel&quot; option</span>
<a name="l02683"></a>02683           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[3].l10nId, <span class="stringliteral">&#39;cancel&#39;</span>);
<a name="l02684"></a>02684         });
<a name="l02685"></a>02685 
<a name="l02686"></a>02686         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Single unknown (email)&#39;</span>, <span class="keyword">function</span>() {
<a name="l02687"></a>02687 
<a name="l02688"></a>02688           Threads.set(1, {
<a name="l02689"></a>02689             participants: [<span class="stringliteral">&#39;999&#39;</span>]
<a name="l02690"></a>02690           });
<a name="l02691"></a>02691 
<a name="l02692"></a>02692           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02693"></a>02693 
<a name="l02694"></a>02694           ThreadUI.prompt({
<a name="l02695"></a>02695             email: <span class="stringliteral">&#39;a@b.com&#39;</span>,
<a name="l02696"></a>02696             isContact: <span class="keyword">false</span>
<a name="l02697"></a>02697           });
<a name="l02698"></a>02698 
<a name="l02699"></a>02699           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls.length, 1);
<a name="l02700"></a>02700 
<a name="l02701"></a>02701           var call = <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls[0];
<a name="l02702"></a>02702           var items = call.items;
<a name="l02703"></a>02703 
<a name="l02704"></a>02704           <span class="comment">// Ensures that the OptionMenu was given</span>
<a name="l02705"></a>02705           <span class="comment">// the email address to diplay</span>
<a name="l02706"></a>02706           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(call.header, <span class="stringliteral">&#39;a@b.com&#39;</span>);
<a name="l02707"></a>02707 
<a name="l02708"></a>02708           <span class="comment">// Only known Contact details should appear in the &quot;section&quot;</span>
<a name="l02709"></a>02709           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(call.section, <span class="stringliteral">&#39;&#39;</span>);
<a name="l02710"></a>02710 
<a name="l02711"></a>02711           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items.length, 4);
<a name="l02712"></a>02712 
<a name="l02713"></a>02713           <span class="comment">// The first item is a &quot;call&quot; option</span>
<a name="l02714"></a>02714           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[0].l10nId, <span class="stringliteral">&#39;sendEmail&#39;</span>);
<a name="l02715"></a>02715 
<a name="l02716"></a>02716           <span class="comment">// The second item is a &quot;createNewContact&quot; option</span>
<a name="l02717"></a>02717           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[1].l10nId, <span class="stringliteral">&#39;createNewContact&#39;</span>);
<a name="l02718"></a>02718 
<a name="l02719"></a>02719           <span class="comment">// The third item is a &quot;addToExistingContact&quot; option</span>
<a name="l02720"></a>02720           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[2].l10nId, <span class="stringliteral">&#39;addToExistingContact&#39;</span>);
<a name="l02721"></a>02721 
<a name="l02722"></a>02722           <span class="comment">// The fourth and last item is a &quot;cancel&quot; option</span>
<a name="l02723"></a>02723           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[3].l10nId, <span class="stringliteral">&#39;cancel&#39;</span>);
<a name="l02724"></a>02724         });
<a name="l02725"></a>02725         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Multiple known&#39;</span>, <span class="keyword">function</span>() {
<a name="l02726"></a>02726 
<a name="l02727"></a>02727           Threads.set(1, {
<a name="l02728"></a>02728             participants: [<span class="stringliteral">&#39;999&#39;</span>, <span class="stringliteral">&#39;888&#39;</span>]
<a name="l02729"></a>02729           });
<a name="l02730"></a>02730 
<a name="l02731"></a>02731           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02732"></a>02732 
<a name="l02733"></a>02733           ThreadUI.prompt({
<a name="l02734"></a>02734             number: <span class="stringliteral">&#39;999&#39;</span>,
<a name="l02735"></a>02735             isContact: <span class="keyword">true</span>
<a name="l02736"></a>02736           });
<a name="l02737"></a>02737 
<a name="l02738"></a>02738           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls.length, 1);
<a name="l02739"></a>02739 
<a name="l02740"></a>02740           var call = <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls[0];
<a name="l02741"></a>02741           var items = call.items;
<a name="l02742"></a>02742 
<a name="l02743"></a>02743           <span class="comment">// Ensures that the OptionMenu was given</span>
<a name="l02744"></a>02744           <span class="comment">// the phone number to diplay</span>
<a name="l02745"></a>02745           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(call.header, <span class="stringliteral">&#39;999&#39;</span>);
<a name="l02746"></a>02746 
<a name="l02747"></a>02747           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items.length, 3);
<a name="l02748"></a>02748 
<a name="l02749"></a>02749           <span class="comment">// The first item is a &quot;call&quot; option</span>
<a name="l02750"></a>02750           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[0].l10nId, <span class="stringliteral">&#39;call&#39;</span>);
<a name="l02751"></a>02751 
<a name="l02752"></a>02752           <span class="comment">// The second item is a &quot;send message&quot; option</span>
<a name="l02753"></a>02753           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[1].l10nId, <span class="stringliteral">&#39;sendMessage&#39;</span>);
<a name="l02754"></a>02754 
<a name="l02755"></a>02755           <span class="comment">// The third and last item is a &quot;cancel&quot; option</span>
<a name="l02756"></a>02756           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[2].l10nId, <span class="stringliteral">&#39;cancel&#39;</span>);
<a name="l02757"></a>02757         });
<a name="l02758"></a>02758 
<a name="l02759"></a>02759         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Multiple unknown&#39;</span>, <span class="keyword">function</span>() {
<a name="l02760"></a>02760 
<a name="l02761"></a>02761           Threads.set(1, {
<a name="l02762"></a>02762             participants: [<span class="stringliteral">&#39;999&#39;</span>, <span class="stringliteral">&#39;888&#39;</span>]
<a name="l02763"></a>02763           });
<a name="l02764"></a>02764 
<a name="l02765"></a>02765           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02766"></a>02766 
<a name="l02767"></a>02767           ThreadUI.prompt({
<a name="l02768"></a>02768             number: <span class="stringliteral">&#39;999&#39;</span>,
<a name="l02769"></a>02769             isContact: <span class="keyword">false</span>
<a name="l02770"></a>02770           });
<a name="l02771"></a>02771 
<a name="l02772"></a>02772           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls.length, 1);
<a name="l02773"></a>02773 
<a name="l02774"></a>02774           var call = <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls[0];
<a name="l02775"></a>02775           var items = call.items;
<a name="l02776"></a>02776 
<a name="l02777"></a>02777           <span class="comment">// Ensures that the OptionMenu was given</span>
<a name="l02778"></a>02778           <span class="comment">// the phone number to diplay</span>
<a name="l02779"></a>02779           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(call.header, <span class="stringliteral">&#39;999&#39;</span>);
<a name="l02780"></a>02780 
<a name="l02781"></a>02781           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items.length, 5);
<a name="l02782"></a>02782 
<a name="l02783"></a>02783           <span class="comment">// The first item is a &quot;call&quot; option</span>
<a name="l02784"></a>02784           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[0].l10nId, <span class="stringliteral">&#39;call&#39;</span>);
<a name="l02785"></a>02785 
<a name="l02786"></a>02786           <span class="comment">// The second item is a &quot;sendMessage&quot; option</span>
<a name="l02787"></a>02787           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[1].l10nId, <span class="stringliteral">&#39;sendMessage&#39;</span>);
<a name="l02788"></a>02788 
<a name="l02789"></a>02789           <span class="comment">// The third item is a &quot;createNewContact&quot; option</span>
<a name="l02790"></a>02790           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[2].l10nId, <span class="stringliteral">&#39;createNewContact&#39;</span>);
<a name="l02791"></a>02791 
<a name="l02792"></a>02792           <span class="comment">// The fourth item is a &quot;addToExistingContact&quot; option</span>
<a name="l02793"></a>02793           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[3].l10nId, <span class="stringliteral">&#39;addToExistingContact&#39;</span>);
<a name="l02794"></a>02794 
<a name="l02795"></a>02795           <span class="comment">// The fifth and last item is a &quot;cancel&quot; option</span>
<a name="l02796"></a>02796           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(items[4].l10nId, <span class="stringliteral">&#39;cancel&#39;</span>);
<a name="l02797"></a>02797         });
<a name="l02798"></a>02798       });
<a name="l02799"></a>02799 
<a name="l02800"></a>02800       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;onHeaderActivation&#39;</span>, <span class="keyword">function</span>() {
<a name="l02801"></a>02801         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Single known&#39;</span>, <span class="keyword">function</span>() {
<a name="l02802"></a>02802 
<a name="l02803"></a>02803           Threads.set(1, {
<a name="l02804"></a>02804             participants: [<span class="stringliteral">&#39;+12125559999&#39;</span>]
<a name="l02805"></a>02805           });
<a name="l02806"></a>02806 
<a name="l02807"></a>02807           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02808"></a>02808 
<a name="l02809"></a>02809 
<a name="l02810"></a>02810           ThreadUI.headerText.dataset.isContact = <span class="keyword">true</span>;
<a name="l02811"></a>02811           ThreadUI.headerText.dataset.number = <span class="stringliteral">&#39;+12125559999&#39;</span>;
<a name="l02812"></a>02812 
<a name="l02813"></a>02813           ThreadUI.onHeaderActivation();
<a name="l02814"></a>02814 
<a name="l02815"></a>02815           <span class="comment">// Does not initiate an OptionMenu</span>
<a name="l02816"></a>02816           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls.length, 0);
<a name="l02817"></a>02817 
<a name="l02818"></a>02818           <span class="comment">// Does initiate a &quot;call&quot; activity</span>
<a name="l02819"></a>02819           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.called, 1);
<a name="l02820"></a>02820         });
<a name="l02821"></a>02821 
<a name="l02822"></a>02822         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Single unknown&#39;</span>, <span class="keyword">function</span>() {
<a name="l02823"></a>02823 
<a name="l02824"></a>02824           Threads.set(1, {
<a name="l02825"></a>02825             participants: [<span class="stringliteral">&#39;777&#39;</span>]
<a name="l02826"></a>02826           });
<a name="l02827"></a>02827 
<a name="l02828"></a>02828           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02829"></a>02829 
<a name="l02830"></a>02830           ThreadUI.headerText.dataset.isContact = <span class="keyword">false</span>;
<a name="l02831"></a>02831           ThreadUI.headerText.dataset.number = <span class="stringliteral">&#39;777&#39;</span>;
<a name="l02832"></a>02832 
<a name="l02833"></a>02833           ThreadUI.onHeaderActivation();
<a name="l02834"></a>02834 
<a name="l02835"></a>02835           var calls = <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls;
<a name="l02836"></a>02836 
<a name="l02837"></a>02837           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(calls.length, 1);
<a name="l02838"></a>02838           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(calls[0].header, <span class="stringliteral">&#39;777&#39;</span>);
<a name="l02839"></a>02839           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(calls[0].items.length, 4);
<a name="l02840"></a>02840           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d1/d22/ical_8js.html#a6053319846c80bf9561a1958bb817380">typeof</a> calls[0].complete, <span class="stringliteral">&#39;function&#39;</span>);
<a name="l02841"></a>02841         });
<a name="l02842"></a>02842       });
<a name="l02843"></a>02843     });
<a name="l02844"></a>02844 
<a name="l02845"></a>02845     <span class="comment">// See: utils_test.js</span>
<a name="l02846"></a>02846     <span class="comment">// Utils.getCarrierTag</span>
<a name="l02847"></a>02847     <span class="comment">//</span>
<a name="l02848"></a>02848     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Single participant&#39;</span>, <span class="keyword">function</span>() {
<a name="l02849"></a>02849 
<a name="l02850"></a>02850       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Carrier Tag&#39;</span>, <span class="keyword">function</span>() {
<a name="l02851"></a>02851         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Carrier Tag (non empty string)&#39;</span>, <span class="keyword">function</span>(<a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>) {
<a name="l02852"></a>02852 
<a name="l02853"></a>02853           Threads.set(1, {
<a name="l02854"></a>02854             participants: [<span class="stringliteral">&#39;+12125559999&#39;</span>]
<a name="l02855"></a>02855           });
<a name="l02856"></a>02856 
<a name="l02857"></a>02857           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02858"></a>02858 
<a name="l02859"></a>02859           this.sinon.stub(<a class="code" href="../../db/d3e/clock_2test_2unit_2mocks_2mock__utils_8js.html#a6df1d2fb8b70c72ba9d9629d68d3c11c">MockUtils</a>, <span class="stringliteral">&#39;getCarrierTag&#39;</span>, <span class="keyword">function</span>() {
<a name="l02860"></a>02860             <span class="keywordflow">return</span> <span class="stringliteral">&#39;non empty string&#39;</span>;
<a name="l02861"></a>02861           });
<a name="l02862"></a>02862 
<a name="l02863"></a>02863           this.sinon.stub(
<a name="l02864"></a>02864             <a class="code" href="../../d5/d48/communications_2contacts_2test_2unit_2mock__contacts_8js.html#a3a34a253aa29f768bbb24b483a115e35">MockContacts</a>, <span class="stringliteral">&#39;findByPhoneNumber&#39;</span>, <span class="keyword">function</span>(phone, fn) {
<a name="l02865"></a>02865 
<a name="l02866"></a>02866             fn([<span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>()]);
<a name="l02867"></a>02867 
<a name="l02868"></a>02868             var threadMessages = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;thread-messages&#39;</span>);
<a name="l02869"></a>02869 
<a name="l02870"></a>02870             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isTrue(threadMessages.classList.contains(<span class="stringliteral">&#39;has-carrier&#39;</span>));
<a name="l02871"></a>02871             <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();
<a name="l02872"></a>02872           });
<a name="l02873"></a>02873 
<a name="l02874"></a>02874           ThreadUI.updateHeaderData();
<a name="l02875"></a>02875         });
<a name="l02876"></a>02876 
<a name="l02877"></a>02877         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Carrier Tag (empty string)&#39;</span>, <span class="keyword">function</span>(<a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>) {
<a name="l02878"></a>02878 
<a name="l02879"></a>02879           Threads.set(1, {
<a name="l02880"></a>02880             participants: [<span class="stringliteral">&#39;+12125559999&#39;</span>]
<a name="l02881"></a>02881           });
<a name="l02882"></a>02882 
<a name="l02883"></a>02883           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02884"></a>02884 
<a name="l02885"></a>02885           this.sinon.stub(<a class="code" href="../../db/d3e/clock_2test_2unit_2mocks_2mock__utils_8js.html#a6df1d2fb8b70c72ba9d9629d68d3c11c">MockUtils</a>, <span class="stringliteral">&#39;getCarrierTag&#39;</span>, <span class="keyword">function</span>() {
<a name="l02886"></a>02886             <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l02887"></a>02887           });
<a name="l02888"></a>02888 
<a name="l02889"></a>02889           this.sinon.stub(
<a name="l02890"></a>02890             <a class="code" href="../../d5/d48/communications_2contacts_2test_2unit_2mock__contacts_8js.html#a3a34a253aa29f768bbb24b483a115e35">MockContacts</a>, <span class="stringliteral">&#39;findByPhoneNumber&#39;</span>, <span class="keyword">function</span>(phone, fn) {
<a name="l02891"></a>02891 
<a name="l02892"></a>02892             fn([<span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>()]);
<a name="l02893"></a>02893 
<a name="l02894"></a>02894             var threadMessages = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;thread-messages&#39;</span>);
<a name="l02895"></a>02895 
<a name="l02896"></a>02896             <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(threadMessages.classList.contains(<span class="stringliteral">&#39;has-carrier&#39;</span>));
<a name="l02897"></a>02897 
<a name="l02898"></a>02898             <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();
<a name="l02899"></a>02899           });
<a name="l02900"></a>02900 
<a name="l02901"></a>02901           ThreadUI.updateHeaderData();
<a name="l02902"></a>02902         });
<a name="l02903"></a>02903       });
<a name="l02904"></a>02904     });
<a name="l02905"></a>02905 
<a name="l02906"></a>02906     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Multi participant&#39;</span>, <span class="keyword">function</span>() {
<a name="l02907"></a>02907       var <a class="code" href="../../d1/de1/apps_2settings_2js_2utils_8js.html#a32930d17cd0e3a8078d1a8e5207cfc4d">localize</a>;
<a name="l02908"></a>02908       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l02909"></a>02909         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02910"></a>02910         <a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.mSetup();
<a name="l02911"></a>02911         <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.mSetup();
<a name="l02912"></a>02912         localize = this.sinon.spy(<a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n, <span class="stringliteral">&#39;localize&#39;</span>);
<a name="l02913"></a>02913       });
<a name="l02914"></a>02914 
<a name="l02915"></a>02915       teardown(<span class="keyword">function</span>() {
<a name="l02916"></a>02916         Threads.delete(1);
<a name="l02917"></a>02917         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02918"></a>02918         <a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.mTeardown();
<a name="l02919"></a>02919         <a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.mTeardown();
<a name="l02920"></a>02920       });
<a name="l02921"></a>02921 
<a name="l02922"></a>02922       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Options&#39;</span>, <span class="keyword">function</span>() {
<a name="l02923"></a>02923 
<a name="l02924"></a>02924         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;DOES NOT Invoke Activities&#39;</span>, <span class="keyword">function</span>() {
<a name="l02925"></a>02925 
<a name="l02926"></a>02926           Threads.set(1, {
<a name="l02927"></a>02927             participants: [<span class="stringliteral">&#39;999&#39;</span>, <span class="stringliteral">&#39;888&#39;</span>]
<a name="l02928"></a>02928           });
<a name="l02929"></a>02929 
<a name="l02930"></a>02930           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02931"></a>02931 
<a name="l02932"></a>02932           ThreadUI.headerText.dataset.isContact = <span class="keyword">true</span>;
<a name="l02933"></a>02933           ThreadUI.headerText.dataset.number = <span class="stringliteral">&#39;999&#39;</span>;
<a name="l02934"></a>02934 
<a name="l02935"></a>02935           ThreadUI.onHeaderActivation();
<a name="l02936"></a>02936 
<a name="l02937"></a>02937           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.called, <span class="keyword">false</span>);
<a name="l02938"></a>02938           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d5/da6/mock__activity__picker_8js.html#ab2828eb6eaa32d41d4d63193928c2d20">MockActivityPicker</a>.dial.calledWith, <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>);
<a name="l02939"></a>02939         });
<a name="l02940"></a>02940 
<a name="l02941"></a>02941         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;DOES NOT Invoke Options&#39;</span>, <span class="keyword">function</span>() {
<a name="l02942"></a>02942 
<a name="l02943"></a>02943           Threads.set(1, {
<a name="l02944"></a>02944             participants: [<span class="stringliteral">&#39;999&#39;</span>, <span class="stringliteral">&#39;888&#39;</span>]
<a name="l02945"></a>02945           });
<a name="l02946"></a>02946 
<a name="l02947"></a>02947           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02948"></a>02948 
<a name="l02949"></a>02949           ThreadUI.headerText.dataset.isContact = <span class="keyword">true</span>;
<a name="l02950"></a>02950           ThreadUI.headerText.dataset.number = <span class="stringliteral">&#39;999&#39;</span>;
<a name="l02951"></a>02951 
<a name="l02952"></a>02952           ThreadUI.onHeaderActivation();
<a name="l02953"></a>02953 
<a name="l02954"></a>02954           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../d9/d76/mock__action__menu_8js.html#abaa0a89c7f60ee79f23d5eb88f9b67f2">MockOptionMenu</a>.calls.length, 0);
<a name="l02955"></a>02955         });
<a name="l02956"></a>02956 
<a name="l02957"></a>02957         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Moves to Group View&#39;</span>, <span class="keyword">function</span>(<a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>) {
<a name="l02958"></a>02958           Threads.set(1, {
<a name="l02959"></a>02959             participants: [<span class="stringliteral">&#39;999&#39;</span>, <span class="stringliteral">&#39;888&#39;</span>]
<a name="l02960"></a>02960           });
<a name="l02961"></a>02961 
<a name="l02962"></a>02962           <span class="comment">// Change to #thread=n</span>
<a name="l02963"></a>02963           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.onhashchange = <span class="keyword">function</span>() {
<a name="l02964"></a>02964             <span class="comment">// Change to #group-view (per ThreadUI.onHeaderActivation())</span>
<a name="l02965"></a>02965             <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.onhashchange = <span class="keyword">function</span>() {
<a name="l02966"></a>02966               <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash, <span class="stringliteral">&#39;#group-view&#39;</span>);
<a name="l02967"></a>02967               <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(localize.args[0], [
<a name="l02968"></a>02968                 ThreadUI.headerText, <span class="stringliteral">&#39;participant&#39;</span>, {<a class="code" href="../../d2/d7d/jsapi_8h.html#aa5a8b9a2d5edc8e2e7ba67d7e2ee4e69">n</a>: 2}
<a name="l02969"></a>02969               ]);
<a name="l02970"></a>02970               <span class="comment">// View should not go back to thread view when header is</span>
<a name="l02971"></a>02971               <span class="comment">// activated in group-view</span>
<a name="l02972"></a>02972               ThreadUI.onHeaderActivation();
<a name="l02973"></a>02973               <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash, <span class="stringliteral">&#39;#group-view&#39;</span>);
<a name="l02974"></a>02974               <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.onhashchange = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l02975"></a>02975               <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();
<a name="l02976"></a>02976             };
<a name="l02977"></a>02977 
<a name="l02978"></a>02978             ThreadUI.onHeaderActivation();
<a name="l02979"></a>02979             ThreadUI.groupView();
<a name="l02980"></a>02980           };
<a name="l02981"></a>02981 
<a name="l02982"></a>02982           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l02983"></a>02983         });
<a name="l02984"></a>02984 
<a name="l02985"></a>02985         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Correctly Displayed&#39;</span>, <span class="keyword">function</span>() {
<a name="l02986"></a>02986           var <a class="code" href="../../db/d4e/contacts__matcher_8js.html#a9c02ff135182792b8b5b9cf246a368e8">contacts</a> = {
<a name="l02987"></a>02987             <a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a>: <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>(),
<a name="l02988"></a>02988             <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>: <span class="keyword">new</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#a3e3c442dd849770e3a436a6cf14fef3a">MockContact</a>()
<a name="l02989"></a>02989           };
<a name="l02990"></a>02990 
<a name="l02991"></a>02991           <span class="comment">// Truncate the tel record arrays; there should</span>
<a name="l02992"></a>02992           <span class="comment">// only be one when renderContact does its</span>
<a name="l02993"></a>02993           <span class="comment">// loop and comparison of dialiables</span>
<a name="l02994"></a>02994           contacts.a.tel.length = 1;
<a name="l02995"></a>02995           contacts.b.tel.length = 1;
<a name="l02996"></a>02996 
<a name="l02997"></a>02997           <span class="comment">// Set to our &quot;participants&quot;</span>
<a name="l02998"></a>02998           contacts.a.tel[0].value = <span class="stringliteral">&#39;999&#39;</span>;
<a name="l02999"></a>02999           contacts.b.tel[0].value = <span class="stringliteral">&#39;888&#39;</span>;
<a name="l03000"></a>03000 
<a name="l03001"></a>03001           <span class="comment">// &quot;input&quot; value represents the participant entry value</span>
<a name="l03002"></a>03002           <span class="comment">// that would be provided in ThreadUI.groupView()</span>
<a name="l03003"></a>03003           ThreadUI.renderContact({
<a name="l03004"></a>03004             contact: contacts.a,
<a name="l03005"></a>03005             input: <span class="stringliteral">&#39;999&#39;</span>,
<a name="l03006"></a>03006             target: ThreadUI.participantsList,
<a name="l03007"></a>03007             isContact: <span class="keyword">true</span>,
<a name="l03008"></a>03008             isSuggestion: <span class="keyword">false</span>
<a name="l03009"></a>03009           });
<a name="l03010"></a>03010 
<a name="l03011"></a>03011           ThreadUI.renderContact({
<a name="l03012"></a>03012             contact: contacts.b,
<a name="l03013"></a>03013             input: <span class="stringliteral">&#39;888&#39;</span>,
<a name="l03014"></a>03014             target: ThreadUI.participantsList,
<a name="l03015"></a>03015             isContact: <span class="keyword">true</span>,
<a name="l03016"></a>03016             isSuggestion: <span class="keyword">false</span>
<a name="l03017"></a>03017           });
<a name="l03018"></a>03018 
<a name="l03019"></a>03019           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(
<a name="l03020"></a>03020             ThreadUI.participantsList.children.length, 2
<a name="l03021"></a>03021           );
<a name="l03022"></a>03022         });
<a name="l03023"></a>03023 
<a name="l03024"></a>03024         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Reset Group View&#39;</span>, <span class="keyword">function</span>() {
<a name="l03025"></a>03025           var <a class="code" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a> = ThreadUI.participants.firstElementChild;
<a name="l03026"></a>03026 
<a name="l03027"></a>03027           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(list.children.length, 0);
<a name="l03028"></a>03028 
<a name="l03029"></a>03029           list.innerHTML = <span class="stringliteral">&#39;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&#39;</span>;
<a name="l03030"></a>03030 
<a name="l03031"></a>03031           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(list.children.length, 3);
<a name="l03032"></a>03032 
<a name="l03033"></a>03033           ThreadUI.groupView.reset();
<a name="l03034"></a>03034 
<a name="l03035"></a>03035           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(list.children.length, 0);
<a name="l03036"></a>03036         });
<a name="l03037"></a>03037       });
<a name="l03038"></a>03038 
<a name="l03039"></a>03039       <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Carrier Tag&#39;</span>, <span class="keyword">function</span>() {
<a name="l03040"></a>03040         <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;Carrier Tag (empty string)&#39;</span>, <span class="keyword">function</span>() {
<a name="l03041"></a>03041 
<a name="l03042"></a>03042           Threads.set(1, {
<a name="l03043"></a>03043             participants: [<span class="stringliteral">&#39;999&#39;</span>, <span class="stringliteral">&#39;888&#39;</span>]
<a name="l03044"></a>03044           });
<a name="l03045"></a>03045 
<a name="l03046"></a>03046           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#thread=1&#39;</span>;
<a name="l03047"></a>03047           ThreadUI.updateHeaderData();
<a name="l03048"></a>03048 
<a name="l03049"></a>03049           var threadMessages = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;thread-messages&#39;</span>);
<a name="l03050"></a>03050 
<a name="l03051"></a>03051           <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(threadMessages.classList.contains(<span class="stringliteral">&#39;has-carrier&#39;</span>));
<a name="l03052"></a>03052         });
<a name="l03053"></a>03053 
<a name="l03054"></a>03054       });
<a name="l03055"></a>03055     });
<a name="l03056"></a>03056   });
<a name="l03057"></a>03057 
<a name="l03058"></a>03058   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Sending Behavior (onSendClick)&#39;</span>, <span class="keyword">function</span>() {
<a name="l03059"></a>03059     var realComposeisEmpty;
<a name="l03060"></a>03060     var realMessageManager;
<a name="l03061"></a>03061     var realEnableSend;
<a name="l03062"></a>03062 
<a name="l03063"></a>03063     suiteSetup(<span class="keyword">function</span>() {
<a name="l03064"></a>03064       realEnableSend = ThreadUI.enableSend;
<a name="l03065"></a>03065       realComposeisEmpty = Compose.isEmpty;
<a name="l03066"></a>03066       realMessageManager = <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>;
<a name="l03067"></a>03067 
<a name="l03068"></a>03068       ThreadUI.enableSend = <span class="keyword">function</span>() {
<a name="l03069"></a>03069         ThreadUI.sendButton.disabled = <span class="keyword">false</span>;
<a name="l03070"></a>03070       };
<a name="l03071"></a>03071 
<a name="l03072"></a>03072       Compose.isEmpty = <span class="keyword">function</span>() {
<a name="l03073"></a>03073         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03074"></a>03074       };
<a name="l03075"></a>03075 
<a name="l03076"></a>03076       <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a> = {
<a name="l03077"></a>03077         <a class="code" href="../../de/dc7/share-receiver_8js.html#add7056b1c8a53d2db94122b6cd76b964">activity</a>: {
<a name="l03078"></a>03078           recipients: []
<a name="l03079"></a>03079         }
<a name="l03080"></a>03080       };
<a name="l03081"></a>03081 
<a name="l03082"></a>03082       [<span class="stringliteral">&#39;sendMMS&#39;</span>, <span class="stringliteral">&#39;sendSMS&#39;</span>].forEach(<span class="keyword">function</span>(prop) {
<a name="l03083"></a>03083         <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop] = <span class="keyword">function</span>() {
<a name="l03084"></a>03084           <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop].called = <span class="keyword">true</span>;
<a name="l03085"></a>03085           <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop].calledWith = [].slice.call(arguments);
<a name="l03086"></a>03086         };
<a name="l03087"></a>03087 
<a name="l03088"></a>03088         <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop].mSetup = <span class="keyword">function</span>() {
<a name="l03089"></a>03089           <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop].called = <span class="keyword">false</span>;
<a name="l03090"></a>03090           <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop].calledWith = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l03091"></a>03091         };
<a name="l03092"></a>03092 
<a name="l03093"></a>03093         <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop].mTeardown = <span class="keyword">function</span>() {
<a name="l03094"></a>03094           <span class="keyword">delete</span> <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop].called;
<a name="l03095"></a>03095           <span class="keyword">delete</span> <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>[prop].calledWith;
<a name="l03096"></a>03096         };
<a name="l03097"></a>03097       });
<a name="l03098"></a>03098 
<a name="l03099"></a>03099       <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a> = <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>;
<a name="l03100"></a>03100     });
<a name="l03101"></a>03101 
<a name="l03102"></a>03102     suiteTeardown(<span class="keyword">function</span>() {
<a name="l03103"></a>03103       ThreadUI.enableSend = realEnableSend;
<a name="l03104"></a>03104       Compose.isEmpty = realComposeisEmpty;
<a name="l03105"></a>03105       <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a> = realMessageManager;
<a name="l03106"></a>03106     });
<a name="l03107"></a>03107 
<a name="l03108"></a>03108     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03109"></a>03109       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash = <span class="stringliteral">&#39;#new&#39;</span>;
<a name="l03110"></a>03110       <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendMMS.mSetup();
<a name="l03111"></a>03111       <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendSMS.mSetup();
<a name="l03112"></a>03112     });
<a name="l03113"></a>03113 
<a name="l03114"></a>03114     teardown(<span class="keyword">function</span>() {
<a name="l03115"></a>03115       <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendMMS.mTeardown();
<a name="l03116"></a>03116       <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendSMS.mTeardown();
<a name="l03117"></a>03117     });
<a name="l03118"></a>03118 
<a name="l03119"></a>03119     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;SMS, 1 Recipient, stays in view&#39;</span>, <span class="keyword">function</span>() {
<a name="l03120"></a>03120       ThreadUI.recipients.add({
<a name="l03121"></a>03121         number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l03122"></a>03122       });
<a name="l03123"></a>03123 
<a name="l03124"></a>03124       Compose.append(<span class="stringliteral">&#39;foo&#39;</span>);
<a name="l03125"></a>03125 
<a name="l03126"></a>03126       ThreadUI.onSendClick();
<a name="l03127"></a>03127 
<a name="l03128"></a>03128       var calledWith = <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendSMS.calledWith;
<a name="l03129"></a>03129       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendSMS.called);
<a name="l03130"></a>03130       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(calledWith[0], [<span class="stringliteral">&#39;999&#39;</span>]);
<a name="l03131"></a>03131       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(calledWith[1], <span class="stringliteral">&#39;foo&#39;</span>);
<a name="l03132"></a>03132       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash, <span class="stringliteral">&#39;#new&#39;</span>);
<a name="l03133"></a>03133     });
<a name="l03134"></a>03134 
<a name="l03135"></a>03135     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;MMS, 1 Recipient, stays in view&#39;</span>, <span class="keyword">function</span>() {
<a name="l03136"></a>03136       ThreadUI.recipients.add({
<a name="l03137"></a>03137         number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l03138"></a>03138       });
<a name="l03139"></a>03139 
<a name="l03140"></a>03140       Compose.append(mockAttachment(512));
<a name="l03141"></a>03141 
<a name="l03142"></a>03142       ThreadUI.onSendClick();
<a name="l03143"></a>03143 
<a name="l03144"></a>03144       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendMMS.called);
<a name="l03145"></a>03145       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendMMS.calledWith[0], [<span class="stringliteral">&#39;999&#39;</span>]);
<a name="l03146"></a>03146       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash, <span class="stringliteral">&#39;#new&#39;</span>);
<a name="l03147"></a>03147     });
<a name="l03148"></a>03148 
<a name="l03149"></a>03149     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;SMS, &gt;1 Recipient, moves to thread list&#39;</span>, <span class="keyword">function</span>(<a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>) {
<a name="l03150"></a>03150 
<a name="l03151"></a>03151       ThreadUI.recipients.add({
<a name="l03152"></a>03152         number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l03153"></a>03153       });
<a name="l03154"></a>03154       ThreadUI.recipients.add({
<a name="l03155"></a>03155         number: <span class="stringliteral">&#39;888&#39;</span>
<a name="l03156"></a>03156       });
<a name="l03157"></a>03157 
<a name="l03158"></a>03158       Compose.append(<span class="stringliteral">&#39;foo&#39;</span>);
<a name="l03159"></a>03159 
<a name="l03160"></a>03160       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.onhashchange = <span class="keyword">function</span>() {
<a name="l03161"></a>03161         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash, <span class="stringliteral">&#39;#thread-list&#39;</span>);
<a name="l03162"></a>03162         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.onhashchange = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l03163"></a>03163         <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();
<a name="l03164"></a>03164       };
<a name="l03165"></a>03165 
<a name="l03166"></a>03166       ThreadUI.onSendClick();
<a name="l03167"></a>03167 
<a name="l03168"></a>03168       var calledWith = <a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendSMS.calledWith;
<a name="l03169"></a>03169       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendSMS.called);
<a name="l03170"></a>03170       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(calledWith[0], [<span class="stringliteral">&#39;999&#39;</span>, <span class="stringliteral">&#39;888&#39;</span>]);
<a name="l03171"></a>03171       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(calledWith[1], <span class="stringliteral">&#39;foo&#39;</span>);
<a name="l03172"></a>03172     });
<a name="l03173"></a>03173 
<a name="l03174"></a>03174     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;MMS, &gt;1 Recipient, stays in view&#39;</span>, <span class="keyword">function</span>() {
<a name="l03175"></a>03175       ThreadUI.recipients.add({
<a name="l03176"></a>03176         number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l03177"></a>03177       });
<a name="l03178"></a>03178       ThreadUI.recipients.add({
<a name="l03179"></a>03179         number: <span class="stringliteral">&#39;888&#39;</span>
<a name="l03180"></a>03180       });
<a name="l03181"></a>03181 
<a name="l03182"></a>03182       Compose.append(mockAttachment(512));
<a name="l03183"></a>03183 
<a name="l03184"></a>03184       ThreadUI.onSendClick();
<a name="l03185"></a>03185 
<a name="l03186"></a>03186       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendMMS.called);
<a name="l03187"></a>03187       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(<a class="code" href="../../d4/d81/message__manager_8js.html#ab608b57c33ddb52ccfce58f0db00dc1f">MessageManager</a>.sendMMS.calledWith[0], [<span class="stringliteral">&#39;999&#39;</span>, <span class="stringliteral">&#39;888&#39;</span>]);
<a name="l03188"></a>03188       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.equal(<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.hash, <span class="stringliteral">&#39;#new&#39;</span>);
<a name="l03189"></a>03189     });
<a name="l03190"></a>03190   });
<a name="l03191"></a>03191 
<a name="l03192"></a>03192   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;Contact Picker Behavior(contactPickButton)&#39;</span>, <span class="keyword">function</span>() {
<a name="l03193"></a>03193     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03194"></a>03194       this.sinon.spy(ThreadUI, <span class="stringliteral">&#39;assimilateRecipients&#39;</span>);
<a name="l03195"></a>03195     });
<a name="l03196"></a>03196 
<a name="l03197"></a>03197     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;assimilate called after mousedown on picker button&#39;</span>, <span class="keyword">function</span>() {
<a name="l03198"></a>03198       ThreadUI.contactPickButton.dispatchEvent(<span class="keyword">new</span> <a class="code" href="../../d0/dfb/namespacemozilla_1_1dom_1_1prototypes_1_1id.html#addcec93baff9084aadf2519231ea4a28a9a0643019c2e900911fe21538df95595">CustomEvent</a>(<span class="stringliteral">&#39;mousedown&#39;</span>));
<a name="l03199"></a>03199       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(ThreadUI.assimilateRecipients.called);
<a name="l03200"></a>03200     });
<a name="l03201"></a>03201   });
<a name="l03202"></a>03202 
<a name="l03203"></a>03203   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;setMessageBody&#39;</span>, <span class="keyword">function</span>() {
<a name="l03204"></a>03204     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03205"></a>03205       this.sinon.stub(Compose, <span class="stringliteral">&#39;clear&#39;</span>);
<a name="l03206"></a>03206       this.sinon.stub(Compose, <span class="stringliteral">&#39;append&#39;</span>);
<a name="l03207"></a>03207       this.sinon.stub(Compose, <span class="stringliteral">&#39;focus&#39;</span>);
<a name="l03208"></a>03208     });
<a name="l03209"></a>03209 
<a name="l03210"></a>03210     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;with data&#39;</span>, <span class="keyword">function</span>() {
<a name="l03211"></a>03211       var testText = <span class="stringliteral">&#39;testing&#39;</span>;
<a name="l03212"></a>03212       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03213"></a>03213         ThreadUI.setMessageBody(testText);
<a name="l03214"></a>03214       });
<a name="l03215"></a>03215 
<a name="l03216"></a>03216       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;calls clear&#39;</span>, <span class="keyword">function</span>() {
<a name="l03217"></a>03217         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(Compose.clear.called);
<a name="l03218"></a>03218       });
<a name="l03219"></a>03219 
<a name="l03220"></a>03220       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;calls append with correct data&#39;</span>, <span class="keyword">function</span>() {
<a name="l03221"></a>03221         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(Compose.append.calledWith(testText));
<a name="l03222"></a>03222       });
<a name="l03223"></a>03223 
<a name="l03224"></a>03224       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;calls focus&#39;</span>, <span class="keyword">function</span>() {
<a name="l03225"></a>03225         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(Compose.focus.called);
<a name="l03226"></a>03226       });
<a name="l03227"></a>03227     });
<a name="l03228"></a>03228 
<a name="l03229"></a>03229     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;without data&#39;</span>, <span class="keyword">function</span>() {
<a name="l03230"></a>03230       var testText = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03231"></a>03231       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03232"></a>03232         ThreadUI.setMessageBody(testText);
<a name="l03233"></a>03233       });
<a name="l03234"></a>03234 
<a name="l03235"></a>03235       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;calls clear&#39;</span>, <span class="keyword">function</span>() {
<a name="l03236"></a>03236         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(Compose.clear.called);
<a name="l03237"></a>03237       });
<a name="l03238"></a>03238 
<a name="l03239"></a>03239       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;does not call append with empty data&#39;</span>, <span class="keyword">function</span>() {
<a name="l03240"></a>03240         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(Compose.append.called);
<a name="l03241"></a>03241       });
<a name="l03242"></a>03242 
<a name="l03243"></a>03243       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;calls focus&#39;</span>, <span class="keyword">function</span>() {
<a name="l03244"></a>03244         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(Compose.focus.called);
<a name="l03245"></a>03245       });
<a name="l03246"></a>03246     });
<a name="l03247"></a>03247   });
<a name="l03248"></a>03248 
<a name="l03249"></a>03249   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;recipient handling &gt;&#39;</span>, <span class="keyword">function</span>() {
<a name="l03250"></a>03250     var <a class="code" href="../../d1/de1/apps_2settings_2js_2utils_8js.html#a32930d17cd0e3a8078d1a8e5207cfc4d">localize</a>;
<a name="l03251"></a>03251     <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03252"></a>03252       <a class="code" href="../../d1/d03/locales_2_r_e_a_d_m_e_8md.html#a009e1b25f7059061a6508b10c9435823">location</a>.hash = <span class="stringliteral">&#39;#new&#39;</span>;
<a name="l03253"></a>03253       localize = this.sinon.spy(<a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n, <span class="stringliteral">&#39;localize&#39;</span>);
<a name="l03254"></a>03254     });
<a name="l03255"></a>03255 
<a name="l03256"></a>03256     teardown(<span class="keyword">function</span>() {
<a name="l03257"></a>03257       <a class="code" href="../../d1/d03/locales_2_r_e_a_d_m_e_8md.html#a009e1b25f7059061a6508b10c9435823">location</a>.hash = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03258"></a>03258     });
<a name="l03259"></a>03259 
<a name="l03260"></a>03260     <span class="keyword">function</span> testPickButtonEnabled() {
<a name="l03261"></a>03261       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;pick button is enabled&#39;</span>, <span class="keyword">function</span>() {
<a name="l03262"></a>03262         var pickButton = ThreadUI.contactPickButton;
<a name="l03263"></a>03263         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.isFalse(pickButton.classList.contains(<span class="stringliteral">&#39;disabled&#39;</span>));
<a name="l03264"></a>03264       });
<a name="l03265"></a>03265     }
<a name="l03266"></a>03266 
<a name="l03267"></a>03267     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;no recipients&#39;</span>, <span class="keyword">function</span>() {
<a name="l03268"></a>03268       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03269"></a>03269         ThreadUI.updateComposerHeader();
<a name="l03270"></a>03270       });
<a name="l03271"></a>03271 
<a name="l03272"></a>03272       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;header is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l03273"></a>03273         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(localize.args[0], [
<a name="l03274"></a>03274           ThreadUI.headerText, <span class="stringliteral">&#39;newMessage&#39;</span>
<a name="l03275"></a>03275         ]);
<a name="l03276"></a>03276       });
<a name="l03277"></a>03277 
<a name="l03278"></a>03278       testPickButtonEnabled();
<a name="l03279"></a>03279     });
<a name="l03280"></a>03280 
<a name="l03281"></a>03281     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;add one recipient&#39;</span>, <span class="keyword">function</span>() {
<a name="l03282"></a>03282       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03283"></a>03283         ThreadUI.recipients.add({
<a name="l03284"></a>03284           number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l03285"></a>03285         });
<a name="l03286"></a>03286       });
<a name="l03287"></a>03287 
<a name="l03288"></a>03288       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;header is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l03289"></a>03289         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(localize.args[0], [
<a name="l03290"></a>03290           ThreadUI.headerText, <span class="stringliteral">&#39;recipient&#39;</span>, {<a class="code" href="../../d2/d7d/jsapi_8h.html#aa5a8b9a2d5edc8e2e7ba67d7e2ee4e69">n</a>: 1}
<a name="l03291"></a>03291         ]);
<a name="l03292"></a>03292       });
<a name="l03293"></a>03293 
<a name="l03294"></a>03294       testPickButtonEnabled();
<a name="l03295"></a>03295     });
<a name="l03296"></a>03296 
<a name="l03297"></a>03297     <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;add two recipients&#39;</span>, <span class="keyword">function</span>() {
<a name="l03298"></a>03298       <a class="code" href="../../d3/d91/j3d_8js.html#a1e0e4683a3d1006a0cfe228b2fd5f11d">setup</a>(<span class="keyword">function</span>() {
<a name="l03299"></a>03299         ThreadUI.recipients.add({
<a name="l03300"></a>03300           number: <span class="stringliteral">&#39;999&#39;</span>
<a name="l03301"></a>03301         });
<a name="l03302"></a>03302         ThreadUI.recipients.add({
<a name="l03303"></a>03303           number: <span class="stringliteral">&#39;888&#39;</span>
<a name="l03304"></a>03304         });
<a name="l03305"></a>03305       });
<a name="l03306"></a>03306 
<a name="l03307"></a>03307       <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;header is correct&#39;</span>, <span class="keyword">function</span>() {
<a name="l03308"></a>03308         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.ok(localize.calledTwice);
<a name="l03309"></a>03309         <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.deepEqual(localize.args[1], [
<a name="l03310"></a>03310           ThreadUI.headerText, <span class="stringliteral">&#39;recipient&#39;</span>, {<a class="code" href="../../d2/d7d/jsapi_8h.html#aa5a8b9a2d5edc8e2e7ba67d7e2ee4e69">n</a>: 2}
<a name="l03311"></a>03311         ]);
<a name="l03312"></a>03312       });
<a name="l03313"></a>03313 
<a name="l03314"></a>03314       testPickButtonEnabled();
<a name="l03315"></a>03315     });
<a name="l03316"></a>03316   });
<a name="l03317"></a>03317 
<a name="l03318"></a>03318   <a class="code" href="../../d7/d1b/test-agent-server_8js.html#ae4e488f52af5e7c198b9c91afab5a16e">suite</a>(<span class="stringliteral">&#39;initSentAudio&#39;</span>, <span class="keyword">function</span>() {
<a name="l03319"></a>03319     <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a4fe50fa16c059b33ed172c344bb3fc74">test</a>(<span class="stringliteral">&#39;calling function does not throw uncaught exception &#39;</span>, <span class="keyword">function</span>() {
<a name="l03320"></a>03320       <a class="code" href="../../dd/d27/awesomescreen__test_8js.html#a5e95655c9188700b16a5488897cecb90">assert</a>.doesNotThrow(ThreadUI.initSentAudio);
<a name="l03321"></a>03321     });
<a name="l03322"></a>03322   });
<a name="l03323"></a>03323 });
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d9/d25/thread__ui__test_8js.html">thread_ui_test.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:25に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
