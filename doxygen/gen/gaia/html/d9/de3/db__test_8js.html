<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: db_test.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d9/de3/db__test_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a>  </div>
  <div class="headertitle">
<div class="title">db_test.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../d9/de3/db__test_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/de3/db__test_8js.html#a6562f702b8451106f2f96fb6975ae9e4">requireLib</a> ('calendar.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/de3/db__test_8js.html#ad8cd6818a0c50a99da9fbe859e454b1b">suite</a> ('<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>;var <a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>;var <a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>;var dbName= 'calendar-<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>-<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>-<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>';suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>=<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">testSupport.calendar.app</a>();app.loadObject('Provider.Local', <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../df/d6d/prpdce_8h.html#a244bf4809fa769d3064852f1f46df24f">this.timeout</a>(10000);var <a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>=new Calendar.Db(dbName);db.deleteDatabase(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../db/df4/geoloc_8js.html#a15b4f92b0ef49ac05f43437f3d85ae46">success</a>){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!err, 'should not have an <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a> when deleting <a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../db/df4/geoloc_8js.html#a15b4f92b0ef49ac05f43437f3d85ae46">success</a>, 'should be able <a class="el" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> delete the <a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>');<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});suiteTeardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>=new Calendar.Db(dbName);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('#getStore', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=subject.getStore('Account');assert.instanceOf(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, Calendar.Store.Account);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">result.db</a>, <a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(subject._stores['Account'], <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('initialization', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">subject.name</a>);assert.include(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">subject.name</a>, '<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(subject.store);assert.instanceOf(<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>, Calendar.Responder);assert.deepEqual(subject._stores,{});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(Object.isFrozen(subject.store));});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#transaction', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=subject.transaction(['events'], 'readonly');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../db/da2/pripcsem_8h.html#a5ffbd19d0a0b87f9ff15e7d0c4410984">trans.mode</a>, 'readonly');trans.onabort=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};<a class="el" href="../../d6/da5/libpinyin_8js.html#a14987c2daddbcdc724afc8b8c0492b85">trans.abort</a>();});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">open</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">on</a> <a class="el" href="../../d9/d04/expat_8h.html#aa323a7729fa99ab75ae910c7267ac071">version</a> <a class="el" href="../../d9/dd6/_r_e_a_d_m_e_8md.html#ac1934db4e0289fcc2a08b0c7de017cf2">change</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.deleteDatabase(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#setupDefaults', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var accountStore;var calendarStore;var storeLoads={};teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){storeLoads={};<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){accountStore=subject.getStore('Account');calendarStore=subject.getStore('<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>');<a class="el" href="../../db/d6b/make__gaia__shared_8js.html#ac5aa547163f784b68be607a47eb170b1">subject.load</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d6/dec/mocha-bin_8js.html#a537e168ad693c5794e1977de944002a0">Calendar.nextTick</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});});['<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>', 'Account'].<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(storeName){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var store=subject.getStore(storeName);var humanName=storeName.toLowerCase()+ '<a class="el" href="../../d9/d04/expat_8h.html#afa4d928795b38748c167cba7f7b9f04c">s</a>';store.all(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, all){storeLoads[humanName]=all;<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('default account', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>=Object.keys(storeLoads.accounts);<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(<a class="el" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>, 1);var item=storeLoads.accounts[<a class="el" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>[0]];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(item);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(item.providerType, 'Local', 'provider');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(item.preset, 'local', 'preset');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('default calendar', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>=Object.keys(storeLoads.calendars);<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(<a class="el" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>, 1);var item=storeLoads.calendars[<a class="el" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>[0]];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(item);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">item.remote.name</a>, 'Offline calendar');var account=storeLoads.accounts[item.accountId];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(account, 'has account');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(account.providerType, 'Local');});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('creation of stores', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var finishedOpen=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!subject.connection, 'connection should be closed');<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">open</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!finishedOpen){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(new <a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Error</a>( 'fired <a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>/<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> out of <a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a1c9c85f11ed6d38fe3abcea936438eb2">order</a> '+ '<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a> should fire then events'));}else{<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var stores=subject.connection.objectStoreNames;var actualStore;<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(actualStore in subject.store){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>((stores.contains(actualStore)), actualStore+ 'was not created');}});<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();}});<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(subject.connection, 'has connection');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(subject.isOpen, 'is <a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">open</a>');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#aa323a7729fa99ab75ae910c7267ac071">subject.version</a>, 'has <a class="el" href="../../d9/d04/expat_8h.html#aa323a7729fa99ab75ae910c7267ac071">version</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(subject.oldVersion, 0, 'upgraded from 0');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(subject.hasUpgraded, 'has upgraded');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">subject.connection.name</a>, <a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">subject.name</a>);finishedOpen=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('Bug 887698', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var busytimeStore, calendarStore, eventStore;var EVENT_ONE_ID, EVENT_TWO_ID, EVENT_THREE_ID;var BUSYTIME_ONE_ID, BUSYTIME_TWO_ID, BUSYTIME_THREE_ID;var OLD_VERSION;var LOCAL_CALENDAR;var NEW_VERSION;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){OLD_VERSION=13;NEW_VERSION=15;LOCAL_CALENDAR= 'local-<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a>';EVENT_ONE_ID= 'evt1';BUSYTIME_ONE_ID= 'bt1';EVENT_TWO_ID= 'evt2';BUSYTIME_TWO_ID= 'bt2';EVENT_THREE_ID= 'evt3';BUSYTIME_THREE_ID= 'bt3';busytimeStore=subject.getStore('Busytime');calendarStore=subject.getStore('<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>');eventStore=subject.getStore('<a class="el" href="../../d8/dd1/test_2marionette_2event_8js.html#aded1d021a890cccaab7c7ebd7450f106">Event</a>');<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(OLD_VERSION, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calendarStore.persist(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('calendar',{_id:LOCAL_CALENDAR}), trans);[<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:LOCAL_CALENDAR, _id:EVENT_ONE_ID}), <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:2, _id:EVENT_TWO_ID}), <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId: '3', _id:EVENT_THREE_ID})].<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>){eventStore.persist(<a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>, trans);});[<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:EVENT_ONE_ID, calendarId:LOCAL_CALENDAR, _id:BUSYTIME_ONE_ID}), <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:EVENT_TWO_ID, calendarId:2, _id:BUSYTIME_TWO_ID}), <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:EVENT_THREE_ID, calendarId: '3', _id:BUSYTIME_THREE_ID})].<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>){busytimeStore.persist(<a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>, trans);});var trans=subject.transaction(['busytimes', 'calendars', 'events'], 'readwrite');trans.oncomplete=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(NEW_VERSION, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(subject.isOpen){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();}});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should turn <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a406850e78f9a9129a4535bbd1b323dd1">str</a> calendarId into <a class="el" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=subject.transaction(['events'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('events');<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(EVENT_ONE_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(evt.target.result.calendarId, LOCAL_CALENDAR);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should not modify <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> <a class="el" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a> calendarId', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=subject.transaction(['events'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('events');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(EVENT_TWO_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(evt.target.result.calendarId, 2);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should delete <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> <a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a> its calendar died', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=subject.transaction(['events'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('events');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(EVENT_THREE_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">evt.target.result</a>, undefined);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should turn busytime <a class="el" href="../../d2/d7d/jsapi_8h.html#a406850e78f9a9129a4535bbd1b323dd1">str</a> calendarId into <a class="el" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=subject.transaction(['busytimes'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('busytimes');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(BUSYTIME_ONE_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(evt.target.result.calendarId, LOCAL_CALENDAR);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should not modify busytime <a class="el" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a> calendarId', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=subject.transaction(['busytimes'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('busytimes');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(BUSYTIME_TWO_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(evt.target.result.calendarId, 2);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should delete busytime <a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a> its calendar died', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=subject.transaction(['busytimes'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('busytimes');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(BUSYTIME_THREE_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">evt.target.result</a>, undefined);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('Bug 851003', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>;var busytimeStore, calendarStore, eventStore;var EVENT_ONE_ID, EVENT_TWO_ID, EVENT_THREE_ID;var BUSYTIME_ONE_ID, BUSYTIME_TWO_ID, BUSYTIME_THREE_ID;var OLD_VERSION;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){OLD_VERSION=14;EVENT_ONE_ID= 'evt1';BUSYTIME_ONE_ID= 'bt1';EVENT_TWO_ID= 'evt2';BUSYTIME_TWO_ID= 'bt2';EVENT_THREE_ID= 'evt3';BUSYTIME_THREE_ID= 'bt3';busytimeStore=subject.getStore('Busytime');calendarStore=subject.getStore('<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>');eventStore=subject.getStore('<a class="el" href="../../d8/dd1/test_2marionette_2event_8js.html#aded1d021a890cccaab7c7ebd7450f106">Event</a>');<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(OLD_VERSION, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calendarStore.persist(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('calendar',{_id:1}), trans);[<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId: '1', _id:EVENT_ONE_ID}), <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:2, _id:EVENT_TWO_ID}), <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId: '3', _id:EVENT_THREE_ID})].<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>){eventStore.persist(<a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>, trans);});[<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:EVENT_ONE_ID, calendarId: '1', _id:BUSYTIME_ONE_ID}), <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:EVENT_TWO_ID, calendarId:2, _id:BUSYTIME_TWO_ID}), <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:EVENT_THREE_ID, calendarId: '3', _id:BUSYTIME_THREE_ID})].<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>){busytimeStore.persist(<a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>, trans);});var trans=subject.transaction(['busytimes', 'calendars', 'events'], 'readwrite');trans.oncomplete=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(subject.isOpen){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();}});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should turn <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a406850e78f9a9129a4535bbd1b323dd1">str</a> calendarId into <a class="el" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(OLD_VERSION+1, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var trans=subject.transaction(['events'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('events');<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(EVENT_ONE_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(evt.target.result.calendarId, 1);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should not modify <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> <a class="el" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a> calendarId', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(OLD_VERSION+1, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var trans=subject.transaction(['events'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('events');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(EVENT_TWO_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(evt.target.result.calendarId, 2);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should delete <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> <a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a> its calendar died', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(OLD_VERSION+1, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var trans=subject.transaction(['events'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('events');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(EVENT_THREE_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">evt.target.result</a>, undefined);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should turn busytime <a class="el" href="../../d2/d7d/jsapi_8h.html#a406850e78f9a9129a4535bbd1b323dd1">str</a> calendarId into <a class="el" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(OLD_VERSION+1, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var trans=subject.transaction(['busytimes'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('busytimes');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(BUSYTIME_ONE_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(evt.target.result.calendarId, 1);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should not modify busytime <a class="el" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a> calendarId', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(OLD_VERSION+1, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var trans=subject.transaction(['busytimes'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('busytimes');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(BUSYTIME_TWO_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(evt.target.result.calendarId, 2);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should delete busytime <a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a> its calendar died', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(OLD_VERSION+1, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var trans=subject.transaction(['busytimes'], 'readwrite');var store=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>('busytimes');var <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>=<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">store.get</a>(BUSYTIME_THREE_ID).<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(evt){assert.strictEqual(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">evt.target.result</a>, undefined);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('after <a class="el" href="../../d9/d04/expat_8h.html#aa323a7729fa99ab75ae910c7267ac071">version</a> <a class="el" href="../../d9/dd6/_r_e_a_d_m_e_8md.html#ac1934db4e0289fcc2a08b0c7de017cf2">change</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">open</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">subject.close</a>();<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>=new Calendar.Db(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">subject.name</a>);<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">subject.open</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});});});})</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="a6562f702b8451106f2f96fb6975ae9e4"></a><!-- doxytag: member="db_test.js::requireLib" ref="a6562f702b8451106f2f96fb6975ae9e4" args="('calendar.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/d0e/manager__test_8js.html#a160383846e1e348b6643e19d5c153d05">requireLib</a> </td>
          <td>(</td>
          <td class="paramtype">'calendar.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad8cd6818a0c50a99da9fbe859e454b1b"></a><!-- doxytag: member="db_test.js::suite" ref="ad8cd6818a0c50a99da9fbe859e454b1b" args="('db', function(){var subject;var name;var app;var dbName= 'calendar&#45;db&#45;test&#45;db';suiteSetup(function(done){app=testSupport.calendar.app();app.loadObject('Provider.Local', done);});suiteSetup(function(done){this.timeout(10000);var db=new Calendar.Db(dbName);db.deleteDatabase(function(err, success){assert.ok(!err, 'should not have an error when deleting db');assert.ok(success, 'should be able to delete the db');done();});});suiteTeardown(function(){subject.close();});setup(function(){subject=new Calendar.Db(dbName);});test('#getStore', function(){var result=subject.getStore('Account');assert.instanceOf(result, Calendar.Store.Account);assert.equal(result.db, subject);assert.equal(subject._stores['Account'], result);});test('initialization', function(){assert.ok(subject.name);assert.include(subject.name, 'test');assert.ok(subject.store);assert.instanceOf(subject, Calendar.Responder);assert.deepEqual(subject._stores,{});assert.isTrue(Object.isFrozen(subject.store));});suite('#transaction', function(){setup(function(done){subject.open(function(){done();});});teardown(function(){subject.close();});test('result', function(done){var trans=subject.transaction(['events'], 'readonly');assert.equal(trans.mode, 'readonly');trans.onabort=function(){done();};trans.abort();});});suite('#open', function(){suite('on version change', function(){setup(function(done){subject.deleteDatabase(done);});suite('#setupDefaults', function(){var accountStore;var calendarStore;var storeLoads={};teardown(function(){storeLoads={};subject.close();});setup(function(done){accountStore=subject.getStore('Account');calendarStore=subject.getStore('Calendar');subject.load(function(){Calendar.nextTick(function(){done();});});});['Calendar', 'Account'].forEach(function(storeName){setup(function(done){var store=subject.getStore(storeName);var humanName=storeName.toLowerCase()+ 's';store.all(function(err, all){storeLoads[humanName]=all;done();});});});test('default account', function(){var list=Object.keys(storeLoads.accounts);assert.length(list, 1);var item=storeLoads.accounts[list[0]];assert.ok(item);assert.equal(item.providerType, 'Local', 'provider');assert.equal(item.preset, 'local', 'preset');});test('default calendar', function(){var list=Object.keys(storeLoads.calendars);assert.length(list, 1);var item=storeLoads.calendars[list[0]];assert.ok(item);assert.equal(item.remote.name, 'Offline calendar');var account=storeLoads.accounts[item.accountId];assert.ok(account, 'has account');assert.equal(account.providerType, 'Local');});});test('creation of stores', function(done){var finishedOpen=false;assert.ok(!subject.connection, 'connection should be closed');subject.on('open', function(){if(!finishedOpen){done(new Error( 'fired callback/event out of order '+ 'callback should fire then events'));}else{done(function(){var stores=subject.connection.objectStoreNames;var actualStore;for(actualStore in subject.store){assert.ok((stores.contains(actualStore)), actualStore+ 'was not created');}});subject.close();}});subject.open(function(){assert.ok(subject.connection, 'has connection');assert.ok(subject.isOpen, 'is open');assert.ok(subject.version, 'has version');assert.equal(subject.oldVersion, 0, 'upgraded from 0');assert.isTrue(subject.hasUpgraded, 'has upgraded');assert.equal(subject.connection.name, subject.name);finishedOpen=true;});});suite('Bug 887698', function(){var busytimeStore, calendarStore, eventStore;var EVENT_ONE_ID, EVENT_TWO_ID, EVENT_THREE_ID;var BUSYTIME_ONE_ID, BUSYTIME_TWO_ID, BUSYTIME_THREE_ID;var OLD_VERSION;var LOCAL_CALENDAR;var NEW_VERSION;setup(function(done){OLD_VERSION=13;NEW_VERSION=15;LOCAL_CALENDAR= 'local&#45;first';EVENT_ONE_ID= 'evt1';BUSYTIME_ONE_ID= 'bt1';EVENT_TWO_ID= 'evt2';BUSYTIME_TWO_ID= 'bt2';EVENT_THREE_ID= 'evt3';BUSYTIME_THREE_ID= 'bt3';busytimeStore=subject.getStore('Busytime');calendarStore=subject.getStore('Calendar');eventStore=subject.getStore('Event');subject.open(OLD_VERSION, function(){calendarStore.persist(Factory('calendar',{_id:LOCAL_CALENDAR}), trans);[Factory('event',{calendarId:LOCAL_CALENDAR, _id:EVENT_ONE_ID}), Factory('event',{calendarId:2, _id:EVENT_TWO_ID}), Factory('event',{calendarId: '3', _id:EVENT_THREE_ID})].forEach(function(obj){eventStore.persist(obj, trans);});[Factory('busytime',{eventId:EVENT_ONE_ID, calendarId:LOCAL_CALENDAR, _id:BUSYTIME_ONE_ID}), Factory('busytime',{eventId:EVENT_TWO_ID, calendarId:2, _id:BUSYTIME_TWO_ID}), Factory('busytime',{eventId:EVENT_THREE_ID, calendarId: '3', _id:BUSYTIME_THREE_ID})].forEach(function(obj){busytimeStore.persist(obj, trans);});var trans=subject.transaction(['busytimes', 'calendars', 'events'], 'readwrite');trans.oncomplete=function(){subject.close();done();};});});setup(function(done){subject.open(NEW_VERSION, done);});teardown(function(){if(subject.isOpen){subject.close();}});test('should turn event str calendarId into int', function(done){var trans=subject.transaction(['events'], 'readwrite');var store=trans.objectStore('events');store.get(EVENT_ONE_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result.calendarId, LOCAL_CALENDAR);done();};});test('should not modify event int calendarId', function(done){var trans=subject.transaction(['events'], 'readwrite');var store=trans.objectStore('events');var get=store.get(EVENT_TWO_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result.calendarId, 2);done();};});test('should delete event if its calendar died', function(done){var trans=subject.transaction(['events'], 'readwrite');var store=trans.objectStore('events');var get=store.get(EVENT_THREE_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result, undefined);done();};});test('should turn busytime str calendarId into int', function(done){var trans=subject.transaction(['busytimes'], 'readwrite');var store=trans.objectStore('busytimes');var get=store.get(BUSYTIME_ONE_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result.calendarId, LOCAL_CALENDAR);done();};});test('should not modify busytime int calendarId', function(done){var trans=subject.transaction(['busytimes'], 'readwrite');var store=trans.objectStore('busytimes');var get=store.get(BUSYTIME_TWO_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result.calendarId, 2);done();};});test('should delete busytime if its calendar died', function(done){var trans=subject.transaction(['busytimes'], 'readwrite');var store=trans.objectStore('busytimes');var get=store.get(BUSYTIME_THREE_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result, undefined);done();};});});suite('Bug 851003', function(){return;var busytimeStore, calendarStore, eventStore;var EVENT_ONE_ID, EVENT_TWO_ID, EVENT_THREE_ID;var BUSYTIME_ONE_ID, BUSYTIME_TWO_ID, BUSYTIME_THREE_ID;var OLD_VERSION;setup(function(done){OLD_VERSION=14;EVENT_ONE_ID= 'evt1';BUSYTIME_ONE_ID= 'bt1';EVENT_TWO_ID= 'evt2';BUSYTIME_TWO_ID= 'bt2';EVENT_THREE_ID= 'evt3';BUSYTIME_THREE_ID= 'bt3';busytimeStore=subject.getStore('Busytime');calendarStore=subject.getStore('Calendar');eventStore=subject.getStore('Event');subject.open(OLD_VERSION, function(){calendarStore.persist(Factory('calendar',{_id:1}), trans);[Factory('event',{calendarId: '1', _id:EVENT_ONE_ID}), Factory('event',{calendarId:2, _id:EVENT_TWO_ID}), Factory('event',{calendarId: '3', _id:EVENT_THREE_ID})].forEach(function(obj){eventStore.persist(obj, trans);});[Factory('busytime',{eventId:EVENT_ONE_ID, calendarId: '1', _id:BUSYTIME_ONE_ID}), Factory('busytime',{eventId:EVENT_TWO_ID, calendarId:2, _id:BUSYTIME_TWO_ID}), Factory('busytime',{eventId:EVENT_THREE_ID, calendarId: '3', _id:BUSYTIME_THREE_ID})].forEach(function(obj){busytimeStore.persist(obj, trans);});var trans=subject.transaction(['busytimes', 'calendars', 'events'], 'readwrite');trans.oncomplete=function(){subject.close();done();};});});teardown(function(){if(subject.isOpen){subject.close();}});test('should turn event str calendarId into int', function(done){subject.open(OLD_VERSION+1, function(){var trans=subject.transaction(['events'], 'readwrite');var store=trans.objectStore('events');store.get(EVENT_ONE_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result.calendarId, 1);done();};});});test('should not modify event int calendarId', function(done){subject.open(OLD_VERSION+1, function(){var trans=subject.transaction(['events'], 'readwrite');var store=trans.objectStore('events');var get=store.get(EVENT_TWO_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result.calendarId, 2);done();};});});test('should delete event if its calendar died', function(done){subject.open(OLD_VERSION+1, function(){var trans=subject.transaction(['events'], 'readwrite');var store=trans.objectStore('events');var get=store.get(EVENT_THREE_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result, undefined);done();};});});test('should turn busytime str calendarId into int', function(done){subject.open(OLD_VERSION+1, function(){var trans=subject.transaction(['busytimes'], 'readwrite');var store=trans.objectStore('busytimes');var get=store.get(BUSYTIME_ONE_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result.calendarId, 1);done();};});});test('should not modify busytime int calendarId', function(done){subject.open(OLD_VERSION+1, function(){var trans=subject.transaction(['busytimes'], 'readwrite');var store=trans.objectStore('busytimes');var get=store.get(BUSYTIME_TWO_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result.calendarId, 2);done();};});});test('should delete busytime if its calendar died', function(done){subject.open(OLD_VERSION+1, function(){var trans=subject.transaction(['busytimes'], 'readwrite');var store=trans.objectStore('busytimes');var get=store.get(BUSYTIME_THREE_ID).onsuccess=function(evt){assert.strictEqual(evt.target.result, undefined);done();};});});});});suite('after version change', function(){teardown(function(){subject.close();});setup(function(done){subject.open(function(){done();});});test('open', function(done){subject.close();subject=new Calendar.Db(subject.name);subject.open(function(){done();});});});});})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a> </td>
          <td>(</td>
          <td class="paramtype">'<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d9/de3/db__test_8js.html">db_test.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:53に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
