<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: configurator.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('df/daf/apps_2email_2js_2ext_2mailapi_2composite_2configurator_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a>  </div>
  <div class="headertitle">
<div class="title">configurator.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../df/daf/apps_2email_2js_2ext_2mailapi_2composite_2configurator_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/daf/apps_2email_2js_2ext_2mailapi_2composite_2configurator_8js.html#a2556549ee1897c5f800c99e100efabd2">define</a> ('mailapi/errbackoff',[ './<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>', 'rdcommon/<a class="el" href="../../d9/d43/membuster_8js.html#aad81d14d4c8eea114056d7dc1f18f9b7">log</a>', '<a class="el" href="../../df/db4/_h_i_s_t_o_r_y_8md.html#a2bfec5e283e84efb4ef0459e17cbd8c2">module</a>', '<a class="el" href="../../d4/dfa/tty_8js.html#aa4072ba4b6b56b0fb6f4801f17ab2b34">exports</a>'], <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>($<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>, $<a class="el" href="../../d9/d43/membuster_8js.html#aad81d14d4c8eea114056d7dc1f18f9b7">log</a>, $<a class="el" href="../../df/db4/_h_i_s_t_o_r_y_8md.html#a2bfec5e283e84efb4ef0459e17cbd8c2">module</a>, <a class="el" href="../../d4/dfa/tty_8js.html#aa4072ba4b6b56b0fb6f4801f17ab2b34">exports</a>){var BACKOFF_DURATIONS=exports.BACKOFF_DURATIONS=[{fixedMS:0, randomMS:0},{fixedMS:800, randomMS:400},{fixedMS:4500, randomMS:1000},];var BAD_RESOURCE_RETRY_DELAYS_MS=[1000, 60 *1000, 2 *60 *1000,];var setTimeoutFunc=<a class="el" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">window.setTimeout.bind</a>(<a class="el" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>);exports.TEST_useTimeoutFunc=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d1/d70/prinit_8h.html#ad84b078786561118564537030cd7a8b1">func</a>){setTimeoutFunc=<a class="el" href="../../d1/d70/prinit_8h.html#ad84b078786561118564537030cd7a8b1">func</a>;<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt; <a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">BACKOFF_DURATIONS.length</a>;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){BACKOFF_DURATIONS[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].randomMS=0;}};<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> BackoffEndpoint(<a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>, listener, parentLog){<a class="el" href="../../d2/df8/prthread_8h.html#a22ec211475b54a8de0468990ea9654da">this.state</a>= 'healthy';this._iNextBackoff=0;this._LOG=LOGFAB.BackoffEndpoint(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>, parentLog, <a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>);<a class="el" href="../../d2/df8/prthread_8h.html#a22ec211475b54a8de0468990ea9654da">this._LOG.state</a>(<a class="el" href="../../d2/df8/prthread_8h.html#a22ec211475b54a8de0468990ea9654da">this.state</a>);this._badResources={};this.listener=listener;}<a class="el" href="../../d6/dec/mocha-bin_8js.html#a240a06b4dda3a9e2e025ed5792cd5f4e">BackoffEndpoint.prototype</a>={_setState:function(newState){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../d2/df8/prthread_8h.html#a22ec211475b54a8de0468990ea9654da">this.state</a>===newState) <a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>;<a class="el" href="../../d2/df8/prthread_8h.html#a22ec211475b54a8de0468990ea9654da">this.state</a>=newState;<a class="el" href="../../d2/df8/prthread_8h.html#a22ec211475b54a8de0468990ea9654da">this._LOG.state</a>(newState);<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(this.listener) this.listener.onEndpointStateChange(newState);}, noteConnectSuccess:function(){this._setState('healthy');this._iNextBackoff=0;}, noteConnectFailureMaybeRetry:function(reachable){this._LOG.connectFailure(reachable);<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../d2/df8/prthread_8h.html#a22ec211475b54a8de0468990ea9654da">this.state</a>=== '<a class="el" href="../../d0/dda/tools_2extensions_2httpd_2bootstrap_8js.html#a3f2023cbe585058674584a2feb08aec0">shutdown</a>') <a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(reachable){this._setState('broken');<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;}<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(this._iNextBackoff &gt; 0) this._setState(reachable? 'broken': 'unreachable');<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(this._iNextBackoff &gt;=<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">BACKOFF_DURATIONS.length</a>) <a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;}, noteBrokenConnection:function(){this._LOG.connectFailure(<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>);this._setState('broken');this._iNextBackoff=<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">BACKOFF_DURATIONS.length</a>;}, scheduleConnectAttempt:function(connectFunc){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../d2/df8/prthread_8h.html#a22ec211475b54a8de0468990ea9654da">this.state</a>=== '<a class="el" href="../../d0/dda/tools_2extensions_2httpd_2bootstrap_8js.html#a3f2023cbe585058674584a2feb08aec0">shutdown</a>') <a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>;<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(this._iNextBackoff &gt;=<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">BACKOFF_DURATIONS.length</a>){connectFunc();<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>;}var backoff=BACKOFF_DURATIONS[this._iNextBackoff++], <a class="el" href="../../df/de6/test__apps_2uitest_2js_2notification_8js.html#ad26070262d4c1d2238051d300ac46a8b">delay</a>=backoff.fixedMS+Math.floor(<a class="el" href="../../d3/d91/j3d_8js.html#a2d080f2d1caaee0cd43f85e55b084191">Math.random</a>()*backoff.randomMS);setTimeoutFunc(connectFunc, <a class="el" href="../../df/de6/test__apps_2uitest_2js_2notification_8js.html#ad26070262d4c1d2238051d300ac46a8b">delay</a>);}, noteBadResource:function(resourceId){var now=$date.NOW();<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!this._badResources.hasOwnProperty(resourceId)){this._badResources[resourceId]={count:1, last:now};}else{var <a class="el" href="../../d9/d04/expat_8h.html#ad737df79bb5419e4bac72f823f6fdec9">info</a>=this._badResources[resourceId];<a class="el" href="../../de/d8f/jsdebug_8h.html#af0b029640ba74e8a63ae0af6f51680ca">info.count</a>++;info.last=now;}}, resourceIsOkayToUse:function(resourceId){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!this._badResources.hasOwnProperty(resourceId)) <a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;var <a class="el" href="../../d9/d04/expat_8h.html#ad737df79bb5419e4bac72f823f6fdec9">info</a>=this._badResources[resourceId], now=$date.NOW();}, shutdown:function(){this._setState('<a class="el" href="../../d0/dda/tools_2extensions_2httpd_2bootstrap_8js.html#a3f2023cbe585058674584a2feb08aec0">shutdown</a>');},};exports.createEndpoint=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>, listener, parentLog){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> new BackoffEndpoint(<a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>, listener, parentLog);};var <a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#af6bd479a55b8d304e23d9a96d199c3aa">LOGFAB</a>=<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#af6bd479a55b8d304e23d9a96d199c3aa">exports.LOGFAB</a>=$log.register($<a class="el" href="../../df/db4/_h_i_s_t_o_r_y_8md.html#a2bfec5e283e84efb4ef0459e17cbd8c2">module</a>,{BackoffEndpoint:{type:$log.TASK, subtype:$log.CLIENT, stateVars:{state:false,}, events:{connectFailure:{reachable:true},}, errors:{}},});})</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="a2556549ee1897c5f800c99e100efabd2"></a><!-- doxytag: member="apps/email/js/ext/mailapi/composite/configurator.js::define" ref="a2556549ee1897c5f800c99e100efabd2" args="('mailapi/errbackoff',[ './date', 'rdcommon/log', 'module', 'exports'], function($date, $log, $module, exports){var BACKOFF_DURATIONS=exports.BACKOFF_DURATIONS=[{fixedMS:0, randomMS:0},{fixedMS:800, randomMS:400},{fixedMS:4500, randomMS:1000},];var BAD_RESOURCE_RETRY_DELAYS_MS=[1000, 60 *1000, 2 *60 *1000,];var setTimeoutFunc=window.setTimeout.bind(window);exports.TEST_useTimeoutFunc=function(func){setTimeoutFunc=func;for(var i=0;i&lt; BACKOFF_DURATIONS.length;i++){BACKOFF_DURATIONS[i].randomMS=0;}};function BackoffEndpoint(name, listener, parentLog){this.state= 'healthy';this._iNextBackoff=0;this._LOG=LOGFAB.BackoffEndpoint(this, parentLog, name);this._LOG.state(this.state);this._badResources={};this.listener=listener;}BackoffEndpoint.prototype={_setState:function(newState){if(this.state===newState) return;this.state=newState;this._LOG.state(newState);if(this.listener) this.listener.onEndpointStateChange(newState);}, noteConnectSuccess:function(){this._setState('healthy');this._iNextBackoff=0;}, noteConnectFailureMaybeRetry:function(reachable){this._LOG.connectFailure(reachable);if(this.state=== 'shutdown') return false;if(reachable){this._setState('broken');return false;}if(this._iNextBackoff &gt; 0) this._setState(reachable? 'broken': 'unreachable');if(this._iNextBackoff &gt;=BACKOFF_DURATIONS.length) return false;return true;}, noteBrokenConnection:function(){this._LOG.connectFailure(true);this._setState('broken');this._iNextBackoff=BACKOFF_DURATIONS.length;}, scheduleConnectAttempt:function(connectFunc){if(this.state=== 'shutdown') return;if(this._iNextBackoff &gt;=BACKOFF_DURATIONS.length){connectFunc();return;}var backoff=BACKOFF_DURATIONS[this._iNextBackoff++], delay=backoff.fixedMS+Math.floor(Math.random()*backoff.randomMS);setTimeoutFunc(connectFunc, delay);}, noteBadResource:function(resourceId){var now=$date.NOW();if(!this._badResources.hasOwnProperty(resourceId)){this._badResources[resourceId]={count:1, last:now};}else{var info=this._badResources[resourceId];info.count++;info.last=now;}}, resourceIsOkayToUse:function(resourceId){if(!this._badResources.hasOwnProperty(resourceId)) return true;var info=this._badResources[resourceId], now=$date.NOW();}, shutdown:function(){this._setState('shutdown');},};exports.createEndpoint=function(name, listener, parentLog){return new BackoffEndpoint(name, listener, parentLog);};var LOGFAB=exports.LOGFAB=$log.register($module,{BackoffEndpoint:{type:$log.TASK, subtype:$log.CLIENT, stateVars:{state:false,}, events:{connectFailure:{reachable:true},}, errors:{}},});})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d14/build__stage_2email_2js_2mix_8js.html#ae57540f837ee76af1c71776a8f46ae53">define</a> </td>
          <td>(</td>
          <td class="paramtype">'mailapi/errbackoff'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Error-handling/backoff logic.</p>
<ul>
<li>All existing-account network-accessing functionality uses this module to track the state of accounts and resources within accounts that are may experience some type of time-varying failures.</li>
<li>Account autoconfiguration probing logic does not use this module; it just checks whether there is a network connection.</li>
</ul>
<ul>
<li>Accounts define 'endpoints' with us when they are instantiated for each server connection type they have. For IMAP, this means an SMTP endpoint and an IMAP endpoint.</li>
<li>These 'endpoints' may have internal 'resources' which may manifest failures of their own if-and-only-if it is expected that there could be transient failures within the endpoint. For IMAP, it is possible for IMAP servers to not let us into certain folders because there are other active connections inside them. If something can't fail, there is no need to name it as a resource.</li>
</ul>
<ul>
<li>All endpoints have exactly one status: 'healthy', 'unreachable', or 'broken'. Unreachable implies we are having trouble talking with the endpoint because of network issues. Broken implies that although we can talk to the endpoint, it doesn't want to talk to us for reasons of being offline for maintenance or account migration or something like that.</li>
<li>Endpoint resources can only be 'broken' and are only tracked if they are broken.</li>
</ul>
<ul>
<li>If we encounter a network error for an otherwise healthy endpoint then we try again once right away, as a lot of network errors only become evident once we have a new, good network.</li>
<li>On subsequent network errors for the previously healthy endpoint where we have already retried, we try after a ~1 second delay and then a ~5 second delay. Then we give up and put the endpoint in the unreachable or broken state, as appropriate. These choice of delays are entirely arbitrary.</li>
</ul>
<ul>
<li>We only try once to connect to endpoints that are in a degraded state. We do not retry because that would be wasteful.</li>
</ul>
<ul>
<li>Once we put an endpoint in a degraded (unreachable or broken) state, this module never does anything to try and probe for the endpoint coming back on its own. We rely on the existing periodic synchronization logic or user actions to trigger a new attempt. WE MAY NEED TO CHANGE THIS AT SOME POINT since it's possible that the user may have queued an email for sending that they want delivered sooner than the cron logic triggers, but that's way down the road.</li>
</ul>
<p>Abstractions for dealing with the various mutation operations.</p>
<p>NB: Moves discussion is speculative at this point; we are just thinking things through for architectural implications.</p>
<p>== Speculative Operations ==</p>
<p>We want our UI to update as soon after requesting an operation as possible. To this end, we have logic to locally apply queued mutation operations. Because we may want to undo operations when we are offline (and have not been able to talk to the server), we also need to be able to reflect these changes locally independent of telling the server.</p>
<p>In the case of moves/copies, we issue a(n always locally created) id for the message immediately and just set the server UID (srvid) to 0 to be populated by the sync process.</p>
<p>== Data Integrity ==</p>
<p>Our strategy is always to avoid server data-loss, so data-destruction actions must always take place after successful confirmation of persistence actions. (Just keeping the data in-memory is not acceptable because we could crash, etc.)</p>
<p>This is in contrast to our concern about losing simple, frequently performed idempotent user actions in a crash. We assume that A) crashes will be rare, B) the user will not be surprised or heart-broken if a message they marked read a second before a crash needs to manually be marked read after restarting the app/device, and C) there are performance/system costs to saving the state which makes this a reasonable trade-off.</p>
<p>It is also our strategy to avoid cluttering up the place as a side-effect of half-done things. For example, if we are trying to move N messages, but only copy N/2 because of a timeout, we want to make sure that we don't naively retry and then copy those first N/2 messages a second time. This means that we track sub-steps explicitly, and that operations that we have issued and may or may not have been performed by the server will be checked before they are re-attempted. (Although IMAP batch operations are atomic, and our IndexedDB commits are atomic, they are atomic independent of each other and so we could have been notified that the copy completed but not persisted the fact to our database.)</p>
<p>In the event we restore operations from disk that were enqueued but apparently not run, we compel them to run a check operation before they are performed because it's possible (depending on the case) for us to have run them without saving the account state first. This is a trade-off between the cost of checking and the cost of issuing commits to the database frequently based on the expected likelihood of a crash on our part. Per comments above, we expect crashes to be rare and not particularly correlated with operations, so it's better for the device (both flash and performance) if we don't continually checkpoint our state.</p>
<p>All non-idempotent operations / operations that could result in data loss or duplication require that we save our account state listing the operation. In the event of a crash, this allows us to know that we have to check the state of the operation for completeness before attempting to run it again and allowing us to finish half-done things. For particular example, because moves consist of a copy followed by flagging a message deleted, it is of the utmost importance that we don't get in a situation where we have copied the messages but not deleted them and we crash. In that case, if we failed to persist our plans, we will have duplicated the message (and the IMAP server would have no reason to believe that was not our intent.)</p>
<p>Configurator for fake</p>
<p>Configurator for imap+smtp </p>

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../df/daf/apps_2email_2js_2ext_2mailapi_2composite_2configurator_8js.html">configurator.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:51に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
