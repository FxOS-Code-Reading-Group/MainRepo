<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: gfxFont.h ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d3/d0b/gfx_font_8h.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">gfxFont.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d3/d0b/gfx_font_8h.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- Mode: C++; tab-width: 20; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a name="l00002"></a>00002 <span class="comment"> * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a name="l00003"></a>00003 <span class="comment"> * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a name="l00004"></a>00004 <span class="comment"> * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#ifndef GFX_FONT_H</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span><span class="preprocessor">#define GFX_FONT_H</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dbf/ns_algorithm_8h.html">nsAlgorithm.h</a>&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/db4/gfx_types_8h.html">gfxTypes.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d37/ns_string_8h.html">nsString.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d6f/gfx_point_8h.html">gfxPoint.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/gfx_font_utils_8h.html">gfxFontUtils.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/db9/ns_t_array_8h.html">nsTArray.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d59/ns_t_hashtable_8h.html">nsTHashtable.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dcf/ns_hash_keys_8h.html">nsHashKeys.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d78/gfx_skip_chars_8h.html">gfxSkipChars.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dab/gfx_rect_8h.html">gfxRect.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dd5/ns_expiration_tracker_8h.html">nsExpirationTracker.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d4b/gfx_font_constants_8h.html">gfxFontConstants.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/db7/gfx_platform_8h.html">gfxPlatform.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d32/ns_i_atom_8h.html">nsIAtom.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d5a/ns_i_supports_impl_8h.html">nsISupportsImpl.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d06/gfx_pattern_8h.html">gfxPattern.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dea/_hash_functions_8h.html">mozilla/HashFunctions.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d03/ns_i_memory_reporter_8h.html">nsIMemoryReporter.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dc3/gfx_font_features_8h.html">gfxFontFeatures.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d6d/_memory_reporting_8h.html">mozilla/MemoryReporting.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/dcf/mozilla_2gfx_2_types_8h.html">mozilla/gfx/Types.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/da8/_attributes_8h.html">mozilla/Attributes.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d42/ns_unicode_properties_8h.html">nsUnicodeProperties.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d22/hb_8h.html">harfbuzz/hb.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="../../d3/d0b/gfx_font_8h.html#a747b32a64e90d2587d77b034aa6cc481">00035</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>_cairo_scaled_font <a class="code" href="../../d3/d6e/cairo_8h.html#a747b32a64e90d2587d77b034aa6cc481">cairo_scaled_font_t</a>;
<a name="l00036"></a><a class="code" href="../../d3/d0b/gfx_font_8h.html#a593edf9536bcbacd75254dcf11162ce5">00036</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d0b/gfx_font_8h.html#a593edf9536bcbacd75254dcf11162ce5">gr_face</a>            <a class="code" href="../../d3/d0b/gfx_font_8h.html#a593edf9536bcbacd75254dcf11162ce5">gr_face</a>;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#endif</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="keyword">class </span><a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a>;
<a name="l00043"></a>00043 <span class="keyword">class </span><a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a>;
<a name="l00044"></a>00044 <span class="keyword">class </span><a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>;
<a name="l00045"></a>00045 <span class="keyword">class </span><a class="code" href="../../d8/d91/classgfx_font_family.html">gfxFontFamily</a>;
<a name="l00046"></a>00046 <span class="keyword">class </span><a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a>;
<a name="l00047"></a>00047 <span class="keyword">class </span><a class="code" href="../../d8/de9/classgfx_user_font_set.html">gfxUserFontSet</a>;
<a name="l00048"></a>00048 <span class="keyword">class </span><a class="code" href="../../dc/d28/classgfx_user_font_data.html">gfxUserFontData</a>;
<a name="l00049"></a>00049 <span class="keyword">class </span><a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>;
<a name="l00050"></a>00050 <span class="keyword">class </span><a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>;
<a name="l00051"></a>00051 <span class="keyword">class </span><a class="code" href="../../df/d90/classgfx_s_v_g_glyphs.html">gfxSVGGlyphs</a>;
<a name="l00052"></a>00052 <span class="keyword">class </span><a class="code" href="../../d2/d0c/classgfx_text_object_paint.html">gfxTextObjectPaint</a>;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">class </span><a class="code" href="../../da/da3/classns_i_language_atom_service.html">nsILanguageAtomService</a>;
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="../../d3/d0b/gfx_font_8h.html#affd0b0dfdee313296f4c11e1ddacf63a">00056</a> <span class="preprocessor">#define FONT_MAX_SIZE                  2000.0</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>
<a name="l00058"></a><a class="code" href="../../d3/d0b/gfx_font_8h.html#ae06c5083e5f013dfe42baa632e603ddc">00058</a> <span class="preprocessor">#define NO_FONT_LANGUAGE_OVERRIDE      0</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <span class="keyword">struct </span>FontListSizes;
<a name="l00061"></a>00061 <span class="keyword">struct </span><a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">gfxTextRunDrawCallbacks</a>;
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html">00063</a> <span class="keyword">struct </span><a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> {
<a name="l00064"></a>00064     <a class="code" href="../../d2/dbb/structgfx_font_style.html#ae98b2474d68ea9651b1dcce0a6b8e6b4">gfxFontStyle</a>();
<a name="l00065"></a>00065     <a class="code" href="../../d2/dbb/structgfx_font_style.html#ae98b2474d68ea9651b1dcce0a6b8e6b4">gfxFontStyle</a>(uint8_t aStyle, uint16_t aWeight, int16_t aStretch,
<a name="l00066"></a>00066                  <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> aSize, <a class="code" href="../../dc/dcf/interfacens_i_atom.html">nsIAtom</a> *aLanguage,
<a name="l00067"></a>00067                  <span class="keywordtype">float</span> aSizeAdjust, <span class="keywordtype">bool</span> aSystemFont,
<a name="l00068"></a>00068                  <span class="keywordtype">bool</span> aPrinterFont,
<a name="l00069"></a>00069                  <span class="keyword">const</span> nsString&amp; aLanguageOverride);
<a name="l00070"></a>00070     <a class="code" href="../../d2/dbb/structgfx_font_style.html#ae98b2474d68ea9651b1dcce0a6b8e6b4">gfxFontStyle</a>(<span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a>&amp; aStyle);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="comment">// the language (may be an internal langGroup code rather than an actual</span>
<a name="l00073"></a>00073     <span class="comment">// language code) specified in the document or element&#39;s lang property,</span>
<a name="l00074"></a>00074     <span class="comment">// or inferred from the charset</span>
<a name="l00075"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#abd146e910d6844676d19f14d67039123">00075</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;nsIAtom&gt;</a> <a class="code" href="../../d2/dbb/structgfx_font_style.html#abd146e910d6844676d19f14d67039123">language</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <span class="comment">// Features are composed of (1) features from style rules (2) features</span>
<a name="l00078"></a>00078     <span class="comment">// from feature setttings rules and (3) family-specific features.  (1) and</span>
<a name="l00079"></a>00079     <span class="comment">// (3) are guaranteed to be mutually exclusive</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">// custom opentype feature settings</span>
<a name="l00082"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#afa77b4300266d4141f8d2a1538cd0629">00082</a>     <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;gfxFontFeature&gt;</a> <a class="code" href="../../d2/dbb/structgfx_font_style.html#afa77b4300266d4141f8d2a1538cd0629">featureSettings</a>;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="comment">// Some font-variant property values require font-specific settings</span>
<a name="l00085"></a>00085     <span class="comment">// defined via @font-feature-values rules.  These are resolved after</span>
<a name="l00086"></a>00086     <span class="comment">// font matching occurs.</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <span class="comment">// -- list of value tags for specific alternate features</span>
<a name="l00089"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a71488a5bf2a0de6ff1fa80ac5939bd3f">00089</a>     <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;gfxAlternateValue&gt;</a> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a71488a5bf2a0de6ff1fa80ac5939bd3f">alternateValues</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <span class="comment">// -- object used to look these up once the font is matched</span>
<a name="l00092"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a1adad5e1a9da10b6e195cebd63511ab2">00092</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFontFeatureValueSet&gt;</a> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a1adad5e1a9da10b6e195cebd63511ab2">featureValueLookup</a>;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     <span class="comment">// The logical size of the font, in pixels</span>
<a name="l00095"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a5451af866ca68d7e4a07bf1cc42e58be">00095</a>     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a5451af866ca68d7e4a07bf1cc42e58be">size</a>;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="comment">// The aspect-value (ie., the ratio actualsize:actualxheight) that any</span>
<a name="l00098"></a>00098     <span class="comment">// actual physical font created from this font structure must have when</span>
<a name="l00099"></a>00099     <span class="comment">// rendering or measuring a string. A value of 0 means no adjustment</span>
<a name="l00100"></a>00100     <span class="comment">// needs to be done.</span>
<a name="l00101"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a6a10fda31c5ec2b6b2f0028ca75d0d50">00101</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a6a10fda31c5ec2b6b2f0028ca75d0d50">sizeAdjust</a>;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     <span class="comment">// Language system tag, to override document language;</span>
<a name="l00104"></a>00104     <span class="comment">// an OpenType &quot;language system&quot; tag represented as a 32-bit integer</span>
<a name="l00105"></a>00105     <span class="comment">// (see http://www.microsoft.com/typography/otspec/languagetags.htm).</span>
<a name="l00106"></a>00106     <span class="comment">// Normally 0, so font rendering will use the document or element language</span>
<a name="l00107"></a>00107     <span class="comment">// (see above) to control any language-specific rendering, but the author</span>
<a name="l00108"></a>00108     <span class="comment">// can override this for cases where the options implemented in the font</span>
<a name="l00109"></a>00109     <span class="comment">// do not directly match the actual language. (E.g. lang may be Macedonian,</span>
<a name="l00110"></a>00110     <span class="comment">// but the font in use does not explicitly support this; the author can</span>
<a name="l00111"></a>00111     <span class="comment">// use font-language-override to request the Serbian option in the font</span>
<a name="l00112"></a>00112     <span class="comment">// in order to get correct glyph shapes.)</span>
<a name="l00113"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a9aed9341e89b573b3aacb932f1951d16">00113</a>     uint32_t <a class="code" href="../../d2/dbb/structgfx_font_style.html#a9aed9341e89b573b3aacb932f1951d16">languageOverride</a>;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="comment">// The weight of the font: 100, 200, ... 900.</span>
<a name="l00116"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#ac0ebdc654b0e92fc380d2c7aeb18902b">00116</a>     uint16_t <a class="code" href="../../d2/dbb/structgfx_font_style.html#ac0ebdc654b0e92fc380d2c7aeb18902b">weight</a>;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="comment">// The stretch of the font (the sum of various NS_FONT_STRETCH_*</span>
<a name="l00119"></a>00119     <span class="comment">// constants; see gfxFontConstants.h).</span>
<a name="l00120"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a5084e7efe863a599e9cc15428dee86e9">00120</a>     int8_t <a class="code" href="../../d2/dbb/structgfx_font_style.html#a5084e7efe863a599e9cc15428dee86e9">stretch</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <span class="comment">// Say that this font is a system font and therefore does not</span>
<a name="l00123"></a>00123     <span class="comment">// require certain fixup that we do for fonts from untrusted</span>
<a name="l00124"></a>00124     <span class="comment">// sources.</span>
<a name="l00125"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a584f2d4a1b9c122347f27a714f28e2d6">00125</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a584f2d4a1b9c122347f27a714f28e2d6">systemFont</a> : 1;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">// Say that this font is used for print or print preview.</span>
<a name="l00128"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a10e015f299ae1d9bd931126ca0f229e6">00128</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a10e015f299ae1d9bd931126ca0f229e6">printerFont</a> : 1;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <span class="comment">// Used to imitate -webkit-font-smoothing: antialiased</span>
<a name="l00131"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a9ba7bd087500db1cf3f162d6fdbd94bf">00131</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a9ba7bd087500db1cf3f162d6fdbd94bf">useGrayscaleAntialiasing</a> : 1;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="comment">// The style of font (normal, italic, oblique)</span>
<a name="l00134"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#abb1b8803e6f7c328112110363c5f591e">00134</a>     uint8_t <a class="code" href="../../d2/dbb/structgfx_font_style.html#abb1b8803e6f7c328112110363c5f591e">style</a> : 2;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="comment">// Return the final adjusted font size for the given aspect ratio.</span>
<a name="l00137"></a>00137     <span class="comment">// Not meant to be called when sizeAdjust = 0.</span>
<a name="l00138"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a090b6ba36898d4f576257d1dad3caf19">00138</a>     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a090b6ba36898d4f576257d1dad3caf19">GetAdjustedSize</a>(<a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> aspect)<span class="keyword"> const </span>{
<a name="l00139"></a>00139         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(<a class="code" href="../../d2/dbb/structgfx_font_style.html#a6a10fda31c5ec2b6b2f0028ca75d0d50">sizeAdjust</a> != 0.0, <span class="stringliteral">&quot;Not meant to be called when sizeAdjust = 0&quot;</span>);
<a name="l00140"></a>00140         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> adjustedSize = <a class="code" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">std::max</a>(NS_round(<a class="code" href="../../d2/dbb/structgfx_font_style.html#a5451af866ca68d7e4a07bf1cc42e58be">size</a>*(<a class="code" href="../../d2/dbb/structgfx_font_style.html#a6a10fda31c5ec2b6b2f0028ca75d0d50">sizeAdjust</a>/aspect)), 1.0);
<a name="l00141"></a>00141         <span class="keywordflow">return</span> <a class="code" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#aad36546e8175d2922bee165fe028fedc">std::min</a>(adjustedSize, <a class="code" href="../../d3/d0b/gfx_font_8h.html#affd0b0dfdee313296f4c11e1ddacf63a">FONT_MAX_SIZE</a>);
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a16611eb7d2836a1e716f90c3b24aa99d">00144</a>     <a class="code" href="../../da/d2c/pldhash_8h.html#a6b7adbc70882ca136a7949ca49024cf2">PLDHashNumber</a> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a16611eb7d2836a1e716f90c3b24aa99d">Hash</a>()<span class="keyword"> const </span>{
<a name="l00145"></a>00145         <span class="keywordflow">return</span> ((<a class="code" href="../../d2/dbb/structgfx_font_style.html#abb1b8803e6f7c328112110363c5f591e">style</a> + (<a class="code" href="../../d2/dbb/structgfx_font_style.html#a584f2d4a1b9c122347f27a714f28e2d6">systemFont</a> &lt;&lt; 7) +
<a name="l00146"></a>00146             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#ac0ebdc654b0e92fc380d2c7aeb18902b">weight</a> &lt;&lt; 8)) + uint32_t(<a class="code" href="../../d2/dbb/structgfx_font_style.html#a5451af866ca68d7e4a07bf1cc42e58be">size</a>*1000) + uint32_t(<a class="code" href="../../d2/dbb/structgfx_font_style.html#a6a10fda31c5ec2b6b2f0028ca75d0d50">sizeAdjust</a>*1000)) ^
<a name="l00147"></a>00147             <a class="code" href="../../df/d42/classns_i_supports_hash_key.html#a50ad7752a3dab86124702e1d8d70f8d2">nsISupportsHashKey::HashKey</a>(<a class="code" href="../../d2/dbb/structgfx_font_style.html#abd146e910d6844676d19f14d67039123">language</a>);
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     int8_t <a class="code" href="../../d2/dbb/structgfx_font_style.html#a0ce949f1b7cafe87d89d462d48c867a5">ComputeWeight</a>() <span class="keyword">const</span>;
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="../../d2/dbb/structgfx_font_style.html#a4ebc0819a40744fc3b91f9e26e20500a">00152</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a4ebc0819a40744fc3b91f9e26e20500a">Equals</a>(<span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a>&amp; other)<span class="keyword"> const </span>{
<a name="l00153"></a>00153         <span class="keywordflow">return</span>
<a name="l00154"></a>00154             (*reinterpret_cast&lt;const uint64_t*&gt;(&amp;<a class="code" href="../../d2/dbb/structgfx_font_style.html#a5451af866ca68d7e4a07bf1cc42e58be">size</a>) ==
<a name="l00155"></a>00155              *reinterpret_cast&lt;const uint64_t*&gt;(&amp;other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a5451af866ca68d7e4a07bf1cc42e58be">size</a>)) &amp;&amp;
<a name="l00156"></a>00156             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#abb1b8803e6f7c328112110363c5f591e">style</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#abb1b8803e6f7c328112110363c5f591e">style</a>) &amp;&amp;
<a name="l00157"></a>00157             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#a584f2d4a1b9c122347f27a714f28e2d6">systemFont</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a584f2d4a1b9c122347f27a714f28e2d6">systemFont</a>) &amp;&amp;
<a name="l00158"></a>00158             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#a10e015f299ae1d9bd931126ca0f229e6">printerFont</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a10e015f299ae1d9bd931126ca0f229e6">printerFont</a>) &amp;&amp;
<a name="l00159"></a>00159             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#a9ba7bd087500db1cf3f162d6fdbd94bf">useGrayscaleAntialiasing</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a9ba7bd087500db1cf3f162d6fdbd94bf">useGrayscaleAntialiasing</a>) &amp;&amp;
<a name="l00160"></a>00160             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#ac0ebdc654b0e92fc380d2c7aeb18902b">weight</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#ac0ebdc654b0e92fc380d2c7aeb18902b">weight</a>) &amp;&amp;
<a name="l00161"></a>00161             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#a5084e7efe863a599e9cc15428dee86e9">stretch</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a5084e7efe863a599e9cc15428dee86e9">stretch</a>) &amp;&amp;
<a name="l00162"></a>00162             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#abd146e910d6844676d19f14d67039123">language</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#abd146e910d6844676d19f14d67039123">language</a>) &amp;&amp;
<a name="l00163"></a>00163             (*reinterpret_cast&lt;const uint32_t*&gt;(&amp;<a class="code" href="../../d2/dbb/structgfx_font_style.html#a6a10fda31c5ec2b6b2f0028ca75d0d50">sizeAdjust</a>) ==
<a name="l00164"></a>00164              *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>uint32_t*<span class="keyword">&gt;</span>(&amp;other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a6a10fda31c5ec2b6b2f0028ca75d0d50">sizeAdjust</a>)) &amp;&amp;
<a name="l00165"></a>00165             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#afa77b4300266d4141f8d2a1538cd0629">featureSettings</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#afa77b4300266d4141f8d2a1538cd0629">featureSettings</a>) &amp;&amp;
<a name="l00166"></a>00166             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#a9aed9341e89b573b3aacb932f1951d16">languageOverride</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a9aed9341e89b573b3aacb932f1951d16">languageOverride</a>) &amp;&amp;
<a name="l00167"></a>00167             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#a71488a5bf2a0de6ff1fa80ac5939bd3f">alternateValues</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a71488a5bf2a0de6ff1fa80ac5939bd3f">alternateValues</a>) &amp;&amp;
<a name="l00168"></a>00168             (<a class="code" href="../../d2/dbb/structgfx_font_style.html#a1adad5e1a9da10b6e195cebd63511ab2">featureValueLookup</a> == other.<a class="code" href="../../d2/dbb/structgfx_font_style.html#a1adad5e1a9da10b6e195cebd63511ab2">featureValueLookup</a>);
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html#a953213115ba1d0bb4615d9e68456ebe6">ParseFontFeatureSettings</a>(<span class="keyword">const</span> nsString&amp; aFeatureString,
<a name="l00172"></a>00172                                          <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;gfxFontFeature&gt;</a>&amp; aFeatures);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="keyword">static</span> uint32_t <a class="code" href="../../d2/dbb/structgfx_font_style.html#a9151905ab6310abbff43efa981bc8ea0">ParseFontLanguageOverride</a>(<span class="keyword">const</span> nsString&amp; aLangTag);
<a name="l00175"></a>00175 };
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="../../d8/d58/classgfx_character_map.html">00177</a> <span class="keyword">class </span><a class="code" href="../../d8/d58/classgfx_character_map.html">gfxCharacterMap</a> : <span class="keyword">public</span> <a class="code" href="../../de/dcb/classgfx_sparse_bit_set.html">gfxSparseBitSet</a> {
<a name="l00178"></a>00178 <span class="keyword">public</span>:
<a name="l00179"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#a8e09ed89f62ebe687e205981180425ba">00179</a>     <a class="code" href="../../d3/dd8/nscore_8h.html#a55d97bea9d9bcf37f34284c3bf447f51">nsrefcnt</a> <a class="code" href="../../d8/d58/classgfx_character_map.html#a8e09ed89f62ebe687e205981180425ba">AddRef</a>() {
<a name="l00180"></a>00180         <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(int32_t(<a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>) &gt;= 0, <span class="stringliteral">&quot;illegal refcnt&quot;</span>);
<a name="l00181"></a>00181         ++<a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>;
<a name="l00182"></a>00182         <a class="code" href="../../dc/d1c/ns_trace_refcnt_8h.html#afb83096e600ab5b3c4db5d155ce0b774">NS_LOG_ADDREF</a>(<span class="keyword">this</span>, <a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>, <span class="stringliteral">&quot;gfxCharacterMap&quot;</span>, <span class="keyword">sizeof</span>(*<span class="keyword">this</span>));
<a name="l00183"></a>00183         <span class="keywordflow">return</span> <a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>;
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#a3ee2723504b85946e31ec61b7ced6b9c">00186</a>     <a class="code" href="../../d3/dd8/nscore_8h.html#a55d97bea9d9bcf37f34284c3bf447f51">nsrefcnt</a> <a class="code" href="../../d8/d58/classgfx_character_map.html#a3ee2723504b85946e31ec61b7ced6b9c">Release</a>() {
<a name="l00187"></a>00187         <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(0 != <a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>, <span class="stringliteral">&quot;dup release&quot;</span>);
<a name="l00188"></a>00188         --<a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>;
<a name="l00189"></a>00189         <a class="code" href="../../dc/d1c/ns_trace_refcnt_8h.html#ace98178367a41e5cfebedae29de7e76b">NS_LOG_RELEASE</a>(<span class="keyword">this</span>, <a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>, <span class="stringliteral">&quot;gfxCharacterMap&quot;</span>);
<a name="l00190"></a>00190         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a> == 0) {
<a name="l00191"></a>00191             <a class="code" href="../../d8/d58/classgfx_character_map.html#a5d31d1d3875d10b10cb12e7dba73eaf2">NotifyReleased</a>();
<a name="l00192"></a>00192             <span class="comment">// |this| has been deleted.</span>
<a name="l00193"></a>00193             <span class="keywordflow">return</span> 0;
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195         <span class="keywordflow">return</span> <a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>;
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#a4f0cf583595138f697d2377df9684edf">00198</a>     <a class="code" href="../../d8/d58/classgfx_character_map.html#a4f0cf583595138f697d2377df9684edf">gfxCharacterMap</a>() :
<a name="l00199"></a>00199         <a class="code" href="../../d8/d58/classgfx_character_map.html#ab759321e2bd6ee22559d213a23ef44e1">mHash</a>(0), <a class="code" href="../../d8/d58/classgfx_character_map.html#a9a9acbc62c28e07a4fad765424c52140">mBuildOnTheFly</a>(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>), <a class="code" href="../../d8/d58/classgfx_character_map.html#a03ab1126ebd01be71b3c0926ac18ebf5">mShared</a>(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>)
<a name="l00200"></a>00200     { }
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#aa67dfaa2c1df9cc84b97c1ffec393736">00202</a>     <span class="keywordtype">void</span> <a class="code" href="../../d8/d58/classgfx_character_map.html#aa67dfaa2c1df9cc84b97c1ffec393736">CalcHash</a>() { <a class="code" href="../../d8/d58/classgfx_character_map.html#ab759321e2bd6ee22559d213a23ef44e1">mHash</a> = <a class="code" href="../../de/dcb/classgfx_sparse_bit_set.html#a20eebbf58478160a34c7c63775c6924a">GetChecksum</a>(); }
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#a814e9d0539dec6d94e96e0589cf94e42">00204</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../d8/d58/classgfx_character_map.html#a814e9d0539dec6d94e96e0589cf94e42">SizeOfExcludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf)<span class="keyword"> const </span>{
<a name="l00205"></a>00205         <span class="keywordflow">return</span> <a class="code" href="../../d8/d58/classgfx_character_map.html#a814e9d0539dec6d94e96e0589cf94e42">gfxSparseBitSet::SizeOfExcludingThis</a>(aMallocSizeOf);
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="comment">// hash of the cmap bitvector</span>
<a name="l00209"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#ab759321e2bd6ee22559d213a23ef44e1">00209</a>     uint32_t <a class="code" href="../../d8/d58/classgfx_character_map.html#ab759321e2bd6ee22559d213a23ef44e1">mHash</a>;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     <span class="comment">// if cmap is built on the fly it&#39;s never shared</span>
<a name="l00212"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#a9a9acbc62c28e07a4fad765424c52140">00212</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d8/d58/classgfx_character_map.html#a9a9acbc62c28e07a4fad765424c52140">mBuildOnTheFly</a>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="comment">// cmap is shared globally</span>
<a name="l00215"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#a03ab1126ebd01be71b3c0926ac18ebf5">00215</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d8/d58/classgfx_character_map.html#a03ab1126ebd01be71b3c0926ac18ebf5">mShared</a>;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="keyword">protected</span>:
<a name="l00218"></a>00218     <span class="keywordtype">void</span> <a class="code" href="../../d8/d58/classgfx_character_map.html#a5d31d1d3875d10b10cb12e7dba73eaf2">NotifyReleased</a>();
<a name="l00219"></a>00219 
<a name="l00220"></a><a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">00220</a>     <a class="code" href="../../d2/dc4/classns_auto_ref_cnt.html">nsAutoRefCnt</a> <a class="code" href="../../d8/d58/classgfx_character_map.html#a6505b04750f71e6cba1c58ebad86a124">mRefCnt</a>;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="keyword">private</span>:
<a name="l00223"></a>00223     <a class="code" href="../../d8/d58/classgfx_character_map.html#a4f0cf583595138f697d2377df9684edf">gfxCharacterMap</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d58/classgfx_character_map.html">gfxCharacterMap</a>&amp;);
<a name="l00224"></a>00224     <a class="code" href="../../d8/d58/classgfx_character_map.html">gfxCharacterMap</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="../../d8/d58/classgfx_character_map.html">gfxCharacterMap</a>&amp;);
<a name="l00225"></a>00225 };
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="../../de/d12/classgfx_font_entry.html">00227</a> <span class="keyword">class </span><a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a> {
<a name="l00228"></a>00228 <span class="keyword">public</span>:
<a name="l00229"></a>00229     <a class="code" href="../../d0/d5a/ns_i_supports_impl_8h.html#a5fe430b38b26f82f23c2e59b9d70e174">NS_INLINE_DECL_REFCOUNTING</a>(<a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>)
<a name="l00230"></a>00230 
<a name="l00231"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aa54d0f9c87209fb21d28a57eb091143b">00231</a>     <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>(<a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> nsAString&amp; aName, <span class="keywordtype">bool</span> aIsStandardFace = <a class="code" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>) :
<a name="l00232"></a>00232         <a class="code" href="../../de/d12/classgfx_font_entry.html#a9393bf22f00ef6785ec01e073084d48c">mName</a>(aName), <a class="code" href="../../de/d12/classgfx_font_entry.html#a7f6de6e8a3388df03396d368f12cb9cb">mItalic</a>(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>), <a class="code" href="../../de/d12/classgfx_font_entry.html#a57aa6b989f7d123ff615d02394c94d33">mFixedPitch</a>(false),
<a name="l00233"></a>00233         <a class="code" href="../../de/d12/classgfx_font_entry.html#a0c6afdce1a5796b61f1ee5d4d18bbb4a">mIsProxy</a>(false), <a class="code" href="../../de/d12/classgfx_font_entry.html#a68ebbe88e0deffe64ca9c73891922b5a">mIsValid</a>(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a>), 
<a name="l00234"></a>00234         <a class="code" href="../../de/d12/classgfx_font_entry.html#a1435cd6e93f5f2d51eb3c9bdf08ddae9">mIsBadUnderlineFont</a>(false), <a class="code" href="../../de/d12/classgfx_font_entry.html#a5ac906228e2308e7181145bde1e7a439">mIsUserFont</a>(false),
<a name="l00235"></a>00235         <a class="code" href="../../de/d12/classgfx_font_entry.html#a35558267a718d4f276f2e2c2e16decad">mIsLocalUserFont</a>(false), <a class="code" href="../../de/d12/classgfx_font_entry.html#ab26a4817de3f7b20d743280c4daa7041">mStandardFace</a>(aIsStandardFace),
<a name="l00236"></a>00236         <a class="code" href="../../de/d12/classgfx_font_entry.html#ae25941a437009a10d63c4fcb407553e2">mSymbolFont</a>(false),
<a name="l00237"></a>00237         <a class="code" href="../../de/d12/classgfx_font_entry.html#ab163f2eaaaa55cd2bfd534c78e47d5eb">mIgnoreGDEF</a>(false),
<a name="l00238"></a>00238         <a class="code" href="../../de/d12/classgfx_font_entry.html#a0df0faafcb00077a6f55672fdac861aa">mIgnoreGSUB</a>(false),
<a name="l00239"></a>00239         <a class="code" href="../../de/d12/classgfx_font_entry.html#ae597623e6b5f280ab98d3597bb090e06">mSVGInitialized</a>(false),
<a name="l00240"></a>00240         <a class="code" href="../../de/d12/classgfx_font_entry.html#ae222bd6c415aae836c55b43af327bf2d">mHasSpaceFeaturesInitialized</a>(false),
<a name="l00241"></a>00241         <a class="code" href="../../de/d12/classgfx_font_entry.html#a30df7711250a563ab5c4ed0734efb960">mHasSpaceFeatures</a>(false),
<a name="l00242"></a>00242         <a class="code" href="../../de/d12/classgfx_font_entry.html#af0abcd300cb86483f4f45a3528f6e16c">mHasSpaceFeaturesKerning</a>(false),
<a name="l00243"></a>00243         <a class="code" href="../../de/d12/classgfx_font_entry.html#a4bddd2853f098c52b15f3b47551493ff">mHasSpaceFeaturesNonKerning</a>(false),
<a name="l00244"></a>00244         <a class="code" href="../../de/d12/classgfx_font_entry.html#a6dbe152b6fe88774ae626f58918c2325">mHasSpaceFeaturesSubDefault</a>(false),
<a name="l00245"></a>00245         <a class="code" href="../../de/d12/classgfx_font_entry.html#abed74ccb606d3237475a9d29c105b034">mCheckedForGraphiteTables</a>(false),
<a name="l00246"></a>00246         <a class="code" href="../../de/d12/classgfx_font_entry.html#aaad0a17ab50944637e536bfb5de1d912">mHasCmapTable</a>(false),
<a name="l00247"></a>00247         <a class="code" href="../../de/d12/classgfx_font_entry.html#aa3338371a074d17024fa9017adcba6e3">mGrFaceInitialized</a>(false),
<a name="l00248"></a>00248         <a class="code" href="../../de/d12/classgfx_font_entry.html#a64f79fb59e24a13dfc3f66c90f1785a9">mWeight</a>(500), <a class="code" href="../../de/d12/classgfx_font_entry.html#aac04396478fbbfe49cb520b30c2dbfcc">mStretch</a>(<a class="code" href="../../db/d4b/gfx_font_constants_8h.html#a679c6afa449ea1570b925c8b885e0df2">NS_FONT_STRETCH_NORMAL</a>),
<a name="l00249"></a>00249         <a class="code" href="../../de/d12/classgfx_font_entry.html#ab2d0f0947718a8b939ca62620c2f35fe">mUVSOffset</a>(0), <a class="code" href="../../de/d12/classgfx_font_entry.html#acf65108b99e0f283cc9c92c605f96689">mUVSData</a>(<a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a0fd163987980515e24ce34fc3926206d">nullptr</a>),
<a name="l00250"></a>00250         <a class="code" href="../../de/d12/classgfx_font_entry.html#a6540fb752cf059662f885bd2e25a7f63">mUserFontData</a>(nullptr),
<a name="l00251"></a>00251         <a class="code" href="../../de/d12/classgfx_font_entry.html#a1573bba38f7ba9538fcd03f7aa15a496">mSVGGlyphs</a>(nullptr),
<a name="l00252"></a>00252         <a class="code" href="../../de/d12/classgfx_font_entry.html#a9a75df1face9d408eec854bbfffe280f">mLanguageOverride</a>(<a class="code" href="../../d3/d0b/gfx_font_8h.html#ae06c5083e5f013dfe42baa632e603ddc">NO_FONT_LANGUAGE_OVERRIDE</a>),
<a name="l00253"></a>00253         <a class="code" href="../../de/d12/classgfx_font_entry.html#ad2b94939d4a24e11bf16b641cc2c330c">mHBFace</a>(nullptr),
<a name="l00254"></a>00254         <a class="code" href="../../de/d12/classgfx_font_entry.html#a1ecfcb3e3aa745ae6e6f2985ff37685b">mGrFace</a>(nullptr),
<a name="l00255"></a>00255         <a class="code" href="../../de/d12/classgfx_font_entry.html#a9c5030a6155426e0769cc35bf2c9fa5b">mGrFaceRefCnt</a>(0)
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257         memset(&amp;<a class="code" href="../../de/d12/classgfx_font_entry.html#a09c70aa2325aaa57dcb9a51e077dd6c4">mHasSpaceFeaturesSub</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../de/d12/classgfx_font_entry.html#a09c70aa2325aaa57dcb9a51e077dd6c4">mHasSpaceFeaturesSub</a>));
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     <span class="keyword">virtual</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a152712bc7ea2f2fd01fdb69af528a0f0">~gfxFontEntry</a>();
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="comment">// unique name for the face, *not* the family; not necessarily the</span>
<a name="l00263"></a>00263     <span class="comment">// &quot;real&quot; or user-friendly name, may be an internal identifier</span>
<a name="l00264"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ad0aff47dbe7ec01bd5fa523d33e55335">00264</a>     <span class="keyword">const</span> nsString&amp; <a class="code" href="../../de/d12/classgfx_font_entry.html#ad0aff47dbe7ec01bd5fa523d33e55335">Name</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a9393bf22f00ef6785ec01e073084d48c">mName</a>; }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="comment">// family name</span>
<a name="l00267"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a3d39754b221566f842fbc1206bb33925">00267</a>     <span class="keyword">const</span> nsString&amp; <a class="code" href="../../de/d12/classgfx_font_entry.html#a3d39754b221566f842fbc1206bb33925">FamilyName</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#aabcdfb3e125bd383e450f15aff281d15">mFamilyName</a>; }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="comment">// The following two methods may be relatively expensive, as they</span>
<a name="l00270"></a>00270     <span class="comment">// will (usually, except on Linux) load and parse the &#39;name&#39; table;</span>
<a name="l00271"></a>00271     <span class="comment">// they are intended only for the font-inspection API, not for</span>
<a name="l00272"></a>00272     <span class="comment">// perf-critical layout/drawing work.</span>
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="comment">// The &quot;real&quot; name of the face, if available from the font resource;</span>
<a name="l00275"></a>00275     <span class="comment">// returns Name() if nothing better is available.</span>
<a name="l00276"></a>00276     <span class="keyword">virtual</span> nsString <a class="code" href="../../de/d12/classgfx_font_entry.html#a156e2830037fff085643ebb159f8bf27">RealFaceName</a>();
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aec8a6a018a59e8154e947f526f2995a9">00278</a>     uint16_t <a class="code" href="../../de/d12/classgfx_font_entry.html#aec8a6a018a59e8154e947f526f2995a9">Weight</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a64f79fb59e24a13dfc3f66c90f1785a9">mWeight</a>; }
<a name="l00279"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a2b4ee8ffeb89e20b817de90d2069371f">00279</a>     int16_t <a class="code" href="../../de/d12/classgfx_font_entry.html#a2b4ee8ffeb89e20b817de90d2069371f">Stretch</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#aac04396478fbbfe49cb520b30c2dbfcc">mStretch</a>; }
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ae4d750ff86803a02a6660da2bbdcd8cf">00281</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ae4d750ff86803a02a6660da2bbdcd8cf">IsUserFont</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a5ac906228e2308e7181145bde1e7a439">mIsUserFont</a>; }
<a name="l00282"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aace64f4f80f5ce2f854c21d2784ed93e">00282</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#aace64f4f80f5ce2f854c21d2784ed93e">IsLocalUserFont</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a35558267a718d4f276f2e2c2e16decad">mIsLocalUserFont</a>; }
<a name="l00283"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a6a4f624c9d41ef6aa1d3913a1c8f8fc7">00283</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a6a4f624c9d41ef6aa1d3913a1c8f8fc7">IsFixedPitch</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a57aa6b989f7d123ff615d02394c94d33">mFixedPitch</a>; }
<a name="l00284"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a51aa25c9925ce524a1e6f26688143b50">00284</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a51aa25c9925ce524a1e6f26688143b50">IsItalic</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a7f6de6e8a3388df03396d368f12cb9cb">mItalic</a>; }
<a name="l00285"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a923f11657e77413bfdda45f370aa0ada">00285</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a923f11657e77413bfdda45f370aa0ada">IsBold</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a64f79fb59e24a13dfc3f66c90f1785a9">mWeight</a> &gt;= 600; } <span class="comment">// bold == weights 600 and above</span>
<a name="l00286"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a6931a1eeafd3c5df7fe572193f6bd0a6">00286</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a6931a1eeafd3c5df7fe572193f6bd0a6">IgnoreGDEF</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ab163f2eaaaa55cd2bfd534c78e47d5eb">mIgnoreGDEF</a>; }
<a name="l00287"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a0169240f66c7ced6dc04284b5ae2c667">00287</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0169240f66c7ced6dc04284b5ae2c667">IgnoreGSUB</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0df0faafcb00077a6f55672fdac861aa">mIgnoreGSUB</a>; }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ad57eac67c635ef4fc91584873c97901f">IsSymbolFont</a>();
<a name="l00290"></a>00290 
<a name="l00291"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a0a1af30675d9d2bc31e30446723d2b3f">00291</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0a1af30675d9d2bc31e30446723d2b3f">HasGraphiteTables</a>() {
<a name="l00292"></a>00292         <span class="keywordflow">if</span> (!<a class="code" href="../../de/d12/classgfx_font_entry.html#abed74ccb606d3237475a9d29c105b034">mCheckedForGraphiteTables</a>) {
<a name="l00293"></a>00293             <a class="code" href="../../de/d12/classgfx_font_entry.html#a6ac0264a2b54e60f38810a5eb8bdeed5">CheckForGraphiteTables</a>();
<a name="l00294"></a>00294             <a class="code" href="../../de/d12/classgfx_font_entry.html#abed74ccb606d3237475a9d29c105b034">mCheckedForGraphiteTables</a> = <span class="keyword">true</span>;
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296         <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a09882acf4dd1670325a018371455c562">mHasGraphiteTables</a>;
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aad5cc0fc9c30663b3eea1d4b0f90603d">00299</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#aad5cc0fc9c30663b3eea1d4b0f90603d">HasCmapTable</a>() {
<a name="l00300"></a>00300         <span class="keywordflow">if</span> (!<a class="code" href="../../de/d12/classgfx_font_entry.html#aa68d09b333dbae60729c1c157c555c8d">mCharacterMap</a>) {
<a name="l00301"></a>00301             <a class="code" href="../../de/d12/classgfx_font_entry.html#ac7bfebbec049fbaf99991b4ebf1ef4fb">ReadCMAP</a>();
<a name="l00302"></a>00302             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(<a class="code" href="../../de/d12/classgfx_font_entry.html#aa68d09b333dbae60729c1c157c555c8d">mCharacterMap</a>, <span class="stringliteral">&quot;failed to initialize character map&quot;</span>);
<a name="l00303"></a>00303         }
<a name="l00304"></a>00304         <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#aaad0a17ab50944637e536bfb5de1d912">mHasCmapTable</a>;
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 
<a name="l00307"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a6644f9f43726b6152f947992f8898522">00307</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a6644f9f43726b6152f947992f8898522">HasCharacter</a>(uint32_t ch) {
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (<a class="code" href="../../de/d12/classgfx_font_entry.html#aa68d09b333dbae60729c1c157c555c8d">mCharacterMap</a> &amp;&amp; <a class="code" href="../../de/d12/classgfx_font_entry.html#aa68d09b333dbae60729c1c157c555c8d">mCharacterMap</a>-&gt;<a class="code" href="../../de/dcb/classgfx_sparse_bit_set.html#a04c0afe2197d86698b51f000e5eba465">test</a>(ch)) {
<a name="l00309"></a>00309             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311         <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a62fda4caff81c56e9e9707d91555fab1">TestCharacterMap</a>(ch);
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313 
<a name="l00314"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ad76eb3a1493f60da07ad698731404cff">00314</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ad76eb3a1493f60da07ad698731404cff">SkipDuringSystemFallback</a>() { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00315"></a>00315     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a62fda4caff81c56e9e9707d91555fab1">TestCharacterMap</a>(uint32_t aCh);
<a name="l00316"></a>00316     <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="code" href="../../de/d12/classgfx_font_entry.html#aaeb548278f6b952836ce53a08359b993">InitializeUVSMap</a>();
<a name="l00317"></a>00317     uint16_t <a class="code" href="../../de/d12/classgfx_font_entry.html#a8a82e1a9abf0e6bbe71cabe841c39d94">GetUVSGlyph</a>(uint32_t aCh, uint32_t aVS);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">// All concrete gfxFontEntry subclasses (except gfxProxyFontEntry) need</span>
<a name="l00320"></a>00320     <span class="comment">// to override this, otherwise the font will never be used as it will</span>
<a name="l00321"></a>00321     <span class="comment">// be considered to support no characters.</span>
<a name="l00322"></a>00322     <span class="comment">// ReadCMAP() must *always* set the mCharacterMap pointer to a valid</span>
<a name="l00323"></a>00323     <span class="comment">// gfxCharacterMap, even if empty, as other code assumes this pointer</span>
<a name="l00324"></a>00324     <span class="comment">// can be safely dereferenced.</span>
<a name="l00325"></a>00325     <span class="keyword">virtual</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="code" href="../../de/d12/classgfx_font_entry.html#ac7bfebbec049fbaf99991b4ebf1ef4fb">ReadCMAP</a>();
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#af22207d8381e6a6659b132fbfd4c46fb">TryGetSVGData</a>();
<a name="l00328"></a>00328     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a332866a8aa4afe952c37e88fc05e02a9">HasSVGGlyph</a>(uint32_t aGlyphId);
<a name="l00329"></a>00329     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a85a771414699ed0ec63283c81697efde">GetSVGGlyphExtents</a>(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext, uint32_t aGlyphId,
<a name="l00330"></a>00330                             <a class="code" href="../../de/d69/structgfx_rect.html">gfxRect</a> *<a class="code" href="../../d9/d6a/ns_color_8h.html#a820357f645d7b0eaf62fd4994dda5a24">aResult</a>);
<a name="l00331"></a>00331     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a41e849e13731c2d7132b87f697fd045f">RenderSVGGlyph</a>(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext, uint32_t aGlyphId, <span class="keywordtype">int</span> aDrawMode,
<a name="l00332"></a>00332                         <a class="code" href="../../d2/d0c/classgfx_text_object_paint.html">gfxTextObjectPaint</a> *aObjectPaint);
<a name="l00333"></a>00333 
<a name="l00334"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aea715be392467eac3acbd49f843c6543">00334</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#aea715be392467eac3acbd49f843c6543">MatchesGenericFamily</a>(<span class="keyword">const</span> nsACString&amp; aGeneric)<span class="keyword"> const </span>{
<a name="l00335"></a>00335         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00336"></a>00336     }
<a name="l00337"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a95b17e167f38e2dd73ca197c25529e30">00337</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a95b17e167f38e2dd73ca197c25529e30">SupportsLangGroup</a>(<a class="code" href="../../dc/dcf/interfacens_i_atom.html">nsIAtom</a> *aLangGroup)<span class="keyword"> const </span>{
<a name="l00338"></a>00338         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="comment">// Access to raw font table data (needed for Harfbuzz):</span>
<a name="l00342"></a>00342     <span class="comment">// returns a pointer to data owned by the fontEntry or the OS,</span>
<a name="l00343"></a>00343     <span class="comment">// which will remain valid until the blob is destroyed.</span>
<a name="l00344"></a>00344     <span class="comment">// The data MUST be treated as read-only; we may be getting a</span>
<a name="l00345"></a>00345     <span class="comment">// reference to a shared system font cache.</span>
<a name="l00346"></a>00346     <span class="comment">//</span>
<a name="l00347"></a>00347     <span class="comment">// The default implementation uses CopyFontTable to get the data</span>
<a name="l00348"></a>00348     <span class="comment">// into a byte array, and maintains a cache of loaded tables.</span>
<a name="l00349"></a>00349     <span class="comment">//</span>
<a name="l00350"></a>00350     <span class="comment">// Subclasses should override this if they can provide more efficient</span>
<a name="l00351"></a>00351     <span class="comment">// access than copying table data into our own buffers.</span>
<a name="l00352"></a>00352     <span class="comment">//</span>
<a name="l00353"></a>00353     <span class="comment">// Get blob that encapsulates a specific font table, or nullptr if</span>
<a name="l00354"></a>00354     <span class="comment">// the table doesn&#39;t exist in the font.</span>
<a name="l00355"></a>00355     <span class="comment">//</span>
<a name="l00356"></a>00356     <span class="comment">// Caller is responsible to call hb_blob_destroy() on the returned blob</span>
<a name="l00357"></a>00357     <span class="comment">// (if non-nullptr) when no longer required. For transient access to a</span>
<a name="l00358"></a>00358     <span class="comment">// table, use of AutoTable (below) is generally preferred.</span>
<a name="l00359"></a>00359     <span class="keyword">virtual</span> <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a> *<a class="code" href="../../de/d12/classgfx_font_entry.html#a24c3b69bd207c81ccd05054f15f4bb99">GetFontTable</a>(uint32_t aTag);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="comment">// Stack-based utility to return a specified table, automatically releasing</span>
<a name="l00362"></a>00362     <span class="comment">// the blob when the AutoTable goes out of scope.</span>
<a name="l00363"></a><a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html">00363</a>     <span class="keyword">class </span><a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html">AutoTable</a> {
<a name="l00364"></a>00364     <span class="keyword">public</span>:
<a name="l00365"></a><a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html#a79f24dc1be2ea3234074d224870217ce">00365</a>         <a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html#a79f24dc1be2ea3234074d224870217ce">AutoTable</a>(<a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>* aFontEntry, uint32_t aTag)
<a name="l00366"></a>00366         {
<a name="l00367"></a>00367             mBlob = aFontEntry-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#a24c3b69bd207c81ccd05054f15f4bb99">GetFontTable</a>(aTag);
<a name="l00368"></a>00368         }
<a name="l00369"></a><a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html#a89f7754747121d8952a17dd31c82e0da">00369</a>         <a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html#a89f7754747121d8952a17dd31c82e0da">~AutoTable</a>() {
<a name="l00370"></a>00370             <span class="keywordflow">if</span> (mBlob) {
<a name="l00371"></a>00371                 hb_blob_destroy(mBlob);
<a name="l00372"></a>00372             }
<a name="l00373"></a>00373         }
<a name="l00374"></a><a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html#aee31eb5e06fd358be9ef4b4ad67105f6">00374</a>         <a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html#aee31eb5e06fd358be9ef4b4ad67105f6">operator hb_blob_t*</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mBlob; }
<a name="l00375"></a>00375     <span class="keyword">private</span>:
<a name="l00376"></a>00376         <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a>* mBlob;
<a name="l00377"></a>00377         <span class="comment">// not implemented:</span>
<a name="l00378"></a>00378         <a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html#a79f24dc1be2ea3234074d224870217ce">AutoTable</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html">AutoTable</a>&amp;) MOZ_DELETE;
<a name="l00379"></a>00379         <a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html">AutoTable</a>&amp; operator=(<a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="../../d1/d0a/classgfx_font_entry_1_1_auto_table.html">AutoTable</a>&amp;) MOZ_DELETE;
<a name="l00380"></a>00380     };
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed</a>&lt;<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>&gt; <a class="code" href="../../de/d12/classgfx_font_entry.html#a55ddefa3b4946b4a45d46a9d00fe23c8">FindOrMakeFont</a>(<a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *aStyle,
<a name="l00383"></a>00383                                              <span class="keywordtype">bool</span> aNeedsBold);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="comment">// Get an existing font table cache entry in aBlob if it has been</span>
<a name="l00386"></a>00386     <span class="comment">// registered, or return false if not.  Callers must call</span>
<a name="l00387"></a>00387     <span class="comment">// hb_blob_destroy on aBlob if true is returned.</span>
<a name="l00388"></a>00388     <span class="comment">//</span>
<a name="l00389"></a>00389     <span class="comment">// Note that some gfxFont implementations may not call this at all,</span>
<a name="l00390"></a>00390     <span class="comment">// if it is more efficient to get the table from the OS at that level.</span>
<a name="l00391"></a>00391     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#aa3c4a3eb67b320ac5d17cd019b4b1072">GetExistingFontTable</a>(uint32_t aTag, <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a>** aBlob);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="comment">// Elements of aTable are transferred (not copied) to and returned in a</span>
<a name="l00394"></a>00394     <span class="comment">// new hb_blob_t which is registered on the gfxFontEntry, but the initial</span>
<a name="l00395"></a>00395     <span class="comment">// reference is owned by the caller.  Removing the last reference</span>
<a name="l00396"></a>00396     <span class="comment">// unregisters the table from the font entry.</span>
<a name="l00397"></a>00397     <span class="comment">//</span>
<a name="l00398"></a>00398     <span class="comment">// Pass nullptr for aBuffer to indicate that the table is not present and</span>
<a name="l00399"></a>00399     <span class="comment">// nullptr will be returned.  Also returns nullptr on OOM.</span>
<a name="l00400"></a>00400     <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a> *<a class="code" href="../../de/d12/classgfx_font_entry.html#ac9cca6989421020ceb92f3741dcf2573">ShareFontTableAndGetBlob</a>(uint32_t aTag,
<a name="l00401"></a>00401                                         <a class="code" href="../../d3/d8f/class_fallible_t_array.html">FallibleTArray</a>&lt;uint8_t&gt;* aTable);
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="comment">// Shaper face accessors:</span>
<a name="l00404"></a>00404     <span class="comment">// NOTE that harfbuzz and graphite handle ownership/lifetime of the face</span>
<a name="l00405"></a>00405     <span class="comment">// object in completely different ways.</span>
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="comment">// Get HarfBuzz face corresponding to this font file.</span>
<a name="l00408"></a>00408     <span class="comment">// Caller must release with hb_face_destroy() when finished with it,</span>
<a name="l00409"></a>00409     <span class="comment">// and the font entry will be notified via ForgetHBFace.</span>
<a name="l00410"></a>00410     hb_face_t* <a class="code" href="../../de/d12/classgfx_font_entry.html#a7d8453672e66e96cb7bdf857133c99b8">GetHBFace</a>();
<a name="l00411"></a>00411     virtual <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a10100dcfb2e29603b91347062f953228">ForgetHBFace</a>();
<a name="l00412"></a>00412 
<a name="l00413"></a>00413     <span class="comment">// Get Graphite face corresponding to this font file.</span>
<a name="l00414"></a>00414     <span class="comment">// Caller must call gfxFontEntry::ReleaseGrFace when finished with it.</span>
<a name="l00415"></a>00415     <a class="code" href="../../d3/d0b/gfx_font_8h.html#a593edf9536bcbacd75254dcf11162ce5">gr_face</a>* <a class="code" href="../../de/d12/classgfx_font_entry.html#a0e7ce145d873fc2e8d0483f1f614b1e4">GetGrFace</a>();
<a name="l00416"></a>00416     virtual <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a90f7f82d0949fc9b2849ec193ec89938">ReleaseGrFace</a>(<a class="code" href="../../d3/d0b/gfx_font_8h.html#a593edf9536bcbacd75254dcf11162ce5">gr_face</a>* aFace);
<a name="l00417"></a>00417     
<a name="l00418"></a>00418     <span class="comment">// For memory reporting</span>
<a name="l00419"></a>00419     virtual <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ab5cab932a233f5b8e7e9d4ab573ce1ae">SizeOfExcludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf,
<a name="l00420"></a>00420                                      FontListSizes*    aSizes) <a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a>;
<a name="l00421"></a>00421     virtual <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0d234da521191615bfac5564c1648368">SizeOfIncludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf,
<a name="l00422"></a>00422                                      FontListSizes*    aSizes) const;
<a name="l00423"></a>00423 
<a name="l00424"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a9393bf22f00ef6785ec01e073084d48c">00424</a>     nsString         <a class="code" href="../../de/d12/classgfx_font_entry.html#a9393bf22f00ef6785ec01e073084d48c">mName</a>;
<a name="l00425"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aabcdfb3e125bd383e450f15aff281d15">00425</a>     nsString         <a class="code" href="../../de/d12/classgfx_font_entry.html#aabcdfb3e125bd383e450f15aff281d15">mFamilyName</a>;
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a7f6de6e8a3388df03396d368f12cb9cb">00427</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a7f6de6e8a3388df03396d368f12cb9cb">mItalic</a>      : 1;
<a name="l00428"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a57aa6b989f7d123ff615d02394c94d33">00428</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a57aa6b989f7d123ff615d02394c94d33">mFixedPitch</a>  : 1;
<a name="l00429"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a0c6afdce1a5796b61f1ee5d4d18bbb4a">00429</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a0c6afdce1a5796b61f1ee5d4d18bbb4a">mIsProxy</a>     : 1;
<a name="l00430"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a68ebbe88e0deffe64ca9c73891922b5a">00430</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a68ebbe88e0deffe64ca9c73891922b5a">mIsValid</a>     : 1;
<a name="l00431"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a1435cd6e93f5f2d51eb3c9bdf08ddae9">00431</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a1435cd6e93f5f2d51eb3c9bdf08ddae9">mIsBadUnderlineFont</a> : 1;
<a name="l00432"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a5ac906228e2308e7181145bde1e7a439">00432</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a5ac906228e2308e7181145bde1e7a439">mIsUserFont</a>  : 1;
<a name="l00433"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a35558267a718d4f276f2e2c2e16decad">00433</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a35558267a718d4f276f2e2c2e16decad">mIsLocalUserFont</a>  : 1;
<a name="l00434"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ab26a4817de3f7b20d743280c4daa7041">00434</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#ab26a4817de3f7b20d743280c4daa7041">mStandardFace</a> : 1;
<a name="l00435"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ae25941a437009a10d63c4fcb407553e2">00435</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#ae25941a437009a10d63c4fcb407553e2">mSymbolFont</a>  : 1;
<a name="l00436"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ab163f2eaaaa55cd2bfd534c78e47d5eb">00436</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#ab163f2eaaaa55cd2bfd534c78e47d5eb">mIgnoreGDEF</a>  : 1;
<a name="l00437"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a0df0faafcb00077a6f55672fdac861aa">00437</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a0df0faafcb00077a6f55672fdac861aa">mIgnoreGSUB</a>  : 1;
<a name="l00438"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ae597623e6b5f280ab98d3597bb090e06">00438</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#ae597623e6b5f280ab98d3597bb090e06">mSVGInitialized</a> : 1;
<a name="l00439"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ae222bd6c415aae836c55b43af327bf2d">00439</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#ae222bd6c415aae836c55b43af327bf2d">mHasSpaceFeaturesInitialized</a> : 1;
<a name="l00440"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a30df7711250a563ab5c4ed0734efb960">00440</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a30df7711250a563ab5c4ed0734efb960">mHasSpaceFeatures</a> : 1;
<a name="l00441"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#af0abcd300cb86483f4f45a3528f6e16c">00441</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#af0abcd300cb86483f4f45a3528f6e16c">mHasSpaceFeaturesKerning</a> : 1;
<a name="l00442"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a4bddd2853f098c52b15f3b47551493ff">00442</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a4bddd2853f098c52b15f3b47551493ff">mHasSpaceFeaturesNonKerning</a> : 1;
<a name="l00443"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a6dbe152b6fe88774ae626f58918c2325">00443</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a6dbe152b6fe88774ae626f58918c2325">mHasSpaceFeaturesSubDefault</a> : 1;
<a name="l00444"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a09882acf4dd1670325a018371455c562">00444</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#a09882acf4dd1670325a018371455c562">mHasGraphiteTables</a> : 1;
<a name="l00445"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#abed74ccb606d3237475a9d29c105b034">00445</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#abed74ccb606d3237475a9d29c105b034">mCheckedForGraphiteTables</a> : 1;
<a name="l00446"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aaad0a17ab50944637e536bfb5de1d912">00446</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#aaad0a17ab50944637e536bfb5de1d912">mHasCmapTable</a> : 1;
<a name="l00447"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aa3338371a074d17024fa9017adcba6e3">00447</a>     <span class="keywordtype">bool</span>             <a class="code" href="../../de/d12/classgfx_font_entry.html#aa3338371a074d17024fa9017adcba6e3">mGrFaceInitialized</a> : 1;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <span class="comment">// bitvector of substitution space features per script</span>
<a name="l00450"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a09c70aa2325aaa57dcb9a51e077dd6c4">00450</a>     uint32_t         <a class="code" href="../../de/d12/classgfx_font_entry.html#a09c70aa2325aaa57dcb9a51e077dd6c4">mHasSpaceFeaturesSub</a>[(<a class="code" href="../../de/d1b/ns_unicode_script_codes_8h.html#aaad850efd6fac6bef553915ab0c82094aa010957ed5b56df53ab0b1c1c7a26542">MOZ_NUM_SCRIPT_CODES</a> + 31) / 32];
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a64f79fb59e24a13dfc3f66c90f1785a9">00452</a>     uint16_t         <a class="code" href="../../de/d12/classgfx_font_entry.html#a64f79fb59e24a13dfc3f66c90f1785a9">mWeight</a>;
<a name="l00453"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aac04396478fbbfe49cb520b30c2dbfcc">00453</a>     int16_t          <a class="code" href="../../de/d12/classgfx_font_entry.html#aac04396478fbbfe49cb520b30c2dbfcc">mStretch</a>;
<a name="l00454"></a>00454 
<a name="l00455"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#aa68d09b333dbae60729c1c157c555c8d">00455</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr</a>&lt;<a class="code" href="../../d8/d58/classgfx_character_map.html">gfxCharacterMap</a>&gt; <a class="code" href="../../de/d12/classgfx_font_entry.html#aa68d09b333dbae60729c1c157c555c8d">mCharacterMap</a>;
<a name="l00456"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ab2d0f0947718a8b939ca62620c2f35fe">00456</a>     uint32_t         <a class="code" href="../../de/d12/classgfx_font_entry.html#ab2d0f0947718a8b939ca62620c2f35fe">mUVSOffset</a>;
<a name="l00457"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#acf65108b99e0f283cc9c92c605f96689">00457</a>     <a class="code" href="../../d1/ddd/classns_auto_array_ptr.html">nsAutoArrayPtr</a>&lt;uint8_t&gt; <a class="code" href="../../de/d12/classgfx_font_entry.html#acf65108b99e0f283cc9c92c605f96689">mUVSData</a>;
<a name="l00458"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a6540fb752cf059662f885bd2e25a7f63">00458</a>     <a class="code" href="../../dc/d28/classgfx_user_font_data.html">gfxUserFontData</a>* <a class="code" href="../../de/d12/classgfx_font_entry.html#a6540fb752cf059662f885bd2e25a7f63">mUserFontData</a>;
<a name="l00459"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a1573bba38f7ba9538fcd03f7aa15a496">00459</a>     <a class="code" href="../../df/d90/classgfx_s_v_g_glyphs.html">gfxSVGGlyphs</a>    *<a class="code" href="../../de/d12/classgfx_font_entry.html#a1573bba38f7ba9538fcd03f7aa15a496">mSVGGlyphs</a>;
<a name="l00460"></a>00460 
<a name="l00461"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a849528a81472107323347cd91e453f2a">00461</a>     <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray</a>&lt;<a class="code" href="../../db/dd2/structgfx_font_feature.html">gfxFontFeature</a>&gt; <a class="code" href="../../de/d12/classgfx_font_entry.html#a849528a81472107323347cd91e453f2a">mFeatureSettings</a>;
<a name="l00462"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a9a75df1face9d408eec854bbfffe280f">00462</a>     uint32_t         <a class="code" href="../../de/d12/classgfx_font_entry.html#a9a75df1face9d408eec854bbfffe280f">mLanguageOverride</a>;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 protected:
<a name="l00465"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a10f40f7bdbd7ab191cf034c5492c8017">00465</a>     friend class <a class="code" href="../../de/d12/classgfx_font_entry.html#a10f40f7bdbd7ab191cf034c5492c8017">gfxPlatformFontList</a>;
<a name="l00466"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a1a6a21a2d3dac4282f96656378edb61b">00466</a>     friend class <a class="code" href="../../de/d12/classgfx_font_entry.html#a1a6a21a2d3dac4282f96656378edb61b">gfxMacPlatformFontList</a>;
<a name="l00467"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#afc046b5dc584f7be728e7a4b82df1a07">00467</a>     friend class <a class="code" href="../../de/d12/classgfx_font_entry.html#afc046b5dc584f7be728e7a4b82df1a07">gfxUserFcFontEntry</a>;
<a name="l00468"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#adcd9b6382f827688a5ed9808a171bb86">00468</a>     friend class <a class="code" href="../../d8/d91/classgfx_font_family.html">gfxFontFamily</a>;
<a name="l00469"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#af634c20329e5d2473251ad06daae564a">00469</a>     friend class <a class="code" href="../../de/d12/classgfx_font_entry.html#af634c20329e5d2473251ad06daae564a">gfxSingleFaceMacFontFamily</a>;
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#af1f9700d8fb4dd0292ac8d0d067f00c1">00471</a>     <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>() :
<a name="l00472"></a>00472         mItalic(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>), mFixedPitch(false),
<a name="l00473"></a>00473         mIsProxy(false), mIsValid(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a>), 
<a name="l00474"></a>00474         mIsBadUnderlineFont(false),
<a name="l00475"></a>00475         mIsUserFont(false),
<a name="l00476"></a>00476         mIsLocalUserFont(false),
<a name="l00477"></a>00477         mStandardFace(false),
<a name="l00478"></a>00478         mSymbolFont(false),
<a name="l00479"></a>00479         mIgnoreGDEF(false),
<a name="l00480"></a>00480         mIgnoreGSUB(false),
<a name="l00481"></a>00481         mSVGInitialized(false),
<a name="l00482"></a>00482         mHasSpaceFeaturesInitialized(false),
<a name="l00483"></a>00483         mHasSpaceFeatures(false),
<a name="l00484"></a>00484         mHasSpaceFeaturesKerning(false),
<a name="l00485"></a>00485         mHasSpaceFeaturesNonKerning(false),
<a name="l00486"></a>00486         mHasSpaceFeaturesSubDefault(false),
<a name="l00487"></a>00487         mCheckedForGraphiteTables(false),
<a name="l00488"></a>00488         mHasCmapTable(false),
<a name="l00489"></a>00489         mGrFaceInitialized(false),
<a name="l00490"></a>00490         mWeight(500), mStretch(<a class="code" href="../../db/d4b/gfx_font_constants_8h.html#a679c6afa449ea1570b925c8b885e0df2">NS_FONT_STRETCH_NORMAL</a>),
<a name="l00491"></a>00491         mUVSOffset(0), mUVSData(<a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a0fd163987980515e24ce34fc3926206d">nullptr</a>),
<a name="l00492"></a>00492         mUserFontData(nullptr),
<a name="l00493"></a>00493         mSVGGlyphs(nullptr),
<a name="l00494"></a>00494         mLanguageOverride(<a class="code" href="../../d3/d0b/gfx_font_8h.html#ae06c5083e5f013dfe42baa632e603ddc">NO_FONT_LANGUAGE_OVERRIDE</a>),
<a name="l00495"></a>00495         <a class="code" href="../../de/d12/classgfx_font_entry.html#ad2b94939d4a24e11bf16b641cc2c330c">mHBFace</a>(nullptr),
<a name="l00496"></a>00496         <a class="code" href="../../de/d12/classgfx_font_entry.html#a1ecfcb3e3aa745ae6e6f2985ff37685b">mGrFace</a>(nullptr),
<a name="l00497"></a>00497         <a class="code" href="../../de/d12/classgfx_font_entry.html#a9c5030a6155426e0769cc35bf2c9fa5b">mGrFaceRefCnt</a>(0)
<a name="l00498"></a>00498     { }
<a name="l00499"></a>00499 
<a name="l00500"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a7454aa2f9a6b0c20b08fc6b804305aed">00500</a>     <span class="keyword">virtual</span> <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *<a class="code" href="../../de/d12/classgfx_font_entry.html#a7454aa2f9a6b0c20b08fc6b804305aed">CreateFontInstance</a>(<span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *aFontStyle, <span class="keywordtype">bool</span> aNeedsBold) {
<a name="l00501"></a>00501         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad3069ac6d831231df185636879a728ca">NS_NOTREACHED</a>(<span class="stringliteral">&quot;oops, somebody didn&#39;t override CreateFontInstance&quot;</span>);
<a name="l00502"></a>00502         <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a6ac0264a2b54e60f38810a5eb8bdeed5">CheckForGraphiteTables</a>();
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <span class="comment">// Copy a font table into aBuffer.</span>
<a name="l00508"></a>00508     <span class="comment">// The caller will be responsible for ownership of the data.</span>
<a name="l00509"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#adba107521f43138d5541f11dfb441a60">00509</a>     <span class="keyword">virtual</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="code" href="../../de/d12/classgfx_font_entry.html#adba107521f43138d5541f11dfb441a60">CopyFontTable</a>(uint32_t aTableTag,
<a name="l00510"></a>00510                                    <a class="code" href="../../d3/d8f/class_fallible_t_array.html">FallibleTArray&lt;uint8_t&gt;</a>&amp; aBuffer) {
<a name="l00511"></a>00511         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad3069ac6d831231df185636879a728ca">NS_NOTREACHED</a>(<span class="stringliteral">&quot;forgot to override either GetFontTable or CopyFontTable?&quot;</span>);
<a name="l00512"></a>00512         <span class="keywordflow">return</span> <a class="code" href="../../d7/dda/_error_list_c_defines_8h.html#a9de321fc4356efa6a090b3b736a206c2">NS_ERROR_FAILURE</a>;
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">// Return a blob that wraps a table found within a buffer of font data.</span>
<a name="l00516"></a>00516     <span class="comment">// The blob does NOT own its data; caller guarantees that the buffer</span>
<a name="l00517"></a>00517     <span class="comment">// will remain valid at least as long as the blob.</span>
<a name="l00518"></a>00518     <span class="comment">// Returns null if the specified table is not found.</span>
<a name="l00519"></a>00519     <span class="comment">// This method assumes aFontData is valid &#39;sfnt&#39; data; before using this,</span>
<a name="l00520"></a>00520     <span class="comment">// caller is responsible to do any sanitization/validation necessary.</span>
<a name="l00521"></a>00521     <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a>* <a class="code" href="../../de/d12/classgfx_font_entry.html#a6593add0bbc2a8118531236cd89d406f">GetTableFromFontData</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>* aFontData, uint32_t aTableTag);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="comment">// Shaper-specific face objects, shared by all instantiations of the same</span>
<a name="l00524"></a>00524     <span class="comment">// physical font, regardless of size.</span>
<a name="l00525"></a>00525     <span class="comment">// Usually, only one of these will actually be created for any given font</span>
<a name="l00526"></a>00526     <span class="comment">// entry, depending on the font tables that are present.</span>
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     <span class="comment">// hb_face_t is refcounted internally, so each shaper that&#39;s using it will</span>
<a name="l00529"></a>00529     <span class="comment">// bump the ref count when it acquires the face, and &quot;destroy&quot; (release) it</span>
<a name="l00530"></a>00530     <span class="comment">// in its destructor. The font entry has only this non-owning reference to</span>
<a name="l00531"></a>00531     <span class="comment">// the face; when the face is deleted, it will tell the font entry to forget</span>
<a name="l00532"></a>00532     <span class="comment">// it, so that a new face will be created next time it is needed.</span>
<a name="l00533"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#ad2b94939d4a24e11bf16b641cc2c330c">00533</a>     hb_face_t* <a class="code" href="../../de/d12/classgfx_font_entry.html#ad2b94939d4a24e11bf16b641cc2c330c">mHBFace</a>;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="keyword">static</span> <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a>* <a class="code" href="../../de/d12/classgfx_font_entry.html#ae20f1978af3dec466ba64225f617eecb">HBGetTable</a>(hb_face_t *face, uint32_t aTag, <span class="keywordtype">void</span> *aUserData);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="comment">// Callback that the hb_face will use to tell us when it is being deleted.</span>
<a name="l00538"></a>00538     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a4bf35fb3e92e3578b69b6c419f811994">HBFaceDeletedCallback</a>(<span class="keywordtype">void</span> *aUserData);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="comment">// gr_face is -not- refcounted, so it will be owned directly by the font</span>
<a name="l00541"></a>00541     <span class="comment">// entry, and we&#39;ll keep a count of how many references we&#39;ve handed out;</span>
<a name="l00542"></a>00542     <span class="comment">// each shaper is responsible to call ReleaseGrFace on its entry when</span>
<a name="l00543"></a>00543     <span class="comment">// finished with it, so that we know when it can be deleted.</span>
<a name="l00544"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a1ecfcb3e3aa745ae6e6f2985ff37685b">00544</a>     <a class="code" href="../../d3/d0b/gfx_font_8h.html#a593edf9536bcbacd75254dcf11162ce5">gr_face</a>*   <a class="code" href="../../de/d12/classgfx_font_entry.html#a1ecfcb3e3aa745ae6e6f2985ff37685b">mGrFace</a>;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="comment">// hashtable to map raw table data ptr back to its owning blob, for use by</span>
<a name="l00547"></a>00547     <span class="comment">// graphite table-release callback</span>
<a name="l00548"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#af34358e8cca8e85222b8abc79c6c35f1">00548</a>     <a class="code" href="../../d4/dfc/classns_data_hashtable.html">nsDataHashtable&lt;nsPtrHashKey&lt;const void&gt;</a>,<span class="keywordtype">void</span>*&gt;* <a class="code" href="../../de/d12/classgfx_font_entry.html#af34358e8cca8e85222b8abc79c6c35f1">mGrTableMap</a>;
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     <span class="comment">// number of current users of this entry&#39;s mGrFace</span>
<a name="l00551"></a><a class="code" href="../../de/d12/classgfx_font_entry.html#a9c5030a6155426e0769cc35bf2c9fa5b">00551</a>     <a class="code" href="../../d3/dd8/nscore_8h.html#a55d97bea9d9bcf37f34284c3bf447f51">nsrefcnt</a> <a class="code" href="../../de/d12/classgfx_font_entry.html#a9c5030a6155426e0769cc35bf2c9fa5b">mGrFaceRefCnt</a>;
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">void</span>* <a class="code" href="../../de/d12/classgfx_font_entry.html#a85ae72c944da1661227ee82c1e1782b7">GrGetTable</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *aAppFaceHandle,
<a name="l00554"></a>00554                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> aName,
<a name="l00555"></a>00555                                   <span class="keywordtype">size_t</span> *aLen);
<a name="l00556"></a>00556     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a908955d585af76f93560fedb2fca4f70">GrReleaseTable</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *aAppFaceHandle,
<a name="l00557"></a>00557                                <span class="keyword">const</span> <span class="keywordtype">void</span> *aTableBuffer);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 <span class="keyword">private</span>:
<a name="l00584"></a>00584     <span class="keyword">class </span>FontTableBlobData;
<a name="l00585"></a>00585 
<a name="l00597"></a>00597     <span class="keyword">class </span>FontTableHashEntry : <span class="keyword">public</span> <a class="code" href="../../d6/dc5/classns_uint32_hash_key.html">nsUint32HashKey</a>
<a name="l00598"></a>00598     {
<a name="l00599"></a>00599     <span class="keyword">public</span>:
<a name="l00600"></a>00600         <span class="comment">// Declarations for nsTHashtable</span>
<a name="l00601"></a>00601 
<a name="l00602"></a>00602         <span class="keyword">typedef</span> <a class="code" href="../../d6/dc5/classns_uint32_hash_key.html">nsUint32HashKey</a> KeyClass;
<a name="l00603"></a>00603         <span class="keyword">typedef</span> <a class="code" href="../../d7/da9/keythi_8h.html#aab0feaba617470cb4aa830dc5935238c">KeyClass::KeyType</a> <a class="code" href="../../d7/da9/keythi_8h.html#aab0feaba617470cb4aa830dc5935238c">KeyType</a>;
<a name="l00604"></a>00604         <span class="keyword">typedef</span> KeyClass::KeyTypePointer KeyTypePointer;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606         FontTableHashEntry(KeyTypePointer aTag)
<a name="l00607"></a>00607             : KeyClass(aTag), mBlob() { }
<a name="l00608"></a>00608         <span class="comment">// Copying transfers blob association.</span>
<a name="l00609"></a>00609         FontTableHashEntry(FontTableHashEntry&amp; toCopy)
<a name="l00610"></a>00610             : KeyClass(toCopy), mBlob(toCopy.mBlob)
<a name="l00611"></a>00611         {
<a name="l00612"></a>00612             toCopy.mBlob = <span class="keyword">nullptr</span>;
<a name="l00613"></a>00613         }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615         ~FontTableHashEntry() { <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab318805fb61164a4792808ab5f4c4fd8">Clear</a>(); }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617         <span class="comment">// FontTable/Blob API</span>
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         <span class="comment">// Transfer (not copy) elements of aTable to a new hb_blob_t and</span>
<a name="l00620"></a>00620         <span class="comment">// return ownership to the caller.  A weak reference to the blob is</span>
<a name="l00621"></a>00621         <span class="comment">// recorded in the hashtable entry so that others may use the same</span>
<a name="l00622"></a>00622         <span class="comment">// table.</span>
<a name="l00623"></a>00623         <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a> *
<a name="l00624"></a>00624         ShareTableAndGetBlob(<a class="code" href="../../d3/d8f/class_fallible_t_array.html">FallibleTArray&lt;uint8_t&gt;</a>&amp; aTable,
<a name="l00625"></a>00625                              <a class="code" href="../../d5/dc3/classns_t_hashtable.html">nsTHashtable&lt;FontTableHashEntry&gt;</a> *aHashtable);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627         <span class="comment">// Return a strong reference to the blob.</span>
<a name="l00628"></a>00628         <span class="comment">// Callers must hb_blob_destroy the returned blob.</span>
<a name="l00629"></a>00629         <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a> *GetBlob() <span class="keyword">const</span>;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         <span class="keywordtype">void</span> <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab318805fb61164a4792808ab5f4c4fd8">Clear</a>();
<a name="l00632"></a>00632 
<a name="l00633"></a>00633         <span class="keyword">static</span> <span class="keywordtype">size_t</span>
<a name="l00634"></a>00634         SizeOfEntryExcludingThis(FontTableHashEntry *aEntry,
<a name="l00635"></a>00635                                  mozilla::MallocSizeOf   aMallocSizeOf,
<a name="l00636"></a>00636                                  <span class="keywordtype">void</span>*               aUserArg);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <span class="keyword">private</span>:
<a name="l00639"></a>00639         <span class="keyword">static</span> <span class="keywordtype">void</span> DeleteFontTableBlobData(<span class="keywordtype">void</span> *aBlobData);
<a name="l00640"></a>00640         <span class="comment">// not implemented</span>
<a name="l00641"></a>00641         FontTableHashEntry&amp; operator=(FontTableHashEntry&amp; toCopy);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         FontTableBlobData *mSharedBlobData;
<a name="l00644"></a>00644         <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a> *mBlob;
<a name="l00645"></a>00645     };
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     <a class="code" href="../../d5/dc3/classns_t_hashtable.html">nsTHashtable&lt;FontTableHashEntry&gt;</a> mFontTableCache;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     <a class="code" href="../../de/d12/classgfx_font_entry.html#af1f9700d8fb4dd0292ac8d0d067f00c1">gfxFontEntry</a>(<span class="keyword">const</span> <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>&amp;);
<a name="l00650"></a>00650     <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>&amp;);
<a name="l00651"></a>00651 };
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 <span class="comment">// used when iterating over all fonts looking for a match for a given character</span>
<a name="l00655"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html">00655</a> <span class="keyword">struct </span><a class="code" href="../../d3/d7f/struct_global_font_match.html">GlobalFontMatch</a> {
<a name="l00656"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#ac412e4acf81a155a515ecf0376c751fb">00656</a>     <a class="code" href="../../d3/d7f/struct_global_font_match.html">GlobalFontMatch</a>(<span class="keyword">const</span> uint32_t aCharacter,
<a name="l00657"></a>00657                     int32_t aRunScript,
<a name="l00658"></a>00658                     <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *aStyle) :
<a name="l00659"></a>00659         mCh(aCharacter), mRunScript(aRunScript), mStyle(aStyle),
<a name="l00660"></a>00660         mMatchRank(0), <a class="code" href="../../d7/d13/mock__updatable_8js.html#abbcb12f502612a6901d1ce7c30886e37">mCount</a>(0), mCmapsTested(0)
<a name="l00661"></a>00661         {
<a name="l00662"></a>00662 
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664 
<a name="l00665"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#a654e34942d8018a0113d228c713986ac">00665</a>     <span class="keyword">const</span> uint32_t         <a class="code" href="../../d3/d7f/struct_global_font_match.html#a654e34942d8018a0113d228c713986ac">mCh</a>;          <span class="comment">// codepoint to be matched</span>
<a name="l00666"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#ac244fccba36d30cace2bbc4638da42f0">00666</a>     int32_t                <a class="code" href="../../d3/d7f/struct_global_font_match.html#ac244fccba36d30cace2bbc4638da42f0">mRunScript</a>;   <span class="comment">// Unicode script for the codepoint</span>
<a name="l00667"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#af7b40a0438e09fd7df8609a11825cb20">00667</a>     <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a>*    <a class="code" href="../../d3/d7f/struct_global_font_match.html#af7b40a0438e09fd7df8609a11825cb20">mStyle</a>;       <span class="comment">// style to match</span>
<a name="l00668"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#aee203127f9c41b49d088aeef05fa08dc">00668</a>     int32_t                <a class="code" href="../../d3/d7f/struct_global_font_match.html#aee203127f9c41b49d088aeef05fa08dc">mMatchRank</a>;   <span class="comment">// metric indicating closest match</span>
<a name="l00669"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#adb6437ac1b89b6fc8b8a555ca8202344">00669</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFontEntry&gt;</a> <a class="code" href="../../d3/d7f/struct_global_font_match.html#adb6437ac1b89b6fc8b8a555ca8202344">mBestMatch</a>;   <span class="comment">// current best match</span>
<a name="l00670"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#a3bb79ba87955fe0905ff1492bd63c894">00670</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFontFamily&gt;</a> <a class="code" href="../../d3/d7f/struct_global_font_match.html#a3bb79ba87955fe0905ff1492bd63c894">mMatchedFamily</a>; <span class="comment">// the family it belongs to</span>
<a name="l00671"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#a091322181036957d76539dae574dd103">00671</a>     uint32_t               <a class="code" href="../../d3/d7f/struct_global_font_match.html#a091322181036957d76539dae574dd103">mCount</a>;       <span class="comment">// number of fonts matched</span>
<a name="l00672"></a><a class="code" href="../../d3/d7f/struct_global_font_match.html#a4497aa04a3129780b231d95780c2a1e9">00672</a>     uint32_t               <a class="code" href="../../d3/d7f/struct_global_font_match.html#a4497aa04a3129780b231d95780c2a1e9">mCmapsTested</a>; <span class="comment">// number of cmaps tested</span>
<a name="l00673"></a>00673 };
<a name="l00674"></a>00674 
<a name="l00675"></a><a class="code" href="../../d8/d91/classgfx_font_family.html">00675</a> <span class="keyword">class </span><a class="code" href="../../d8/d91/classgfx_font_family.html">gfxFontFamily</a> {
<a name="l00676"></a>00676 <span class="keyword">public</span>:
<a name="l00677"></a>00677     <a class="code" href="../../d0/d5a/ns_i_supports_impl_8h.html#a5fe430b38b26f82f23c2e59b9d70e174">NS_INLINE_DECL_REFCOUNTING</a>(<a class="code" href="../../d8/d91/classgfx_font_family.html">gfxFontFamily</a>)
<a name="l00678"></a>00678 
<a name="l00679"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a8676bf841995d1fbfcb83021b9c600bb">00679</a>     <a class="code" href="../../d8/d91/classgfx_font_family.html">gfxFontFamily</a>(<a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> nsAString&amp; aName) :
<a name="l00680"></a>00680         <a class="code" href="../../de/d12/classgfx_font_entry.html#a9393bf22f00ef6785ec01e073084d48c">mName</a>(aName),
<a name="l00681"></a>00681         mOtherFamilyNamesInitialized(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>),
<a name="l00682"></a>00682         mHasOtherFamilyNames(false),
<a name="l00683"></a>00683         mFaceNamesInitialized(false),
<a name="l00684"></a>00684         mHasStyles(false),
<a name="l00685"></a>00685         mIsSimpleFamily(false),
<a name="l00686"></a>00686         mIsBadUnderlineFamily(false),
<a name="l00687"></a>00687         mFamilyCharacterMapInitialized(false)
<a name="l00688"></a>00688         { }
<a name="l00689"></a>00689 
<a name="l00690"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a801e43d655038cff07f5dd36535ad3b5">00690</a>     <span class="keyword">virtual</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#a801e43d655038cff07f5dd36535ad3b5">~gfxFontFamily</a>() { }
<a name="l00691"></a>00691 
<a name="l00692"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a29ab8d6db91f3ae44e82e538e958f829">00692</a>     <span class="keyword">const</span> nsString&amp; <a class="code" href="../../d8/d91/classgfx_font_family.html#a29ab8d6db91f3ae44e82e538e958f829">Name</a>() { <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a9393bf22f00ef6785ec01e073084d48c">mName</a>; }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     <span class="keyword">virtual</span> <span class="keywordtype">void</span> LocalizedName(nsAString&amp; aLocalizedName);
<a name="l00695"></a>00695     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> HasOtherFamilyNames();
<a name="l00696"></a>00696     
<a name="l00697"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a0ffb05bfdd91ab7c06c18d8b6feb0eb1">00697</a>     <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;nsRefPtr&lt;gfxFontEntry&gt;</a> &gt;&amp; <a class="code" href="../../d8/d91/classgfx_font_family.html#a0ffb05bfdd91ab7c06c18d8b6feb0eb1">GetFontList</a>() { <span class="keywordflow">return</span> mAvailableFonts; }
<a name="l00698"></a>00698     
<a name="l00699"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a8c521f3bc43edc58b1a2be11b8098ed2">00699</a>     <span class="keywordtype">void</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#a8c521f3bc43edc58b1a2be11b8098ed2">AddFontEntry</a>(<a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFontEntry&gt;</a> aFontEntry) {
<a name="l00700"></a>00700         <span class="comment">// bug 589682 - set the IgnoreGDEF flag on entries for Italic faces</span>
<a name="l00701"></a>00701         <span class="comment">// of Times New Roman, because of buggy table in those fonts</span>
<a name="l00702"></a>00702         <span class="keywordflow">if</span> (aFontEntry-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#a51aa25c9925ce524a1e6f26688143b50">IsItalic</a>() &amp;&amp; !aFontEntry-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#ae4d750ff86803a02a6660da2bbdcd8cf">IsUserFont</a>() &amp;&amp;
<a name="l00703"></a>00703             <a class="code" href="../../de/d12/classgfx_font_entry.html#ad0aff47dbe7ec01bd5fa523d33e55335">Name</a>().EqualsLiteral(<span class="stringliteral">&quot;Times New Roman&quot;</span>))
<a name="l00704"></a>00704         {
<a name="l00705"></a>00705             aFontEntry-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#ab163f2eaaaa55cd2bfd534c78e47d5eb">mIgnoreGDEF</a> = <span class="keyword">true</span>;
<a name="l00706"></a>00706         }
<a name="l00707"></a>00707         aFontEntry-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#aabcdfb3e125bd383e450f15aff281d15">mFamilyName</a> = <a class="code" href="../../de/d12/classgfx_font_entry.html#ad0aff47dbe7ec01bd5fa523d33e55335">Name</a>();
<a name="l00708"></a>00708         mAvailableFonts.AppendElement(aFontEntry);
<a name="l00709"></a>00709     }
<a name="l00710"></a>00710 
<a name="l00711"></a>00711     <span class="comment">// note that the styles for this family have been added</span>
<a name="l00712"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a095f196543d6c4a87636914b6e848ebc">00712</a>     <span class="keywordtype">void</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#a095f196543d6c4a87636914b6e848ebc">SetHasStyles</a>(<span class="keywordtype">bool</span> aHasStyles) { mHasStyles = aHasStyles; }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <span class="comment">// choose a specific face to match a style using CSS font matching</span>
<a name="l00715"></a>00715     <span class="comment">// rules (weight matching occurs here).  may return a face that doesn&#39;t</span>
<a name="l00716"></a>00716     <span class="comment">// precisely match (e.g. normal face when no italic face exists).</span>
<a name="l00717"></a>00717     <span class="comment">// aNeedsSyntheticBold is set to true when synthetic bolding is</span>
<a name="l00718"></a>00718     <span class="comment">// needed, false otherwise</span>
<a name="l00719"></a>00719     <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a> *FindFontForStyle(<span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a>&amp; aFontStyle, 
<a name="l00720"></a>00720                                    <span class="keywordtype">bool</span>&amp; aNeedsSyntheticBold);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     <span class="comment">// checks for a matching font within the family</span>
<a name="l00723"></a>00723     <span class="comment">// used as part of the font fallback process</span>
<a name="l00724"></a>00724     <span class="keywordtype">void</span> FindFontForChar(<a class="code" href="../../d3/d7f/struct_global_font_match.html">GlobalFontMatch</a> *aMatchData);
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     <span class="comment">// checks all fonts for a matching font within the family</span>
<a name="l00727"></a>00727     <span class="keywordtype">void</span> SearchAllFontsForChar(<a class="code" href="../../d3/d7f/struct_global_font_match.html">GlobalFontMatch</a> *aMatchData);
<a name="l00728"></a>00728 
<a name="l00729"></a>00729     <span class="comment">// read in other family names, if any, and use functor to add each into cache</span>
<a name="l00730"></a>00730     <span class="keyword">virtual</span> <span class="keywordtype">void</span> ReadOtherFamilyNames(<a class="code" href="../../de/d12/classgfx_font_entry.html#a10f40f7bdbd7ab191cf034c5492c8017">gfxPlatformFontList</a> *aPlatformFontList);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     <span class="comment">// set when other family names have been read in</span>
<a name="l00733"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a99cf232b2a8ec63b326e0a8b77f1d70f">00733</a>     <span class="keywordtype">void</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#a99cf232b2a8ec63b326e0a8b77f1d70f">SetOtherFamilyNamesInitialized</a>() {
<a name="l00734"></a>00734         mOtherFamilyNamesInitialized = <span class="keyword">true</span>;
<a name="l00735"></a>00735     }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     <span class="comment">// read in other localized family names, fullnames and Postscript names</span>
<a name="l00738"></a>00738     <span class="comment">// for all faces and append to lookup tables</span>
<a name="l00739"></a>00739     <span class="keyword">virtual</span> <span class="keywordtype">void</span> ReadFaceNames(<a class="code" href="../../de/d12/classgfx_font_entry.html#a10f40f7bdbd7ab191cf034c5492c8017">gfxPlatformFontList</a> *aPlatformFontList,
<a name="l00740"></a>00740                                <span class="keywordtype">bool</span> aNeedFullnamePostscriptNames);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     <span class="comment">// find faces belonging to this family (platform implementations override this;</span>
<a name="l00743"></a>00743     <span class="comment">// should be made pure virtual once all subclasses have been updated)</span>
<a name="l00744"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#afa13d3693fd541f9aeeedc183d2a9df3">00744</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#afa13d3693fd541f9aeeedc183d2a9df3">FindStyleVariations</a>() { }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     <span class="comment">// search for a specific face using the Postscript name</span>
<a name="l00747"></a>00747     <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>* FindFont(<span class="keyword">const</span> nsAString&amp; aPostscriptName);
<a name="l00748"></a>00748 
<a name="l00749"></a>00749     <span class="comment">// read in cmaps for all the faces</span>
<a name="l00750"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#abda9d43b569793b9fbba972f3077cfc3">00750</a>     <span class="keywordtype">void</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#abda9d43b569793b9fbba972f3077cfc3">ReadAllCMAPs</a>() {
<a name="l00751"></a>00751         uint32_t <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>, numFonts = mAvailableFonts.Length();
<a name="l00752"></a>00752         <span class="keywordflow">for</span> (i = 0; i &lt; numFonts; i++) {
<a name="l00753"></a>00753             <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a> *fe = mAvailableFonts[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>];
<a name="l00754"></a>00754             <span class="comment">// don&#39;t try to load cmaps for downloadable fonts not yet loaded</span>
<a name="l00755"></a>00755             <span class="keywordflow">if</span> (!fe || fe-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#a0c6afdce1a5796b61f1ee5d4d18bbb4a">mIsProxy</a>) {
<a name="l00756"></a>00756                 <span class="keywordflow">continue</span>;
<a name="l00757"></a>00757             }
<a name="l00758"></a>00758             fe-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#ac7bfebbec049fbaf99991b4ebf1ef4fb">ReadCMAP</a>();
<a name="l00759"></a>00759             mFamilyCharacterMap.Union(*(fe-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#aa68d09b333dbae60729c1c157c555c8d">mCharacterMap</a>));
<a name="l00760"></a>00760         }
<a name="l00761"></a>00761         mFamilyCharacterMap.Compact();
<a name="l00762"></a>00762         mFamilyCharacterMapInitialized = <span class="keyword">true</span>;
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#ad51fdf639349cd22d97b7e7b3f98d487">00765</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#ad51fdf639349cd22d97b7e7b3f98d487">TestCharacterMap</a>(uint32_t aCh) {
<a name="l00766"></a>00766         <span class="keywordflow">if</span> (!mFamilyCharacterMapInitialized) {
<a name="l00767"></a>00767             ReadAllCMAPs();
<a name="l00768"></a>00768         }
<a name="l00769"></a>00769         <span class="keywordflow">return</span> mFamilyCharacterMap.test(aCh);
<a name="l00770"></a>00770     }
<a name="l00771"></a>00771 
<a name="l00772"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a7c18ee0fda78dffc990a5e9385c3247f">00772</a>     <span class="keywordtype">void</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#a7c18ee0fda78dffc990a5e9385c3247f">ResetCharacterMap</a>() {
<a name="l00773"></a>00773         mFamilyCharacterMap.reset();
<a name="l00774"></a>00774         mFamilyCharacterMapInitialized = <span class="keyword">false</span>;
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <span class="comment">// mark this family as being in the &quot;bad&quot; underline offset blacklist</span>
<a name="l00778"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#af4a0ca707d9d6c13d6992b6d47fbb3f5">00778</a>     <span class="keywordtype">void</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#af4a0ca707d9d6c13d6992b6d47fbb3f5">SetBadUnderlineFamily</a>() {
<a name="l00779"></a>00779         mIsBadUnderlineFamily = <span class="keyword">true</span>;
<a name="l00780"></a>00780         <span class="keywordflow">if</span> (mHasStyles) {
<a name="l00781"></a>00781             SetBadUnderlineFonts();
<a name="l00782"></a>00782         }
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784 
<a name="l00785"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a5134170cc2c150567e98e8db82bc1821">00785</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#a5134170cc2c150567e98e8db82bc1821">IsBadUnderlineFamily</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mIsBadUnderlineFamily; }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <span class="comment">// sort available fonts to put preferred (standard) faces towards the end</span>
<a name="l00788"></a>00788     <span class="keywordtype">void</span> SortAvailableFonts();
<a name="l00789"></a>00789 
<a name="l00790"></a>00790     <span class="comment">// check whether the family fits into the simple 4-face model,</span>
<a name="l00791"></a>00791     <span class="comment">// so we can use simplified style-matching;</span>
<a name="l00792"></a>00792     <span class="comment">// if so set the mIsSimpleFamily flag (defaults to False before we&#39;ve checked)</span>
<a name="l00793"></a>00793     <span class="keywordtype">void</span> CheckForSimpleFamily();
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     <span class="comment">// For memory reporter</span>
<a name="l00796"></a>00796     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ab5cab932a233f5b8e7e9d4ab573ce1ae">SizeOfExcludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf,
<a name="l00797"></a>00797                                      FontListSizes*    aSizes) <span class="keyword">const</span>;
<a name="l00798"></a>00798     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0d234da521191615bfac5564c1648368">SizeOfIncludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf,
<a name="l00799"></a>00799                                      FontListSizes*    aSizes) <span class="keyword">const</span>;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801     <span class="comment">// Only used for debugging checks - does a linear search</span>
<a name="l00802"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a6034eba3f3334141001eae319a9c21a1">00802</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#a6034eba3f3334141001eae319a9c21a1">ContainsFace</a>(<a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>* aFontEntry) {
<a name="l00803"></a>00803         uint32_t <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>, numFonts = mAvailableFonts.Length();
<a name="l00804"></a>00804         <span class="keywordflow">for</span> (i = 0; i &lt; numFonts; i++) {
<a name="l00805"></a>00805             <span class="keywordflow">if</span> (mAvailableFonts[i] == aFontEntry) {
<a name="l00806"></a>00806                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00807"></a>00807             }
<a name="l00808"></a>00808         }
<a name="l00809"></a>00809         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00810"></a>00810     }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 <span class="keyword">protected</span>:
<a name="l00813"></a>00813     <span class="comment">// fills in an array with weights of faces that match style,</span>
<a name="l00814"></a>00814     <span class="comment">// returns whether any matching entries found</span>
<a name="l00815"></a>00815     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> FindWeightsForStyle(<a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>* aFontsForWeights[],
<a name="l00816"></a>00816                                        <span class="keywordtype">bool</span> anItalic, int16_t aStretch);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818     <span class="keywordtype">bool</span> ReadOtherFamilyNamesForFace(<a class="code" href="../../de/d12/classgfx_font_entry.html#a10f40f7bdbd7ab191cf034c5492c8017">gfxPlatformFontList</a> *aPlatformFontList,
<a name="l00819"></a>00819                                      <a class="code" href="../../da/d2e/gfx_font_utils_8h.html#ae8466762131f0380fe515390ead91d81">hb_blob_t</a>           *aNameTable,
<a name="l00820"></a>00820                                      <span class="keywordtype">bool</span>                 useFullName = <span class="keyword">false</span>);
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     <span class="comment">// set whether this font family is in &quot;bad&quot; underline offset blacklist.</span>
<a name="l00823"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#ad4af26c792fe556226560c9033113a06">00823</a>     <span class="keywordtype">void</span> <a class="code" href="../../d8/d91/classgfx_font_family.html#ad4af26c792fe556226560c9033113a06">SetBadUnderlineFonts</a>() {
<a name="l00824"></a>00824         uint32_t <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>, numFonts = mAvailableFonts.Length();
<a name="l00825"></a>00825         <span class="keywordflow">for</span> (i = 0; i &lt; numFonts; i++) {
<a name="l00826"></a>00826             <span class="keywordflow">if</span> (mAvailableFonts[i]) {
<a name="l00827"></a>00827                 mAvailableFonts[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>]-&gt;mIsBadUnderlineFont = <span class="keyword">true</span>;
<a name="l00828"></a>00828             }
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830     }
<a name="l00831"></a>00831 
<a name="l00832"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#ae7398c539b5ba288b22e6dc08b841cca">00832</a>     nsString <a class="code" href="../../d8/d91/classgfx_font_family.html#ae7398c539b5ba288b22e6dc08b841cca">mName</a>;
<a name="l00833"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#ac08f34fe7c85835fd74580ca43a702b1">00833</a>     <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;nsRefPtr&lt;gfxFontEntry&gt;</a> &gt;  <a class="code" href="../../d8/d91/classgfx_font_family.html#ac08f34fe7c85835fd74580ca43a702b1">mAvailableFonts</a>;
<a name="l00834"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#ace22ceb6ae2fe96bc3016164b06fb567">00834</a>     <a class="code" href="../../de/dcb/classgfx_sparse_bit_set.html">gfxSparseBitSet</a> <a class="code" href="../../d8/d91/classgfx_font_family.html#ace22ceb6ae2fe96bc3016164b06fb567">mFamilyCharacterMap</a>;
<a name="l00835"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#ae5ada4a05311ab2fd88157117ab6092a">00835</a>     <span class="keywordtype">bool</span> mOtherFamilyNamesInitialized : 1;
<a name="l00836"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a123fe3fd1071c6cbcec530a92ade20b0">00836</a>     <span class="keywordtype">bool</span> mHasOtherFamilyNames : 1;
<a name="l00837"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#aa809d50b8fbe43e5f97449d77d50af62">00837</a>     <span class="keywordtype">bool</span> mFaceNamesInitialized : 1;
<a name="l00838"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a2b7bc5e31a764f5c0bcae307327dfc26">00838</a>     <span class="keywordtype">bool</span> mHasStyles : 1;
<a name="l00839"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#aae3d719bf8081c2ab2ad2b941d51783a">00839</a>     <span class="keywordtype">bool</span> mIsSimpleFamily : 1;
<a name="l00840"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a54404be0e1d4f5465fe6802965aefdb4">00840</a>     <span class="keywordtype">bool</span> mIsBadUnderlineFamily : 1;
<a name="l00841"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#aba002bc4c8424af1fbb6650e29923d03">00841</a>     <span class="keywordtype">bool</span> mFamilyCharacterMapInitialized : 1;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843     <span class="keyword">enum</span> {
<a name="l00844"></a>00844         <span class="comment">// for &quot;simple&quot; families, the faces are stored in mAvailableFonts</span>
<a name="l00845"></a>00845         <span class="comment">// with fixed positions:</span>
<a name="l00846"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a14717b11a77de0810c03b49ed5145b23ab21b6e3b9c53f7a5b90a41a7971fb89a">00846</a>         kRegularFaceIndex    = 0,
<a name="l00847"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a14717b11a77de0810c03b49ed5145b23a09f7b8947cf08ef94984493a6968d05d">00847</a>         kBoldFaceIndex       = 1,
<a name="l00848"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a14717b11a77de0810c03b49ed5145b23a13f37a25acf58e55bc9103caed5e2a21">00848</a>         kItalicFaceIndex     = 2,
<a name="l00849"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a14717b11a77de0810c03b49ed5145b23aae4beaf1f6197a40dd3b6024abc9d087">00849</a>         kBoldItalicFaceIndex = 3,
<a name="l00850"></a>00850         <span class="comment">// mask values for selecting face with bold and/or italic attributes</span>
<a name="l00851"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a14717b11a77de0810c03b49ed5145b23a09802f460c9d6137d877c189aa1d04e1">00851</a>         kBoldMask   = 0x01,
<a name="l00852"></a><a class="code" href="../../d8/d91/classgfx_font_family.html#a14717b11a77de0810c03b49ed5145b23a95afa7d0732f07585e85b60242653494">00852</a>         kItalicMask = 0x02
<a name="l00853"></a>00853     };
<a name="l00854"></a>00854 };
<a name="l00855"></a>00855 
<a name="l00856"></a><a class="code" href="../../da/dad/structgfx_text_range.html">00856</a> <span class="keyword">struct </span><a class="code" href="../../da/dad/structgfx_text_range.html">gfxTextRange</a> {
<a name="l00857"></a>00857     <span class="keyword">enum</span> {
<a name="l00858"></a>00858         <span class="comment">// flags for recording the kind of font-matching that was used</span>
<a name="l00859"></a><a class="code" href="../../da/dad/structgfx_text_range.html#a2d3833391f7a04412261313a71076ecea54a6846176c90c8e5b325947d6efcfb9">00859</a>         kFontGroup      = 0x0001,
<a name="l00860"></a><a class="code" href="../../da/dad/structgfx_text_range.html#a2d3833391f7a04412261313a71076ecea25cd22bc0f24308f3a6d2f0f1364e1d8">00860</a>         kPrefsFallback  = 0x0002,
<a name="l00861"></a><a class="code" href="../../da/dad/structgfx_text_range.html#a2d3833391f7a04412261313a71076ecea352f89f6ed2e1bd970eb45054fa09cf3">00861</a>         kSystemFallback = 0x0004
<a name="l00862"></a>00862     };
<a name="l00863"></a><a class="code" href="../../da/dad/structgfx_text_range.html#a16574614a0588bcc1626eb2ada276c08">00863</a>     <a class="code" href="../../da/dad/structgfx_text_range.html">gfxTextRange</a>(uint32_t aStart, uint32_t aEnd,
<a name="l00864"></a>00864                  <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>* aFont, uint8_t aMatchType)
<a name="l00865"></a>00865         : <a class="code" href="../../d7/dbf/build__stage_2email_2shared_2js_2media_2remote__controls_8js.html#afea9dd5375e7783397a6e3911cc64e28">start</a>(aStart),
<a name="l00866"></a>00866           <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>(aEnd),
<a name="l00867"></a>00867           <a class="code" href="../../d4/d8c/viewphoto_8js.html#ae15b4cb928861ff768db92508d6ce0d2">font</a>(aFont),
<a name="l00868"></a>00868           matchType(aMatchType)
<a name="l00869"></a>00869     { }
<a name="l00870"></a><a class="code" href="../../da/dad/structgfx_text_range.html#a15fe3253b4972b6236f239cbb345ba42">00870</a>     uint32_t <a class="code" href="../../da/dad/structgfx_text_range.html#a15fe3253b4972b6236f239cbb345ba42">Length</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a> - <a class="code" href="../../d7/dbf/build__stage_2email_2shared_2js_2media_2remote__controls_8js.html#afea9dd5375e7783397a6e3911cc64e28">start</a>; }
<a name="l00871"></a><a class="code" href="../../da/dad/structgfx_text_range.html#ad0ed0b765b86863bcf2325cb3e5d66a8">00871</a>     uint32_t <a class="code" href="../../da/dad/structgfx_text_range.html#ad0ed0b765b86863bcf2325cb3e5d66a8">start</a>, <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>;
<a name="l00872"></a><a class="code" href="../../da/dad/structgfx_text_range.html#a925d84360685dfc02e71cb529a52723a">00872</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFont&gt;</a> <a class="code" href="../../da/dad/structgfx_text_range.html#a925d84360685dfc02e71cb529a52723a">font</a>;
<a name="l00873"></a><a class="code" href="../../da/dad/structgfx_text_range.html#aa0e1f70f6593cbb8e40c446caeb85ca8">00873</a>     uint8_t <a class="code" href="../../da/dad/structgfx_text_range.html#aa0e1f70f6593cbb8e40c446caeb85ca8">matchType</a>;
<a name="l00874"></a>00874 };
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 
<a name="l00902"></a><a class="code" href="../../df/d0d/struct_font_cache_sizes.html">00902</a> <span class="keyword">struct </span><a class="code" href="../../df/d0d/struct_font_cache_sizes.html">FontCacheSizes</a> {
<a name="l00903"></a><a class="code" href="../../df/d0d/struct_font_cache_sizes.html#a3e5cd3dc285085be9318bc0aa352a74a">00903</a>     <a class="code" href="../../df/d0d/struct_font_cache_sizes.html">FontCacheSizes</a>()
<a name="l00904"></a>00904         : mFontInstances(0), mShapedWords(0)
<a name="l00905"></a>00905     { }
<a name="l00906"></a>00906 
<a name="l00907"></a><a class="code" href="../../df/d0d/struct_font_cache_sizes.html#a36081c4cedbf2f3e532b99d3275af5b8">00907</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../df/d0d/struct_font_cache_sizes.html#a36081c4cedbf2f3e532b99d3275af5b8">mFontInstances</a>; <span class="comment">// memory used by instances of gfxFont subclasses</span>
<a name="l00908"></a><a class="code" href="../../df/d0d/struct_font_cache_sizes.html#acd7c209bc1ed03f6ad26cf016410fe4e">00908</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../df/d0d/struct_font_cache_sizes.html#acd7c209bc1ed03f6ad26cf016410fe4e">mShapedWords</a>; <span class="comment">// memory used by the per-font shapedWord caches</span>
<a name="l00909"></a>00909 };
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 <span class="keyword">class </span>gfxFontCache <a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html">MOZ_FINAL</a> : <span class="keyword">public</span> <a class="code" href="../../d5/da0/classns_expiration_tracker.html">nsExpirationTracker</a>&lt;gfxFont,3&gt; {
<a name="l00912"></a>00912 <span class="keyword">public</span>:
<a name="l00913"></a>00913     <span class="keyword">enum</span> {
<a name="l00914"></a><a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#ac74df88a0972cdf4b7b21b46a4f3c881aaf0d9bba83e7747ee6a780585da8155a">00914</a>         FONT_TIMEOUT_SECONDS = 10,
<a name="l00915"></a><a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#ac74df88a0972cdf4b7b21b46a4f3c881a5cc47fa758e83f8c108f2d3777f06a01">00915</a>         SHAPED_WORD_TIMEOUT_SECONDS = 60
<a name="l00916"></a>00916     };
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     gfxFontCache();
<a name="l00919"></a>00919     ~gfxFontCache();
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     <span class="comment">/*</span>
<a name="l00922"></a>00922 <span class="comment">     * Get the global gfxFontCache.  You must call Init() before</span>
<a name="l00923"></a>00923 <span class="comment">     * calling this method --- the result will not be null.</span>
<a name="l00924"></a>00924 <span class="comment">     */</span>
<a name="l00925"></a><a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#ade0058ec2c2ed7625b18cd2790387f6f">00925</a>     <span class="keyword">static</span> gfxFontCache* <a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#ade0058ec2c2ed7625b18cd2790387f6f">GetCache</a>() {
<a name="l00926"></a>00926         <span class="keywordflow">return</span> gGlobalCache;
<a name="l00927"></a>00927     }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     <span class="keyword">static</span> <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> <a class="code" href="../../de/d79/namespacemozilla_1_1_available_memory_tracker.html#adb9d7dd5b6bb0a630490b2a4e7ef588e">Init</a>();
<a name="l00930"></a>00930     <span class="comment">// It&#39;s OK to call this even if Init() has not been called.</span>
<a name="l00931"></a>00931     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d5e/namespacemozilla_1_1_hang_monitor.html#a091d1602e707e37271b31cecc2244fe2">Shutdown</a>();
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <span class="comment">// Look up a font in the cache. Returns an addrefed pointer, or null</span>
<a name="l00934"></a>00934     <span class="comment">// if there&#39;s nothing matching in the cache</span>
<a name="l00935"></a>00935     <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;gfxFont&gt;</a> Lookup(<span class="keyword">const</span> <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a> *aFontEntry,
<a name="l00936"></a>00936                                      <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *aStyle);
<a name="l00937"></a>00937     <span class="comment">// We created a new font (presumably because Lookup returned null);</span>
<a name="l00938"></a>00938     <span class="comment">// put it in the cache. The font&#39;s refcount should be nonzero. It is</span>
<a name="l00939"></a>00939     <span class="comment">// allowable to add a new font even if there is one already in the</span>
<a name="l00940"></a>00940     <span class="comment">// cache with the same key; we&#39;ll forget about the old one.</span>
<a name="l00941"></a>00941     <span class="keywordtype">void</span> AddNew(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont);
<a name="l00942"></a>00942 
<a name="l00943"></a>00943     <span class="comment">// The font&#39;s refcount has gone to zero; give ownership of it to</span>
<a name="l00944"></a>00944     <span class="comment">// the cache. We delete it if it&#39;s not acquired again after a certain</span>
<a name="l00945"></a>00945     <span class="comment">// amount of time.</span>
<a name="l00946"></a>00946     <span class="keywordtype">void</span> NotifyReleased(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont);
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     <span class="comment">// This gets called when the timeout has expired on a zero-refcount</span>
<a name="l00949"></a>00949     <span class="comment">// font; we just delete it.</span>
<a name="l00950"></a>00950     <span class="keyword">virtual</span> <span class="keywordtype">void</span> NotifyExpired(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont);
<a name="l00951"></a>00951 
<a name="l00952"></a>00952     <span class="comment">// Cleans out the hashtable and removes expired fonts waiting for cleanup.</span>
<a name="l00953"></a>00953     <span class="comment">// Other gfxFont objects may be still in use but they will be pushed</span>
<a name="l00954"></a>00954     <span class="comment">// into the expiration queues and removed.</span>
<a name="l00955"></a><a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#aaf8a357f536c6d417347e2a4a23a8875">00955</a>     <span class="keywordtype">void</span> <a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#aaf8a357f536c6d417347e2a4a23a8875">Flush</a>() {
<a name="l00956"></a>00956         mFonts.Clear();
<a name="l00957"></a>00957         AgeAllGenerations();
<a name="l00958"></a>00958     }
<a name="l00959"></a>00959 
<a name="l00960"></a><a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#a2327f5eb9e2d563bffdf2a9550a51c9b">00960</a>     <span class="keywordtype">void</span> <a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#a2327f5eb9e2d563bffdf2a9550a51c9b">FlushShapedWordCaches</a>() {
<a name="l00961"></a>00961         mFonts.EnumerateEntries(ClearCachedWordsForFont, <span class="keyword">nullptr</span>);
<a name="l00962"></a>00962     }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964     <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ab5cab932a233f5b8e7e9d4ab573ce1ae">SizeOfExcludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf,
<a name="l00965"></a>00965                              <a class="code" href="../../df/d0d/struct_font_cache_sizes.html">FontCacheSizes</a>*   aSizes) <span class="keyword">const</span>;
<a name="l00966"></a>00966     <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0d234da521191615bfac5564c1648368">SizeOfIncludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf,
<a name="l00967"></a>00967                              <a class="code" href="../../df/d0d/struct_font_cache_sizes.html">FontCacheSizes</a>*   aSizes) <span class="keyword">const</span>;
<a name="l00968"></a>00968 
<a name="l00969"></a>00969 <span class="keyword">protected</span>:
<a name="l00970"></a><a class="code" href="../../d4/da1/class_m_o_z___f_i_n_a_l_1_1_m_o_z___f_i_n_a_l.html">00970</a>     <span class="keyword">class </span>MemoryReporter <a class="code" href="../../d4/da1/class_m_o_z___f_i_n_a_l_1_1_m_o_z___f_i_n_a_l.html">MOZ_FINAL</a>
<a name="l00971"></a>00971         : <span class="keyword">public</span> <a class="code" href="../../d0/db0/interfacens_i_memory_multi_reporter.html">nsIMemoryMultiReporter</a>
<a name="l00972"></a>00972     {
<a name="l00973"></a>00973     <span class="keyword">public</span>:
<a name="l00974"></a>00974         <a class="code" href="../../d0/d5a/ns_i_supports_impl_8h.html#a5084fc0869a6c828efdca6b17f8b5374">NS_DECL_ISUPPORTS</a>
<a name="l00975"></a>00975         <a class="code" href="../../df/d03/ns_i_memory_reporter_8h.html#a1cfce661e85465b55454352473e47522">NS_DECL_NSIMEMORYMULTIREPORTER</a>
<a name="l00976"></a>00976     };
<a name="l00977"></a>00977 
<a name="l00978"></a>00978     <span class="keywordtype">void</span> DestroyFont(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont);
<a name="l00979"></a>00979 
<a name="l00980"></a><a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#ac93cf0a955d179bf92487983a6468bcf">00980</a>     <span class="keyword">static</span> gfxFontCache *<a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#ac93cf0a955d179bf92487983a6468bcf">gGlobalCache</a>;
<a name="l00981"></a>00981 
<a name="l00982"></a><a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">00982</a>     <span class="keyword">struct </span><a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">Key</a> {
<a name="l00983"></a><a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html#a41dfadf24df97cb81eba846664096425">00983</a>         <span class="keyword">const</span> <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>* <a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html#a41dfadf24df97cb81eba846664096425">mFontEntry</a>;
<a name="l00984"></a><a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html#a76a4e95d9ac31f5831097b1f9ea276b6">00984</a>         <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a>* <a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html#a76a4e95d9ac31f5831097b1f9ea276b6">mStyle</a>;
<a name="l00985"></a><a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html#a97205bbc57e3b9029a67c546535f284e">00985</a>         <a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">Key</a>(<span class="keyword">const</span> <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a>* aFontEntry, <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a>* aStyle)
<a name="l00986"></a>00986             : mFontEntry(aFontEntry), mStyle(aStyle) {}
<a name="l00987"></a>00987     };
<a name="l00988"></a>00988 
<a name="l00989"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html">00989</a>     <span class="keyword">class </span><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html">HashEntry</a> : <span class="keyword">public</span> <a class="code" href="../../d0/dcc/struct_p_l_d_hash_entry_hdr.html">PLDHashEntryHdr</a> {
<a name="l00990"></a>00990     <span class="keyword">public</span>:
<a name="l00991"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a0083b88553fe6ae79ef88220a8a87fb2">00991</a>         <span class="keyword">typedef</span> <span class="keyword">const</span> <a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">Key</a>&amp; <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a0083b88553fe6ae79ef88220a8a87fb2">KeyType</a>;
<a name="l00992"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a921c4c0a03b43e0b015d70c8ac36585e">00992</a>         <span class="keyword">typedef</span> <span class="keyword">const</span> <a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">Key</a>* <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a921c4c0a03b43e0b015d70c8ac36585e">KeyTypePointer</a>;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994         <span class="comment">// When constructing a new entry in the hashtable, we&#39;ll leave this</span>
<a name="l00995"></a>00995         <span class="comment">// blank. The caller of Put() will fill this in.</span>
<a name="l00996"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a829df4c8409ee4ea0a17e2176c2b5d62">00996</a>         <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a829df4c8409ee4ea0a17e2176c2b5d62">HashEntry</a>(<a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">KeyTypePointer</a> aStr) : mFont(<a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a0fd163987980515e24ce34fc3926206d">nullptr</a>) { }
<a name="l00997"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#af8cec1254c4595d7642bc440a7649888">00997</a>         <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#af8cec1254c4595d7642bc440a7649888">HashEntry</a>(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html">HashEntry</a>&amp; toCopy) : mFont(toCopy.mFont) { }
<a name="l00998"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#ab137978202b5fe7636230667d8d19c4a">00998</a>         <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#ab137978202b5fe7636230667d8d19c4a">~HashEntry</a>() { }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000         <span class="keywordtype">bool</span> KeyEquals(<span class="keyword">const</span> KeyTypePointer aKey) <span class="keyword">const</span>;
<a name="l01001"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a23f6a9f064e0ee67149e10f832e2c594">01001</a>         <span class="keyword">static</span> <a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">KeyTypePointer</a> <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a23f6a9f064e0ee67149e10f832e2c594">KeyToPointer</a>(<a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">KeyType</a> aKey) { <span class="keywordflow">return</span> &amp;aKey; }
<a name="l01002"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a38bc54ce6dbeeeed81b9046deeb8af6f">01002</a>         <span class="keyword">static</span> <a class="code" href="../../da/d2c/pldhash_8h.html#a6b7adbc70882ca136a7949ca49024cf2">PLDHashNumber</a> <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a38bc54ce6dbeeeed81b9046deeb8af6f">HashKey</a>(<span class="keyword">const</span> <a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html">KeyTypePointer</a> aKey) {
<a name="l01003"></a>01003             <span class="keywordflow">return</span> mozilla::HashGeneric(aKey-&gt;<a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html#a76a4e95d9ac31f5831097b1f9ea276b6">mStyle</a>-&gt;<a class="code" href="../../d2/dbb/structgfx_font_style.html#a16611eb7d2836a1e716f90c3b24aa99d">Hash</a>(), aKey-&gt;<a class="code" href="../../d5/ddb/struct_m_o_z___f_i_n_a_l_1_1_key.html#a41dfadf24df97cb81eba846664096425">mFontEntry</a>);
<a name="l01004"></a>01004         }
<a name="l01005"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a839937379e4207f047f26d38fcf11c97a95b2968e5ccc80de852d694d5ad2f5cb">01005</a>         <span class="keyword">enum</span> { ALLOW_MEMMOVE = <span class="keyword">true</span> };
<a name="l01006"></a>01006 
<a name="l01007"></a><a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a1f51aba541df0095577609e9589b988d">01007</a>         <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>* <a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html#a1f51aba541df0095577609e9589b988d">mFont</a>;
<a name="l01008"></a>01008     };
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <span class="keyword">static</span> <span class="keywordtype">size_t</span> SizeOfFontEntryExcludingThis(<a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html">HashEntry</a>*        aHashEntry,
<a name="l01011"></a>01011                                                mozilla::MallocSizeOf aMallocSizeOf,
<a name="l01012"></a>01012                                                <span class="keywordtype">void</span>*             aUserArg);
<a name="l01013"></a>01013 
<a name="l01014"></a><a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#a9de96b0e6288c84cd5ad50ff2b88585d">01014</a>     <a class="code" href="../../d5/dc3/classns_t_hashtable.html">nsTHashtable&lt;HashEntry&gt;</a> <a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#a9de96b0e6288c84cd5ad50ff2b88585d">mFonts</a>;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016     <span class="keyword">static</span> <a class="code" href="../../da/d2c/pldhash_8h.html#a1d49536cbc1eec9e5a32af3750697519">PLDHashOperator</a> ClearCachedWordsForFont(<a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html">HashEntry</a>* aHashEntry, <span class="keywordtype">void</span>*);
<a name="l01017"></a>01017     <span class="keyword">static</span> <a class="code" href="../../da/d2c/pldhash_8h.html#a1d49536cbc1eec9e5a32af3750697519">PLDHashOperator</a> AgeCachedWordsForFont(<a class="code" href="../../d5/db2/class_m_o_z___f_i_n_a_l_1_1_hash_entry.html">HashEntry</a>* aHashEntry, <span class="keywordtype">void</span>*);
<a name="l01018"></a>01018     <span class="keyword">static</span> <span class="keywordtype">void</span> WordCacheExpirationTimerCallback(<a class="code" href="../../de/da2/interfacens_i_timer.html">nsITimer</a>* aTimer, <span class="keywordtype">void</span>* aCache);
<a name="l01019"></a><a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#a6e0ac700b0db45ed7c4071b3a50cc0d6">01019</a>     nsCOMPtr&lt;nsITimer&gt;      <a class="code" href="../../d4/dfc/class_m_o_z___f_i_n_a_l.html#a6e0ac700b0db45ed7c4071b3a50cc0d6">mWordCacheExpirationTimer</a>;
<a name="l01020"></a>01020 };
<a name="l01021"></a>01021 
<a name="l01022"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html">01022</a> <span class="keyword">class </span><a class="code" href="../../dd/d10/classgfx_text_run_factory.html">gfxTextRunFactory</a> {
<a name="l01023"></a>01023     <a class="code" href="../../d0/d5a/ns_i_supports_impl_8h.html#a5fe430b38b26f82f23c2e59b9d70e174">NS_INLINE_DECL_REFCOUNTING</a>(<a class="code" href="../../dd/d10/classgfx_text_run_factory.html">gfxTextRunFactory</a>)
<a name="l01024"></a>01024 
<a name="l01025"></a>01025 <span class="keyword">public</span>:
<a name="l01026"></a>01026     <span class="comment">// Flags in the mask 0xFFFF0000 are reserved for textrun clients</span>
<a name="l01027"></a>01027     <span class="comment">// Flags in the mask 0x0000F000 are reserved for per-platform fonts</span>
<a name="l01028"></a>01028     <span class="comment">// Flags in the mask 0x00000FFF are set by the textrun creator.</span>
<a name="l01029"></a>01029     <span class="keyword">enum</span> {
<a name="l01030"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27bad26cad7744758e574a3b43ce98caa8e6">01030</a>         CACHE_TEXT_FLAGS    = 0xF0000000,
<a name="l01031"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27bae5d3133489926506ec007465b1fd933b">01031</a>         USER_TEXT_FLAGS     = 0x0FFF0000,
<a name="l01032"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba642bcce3edab09e0d96ec70e8ee0cc07">01032</a>         PLATFORM_TEXT_FLAGS = 0x0000F000,
<a name="l01033"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba491b6707ee27952df6e78d3e94bb9000">01033</a>         TEXTRUN_TEXT_FLAGS  = 0x00000FFF,
<a name="l01034"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba97f5496a403e41e42093662c29364adb">01034</a>         SETTABLE_FLAGS      = CACHE_TEXT_FLAGS | USER_TEXT_FLAGS,
<a name="l01035"></a>01035 
<a name="l01040"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba4bcd579d2198fade4263ffda52f7a9db">01040</a>         TEXT_IS_PERSISTENT           = 0x0001,
<a name="l01044"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba26f1a87f7f97e66c8d8b1469fe21440d">01044</a>         TEXT_IS_ASCII                = 0x0002,
<a name="l01048"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba1f3d5fd55670b77fedcae547574193db">01048</a>         TEXT_IS_RTL                  = 0x0004,
<a name="l01053"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba978809e42e1bf59f1ff0eec140b7d50f">01053</a>         TEXT_ENABLE_SPACING          = 0x0008,
<a name="l01058"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27badf1e4ac2bd2d6971f7ca1a85de6b8b72">01058</a>         TEXT_ENABLE_HYPHEN_BREAKS    = 0x0010,
<a name="l01063"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba22b1b18065ebc28afc92f66758233540">01063</a>         TEXT_IS_8BIT                 = 0x0020,
<a name="l01071"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27bad2f1ba4c3c26330f567294444e93454f">01071</a>         TEXT_NEED_BOUNDING_BOX       = 0x0040,
<a name="l01076"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba421f40a46fd1d0e48fad7e492cc4a748">01076</a>         TEXT_DISABLE_OPTIONAL_LIGATURES = 0x0080,
<a name="l01082"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27bae19eeac0e474d9ca06ebbec69ae64787">01082</a>         TEXT_OPTIMIZE_SPEED          = 0x0100,
<a name="l01090"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27baf1ba25481e313f31f38125b2dced0e13">01090</a>         TEXT_RUN_SIZE_ACCOUNTED      = 0x0200,
<a name="l01091"></a>01091 
<a name="l01097"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27baa2aa3fd21a120b4a63b8d32e8be701f0">01097</a>         TEXT_TRAILING_ARABICCHAR = 0x20000000,
<a name="l01103"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba306a9b631f87540020cde39beefaf9b6">01103</a>         TEXT_INCOMING_ARABICCHAR = 0x40000000,
<a name="l01104"></a>01104 
<a name="l01105"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27bafe29cccbc5fcb1e7cc11d284026eb81a">01105</a>         TEXT_UNUSED_FLAGS = 0x90000000
<a name="l01106"></a>01106     };
<a name="l01107"></a>01107 
<a name="l01111"></a><a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html">01111</a>     <span class="keyword">struct </span><a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html">Parameters</a> {
<a name="l01112"></a>01112         <span class="comment">// A reference context suggesting where the textrun will be rendered</span>
<a name="l01113"></a><a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#abe3586120d9a2948970c9754da35e553">01113</a>         <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a>   *<a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#abe3586120d9a2948970c9754da35e553">mContext</a>;
<a name="l01114"></a>01114         <span class="comment">// Pointer to arbitrary user data (which should outlive the textrun)</span>
<a name="l01115"></a><a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#ae3ccb5b55f3da13a349bc82d5df77390">01115</a>         <span class="keywordtype">void</span>         *<a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#ae3ccb5b55f3da13a349bc82d5df77390">mUserData</a>;
<a name="l01116"></a>01116         <span class="comment">// A description of which characters have been stripped from the original</span>
<a name="l01117"></a>01117         <span class="comment">// DOM string to produce the characters in the textrun. May be null</span>
<a name="l01118"></a>01118         <span class="comment">// if that information is not relevant.</span>
<a name="l01119"></a><a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#a31eeb58e15db79653a50245939254b1d">01119</a>         <a class="code" href="../../df/d0d/classgfx_skip_chars.html">gfxSkipChars</a> *<a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#a31eeb58e15db79653a50245939254b1d">mSkipChars</a>;
<a name="l01120"></a>01120         <span class="comment">// A list of where linebreaks are currently placed in the textrun. May</span>
<a name="l01121"></a>01121         <span class="comment">// be null if mInitialBreakCount is zero.</span>
<a name="l01122"></a><a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#ac7db3e3cd328135aaff57827cec8be93">01122</a>         uint32_t     *<a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#ac7db3e3cd328135aaff57827cec8be93">mInitialBreaks</a>;
<a name="l01123"></a><a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#ab850a9fd720a81624608f43691514c46">01123</a>         uint32_t      <a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#ab850a9fd720a81624608f43691514c46">mInitialBreakCount</a>;
<a name="l01124"></a>01124         <span class="comment">// The ratio to use to convert device pixels to application layout units</span>
<a name="l01125"></a><a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#acd119cf7ecc4a35a9d4141fe1e50d47e">01125</a>         int32_t       <a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html#acd119cf7ecc4a35a9d4141fe1e50d47e">mAppUnitsPerDevUnit</a>;
<a name="l01126"></a>01126     };
<a name="l01127"></a>01127 
<a name="l01128"></a><a class="code" href="../../dd/d10/classgfx_text_run_factory.html#a3485e4e1e4d0fa1aaaac7825f7447a76">01128</a>     <span class="keyword">virtual</span> <a class="code" href="../../dd/d10/classgfx_text_run_factory.html#a3485e4e1e4d0fa1aaaac7825f7447a76">~gfxTextRunFactory</a>() {}
<a name="l01129"></a>01129 };
<a name="l01130"></a>01130 
<a name="l01144"></a><a class="code" href="../../de/d99/classgfx_glyph_extents.html">01144</a> <span class="keyword">class </span><a class="code" href="../../de/d99/classgfx_glyph_extents.html">gfxGlyphExtents</a> {
<a name="l01145"></a>01145 <span class="keyword">public</span>:
<a name="l01146"></a><a class="code" href="../../de/d99/classgfx_glyph_extents.html#af2827b559a46d2e9a985f9d5e7b61262">01146</a>     <a class="code" href="../../de/d99/classgfx_glyph_extents.html">gfxGlyphExtents</a>(int32_t aAppUnitsPerDevUnit) :
<a name="l01147"></a>01147         mAppUnitsPerDevUnit(aAppUnitsPerDevUnit) {
<a name="l01148"></a>01148         <a class="code" href="../../dc/d1c/ns_trace_refcnt_8h.html#aa7716d29a6749d766b19b8b880b448f1">MOZ_COUNT_CTOR</a>(<a class="code" href="../../de/d99/classgfx_glyph_extents.html">gfxGlyphExtents</a>);
<a name="l01149"></a>01149         mTightGlyphExtents.Init();
<a name="l01150"></a>01150     }
<a name="l01151"></a>01151     ~<a class="code" href="../../de/d99/classgfx_glyph_extents.html">gfxGlyphExtents</a>();
<a name="l01152"></a>01152 
<a name="l01153"></a><a class="code" href="../../de/d99/classgfx_glyph_extents.html#add32d527c4d0fd9d609303b6e462da79acee0009643724b7c7c04d50b0f5bfb65">01153</a>     <span class="keyword">enum</span> { INVALID_WIDTH = 0xFFFF };
<a name="l01154"></a>01154 
<a name="l01155"></a>01155     <span class="comment">// returns INVALID_WIDTH =&gt; not a contained glyph</span>
<a name="l01156"></a>01156     <span class="comment">// Otherwise the glyph has no before-bearing or vertical bearings,</span>
<a name="l01157"></a>01157     <span class="comment">// and the result is its width measured from the baseline origin, in</span>
<a name="l01158"></a>01158     <span class="comment">// appunits.</span>
<a name="l01159"></a><a class="code" href="../../de/d99/classgfx_glyph_extents.html#a1b20c4a2c5b5a59550d8355c6a692bac">01159</a>     uint16_t <a class="code" href="../../de/d99/classgfx_glyph_extents.html#a1b20c4a2c5b5a59550d8355c6a692bac">GetContainedGlyphWidthAppUnits</a>(uint32_t aGlyphID)<span class="keyword"> const </span>{
<a name="l01160"></a>01160         <span class="keywordflow">return</span> mContainedGlyphWidths.Get(aGlyphID);
<a name="l01161"></a>01161     }
<a name="l01162"></a>01162 
<a name="l01163"></a><a class="code" href="../../de/d99/classgfx_glyph_extents.html#ad044639113632591fc426e7ef4e6c2d2">01163</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d99/classgfx_glyph_extents.html#ad044639113632591fc426e7ef4e6c2d2">IsGlyphKnown</a>(uint32_t aGlyphID)<span class="keyword"> const </span>{
<a name="l01164"></a>01164         <span class="keywordflow">return</span> mContainedGlyphWidths.Get(aGlyphID) != INVALID_WIDTH ||
<a name="l01165"></a>01165             mTightGlyphExtents.GetEntry(aGlyphID) != <span class="keyword">nullptr</span>;
<a name="l01166"></a>01166     }
<a name="l01167"></a>01167 
<a name="l01168"></a><a class="code" href="../../de/d99/classgfx_glyph_extents.html#afb5fec150a3c1db1912bbfe6c6848ca7">01168</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d99/classgfx_glyph_extents.html#afb5fec150a3c1db1912bbfe6c6848ca7">IsGlyphKnownWithTightExtents</a>(uint32_t aGlyphID)<span class="keyword"> const </span>{
<a name="l01169"></a>01169         <span class="keywordflow">return</span> mTightGlyphExtents.GetEntry(aGlyphID) != <span class="keyword">nullptr</span>;
<a name="l01170"></a>01170     }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172     <span class="comment">// Get glyph extents; a rectangle relative to the left baseline origin</span>
<a name="l01173"></a>01173     <span class="comment">// Returns true on success. Can fail on OOM or when aContext is null</span>
<a name="l01174"></a>01174     <span class="comment">// and extents were not (successfully) prefetched.</span>
<a name="l01175"></a>01175     <span class="keywordtype">bool</span> GetTightGlyphExtentsAppUnits(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont, <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l01176"></a>01176             uint32_t aGlyphID, <a class="code" href="../../de/d69/structgfx_rect.html">gfxRect</a> *aExtents);
<a name="l01177"></a>01177 
<a name="l01178"></a><a class="code" href="../../de/d99/classgfx_glyph_extents.html#a4a35ac331b6e93499fedb7cc3a21f858">01178</a>     <span class="keywordtype">void</span> <a class="code" href="../../de/d99/classgfx_glyph_extents.html#a4a35ac331b6e93499fedb7cc3a21f858">SetContainedGlyphWidthAppUnits</a>(uint32_t aGlyphID, uint16_t aWidth) {
<a name="l01179"></a>01179         mContainedGlyphWidths.Set(aGlyphID, aWidth);
<a name="l01180"></a>01180     }
<a name="l01181"></a>01181     <span class="keywordtype">void</span> SetTightGlyphExtents(uint32_t aGlyphID, <span class="keyword">const</span> <a class="code" href="../../de/d69/structgfx_rect.html">gfxRect</a>&amp; aExtentsAppUnits);
<a name="l01182"></a>01182 
<a name="l01183"></a><a class="code" href="../../de/d99/classgfx_glyph_extents.html#a2dfbbffa344705031606e07a4a47e7b4">01183</a>     int32_t <a class="code" href="../../de/d99/classgfx_glyph_extents.html#a2dfbbffa344705031606e07a4a47e7b4">GetAppUnitsPerDevUnit</a>() { <span class="keywordflow">return</span> mAppUnitsPerDevUnit; }
<a name="l01184"></a>01184 
<a name="l01185"></a>01185     <span class="keywordtype">size_t</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ab5cab932a233f5b8e7e9d4ab573ce1ae">SizeOfExcludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf) <span class="keyword">const</span>;
<a name="l01186"></a>01186     <span class="keywordtype">size_t</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0d234da521191615bfac5564c1648368">SizeOfIncludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf) <span class="keyword">const</span>;
<a name="l01187"></a>01187 
<a name="l01188"></a>01188 <span class="keyword">private</span>:
<a name="l01189"></a>01189     <span class="keyword">class </span>HashEntry : <span class="keyword">public</span> <a class="code" href="../../d6/dc5/classns_uint32_hash_key.html">nsUint32HashKey</a> {
<a name="l01190"></a>01190     <span class="keyword">public</span>:
<a name="l01191"></a>01191         <span class="comment">// When constructing a new entry in the hashtable, we&#39;ll leave this</span>
<a name="l01192"></a>01192         <span class="comment">// blank. The caller of Put() will fill this in.</span>
<a name="l01193"></a>01193         HashEntry(KeyTypePointer aPtr) : <a class="code" href="../../d6/dc5/classns_uint32_hash_key.html">nsUint32HashKey</a>(aPtr) {}
<a name="l01194"></a>01194         HashEntry(<span class="keyword">const</span> HashEntry&amp; toCopy) : <a class="code" href="../../d6/dc5/classns_uint32_hash_key.html">nsUint32HashKey</a>(toCopy) {
<a name="l01195"></a>01195           x = toCopy.x; y = toCopy.y; <a class="code" href="../../d4/d8c/viewphoto_8js.html#adb90f9ed3668a895cc5b90a19bcdee13">width</a> = toCopy.width; <a class="code" href="../../d4/d8c/viewphoto_8js.html#a06f7a63ceb91351a4c31800c9a7af42f">height</a> = toCopy.height;
<a name="l01196"></a>01196         }
<a name="l01197"></a>01197 
<a name="l01198"></a>01198         <span class="keywordtype">float</span> x, y, <a class="code" href="../../d4/d8c/viewphoto_8js.html#adb90f9ed3668a895cc5b90a19bcdee13">width</a>, <a class="code" href="../../d4/d8c/viewphoto_8js.html#a06f7a63ceb91351a4c31800c9a7af42f">height</a>;
<a name="l01199"></a>01199     };
<a name="l01200"></a>01200 
<a name="l01201"></a>01201     <span class="keyword">enum</span> { BLOCK_SIZE_BITS = 7, BLOCK_SIZE = 1 &lt;&lt; BLOCK_SIZE_BITS }; <span class="comment">// 128-glyph blocks</span>
<a name="l01202"></a>01202 
<a name="l01203"></a>01203     <span class="keyword">class </span>GlyphWidths {
<a name="l01204"></a>01204     <span class="keyword">public</span>:
<a name="l01205"></a>01205         <span class="keywordtype">void</span> <a class="code" href="../../d3/df6/namespacemozilla_1_1layers_1_1_compositable_map.html#ae5daaaa149c87001fc1f934f80127072">Set</a>(uint32_t aIndex, uint16_t aValue);
<a name="l01206"></a>01206         uint16_t <a class="code" href="../../d3/df6/namespacemozilla_1_1layers_1_1_compositable_map.html#aa1ea1d81077f56e64cb786155c96cb45">Get</a>(uint32_t aIndex)<span class="keyword"> const </span>{
<a name="l01207"></a>01207             uint32_t block = aIndex &gt;&gt; BLOCK_SIZE_BITS;
<a name="l01208"></a>01208             <span class="keywordflow">if</span> (block &gt;= mBlocks.Length())
<a name="l01209"></a>01209                 <span class="keywordflow">return</span> INVALID_WIDTH;
<a name="l01210"></a>01210             uintptr_t bits = mBlocks[block];
<a name="l01211"></a>01211             <span class="keywordflow">if</span> (!bits)
<a name="l01212"></a>01212                 <span class="keywordflow">return</span> INVALID_WIDTH;
<a name="l01213"></a>01213             uint32_t indexInBlock = aIndex &amp; (BLOCK_SIZE - 1);
<a name="l01214"></a>01214             <span class="keywordflow">if</span> (bits &amp; 0x1) {
<a name="l01215"></a>01215                 <span class="keywordflow">if</span> (GetGlyphOffset(bits) != indexInBlock)
<a name="l01216"></a>01216                     <span class="keywordflow">return</span> INVALID_WIDTH;
<a name="l01217"></a>01217                 <span class="keywordflow">return</span> GetWidth(bits);
<a name="l01218"></a>01218             }
<a name="l01219"></a>01219             uint16_t *widths = <span class="keyword">reinterpret_cast&lt;</span>uint16_t *<span class="keyword">&gt;</span>(bits);
<a name="l01220"></a>01220             <span class="keywordflow">return</span> widths[indexInBlock];
<a name="l01221"></a>01221         }
<a name="l01222"></a>01222 
<a name="l01223"></a>01223         uint32_t <a class="code" href="../../de/d12/classgfx_font_entry.html#ab5cab932a233f5b8e7e9d4ab573ce1ae">SizeOfExcludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf) <span class="keyword">const</span>;
<a name="l01224"></a>01224         
<a name="l01225"></a>01225         ~GlyphWidths();
<a name="l01226"></a>01226 
<a name="l01227"></a>01227     <span class="keyword">private</span>:
<a name="l01228"></a>01228         <span class="keyword">static</span> uint32_t GetGlyphOffset(uintptr_t aBits) {
<a name="l01229"></a>01229             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aBits &amp; 0x1, <span class="stringliteral">&quot;This is really a pointer...&quot;</span>);
<a name="l01230"></a>01230             <span class="keywordflow">return</span> (aBits &gt;&gt; 1) &amp; ((1 &lt;&lt; BLOCK_SIZE_BITS) - 1);
<a name="l01231"></a>01231         }
<a name="l01232"></a>01232         <span class="keyword">static</span> uint32_t GetWidth(uintptr_t aBits) {
<a name="l01233"></a>01233             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aBits &amp; 0x1, <span class="stringliteral">&quot;This is really a pointer...&quot;</span>);
<a name="l01234"></a>01234             <span class="keywordflow">return</span> aBits &gt;&gt; (1 + BLOCK_SIZE_BITS);
<a name="l01235"></a>01235         }
<a name="l01236"></a>01236         <span class="keyword">static</span> uintptr_t MakeSingle(uint32_t aGlyphOffset, uint16_t aWidth) {
<a name="l01237"></a>01237             <span class="keywordflow">return</span> (aWidth &lt;&lt; (1 + BLOCK_SIZE_BITS)) + (aGlyphOffset &lt;&lt; 1) + 1;
<a name="l01238"></a>01238         }
<a name="l01239"></a>01239 
<a name="l01240"></a>01240         <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;uintptr_t&gt;</a> mBlocks;
<a name="l01241"></a>01241     };
<a name="l01242"></a>01242 
<a name="l01243"></a>01243     GlyphWidths             mContainedGlyphWidths;
<a name="l01244"></a>01244     <a class="code" href="../../d5/dc3/classns_t_hashtable.html">nsTHashtable&lt;HashEntry&gt;</a> mTightGlyphExtents;
<a name="l01245"></a>01245     int32_t                 mAppUnitsPerDevUnit;
<a name="l01246"></a>01246 };
<a name="l01247"></a>01247 
<a name="l01266"></a><a class="code" href="../../df/d0d/classgfx_font_shaper.html">01266</a> <span class="keyword">class </span><a class="code" href="../../df/d0d/classgfx_font_shaper.html">gfxFontShaper</a> {
<a name="l01267"></a>01267 <span class="keyword">public</span>:
<a name="l01268"></a><a class="code" href="../../df/d0d/classgfx_font_shaper.html#a8e0ae5ebebb18089b3ee00a13670b8a4">01268</a>     <a class="code" href="../../df/d0d/classgfx_font_shaper.html">gfxFontShaper</a>(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont)
<a name="l01269"></a>01269         : mFont(aFont)
<a name="l01270"></a>01270     {
<a name="l01271"></a>01271         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aFont, <span class="stringliteral">&quot;shaper requires a valid font!&quot;</span>);
<a name="l01272"></a>01272     }
<a name="l01273"></a>01273 
<a name="l01274"></a><a class="code" href="../../df/d0d/classgfx_font_shaper.html#a44cb2161520fb7b5497730cc1422e2de">01274</a>     <span class="keyword">virtual</span> <a class="code" href="../../df/d0d/classgfx_font_shaper.html#a44cb2161520fb7b5497730cc1422e2de">~gfxFontShaper</a>() { }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276     <span class="comment">// Shape a piece of text and store the resulting glyph data into</span>
<a name="l01277"></a>01277     <span class="comment">// aShapedText. Parameters aOffset/aLength indicate the range of</span>
<a name="l01278"></a>01278     <span class="comment">// aShapedText to be updated; aLength is also the length of aText.</span>
<a name="l01279"></a>01279     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> ShapeText(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a>      *aContext,
<a name="l01280"></a>01280                            <span class="keyword">const</span> PRUnichar *aText,
<a name="l01281"></a>01281                            uint32_t         aOffset,
<a name="l01282"></a>01282                            uint32_t         aLength,
<a name="l01283"></a>01283                            int32_t          aScript,
<a name="l01284"></a>01284                            <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>   *aShapedText) = 0;
<a name="l01285"></a>01285 
<a name="l01286"></a><a class="code" href="../../df/d0d/classgfx_font_shaper.html#af0ab83dea4b8370bfb2dd5b5996f63b0">01286</a>     <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *<a class="code" href="../../df/d0d/classgfx_font_shaper.html#af0ab83dea4b8370bfb2dd5b5996f63b0">GetFont</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mFont; }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288     <span class="comment">// returns true if features exist in output, false otherwise</span>
<a name="l01289"></a>01289     <span class="keyword">static</span> <span class="keywordtype">bool</span>
<a name="l01290"></a>01290     MergeFontFeatures(<span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *aStyle,
<a name="l01291"></a>01291                       <span class="keyword">const</span> <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;gfxFontFeature&gt;</a>&amp; aFontFeatures,
<a name="l01292"></a>01292                       <span class="keywordtype">bool</span> aDisableLigatures,
<a name="l01293"></a>01293                       <span class="keyword">const</span> nsAString&amp; aFamilyName,
<a name="l01294"></a>01294                       <a class="code" href="../../d4/dfc/classns_data_hashtable.html">nsDataHashtable&lt;nsUint32HashKey,uint32_t&gt;</a>&amp; aMergedFeatures);
<a name="l01295"></a>01295 
<a name="l01296"></a>01296 <span class="keyword">protected</span>:
<a name="l01297"></a>01297     <span class="comment">// the font this shaper is working with</span>
<a name="l01298"></a><a class="code" href="../../df/d0d/classgfx_font_shaper.html#a2d29e2f23fadcbe05c52331ad405842a">01298</a>     <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> * <a class="code" href="../../df/d0d/classgfx_font_shaper.html#a2d29e2f23fadcbe05c52331ad405842a">mFont</a>;
<a name="l01299"></a>01299 };
<a name="l01300"></a>01300 
<a name="l01301"></a>01301 <span class="comment">/* a SPECIFIC single font family */</span>
<a name="l01302"></a><a class="code" href="../../dc/d81/classgfx_font.html">01302</a> <span class="keyword">class </span><a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> {
<a name="l01303"></a>01303 <span class="keyword">public</span>:
<a name="l01304"></a><a class="code" href="../../dc/d81/classgfx_font.html#ac408438cc476f3fcbd0be2410d8cbd81">01304</a>     <a class="code" href="../../d3/dd8/nscore_8h.html#a55d97bea9d9bcf37f34284c3bf447f51">nsrefcnt</a> <a class="code" href="../../dc/d81/classgfx_font.html#ac408438cc476f3fcbd0be2410d8cbd81">AddRef</a>(<span class="keywordtype">void</span>) {
<a name="l01305"></a>01305         <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(int32_t(mRefCnt) &gt;= 0, <span class="stringliteral">&quot;illegal refcnt&quot;</span>);
<a name="l01306"></a>01306         <span class="keywordflow">if</span> (mExpirationState.IsTracked()) {
<a name="l01307"></a>01307             gfxFontCache::GetCache()-&gt;RemoveObject(<span class="keyword">this</span>);
<a name="l01308"></a>01308         }
<a name="l01309"></a>01309         ++mRefCnt;
<a name="l01310"></a>01310         <a class="code" href="../../dc/d1c/ns_trace_refcnt_8h.html#afb83096e600ab5b3c4db5d155ce0b774">NS_LOG_ADDREF</a>(<span class="keyword">this</span>, mRefCnt, <span class="stringliteral">&quot;gfxFont&quot;</span>, <span class="keyword">sizeof</span>(*<span class="keyword">this</span>));
<a name="l01311"></a>01311         <span class="keywordflow">return</span> mRefCnt;
<a name="l01312"></a>01312     }
<a name="l01313"></a><a class="code" href="../../dc/d81/classgfx_font.html#a363f1b05e21587bd093ba638a18e9d0e">01313</a>     <a class="code" href="../../d3/dd8/nscore_8h.html#a55d97bea9d9bcf37f34284c3bf447f51">nsrefcnt</a> <a class="code" href="../../dc/d81/classgfx_font.html#a363f1b05e21587bd093ba638a18e9d0e">Release</a>(<span class="keywordtype">void</span>) {
<a name="l01314"></a>01314         <a class="code" href="../../dc/d6d/ns_debug_8h.html#a3ad5c3d474e430752263e97b6f1378c5">NS_PRECONDITION</a>(0 != mRefCnt, <span class="stringliteral">&quot;dup release&quot;</span>);
<a name="l01315"></a>01315         --mRefCnt;
<a name="l01316"></a>01316         <a class="code" href="../../dc/d1c/ns_trace_refcnt_8h.html#ace98178367a41e5cfebedae29de7e76b">NS_LOG_RELEASE</a>(<span class="keyword">this</span>, mRefCnt, <span class="stringliteral">&quot;gfxFont&quot;</span>);
<a name="l01317"></a>01317         <span class="keywordflow">if</span> (mRefCnt == 0) {
<a name="l01318"></a>01318             NotifyReleased();
<a name="l01319"></a>01319             <span class="comment">// |this| may have been deleted.</span>
<a name="l01320"></a>01320             <span class="keywordflow">return</span> 0;
<a name="l01321"></a>01321         }
<a name="l01322"></a>01322         <span class="keywordflow">return</span> mRefCnt;
<a name="l01323"></a>01323     }
<a name="l01324"></a>01324 
<a name="l01325"></a><a class="code" href="../../dc/d81/classgfx_font.html#ac209587e6b3a92b39e6ac98bc152c2f6">01325</a>     int32_t <a class="code" href="../../dc/d81/classgfx_font.html#ac209587e6b3a92b39e6ac98bc152c2f6">GetRefCount</a>() { <span class="keywordflow">return</span> mRefCnt; }
<a name="l01326"></a>01326 
<a name="l01327"></a>01327     <span class="comment">// options to specify the kind of AA to be used when creating a font</span>
<a name="l01328"></a><a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2">01328</a>     <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l01329"></a><a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2aeb84c34260af76fef28bcf9c49704b98">01329</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2aeb84c34260af76fef28bcf9c49704b98">kAntialiasDefault</a>,
<a name="l01330"></a><a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2a2e34a94c68a01ef71d4779243b1fc41b">01330</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2a2e34a94c68a01ef71d4779243b1fc41b">kAntialiasNone</a>,
<a name="l01331"></a><a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2a1c8610754e10c3799148ed2eb038aa3b">01331</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2a1c8610754e10c3799148ed2eb038aa3b">kAntialiasGrayscale</a>,
<a name="l01332"></a><a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2afd1146ed6367d8cd33e5f2651791e60c">01332</a>         kAntialiasSubpixel
<a name="l01333"></a>01333     } AntialiasOption;
<a name="l01334"></a>01334 
<a name="l01335"></a>01335     <span class="comment">// Options for how the text should be drawn</span>
<a name="l01336"></a><a class="code" href="../../dc/d81/classgfx_font.html#a9b33c26df66150f3fbcaa055744b5ceb">01336</a>     <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l01337"></a>01337         <span class="comment">// GLYPH_FILL and GLYPH_STROKE draw into the current context</span>
<a name="l01338"></a>01338         <span class="comment">//  and may be used together with bitwise OR.</span>
<a name="l01339"></a><a class="code" href="../../dc/d81/classgfx_font.html#a9b33c26df66150f3fbcaa055744b5ceba98a586313caa0b100a164aca09f2e07a">01339</a>         GLYPH_FILL = 1,
<a name="l01340"></a>01340         <span class="comment">// Note: using GLYPH_STROKE will destroy the current path.</span>
<a name="l01341"></a><a class="code" href="../../dc/d81/classgfx_font.html#a9b33c26df66150f3fbcaa055744b5ceba7ffc176f3100659574c057aaf9e130ce">01341</a>         GLYPH_STROKE = 2,
<a name="l01342"></a>01342         <span class="comment">// Appends glyphs to the current path. Can NOT be used with</span>
<a name="l01343"></a>01343         <span class="comment">//  GLYPH_FILL or GLYPH_STROKE.</span>
<a name="l01344"></a><a class="code" href="../../dc/d81/classgfx_font.html#a9b33c26df66150f3fbcaa055744b5ceba2acc5c3ef83fe31090675c70c1f37305">01344</a>         GLYPH_PATH = 4,
<a name="l01345"></a>01345         <span class="comment">// When GLYPH_FILL and GLYPH_STROKE are both set, draws the</span>
<a name="l01346"></a>01346         <span class="comment">//  stroke underneath the fill.</span>
<a name="l01347"></a><a class="code" href="../../dc/d81/classgfx_font.html#a9b33c26df66150f3fbcaa055744b5ceba9e08a1418a4d02040a5555e1245bc51e">01347</a>         GLYPH_STROKE_UNDERNEATH = 8
<a name="l01348"></a>01348     } DrawMode;
<a name="l01349"></a>01349 
<a name="l01350"></a>01350 <span class="keyword">protected</span>:
<a name="l01351"></a><a class="code" href="../../dc/d81/classgfx_font.html#a99e359e5e549614e40979616e703490b">01351</a>     <a class="code" href="../../d2/dc4/classns_auto_ref_cnt.html">nsAutoRefCnt</a> <a class="code" href="../../dc/d81/classgfx_font.html#a99e359e5e549614e40979616e703490b">mRefCnt</a>;
<a name="l01352"></a><a class="code" href="../../dc/d81/classgfx_font.html#a6833c8dd50e1553b0ac4b78c1a3cf057">01352</a>     <a class="code" href="../../d3/d6e/cairo_8h.html#a747b32a64e90d2587d77b034aa6cc481">cairo_scaled_font_t</a> *<a class="code" href="../../dc/d81/classgfx_font.html#a6833c8dd50e1553b0ac4b78c1a3cf057">mScaledFont</a>;
<a name="l01353"></a>01353 
<a name="l01354"></a><a class="code" href="../../dc/d81/classgfx_font.html#a0abd207272fefae3212840de975377b6">01354</a>     <span class="keywordtype">void</span> <a class="code" href="../../dc/d81/classgfx_font.html#a0abd207272fefae3212840de975377b6">NotifyReleased</a>() {
<a name="l01355"></a>01355         gfxFontCache *<a class="code" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a> = gfxFontCache::GetCache();
<a name="l01356"></a>01356         <span class="keywordflow">if</span> (cache) {
<a name="l01357"></a>01357             <span class="comment">// Don&#39;t delete just yet; return the object to the cache for</span>
<a name="l01358"></a>01358             <span class="comment">// possibly recycling within some time limit</span>
<a name="l01359"></a>01359             cache-&gt;NotifyReleased(<span class="keyword">this</span>);
<a name="l01360"></a>01360         } <span class="keywordflow">else</span> {
<a name="l01361"></a>01361             <span class="comment">// The cache may have already been shut down.</span>
<a name="l01362"></a>01362             <span class="keyword">delete</span> <span class="keyword">this</span>;
<a name="l01363"></a>01363         }
<a name="l01364"></a>01364     }
<a name="l01365"></a>01365 
<a name="l01366"></a>01366     <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>(<a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a> *aFontEntry, <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *aFontStyle,
<a name="l01367"></a>01367             AntialiasOption anAAOption = kAntialiasDefault,
<a name="l01368"></a>01368             <a class="code" href="../../d3/d6e/cairo_8h.html#a747b32a64e90d2587d77b034aa6cc481">cairo_scaled_font_t</a> *aScaledFont = <span class="keyword">nullptr</span>);
<a name="l01369"></a>01369 
<a name="l01370"></a>01370 <span class="keyword">public</span>:
<a name="l01371"></a>01371     <span class="keyword">virtual</span> ~<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>();
<a name="l01372"></a>01372 
<a name="l01373"></a><a class="code" href="../../dc/d81/classgfx_font.html#a0c8254fd2a8c4aeddc27ef0cf165d6d1">01373</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a0c8254fd2a8c4aeddc27ef0cf165d6d1">Valid</a>()<span class="keyword"> const </span>{
<a name="l01374"></a>01374         <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a68ebbe88e0deffe64ca9c73891922b5a">mIsValid</a>;
<a name="l01375"></a>01375     }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377     <span class="comment">// options for the kind of bounding box to return from measurement</span>
<a name="l01378"></a><a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1">01378</a>     <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l01379"></a><a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1affbccfdc4cd9ce81091e97c6f7a17859">01379</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1affbccfdc4cd9ce81091e97c6f7a17859">LOOSE_INK_EXTENTS</a>,
<a name="l01380"></a>01380             <span class="comment">// A box that encloses all the painted pixels, and may</span>
<a name="l01381"></a>01381             <span class="comment">// include sidebearings and/or additional ascent/descent</span>
<a name="l01382"></a>01382             <span class="comment">// within the glyph cell even if the ink is smaller.</span>
<a name="l01383"></a><a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1afd002dcdcbe6bd3269769c242cb1ae49">01383</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1afd002dcdcbe6bd3269769c242cb1ae49">TIGHT_INK_EXTENTS</a>,
<a name="l01384"></a>01384             <span class="comment">// A box that tightly encloses all the painted pixels</span>
<a name="l01385"></a>01385             <span class="comment">// (although actually on Windows, at least, it may be</span>
<a name="l01386"></a>01386             <span class="comment">// slightly larger than strictly necessary because</span>
<a name="l01387"></a>01387             <span class="comment">// we can&#39;t get precise extents with ClearType).</span>
<a name="l01388"></a><a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1a172ea1cd79b8a4133847ee0782109020">01388</a>         TIGHT_HINTED_OUTLINE_EXTENTS
<a name="l01389"></a>01389             <span class="comment">// A box that tightly encloses the glyph outline,</span>
<a name="l01390"></a>01390             <span class="comment">// ignoring possible antialiasing pixels that extend</span>
<a name="l01391"></a>01391             <span class="comment">// beyond this.</span>
<a name="l01392"></a>01392             <span class="comment">// NOTE: The default implementation of gfxFont::Measure(),</span>
<a name="l01393"></a>01393             <span class="comment">// which works with the glyph extents cache, does not</span>
<a name="l01394"></a>01394             <span class="comment">// differentiate between this and TIGHT_INK_EXTENTS.</span>
<a name="l01395"></a>01395             <span class="comment">// Whether the distinction is important depends on the</span>
<a name="l01396"></a>01396             <span class="comment">// antialiasing behavior of the platform; currently the</span>
<a name="l01397"></a>01397             <span class="comment">// distinction is only implemented in the gfxWindowsFont</span>
<a name="l01398"></a>01398             <span class="comment">// subclass, because of ClearType&#39;s tendency to paint</span>
<a name="l01399"></a>01399             <span class="comment">// outside the hinted outline.</span>
<a name="l01400"></a>01400             <span class="comment">// Also NOTE: it is relatively expensive to request this,</span>
<a name="l01401"></a>01401             <span class="comment">// as it does not use cached glyph extents in the font.</span>
<a name="l01402"></a>01402     } BoundingBoxType;
<a name="l01403"></a>01403 
<a name="l01404"></a><a class="code" href="../../dc/d81/classgfx_font.html#a60110587b843ea9effe95de405c8e817">01404</a>     <span class="keyword">const</span> nsString&amp; <a class="code" href="../../dc/d81/classgfx_font.html#a60110587b843ea9effe95de405c8e817">GetName</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mFontEntry-&gt;Name(); }
<a name="l01405"></a><a class="code" href="../../dc/d81/classgfx_font.html#a3b5b8d82f4de81a6da2fe38d62e8e60d">01405</a>     <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *<a class="code" href="../../dc/d81/classgfx_font.html#a3b5b8d82f4de81a6da2fe38d62e8e60d">GetStyle</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> &amp;mStyle; }
<a name="l01406"></a>01406 
<a name="l01407"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8db6ebd1574f73bef01a1502f152e9ee">01407</a>     <span class="keyword">virtual</span> <a class="code" href="../../d3/d6e/cairo_8h.html#a747b32a64e90d2587d77b034aa6cc481">cairo_scaled_font_t</a>* <a class="code" href="../../dc/d81/classgfx_font.html#a8db6ebd1574f73bef01a1502f152e9ee">GetCairoScaledFont</a>() { <span class="keywordflow">return</span> mScaledFont; }
<a name="l01408"></a>01408 
<a name="l01409"></a><a class="code" href="../../dc/d81/classgfx_font.html#a3cb724d2fcb2c673f73b85d0c0c11515">01409</a>     <span class="keyword">virtual</span> <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>* <a class="code" href="../../dc/d81/classgfx_font.html#a3cb724d2fcb2c673f73b85d0c0c11515">CopyWithAntialiasOption</a>(<a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2">AntialiasOption</a> anAAOption) {
<a name="l01410"></a>01410         <span class="comment">// platforms where this actually matters should override</span>
<a name="l01411"></a>01411         <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l01412"></a>01412     }
<a name="l01413"></a>01413 
<a name="l01414"></a><a class="code" href="../../dc/d81/classgfx_font.html#acf20688c59c5bf7874c2cd5208ccb46e">01414</a>     <span class="keyword">virtual</span> <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d81/classgfx_font.html#acf20688c59c5bf7874c2cd5208ccb46e">GetAdjustedSize</a>() {
<a name="l01415"></a>01415         <span class="keywordflow">return</span> mAdjustedSize &gt; 0.0 ? mAdjustedSize : mStyle.size;
<a name="l01416"></a>01416     }
<a name="l01417"></a>01417 
<a name="l01418"></a><a class="code" href="../../dc/d81/classgfx_font.html#a90aead7bc91393666d909b2dfb31e729">01418</a>     <span class="keywordtype">float</span> <a class="code" href="../../dc/d81/classgfx_font.html#a90aead7bc91393666d909b2dfb31e729">FUnitsToDevUnitsFactor</a>()<span class="keyword"> const </span>{
<a name="l01419"></a>01419         <span class="comment">// check this was set up during font initialization</span>
<a name="l01420"></a>01420         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(mFUnitsConvFactor &gt; 0.0<a class="code" href="../../d3/d4b/lockscreen_8js.html#a9cf09a2972472098a4c689fd988f4dfc">f</a>, <span class="stringliteral">&quot;mFUnitsConvFactor not valid&quot;</span>);
<a name="l01421"></a>01421         <span class="keywordflow">return</span> mFUnitsConvFactor;
<a name="l01422"></a>01422     }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424     <span class="comment">// check whether this is an sfnt we can potentially use with harfbuzz</span>
<a name="l01425"></a><a class="code" href="../../dc/d81/classgfx_font.html#ae62464a356a97b5d49d39de507e98cbb">01425</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#ae62464a356a97b5d49d39de507e98cbb">FontCanSupportHarfBuzz</a>() {
<a name="l01426"></a>01426         <span class="keywordflow">return</span> mFontEntry-&gt;HasCmapTable();
<a name="l01427"></a>01427     }
<a name="l01428"></a>01428 
<a name="l01429"></a>01429     <span class="comment">// check whether this is an sfnt we can potentially use with Graphite</span>
<a name="l01430"></a><a class="code" href="../../dc/d81/classgfx_font.html#a6ab74b0ff2acd4783b44d2b47d3d78ba">01430</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a6ab74b0ff2acd4783b44d2b47d3d78ba">FontCanSupportGraphite</a>() {
<a name="l01431"></a>01431         <span class="keywordflow">return</span> mFontEntry-&gt;HasGraphiteTables();
<a name="l01432"></a>01432     }
<a name="l01433"></a>01433 
<a name="l01434"></a>01434     <span class="comment">// Subclasses may choose to look up glyph ids for characters.</span>
<a name="l01435"></a>01435     <span class="comment">// If they do not override this, gfxHarfBuzzShaper will fetch the cmap</span>
<a name="l01436"></a>01436     <span class="comment">// table and use that.</span>
<a name="l01437"></a><a class="code" href="../../dc/d81/classgfx_font.html#a2fb7b087d3187c959c15bf7c6d1ff600">01437</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a2fb7b087d3187c959c15bf7c6d1ff600">ProvidesGetGlyph</a>()<span class="keyword"> const </span>{
<a name="l01438"></a>01438         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01439"></a>01439     }
<a name="l01440"></a>01440     <span class="comment">// Map unicode character to glyph ID.</span>
<a name="l01441"></a>01441     <span class="comment">// Only used if ProvidesGetGlyph() returns true.</span>
<a name="l01442"></a><a class="code" href="../../dc/d81/classgfx_font.html#a66ec3486a26f5c180ef3dec567b9023f">01442</a>     <span class="keyword">virtual</span> uint32_t <a class="code" href="../../dc/d81/classgfx_font.html#a66ec3486a26f5c180ef3dec567b9023f">GetGlyph</a>(uint32_t unicode, uint32_t variation_selector) {
<a name="l01443"></a>01443         <span class="keywordflow">return</span> 0;
<a name="l01444"></a>01444     }
<a name="l01445"></a>01445 
<a name="l01446"></a>01446     <span class="comment">// subclasses may provide (possibly hinted) glyph widths (in font units);</span>
<a name="l01447"></a>01447     <span class="comment">// if they do not override this, harfbuzz will use unhinted widths</span>
<a name="l01448"></a>01448     <span class="comment">// derived from the font tables</span>
<a name="l01449"></a><a class="code" href="../../dc/d81/classgfx_font.html#a2ceddde6eba0694f86a0fdd26fc454f1">01449</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a2ceddde6eba0694f86a0fdd26fc454f1">ProvidesGlyphWidths</a>() {
<a name="l01450"></a>01450         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01451"></a>01451     }
<a name="l01452"></a>01452 
<a name="l01453"></a>01453     <span class="comment">// The return value is interpreted as a horizontal advance in 16.16 fixed</span>
<a name="l01454"></a>01454     <span class="comment">// point format.</span>
<a name="l01455"></a><a class="code" href="../../dc/d81/classgfx_font.html#a076f52cfe82ab34fdef3d4c331120984">01455</a>     <span class="keyword">virtual</span> int32_t <a class="code" href="../../dc/d81/classgfx_font.html#a076f52cfe82ab34fdef3d4c331120984">GetGlyphWidth</a>(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aCtx, uint16_t aGID) {
<a name="l01456"></a>01456         <span class="keywordflow">return</span> -1;
<a name="l01457"></a>01457     }
<a name="l01458"></a>01458 
<a name="l01459"></a>01459     <span class="comment">// Return Azure GlyphRenderingOptions for drawing this font.</span>
<a name="l01460"></a>01460     <span class="keyword">virtual</span> <a class="code" href="../../dd/d63/classmozilla_1_1_temporary_ref.html">mozilla::TemporaryRef&lt;mozilla::gfx::GlyphRenderingOptions&gt;</a>
<a name="l01461"></a><a class="code" href="../../dc/d81/classgfx_font.html#ab95513c42de1528debae6d17a59f1427">01461</a>       <a class="code" href="../../dc/d81/classgfx_font.html#ab95513c42de1528debae6d17a59f1427">GetGlyphRenderingOptions</a>() { <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; }
<a name="l01462"></a>01462 
<a name="l01463"></a>01463     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> SynthesizeSpaceWidth(uint32_t aCh);
<a name="l01464"></a>01464 
<a name="l01465"></a>01465     <span class="comment">// Font metrics</span>
<a name="l01466"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html">01466</a>     <span class="keyword">struct </span><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html">Metrics</a> {
<a name="l01467"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a63bdd4d8db79d15609bee88fd925fe00">01467</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a63bdd4d8db79d15609bee88fd925fe00">xHeight</a>;
<a name="l01468"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a2375953c849777da4d9f7f8a569a1951">01468</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a2375953c849777da4d9f7f8a569a1951">superscriptOffset</a>;
<a name="l01469"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#aa14e0cc821f2d8be0aa8277b3467c7e2">01469</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#aa14e0cc821f2d8be0aa8277b3467c7e2">subscriptOffset</a>;
<a name="l01470"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#abdb0cb96e0e028486d38cbbe3b0e70a5">01470</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#abdb0cb96e0e028486d38cbbe3b0e70a5">strikeoutSize</a>;
<a name="l01471"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a937c6a16666383174b663ed43dcc2e47">01471</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a937c6a16666383174b663ed43dcc2e47">strikeoutOffset</a>;
<a name="l01472"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a486b7b7b24f22eba1978067ce3085a51">01472</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a486b7b7b24f22eba1978067ce3085a51">underlineSize</a>;
<a name="l01473"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a8917542ba830c3dcac325ae90ee5e64c">01473</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a8917542ba830c3dcac325ae90ee5e64c">underlineOffset</a>;
<a name="l01474"></a>01474 
<a name="l01475"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#aaf331c8a2ef299a048b6538762c7fa4e">01475</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#aaf331c8a2ef299a048b6538762c7fa4e">internalLeading</a>;
<a name="l01476"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#ab024399739981c09cdff3678d5f0dd24">01476</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#ab024399739981c09cdff3678d5f0dd24">externalLeading</a>;
<a name="l01477"></a>01477 
<a name="l01478"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a38b92b970f49099d4d074568795e4ace">01478</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a38b92b970f49099d4d074568795e4ace">emHeight</a>;
<a name="l01479"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a96b1d2b1de53201823298c9363141611">01479</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a96b1d2b1de53201823298c9363141611">emAscent</a>;
<a name="l01480"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#ac3536bce1ca1a42a90b62b4e485f6827">01480</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#ac3536bce1ca1a42a90b62b4e485f6827">emDescent</a>;
<a name="l01481"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#aec0a1610a541c399811e3e26a9dae6cf">01481</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#aec0a1610a541c399811e3e26a9dae6cf">maxHeight</a>;
<a name="l01482"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#af877467dc1302a7fcf32eaaae6821685">01482</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#af877467dc1302a7fcf32eaaae6821685">maxAscent</a>;
<a name="l01483"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a89e45e61ebb2a205eb78c21cd9db22a9">01483</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a89e45e61ebb2a205eb78c21cd9db22a9">maxDescent</a>;
<a name="l01484"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a39d2cda936e3ebe5cd319da274c54644">01484</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a39d2cda936e3ebe5cd319da274c54644">maxAdvance</a>;
<a name="l01485"></a>01485 
<a name="l01486"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a898d8b108581937661cdba3663ab0283">01486</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a898d8b108581937661cdba3663ab0283">aveCharWidth</a>;
<a name="l01487"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a0ab27b6ea03e118dc7593404efd1e490">01487</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#a0ab27b6ea03e118dc7593404efd1e490">spaceWidth</a>;
<a name="l01488"></a><a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#ab0eca51e2be67938f8792eb7f7abfc91">01488</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html#ab0eca51e2be67938f8792eb7f7abfc91">zeroOrAveCharWidth</a>;  <span class="comment">// width of &#39;0&#39;, or if there is</span>
<a name="l01489"></a>01489                                       <span class="comment">// no &#39;0&#39; glyph in this font,</span>
<a name="l01490"></a>01490                                       <span class="comment">// equal to .aveCharWidth</span>
<a name="l01491"></a>01491     };
<a name="l01492"></a>01492     <span class="keyword">virtual</span> <span class="keyword">const</span> <a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html">gfxFont::Metrics</a>&amp; GetMetrics() = 0;
<a name="l01493"></a>01493 
<a name="l01502"></a><a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html">01502</a>     <span class="keyword">struct </span><a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html">Spacing</a> {
<a name="l01503"></a><a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html#af34780fe9cbd22fe4663c2c979b508a3">01503</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html#af34780fe9cbd22fe4663c2c979b508a3">mBefore</a>;
<a name="l01504"></a><a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html#a773d85e8a8a1e7612f1880b5ff1d0299">01504</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html#a773d85e8a8a1e7612f1880b5ff1d0299">mAfter</a>;
<a name="l01505"></a>01505     };
<a name="l01509"></a><a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html">01509</a>     <span class="keyword">struct </span><a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html">RunMetrics</a> {
<a name="l01510"></a><a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#a02bc541b0c6eeccb037a85ec3ea56392">01510</a>         <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#a02bc541b0c6eeccb037a85ec3ea56392">RunMetrics</a>() {
<a name="l01511"></a>01511             mAdvanceWidth = mAscent = mDescent = 0.0;
<a name="l01512"></a>01512         }
<a name="l01513"></a>01513 
<a name="l01514"></a>01514         <span class="keywordtype">void</span> CombineWith(<span class="keyword">const</span> <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html">RunMetrics</a>&amp; aOther, <span class="keywordtype">bool</span> aOtherIsOnLeft);
<a name="l01515"></a>01515 
<a name="l01516"></a>01516         <span class="comment">// can be negative (partly due to negative spacing).</span>
<a name="l01517"></a>01517         <span class="comment">// Advance widths should be additive: the advance width of the</span>
<a name="l01518"></a>01518         <span class="comment">// (offset1, length1) plus the advance width of (offset1 + length1,</span>
<a name="l01519"></a>01519         <span class="comment">// length2) should be the advance width of (offset1, length1 + length2)</span>
<a name="l01520"></a><a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#a11771709a967660ecd9eb3052e306a27">01520</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#a11771709a967660ecd9eb3052e306a27">mAdvanceWidth</a>;
<a name="l01521"></a>01521         
<a name="l01522"></a>01522         <span class="comment">// For zero-width substrings, these must be zero!</span>
<a name="l01523"></a><a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#a7d32a4a3db4175874c32d2e94686918d">01523</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#a7d32a4a3db4175874c32d2e94686918d">mAscent</a>;  <span class="comment">// always non-negative</span>
<a name="l01524"></a><a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#a71ae6bec1d6e39bb380bdb0cf72e38e2">01524</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#a71ae6bec1d6e39bb380bdb0cf72e38e2">mDescent</a>; <span class="comment">// always non-negative</span>
<a name="l01525"></a>01525         
<a name="l01526"></a>01526         <span class="comment">// Bounding box that is guaranteed to include everything drawn.</span>
<a name="l01527"></a>01527         <span class="comment">// If a tight boundingBox was requested when these metrics were</span>
<a name="l01528"></a>01528         <span class="comment">// generated, this will tightly wrap the glyphs, otherwise it is</span>
<a name="l01529"></a>01529         <span class="comment">// &quot;loose&quot; and may be larger than the true bounding box.</span>
<a name="l01530"></a>01530         <span class="comment">// Coordinates are relative to the baseline left origin, so typically</span>
<a name="l01531"></a>01531         <span class="comment">// mBoundingBox.y == -mAscent</span>
<a name="l01532"></a><a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#ab5a70f34766dd77e548c444faf08a40e">01532</a>         <a class="code" href="../../de/d69/structgfx_rect.html">gfxRect</a>  <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html#ab5a70f34766dd77e548c444faf08a40e">mBoundingBox</a>;
<a name="l01533"></a>01533     };
<a name="l01534"></a>01534 
<a name="l01561"></a>01561     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Draw(<a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun, uint32_t aStart, uint32_t aEnd,
<a name="l01562"></a>01562                       <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext, <a class="code" href="../../dc/d81/classgfx_font.html#a9b33c26df66150f3fbcaa055744b5ceb">DrawMode</a> aDrawMode, <a class="code" href="../../d6/dfb/structgfx_point.html">gfxPoint</a> *aBaselineOrigin,
<a name="l01563"></a>01563                       <a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html">Spacing</a> *aSpacing, <a class="code" href="../../d2/d0c/classgfx_text_object_paint.html">gfxTextObjectPaint</a> *aObjectPaint,
<a name="l01564"></a>01564                       <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">gfxTextRunDrawCallbacks</a> *aCallbacks);
<a name="l01565"></a>01565 
<a name="l01587"></a>01587     <span class="keyword">virtual</span> <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html">RunMetrics</a> Measure(<a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun,
<a name="l01588"></a>01588                                uint32_t aStart, uint32_t aEnd,
<a name="l01589"></a>01589                                <a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1">BoundingBoxType</a> aBoundingBoxType,
<a name="l01590"></a>01590                                <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContextForTightBoundingBox,
<a name="l01591"></a>01591                                <a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html">Spacing</a> *aSpacing);
<a name="l01597"></a><a class="code" href="../../dc/d81/classgfx_font.html#a4bd7b2483a0971f3ca3f849cb56d588e">01597</a>     <span class="keywordtype">bool</span> NotifyLineBreaksChanged(<a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun,
<a name="l01598"></a>01598                                    uint32_t aStart, uint32_t aLength)
<a name="l01599"></a>01599     { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601     <span class="comment">// Expiration tracking</span>
<a name="l01602"></a><a class="code" href="../../dc/d81/classgfx_font.html#ac2b8ca75b08f270d90486948f1a209c4">01602</a>     <a class="code" href="../../d9/d67/structns_expiration_state.html">nsExpirationState</a> *<a class="code" href="../../dc/d81/classgfx_font.html#ac2b8ca75b08f270d90486948f1a209c4">GetExpirationState</a>() { <span class="keywordflow">return</span> &amp;mExpirationState; }
<a name="l01603"></a>01603 
<a name="l01604"></a>01604     <span class="comment">// Get the glyphID of a space</span>
<a name="l01605"></a>01605     <span class="keyword">virtual</span> uint32_t GetSpaceGlyph() = 0;
<a name="l01606"></a>01606 
<a name="l01607"></a>01607     <a class="code" href="../../de/d99/classgfx_glyph_extents.html">gfxGlyphExtents</a> *GetOrCreateGlyphExtents(int32_t aAppUnitsPerDevUnit);
<a name="l01608"></a>01608 
<a name="l01609"></a>01609     <span class="comment">// You need to call SetupCairoFont on the aCR just before calling this</span>
<a name="l01610"></a>01610     <span class="keyword">virtual</span> <span class="keywordtype">void</span> SetupGlyphExtents(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext, uint32_t aGlyphID,
<a name="l01611"></a>01611                                    <span class="keywordtype">bool</span> aNeedTight, <a class="code" href="../../de/d99/classgfx_glyph_extents.html">gfxGlyphExtents</a> *aExtents);
<a name="l01612"></a>01612 
<a name="l01613"></a>01613     <span class="comment">// This is called by the default Draw() implementation above.</span>
<a name="l01614"></a>01614     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SetupCairoFont(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext) = 0;
<a name="l01615"></a>01615 
<a name="l01616"></a><a class="code" href="../../dc/d81/classgfx_font.html#a0e8efb5d368370fe733082ff7c572e07">01616</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a0e8efb5d368370fe733082ff7c572e07">AllowSubpixelAA</a>() { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l01617"></a>01617 
<a name="l01618"></a><a class="code" href="../../dc/d81/classgfx_font.html#a990cd5c0f9a349ae02cb03841102cc25">01618</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a990cd5c0f9a349ae02cb03841102cc25">IsSyntheticBold</a>() { <span class="keywordflow">return</span> mApplySyntheticBold; }
<a name="l01619"></a>01619 
<a name="l01620"></a>01620     <span class="comment">// Amount by which synthetic bold &quot;fattens&quot; the glyphs:</span>
<a name="l01621"></a>01621     <span class="comment">// For size S up to a threshold size T, we use (0.25 + 3S / 4T),</span>
<a name="l01622"></a>01622     <span class="comment">// so that the result ranges from 0.25 to 1.0; thereafter,</span>
<a name="l01623"></a>01623     <span class="comment">// simply use (S / T).</span>
<a name="l01624"></a><a class="code" href="../../dc/d81/classgfx_font.html#a589e499142a6315a29132b5d0246ae9b">01624</a>     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dc/d81/classgfx_font.html#a589e499142a6315a29132b5d0246ae9b">GetSyntheticBoldOffset</a>() {
<a name="l01625"></a>01625         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a6d7e27eaec1e5f6600e65858be43c18b">size</a> = GetAdjustedSize();
<a name="l01626"></a>01626         <span class="keyword">const</span> <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> threshold = 48.0;
<a name="l01627"></a>01627         <span class="keywordflow">return</span> size &lt; threshold ? (0.25 + 0.75 * size / threshold) :
<a name="l01628"></a>01628                                   (size / threshold);
<a name="l01629"></a>01629     }
<a name="l01630"></a>01630 
<a name="l01631"></a><a class="code" href="../../dc/d81/classgfx_font.html#a75d22d0c6b4b961be08421bd4503b0d2">01631</a>     <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a> *<a class="code" href="../../dc/d81/classgfx_font.html#a75d22d0c6b4b961be08421bd4503b0d2">GetFontEntry</a>() { <span class="keywordflow">return</span> mFontEntry.get(); }
<a name="l01632"></a><a class="code" href="../../dc/d81/classgfx_font.html#a7325e120f748955bffad477505b1de86">01632</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a7325e120f748955bffad477505b1de86">HasCharacter</a>(uint32_t ch) {
<a name="l01633"></a>01633         <span class="keywordflow">if</span> (!<a class="code" href="../../de/d12/classgfx_font_entry.html#a68ebbe88e0deffe64ca9c73891922b5a">mIsValid</a>)
<a name="l01634"></a>01634             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01635"></a>01635         <span class="keywordflow">return</span> mFontEntry-&gt;HasCharacter(ch); 
<a name="l01636"></a>01636     }
<a name="l01637"></a>01637 
<a name="l01638"></a><a class="code" href="../../dc/d81/classgfx_font.html#ac08d96912c7cec40c56432a16988f136">01638</a>     uint16_t <a class="code" href="../../dc/d81/classgfx_font.html#ac08d96912c7cec40c56432a16988f136">GetUVSGlyph</a>(uint32_t aCh, uint32_t aVS) {
<a name="l01639"></a>01639         <span class="keywordflow">if</span> (!<a class="code" href="../../de/d12/classgfx_font_entry.html#a68ebbe88e0deffe64ca9c73891922b5a">mIsValid</a>) {
<a name="l01640"></a>01640             <span class="keywordflow">return</span> 0;
<a name="l01641"></a>01641         }
<a name="l01642"></a>01642         <span class="keywordflow">return</span> mFontEntry-&gt;GetUVSGlyph(aCh, aVS); 
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644 
<a name="l01645"></a>01645     <span class="comment">// call the (virtual) InitTextRun method to do glyph generation/shaping,</span>
<a name="l01646"></a>01646     <span class="comment">// limiting the length of text passed by processing the run in multiple</span>
<a name="l01647"></a>01647     <span class="comment">// segments if necessary</span>
<a name="l01648"></a>01648     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l01649"></a>01649     <span class="keywordtype">bool</span> SplitAndInitTextRun(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l01650"></a>01650                              <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun,
<a name="l01651"></a>01651                              <span class="keyword">const</span> T *aString,
<a name="l01652"></a>01652                              uint32_t aRunStart,
<a name="l01653"></a>01653                              uint32_t aRunLength,
<a name="l01654"></a>01654                              int32_t aRunScript);
<a name="l01655"></a>01655 
<a name="l01656"></a>01656     <span class="comment">// Get a ShapedWord representing the given text (either 8- or 16-bit)</span>
<a name="l01657"></a>01657     <span class="comment">// for use in setting up a gfxTextRun.</span>
<a name="l01658"></a>01658     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l01659"></a>01659     <a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>* GetShapedWord(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l01660"></a>01660                                  <span class="keyword">const</span> T *aText,
<a name="l01661"></a>01661                                  uint32_t aLength,
<a name="l01662"></a>01662                                  uint32_t aHash,
<a name="l01663"></a>01663                                  int32_t aRunScript,
<a name="l01664"></a>01664                                  int32_t aAppUnitsPerDevUnit,
<a name="l01665"></a>01665                                  uint32_t aFlags);
<a name="l01666"></a>01666 
<a name="l01667"></a>01667     <span class="comment">// Ensure the ShapedWord cache is initialized. This MUST be called before</span>
<a name="l01668"></a>01668     <span class="comment">// any attempt to use GetShapedWord().</span>
<a name="l01669"></a><a class="code" href="../../dc/d81/classgfx_font.html#a3c0f1d39bb0de1172aed8270b13e38bd">01669</a>     <span class="keywordtype">void</span> <a class="code" href="../../dc/d81/classgfx_font.html#a3c0f1d39bb0de1172aed8270b13e38bd">InitWordCache</a>() {
<a name="l01670"></a>01670         <span class="keywordflow">if</span> (!mWordCache.IsInitialized()) {
<a name="l01671"></a>01671             mWordCache.Init();
<a name="l01672"></a>01672         }
<a name="l01673"></a>01673     }
<a name="l01674"></a>01674 
<a name="l01675"></a>01675     <span class="comment">// Called by the gfxFontCache timer to increment the age of all the words,</span>
<a name="l01676"></a>01676     <span class="comment">// so that they&#39;ll expire after a sufficient period of non-use</span>
<a name="l01677"></a><a class="code" href="../../dc/d81/classgfx_font.html#a5ec9a92f4322147afa0adae82b8a34ed">01677</a>     <span class="keywordtype">void</span> <a class="code" href="../../dc/d81/classgfx_font.html#a5ec9a92f4322147afa0adae82b8a34ed">AgeCachedWords</a>() {
<a name="l01678"></a>01678         <span class="keywordflow">if</span> (mWordCache.IsInitialized()) {
<a name="l01679"></a>01679             (<a class="code" href="../../d4/da9/png_8h.html#ab30926da86712184b070e550789f8bf7">void</a>)mWordCache.EnumerateEntries(AgeCacheEntry, <span class="keyword">this</span>);
<a name="l01680"></a>01680         }
<a name="l01681"></a>01681     }
<a name="l01682"></a>01682 
<a name="l01683"></a>01683     <span class="comment">// Discard all cached word records; called on memory-pressure notification.</span>
<a name="l01684"></a><a class="code" href="../../dc/d81/classgfx_font.html#a868595b8f102bb976713010d3f294b49">01684</a>     <span class="keywordtype">void</span> <a class="code" href="../../dc/d81/classgfx_font.html#a868595b8f102bb976713010d3f294b49">ClearCachedWords</a>() {
<a name="l01685"></a>01685         <span class="keywordflow">if</span> (mWordCache.IsInitialized()) {
<a name="l01686"></a>01686             mWordCache.Clear();
<a name="l01687"></a>01687         }
<a name="l01688"></a>01688     }
<a name="l01689"></a>01689 
<a name="l01690"></a>01690     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ab5cab932a233f5b8e7e9d4ab573ce1ae">SizeOfExcludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf,
<a name="l01691"></a>01691                                      <a class="code" href="../../df/d0d/struct_font_cache_sizes.html">FontCacheSizes</a>*   aSizes) <span class="keyword">const</span>;
<a name="l01692"></a>01692     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0d234da521191615bfac5564c1648368">SizeOfIncludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf,
<a name="l01693"></a>01693                                      <a class="code" href="../../df/d0d/struct_font_cache_sizes.html">FontCacheSizes</a>*   aSizes) <span class="keyword">const</span>;
<a name="l01694"></a>01694 
<a name="l01695"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80eb">01695</a>     <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l01696"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80ebabb7f83f8ae9fe389e3d49330643015f2">01696</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80ebabb7f83f8ae9fe389e3d49330643015f2">FONT_TYPE_DWRITE</a>,
<a name="l01697"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80ebaf17743cb3734fc3919d800706c746db0">01697</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80ebaf17743cb3734fc3919d800706c746db0">FONT_TYPE_GDI</a>,
<a name="l01698"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80eba3fb6492f3c5c2be04e664646b405f7cc">01698</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80eba3fb6492f3c5c2be04e664646b405f7cc">FONT_TYPE_FT2</a>,
<a name="l01699"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80eba7e8c82c6ff082087f4dd577522479932">01699</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80eba7e8c82c6ff082087f4dd577522479932">FONT_TYPE_MAC</a>,
<a name="l01700"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80ebab7d3be4d35ac4c1b8dfb203254b527c3">01700</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80ebab7d3be4d35ac4c1b8dfb203254b527c3">FONT_TYPE_OS2</a>,
<a name="l01701"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8c8f90c8344518cc0be578a7f2ed80ebab82bd3342372868e7639cf65950caecb">01701</a>         FONT_TYPE_CAIRO
<a name="l01702"></a>01702     } <a class="code" href="../../da/d8e/namespacemozilla_1_1gfx.html#a7d9ba2ad5737c2b275a2ff023c6daf43">FontType</a>;
<a name="l01703"></a>01703 
<a name="l01704"></a>01704     <span class="keyword">virtual</span> <a class="code" href="../../da/d8e/namespacemozilla_1_1gfx.html#a7d9ba2ad5737c2b275a2ff023c6daf43">FontType</a> GetType() <span class="keyword">const</span> = 0;
<a name="l01705"></a>01705 
<a name="l01706"></a><a class="code" href="../../dc/d81/classgfx_font.html#a667f1b18108db7ab207dfe6d220e24c2">01706</a>     <span class="keyword">virtual</span> <a class="code" href="../../dd/d63/classmozilla_1_1_temporary_ref.html">mozilla::TemporaryRef&lt;mozilla::gfx::ScaledFont&gt;</a> GetScaledFont(<a class="code" href="../../d2/d07/classmozilla_1_1gfx_1_1_draw_target.html">mozilla::gfx::DrawTarget</a> *aTarget)
<a name="l01707"></a>01707     { <span class="keywordflow">return</span> <a class="code" href="../../d5/d19/classgfx_platform.html#a9757975d540764c2a841005f8bae529f">gfxPlatform::GetPlatform</a>()-&gt;<a class="code" href="../../d5/d19/classgfx_platform.html#a13a3885de9fa1436cf1740701ae48aa9">GetScaledFontForFont</a>(aTarget, <span class="keyword">this</span>); }
<a name="l01708"></a>01708 
<a name="l01709"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8ba9f9640de4702524b5394c0e696da8">01709</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a8ba9f9640de4702524b5394c0e696da8">KerningDisabled</a>() {
<a name="l01710"></a>01710         <span class="keywordflow">return</span> mKerningSet &amp;&amp; !mKerningEnabled;
<a name="l01711"></a>01711     }
<a name="l01712"></a>01712 
<a name="l01713"></a>01713 <span class="keyword">protected</span>:
<a name="l01714"></a>01714 
<a name="l01715"></a><a class="code" href="../../dc/d81/classgfx_font.html#a5112d0ec870cf0aed5a4e4ecff143e67">01715</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a5112d0ec870cf0aed5a4e4ecff143e67">HasSubstitutionRulesWithSpaceLookups</a>(int32_t aRunScript) {
<a name="l01716"></a>01716         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(GetFontEntry()-&gt;<a class="code" href="../../de/d12/classgfx_font_entry.html#ae222bd6c415aae836c55b43af327bf2d">mHasSpaceFeaturesInitialized</a>,
<a name="l01717"></a>01717                      <span class="stringliteral">&quot;need to initialize space lookup flags&quot;</span>);
<a name="l01718"></a>01718         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aRunScript &lt; <a class="code" href="../../de/d1b/ns_unicode_script_codes_8h.html#aaad850efd6fac6bef553915ab0c82094aa010957ed5b56df53ab0b1c1c7a26542">MOZ_NUM_SCRIPT_CODES</a>, <span class="stringliteral">&quot;weird script code&quot;</span>);
<a name="l01719"></a>01719         <span class="keywordflow">if</span> (aRunScript == <a class="code" href="../../de/d1b/ns_unicode_script_codes_8h.html#aaad850efd6fac6bef553915ab0c82094a8679dc31c7bc764c4599517d256542a7">MOZ_SCRIPT_INVALID</a> ||
<a name="l01720"></a>01720             aRunScript &gt;= <a class="code" href="../../de/d1b/ns_unicode_script_codes_8h.html#aaad850efd6fac6bef553915ab0c82094aa010957ed5b56df53ab0b1c1c7a26542">MOZ_NUM_SCRIPT_CODES</a>) {
<a name="l01721"></a>01721             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01722"></a>01722         }
<a name="l01723"></a>01723         uint32_t <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> = aRunScript &gt;&gt; 5;
<a name="l01724"></a>01724         uint32_t bit = aRunScript &amp; 0x1f;
<a name="l01725"></a>01725         <span class="keywordflow">return</span> (mFontEntry-&gt;mHasSpaceFeaturesSub[index] &amp; (1 &lt;&lt; bit)) != 0;
<a name="l01726"></a>01726     }
<a name="l01727"></a>01727 
<a name="l01728"></a><a class="code" href="../../dc/d81/classgfx_font.html#a99c7baa87f4602bd898c9d55a66d4b88">01728</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d81/classgfx_font.html#a99c7baa87f4602bd898c9d55a66d4b88">BypassShapedWordCache</a>(int32_t aRunScript) {
<a name="l01729"></a>01729         <span class="comment">// We record the presence of space-dependent features in the font entry</span>
<a name="l01730"></a>01730         <span class="comment">// so that subsequent instantiations for the same font face won&#39;t</span>
<a name="l01731"></a>01731         <span class="comment">// require us to re-check the tables; however, the actual check is done</span>
<a name="l01732"></a>01732         <span class="comment">// by gfxFont because not all font entry subclasses know how to create</span>
<a name="l01733"></a>01733         <span class="comment">// a harfbuzz face for introspection.</span>
<a name="l01734"></a>01734         <span class="keywordflow">if</span> (!mFontEntry-&gt;mHasSpaceFeaturesInitialized) {
<a name="l01735"></a>01735             CheckForFeaturesInvolvingSpace();
<a name="l01736"></a>01736         }
<a name="l01737"></a>01737 
<a name="l01738"></a>01738         <span class="keywordflow">if</span> (!mFontEntry-&gt;mHasSpaceFeatures) {
<a name="l01739"></a>01739             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01740"></a>01740         }
<a name="l01741"></a>01741 
<a name="l01742"></a>01742         <span class="comment">// if font has substitution rules or non-kerning positioning rules</span>
<a name="l01743"></a>01743         <span class="comment">// that involve spaces, bypass</span>
<a name="l01744"></a>01744         <span class="keywordflow">if</span> (HasSubstitutionRulesWithSpaceLookups(aRunScript) ||
<a name="l01745"></a>01745             mFontEntry-&gt;mHasSpaceFeaturesNonKerning ||
<a name="l01746"></a>01746             mFontEntry-&gt;mHasSpaceFeaturesSubDefault) {
<a name="l01747"></a>01747             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01748"></a>01748         }
<a name="l01749"></a>01749 
<a name="l01750"></a>01750         <span class="comment">// if kerning explicitly enabled/disabled via font-feature-settings or</span>
<a name="l01751"></a>01751         <span class="comment">// font-kerning and kerning rules use spaces, only bypass when enabled</span>
<a name="l01752"></a>01752         <span class="keywordflow">if</span> (mKerningSet &amp;&amp; mFontEntry-&gt;mHasSpaceFeaturesKerning) {
<a name="l01753"></a>01753             <span class="keywordflow">return</span> mKerningEnabled;
<a name="l01754"></a>01754         }
<a name="l01755"></a>01755 
<a name="l01756"></a>01756         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01757"></a>01757     }
<a name="l01758"></a>01758 
<a name="l01759"></a>01759     <span class="comment">// For 8-bit text, expand to 16-bit and then call the following method.</span>
<a name="l01760"></a>01760     <span class="keywordtype">bool</span> ShapeText(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a>    *aContext,
<a name="l01761"></a>01761                    <span class="keyword">const</span> uint8_t *aText,
<a name="l01762"></a>01762                    uint32_t       aOffset, <span class="comment">// dest offset in gfxShapedText</span>
<a name="l01763"></a>01763                    uint32_t       aLength,
<a name="l01764"></a>01764                    int32_t        aScript,
<a name="l01765"></a>01765                    <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a> *aShapedText, <span class="comment">// where to store the result</span>
<a name="l01766"></a>01766                    <span class="keywordtype">bool</span>           aPreferPlatformShaping = <span class="keyword">false</span>);
<a name="l01767"></a>01767 
<a name="l01768"></a>01768     <span class="comment">// Call the appropriate shaper to generate glyphs for aText and store</span>
<a name="l01769"></a>01769     <span class="comment">// them into aShapedText.</span>
<a name="l01770"></a>01770     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> ShapeText(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a>      *aContext,
<a name="l01771"></a>01771                            <span class="keyword">const</span> PRUnichar *aText,
<a name="l01772"></a>01772                            uint32_t         aOffset,
<a name="l01773"></a>01773                            uint32_t         aLength,
<a name="l01774"></a>01774                            int32_t          aScript,
<a name="l01775"></a>01775                            <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>   *aShapedText,
<a name="l01776"></a>01776                            <span class="keywordtype">bool</span>             aPreferPlatformShaping = <span class="keyword">false</span>);
<a name="l01777"></a>01777 
<a name="l01778"></a>01778     <span class="comment">// Helper to adjust for synthetic bold and set character-type flags</span>
<a name="l01779"></a>01779     <span class="comment">// in the shaped text; implementations of ShapeText should call this</span>
<a name="l01780"></a>01780     <span class="comment">// after glyph shaping has been completed.</span>
<a name="l01781"></a>01781     <span class="keywordtype">void</span> PostShapingFixup(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a>      *aContext,
<a name="l01782"></a>01782                           <span class="keyword">const</span> PRUnichar *aText,
<a name="l01783"></a>01783                           uint32_t         aOffset, <span class="comment">// position within aShapedText</span>
<a name="l01784"></a>01784                           uint32_t         aLength,
<a name="l01785"></a>01785                           <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>   *aShapedText);
<a name="l01786"></a>01786 
<a name="l01787"></a>01787     <span class="comment">// Shape text directly into a range within a textrun, without using the</span>
<a name="l01788"></a>01788     <span class="comment">// font&#39;s word cache. Intended for use when the font has layout features</span>
<a name="l01789"></a>01789     <span class="comment">// that involve space, and therefore require shaping complete runs rather</span>
<a name="l01790"></a>01790     <span class="comment">// than isolated words, or for long strings that are inefficient to cache.</span>
<a name="l01791"></a>01791     <span class="comment">// This will split the text on &quot;invalid&quot; characters (tab/newline) that are</span>
<a name="l01792"></a>01792     <span class="comment">// not handled via normal shaping, but does not otherwise divide up the</span>
<a name="l01793"></a>01793     <span class="comment">// text.</span>
<a name="l01794"></a>01794     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l01795"></a>01795     <span class="keywordtype">bool</span> ShapeTextWithoutWordCache(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l01796"></a>01796                                    <span class="keyword">const</span> T    *aText,
<a name="l01797"></a>01797                                    uint32_t    aOffset,
<a name="l01798"></a>01798                                    uint32_t    aLength,
<a name="l01799"></a>01799                                    int32_t     aScript,
<a name="l01800"></a>01800                                    <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun);
<a name="l01801"></a>01801 
<a name="l01802"></a>01802     <span class="comment">// Shape a fragment of text (a run that is known to contain only</span>
<a name="l01803"></a>01803     <span class="comment">// &quot;valid&quot; characters, no newlines/tabs/other control chars).</span>
<a name="l01804"></a>01804     <span class="comment">// All non-wordcache shaping goes through here; this is the function</span>
<a name="l01805"></a>01805     <span class="comment">// that will ensure we don&#39;t pass excessively long runs to the various</span>
<a name="l01806"></a>01806     <span class="comment">// platform shapers.</span>
<a name="l01807"></a>01807     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l01808"></a>01808     <span class="keywordtype">bool</span> ShapeFragmentWithoutWordCache(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l01809"></a>01809                                        <span class="keyword">const</span> T    *aText,
<a name="l01810"></a>01810                                        uint32_t    aOffset,
<a name="l01811"></a>01811                                        uint32_t    aLength,
<a name="l01812"></a>01812                                        int32_t     aScript,
<a name="l01813"></a>01813                                        <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun);
<a name="l01814"></a>01814 
<a name="l01815"></a>01815     <span class="keywordtype">void</span> CheckForFeaturesInvolvingSpace();
<a name="l01816"></a>01816 
<a name="l01817"></a>01817     <span class="comment">// whether a given feature is included in feature settings from both the</span>
<a name="l01818"></a>01818     <span class="comment">// font and the style. aFeatureOn set if resolved feature value is non-zero</span>
<a name="l01819"></a>01819     <span class="keywordtype">bool</span> HasFeatureSet(uint32_t aFeature, <span class="keywordtype">bool</span>&amp; aFeatureOn);
<a name="l01820"></a>01820 
<a name="l01821"></a><a class="code" href="../../dc/d81/classgfx_font.html#a1eb1f1ced57db9bfcca15232207fed3a">01821</a>     <span class="keyword">static</span> <a class="code" href="../../d4/dfc/classns_data_hashtable.html">nsDataHashtable&lt;nsUint32HashKey, int32_t&gt;</a> <a class="code" href="../../dc/d81/classgfx_font.html#a1eb1f1ced57db9bfcca15232207fed3a">sScriptTagToCode</a>;
<a name="l01822"></a>01822 
<a name="l01823"></a><a class="code" href="../../dc/d81/classgfx_font.html#a8d6c8aced3acc2304932a57a74b96c4e">01823</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFontEntry&gt;</a> <a class="code" href="../../dc/d81/classgfx_font.html#a8d6c8aced3acc2304932a57a74b96c4e">mFontEntry</a>;
<a name="l01824"></a>01824 
<a name="l01825"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">01825</a>     <span class="keyword">struct </span><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">CacheHashKey</a> {
<a name="l01826"></a>01826         <span class="keyword">union </span>{
<a name="l01827"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#a88ad2553974634c432083c7cb4853520">01827</a>             <span class="keyword">const</span> uint8_t   *<a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#a88ad2553974634c432083c7cb4853520">mSingle</a>;
<a name="l01828"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#abc796952a83ebaefa70d7077f3348ca5">01828</a>             <span class="keyword">const</span> PRUnichar *<a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#abc796952a83ebaefa70d7077f3348ca5">mDouble</a>;
<a name="l01829"></a>01829         }                mText;
<a name="l01830"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#a5cef7ac38afd4f8fc56a1054fc60bd35">01830</a>         uint32_t         <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#a5cef7ac38afd4f8fc56a1054fc60bd35">mLength</a>;
<a name="l01831"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#aab2698477573bd8b7ba213d38d1fc8a8">01831</a>         uint32_t         <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#aab2698477573bd8b7ba213d38d1fc8a8">mFlags</a>;
<a name="l01832"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#aef75a0ea341790bac3f9f43b8f02c647">01832</a>         int32_t          <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#aef75a0ea341790bac3f9f43b8f02c647">mScript</a>;
<a name="l01833"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#ade39a7a0456bba8dceb98b5df459371d">01833</a>         int32_t          <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#ade39a7a0456bba8dceb98b5df459371d">mAppUnitsPerDevUnit</a>;
<a name="l01834"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#ae7c08e08e9636a246807105749a252af">01834</a>         <a class="code" href="../../da/d2c/pldhash_8h.html#a6b7adbc70882ca136a7949ca49024cf2">PLDHashNumber</a>    <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#ae7c08e08e9636a246807105749a252af">mHashKey</a>;
<a name="l01835"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#acb9479e637e06a19fb45cabe9370ae6c">01835</a>         <span class="keywordtype">bool</span>             <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#acb9479e637e06a19fb45cabe9370ae6c">mTextIs8Bit</a>;
<a name="l01836"></a>01836 
<a name="l01837"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#a25b69172b84d321fed56c88ca64b49a6">01837</a>         <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">CacheHashKey</a>(<span class="keyword">const</span> uint8_t *aText, uint32_t aLength,
<a name="l01838"></a>01838                      uint32_t aStringHash,
<a name="l01839"></a>01839                      int32_t aScriptCode, int32_t aAppUnitsPerDevUnit,
<a name="l01840"></a>01840                      uint32_t aFlags)
<a name="l01841"></a>01841             : mLength(aLength),
<a name="l01842"></a>01842               mFlags(aFlags),
<a name="l01843"></a>01843               mScript(aScriptCode),
<a name="l01844"></a>01844               mAppUnitsPerDevUnit(aAppUnitsPerDevUnit),
<a name="l01845"></a>01845               mHashKey(aStringHash + aScriptCode +
<a name="l01846"></a>01846                   aAppUnitsPerDevUnit * 0x100 + aFlags * 0x10000),
<a name="l01847"></a>01847               mTextIs8Bit(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a>)
<a name="l01848"></a>01848         {
<a name="l01849"></a>01849             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aFlags &amp; <a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba22b1b18065ebc28afc92f66758233540">gfxTextRunFactory::TEXT_IS_8BIT</a>,
<a name="l01850"></a>01850                          <span class="stringliteral">&quot;8-bit flag should have been set&quot;</span>);
<a name="l01851"></a>01851             mText.mSingle = aText;
<a name="l01852"></a>01852         }
<a name="l01853"></a>01853 
<a name="l01854"></a><a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#a60069105ce38dcf2ce694d075aa44cf3">01854</a>         <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">CacheHashKey</a>(<span class="keyword">const</span> PRUnichar *aText, uint32_t aLength,
<a name="l01855"></a>01855                      uint32_t aStringHash,
<a name="l01856"></a>01856                      int32_t aScriptCode, int32_t aAppUnitsPerDevUnit,
<a name="l01857"></a>01857                      uint32_t aFlags)
<a name="l01858"></a>01858             : mLength(aLength),
<a name="l01859"></a>01859               mFlags(aFlags),
<a name="l01860"></a>01860               mScript(aScriptCode),
<a name="l01861"></a>01861               mAppUnitsPerDevUnit(aAppUnitsPerDevUnit),
<a name="l01862"></a>01862               mHashKey(aStringHash + aScriptCode +
<a name="l01863"></a>01863                   aAppUnitsPerDevUnit * 0x100 + aFlags * 0x10000),
<a name="l01864"></a>01864               mTextIs8Bit(<a class="code" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>)
<a name="l01865"></a>01865         {
<a name="l01866"></a>01866             <span class="comment">// We can NOT assert that TEXT_IS_8BIT is false in aFlags here,</span>
<a name="l01867"></a>01867             <span class="comment">// because this might be an 8bit-only word from a 16-bit textrun,</span>
<a name="l01868"></a>01868             <span class="comment">// in which case the text we&#39;re passed is still in 16-bit form,</span>
<a name="l01869"></a>01869             <span class="comment">// and we&#39;ll have to use an 8-to-16bit comparison in KeyEquals.</span>
<a name="l01870"></a>01870             mText.mDouble = aText;
<a name="l01871"></a>01871         }
<a name="l01872"></a>01872     };
<a name="l01873"></a>01873 
<a name="l01874"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html">01874</a>     <span class="keyword">class </span><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html">CacheHashEntry</a> : <span class="keyword">public</span> <a class="code" href="../../d0/dcc/struct_p_l_d_hash_entry_hdr.html">PLDHashEntryHdr</a> {
<a name="l01875"></a>01875     <span class="keyword">public</span>:
<a name="l01876"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#aa277a3b106cdc2544ff26830d22c6789">01876</a>         <span class="keyword">typedef</span> <span class="keyword">const</span> <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">CacheHashKey</a> &amp;<a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#aa277a3b106cdc2544ff26830d22c6789">KeyType</a>;
<a name="l01877"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#afebc4a72c10736ea239a7df3e82e6214">01877</a>         <span class="keyword">typedef</span> <span class="keyword">const</span> <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">CacheHashKey</a> *<a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#afebc4a72c10736ea239a7df3e82e6214">KeyTypePointer</a>;
<a name="l01878"></a>01878 
<a name="l01879"></a>01879         <span class="comment">// When constructing a new entry in the hashtable, the caller of Put()</span>
<a name="l01880"></a>01880         <span class="comment">// will fill us in.</span>
<a name="l01881"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#af16f3d8a8b6ff39e4351490715333715">01881</a>         <a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#af16f3d8a8b6ff39e4351490715333715">CacheHashEntry</a>(<a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">KeyTypePointer</a> aKey) { }
<a name="l01882"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a360831c6834ed51030e89e98e5d59d6e">01882</a>         <a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a360831c6834ed51030e89e98e5d59d6e">CacheHashEntry</a>(<span class="keyword">const</span> <a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html">CacheHashEntry</a>&amp; toCopy) { <a class="code" href="../../dc/d6d/ns_debug_8h.html#ab105b12886cfa61141f617c05ce4a11b">NS_ERROR</a>(<span class="stringliteral">&quot;Should not be called&quot;</span>); }
<a name="l01883"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a4d6d3d3cb3c7eb981bc47f89a40f61a6">01883</a>         <a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a4d6d3d3cb3c7eb981bc47f89a40f61a6">~CacheHashEntry</a>() { }
<a name="l01884"></a>01884 
<a name="l01885"></a>01885         <span class="keywordtype">bool</span> KeyEquals(<span class="keyword">const</span> KeyTypePointer aKey) <span class="keyword">const</span>;
<a name="l01886"></a>01886 
<a name="l01887"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a3a86fdbd65b7d06ddd962cc5123bbf86">01887</a>         <span class="keyword">static</span> <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">KeyTypePointer</a> <a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a3a86fdbd65b7d06ddd962cc5123bbf86">KeyToPointer</a>(<a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">KeyType</a> aKey) { <span class="keywordflow">return</span> &amp;aKey; }
<a name="l01888"></a>01888 
<a name="l01889"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a070f757a12b4193dbed89b2b8b2bf826">01889</a>         <span class="keyword">static</span> <a class="code" href="../../da/d2c/pldhash_8h.html#a6b7adbc70882ca136a7949ca49024cf2">PLDHashNumber</a> <a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a070f757a12b4193dbed89b2b8b2bf826">HashKey</a>(<span class="keyword">const</span> <a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html">KeyTypePointer</a> aKey) {
<a name="l01890"></a>01890             <span class="keywordflow">return</span> aKey-&gt;<a class="code" href="../../df/dc9/structgfx_font_1_1_cache_hash_key.html#ae7c08e08e9636a246807105749a252af">mHashKey</a>;
<a name="l01891"></a>01891         }
<a name="l01892"></a>01892 
<a name="l01893"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#af1cf93b3955e6bbfccc1a52be04c500aa623de5b4fad78175bf25a39acb1e09ce">01893</a>         <span class="keyword">enum</span> { ALLOW_MEMMOVE = <span class="keyword">true</span> };
<a name="l01894"></a>01894 
<a name="l01895"></a><a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a4ba5b5b65d312f79beb113c156bf13ee">01895</a>         <a class="code" href="../../d1/d89/classns_auto_ptr.html">nsAutoPtr&lt;gfxShapedWord&gt;</a> <a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html#a4ba5b5b65d312f79beb113c156bf13ee">mShapedWord</a>;
<a name="l01896"></a>01896     };
<a name="l01897"></a>01897 
<a name="l01898"></a>01898     <span class="keyword">static</span> <span class="keywordtype">size_t</span>
<a name="l01899"></a>01899     WordCacheEntrySizeOfExcludingThis(<a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html">CacheHashEntry</a>*   aHashEntry,
<a name="l01900"></a>01900                                       mozilla::MallocSizeOf aMallocSizeOf,
<a name="l01901"></a>01901                                       <span class="keywordtype">void</span>*             aUserArg);
<a name="l01902"></a>01902 
<a name="l01903"></a><a class="code" href="../../dc/d81/classgfx_font.html#a7eba5dde0b664e3447bb5e157cdcafac">01903</a>     <a class="code" href="../../d5/dc3/classns_t_hashtable.html">nsTHashtable&lt;CacheHashEntry&gt;</a> <a class="code" href="../../dc/d81/classgfx_font.html#a7eba5dde0b664e3447bb5e157cdcafac">mWordCache</a>;
<a name="l01904"></a>01904 
<a name="l01905"></a>01905     <span class="keyword">static</span> <a class="code" href="../../da/d2c/pldhash_8h.html#a1d49536cbc1eec9e5a32af3750697519">PLDHashOperator</a> AgeCacheEntry(<a class="code" href="../../d0/dc8/classgfx_font_1_1_cache_hash_entry.html">CacheHashEntry</a> *aEntry, <span class="keywordtype">void</span> *aUserData);
<a name="l01906"></a><a class="code" href="../../dc/d81/classgfx_font.html#a310800db9ba98f73e07cc2bfcac9cf03">01906</a>     <span class="keyword">static</span> <span class="keyword">const</span> uint32_t  kShapedWordCacheMaxAge = 3;
<a name="l01907"></a>01907 
<a name="l01908"></a><a class="code" href="../../dc/d81/classgfx_font.html#a490fff7b980787d20ff701514ef370a4">01908</a>     <span class="keywordtype">bool</span>                       <a class="code" href="../../dc/d81/classgfx_font.html#a490fff7b980787d20ff701514ef370a4">mIsValid</a>;
<a name="l01909"></a>01909 
<a name="l01910"></a>01910     <span class="comment">// use synthetic bolding for environments where this is not supported</span>
<a name="l01911"></a>01911     <span class="comment">// by the platform</span>
<a name="l01912"></a><a class="code" href="../../dc/d81/classgfx_font.html#a57ceab1fd926a829a9a7ba26eadba14a">01912</a>     <span class="keywordtype">bool</span>                       <a class="code" href="../../dc/d81/classgfx_font.html#a57ceab1fd926a829a9a7ba26eadba14a">mApplySyntheticBold</a>;
<a name="l01913"></a>01913 
<a name="l01914"></a><a class="code" href="../../dc/d81/classgfx_font.html#a04cc9c406f6ec21e59a0ad658c01ad12">01914</a>     <span class="keywordtype">bool</span>                       <a class="code" href="../../dc/d81/classgfx_font.html#a04cc9c406f6ec21e59a0ad658c01ad12">mKerningSet</a>;     <span class="comment">// kerning explicitly set?</span>
<a name="l01915"></a><a class="code" href="../../dc/d81/classgfx_font.html#ac6efd8d04b3263dca0c47d2768b76056">01915</a>     <span class="keywordtype">bool</span>                       <a class="code" href="../../dc/d81/classgfx_font.html#ac6efd8d04b3263dca0c47d2768b76056">mKerningEnabled</a>; <span class="comment">// if set, on or off?</span>
<a name="l01916"></a>01916 
<a name="l01917"></a><a class="code" href="../../dc/d81/classgfx_font.html#ab3cf7e7c511899354e7a361406dbfc29">01917</a>     <a class="code" href="../../d9/d67/structns_expiration_state.html">nsExpirationState</a>          <a class="code" href="../../dc/d81/classgfx_font.html#ab3cf7e7c511899354e7a361406dbfc29">mExpirationState</a>;
<a name="l01918"></a><a class="code" href="../../dc/d81/classgfx_font.html#a9a6fb1a2683d47093912dc19c74e76a5">01918</a>     <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a>               <a class="code" href="../../dc/d81/classgfx_font.html#a9a6fb1a2683d47093912dc19c74e76a5">mStyle</a>;
<a name="l01919"></a><a class="code" href="../../dc/d81/classgfx_font.html#a277bcd0362dc6849f0a36879822c5698">01919</a>     <a class="code" href="../../d2/dcf/classns_auto_t_array.html">nsAutoTArray&lt;gfxGlyphExtents*,1&gt;</a> <a class="code" href="../../dc/d81/classgfx_font.html#a277bcd0362dc6849f0a36879822c5698">mGlyphExtentsArray</a>;
<a name="l01920"></a>01920 
<a name="l01921"></a><a class="code" href="../../dc/d81/classgfx_font.html#a216e4098f3c91990500fa1473ff3e3b6">01921</a>     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a>                   <a class="code" href="../../dc/d81/classgfx_font.html#a216e4098f3c91990500fa1473ff3e3b6">mAdjustedSize</a>;
<a name="l01922"></a>01922 
<a name="l01923"></a><a class="code" href="../../dc/d81/classgfx_font.html#ad253f2dfe806f208b18ab3a4a31d7928">01923</a>     <span class="keywordtype">float</span>                      <a class="code" href="../../dc/d81/classgfx_font.html#ad253f2dfe806f208b18ab3a4a31d7928">mFUnitsConvFactor</a>; <span class="comment">// conversion factor from font units to dev units</span>
<a name="l01924"></a>01924 
<a name="l01925"></a>01925     <span class="comment">// the AA setting requested for this font - may affect glyph bounds</span>
<a name="l01926"></a><a class="code" href="../../dc/d81/classgfx_font.html#a1b3289b7ecdbf2fa942081b01ffe1fc1">01926</a>     <a class="code" href="../../dc/d81/classgfx_font.html#a820db74ae0a9064bbf1a98b2827eddc2">AntialiasOption</a>            <a class="code" href="../../dc/d81/classgfx_font.html#a1b3289b7ecdbf2fa942081b01ffe1fc1">mAntialiasOption</a>;
<a name="l01927"></a>01927 
<a name="l01928"></a>01928     <span class="comment">// a copy of the font without antialiasing, if needed for separate</span>
<a name="l01929"></a>01929     <span class="comment">// measurement by mathml code</span>
<a name="l01930"></a><a class="code" href="../../dc/d81/classgfx_font.html#a0c084784536e66c198c7255e0d7c9db6">01930</a>     <a class="code" href="../../d1/d89/classns_auto_ptr.html">nsAutoPtr&lt;gfxFont&gt;</a>         <a class="code" href="../../dc/d81/classgfx_font.html#a0c084784536e66c198c7255e0d7c9db6">mNonAAFont</a>;
<a name="l01931"></a>01931 
<a name="l01932"></a>01932     <span class="comment">// we may switch between these shapers on the fly, based on the script</span>
<a name="l01933"></a>01933     <span class="comment">// of the text run being shaped</span>
<a name="l01934"></a><a class="code" href="../../dc/d81/classgfx_font.html#a271a9e059740b2e99bd41b6497a5b507">01934</a>     <a class="code" href="../../d1/d89/classns_auto_ptr.html">nsAutoPtr&lt;gfxFontShaper&gt;</a>   <a class="code" href="../../dc/d81/classgfx_font.html#a271a9e059740b2e99bd41b6497a5b507">mPlatformShaper</a>;
<a name="l01935"></a><a class="code" href="../../dc/d81/classgfx_font.html#a1bcd9ef79286c5731c904132e7684b86">01935</a>     <a class="code" href="../../d1/d89/classns_auto_ptr.html">nsAutoPtr&lt;gfxFontShaper&gt;</a>   <a class="code" href="../../dc/d81/classgfx_font.html#a1bcd9ef79286c5731c904132e7684b86">mHarfBuzzShaper</a>;
<a name="l01936"></a><a class="code" href="../../dc/d81/classgfx_font.html#a485c7c0445228c03bd098d2c24995dca">01936</a>     <a class="code" href="../../d1/d89/classns_auto_ptr.html">nsAutoPtr&lt;gfxFontShaper&gt;</a>   <a class="code" href="../../dc/d81/classgfx_font.html#a485c7c0445228c03bd098d2c24995dca">mGraphiteShaper</a>;
<a name="l01937"></a>01937 
<a name="l01938"></a><a class="code" href="../../dc/d81/classgfx_font.html#ab14a46e5010671dadd4407be1695fe9e">01938</a>     <a class="code" href="../../d9/dc3/classmozilla_1_1_ref_ptr.html">mozilla::RefPtr&lt;mozilla::gfx::ScaledFont&gt;</a> <a class="code" href="../../dc/d81/classgfx_font.html#ab14a46e5010671dadd4407be1695fe9e">mAzureScaledFont</a>;
<a name="l01939"></a>01939 
<a name="l01940"></a>01940     <span class="comment">// Create a default platform text shaper for this font.</span>
<a name="l01941"></a>01941     <span class="comment">// (TODO: This should become pure virtual once all font backends have</span>
<a name="l01942"></a>01942     <span class="comment">// been updated.)</span>
<a name="l01943"></a><a class="code" href="../../dc/d81/classgfx_font.html#aa2b93bef88003f1566d4a907a8453631">01943</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d81/classgfx_font.html#aa2b93bef88003f1566d4a907a8453631">CreatePlatformShaper</a>() { }
<a name="l01944"></a>01944 
<a name="l01945"></a>01945     <span class="comment">// Helper for subclasses that want to initialize standard metrics from the</span>
<a name="l01946"></a>01946     <span class="comment">// tables of sfnt (TrueType/OpenType) fonts.</span>
<a name="l01947"></a>01947     <span class="comment">// This will use mFUnitsConvFactor if it is already set, else compute it</span>
<a name="l01948"></a>01948     <span class="comment">// from mAdjustedSize and the unitsPerEm in the font&#39;s &#39;head&#39; table.</span>
<a name="l01949"></a>01949     <span class="comment">// Returns TRUE and sets mIsValid=TRUE if successful;</span>
<a name="l01950"></a>01950     <span class="comment">// Returns TRUE but leaves mIsValid=FALSE if the font seems to be broken.</span>
<a name="l01951"></a>01951     <span class="comment">// Returns FALSE if the font does not appear to be an sfnt at all,</span>
<a name="l01952"></a>01952     <span class="comment">// and should be handled (if possible) using other APIs.</span>
<a name="l01953"></a>01953     <span class="keywordtype">bool</span> InitMetricsFromSfntTables(Metrics&amp; aMetrics);
<a name="l01954"></a>01954 
<a name="l01955"></a>01955     <span class="comment">// Helper to calculate various derived metrics from the results of</span>
<a name="l01956"></a>01956     <span class="comment">// InitMetricsFromSfntTables or equivalent platform code</span>
<a name="l01957"></a>01957     <span class="keywordtype">void</span> CalculateDerivedMetrics(Metrics&amp; aMetrics);
<a name="l01958"></a>01958 
<a name="l01959"></a>01959     <span class="comment">// some fonts have bad metrics, this method sanitize them.</span>
<a name="l01960"></a>01960     <span class="comment">// if this font has bad underline offset, aIsBadUnderlineFont should be true.</span>
<a name="l01961"></a>01961     <span class="keywordtype">void</span> SanitizeMetrics(<a class="code" href="../../dc/d62/structgfx_font_1_1_metrics.html">gfxFont::Metrics</a> *aMetrics, <span class="keywordtype">bool</span> aIsBadUnderlineFont);
<a name="l01962"></a>01962 
<a name="l01963"></a>01963     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a41e849e13731c2d7132b87f697fd045f">RenderSVGGlyph</a>(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext, <a class="code" href="../../d6/dfb/structgfx_point.html">gfxPoint</a> aPoint, DrawMode aDrawMode,
<a name="l01964"></a>01964                         uint32_t aGlyphId, <a class="code" href="../../d2/d0c/classgfx_text_object_paint.html">gfxTextObjectPaint</a> *aObjectPaint);
<a name="l01965"></a>01965     <span class="keywordtype">bool</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a41e849e13731c2d7132b87f697fd045f">RenderSVGGlyph</a>(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext, <a class="code" href="../../d6/dfb/structgfx_point.html">gfxPoint</a> aPoint, DrawMode aDrawMode,
<a name="l01966"></a>01966                         uint32_t aGlyphId, <a class="code" href="../../d2/d0c/classgfx_text_object_paint.html">gfxTextObjectPaint</a> *aObjectPaint,
<a name="l01967"></a>01967                         <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">gfxTextRunDrawCallbacks</a> *aCallbacks,
<a name="l01968"></a>01968                         <span class="keywordtype">bool</span>&amp; aEmittedGlyphs);
<a name="l01969"></a>01969 
<a name="l01970"></a>01970     <span class="comment">// Bug 674909. When synthetic bolding text by drawing twice, need to</span>
<a name="l01971"></a>01971     <span class="comment">// render using a pixel offset in device pixels, otherwise text</span>
<a name="l01972"></a>01972     <span class="comment">// doesn&#39;t appear bolded, it appears as if a bad text shadow exists</span>
<a name="l01973"></a>01973     <span class="comment">// when a non-identity transform exists.  Use an offset factor so that</span>
<a name="l01974"></a>01974     <span class="comment">// the second draw occurs at a constant offset in device pixels.</span>
<a name="l01975"></a>01975     <span class="comment">// This helper calculates the scale factor we need to apply to the</span>
<a name="l01976"></a>01976     <span class="comment">// synthetic-bold offset.</span>
<a name="l01977"></a>01977     <span class="keyword">static</span> <span class="keywordtype">double</span> CalcXScale(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext);
<a name="l01978"></a>01978 };
<a name="l01979"></a>01979 
<a name="l01980"></a>01980 <span class="comment">// proportion of ascent used for x-height, if unable to read value from font</span>
<a name="l01981"></a><a class="code" href="../../d3/d0b/gfx_font_8h.html#ace5f72b4bb5c1d6ea95ed17ee4a5fbd7">01981</a> <span class="preprocessor">#define DEFAULT_XHEIGHT_FACTOR 0.56f</span>
<a name="l01982"></a>01982 <span class="preprocessor"></span>
<a name="l01983"></a>01983 <span class="comment">/*</span>
<a name="l01984"></a>01984 <span class="comment"> * gfxShapedText is an abstract superclass for gfxShapedWord and gfxTextRun.</span>
<a name="l01985"></a>01985 <span class="comment"> * These are objects that store a list of zero or more glyphs for each character.</span>
<a name="l01986"></a>01986 <span class="comment"> * For each glyph we store the glyph ID, the advance, and possibly x/y-offsets.</span>
<a name="l01987"></a>01987 <span class="comment"> * The idea is that a string is rendered by a loop that draws each glyph</span>
<a name="l01988"></a>01988 <span class="comment"> * at its designated offset from the current point, then advances the current</span>
<a name="l01989"></a>01989 <span class="comment"> * point by the glyph&#39;s advance in the direction of the textrun (LTR or RTL).</span>
<a name="l01990"></a>01990 <span class="comment"> * Each glyph advance is always rounded to the nearest appunit; this ensures</span>
<a name="l01991"></a>01991 <span class="comment"> * consistent results when dividing the text in a textrun into multiple text</span>
<a name="l01992"></a>01992 <span class="comment"> * frames (frame boundaries are always aligned to appunits). We optimize</span>
<a name="l01993"></a>01993 <span class="comment"> * for the case where a character has a single glyph and zero xoffset and yoffset,</span>
<a name="l01994"></a>01994 <span class="comment"> * and the glyph ID and advance are in a reasonable range so we can pack all</span>
<a name="l01995"></a>01995 <span class="comment"> * necessary data into 32 bits.</span>
<a name="l01996"></a>01996 <span class="comment"> *</span>
<a name="l01997"></a>01997 <span class="comment"> * gfxFontShaper can shape text into either a gfxShapedWord (cached by a gfxFont)</span>
<a name="l01998"></a>01998 <span class="comment"> * or directly into a gfxTextRun (for cases where we want to shape textruns in</span>
<a name="l01999"></a>01999 <span class="comment"> * their entirety rather than using cached words, because there may be layout</span>
<a name="l02000"></a>02000 <span class="comment"> * features that depend on the inter-word spaces).</span>
<a name="l02001"></a>02001 <span class="comment"> */</span>
<a name="l02002"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html">02002</a> <span class="keyword">class </span><a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>
<a name="l02003"></a>02003 {
<a name="l02004"></a>02004 <span class="keyword">public</span>:
<a name="l02005"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#ad4e058a66fbc9a11f20439d0f66bfd1b">02005</a>     <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>(uint32_t aLength, uint32_t aFlags,
<a name="l02006"></a>02006                   int32_t aAppUnitsPerDevUnit)
<a name="l02007"></a>02007         : mLength(aLength)
<a name="l02008"></a>02008         , mFlags(aFlags)
<a name="l02009"></a>02009         , mAppUnitsPerDevUnit(aAppUnitsPerDevUnit)
<a name="l02010"></a>02010     { }
<a name="l02011"></a>02011 
<a name="l02012"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a7c47e12801fec42a519e96af24f81d33">02012</a>     <span class="keyword">virtual</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#a7c47e12801fec42a519e96af24f81d33">~gfxShapedText</a>() { }
<a name="l02013"></a>02013 
<a name="l02029"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">02029</a>     <span class="keyword">class </span><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a> {
<a name="l02030"></a>02030     <span class="keyword">public</span>:
<a name="l02031"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a9e3921fa8405e6a75f6cf1124bce15e6">02031</a>         <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a9e3921fa8405e6a75f6cf1124bce15e6">CompressedGlyph</a>() { mValue = 0; }
<a name="l02032"></a>02032 
<a name="l02033"></a>02033         <span class="keyword">enum</span> {
<a name="l02034"></a>02034             <span class="comment">// Indicates that a cluster and ligature group starts at this</span>
<a name="l02035"></a>02035             <span class="comment">// character; this character has a single glyph with a reasonable</span>
<a name="l02036"></a>02036             <span class="comment">// advance and zero offsets. A &quot;reasonable&quot; advance</span>
<a name="l02037"></a>02037             <span class="comment">// is one that fits in the available bits (currently 12) (specified</span>
<a name="l02038"></a>02038             <span class="comment">// in appunits).</span>
<a name="l02039"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aabd91e622e08e5998f95a5c8c8353591d">02039</a>             FLAG_IS_SIMPLE_GLYPH  = 0x80000000U,
<a name="l02040"></a>02040 
<a name="l02041"></a>02041             <span class="comment">// Indicates whether a linebreak is allowed before this character;</span>
<a name="l02042"></a>02042             <span class="comment">// this is a two-bit field that holds a FLAG_BREAK_TYPE_xxx value</span>
<a name="l02043"></a>02043             <span class="comment">// indicating the kind of linebreak (if any) allowed here.</span>
<a name="l02044"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa7ecf7c5c69ea2089d2a201bf72491cba">02044</a>             FLAGS_CAN_BREAK_BEFORE = 0x60000000U,
<a name="l02045"></a>02045 
<a name="l02046"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aaf7a6fd892f798bb72ea5878acb372331">02046</a>             FLAGS_CAN_BREAK_SHIFT = 29,
<a name="l02047"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa88521b2532162a77aef21abbe69db630">02047</a>             FLAG_BREAK_TYPE_NONE   = 0,
<a name="l02048"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa6a94c988d1d339bbfa79d588143a72f8">02048</a>             FLAG_BREAK_TYPE_NORMAL = 1,
<a name="l02049"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aab6d90ce14781ce438ca028698e790337">02049</a>             FLAG_BREAK_TYPE_HYPHEN = 2,
<a name="l02050"></a>02050 
<a name="l02051"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa6ecebc8123feee7941aec8f52b70de49">02051</a>             FLAG_CHAR_IS_SPACE     = 0x10000000U,
<a name="l02052"></a>02052 
<a name="l02053"></a>02053             <span class="comment">// The advance is stored in appunits</span>
<a name="l02054"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aac20d20932c43f85b7a0c1db9f0d22957">02054</a>             ADVANCE_MASK  = 0x0FFF0000U,
<a name="l02055"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa354b2874faadec9717fb3f077fd7f4ed">02055</a>             ADVANCE_SHIFT = 16,
<a name="l02056"></a>02056 
<a name="l02057"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aaa5bcb7080cc7b6ba2b5038abb10ca5ce">02057</a>             GLYPH_MASK = 0x0000FFFFU,
<a name="l02058"></a>02058 
<a name="l02059"></a>02059             <span class="comment">// Non-simple glyphs may or may not have glyph data in the</span>
<a name="l02060"></a>02060             <span class="comment">// corresponding mDetailedGlyphs entry. They have the following</span>
<a name="l02061"></a>02061             <span class="comment">// flag bits:</span>
<a name="l02062"></a>02062 
<a name="l02063"></a>02063             <span class="comment">// When NOT set, indicates that this character corresponds to a</span>
<a name="l02064"></a>02064             <span class="comment">// missing glyph and should be skipped (or possibly, render the character</span>
<a name="l02065"></a>02065             <span class="comment">// Unicode value in some special way). If there are glyphs,</span>
<a name="l02066"></a>02066             <span class="comment">// the mGlyphID is actually the UTF16 character code. The bit is</span>
<a name="l02067"></a>02067             <span class="comment">// inverted so we can memset the array to zero to indicate all missing.</span>
<a name="l02068"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa3742e39ce9671f9969d5388e96a58332">02068</a>             FLAG_NOT_MISSING              = 0x01,
<a name="l02069"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa30db7927d12244762a26177b715a2478">02069</a>             FLAG_NOT_CLUSTER_START        = 0x02,
<a name="l02070"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa46af0d63467c486037411cbccd9bfd88">02070</a>             FLAG_NOT_LIGATURE_GROUP_START = 0x04,
<a name="l02071"></a>02071 
<a name="l02072"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa9b48e6c1d4668fe6010d222b7a521a98">02072</a>             FLAG_CHAR_IS_TAB              = 0x08,
<a name="l02073"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa7bb3dcb29084a38ffceca4b54ab8b666">02073</a>             FLAG_CHAR_IS_NEWLINE          = 0x10,
<a name="l02074"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa89543c65881b24c6fc9b64e1c0ae0c84">02074</a>             FLAG_CHAR_IS_LOW_SURROGATE    = 0x20,
<a name="l02075"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa1882b0f50c0371a42551c42b999dda88">02075</a>             CHAR_IDENTITY_FLAGS_MASK      = 0x38,
<a name="l02076"></a>02076 
<a name="l02077"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa441b3e0541324c55f8e9cd56bfeb53da">02077</a>             GLYPH_COUNT_MASK = 0x00FFFF00U,
<a name="l02078"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab1c693b7099c90d44896bfc7b924d72aa1ec413f3a26cb7f48ccdeabc48747780">02078</a>             GLYPH_COUNT_SHIFT = 8
<a name="l02079"></a>02079         };
<a name="l02080"></a>02080 
<a name="l02081"></a>02081         <span class="comment">// &quot;Simple glyphs&quot; have a simple glyph ID, simple advance and their</span>
<a name="l02082"></a>02082         <span class="comment">// x and y offsets are zero. Also the glyph extents do not overflow</span>
<a name="l02083"></a>02083         <span class="comment">// the font-box defined by the font ascent, descent and glyph advance width.</span>
<a name="l02084"></a>02084         <span class="comment">// These case is optimized to avoid storing DetailedGlyphs.</span>
<a name="l02085"></a>02085 
<a name="l02086"></a>02086         <span class="comment">// Returns true if the glyph ID aGlyph fits into the compressed representation</span>
<a name="l02087"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a1cf99a5ef4184415c222833ec78a928e">02087</a>         <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a1cf99a5ef4184415c222833ec78a928e">IsSimpleGlyphID</a>(uint32_t aGlyph) {
<a name="l02088"></a>02088             <span class="keywordflow">return</span> (aGlyph &amp; GLYPH_MASK) == aGlyph;
<a name="l02089"></a>02089         }
<a name="l02090"></a>02090         <span class="comment">// Returns true if the advance aAdvance fits into the compressed representation.</span>
<a name="l02091"></a>02091         <span class="comment">// aAdvance is in appunits.</span>
<a name="l02092"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a087d593e62b49485b13dec179f229180">02092</a>         <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a087d593e62b49485b13dec179f229180">IsSimpleAdvance</a>(uint32_t aAdvance) {
<a name="l02093"></a>02093             <span class="keywordflow">return</span> (aAdvance &amp; (ADVANCE_MASK &gt;&gt; ADVANCE_SHIFT)) == aAdvance;
<a name="l02094"></a>02094         }
<a name="l02095"></a>02095 
<a name="l02096"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa1b4789c1a7f3cc3d116cd439d69d206">02096</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa1b4789c1a7f3cc3d116cd439d69d206">IsSimpleGlyph</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (mValue &amp; FLAG_IS_SIMPLE_GLYPH) != 0; }
<a name="l02097"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a2261ad0ebfc0eafd2d32f2d3ae5bdf21">02097</a>         uint32_t <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a2261ad0ebfc0eafd2d32f2d3ae5bdf21">GetSimpleAdvance</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (mValue &amp; ADVANCE_MASK) &gt;&gt; ADVANCE_SHIFT; }
<a name="l02098"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a65ef18ce918ee31e675a40834bd2b653">02098</a>         uint32_t <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a65ef18ce918ee31e675a40834bd2b653">GetSimpleGlyph</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mValue &amp; GLYPH_MASK; }
<a name="l02099"></a>02099 
<a name="l02100"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a80f7887c8e6d7c6280e477d5480fb193">02100</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a80f7887c8e6d7c6280e477d5480fb193">IsMissing</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (mValue &amp; (FLAG_NOT_MISSING|FLAG_IS_SIMPLE_GLYPH)) == 0; }
<a name="l02101"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a007381be7947e6409a3c09d44b2b8a3a">02101</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a007381be7947e6409a3c09d44b2b8a3a">IsClusterStart</a>()<span class="keyword"> const </span>{
<a name="l02102"></a>02102             <span class="keywordflow">return</span> (mValue &amp; FLAG_IS_SIMPLE_GLYPH) || !(mValue &amp; FLAG_NOT_CLUSTER_START);
<a name="l02103"></a>02103         }
<a name="l02104"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a151943fd6fda7c4b0ecb65234383ab7b">02104</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a151943fd6fda7c4b0ecb65234383ab7b">IsLigatureGroupStart</a>()<span class="keyword"> const </span>{
<a name="l02105"></a>02105             <span class="keywordflow">return</span> (mValue &amp; FLAG_IS_SIMPLE_GLYPH) || !(mValue &amp; FLAG_NOT_LIGATURE_GROUP_START);
<a name="l02106"></a>02106         }
<a name="l02107"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa58d8267e3b1c75d738738c433eb6726">02107</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa58d8267e3b1c75d738738c433eb6726">IsLigatureContinuation</a>()<span class="keyword"> const </span>{
<a name="l02108"></a>02108             <span class="keywordflow">return</span> (mValue &amp; FLAG_IS_SIMPLE_GLYPH) == 0 &amp;&amp;
<a name="l02109"></a>02109                 (mValue &amp; (FLAG_NOT_LIGATURE_GROUP_START | FLAG_NOT_MISSING)) ==
<a name="l02110"></a>02110                     (FLAG_NOT_LIGATURE_GROUP_START | FLAG_NOT_MISSING);
<a name="l02111"></a>02111         }
<a name="l02112"></a>02112 
<a name="l02113"></a>02113         <span class="comment">// Return true if the original character was a normal (breakable,</span>
<a name="l02114"></a>02114         <span class="comment">// trimmable) space (U+0020). Not true for other characters that</span>
<a name="l02115"></a>02115         <span class="comment">// may happen to map to the space glyph (U+00A0).</span>
<a name="l02116"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a7a01d588045f61e039122a35af16ddbf">02116</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a7a01d588045f61e039122a35af16ddbf">CharIsSpace</a>()<span class="keyword"> const </span>{
<a name="l02117"></a>02117             <span class="keywordflow">return</span> (mValue &amp; FLAG_CHAR_IS_SPACE) != 0;
<a name="l02118"></a>02118         }
<a name="l02119"></a>02119 
<a name="l02120"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aae8eb15281017a0e91c25b474fe0cf22">02120</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aae8eb15281017a0e91c25b474fe0cf22">CharIsTab</a>()<span class="keyword"> const </span>{
<a name="l02121"></a>02121             <span class="keywordflow">return</span> !IsSimpleGlyph() &amp;&amp; (mValue &amp; FLAG_CHAR_IS_TAB) != 0;
<a name="l02122"></a>02122         }
<a name="l02123"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a71663137edffce7564529e7caed729b0">02123</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a71663137edffce7564529e7caed729b0">CharIsNewline</a>()<span class="keyword"> const </span>{
<a name="l02124"></a>02124             <span class="keywordflow">return</span> !IsSimpleGlyph() &amp;&amp; (mValue &amp; FLAG_CHAR_IS_NEWLINE) != 0;
<a name="l02125"></a>02125         }
<a name="l02126"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a658276caf1b74bfad4c8fb7af1637e0c">02126</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a658276caf1b74bfad4c8fb7af1637e0c">CharIsLowSurrogate</a>()<span class="keyword"> const </span>{
<a name="l02127"></a>02127             <span class="keywordflow">return</span> !IsSimpleGlyph() &amp;&amp; (mValue &amp; FLAG_CHAR_IS_LOW_SURROGATE) != 0;
<a name="l02128"></a>02128         }
<a name="l02129"></a>02129 
<a name="l02130"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a5e7b37466c1fc117e3bd0db3d2886321">02130</a>         uint32_t <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a5e7b37466c1fc117e3bd0db3d2886321">CharIdentityFlags</a>()<span class="keyword"> const </span>{
<a name="l02131"></a>02131             <span class="keywordflow">return</span> IsSimpleGlyph() ? 0 : (mValue &amp; CHAR_IDENTITY_FLAGS_MASK);
<a name="l02132"></a>02132         }
<a name="l02133"></a>02133 
<a name="l02134"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ac59f3d64fb28e31043f6f11083e0784b">02134</a>         <span class="keywordtype">void</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ac59f3d64fb28e31043f6f11083e0784b">SetClusterStart</a>(<span class="keywordtype">bool</span> aIsClusterStart) {
<a name="l02135"></a>02135             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!IsSimpleGlyph(),
<a name="l02136"></a>02136                          <span class="stringliteral">&quot;can&#39;t call SetClusterStart on simple glyphs&quot;</span>);
<a name="l02137"></a>02137             <span class="keywordflow">if</span> (aIsClusterStart) {
<a name="l02138"></a>02138                 mValue &amp;= ~FLAG_NOT_CLUSTER_START;
<a name="l02139"></a>02139             } <span class="keywordflow">else</span> {
<a name="l02140"></a>02140                 mValue |= FLAG_NOT_CLUSTER_START;
<a name="l02141"></a>02141             }
<a name="l02142"></a>02142         }
<a name="l02143"></a>02143 
<a name="l02144"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a841e61edf1fced044b580f8bfe1d15db">02144</a>         uint8_t <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a841e61edf1fced044b580f8bfe1d15db">CanBreakBefore</a>()<span class="keyword"> const </span>{
<a name="l02145"></a>02145             <span class="keywordflow">return</span> (mValue &amp; FLAGS_CAN_BREAK_BEFORE) &gt;&gt; FLAGS_CAN_BREAK_SHIFT;
<a name="l02146"></a>02146         }
<a name="l02147"></a>02147         <span class="comment">// Returns FLAGS_CAN_BREAK_BEFORE if the setting changed, 0 otherwise</span>
<a name="l02148"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ad4cba089ab4b64ce8cdacb6f3ac1f612">02148</a>         uint32_t <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ad4cba089ab4b64ce8cdacb6f3ac1f612">SetCanBreakBefore</a>(uint8_t aCanBreakBefore) {
<a name="l02149"></a>02149             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aCanBreakBefore &lt;= 2,
<a name="l02150"></a>02150                          <span class="stringliteral">&quot;Bogus break-before value!&quot;</span>);
<a name="l02151"></a>02151             uint32_t breakMask = (uint32_t(aCanBreakBefore) &lt;&lt; FLAGS_CAN_BREAK_SHIFT);
<a name="l02152"></a>02152             uint32_t toggle = breakMask ^ (mValue &amp; FLAGS_CAN_BREAK_BEFORE);
<a name="l02153"></a>02153             mValue ^= toggle;
<a name="l02154"></a>02154             <span class="keywordflow">return</span> toggle;
<a name="l02155"></a>02155         }
<a name="l02156"></a>02156 
<a name="l02157"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab226daa2a3153aaade1190b8bc67a508">02157</a>         <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>&amp; <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ab226daa2a3153aaade1190b8bc67a508">SetSimpleGlyph</a>(uint32_t aAdvanceAppUnits, uint32_t aGlyph) {
<a name="l02158"></a>02158             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(IsSimpleAdvance(aAdvanceAppUnits), <span class="stringliteral">&quot;Advance overflow&quot;</span>);
<a name="l02159"></a>02159             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(IsSimpleGlyphID(aGlyph), <span class="stringliteral">&quot;Glyph overflow&quot;</span>);
<a name="l02160"></a>02160             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!CharIdentityFlags(), <span class="stringliteral">&quot;Char identity flags lost&quot;</span>);
<a name="l02161"></a>02161             mValue = (mValue &amp; (FLAGS_CAN_BREAK_BEFORE | FLAG_CHAR_IS_SPACE)) |
<a name="l02162"></a>02162                 FLAG_IS_SIMPLE_GLYPH |
<a name="l02163"></a>02163                 (aAdvanceAppUnits &lt;&lt; ADVANCE_SHIFT) | aGlyph;
<a name="l02164"></a>02164             <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02165"></a>02165         }
<a name="l02166"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a4d78eea73e71a2bf4014b6f5cd6df78f">02166</a>         <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>&amp; SetComplex(<span class="keywordtype">bool</span> aClusterStart, <span class="keywordtype">bool</span> aLigatureStart,
<a name="l02167"></a>02167                 uint32_t aGlyphCount) {
<a name="l02168"></a>02168             mValue = (mValue &amp; (FLAGS_CAN_BREAK_BEFORE | FLAG_CHAR_IS_SPACE)) |
<a name="l02169"></a>02169                 FLAG_NOT_MISSING |
<a name="l02170"></a>02170                 CharIdentityFlags() |
<a name="l02171"></a>02171                 (aClusterStart ? 0 : FLAG_NOT_CLUSTER_START) |
<a name="l02172"></a>02172                 (aLigatureStart ? 0 : FLAG_NOT_LIGATURE_GROUP_START) |
<a name="l02173"></a>02173                 (aGlyphCount &lt;&lt; GLYPH_COUNT_SHIFT);
<a name="l02174"></a>02174             <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02175"></a>02175         }
<a name="l02180"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a15b3f560a57e8bdd6c60e5d55ce8b868">02180</a>         <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>&amp; <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a15b3f560a57e8bdd6c60e5d55ce8b868">SetMissing</a>(uint32_t aGlyphCount) {
<a name="l02181"></a>02181             mValue = (mValue &amp; (FLAGS_CAN_BREAK_BEFORE | FLAG_NOT_CLUSTER_START |
<a name="l02182"></a>02182                                 FLAG_CHAR_IS_SPACE)) |
<a name="l02183"></a>02183                 CharIdentityFlags() |
<a name="l02184"></a>02184                 (aGlyphCount &lt;&lt; GLYPH_COUNT_SHIFT);
<a name="l02185"></a>02185             <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l02186"></a>02186         }
<a name="l02187"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#adde4138f83b3c3e349bb140853eab3b7">02187</a>         uint32_t <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#adde4138f83b3c3e349bb140853eab3b7">GetGlyphCount</a>()<span class="keyword"> const </span>{
<a name="l02188"></a>02188             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!IsSimpleGlyph(), <span class="stringliteral">&quot;Expected non-simple-glyph&quot;</span>);
<a name="l02189"></a>02189             <span class="keywordflow">return</span> (mValue &amp; GLYPH_COUNT_MASK) &gt;&gt; GLYPH_COUNT_SHIFT;
<a name="l02190"></a>02190         }
<a name="l02191"></a>02191 
<a name="l02192"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ac9f37aeaa7f9383de6393c0a2ae6b9f7">02192</a>         <span class="keywordtype">void</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#ac9f37aeaa7f9383de6393c0a2ae6b9f7">SetIsSpace</a>() {
<a name="l02193"></a>02193             mValue |= FLAG_CHAR_IS_SPACE;
<a name="l02194"></a>02194         }
<a name="l02195"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa44b24843b5a637604f8c9cb5d7c5877">02195</a>         <span class="keywordtype">void</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa44b24843b5a637604f8c9cb5d7c5877">SetIsTab</a>() {
<a name="l02196"></a>02196             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!IsSimpleGlyph(), <span class="stringliteral">&quot;Expected non-simple-glyph&quot;</span>);
<a name="l02197"></a>02197             mValue |= FLAG_CHAR_IS_TAB;
<a name="l02198"></a>02198         }
<a name="l02199"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a498a29d50834c2ccec4028be2592fd8c">02199</a>         <span class="keywordtype">void</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a498a29d50834c2ccec4028be2592fd8c">SetIsNewline</a>() {
<a name="l02200"></a>02200             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!IsSimpleGlyph(), <span class="stringliteral">&quot;Expected non-simple-glyph&quot;</span>);
<a name="l02201"></a>02201             mValue |= FLAG_CHAR_IS_NEWLINE;
<a name="l02202"></a>02202         }
<a name="l02203"></a><a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a9d611b87432b7aad6c5ac68da39bb412">02203</a>         <span class="keywordtype">void</span> <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a9d611b87432b7aad6c5ac68da39bb412">SetIsLowSurrogate</a>() {
<a name="l02204"></a>02204             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!IsSimpleGlyph(), <span class="stringliteral">&quot;Expected non-simple-glyph&quot;</span>);
<a name="l02205"></a>02205             mValue |= FLAG_CHAR_IS_LOW_SURROGATE;
<a name="l02206"></a>02206         }
<a name="l02207"></a>02207 
<a name="l02208"></a>02208     <span class="keyword">private</span>:
<a name="l02209"></a>02209         uint32_t mValue;
<a name="l02210"></a>02210     };
<a name="l02211"></a>02211 
<a name="l02212"></a>02212     <span class="comment">// Accessor for the array of CompressedGlyph records, which will be in</span>
<a name="l02213"></a>02213     <span class="comment">// a different place in gfxShapedWord vs gfxTextRun</span>
<a name="l02214"></a>02214     <span class="keyword">virtual</span> CompressedGlyph *GetCharacterGlyphs() = 0;
<a name="l02215"></a>02215 
<a name="l02220"></a><a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">02220</a>     <span class="keyword">struct </span><a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a> {
<a name="l02223"></a><a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#acb7ff3ba02876492b905d13cbc63fa03">02223</a>         uint32_t <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#acb7ff3ba02876492b905d13cbc63fa03">mGlyphID</a>;
<a name="l02228"></a><a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#ac3758cdc27183767cef8d67a4d1d493b">02228</a>         int32_t  <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#ac3758cdc27183767cef8d67a4d1d493b">mAdvance</a>;
<a name="l02229"></a><a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#a12f6eca7c139d117b45b08584a0ce701">02229</a>         <span class="keywordtype">float</span>    mXOffset, <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#a12f6eca7c139d117b45b08584a0ce701">mYOffset</a>;
<a name="l02230"></a>02230     };
<a name="l02231"></a>02231 
<a name="l02232"></a>02232     <span class="keywordtype">void</span> SetGlyphs(uint32_t aCharIndex, <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a> aGlyph,
<a name="l02233"></a>02233                    <span class="keyword">const</span> <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a> *aGlyphs);
<a name="l02234"></a>02234 
<a name="l02235"></a>02235     <span class="keywordtype">void</span> SetMissingGlyph(uint32_t aIndex, uint32_t aChar, <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont);
<a name="l02236"></a>02236 
<a name="l02237"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#aa58acab5f3bc3e63c8ee57dee827d6bc">02237</a>     <span class="keywordtype">void</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#aa58acab5f3bc3e63c8ee57dee827d6bc">SetIsSpace</a>(uint32_t aIndex) {
<a name="l02238"></a>02238         GetCharacterGlyphs()[aIndex].SetIsSpace();
<a name="l02239"></a>02239     }
<a name="l02240"></a>02240 
<a name="l02241"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a773646b1982a268269a286eff60400bf">02241</a>     <span class="keywordtype">void</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#a773646b1982a268269a286eff60400bf">SetIsLowSurrogate</a>(uint32_t aIndex) {
<a name="l02242"></a>02242         SetGlyphs(aIndex, <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>().SetComplex(<span class="keyword">false</span>, <span class="keyword">false</span>, 0), <span class="keyword">nullptr</span>);
<a name="l02243"></a>02243         GetCharacterGlyphs()[aIndex].SetIsLowSurrogate();
<a name="l02244"></a>02244     }
<a name="l02245"></a>02245 
<a name="l02246"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a23b1ffaaae4036f0eb0a1a1a2a0ca6ab">02246</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#a23b1ffaaae4036f0eb0a1a1a2a0ca6ab">HasDetailedGlyphs</a>()<span class="keyword"> const </span>{
<a name="l02247"></a>02247         <span class="keywordflow">return</span> mDetailedGlyphs != <span class="keyword">nullptr</span>;
<a name="l02248"></a>02248     }
<a name="l02249"></a>02249 
<a name="l02250"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a001622e11d71270cd9a4b69b42628d5f">02250</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#a001622e11d71270cd9a4b69b42628d5f">IsClusterStart</a>(uint32_t aPos) {
<a name="l02251"></a>02251         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02252"></a>02252         <span class="keywordflow">return</span> GetCharacterGlyphs()[aPos].IsClusterStart();
<a name="l02253"></a>02253     }
<a name="l02254"></a>02254 
<a name="l02255"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#aba3cb4ce4cf0eb60dc2a251db05d942b">02255</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#aba3cb4ce4cf0eb60dc2a251db05d942b">IsLigatureGroupStart</a>(uint32_t aPos) {
<a name="l02256"></a>02256         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02257"></a>02257         <span class="keywordflow">return</span> GetCharacterGlyphs()[aPos].IsLigatureGroupStart();
<a name="l02258"></a>02258     }
<a name="l02259"></a>02259 
<a name="l02260"></a>02260     <span class="comment">// NOTE that this must not be called for a character offset that does</span>
<a name="l02261"></a>02261     <span class="comment">// not have any DetailedGlyph records; callers must have verified that</span>
<a name="l02262"></a>02262     <span class="comment">// GetCharacterGlyphs()[aCharIndex].GetGlyphCount() is greater than zero.</span>
<a name="l02263"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a0503e29da8382744481b4c3a7e411d84">02263</a>     <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a> *<a class="code" href="../../de/d28/classgfx_shaped_text.html#a0503e29da8382744481b4c3a7e411d84">GetDetailedGlyphs</a>(uint32_t aCharIndex) {
<a name="l02264"></a>02264         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(GetCharacterGlyphs() &amp;&amp; HasDetailedGlyphs() &amp;&amp;
<a name="l02265"></a>02265                      !GetCharacterGlyphs()[aCharIndex].IsSimpleGlyph() &amp;&amp;
<a name="l02266"></a>02266                      GetCharacterGlyphs()[aCharIndex].GetGlyphCount() &gt; 0,
<a name="l02267"></a>02267                      <span class="stringliteral">&quot;invalid use of GetDetailedGlyphs; check the caller!&quot;</span>);
<a name="l02268"></a>02268         <span class="keywordflow">return</span> mDetailedGlyphs-&gt;Get(aCharIndex);
<a name="l02269"></a>02269     }
<a name="l02270"></a>02270 
<a name="l02271"></a>02271     <span class="keywordtype">void</span> AdjustAdvancesForSyntheticBold(<span class="keywordtype">float</span> aSynBoldOffset,
<a name="l02272"></a>02272                                         uint32_t aOffset, uint32_t aLength);
<a name="l02273"></a>02273 
<a name="l02274"></a>02274     <span class="comment">// Mark clusters in the CompressedGlyph records, starting at aOffset,</span>
<a name="l02275"></a>02275     <span class="comment">// based on the Unicode properties of the text in aString.</span>
<a name="l02276"></a>02276     <span class="comment">// This is also responsible to set the IsSpace flag for space characters.</span>
<a name="l02277"></a>02277     <span class="keywordtype">void</span> SetupClusterBoundaries(uint32_t         aOffset,
<a name="l02278"></a>02278                                 <span class="keyword">const</span> PRUnichar *aString,
<a name="l02279"></a>02279                                 uint32_t         aLength);
<a name="l02280"></a>02280     <span class="comment">// In 8-bit text, there won&#39;t actually be any clusters, but we still need</span>
<a name="l02281"></a>02281     <span class="comment">// the space-marking functionality.</span>
<a name="l02282"></a>02282     <span class="keywordtype">void</span> SetupClusterBoundaries(uint32_t       aOffset,
<a name="l02283"></a>02283                                 <span class="keyword">const</span> uint8_t *aString,
<a name="l02284"></a>02284                                 uint32_t       aLength);
<a name="l02285"></a>02285 
<a name="l02286"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a1ab25c7eed4a5a0e4b59f150063faf3d">02286</a>     uint32_t <a class="code" href="../../de/d28/classgfx_shaped_text.html#a1ab25c7eed4a5a0e4b59f150063faf3d">Flags</a>()<span class="keyword"> const </span>{
<a name="l02287"></a>02287         <span class="keywordflow">return</span> mFlags;
<a name="l02288"></a>02288     }
<a name="l02289"></a>02289 
<a name="l02290"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a351aca84204def6a6cae55a72f99d12d">02290</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#a351aca84204def6a6cae55a72f99d12d">IsRightToLeft</a>()<span class="keyword"> const </span>{
<a name="l02291"></a>02291         <span class="keywordflow">return</span> (<a class="code" href="../../dd/df5/ns_bidi_8h.html#ac3a9abf294c589520f6da02648e27ec8">Flags</a>() &amp; <a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba1f3d5fd55670b77fedcae547574193db">gfxTextRunFactory::TEXT_IS_RTL</a>) != 0;
<a name="l02292"></a>02292     }
<a name="l02293"></a>02293 
<a name="l02294"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#aaef512a0721724554fd883c67e53e93d">02294</a>     <span class="keywordtype">float</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#aaef512a0721724554fd883c67e53e93d">GetDirection</a>()<span class="keyword"> const </span>{
<a name="l02295"></a>02295         <span class="keywordflow">return</span> IsRightToLeft() ? -1.0f : 1.0f;
<a name="l02296"></a>02296     }
<a name="l02297"></a>02297 
<a name="l02298"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a72d0df5105bd3fa9c8458ce8de34972c">02298</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#a72d0df5105bd3fa9c8458ce8de34972c">DisableLigatures</a>()<span class="keyword"> const </span>{
<a name="l02299"></a>02299         <span class="keywordflow">return</span> (<a class="code" href="../../dd/df5/ns_bidi_8h.html#ac3a9abf294c589520f6da02648e27ec8">Flags</a>() &amp; <a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba421f40a46fd1d0e48fad7e492cc4a748">gfxTextRunFactory::TEXT_DISABLE_OPTIONAL_LIGATURES</a>) != 0;
<a name="l02300"></a>02300     }
<a name="l02301"></a>02301 
<a name="l02302"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#aab666b675cbf28d83c0fe1e017ba6a41">02302</a>     <span class="keywordtype">bool</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html#aab666b675cbf28d83c0fe1e017ba6a41">TextIs8Bit</a>()<span class="keyword"> const </span>{
<a name="l02303"></a>02303         <span class="keywordflow">return</span> (<a class="code" href="../../dd/df5/ns_bidi_8h.html#ac3a9abf294c589520f6da02648e27ec8">Flags</a>() &amp; <a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba22b1b18065ebc28afc92f66758233540">gfxTextRunFactory::TEXT_IS_8BIT</a>) != 0;
<a name="l02304"></a>02304     }
<a name="l02305"></a>02305 
<a name="l02306"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a12974a5df9b4c2ca7400d2222803afaa">02306</a>     int32_t <a class="code" href="../../de/d28/classgfx_shaped_text.html#a12974a5df9b4c2ca7400d2222803afaa">GetAppUnitsPerDevUnit</a>()<span class="keyword"> const </span>{
<a name="l02307"></a>02307         <span class="keywordflow">return</span> mAppUnitsPerDevUnit;
<a name="l02308"></a>02308     }
<a name="l02309"></a>02309 
<a name="l02310"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a07fcc21b7f978d5daec130dccb58a7bc">02310</a>     uint32_t <a class="code" href="../../de/d28/classgfx_shaped_text.html#a07fcc21b7f978d5daec130dccb58a7bc">GetLength</a>()<span class="keyword"> const </span>{
<a name="l02311"></a>02311         <span class="keywordflow">return</span> mLength;
<a name="l02312"></a>02312     }
<a name="l02313"></a>02313 
<a name="l02314"></a>02314     <span class="keywordtype">bool</span> FilterIfIgnorable(uint32_t aIndex, uint32_t aCh);
<a name="l02315"></a>02315 
<a name="l02316"></a>02316 <span class="keyword">protected</span>:
<a name="l02317"></a>02317     <span class="comment">// Allocate aCount DetailedGlyphs for the given index</span>
<a name="l02318"></a>02318     DetailedGlyph *AllocateDetailedGlyphs(uint32_t aCharIndex,
<a name="l02319"></a>02319                                           uint32_t aCount);
<a name="l02320"></a>02320 
<a name="l02321"></a>02321     <span class="comment">// For characters whose glyph data does not fit the &quot;simple&quot; glyph criteria</span>
<a name="l02322"></a>02322     <span class="comment">// in CompressedGlyph, we use a sorted array to store the association</span>
<a name="l02323"></a>02323     <span class="comment">// between the source character offset and an index into an array </span>
<a name="l02324"></a>02324     <span class="comment">// DetailedGlyphs. The CompressedGlyph record includes a count of</span>
<a name="l02325"></a>02325     <span class="comment">// the number of DetailedGlyph records that belong to the character,</span>
<a name="l02326"></a>02326     <span class="comment">// starting at the given index.</span>
<a name="l02327"></a><a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html">02327</a>     <span class="keyword">class </span><a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html">DetailedGlyphStore</a> {
<a name="l02328"></a>02328     <span class="keyword">public</span>:
<a name="l02329"></a><a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html#a175e5434177de9231210aedab67f0c1b">02329</a>         <a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html">DetailedGlyphStore</a>()
<a name="l02330"></a>02330             : mLastUsed(0)
<a name="l02331"></a>02331         { }
<a name="l02332"></a>02332 
<a name="l02333"></a>02333         <span class="comment">// This is optimized for the most common calling patterns:</span>
<a name="l02334"></a>02334         <span class="comment">// we rarely need random access to the records, access is most commonly</span>
<a name="l02335"></a>02335         <span class="comment">// sequential through the textRun, so we record the last-used index</span>
<a name="l02336"></a>02336         <span class="comment">// and check whether the caller wants the same record again, or the</span>
<a name="l02337"></a>02337         <span class="comment">// next; if not, it&#39;s most likely we&#39;re starting over from the start</span>
<a name="l02338"></a>02338         <span class="comment">// of the run, so we check the first entry before resorting to binary</span>
<a name="l02339"></a>02339         <span class="comment">// search as a last resort.</span>
<a name="l02340"></a>02340         <span class="comment">// NOTE that this must not be called for a character offset that does</span>
<a name="l02341"></a>02341         <span class="comment">// not have any DetailedGlyph records; callers must have verified that</span>
<a name="l02342"></a>02342         <span class="comment">// mCharacterGlyphs[aOffset].GetGlyphCount() is greater than zero</span>
<a name="l02343"></a>02343         <span class="comment">// before calling this, otherwise the assertions here will fire (in a</span>
<a name="l02344"></a>02344         <span class="comment">// debug build), and we&#39;ll probably crash.</span>
<a name="l02345"></a><a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html#aedcf465db41ec9e2ff2ddc8289a2d992">02345</a>         <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a>* <a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html#aedcf465db41ec9e2ff2ddc8289a2d992">Get</a>(uint32_t aOffset) {
<a name="l02346"></a>02346             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(mOffsetToIndex.Length() &gt; 0,
<a name="l02347"></a>02347                          <span class="stringliteral">&quot;no detailed glyph records!&quot;</span>);
<a name="l02348"></a>02348             <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a>* details = mDetails.Elements();
<a name="l02349"></a>02349             <span class="comment">// check common cases (fwd iteration, initial entry, etc) first</span>
<a name="l02350"></a>02350             <span class="keywordflow">if</span> (mLastUsed &lt; mOffsetToIndex.Length() - 1 &amp;&amp;
<a name="l02351"></a>02351                 aOffset == mOffsetToIndex[mLastUsed + 1].mOffset) {
<a name="l02352"></a>02352                 ++mLastUsed;
<a name="l02353"></a>02353             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aOffset == mOffsetToIndex[0].mOffset) {
<a name="l02354"></a>02354                 mLastUsed = 0;
<a name="l02355"></a>02355             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aOffset == mOffsetToIndex[mLastUsed].mOffset) {
<a name="l02356"></a>02356                 <span class="comment">// do nothing</span>
<a name="l02357"></a>02357             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mLastUsed &gt; 0 &amp;&amp;
<a name="l02358"></a>02358                        aOffset == mOffsetToIndex[mLastUsed - 1].mOffset) {
<a name="l02359"></a>02359                 --mLastUsed;
<a name="l02360"></a>02360             } <span class="keywordflow">else</span> {
<a name="l02361"></a>02361                 mLastUsed =
<a name="l02362"></a>02362                     mOffsetToIndex.BinaryIndexOf(aOffset, CompareToOffset());
<a name="l02363"></a>02363             }
<a name="l02364"></a>02364             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(mLastUsed != <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;DGRec&gt;::NoIndex</a>,
<a name="l02365"></a>02365                          <span class="stringliteral">&quot;detailed glyph record missing!&quot;</span>);
<a name="l02366"></a>02366             <span class="keywordflow">return</span> details + mOffsetToIndex[mLastUsed].mIndex;
<a name="l02367"></a>02367         }
<a name="l02368"></a>02368 
<a name="l02369"></a><a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html#a921351987aa4500672c788622e27ef37">02369</a>         <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a>* <a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html#a921351987aa4500672c788622e27ef37">Allocate</a>(uint32_t aOffset, uint32_t aCount) {
<a name="l02370"></a>02370             uint32_t detailIndex = mDetails.Length();
<a name="l02371"></a>02371             <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a> *details = mDetails.AppendElements(aCount);
<a name="l02372"></a>02372             <span class="keywordflow">if</span> (!details) {
<a name="l02373"></a>02373                 <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l02374"></a>02374             }
<a name="l02375"></a>02375             <span class="comment">// We normally set up glyph records sequentially, so the common case</span>
<a name="l02376"></a>02376             <span class="comment">// here is to append new records to the mOffsetToIndex array;</span>
<a name="l02377"></a>02377             <span class="comment">// test for that before falling back to the InsertElementSorted</span>
<a name="l02378"></a>02378             <span class="comment">// method.</span>
<a name="l02379"></a>02379             <span class="keywordflow">if</span> (mOffsetToIndex.Length() == 0 ||
<a name="l02380"></a>02380                 aOffset &gt; mOffsetToIndex[mOffsetToIndex.Length() - 1].mOffset) {
<a name="l02381"></a>02381                 <span class="keywordflow">if</span> (!mOffsetToIndex.AppendElement(DGRec(aOffset, detailIndex))) {
<a name="l02382"></a>02382                     <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l02383"></a>02383                 }
<a name="l02384"></a>02384             } <span class="keywordflow">else</span> {
<a name="l02385"></a>02385                 <span class="keywordflow">if</span> (!mOffsetToIndex.InsertElementSorted(DGRec(aOffset, detailIndex),
<a name="l02386"></a>02386                                                         CompareRecordOffsets())) {
<a name="l02387"></a>02387                     <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l02388"></a>02388                 }
<a name="l02389"></a>02389             }
<a name="l02390"></a>02390             <span class="keywordflow">return</span> details;
<a name="l02391"></a>02391         }
<a name="l02392"></a>02392 
<a name="l02393"></a><a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html#a6550cc8f07e36ebad479fed719ed66b5">02393</a>         <span class="keywordtype">size_t</span> <a class="code" href="../../d5/d59/classgfx_shaped_text_1_1_detailed_glyph_store.html#a6550cc8f07e36ebad479fed719ed66b5">SizeOfIncludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf) {
<a name="l02394"></a>02394             <span class="keywordflow">return</span> aMallocSizeOf(<span class="keyword">this</span>) +
<a name="l02395"></a>02395                 mDetails.SizeOfExcludingThis(aMallocSizeOf) +
<a name="l02396"></a>02396                 mOffsetToIndex.SizeOfExcludingThis(aMallocSizeOf);
<a name="l02397"></a>02397         }
<a name="l02398"></a>02398 
<a name="l02399"></a>02399     <span class="keyword">private</span>:
<a name="l02400"></a>02400         <span class="keyword">struct </span>DGRec {
<a name="l02401"></a>02401             DGRec(<span class="keyword">const</span> uint32_t&amp; aOffset, <span class="keyword">const</span> uint32_t&amp; aIndex)
<a name="l02402"></a>02402                 : mOffset(aOffset), mIndex(aIndex) { }
<a name="l02403"></a>02403             uint32_t mOffset; <span class="comment">// source character offset in the textrun</span>
<a name="l02404"></a>02404             uint32_t mIndex;  <span class="comment">// index where this char&#39;s DetailedGlyphs begin</span>
<a name="l02405"></a>02405         };
<a name="l02406"></a>02406 
<a name="l02407"></a>02407         <span class="keyword">struct </span>CompareToOffset {
<a name="l02408"></a>02408             <span class="keywordtype">bool</span> Equals(<span class="keyword">const</span> DGRec&amp; <a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a>, <span class="keyword">const</span> uint32_t&amp; <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>)<span class="keyword"> const </span>{
<a name="l02409"></a>02409                 <span class="keywordflow">return</span> a.mOffset == <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>;
<a name="l02410"></a>02410             }
<a name="l02411"></a>02411             <span class="keywordtype">bool</span> LessThan(<span class="keyword">const</span> DGRec&amp; <a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a>, <span class="keyword">const</span> uint32_t&amp; <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>)<span class="keyword"> const </span>{
<a name="l02412"></a>02412                 <span class="keywordflow">return</span> a.mOffset &lt; <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>;
<a name="l02413"></a>02413             }
<a name="l02414"></a>02414         };
<a name="l02415"></a>02415 
<a name="l02416"></a>02416         <span class="keyword">struct </span>CompareRecordOffsets {
<a name="l02417"></a>02417             <span class="keywordtype">bool</span> Equals(<span class="keyword">const</span> DGRec&amp; <a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a>, <span class="keyword">const</span> DGRec&amp; <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>)<span class="keyword"> const </span>{
<a name="l02418"></a>02418                 <span class="keywordflow">return</span> a.mOffset == b.mOffset;
<a name="l02419"></a>02419             }
<a name="l02420"></a>02420             <span class="keywordtype">bool</span> LessThan(<span class="keyword">const</span> DGRec&amp; <a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a>, <span class="keyword">const</span> DGRec&amp; <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>)<span class="keyword"> const </span>{
<a name="l02421"></a>02421                 <span class="keywordflow">return</span> a.mOffset &lt; b.mOffset;
<a name="l02422"></a>02422             }
<a name="l02423"></a>02423         };
<a name="l02424"></a>02424 
<a name="l02425"></a>02425         <span class="comment">// Concatenated array of all the DetailedGlyph records needed for the</span>
<a name="l02426"></a>02426         <span class="comment">// textRun; individual character offsets are associated with indexes</span>
<a name="l02427"></a>02427         <span class="comment">// into this array via the mOffsetToIndex table.</span>
<a name="l02428"></a>02428         <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;DetailedGlyph&gt;</a>     mDetails;
<a name="l02429"></a>02429 
<a name="l02430"></a>02430         <span class="comment">// For each character offset that needs DetailedGlyphs, we record the</span>
<a name="l02431"></a>02431         <span class="comment">// index in mDetails where the list of glyphs begins. This array is</span>
<a name="l02432"></a>02432         <span class="comment">// sorted by mOffset.</span>
<a name="l02433"></a>02433         <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;DGRec&gt;</a>             mOffsetToIndex;
<a name="l02434"></a>02434 
<a name="l02435"></a>02435         <span class="comment">// Records the most recently used index into mOffsetToIndex, so that</span>
<a name="l02436"></a>02436         <span class="comment">// we can support sequential access more quickly than just doing</span>
<a name="l02437"></a>02437         <span class="comment">// a binary search each time.</span>
<a name="l02438"></a>02438         <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;DGRec&gt;::index_type</a> mLastUsed;
<a name="l02439"></a>02439     };
<a name="l02440"></a>02440 
<a name="l02441"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a2f62b3755378374629605ba8c52473d9">02441</a>     <a class="code" href="../../d1/d89/classns_auto_ptr.html">nsAutoPtr&lt;DetailedGlyphStore&gt;</a>   <a class="code" href="../../de/d28/classgfx_shaped_text.html#a2f62b3755378374629605ba8c52473d9">mDetailedGlyphs</a>;
<a name="l02442"></a>02442 
<a name="l02443"></a>02443     <span class="comment">// Number of PRUnichar characters and CompressedGlyph glyph records</span>
<a name="l02444"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a377a273a1441557680de46e047c50961">02444</a>     uint32_t                        <a class="code" href="../../de/d28/classgfx_shaped_text.html#a377a273a1441557680de46e047c50961">mLength</a>;
<a name="l02445"></a>02445 
<a name="l02446"></a>02446     <span class="comment">// Shaping flags (direction, ligature-suppression)</span>
<a name="l02447"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a14e4e4a3bff9868207c7cbf027139c2b">02447</a>     uint32_t                        <a class="code" href="../../de/d28/classgfx_shaped_text.html#a14e4e4a3bff9868207c7cbf027139c2b">mFlags</a>;
<a name="l02448"></a>02448 
<a name="l02449"></a><a class="code" href="../../de/d28/classgfx_shaped_text.html#a367a6f19ce022fbd6308e123678a0724">02449</a>     int32_t                         <a class="code" href="../../de/d28/classgfx_shaped_text.html#a367a6f19ce022fbd6308e123678a0724">mAppUnitsPerDevUnit</a>;
<a name="l02450"></a>02450 };
<a name="l02451"></a>02451 
<a name="l02452"></a>02452 <span class="comment">/*</span>
<a name="l02453"></a>02453 <span class="comment"> * gfxShapedWord: an individual (space-delimited) run of text shaped with a</span>
<a name="l02454"></a>02454 <span class="comment"> * particular font, without regard to external context.</span>
<a name="l02455"></a>02455 <span class="comment"> *</span>
<a name="l02456"></a>02456 <span class="comment"> * The glyph data is copied into gfxTextRuns as needed from the cache of</span>
<a name="l02457"></a>02457 <span class="comment"> * ShapedWords associated with each gfxFont instance.</span>
<a name="l02458"></a>02458 <span class="comment"> */</span>
<a name="l02459"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html">02459</a> <span class="keyword">class </span><a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a> : <span class="keyword">public</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>
<a name="l02460"></a>02460 {
<a name="l02461"></a>02461 <span class="keyword">public</span>:
<a name="l02462"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#acf3250bf0abcea128fbef11d27a8dd9a">02462</a>     <span class="keyword">static</span> <span class="keyword">const</span> uint32_t kMaxLength = 32;
<a name="l02463"></a>02463 
<a name="l02464"></a>02464     <span class="comment">// Create a ShapedWord that can hold glyphs for aLength characters,</span>
<a name="l02465"></a>02465     <span class="comment">// with mCharacterGlyphs sized appropriately.</span>
<a name="l02466"></a>02466     <span class="comment">//</span>
<a name="l02467"></a>02467     <span class="comment">// Returns null on allocation failure (does NOT use infallible alloc)</span>
<a name="l02468"></a>02468     <span class="comment">// so caller must check for success.</span>
<a name="l02469"></a>02469     <span class="comment">//</span>
<a name="l02470"></a>02470     <span class="comment">// This does NOT perform shaping, so the returned word contains no</span>
<a name="l02471"></a>02471     <span class="comment">// glyph data; the caller must call gfxFont::ShapeText() with appropriate</span>
<a name="l02472"></a>02472     <span class="comment">// parameters to set up the glyphs.</span>
<a name="l02473"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#a6235d474e473f2318c6e16e1c81dcebd">02473</a>     <span class="keyword">static</span> <a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>* <a class="code" href="../../d3/df6/namespacemozilla_1_1layers_1_1_compositable_map.html#aa82599b1b1ccdeb4aa199b742a63322b">Create</a>(<span class="keyword">const</span> uint8_t *aText, uint32_t aLength,
<a name="l02474"></a>02474                                  int32_t aRunScript,
<a name="l02475"></a>02475                                  int32_t aAppUnitsPerDevUnit,
<a name="l02476"></a>02476                                  uint32_t aFlags) {
<a name="l02477"></a>02477         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aLength &lt;= kMaxLength, <span class="stringliteral">&quot;excessive length for gfxShapedWord!&quot;</span>);
<a name="l02478"></a>02478 
<a name="l02479"></a>02479         <span class="comment">// Compute size needed including the mCharacterGlyphs array</span>
<a name="l02480"></a>02480         <span class="comment">// and a copy of the original text</span>
<a name="l02481"></a>02481         uint32_t <a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a6d7e27eaec1e5f6600e65858be43c18b">size</a> =
<a name="l02482"></a>02482             <a class="code" href="../../dc/d10/ns_c_s_s_property_8h.html#a47e433676bb6902977b7a50bfe31f5fc">offsetof</a>(<a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>, mCharGlyphsStorage) +
<a name="l02483"></a>02483             aLength * (<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>) + <span class="keyword">sizeof</span>(uint8_t));
<a name="l02484"></a>02484         <span class="keywordtype">void</span> *storage = <a class="code" href="../../d1/d62/mozalloc_8h.html#a615e3dd0c7796ac7148882e691f71594">moz_malloc</a>(size);
<a name="l02485"></a>02485         <span class="keywordflow">if</span> (!storage) {
<a name="l02486"></a>02486             <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l02487"></a>02487         }
<a name="l02488"></a>02488 
<a name="l02489"></a>02489         <span class="comment">// Construct in the pre-allocated storage, using placement new</span>
<a name="l02490"></a>02490         <span class="keywordflow">return</span> <span class="keyword">new</span> (storage) <a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>(aText, aLength, aRunScript,
<a name="l02491"></a>02491                                            aAppUnitsPerDevUnit, aFlags);
<a name="l02492"></a>02492     }
<a name="l02493"></a>02493 
<a name="l02494"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#abc1e4eed32bbe3fd17bfae9de1e3f0ad">02494</a>     <span class="keyword">static</span> <a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>* <a class="code" href="../../d3/df6/namespacemozilla_1_1layers_1_1_compositable_map.html#aa82599b1b1ccdeb4aa199b742a63322b">Create</a>(<span class="keyword">const</span> PRUnichar *aText, uint32_t aLength,
<a name="l02495"></a>02495                                  int32_t aRunScript,
<a name="l02496"></a>02496                                  int32_t aAppUnitsPerDevUnit,
<a name="l02497"></a>02497                                  uint32_t aFlags) {
<a name="l02498"></a>02498         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aLength &lt;= kMaxLength, <span class="stringliteral">&quot;excessive length for gfxShapedWord!&quot;</span>);
<a name="l02499"></a>02499 
<a name="l02500"></a>02500         <span class="comment">// In the 16-bit version of Create, if the TEXT_IS_8BIT flag is set,</span>
<a name="l02501"></a>02501         <span class="comment">// then we convert the text to an 8-bit version and call the 8-bit</span>
<a name="l02502"></a>02502         <span class="comment">// Create function instead.</span>
<a name="l02503"></a>02503         <span class="keywordflow">if</span> (aFlags &amp; <a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba22b1b18065ebc28afc92f66758233540">gfxTextRunFactory::TEXT_IS_8BIT</a>) {
<a name="l02504"></a>02504             nsAutoCString narrowText;
<a name="l02505"></a>02505             <a class="code" href="../../dd/ddd/ns_readable_utils_8h.html#a3b680877c4b74851cc15baf4e5de621e">LossyAppendUTF16toASCII</a>(nsDependentSubstring(aText, aLength),
<a name="l02506"></a>02506                                     narrowText);
<a name="l02507"></a>02507             <span class="keywordflow">return</span> <a class="code" href="../../d3/df6/namespacemozilla_1_1layers_1_1_compositable_map.html#aa82599b1b1ccdeb4aa199b742a63322b">Create</a>((<span class="keyword">const</span> uint8_t*)(narrowText.BeginReading()),
<a name="l02508"></a>02508                           aLength, aRunScript, aAppUnitsPerDevUnit, aFlags);
<a name="l02509"></a>02509         }
<a name="l02510"></a>02510 
<a name="l02511"></a>02511         uint32_t <a class="code" href="../../d5/dbd/camera_2js_2camera_8js.html#a6d7e27eaec1e5f6600e65858be43c18b">size</a> =
<a name="l02512"></a>02512             <a class="code" href="../../dc/d10/ns_c_s_s_property_8h.html#a47e433676bb6902977b7a50bfe31f5fc">offsetof</a>(<a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>, mCharGlyphsStorage) +
<a name="l02513"></a>02513             aLength * (<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>) + <span class="keyword">sizeof</span>(PRUnichar));
<a name="l02514"></a>02514         <span class="keywordtype">void</span> *storage = <a class="code" href="../../d1/d62/mozalloc_8h.html#a615e3dd0c7796ac7148882e691f71594">moz_malloc</a>(size);
<a name="l02515"></a>02515         <span class="keywordflow">if</span> (!storage) {
<a name="l02516"></a>02516             <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l02517"></a>02517         }
<a name="l02518"></a>02518 
<a name="l02519"></a>02519         <span class="keywordflow">return</span> <span class="keyword">new</span> (storage) <a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>(aText, aLength, aRunScript,
<a name="l02520"></a>02520                                            aAppUnitsPerDevUnit, aFlags);
<a name="l02521"></a>02521     }
<a name="l02522"></a>02522 
<a name="l02523"></a>02523     <span class="comment">// Override operator delete to properly free the object that was</span>
<a name="l02524"></a>02524     <span class="comment">// allocated via moz_malloc.</span>
<a name="l02525"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#ae6bd27259a4c550418925e482cdb7b33">02525</a>     <span class="keywordtype">void</span> <a class="code" href="../../d0/d86/classgfx_shaped_word.html#ae6bd27259a4c550418925e482cdb7b33">operator delete</a>(<span class="keywordtype">void</span>* <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) {
<a name="l02526"></a>02526         <a class="code" href="../../d1/d62/mozalloc_8h.html#ad2cea34bc139e8216fa6d8230578e093">moz_free</a>(p);
<a name="l02527"></a>02527     }
<a name="l02528"></a>02528 
<a name="l02529"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#a64dcc4c052543e0ee8a2c5ff77b5277b">02529</a>     <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a> *<a class="code" href="../../d0/d86/classgfx_shaped_word.html#a64dcc4c052543e0ee8a2c5ff77b5277b">GetCharacterGlyphs</a>() {
<a name="l02530"></a>02530         <span class="keywordflow">return</span> &amp;mCharGlyphsStorage[0];
<a name="l02531"></a>02531     }
<a name="l02532"></a>02532 
<a name="l02533"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#a0b28561dd1c83ed791892145c6caab8a">02533</a>     <span class="keyword">const</span> uint8_t* <a class="code" href="../../d0/d86/classgfx_shaped_word.html#a0b28561dd1c83ed791892145c6caab8a">Text8Bit</a>()<span class="keyword"> const </span>{
<a name="l02534"></a>02534         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(TextIs8Bit(), <span class="stringliteral">&quot;invalid use of Text8Bit()&quot;</span>);
<a name="l02535"></a>02535         <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>uint8_t*<span class="keyword">&gt;</span>(mCharGlyphsStorage + GetLength());
<a name="l02536"></a>02536     }
<a name="l02537"></a>02537 
<a name="l02538"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#abf70cbd861be0dcbaa6af4160523d037">02538</a>     <span class="keyword">const</span> PRUnichar* <a class="code" href="../../d0/d86/classgfx_shaped_word.html#abf70cbd861be0dcbaa6af4160523d037">TextUnicode</a>()<span class="keyword"> const </span>{
<a name="l02539"></a>02539         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!TextIs8Bit(), <span class="stringliteral">&quot;invalid use of TextUnicode()&quot;</span>);
<a name="l02540"></a>02540         <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>PRUnichar*<span class="keyword">&gt;</span>(mCharGlyphsStorage + GetLength());
<a name="l02541"></a>02541     }
<a name="l02542"></a>02542 
<a name="l02543"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#a1006e5929ffa0fbdc6da9af95d4f1f1a">02543</a>     PRUnichar <a class="code" href="../../d0/d86/classgfx_shaped_word.html#a1006e5929ffa0fbdc6da9af95d4f1f1a">GetCharAt</a>(uint32_t aOffset)<span class="keyword"> const </span>{
<a name="l02544"></a>02544         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aOffset &lt; GetLength(), <span class="stringliteral">&quot;aOffset out of range&quot;</span>);
<a name="l02545"></a>02545         <span class="keywordflow">return</span> TextIs8Bit() ?
<a name="l02546"></a>02546             PRUnichar(Text8Bit()[aOffset]) : TextUnicode()[aOffset];
<a name="l02547"></a>02547     }
<a name="l02548"></a>02548 
<a name="l02549"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#a7b6db470ddfd53bb6bd4155bbe95b2e5">02549</a>     int32_t <a class="code" href="../../d0/d86/classgfx_shaped_word.html#a7b6db470ddfd53bb6bd4155bbe95b2e5">Script</a>()<span class="keyword"> const </span>{
<a name="l02550"></a>02550         <span class="keywordflow">return</span> mScript;
<a name="l02551"></a>02551     }
<a name="l02552"></a>02552 
<a name="l02553"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#a60097af4c00d57c7d5d1f851b1c048ac">02553</a>     <span class="keywordtype">void</span> <a class="code" href="../../d0/d86/classgfx_shaped_word.html#a60097af4c00d57c7d5d1f851b1c048ac">ResetAge</a>() {
<a name="l02554"></a>02554         mAgeCounter = 0;
<a name="l02555"></a>02555     }
<a name="l02556"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#ab2cc83df7a153956f8914f3da150688a">02556</a>     uint32_t <a class="code" href="../../d0/d86/classgfx_shaped_word.html#ab2cc83df7a153956f8914f3da150688a">IncrementAge</a>() {
<a name="l02557"></a>02557         <span class="keywordflow">return</span> ++mAgeCounter;
<a name="l02558"></a>02558     }
<a name="l02559"></a>02559 
<a name="l02560"></a>02560 <span class="keyword">private</span>:
<a name="l02561"></a>02561     <span class="comment">// so that gfxTextRun can share our DetailedGlyphStore class</span>
<a name="l02562"></a><a class="code" href="../../d0/d86/classgfx_shaped_word.html#ab6a4eb33e27abbecbf1a248118c6d109">02562</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a>;
<a name="l02563"></a>02563 
<a name="l02564"></a>02564     <span class="comment">// Construct storage for a ShapedWord, ready to receive glyph data</span>
<a name="l02565"></a>02565     <a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>(<span class="keyword">const</span> uint8_t *aText, uint32_t aLength,
<a name="l02566"></a>02566                   int32_t aRunScript, int32_t aAppUnitsPerDevUnit,
<a name="l02567"></a>02567                   uint32_t aFlags)
<a name="l02568"></a>02568         : <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>(aLength, aFlags | <a class="code" href="../../dd/d10/classgfx_text_run_factory.html">gfxTextRunFactory</a>::TEXT_IS_8BIT,
<a name="l02569"></a>02569                         aAppUnitsPerDevUnit)
<a name="l02570"></a>02570         , mScript(aRunScript)
<a name="l02571"></a>02571         , mAgeCounter(0)
<a name="l02572"></a>02572     {
<a name="l02573"></a>02573         memset(mCharGlyphsStorage, 0, aLength * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>));
<a name="l02574"></a>02574         uint8_t *<a class="code" href="../../dd/dfa/classtext.html">text</a> = <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(&amp;mCharGlyphsStorage[aLength]);
<a name="l02575"></a>02575         memcpy(text, aText, aLength * <span class="keyword">sizeof</span>(uint8_t));
<a name="l02576"></a>02576     }
<a name="l02577"></a>02577 
<a name="l02578"></a>02578     <a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a>(<span class="keyword">const</span> PRUnichar *aText, uint32_t aLength,
<a name="l02579"></a>02579                   int32_t aRunScript, int32_t aAppUnitsPerDevUnit,
<a name="l02580"></a>02580                   uint32_t aFlags)
<a name="l02581"></a>02581         : <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a>(aLength, aFlags, aAppUnitsPerDevUnit)
<a name="l02582"></a>02582         , mScript(aRunScript)
<a name="l02583"></a>02583         , mAgeCounter(0)
<a name="l02584"></a>02584     {
<a name="l02585"></a>02585         memset(mCharGlyphsStorage, 0, aLength * <span class="keyword">sizeof</span>(CompressedGlyph));
<a name="l02586"></a>02586         PRUnichar *text = <span class="keyword">reinterpret_cast&lt;</span>PRUnichar*<span class="keyword">&gt;</span>(&amp;mCharGlyphsStorage[aLength]);
<a name="l02587"></a>02587         memcpy(text, aText, aLength * <span class="keyword">sizeof</span>(PRUnichar));
<a name="l02588"></a>02588         <a class="code" href="../../de/d28/classgfx_shaped_text.html#a394b737ccb561316076288e8d31d8c0a">SetupClusterBoundaries</a>(0, aText, aLength);
<a name="l02589"></a>02589     }
<a name="l02590"></a>02590 
<a name="l02591"></a>02591     int32_t          mScript;
<a name="l02592"></a>02592 
<a name="l02593"></a>02593     uint32_t         mAgeCounter;
<a name="l02594"></a>02594 
<a name="l02595"></a>02595     <span class="comment">// The mCharGlyphsStorage array is actually a variable-size member;</span>
<a name="l02596"></a>02596     <span class="comment">// when the ShapedWord is created, its size will be increased as necessary</span>
<a name="l02597"></a>02597     <span class="comment">// to allow the proper number of glyphs to be stored.</span>
<a name="l02598"></a>02598     <span class="comment">// The original text, in either 8-bit or 16-bit form, will be stored</span>
<a name="l02599"></a>02599     <span class="comment">// immediately following the CompressedGlyphs.</span>
<a name="l02600"></a>02600     CompressedGlyph  mCharGlyphsStorage[1];
<a name="l02601"></a>02601 };
<a name="l02602"></a>02602 
<a name="l02607"></a><a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">02607</a> <span class="keyword">struct </span><a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">gfxTextRunDrawCallbacks</a> {
<a name="l02608"></a>02608 
<a name="l02617"></a><a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html#a981315c835a886dbc42f47cccf402b4e">02617</a>     <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">gfxTextRunDrawCallbacks</a>(<span class="keywordtype">bool</span> aShouldPaintSVGGlyphs = <span class="keyword">false</span>)
<a name="l02618"></a>02618       : mShouldPaintSVGGlyphs(aShouldPaintSVGGlyphs)
<a name="l02619"></a>02619     {
<a name="l02620"></a>02620     }
<a name="l02621"></a>02621 
<a name="l02627"></a>02627     <span class="keyword">virtual</span> <span class="keywordtype">void</span> NotifyGlyphPathEmitted() = 0;
<a name="l02628"></a>02628 
<a name="l02632"></a><a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html#a2ba526bcf8d107083bf959113888c5af">02632</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html#a2ba526bcf8d107083bf959113888c5af">NotifyBeforeSVGGlyphPainted</a>() { }
<a name="l02633"></a>02633 
<a name="l02637"></a><a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html#a2d1dd71a7f5bbdb6522a8387102afff3">02637</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html#a2d1dd71a7f5bbdb6522a8387102afff3">NotifyAfterSVGGlyphPainted</a>() { }
<a name="l02638"></a>02638 
<a name="l02639"></a><a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html#aefd0c188ed27e3bbba55c56ceace990b">02639</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html#aefd0c188ed27e3bbba55c56ceace990b">mShouldPaintSVGGlyphs</a>;
<a name="l02640"></a>02640 };
<a name="l02641"></a>02641 
<a name="l02661"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html">02661</a> <span class="keyword">class </span><a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> : <span class="keyword">public</span> <a class="code" href="../../de/d28/classgfx_shaped_text.html">gfxShapedText</a> {
<a name="l02662"></a>02662 <span class="keyword">public</span>:
<a name="l02663"></a>02663 
<a name="l02664"></a>02664     <span class="comment">// Override operator delete to properly free the object that was</span>
<a name="l02665"></a>02665     <span class="comment">// allocated via moz_malloc.</span>
<a name="l02666"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a071a2d9cb947ad2f841e35fa124caeed">02666</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a071a2d9cb947ad2f841e35fa124caeed">operator delete</a>(<span class="keywordtype">void</span>* <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) {
<a name="l02667"></a>02667         <a class="code" href="../../d1/d62/mozalloc_8h.html#ad2cea34bc139e8216fa6d8230578e093">moz_free</a>(p);
<a name="l02668"></a>02668     }
<a name="l02669"></a>02669 
<a name="l02670"></a>02670     <span class="keyword">virtual</span> ~<a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a>();
<a name="l02671"></a>02671 
<a name="l02672"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#ae918ff90f98c1260230897c775ff3eb5">02672</a>     <span class="keyword">typedef</span> <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html">gfxFont::RunMetrics</a> <a class="code" href="../../d6/d7e/classgfx_text_run.html#ae918ff90f98c1260230897c775ff3eb5">Metrics</a>;
<a name="l02673"></a>02673 
<a name="l02674"></a>02674     <span class="comment">// Public textrun API for general use</span>
<a name="l02675"></a>02675 
<a name="l02676"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a4b8de264e1c08631549a96a82ce77126">02676</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a4b8de264e1c08631549a96a82ce77126">IsClusterStart</a>(uint32_t aPos) {
<a name="l02677"></a>02677         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02678"></a>02678         <span class="keywordflow">return</span> mCharacterGlyphs[aPos].IsClusterStart();
<a name="l02679"></a>02679     }
<a name="l02680"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#ac78fb107ca7e5305f4974c54e99add52">02680</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#ac78fb107ca7e5305f4974c54e99add52">IsLigatureGroupStart</a>(uint32_t aPos) {
<a name="l02681"></a>02681         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02682"></a>02682         <span class="keywordflow">return</span> mCharacterGlyphs[aPos].IsLigatureGroupStart();
<a name="l02683"></a>02683     }
<a name="l02684"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#af5cbc5ed9defc6010ae31a5dc71390fe">02684</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#af5cbc5ed9defc6010ae31a5dc71390fe">CanBreakLineBefore</a>(uint32_t aPos) {
<a name="l02685"></a>02685         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02686"></a>02686         <span class="keywordflow">return</span> mCharacterGlyphs[aPos].CanBreakBefore() ==
<a name="l02687"></a>02687             CompressedGlyph::FLAG_BREAK_TYPE_NORMAL;
<a name="l02688"></a>02688     }
<a name="l02689"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a45e461f398786523df7d0f22d00c89bb">02689</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a45e461f398786523df7d0f22d00c89bb">CanHyphenateBefore</a>(uint32_t aPos) {
<a name="l02690"></a>02690         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02691"></a>02691         <span class="keywordflow">return</span> mCharacterGlyphs[aPos].CanBreakBefore() ==
<a name="l02692"></a>02692             CompressedGlyph::FLAG_BREAK_TYPE_HYPHEN;
<a name="l02693"></a>02693     }
<a name="l02694"></a>02694 
<a name="l02695"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a214310876cb9295842319f688caf565f">02695</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a214310876cb9295842319f688caf565f">CharIsSpace</a>(uint32_t aPos) {
<a name="l02696"></a>02696         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02697"></a>02697         <span class="keywordflow">return</span> mCharacterGlyphs[aPos].CharIsSpace();
<a name="l02698"></a>02698     }
<a name="l02699"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a5dc444f9af6a3b791bf615dae1621303">02699</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a5dc444f9af6a3b791bf615dae1621303">CharIsTab</a>(uint32_t aPos) {
<a name="l02700"></a>02700         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02701"></a>02701         <span class="keywordflow">return</span> mCharacterGlyphs[aPos].CharIsTab();
<a name="l02702"></a>02702     }
<a name="l02703"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a013e5d7844270355dad4ca201c8f4e02">02703</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a013e5d7844270355dad4ca201c8f4e02">CharIsNewline</a>(uint32_t aPos) {
<a name="l02704"></a>02704         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02705"></a>02705         <span class="keywordflow">return</span> mCharacterGlyphs[aPos].CharIsNewline();
<a name="l02706"></a>02706     }
<a name="l02707"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#ac34f246c0c107a2c717489a7347219cc">02707</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#ac34f246c0c107a2c717489a7347219cc">CharIsLowSurrogate</a>(uint32_t aPos) {
<a name="l02708"></a>02708         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aPos &lt; GetLength(), <span class="stringliteral">&quot;aPos out of range&quot;</span>);
<a name="l02709"></a>02709         <span class="keywordflow">return</span> mCharacterGlyphs[aPos].CharIsLowSurrogate();
<a name="l02710"></a>02710     }
<a name="l02711"></a>02711 
<a name="l02712"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a70921f558e46236ab44ce37a24753a35">02712</a>     uint32_t <a class="code" href="../../d6/d7e/classgfx_text_run.html#a70921f558e46236ab44ce37a24753a35">GetLength</a>() { <span class="keywordflow">return</span> mLength; }
<a name="l02713"></a>02713 
<a name="l02714"></a>02714     <span class="comment">// All uint32_t aStart, uint32_t aLength ranges below are restricted to</span>
<a name="l02715"></a>02715     <span class="comment">// grapheme cluster boundaries! All offsets are in terms of the string</span>
<a name="l02716"></a>02716     <span class="comment">// passed into MakeTextRun.</span>
<a name="l02717"></a>02717     
<a name="l02718"></a>02718     <span class="comment">// All coordinates are in layout/app units</span>
<a name="l02719"></a>02719 
<a name="l02732"></a>02732     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SetPotentialLineBreaks(uint32_t aStart, uint32_t aLength,
<a name="l02733"></a>02733                                           uint8_t *aBreakBefore,
<a name="l02734"></a>02734                                           <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aRefContext);
<a name="l02735"></a>02735 
<a name="l02746"></a><a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">02746</a>     <span class="keyword">class </span><a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> {
<a name="l02747"></a>02747     <span class="keyword">public</span>:
<a name="l02748"></a>02748         <span class="comment">// Detect hyphenation break opportunities in the given range; breaks</span>
<a name="l02749"></a>02749         <span class="comment">// not at cluster boundaries will be ignored.</span>
<a name="l02750"></a>02750         <span class="keyword">virtual</span> <span class="keywordtype">void</span> GetHyphenationBreaks(uint32_t aStart, uint32_t aLength,
<a name="l02751"></a>02751                                           <span class="keywordtype">bool</span> *aBreakBefore) = 0;
<a name="l02752"></a>02752 
<a name="l02753"></a>02753         <span class="comment">// Returns the provider&#39;s hyphenation setting, so callers can decide</span>
<a name="l02754"></a>02754         <span class="comment">// whether it is necessary to call GetHyphenationBreaks.</span>
<a name="l02755"></a>02755         <span class="comment">// Result is an NS_STYLE_HYPHENS_* value.</span>
<a name="l02756"></a>02756         <span class="keyword">virtual</span> int8_t GetHyphensOption() = 0;
<a name="l02757"></a>02757 
<a name="l02758"></a>02758         <span class="comment">// Returns the extra width that will be consumed by a hyphen. This should</span>
<a name="l02759"></a>02759         <span class="comment">// be constant for a given textrun.</span>
<a name="l02760"></a>02760         <span class="keyword">virtual</span> <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> GetHyphenWidth() = 0;
<a name="l02761"></a>02761 
<a name="l02762"></a><a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html#acc7042afb87b37c90de23eb819562da3">02762</a>         <span class="keyword">typedef</span> <a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html">gfxFont::Spacing</a> <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html#acc7042afb87b37c90de23eb819562da3">Spacing</a>;
<a name="l02763"></a>02763 
<a name="l02770"></a>02770         <span class="keyword">virtual</span> <span class="keywordtype">void</span> GetSpacing(uint32_t aStart, uint32_t aLength,
<a name="l02771"></a>02771                                 <a class="code" href="../../d6/dc8/structgfx_font_1_1_spacing.html">Spacing</a> *aSpacing) = 0;
<a name="l02772"></a>02772     };
<a name="l02773"></a>02773 
<a name="l02774"></a><a class="code" href="../../d8/d25/classgfx_text_run_1_1_cluster_iterator.html">02774</a>     <span class="keyword">class </span><a class="code" href="../../d8/d25/classgfx_text_run_1_1_cluster_iterator.html">ClusterIterator</a> {
<a name="l02775"></a>02775     <span class="keyword">public</span>:
<a name="l02776"></a>02776         <a class="code" href="../../d8/d25/classgfx_text_run_1_1_cluster_iterator.html">ClusterIterator</a>(<a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun);
<a name="l02777"></a>02777 
<a name="l02778"></a>02778         <span class="keywordtype">void</span> Reset();
<a name="l02779"></a>02779 
<a name="l02780"></a>02780         <span class="keywordtype">bool</span> NextCluster();
<a name="l02781"></a>02781 
<a name="l02782"></a><a class="code" href="../../d8/d25/classgfx_text_run_1_1_cluster_iterator.html#a6bad8aefe7f1d49f946c4873e94f0c8a">02782</a>         uint32_t <a class="code" href="../../d8/d25/classgfx_text_run_1_1_cluster_iterator.html#a6bad8aefe7f1d49f946c4873e94f0c8a">Position</a>()<span class="keyword"> const </span>{
<a name="l02783"></a>02783             <span class="keywordflow">return</span> mCurrentChar;
<a name="l02784"></a>02784         }
<a name="l02785"></a>02785 
<a name="l02786"></a>02786         uint32_t ClusterLength() <span class="keyword">const</span>;
<a name="l02787"></a>02787 
<a name="l02788"></a>02788         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> ClusterAdvance(<a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider) <span class="keyword">const</span>;
<a name="l02789"></a>02789 
<a name="l02790"></a>02790     <span class="keyword">private</span>:
<a name="l02791"></a>02791         <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *mTextRun;
<a name="l02792"></a>02792         uint32_t    mCurrentChar;
<a name="l02793"></a>02793     };
<a name="l02794"></a>02794 
<a name="l02816"></a>02816     <span class="keywordtype">void</span> Draw(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext, <a class="code" href="../../d6/dfb/structgfx_point.html">gfxPoint</a> aPt,
<a name="l02817"></a>02817               <a class="code" href="../../dc/d81/classgfx_font.html#a9b33c26df66150f3fbcaa055744b5ceb">gfxFont::DrawMode</a> aDrawMode,
<a name="l02818"></a>02818               uint32_t aStart, uint32_t aLength,
<a name="l02819"></a>02819               PropertyProvider *aProvider,
<a name="l02820"></a>02820               <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> *aAdvanceWidth, <a class="code" href="../../d2/d0c/classgfx_text_object_paint.html">gfxTextObjectPaint</a> *aObjectPaint,
<a name="l02821"></a>02821               <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">gfxTextRunDrawCallbacks</a> *aCallbacks = <span class="keyword">nullptr</span>);
<a name="l02822"></a>02822 
<a name="l02828"></a>02828     Metrics MeasureText(uint32_t aStart, uint32_t aLength,
<a name="l02829"></a>02829                         <a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1">gfxFont::BoundingBoxType</a> aBoundingBoxType,
<a name="l02830"></a>02830                         <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aRefContextForTightBoundingBox,
<a name="l02831"></a>02831                         PropertyProvider *aProvider);
<a name="l02832"></a>02832 
<a name="l02837"></a>02837     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> GetAdvanceWidth(uint32_t aStart, uint32_t aLength,
<a name="l02838"></a>02838                              PropertyProvider *aProvider);
<a name="l02839"></a>02839 
<a name="l02867"></a>02867     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> SetLineBreaks(uint32_t aStart, uint32_t aLength,
<a name="l02868"></a>02868                                  <span class="keywordtype">bool</span> aLineBreakBefore, <span class="keywordtype">bool</span> aLineBreakAfter,
<a name="l02869"></a>02869                                  <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> *aAdvanceWidthDelta,
<a name="l02870"></a>02870                                  <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aRefContext);
<a name="l02871"></a>02871 
<a name="l02930"></a>02930     uint32_t BreakAndMeasureText(uint32_t aStart, uint32_t aMaxLength,
<a name="l02931"></a>02931                                  <span class="keywordtype">bool</span> aLineBreakBefore, <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> aWidth,
<a name="l02932"></a>02932                                  PropertyProvider *aProvider,
<a name="l02933"></a>02933                                  <span class="keywordtype">bool</span> aSuppressInitialBreak,
<a name="l02934"></a>02934                                  <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> *aTrimWhitespace,
<a name="l02935"></a>02935                                  Metrics *aMetrics,
<a name="l02936"></a>02936                                  <a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1">gfxFont::BoundingBoxType</a> aBoundingBoxType,
<a name="l02937"></a>02937                                  <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aRefContextForTightBoundingBox,
<a name="l02938"></a>02938                                  <span class="keywordtype">bool</span> *aUsedHyphenation,
<a name="l02939"></a>02939                                  uint32_t *aLastBreak,
<a name="l02940"></a>02940                                  <span class="keywordtype">bool</span> aCanWordWrap,
<a name="l02941"></a>02941                                  <a class="code" href="../../d7/db4/gfx_types_8h.html#a4071fec3b9199b5406b405c234e537ef">gfxBreakPriority</a> *aBreakPriority);
<a name="l02942"></a>02942 
<a name="l02948"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#ab2115aed2941dda8378098393d044cfe">02948</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#ab2115aed2941dda8378098393d044cfe">SetContext</a>(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext) {}
<a name="l02949"></a>02949 
<a name="l02950"></a>02950     <span class="comment">// Utility getters</span>
<a name="l02951"></a>02951 
<a name="l02952"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a93da73fe543581cabdc747f031886e96">02952</a>     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a93da73fe543581cabdc747f031886e96">GetDirection</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (mFlags &amp; <a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba1f3d5fd55670b77fedcae547574193db">gfxTextRunFactory::TEXT_IS_RTL</a>) ? -1.0 : 1.0; }
<a name="l02953"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#ab3d29cdcef7df09f68a91c818f3e8236">02953</a>     <span class="keywordtype">void</span> *<a class="code" href="../../d6/d7e/classgfx_text_run.html#ab3d29cdcef7df09f68a91c818f3e8236">GetUserData</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mUserData; }
<a name="l02954"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a30f2e629a739a86eaaad691b9a4ba5ed">02954</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a30f2e629a739a86eaaad691b9a4ba5ed">SetUserData</a>(<span class="keywordtype">void</span> *aUserData) { mUserData = aUserData; }
<a name="l02955"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a98073764051584018bd6a9ceaefc4418">02955</a>     uint32_t <a class="code" href="../../d6/d7e/classgfx_text_run.html#a98073764051584018bd6a9ceaefc4418">GetFlags</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mFlags; }
<a name="l02956"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#ad1eb56fd41b48e59e5001ef643351cfe">02956</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#ad1eb56fd41b48e59e5001ef643351cfe">SetFlagBits</a>(uint32_t aFlags) {
<a name="l02957"></a>02957       <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!(aFlags &amp; ~<a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba97f5496a403e41e42093662c29364adb">gfxTextRunFactory::SETTABLE_FLAGS</a>),
<a name="l02958"></a>02958                    <span class="stringliteral">&quot;Only user flags should be mutable&quot;</span>);
<a name="l02959"></a>02959       mFlags |= aFlags;
<a name="l02960"></a>02960     }
<a name="l02961"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a644b16919d9ba43245211e374d5a6b02">02961</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a644b16919d9ba43245211e374d5a6b02">ClearFlagBits</a>(uint32_t aFlags) {
<a name="l02962"></a>02962       <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!(aFlags &amp; ~<a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27ba97f5496a403e41e42093662c29364adb">gfxTextRunFactory::SETTABLE_FLAGS</a>),
<a name="l02963"></a>02963                    <span class="stringliteral">&quot;Only user flags should be mutable&quot;</span>);
<a name="l02964"></a>02964       mFlags &amp;= ~aFlags;
<a name="l02965"></a>02965     }
<a name="l02966"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#aec26ad61525395de0a5a9a4dd01d4d4a">02966</a>     <span class="keyword">const</span> <a class="code" href="../../df/d0d/classgfx_skip_chars.html">gfxSkipChars</a>&amp; <a class="code" href="../../d6/d7e/classgfx_text_run.html#aec26ad61525395de0a5a9a4dd01d4d4a">GetSkipChars</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mSkipChars; }
<a name="l02967"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a780142a88d389dd07f4693f2059fc7ac">02967</a>     <a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a> *<a class="code" href="../../d6/d7e/classgfx_text_run.html#a780142a88d389dd07f4693f2059fc7ac">GetFontGroup</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mFontGroup; }
<a name="l02968"></a>02968 
<a name="l02969"></a>02969 
<a name="l02970"></a>02970     <span class="comment">// Call this, don&#39;t call &quot;new gfxTextRun&quot; directly. This does custom</span>
<a name="l02971"></a>02971     <span class="comment">// allocation and initialization</span>
<a name="l02972"></a>02972     <span class="keyword">static</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *<a class="code" href="../../d3/df6/namespacemozilla_1_1layers_1_1_compositable_map.html#aa82599b1b1ccdeb4aa199b742a63322b">Create</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html">gfxTextRunFactory::Parameters</a> *aParams,
<a name="l02973"></a>02973                               uint32_t aLength, <a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a> *aFontGroup,
<a name="l02974"></a>02974                               uint32_t aFlags);
<a name="l02975"></a>02975 
<a name="l02976"></a>02976     <span class="comment">// The text is divided into GlyphRuns as necessary</span>
<a name="l02977"></a><a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">02977</a>     <span class="keyword">struct </span><a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">GlyphRun</a> {
<a name="l02978"></a><a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a47bb9ee4fa4e00ff5ab0063a93ada999">02978</a>         <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFont&gt;</a> <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a47bb9ee4fa4e00ff5ab0063a93ada999">mFont</a>;   <span class="comment">// never null</span>
<a name="l02979"></a><a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a0fb68626ffba3c1443662e09d3d21fb0">02979</a>         uint32_t          <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a0fb68626ffba3c1443662e09d3d21fb0">mCharacterOffset</a>; <span class="comment">// into original UTF16 string</span>
<a name="l02980"></a><a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a090700108578f59ac010d4eb4db95493">02980</a>         uint8_t           <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a090700108578f59ac010d4eb4db95493">mMatchType</a>;
<a name="l02981"></a>02981     };
<a name="l02982"></a>02982 
<a name="l02983"></a><a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html">02983</a>     <span class="keyword">class </span><a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html">GlyphRunIterator</a> {
<a name="l02984"></a>02984     <span class="keyword">public</span>:
<a name="l02985"></a><a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html#a5f09f64061fdcb33543cf082f647c942">02985</a>         <a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html">GlyphRunIterator</a>(<a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun, uint32_t aStart, uint32_t aLength)
<a name="l02986"></a>02986           : mTextRun(aTextRun), mStartOffset(aStart), mEndOffset(aStart + aLength) {
<a name="l02987"></a>02987             mNextIndex = mTextRun-&gt;FindFirstGlyphRunContaining(aStart);
<a name="l02988"></a>02988         }
<a name="l02989"></a>02989         <span class="keywordtype">bool</span> NextRun();
<a name="l02990"></a><a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html#ad315d8a259effb512d604ca3ecd0e9fe">02990</a>         <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">GlyphRun</a> *<a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html#ad315d8a259effb512d604ca3ecd0e9fe">GetGlyphRun</a>() { <span class="keywordflow">return</span> mGlyphRun; }
<a name="l02991"></a><a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html#ad0c556332af47a92d5c18c3dc76a6753">02991</a>         uint32_t <a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html#ad0c556332af47a92d5c18c3dc76a6753">GetStringStart</a>() { <span class="keywordflow">return</span> mStringStart; }
<a name="l02992"></a><a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html#aca017484a621fd04041d8fe3de00c433">02992</a>         uint32_t <a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html#aca017484a621fd04041d8fe3de00c433">GetStringEnd</a>() { <span class="keywordflow">return</span> mStringEnd; }
<a name="l02993"></a>02993     <span class="keyword">private</span>:
<a name="l02994"></a>02994         <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *mTextRun;
<a name="l02995"></a>02995         <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">GlyphRun</a>   *mGlyphRun;
<a name="l02996"></a>02996         uint32_t    mStringStart;
<a name="l02997"></a>02997         uint32_t    mStringEnd;
<a name="l02998"></a>02998         uint32_t    mNextIndex;
<a name="l02999"></a>02999         uint32_t    mStartOffset;
<a name="l03000"></a>03000         uint32_t    mEndOffset;
<a name="l03001"></a>03001     };
<a name="l03002"></a>03002 
<a name="l03003"></a><a class="code" href="../../d4/db2/classgfx_text_run_1_1_glyph_run_offset_comparator.html">03003</a>     <span class="keyword">class </span><a class="code" href="../../d4/db2/classgfx_text_run_1_1_glyph_run_offset_comparator.html">GlyphRunOffsetComparator</a> {
<a name="l03004"></a>03004     <span class="keyword">public</span>:
<a name="l03005"></a><a class="code" href="../../d4/db2/classgfx_text_run_1_1_glyph_run_offset_comparator.html#aabd99e00c2afe28eb9bf860d8b662497">03005</a>         <span class="keywordtype">bool</span> Equals(<span class="keyword">const</span> <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">GlyphRun</a>&amp; <a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a>,
<a name="l03006"></a>03006                       <span class="keyword">const</span> <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">GlyphRun</a>&amp; <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>)<span class="keyword"> const</span>
<a name="l03007"></a>03007 <span class="keyword">        </span>{
<a name="l03008"></a>03008             <span class="keywordflow">return</span> a.<a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a0fb68626ffba3c1443662e09d3d21fb0">mCharacterOffset</a> == b.<a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a0fb68626ffba3c1443662e09d3d21fb0">mCharacterOffset</a>;
<a name="l03009"></a>03009         }
<a name="l03010"></a>03010 
<a name="l03011"></a><a class="code" href="../../d4/db2/classgfx_text_run_1_1_glyph_run_offset_comparator.html#a6a6c5d0f5391362746c5e3ced8cce69c">03011</a>         <span class="keywordtype">bool</span> LessThan(<span class="keyword">const</span> <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">GlyphRun</a>&amp; <a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a>,
<a name="l03012"></a>03012                         <span class="keyword">const</span> <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">GlyphRun</a>&amp; <a class="code" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>)<span class="keyword"> const</span>
<a name="l03013"></a>03013 <span class="keyword">        </span>{
<a name="l03014"></a>03014             <span class="keywordflow">return</span> a.<a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a0fb68626ffba3c1443662e09d3d21fb0">mCharacterOffset</a> &lt; b.<a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html#a0fb68626ffba3c1443662e09d3d21fb0">mCharacterOffset</a>;
<a name="l03015"></a>03015         }
<a name="l03016"></a>03016     };
<a name="l03017"></a>03017 
<a name="l03018"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a1137049b9d843eb95952d0d04f8bb5d9">03018</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../d2/d5a/classgfx_text_run_1_1_glyph_run_iterator.html">GlyphRunIterator</a>;
<a name="l03019"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a5173a23bd8898a9f01e2f2570e0d2322">03019</a>     <span class="keyword">friend</span> <span class="keyword">class </span>FontSelector;
<a name="l03020"></a>03020 
<a name="l03021"></a>03021     <span class="comment">// API for setting up the textrun glyphs. Should only be called by</span>
<a name="l03022"></a>03022     <span class="comment">// things that construct textruns.</span>
<a name="l03036"></a>03036 <span class="comment"></span>    <a class="code" href="../../d8/dcf/ns_error_8h.html#ae1573874dc40023f078c3a69c4ce4538">nsresult</a> AddGlyphRun(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont, uint8_t aMatchType,
<a name="l03037"></a>03037                          uint32_t aStartCharIndex, <span class="keywordtype">bool</span> aForceNewRun);
<a name="l03038"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a54a2aaf2912f4dc440fdc97661475e5b">03038</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a54a2aaf2912f4dc440fdc97661475e5b">ResetGlyphRuns</a>() { mGlyphRuns.Clear(); }
<a name="l03039"></a>03039     <span class="keywordtype">void</span> SortGlyphRuns();
<a name="l03040"></a>03040     <span class="keywordtype">void</span> SanitizeGlyphRuns();
<a name="l03041"></a>03041 
<a name="l03042"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a58d2ed39926105b20159f16ca9472752">03042</a>     <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>* <a class="code" href="../../d6/d7e/classgfx_text_run.html#a58d2ed39926105b20159f16ca9472752">GetCharacterGlyphs</a>() {
<a name="l03043"></a>03043         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(mCharacterGlyphs, <span class="stringliteral">&quot;failed to initialize mCharacterGlyphs&quot;</span>);
<a name="l03044"></a>03044         <span class="keywordflow">return</span> mCharacterGlyphs;
<a name="l03045"></a>03045     }
<a name="l03046"></a>03046 
<a name="l03047"></a>03047     <span class="keywordtype">void</span> SetSpaceGlyph(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont, <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext, uint32_t aCharIndex);
<a name="l03048"></a>03048 
<a name="l03049"></a>03049     <span class="comment">// Set the glyph data for the given character index to the font&#39;s</span>
<a name="l03050"></a>03050     <span class="comment">// space glyph, IF this can be done as a &quot;simple&quot; glyph record</span>
<a name="l03051"></a>03051     <span class="comment">// (not requiring a DetailedGlyph entry). This avoids the need to call</span>
<a name="l03052"></a>03052     <span class="comment">// the font shaper and go through the shaped-word cache for most spaces.</span>
<a name="l03053"></a>03053     <span class="comment">//</span>
<a name="l03054"></a>03054     <span class="comment">// The parameter aSpaceChar is the original character code for which</span>
<a name="l03055"></a>03055     <span class="comment">// this space glyph is being used; if this is U+0020, we need to record</span>
<a name="l03056"></a>03056     <span class="comment">// that it could be trimmed at a run edge, whereas other kinds of space</span>
<a name="l03057"></a>03057     <span class="comment">// (currently just U+00A0) would not be trimmable/breakable.</span>
<a name="l03058"></a>03058     <span class="comment">//</span>
<a name="l03059"></a>03059     <span class="comment">// Returns true if it was able to set simple glyph data for the space;</span>
<a name="l03060"></a>03060     <span class="comment">// if it returns false, the caller needs to fall back to some other</span>
<a name="l03061"></a>03061     <span class="comment">// means to create the necessary (detailed) glyph data.</span>
<a name="l03062"></a>03062     <span class="keywordtype">bool</span> SetSpaceGlyphIfSimple(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont, <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l03063"></a>03063                                uint32_t aCharIndex, PRUnichar aSpaceChar);
<a name="l03064"></a>03064 
<a name="l03065"></a>03065     <span class="comment">// Record the positions of specific characters that layout may need to</span>
<a name="l03066"></a>03066     <span class="comment">// detect in the textrun, even though it doesn&#39;t have an explicit copy</span>
<a name="l03067"></a>03067     <span class="comment">// of the original text. These are recorded using flag bits in the</span>
<a name="l03068"></a>03068     <span class="comment">// CompressedGlyph record; if necessary, we convert &quot;simple&quot; glyph records</span>
<a name="l03069"></a>03069     <span class="comment">// to &quot;complex&quot; ones as the Tab and Newline flags are not present in</span>
<a name="l03070"></a>03070     <span class="comment">// simple CompressedGlyph records.</span>
<a name="l03071"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#aca4421999fd107f4168f2908630e52ea">03071</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#aca4421999fd107f4168f2908630e52ea">SetIsTab</a>(uint32_t aIndex) {
<a name="l03072"></a>03072         <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a> *<a class="code" href="../../d8/dad/apps_2email_2js_2ext_2mailapi_2chewlayer_8js.html#a73c18c59a39b18382081ec00bb456d43">g</a> = &amp;mCharacterGlyphs[aIndex];
<a name="l03073"></a>03073         <span class="keywordflow">if</span> (g-&gt;<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa1b4789c1a7f3cc3d116cd439d69d206">IsSimpleGlyph</a>()) {
<a name="l03074"></a>03074             <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a> *details = AllocateDetailedGlyphs(aIndex, 1);
<a name="l03075"></a>03075             details-&gt;<a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#acb7ff3ba02876492b905d13cbc63fa03">mGlyphID</a> = g-&gt;<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a65ef18ce918ee31e675a40834bd2b653">GetSimpleGlyph</a>();
<a name="l03076"></a>03076             details-&gt;<a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#ac3758cdc27183767cef8d67a4d1d493b">mAdvance</a> = g-&gt;<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a2261ad0ebfc0eafd2d32f2d3ae5bdf21">GetSimpleAdvance</a>();
<a name="l03077"></a>03077             details-&gt;<a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#ae9af22ac4e0e2103d0012feccebe537a">mXOffset</a> = details-&gt;<a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#a12f6eca7c139d117b45b08584a0ce701">mYOffset</a> = 0;
<a name="l03078"></a>03078             SetGlyphs(aIndex, <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>().SetComplex(<span class="keyword">true</span>, <span class="keyword">true</span>, 1), details);
<a name="l03079"></a>03079         }
<a name="l03080"></a>03080         g-&gt;<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa44b24843b5a637604f8c9cb5d7c5877">SetIsTab</a>();
<a name="l03081"></a>03081     }
<a name="l03082"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#a1b349e3ea238e8ac0f7e9c39495df14f">03082</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#a1b349e3ea238e8ac0f7e9c39495df14f">SetIsNewline</a>(uint32_t aIndex) {
<a name="l03083"></a>03083         <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a> *<a class="code" href="../../d8/dad/apps_2email_2js_2ext_2mailapi_2chewlayer_8js.html#a73c18c59a39b18382081ec00bb456d43">g</a> = &amp;mCharacterGlyphs[aIndex];
<a name="l03084"></a>03084         <span class="keywordflow">if</span> (g-&gt;<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#aa1b4789c1a7f3cc3d116cd439d69d206">IsSimpleGlyph</a>()) {
<a name="l03085"></a>03085             <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a> *details = AllocateDetailedGlyphs(aIndex, 1);
<a name="l03086"></a>03086             details-&gt;<a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#acb7ff3ba02876492b905d13cbc63fa03">mGlyphID</a> = g-&gt;<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a65ef18ce918ee31e675a40834bd2b653">GetSimpleGlyph</a>();
<a name="l03087"></a>03087             details-&gt;<a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#ac3758cdc27183767cef8d67a4d1d493b">mAdvance</a> = g-&gt;<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a2261ad0ebfc0eafd2d32f2d3ae5bdf21">GetSimpleAdvance</a>();
<a name="l03088"></a>03088             details-&gt;<a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#ae9af22ac4e0e2103d0012feccebe537a">mXOffset</a> = details-&gt;<a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html#a12f6eca7c139d117b45b08584a0ce701">mYOffset</a> = 0;
<a name="l03089"></a>03089             SetGlyphs(aIndex, <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>().SetComplex(<span class="keyword">true</span>, <span class="keyword">true</span>, 1), details);
<a name="l03090"></a>03090         }
<a name="l03091"></a>03091         g-&gt;<a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html#a498a29d50834c2ccec4028be2592fd8c">SetIsNewline</a>();
<a name="l03092"></a>03092     }
<a name="l03093"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#acd18e9b25282934dfdd9883d3be21900">03093</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#acd18e9b25282934dfdd9883d3be21900">SetIsLowSurrogate</a>(uint32_t aIndex) {
<a name="l03094"></a>03094         SetGlyphs(aIndex, <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a>().SetComplex(<span class="keyword">false</span>, <span class="keyword">false</span>, 0), <span class="keyword">nullptr</span>);
<a name="l03095"></a>03095         mCharacterGlyphs[aIndex].SetIsLowSurrogate();
<a name="l03096"></a>03096     }
<a name="l03097"></a>03097 
<a name="l03104"></a>03104     <span class="keywordtype">void</span> FetchGlyphExtents(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aRefContext);
<a name="l03105"></a>03105 
<a name="l03106"></a>03106     uint32_t CountMissingGlyphs();
<a name="l03107"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#abfcac78d6f95468b083d8bfb9c756f0d">03107</a>     <span class="keyword">const</span> <a class="code" href="../../d7/dd9/structgfx_text_run_1_1_glyph_run.html">GlyphRun</a> *<a class="code" href="../../d6/d7e/classgfx_text_run.html#abfcac78d6f95468b083d8bfb9c756f0d">GetGlyphRuns</a>(uint32_t *aNumGlyphRuns) {
<a name="l03108"></a>03108         *aNumGlyphRuns = mGlyphRuns.Length();
<a name="l03109"></a>03109         <span class="keywordflow">return</span> mGlyphRuns.Elements();
<a name="l03110"></a>03110     }
<a name="l03111"></a>03111     <span class="comment">// Returns the index of the GlyphRun containing the given offset.</span>
<a name="l03112"></a>03112     <span class="comment">// Returns mGlyphRuns.Length() when aOffset is mCharacterCount.</span>
<a name="l03113"></a>03113     uint32_t FindFirstGlyphRunContaining(uint32_t aOffset);
<a name="l03114"></a>03114 
<a name="l03115"></a>03115     <span class="comment">// Copy glyph data from a ShapedWord into this textrun.</span>
<a name="l03116"></a>03116     <span class="keywordtype">void</span> CopyGlyphDataFrom(<a class="code" href="../../d0/d86/classgfx_shaped_word.html">gfxShapedWord</a> *aSource, uint32_t aStart);
<a name="l03117"></a>03117 
<a name="l03118"></a>03118     <span class="comment">// Copy glyph data for a range of characters from aSource to this</span>
<a name="l03119"></a>03119     <span class="comment">// textrun.</span>
<a name="l03120"></a>03120     <span class="keywordtype">void</span> CopyGlyphDataFrom(<a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aSource, uint32_t aStart,
<a name="l03121"></a>03121                            uint32_t aLength, uint32_t aDest);
<a name="l03122"></a>03122 
<a name="l03123"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#afadb79fb5d309cf0a6c3cd6b5b6739c5">03123</a>     <a class="code" href="../../d9/d67/structns_expiration_state.html">nsExpirationState</a> *<a class="code" href="../../d6/d7e/classgfx_text_run.html#afadb79fb5d309cf0a6c3cd6b5b6739c5">GetExpirationState</a>() { <span class="keywordflow">return</span> &amp;mExpirationState; }
<a name="l03124"></a>03124 
<a name="l03125"></a>03125     <span class="comment">// Tell the textrun to release its reference to its creating gfxFontGroup</span>
<a name="l03126"></a>03126     <span class="comment">// immediately, rather than on destruction. This is used for textruns</span>
<a name="l03127"></a>03127     <span class="comment">// that are actually owned by a gfxFontGroup, so that they don&#39;t keep it</span>
<a name="l03128"></a>03128     <span class="comment">// permanently alive due to a circular reference. (The caller of this is</span>
<a name="l03129"></a>03129     <span class="comment">// taking responsibility for ensuring the textrun will not outlive its</span>
<a name="l03130"></a>03130     <span class="comment">// mFontGroup.)</span>
<a name="l03131"></a>03131     <span class="keywordtype">void</span> ReleaseFontGroup();
<a name="l03132"></a>03132 
<a name="l03133"></a><a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html">03133</a>     <span class="keyword">struct </span><a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html">LigatureData</a> {
<a name="l03134"></a>03134         <span class="comment">// textrun offsets of the start and end of the containing ligature</span>
<a name="l03135"></a><a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#a75719e0e20976c85698933b4e1c9d180">03135</a>         uint32_t <a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#a75719e0e20976c85698933b4e1c9d180">mLigatureStart</a>;
<a name="l03136"></a><a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#addac56ec40dfb969a243d7cd68056495">03136</a>         uint32_t <a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#addac56ec40dfb969a243d7cd68056495">mLigatureEnd</a>;
<a name="l03137"></a>03137         <span class="comment">// appunits advance to the start of the ligature part within the ligature;</span>
<a name="l03138"></a>03138         <span class="comment">// never includes any spacing</span>
<a name="l03139"></a><a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#a526b5f49b8335090106b40521bc36d35">03139</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#a526b5f49b8335090106b40521bc36d35">mPartAdvance</a>;
<a name="l03140"></a>03140         <span class="comment">// appunits width of the ligature part; includes before-spacing</span>
<a name="l03141"></a>03141         <span class="comment">// when the part is at the start of the ligature, and after-spacing</span>
<a name="l03142"></a>03142         <span class="comment">// when the part is as the end of the ligature</span>
<a name="l03143"></a><a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#af7cc219fd3a292dde9cc1931858b0539">03143</a>         <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#af7cc219fd3a292dde9cc1931858b0539">mPartWidth</a>;
<a name="l03144"></a>03144         
<a name="l03145"></a><a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#ac777b3eff3a9dc0224589291852ec923">03145</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#ac777b3eff3a9dc0224589291852ec923">mClipBeforePart</a>;
<a name="l03146"></a><a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#a5272609301a6662b7f509f0db7f3dace">03146</a>         <span class="keywordtype">bool</span> <a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html#a5272609301a6662b7f509f0db7f3dace">mClipAfterPart</a>;
<a name="l03147"></a>03147     };
<a name="l03148"></a>03148     
<a name="l03149"></a>03149     <span class="comment">// return storage used by this run, for memory reporter;</span>
<a name="l03150"></a>03150     <span class="comment">// nsTransformedTextRun needs to override this as it holds additional data</span>
<a name="l03151"></a>03151     <span class="keyword">virtual</span> <span class="keywordtype">size_t</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#ab5cab932a233f5b8e7e9d4ab573ce1ae">SizeOfExcludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf)
<a name="l03152"></a>03152       MOZ_MUST_OVERRIDE;
<a name="l03153"></a>03153     <span class="keyword">virtual</span> <span class="keywordtype">size_t</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0d234da521191615bfac5564c1648368">SizeOfIncludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf)
<a name="l03154"></a>03154       MOZ_MUST_OVERRIDE;
<a name="l03155"></a>03155 
<a name="l03156"></a>03156     <span class="comment">// Get the size, if it hasn&#39;t already been gotten, marking as it goes.</span>
<a name="l03157"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#aa8cbf7d1a42c5c4f84c6d32980598b22">03157</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#aa8cbf7d1a42c5c4f84c6d32980598b22">MaybeSizeOfIncludingThis</a>(mozilla::MallocSizeOf aMallocSizeOf)  {
<a name="l03158"></a>03158         <span class="keywordflow">if</span> (mFlags &amp; <a class="code" href="../../dd/d10/classgfx_text_run_factory.html#aade01ebccd7f3dda404e616bf712b27baf1ba25481e313f31f38125b2dced0e13">gfxTextRunFactory::TEXT_RUN_SIZE_ACCOUNTED</a>) {
<a name="l03159"></a>03159             <span class="keywordflow">return</span> 0;
<a name="l03160"></a>03160         }
<a name="l03161"></a>03161         mFlags |= gfxTextRunFactory::TEXT_RUN_SIZE_ACCOUNTED;
<a name="l03162"></a>03162         <span class="keywordflow">return</span> <a class="code" href="../../de/d12/classgfx_font_entry.html#a0d234da521191615bfac5564c1648368">SizeOfIncludingThis</a>(aMallocSizeOf);
<a name="l03163"></a>03163     }
<a name="l03164"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#aaf8fb4414f14ad6008d3daa1a8075a00">03164</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html#aaf8fb4414f14ad6008d3daa1a8075a00">ResetSizeOfAccountingFlags</a>() {
<a name="l03165"></a>03165         mFlags &amp;= ~<a class="code" href="../../dd/d10/classgfx_text_run_factory.html">gfxTextRunFactory</a>::TEXT_RUN_SIZE_ACCOUNTED;
<a name="l03166"></a>03166     }
<a name="l03167"></a>03167 
<a name="l03168"></a>03168 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l03169"></a>03169 <span class="preprocessor"></span>    <span class="keywordtype">void</span> Dump(<a class="code" href="../../d1/ddf/ns_i_content_viewer_file_8idl.html#a2a9799b7b2af884315027dd95725e0c3">FILE</a>* aOutput);
<a name="l03170"></a>03170 <span class="preprocessor">#endif</span>
<a name="l03171"></a>03171 <span class="preprocessor"></span>
<a name="l03172"></a>03172 <span class="keyword">protected</span>:
<a name="l03179"></a>03179     <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html">gfxTextRunFactory::Parameters</a> *aParams,
<a name="l03180"></a>03180                uint32_t aLength, <a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a> *aFontGroup, uint32_t aFlags);
<a name="l03181"></a>03181 
<a name="l03187"></a>03187     <span class="keyword">static</span> <span class="keywordtype">void</span>* AllocateStorageForTextRun(<span class="keywordtype">size_t</span> aSize, uint32_t aLength);
<a name="l03188"></a>03188 
<a name="l03189"></a>03189     <span class="comment">// Pointer to the array of CompressedGlyph records; must be initialized</span>
<a name="l03190"></a>03190     <span class="comment">// when the object is constructed.</span>
<a name="l03191"></a><a class="code" href="../../d6/d7e/classgfx_text_run.html#add3fc6332a93d99ed757209bae9959b8">03191</a>     <a class="code" href="../../d9/d7c/classgfx_shaped_text_1_1_compressed_glyph.html">CompressedGlyph</a> *<a class="code" href="../../d6/d7e/classgfx_text_run.html#add3fc6332a93d99ed757209bae9959b8">mCharacterGlyphs</a>;
<a name="l03192"></a>03192 
<a name="l03193"></a>03193 <span class="keyword">private</span>:
<a name="l03194"></a>03194     <span class="comment">// **** general helpers **** </span>
<a name="l03195"></a>03195 
<a name="l03196"></a>03196     <span class="comment">// Allocate aCount DetailedGlyphs for the given index</span>
<a name="l03197"></a>03197     <a class="code" href="../../d5/d7a/structgfx_shaped_text_1_1_detailed_glyph.html">DetailedGlyph</a> *AllocateDetailedGlyphs(uint32_t aCharIndex, uint32_t aCount);
<a name="l03198"></a>03198 
<a name="l03199"></a>03199     <span class="comment">// Get the total advance for a range of glyphs.</span>
<a name="l03200"></a>03200     int32_t GetAdvanceForGlyphs(uint32_t aStart, uint32_t aEnd);
<a name="l03201"></a>03201 
<a name="l03202"></a>03202     <span class="comment">// Spacing for characters outside the range aSpacingStart/aSpacingEnd</span>
<a name="l03203"></a>03203     <span class="comment">// is assumed to be zero; such characters are not passed to aProvider.</span>
<a name="l03204"></a>03204     <span class="comment">// This is useful to protect aProvider from being passed character indices</span>
<a name="l03205"></a>03205     <span class="comment">// it is not currently able to handle.</span>
<a name="l03206"></a>03206     <span class="keywordtype">bool</span> GetAdjustedSpacingArray(uint32_t aStart, uint32_t aEnd,
<a name="l03207"></a>03207                                    <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider,
<a name="l03208"></a>03208                                    uint32_t aSpacingStart, uint32_t aSpacingEnd,
<a name="l03209"></a>03209                                    <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;PropertyProvider::Spacing&gt;</a> *aSpacing);
<a name="l03210"></a>03210 
<a name="l03211"></a>03211     <span class="comment">//  **** ligature helpers ****</span>
<a name="l03212"></a>03212     <span class="comment">// (Platforms do the actual ligaturization, but we need to do a bunch of stuff</span>
<a name="l03213"></a>03213     <span class="comment">// to handle requests that begin or end inside a ligature)</span>
<a name="l03214"></a>03214 
<a name="l03215"></a>03215     <span class="comment">// if aProvider is null then mBeforeSpacing and mAfterSpacing are set to zero</span>
<a name="l03216"></a>03216     <a class="code" href="../../d2/d82/structgfx_text_run_1_1_ligature_data.html">LigatureData</a> ComputeLigatureData(uint32_t aPartStart, uint32_t aPartEnd,
<a name="l03217"></a>03217                                      <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider);
<a name="l03218"></a>03218     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> ComputePartialLigatureWidth(uint32_t aPartStart, uint32_t aPartEnd,
<a name="l03219"></a>03219                                          <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider);
<a name="l03220"></a>03220     <span class="keywordtype">void</span> DrawPartialLigature(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont, <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aCtx,
<a name="l03221"></a>03221                              uint32_t aStart, uint32_t aEnd, <a class="code" href="../../d6/dfb/structgfx_point.html">gfxPoint</a> *aPt,
<a name="l03222"></a>03222                              <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider,
<a name="l03223"></a>03223                              <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">gfxTextRunDrawCallbacks</a> *aCallbacks);
<a name="l03224"></a>03224     <span class="comment">// Advance aStart to the start of the nearest ligature; back up aEnd</span>
<a name="l03225"></a>03225     <span class="comment">// to the nearest ligature end; may result in *aStart == *aEnd</span>
<a name="l03226"></a>03226     <span class="keywordtype">void</span> ShrinkToLigatureBoundaries(uint32_t *aStart, uint32_t *aEnd);
<a name="l03227"></a>03227     <span class="comment">// result in appunits</span>
<a name="l03228"></a>03228     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> GetPartialLigatureWidth(uint32_t aStart, uint32_t aEnd, <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider);
<a name="l03229"></a>03229     <span class="keywordtype">void</span> AccumulatePartialLigatureMetrics(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont,
<a name="l03230"></a>03230                                           uint32_t aStart, uint32_t aEnd,
<a name="l03231"></a>03231                                           <a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1">gfxFont::BoundingBoxType</a> aBoundingBoxType,
<a name="l03232"></a>03232                                           <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aRefContext,
<a name="l03233"></a>03233                                           <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider,
<a name="l03234"></a>03234                                           <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html">Metrics</a> *aMetrics);
<a name="l03235"></a>03235 
<a name="l03236"></a>03236     <span class="comment">// **** measurement helper ****</span>
<a name="l03237"></a>03237     <span class="keywordtype">void</span> AccumulateMetricsForRun(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont, uint32_t aStart, uint32_t aEnd,
<a name="l03238"></a>03238                                  <a class="code" href="../../dc/d81/classgfx_font.html#a960f834bbed4e3660a767acc3c5968d1">gfxFont::BoundingBoxType</a> aBoundingBoxType,
<a name="l03239"></a>03239                                  <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aRefContext,
<a name="l03240"></a>03240                                  <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider,
<a name="l03241"></a>03241                                  uint32_t aSpacingStart, uint32_t aSpacingEnd,
<a name="l03242"></a>03242                                  <a class="code" href="../../d9/d04/structgfx_font_1_1_run_metrics.html">Metrics</a> *aMetrics);
<a name="l03243"></a>03243 
<a name="l03244"></a>03244     <span class="comment">// **** drawing helper ****</span>
<a name="l03245"></a>03245     <span class="keywordtype">void</span> DrawGlyphs(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aFont, <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l03246"></a>03246                     <a class="code" href="../../dc/d81/classgfx_font.html#a9b33c26df66150f3fbcaa055744b5ceb">gfxFont::DrawMode</a> aDrawMode, <a class="code" href="../../d6/dfb/structgfx_point.html">gfxPoint</a> *aPt,
<a name="l03247"></a>03247                     <a class="code" href="../../d2/d0c/classgfx_text_object_paint.html">gfxTextObjectPaint</a> *aObjectPaint, uint32_t aStart,
<a name="l03248"></a>03248                     uint32_t aEnd, <a class="code" href="../../d7/d3a/classgfx_text_run_1_1_property_provider.html">PropertyProvider</a> *aProvider,
<a name="l03249"></a>03249                     uint32_t aSpacingStart, uint32_t aSpacingEnd,
<a name="l03250"></a>03250                     <a class="code" href="../../dc/d9a/structgfx_text_run_draw_callbacks.html">gfxTextRunDrawCallbacks</a> *aCallbacks);
<a name="l03251"></a>03251 
<a name="l03252"></a>03252     <span class="comment">// XXX this should be changed to a GlyphRun plus a maybe-null GlyphRun*,</span>
<a name="l03253"></a>03253     <span class="comment">// for smaller size especially in the super-common one-glyphrun case</span>
<a name="l03254"></a>03254     <a class="code" href="../../d2/dcf/classns_auto_t_array.html">nsAutoTArray&lt;GlyphRun,1&gt;</a>        mGlyphRuns;
<a name="l03255"></a>03255 
<a name="l03256"></a>03256     <span class="keywordtype">void</span>             *mUserData;
<a name="l03257"></a>03257     <a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a>     *mFontGroup; <span class="comment">// addrefed on creation, but our reference</span>
<a name="l03258"></a>03258                                   <span class="comment">// may be released by ReleaseFontGroup()</span>
<a name="l03259"></a>03259     <a class="code" href="../../df/d0d/classgfx_skip_chars.html">gfxSkipChars</a>      mSkipChars;
<a name="l03260"></a>03260     <a class="code" href="../../d9/d67/structns_expiration_state.html">nsExpirationState</a> mExpirationState;
<a name="l03261"></a>03261 
<a name="l03262"></a>03262     <span class="keywordtype">bool</span>              mSkipDrawing; <span class="comment">// true if the font group we used had a user font</span>
<a name="l03263"></a>03263                                     <span class="comment">// download that&#39;s in progress, so we should hide text</span>
<a name="l03264"></a>03264                                     <span class="comment">// until the download completes (or timeout fires)</span>
<a name="l03265"></a>03265     <span class="keywordtype">bool</span>              mReleasedFontGroup; <span class="comment">// we already called NS_RELEASE on</span>
<a name="l03266"></a>03266                                           <span class="comment">// mFontGroup, so don&#39;t do it again</span>
<a name="l03267"></a>03267 };
<a name="l03268"></a>03268 
<a name="l03269"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html">03269</a> <span class="keyword">class </span><a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a> : <span class="keyword">public</span> <a class="code" href="../../dd/d10/classgfx_text_run_factory.html">gfxTextRunFactory</a> {
<a name="l03270"></a>03270 <span class="keyword">public</span>:
<a name="l03271"></a><a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html">03271</a>     <span class="keyword">class </span><a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html">FamilyFace</a> {
<a name="l03272"></a>03272     <span class="keyword">public</span>:
<a name="l03273"></a><a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html#ad716206f77b43ea4db0b6ed155dbe3b6">03273</a>         <a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html#ad716206f77b43ea4db0b6ed155dbe3b6">FamilyFace</a>() { }
<a name="l03274"></a>03274 
<a name="l03275"></a><a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html#a33830637b2120378f1244c3ea2452f76">03275</a>         <a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html">FamilyFace</a>(<a class="code" href="../../d8/d91/classgfx_font_family.html">gfxFontFamily</a>* aFamily, <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>* aFont)
<a name="l03276"></a>03276             : mFamily(aFamily), mFont(aFont)
<a name="l03277"></a>03277         {
<a name="l03278"></a>03278             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(aFont, <span class="stringliteral">&quot;font pointer must not be null&quot;</span>);
<a name="l03279"></a>03279             <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!aFamily ||
<a name="l03280"></a>03280                          aFamily-&gt;<a class="code" href="../../d8/d91/classgfx_font_family.html#a6034eba3f3334141001eae319a9c21a1">ContainsFace</a>(aFont-&gt;<a class="code" href="../../dc/d81/classgfx_font.html#a75d22d0c6b4b961be08421bd4503b0d2">GetFontEntry</a>()),
<a name="l03281"></a>03281                          <span class="stringliteral">&quot;font is not a member of the given family&quot;</span>);
<a name="l03282"></a>03282         }
<a name="l03283"></a>03283 
<a name="l03284"></a><a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html#afeeed08917791d0f8f15ef110a72f796">03284</a>         <a class="code" href="../../d8/d91/classgfx_font_family.html">gfxFontFamily</a>* <a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html#afeeed08917791d0f8f15ef110a72f796">Family</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mFamily.get(); }
<a name="l03285"></a><a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html#a354e1944638a7dfb4b3b847883cc7824">03285</a>         <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>* <a class="code" href="../../d8/dbc/classgfx_font_group_1_1_family_face.html#a354e1944638a7dfb4b3b847883cc7824">Font</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mFont.get(); }
<a name="l03286"></a>03286 
<a name="l03287"></a>03287     <span class="keyword">private</span>:
<a name="l03288"></a>03288         <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFontFamily&gt;</a> mFamily;
<a name="l03289"></a>03289         <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFont&gt;</a>       mFont;
<a name="l03290"></a>03290     };
<a name="l03291"></a>03291 
<a name="l03292"></a>03292     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d5e/namespacemozilla_1_1_hang_monitor.html#a091d1602e707e37271b31cecc2244fe2">Shutdown</a>(); <span class="comment">// platform must call this to release the languageAtomService</span>
<a name="l03293"></a>03293 
<a name="l03294"></a>03294     <a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a>(<span class="keyword">const</span> nsAString&amp; aFamilies, <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *aStyle, <a class="code" href="../../d8/de9/classgfx_user_font_set.html">gfxUserFontSet</a> *aUserFontSet = <span class="keyword">nullptr</span>);
<a name="l03295"></a>03295 
<a name="l03296"></a>03296     <span class="keyword">virtual</span> ~<a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a>();
<a name="l03297"></a>03297 
<a name="l03298"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a876e809e0be18fceef7561ca56afa211">03298</a>     <span class="keyword">virtual</span> <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *<a class="code" href="../../dd/d7c/classgfx_font_group.html#a876e809e0be18fceef7561ca56afa211">GetFontAt</a>(int32_t <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>) {
<a name="l03299"></a>03299         <span class="comment">// If it turns out to be hard for all clients that cache font</span>
<a name="l03300"></a>03300         <span class="comment">// groups to call UpdateFontList at appropriate times, we could</span>
<a name="l03301"></a>03301         <span class="comment">// instead consider just calling UpdateFontList from someplace</span>
<a name="l03302"></a>03302         <span class="comment">// more central (such as here).</span>
<a name="l03303"></a>03303         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(!mUserFontSet || mCurrGeneration == GetGeneration(),
<a name="l03304"></a>03304                      <span class="stringliteral">&quot;Whoever was caching this font group should have &quot;</span>
<a name="l03305"></a>03305                      <span class="stringliteral">&quot;called UpdateFontList on it&quot;</span>);
<a name="l03306"></a>03306         <a class="code" href="../../dc/d6d/ns_debug_8h.html#ad0ae7f43205a729107e59d101665b8fa">NS_ASSERTION</a>(mFonts.Length() &gt; uint32_t(i) &amp;&amp; mFonts[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].Font(), 
<a name="l03307"></a>03307                      <span class="stringliteral">&quot;Requesting a font index that doesn&#39;t exist&quot;</span>);
<a name="l03308"></a>03308 
<a name="l03309"></a>03309         <span class="keywordflow">return</span> mFonts[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].Font();
<a name="l03310"></a>03310     }
<a name="l03311"></a>03311 
<a name="l03312"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#af1e7ca89fe357bfcba167af0e2335c9b">03312</a>     uint32_t <a class="code" href="../../dd/d7c/classgfx_font_group.html#af1e7ca89fe357bfcba167af0e2335c9b">FontListLength</a>()<span class="keyword"> const </span>{
<a name="l03313"></a>03313         <span class="keywordflow">return</span> mFonts.Length();
<a name="l03314"></a>03314     }
<a name="l03315"></a>03315 
<a name="l03316"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#ad74198fca41e0323873753d6485df26f">03316</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dd/d7c/classgfx_font_group.html#ad74198fca41e0323873753d6485df26f">Equals</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a>&amp; other)<span class="keyword"> const </span>{
<a name="l03317"></a>03317         <span class="keywordflow">return</span> mFamilies.Equals(other.<a class="code" href="../../dd/d7c/classgfx_font_group.html#a918fadea89e82246de96b6e0011e58f2">mFamilies</a>) &amp;&amp;
<a name="l03318"></a>03318             mStyle.Equals(other.<a class="code" href="../../dd/d7c/classgfx_font_group.html#aaed8b4be04d7e49b36c2a79f86614f9e">mStyle</a>);
<a name="l03319"></a>03319     }
<a name="l03320"></a>03320 
<a name="l03321"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a19846dadffdacc3a0f16ec562b910045">03321</a>     <span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *<a class="code" href="../../dd/d7c/classgfx_font_group.html#a19846dadffdacc3a0f16ec562b910045">GetStyle</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> &amp;mStyle; }
<a name="l03322"></a>03322 
<a name="l03323"></a>03323     <span class="keyword">virtual</span> <a class="code" href="../../dd/d7c/classgfx_font_group.html">gfxFontGroup</a> *Copy(<span class="keyword">const</span> <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> *aStyle);
<a name="l03324"></a>03324 
<a name="l03329"></a>03329     <span class="keyword">static</span> <span class="keywordtype">bool</span> IsInvalidChar(uint8_t ch);
<a name="l03330"></a>03330     <span class="keyword">static</span> <span class="keywordtype">bool</span> IsInvalidChar(PRUnichar ch);
<a name="l03331"></a>03331 
<a name="l03338"></a>03338     <span class="keyword">virtual</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *MakeTextRun(<span class="keyword">const</span> PRUnichar *aString, uint32_t aLength,
<a name="l03339"></a>03339                                     <span class="keyword">const</span> Parameters *aParams, uint32_t aFlags);
<a name="l03346"></a>03346     <span class="keyword">virtual</span> <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *MakeTextRun(<span class="keyword">const</span> uint8_t *aString, uint32_t aLength,
<a name="l03347"></a>03347                                     <span class="keyword">const</span> Parameters *aParams, uint32_t aFlags);
<a name="l03348"></a>03348 
<a name="l03353"></a>03353     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03354"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a45ffe28219bad8793958c8c898d89751">03354</a>     <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *MakeTextRun(<span class="keyword">const</span> T *aString, uint32_t aLength,
<a name="l03355"></a>03355                             <a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aRefContext,
<a name="l03356"></a>03356                             int32_t aAppUnitsPerDevUnit,
<a name="l03357"></a>03357                             uint32_t aFlags)
<a name="l03358"></a>03358     {
<a name="l03359"></a>03359         <a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html">gfxTextRunFactory::Parameters</a> <a class="code" href="../../d6/d54/parameters_8js.html#a4ad646d0ee2fc69a53b50783ca7465dc">params</a> = {
<a name="l03360"></a>03360             aRefContext, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, 0, aAppUnitsPerDevUnit
<a name="l03361"></a>03361         };
<a name="l03362"></a>03362         <span class="keywordflow">return</span> MakeTextRun(aString, aLength, &amp;params, aFlags);
<a name="l03363"></a>03363     }
<a name="l03364"></a>03364 
<a name="l03365"></a>03365     <span class="comment">/* helper function for splitting font families on commas and</span>
<a name="l03366"></a>03366 <span class="comment">     * calling a function for each family to fill the mFonts array</span>
<a name="l03367"></a>03367 <span class="comment">     */</span>
<a name="l03368"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a1aed9313ce0527ff5453183c3fdf0c42">03368</a>     <span class="keyword">typedef</span> <a class="code" href="../../d7/dd2/qcmstypes_8h.html#acac1f8caeb95c0bd16fe8c0743249831">bool</a> (*FontCreationCallback) (<span class="keyword">const</span> nsAString&amp; aName,
<a name="l03369"></a>03369                                             <span class="keyword">const</span> nsACString&amp; aGenericName,
<a name="l03370"></a>03370                                             <span class="keywordtype">bool</span> aUseFontSet,
<a name="l03371"></a>03371                                             <span class="keywordtype">void</span> *<a class="code" href="../../de/deb/jsdbgapi_8h.html#a04ae7e854091164fecb61c733824c62d">closure</a>);
<a name="l03372"></a>03372     <span class="keywordtype">bool</span> ForEachFont(<span class="keyword">const</span> nsAString&amp; aFamilies,
<a name="l03373"></a>03373                        <a class="code" href="../../dc/dcf/interfacens_i_atom.html">nsIAtom</a> *aLanguage,
<a name="l03374"></a>03374                        FontCreationCallback fc,
<a name="l03375"></a>03375                        <span class="keywordtype">void</span> *<a class="code" href="../../de/deb/jsdbgapi_8h.html#a04ae7e854091164fecb61c733824c62d">closure</a>);
<a name="l03376"></a>03376     <span class="keywordtype">bool</span> ForEachFont(FontCreationCallback fc, <span class="keywordtype">void</span> *<a class="code" href="../../de/deb/jsdbgapi_8h.html#a04ae7e854091164fecb61c733824c62d">closure</a>);
<a name="l03377"></a>03377 
<a name="l03382"></a>03382     <span class="keywordtype">bool</span> HasFont(<span class="keyword">const</span> <a class="code" href="../../de/d12/classgfx_font_entry.html">gfxFontEntry</a> *aFontEntry);
<a name="l03383"></a>03383 
<a name="l03384"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#aef08d5ea5ba69bc6204da1792488e0d6">03384</a>     <span class="keyword">const</span> nsString&amp; <a class="code" href="../../dd/d7c/classgfx_font_group.html#aef08d5ea5ba69bc6204da1792488e0d6">GetFamilies</a>() { <span class="keywordflow">return</span> mFamilies; }
<a name="l03385"></a>03385 
<a name="l03386"></a>03386     <span class="comment">// This returns the preferred underline for this font group.</span>
<a name="l03387"></a>03387     <span class="comment">// Some CJK fonts have wrong underline offset in its metrics.</span>
<a name="l03388"></a>03388     <span class="comment">// If this group has such &quot;bad&quot; font, each platform&#39;s gfxFontGroup initialized mUnderlineOffset.</span>
<a name="l03389"></a>03389     <span class="comment">// The value should be lower value of first font&#39;s metrics and the bad font&#39;s metrics.</span>
<a name="l03390"></a>03390     <span class="comment">// Otherwise, this returns from first font&#39;s metrics.</span>
<a name="l03391"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#ae51bcdb434ded371606e102510f8ee62ae07839e25dbff3f555702b52939f3fbc">03391</a>     <span class="keyword">enum</span> { UNDERLINE_OFFSET_NOT_SET = INT16_MAX };
<a name="l03392"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a60d5c59c74dd925af12f76bef3ca6f28">03392</a>     <span class="keyword">virtual</span> <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dd/d7c/classgfx_font_group.html#a60d5c59c74dd925af12f76bef3ca6f28">GetUnderlineOffset</a>() {
<a name="l03393"></a>03393         <span class="keywordflow">if</span> (mUnderlineOffset == UNDERLINE_OFFSET_NOT_SET)
<a name="l03394"></a>03394             mUnderlineOffset = GetFontAt(0)-&gt;GetMetrics().underlineOffset;
<a name="l03395"></a>03395         <span class="keywordflow">return</span> mUnderlineOffset;
<a name="l03396"></a>03396     }
<a name="l03397"></a>03397 
<a name="l03398"></a>03398     <span class="keyword">virtual</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;gfxFont&gt;</a>
<a name="l03399"></a>03399         FindFontForChar(uint32_t ch, uint32_t prevCh, int32_t aRunScript,
<a name="l03400"></a>03400                         <a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a> *aPrevMatchedFont,
<a name="l03401"></a>03401                         uint8_t *aMatchType);
<a name="l03402"></a>03402 
<a name="l03403"></a>03403     <span class="comment">// search through pref fonts for a character, return nullptr if no matching pref font</span>
<a name="l03404"></a>03404     <span class="keyword">virtual</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;gfxFont&gt;</a> WhichPrefFontSupportsChar(uint32_t aCh);
<a name="l03405"></a>03405 
<a name="l03406"></a>03406     <span class="keyword">virtual</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;gfxFont&gt;</a>
<a name="l03407"></a>03407         WhichSystemFontSupportsChar(uint32_t aCh, int32_t aRunScript);
<a name="l03408"></a>03408 
<a name="l03409"></a>03409     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03410"></a>03410     <span class="keywordtype">void</span> ComputeRanges(<a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;gfxTextRange&gt;</a>&amp; mRanges,
<a name="l03411"></a>03411                        <span class="keyword">const</span> T *aString, uint32_t aLength,
<a name="l03412"></a>03412                        int32_t aRunScript);
<a name="l03413"></a>03413 
<a name="l03414"></a>03414     <a class="code" href="../../d8/de9/classgfx_user_font_set.html">gfxUserFontSet</a>* GetUserFontSet();
<a name="l03415"></a>03415 
<a name="l03416"></a>03416     <span class="comment">// With downloadable fonts, the composition of the font group can change as fonts are downloaded</span>
<a name="l03417"></a>03417     <span class="comment">// for each change in state of the user font set, the generation value is bumped to avoid picking up</span>
<a name="l03418"></a>03418     <span class="comment">// previously created text runs in the text run word cache.  For font groups based on stylesheets</span>
<a name="l03419"></a>03419     <span class="comment">// with no @font-face rule, this always returns 0.</span>
<a name="l03420"></a>03420     uint64_t GetGeneration();
<a name="l03421"></a>03421 
<a name="l03422"></a>03422     <span class="comment">// If there is a user font set, check to see whether the font list or any</span>
<a name="l03423"></a>03423     <span class="comment">// caches need updating.</span>
<a name="l03424"></a>03424     <span class="keyword">virtual</span> <span class="keywordtype">void</span> UpdateFontList();
<a name="l03425"></a>03425 
<a name="l03426"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a81b4e7d4ab30ef6b46ae0178ece5fba7">03426</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dd/d7c/classgfx_font_group.html#a81b4e7d4ab30ef6b46ae0178ece5fba7">ShouldSkipDrawing</a>()<span class="keyword"> const </span>{
<a name="l03427"></a>03427         <span class="keywordflow">return</span> mSkipDrawing;
<a name="l03428"></a>03428     }
<a name="l03429"></a>03429 
<a name="l03430"></a><a class="code" href="../../df/dbd/classgfx_font_group_1_1_lazy_reference_context_getter.html">03430</a>     <span class="keyword">class </span><a class="code" href="../../df/dbd/classgfx_font_group_1_1_lazy_reference_context_getter.html">LazyReferenceContextGetter</a> {
<a name="l03431"></a>03431     <span class="keyword">public</span>:
<a name="l03432"></a>03432       <span class="keyword">virtual</span> <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;gfxContext&gt;</a> GetRefContext() = 0;
<a name="l03433"></a>03433     };
<a name="l03434"></a>03434     <span class="comment">// The gfxFontGroup keeps ownership of this textrun.</span>
<a name="l03435"></a>03435     <span class="comment">// It is only guaranteed to exist until the next call to GetEllipsisTextRun</span>
<a name="l03436"></a>03436     <span class="comment">// (which might use a different appUnitsPerDev value) for the font group,</span>
<a name="l03437"></a>03437     <span class="comment">// or until UpdateFontList is called, or the fontgroup is destroyed.</span>
<a name="l03438"></a>03438     <span class="comment">// Get it/use it/forget it :) - don&#39;t keep a reference that might go stale.</span>
<a name="l03439"></a>03439     <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a>* GetEllipsisTextRun(int32_t aAppUnitsPerDevPixel,
<a name="l03440"></a>03440                                    <a class="code" href="../../df/dbd/classgfx_font_group_1_1_lazy_reference_context_getter.html">LazyReferenceContextGetter</a>&amp; aRefContextGetter);
<a name="l03441"></a>03441 
<a name="l03442"></a>03442 <span class="keyword">protected</span>:
<a name="l03443"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a918fadea89e82246de96b6e0011e58f2">03443</a>     nsString <a class="code" href="../../dd/d7c/classgfx_font_group.html#a918fadea89e82246de96b6e0011e58f2">mFamilies</a>;
<a name="l03444"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#aaed8b4be04d7e49b36c2a79f86614f9e">03444</a>     <a class="code" href="../../d2/dbb/structgfx_font_style.html">gfxFontStyle</a> <a class="code" href="../../dd/d7c/classgfx_font_group.html#aaed8b4be04d7e49b36c2a79f86614f9e">mStyle</a>;
<a name="l03445"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a636a7f0c47b5f218857157374f7e9746">03445</a>     <a class="code" href="../../d8/d6f/classns_t_array.html">nsTArray&lt;FamilyFace&gt;</a> <a class="code" href="../../dd/d7c/classgfx_font_group.html#a636a7f0c47b5f218857157374f7e9746">mFonts</a>;
<a name="l03446"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a84306f131d4b80bea26f08ccf85a9653">03446</a>     <a class="code" href="../../d7/db4/gfx_types_8h.html#a2125d5bf02c06e8e26a81851cbe8bafe">gfxFloat</a> <a class="code" href="../../dd/d7c/classgfx_font_group.html#a84306f131d4b80bea26f08ccf85a9653">mUnderlineOffset</a>;
<a name="l03447"></a>03447 
<a name="l03448"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a68661c0761f8eb58c2014f112f60d1c5">03448</a>     <a class="code" href="../../d8/de9/classgfx_user_font_set.html">gfxUserFontSet</a>* <a class="code" href="../../dd/d7c/classgfx_font_group.html#a68661c0761f8eb58c2014f112f60d1c5">mUserFontSet</a>;
<a name="l03449"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a8037e8eeaefe6c91447d9ae635bb25b3">03449</a>     uint64_t <a class="code" href="../../dd/d7c/classgfx_font_group.html#a8037e8eeaefe6c91447d9ae635bb25b3">mCurrGeneration</a>;  <span class="comment">// track the current user font set generation, rebuild font list if needed</span>
<a name="l03450"></a>03450 
<a name="l03451"></a>03451     <span class="comment">// Cache a textrun representing an ellipsis (useful for CSS text-overflow)</span>
<a name="l03452"></a>03452     <span class="comment">// at a specific appUnitsPerDevPixel size</span>
<a name="l03453"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a1c92977adb6bed15cb21b46f7b9322b6">03453</a>     <a class="code" href="../../d1/d89/classns_auto_ptr.html">nsAutoPtr&lt;gfxTextRun&gt;</a>   <a class="code" href="../../dd/d7c/classgfx_font_group.html#a1c92977adb6bed15cb21b46f7b9322b6">mCachedEllipsisTextRun</a>;
<a name="l03454"></a>03454 
<a name="l03455"></a>03455     <span class="comment">// cache the most recent pref font to avoid general pref font lookup</span>
<a name="l03456"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a300d8e465257f0764b1d913937552037">03456</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFontFamily&gt;</a> <a class="code" href="../../dd/d7c/classgfx_font_group.html#a300d8e465257f0764b1d913937552037">mLastPrefFamily</a>;
<a name="l03457"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#afa23d73c7a1b610ae75799c359e97689">03457</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;gfxFont&gt;</a>       <a class="code" href="../../dd/d7c/classgfx_font_group.html#afa23d73c7a1b610ae75799c359e97689">mLastPrefFont</a>;
<a name="l03458"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#aa074feb5aa85b2bc3bf010a08b19c511">03458</a>     <a class="code" href="../../d7/db7/gfx_platform_8h.html#a20ee9583e60189731e8f6005a0de85a5">eFontPrefLang</a>           <a class="code" href="../../dd/d7c/classgfx_font_group.html#aa074feb5aa85b2bc3bf010a08b19c511">mLastPrefLang</a>;       <span class="comment">// lang group for last pref font</span>
<a name="l03459"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#ab8e6a4557df1ede3fdd502c67f7d5ed4">03459</a>     <a class="code" href="../../d7/db7/gfx_platform_8h.html#a20ee9583e60189731e8f6005a0de85a5">eFontPrefLang</a>           <a class="code" href="../../dd/d7c/classgfx_font_group.html#ab8e6a4557df1ede3fdd502c67f7d5ed4">mPageLang</a>;
<a name="l03460"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a1933782e3ffc20e607704ddffd9a42b0">03460</a>     <span class="keywordtype">bool</span>                    <a class="code" href="../../dd/d7c/classgfx_font_group.html#a1933782e3ffc20e607704ddffd9a42b0">mLastPrefFirstFont</a>;  <span class="comment">// is this the first font in the list of pref fonts for this lang group?</span>
<a name="l03461"></a>03461 
<a name="l03462"></a><a class="code" href="../../dd/d7c/classgfx_font_group.html#a022cdafa2dc3e02cc7868430e59c6208">03462</a>     <span class="keywordtype">bool</span>                    <a class="code" href="../../dd/d7c/classgfx_font_group.html#a022cdafa2dc3e02cc7868430e59c6208">mSkipDrawing</a>; <span class="comment">// hide text while waiting for a font</span>
<a name="l03463"></a>03463                                           <span class="comment">// download to complete (or fallback</span>
<a name="l03464"></a>03464                                           <span class="comment">// timer to fire)</span>
<a name="l03465"></a>03465 
<a name="l03470"></a>03470     <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *MakeEmptyTextRun(<span class="keyword">const</span> <a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html">Parameters</a> *aParams, uint32_t aFlags);
<a name="l03471"></a>03471     <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *MakeSpaceTextRun(<span class="keyword">const</span> <a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html">Parameters</a> *aParams, uint32_t aFlags);
<a name="l03472"></a>03472     <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *MakeBlankTextRun(uint32_t aLength,
<a name="l03473"></a>03473                                  <span class="keyword">const</span> <a class="code" href="../../d0/d6f/structgfx_text_run_factory_1_1_parameters.html">Parameters</a> *aParams, uint32_t aFlags);
<a name="l03474"></a>03474 
<a name="l03475"></a>03475     <span class="comment">// Used for construction/destruction.  Not intended to change the font set</span>
<a name="l03476"></a>03476     <span class="comment">// as invalidation of font lists and caches is not considered.</span>
<a name="l03477"></a>03477     <span class="keywordtype">void</span> SetUserFontSet(<a class="code" href="../../d8/de9/classgfx_user_font_set.html">gfxUserFontSet</a> *aUserFontSet);
<a name="l03478"></a>03478 
<a name="l03479"></a>03479     <span class="comment">// Initialize the list of fonts</span>
<a name="l03480"></a>03480     <span class="keywordtype">void</span> BuildFontList();
<a name="l03481"></a>03481 
<a name="l03482"></a>03482     <span class="comment">// Init this font group&#39;s font metrics. If there no bad fonts, you don&#39;t need to call this.</span>
<a name="l03483"></a>03483     <span class="comment">// But if there are one or more bad fonts which have bad underline offset,</span>
<a name="l03484"></a>03484     <span class="comment">// you should call this with the *first* bad font.</span>
<a name="l03485"></a>03485     <span class="keywordtype">void</span> InitMetricsForBadFont(<a class="code" href="../../dc/d81/classgfx_font.html">gfxFont</a>* aBadFont);
<a name="l03486"></a>03486 
<a name="l03487"></a>03487     <span class="comment">// Set up the textrun glyphs for an entire text run:</span>
<a name="l03488"></a>03488     <span class="comment">// find script runs, and then call InitScriptRun for each</span>
<a name="l03489"></a>03489     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03490"></a>03490     <span class="keywordtype">void</span> InitTextRun(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l03491"></a>03491                      <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun,
<a name="l03492"></a>03492                      <span class="keyword">const</span> T *aString,
<a name="l03493"></a>03493                      uint32_t aLength);
<a name="l03494"></a>03494 
<a name="l03495"></a>03495     <span class="comment">// InitTextRun helper to handle a single script run, by finding font ranges</span>
<a name="l03496"></a>03496     <span class="comment">// and calling each font&#39;s InitTextRun() as appropriate</span>
<a name="l03497"></a>03497     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l03498"></a>03498     <span class="keywordtype">void</span> InitScriptRun(<a class="code" href="../../d5/dc9/classgfx_context.html">gfxContext</a> *aContext,
<a name="l03499"></a>03499                        <a class="code" href="../../d6/d7e/classgfx_text_run.html">gfxTextRun</a> *aTextRun,
<a name="l03500"></a>03500                        <span class="keyword">const</span> T *aString,
<a name="l03501"></a>03501                        uint32_t aScriptRunStart,
<a name="l03502"></a>03502                        uint32_t aScriptRunEnd,
<a name="l03503"></a>03503                        int32_t aRunScript);
<a name="l03504"></a>03504 
<a name="l03505"></a>03505     <span class="comment">/* If aResolveGeneric is true, then CSS/Gecko generic family names are</span>
<a name="l03506"></a>03506 <span class="comment">     * replaced with preferred fonts.</span>
<a name="l03507"></a>03507 <span class="comment">     *</span>
<a name="l03508"></a>03508 <span class="comment">     * If aResolveFontName is true then fc() is called only for existing fonts</span>
<a name="l03509"></a>03509 <span class="comment">     * and with actual font names.  If false then fc() is called with each</span>
<a name="l03510"></a>03510 <span class="comment">     * family name in aFamilies (after resolving CSS/Gecko generic family names</span>
<a name="l03511"></a>03511 <span class="comment">     * if aResolveGeneric).</span>
<a name="l03512"></a>03512 <span class="comment">     * If aUseFontSet is true, the fontgroup&#39;s user font set is checked;</span>
<a name="l03513"></a>03513 <span class="comment">     * if false then it is skipped.</span>
<a name="l03514"></a>03514 <span class="comment">     */</span>
<a name="l03515"></a>03515     <span class="keywordtype">bool</span> ForEachFontInternal(<span class="keyword">const</span> nsAString&amp; aFamilies,
<a name="l03516"></a>03516                                <a class="code" href="../../dc/dcf/interfacens_i_atom.html">nsIAtom</a> *aLanguage,
<a name="l03517"></a>03517                                <span class="keywordtype">bool</span> aResolveGeneric,
<a name="l03518"></a>03518                                <span class="keywordtype">bool</span> aResolveFontName,
<a name="l03519"></a>03519                                <span class="keywordtype">bool</span> aUseFontSet,
<a name="l03520"></a>03520                                FontCreationCallback fc,
<a name="l03521"></a>03521                                <span class="keywordtype">void</span> *<a class="code" href="../../de/deb/jsdbgapi_8h.html#a04ae7e854091164fecb61c733824c62d">closure</a>);
<a name="l03522"></a>03522 
<a name="l03523"></a>03523     <span class="comment">// Helper for font-matching:</span>
<a name="l03524"></a>03524     <span class="comment">// see if aCh is supported in any of the faces from aFamily;</span>
<a name="l03525"></a>03525     <span class="comment">// if so return the best style match, else return null.</span>
<a name="l03526"></a>03526     <a class="code" href="../../d3/d17/structalready___add_refed.html">already_AddRefed&lt;gfxFont&gt;</a> TryAllFamilyMembers(<a class="code" href="../../d8/d91/classgfx_font_family.html">gfxFontFamily</a>* aFamily,
<a name="l03527"></a>03527                                                   uint32_t aCh);
<a name="l03528"></a>03528 
<a name="l03529"></a>03529     <span class="keyword">static</span> <span class="keywordtype">bool</span> FontResolverProc(<span class="keyword">const</span> nsAString&amp; aName, <span class="keywordtype">void</span> *aClosure);
<a name="l03530"></a>03530 
<a name="l03531"></a>03531     <span class="keyword">static</span> <span class="keywordtype">bool</span> FindPlatformFont(<span class="keyword">const</span> nsAString&amp; aName,
<a name="l03532"></a>03532                                    <span class="keyword">const</span> nsACString&amp; aGenericName,
<a name="l03533"></a>03533                                    <span class="keywordtype">bool</span> aUseFontSet,
<a name="l03534"></a>03534                                    <span class="keywordtype">void</span> *<a class="code" href="../../de/deb/jsdbgapi_8h.html#a04ae7e854091164fecb61c733824c62d">closure</a>);
<a name="l03535"></a>03535 
<a name="l03536"></a>03536     <span class="keyword">static</span> <a class="code" href="../../d3/dd8/nscore_8h.html#ac19fc71a78771eb7bf7dead68bc74db6">NS_HIDDEN_</a>(<a class="code" href="../../da/da3/classns_i_language_atom_service.html">nsILanguageAtomService</a>*) gLangService;
<a name="l03537"></a>03537 };
<a name="l03538"></a>03538 <span class="preprocessor">#endif</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d3/d0b/gfx_font_8h.html">gfxFont.h</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:52:04に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
