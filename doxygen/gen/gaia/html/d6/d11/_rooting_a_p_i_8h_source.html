<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: RootingAPI.h ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d6/d11/_rooting_a_p_i_8h.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">RootingAPI.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/d11/_rooting_a_p_i_8h.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a name="l00002"></a>00002 <span class="comment"> * vim: set ts=8 sts=4 et sw=4 tw=99:</span>
<a name="l00003"></a>00003 <span class="comment"> * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a name="l00004"></a>00004 <span class="comment"> * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a name="l00005"></a>00005 <span class="comment"> * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#ifndef js_RootingAPI_h</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#define js_RootingAPI_h</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dbc/_guard_objects_8h.html">mozilla/GuardObjects.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dd5/_type_traits_8h.html">mozilla/TypeTraits.h</a>&quot;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d2a/_utility_8h.html">js/Utility.h</a>&quot;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d28/jspubtd_8h.html">jspubtd.h</a>&quot;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">/*</span>
<a name="l00018"></a>00018 <span class="comment"> * Moving GC Stack Rooting</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * A moving GC may change the physical location of GC allocated things, even</span>
<a name="l00021"></a>00021 <span class="comment"> * when they are rooted, updating all pointers to the thing to refer to its new</span>
<a name="l00022"></a>00022 <span class="comment"> * location. The GC must therefore know about all live pointers to a thing,</span>
<a name="l00023"></a>00023 <span class="comment"> * not just one of them, in order to behave correctly.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * The |Rooted| and |Handle| classes below are used to root stack locations</span>
<a name="l00026"></a>00026 <span class="comment"> * whose value may be held live across a call that can trigger GC. For a</span>
<a name="l00027"></a>00027 <span class="comment"> * code fragment such as:</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> * JSObject *obj = NewObject(cx);</span>
<a name="l00030"></a>00030 <span class="comment"> * DoSomething(cx);</span>
<a name="l00031"></a>00031 <span class="comment"> * ... = obj-&gt;lastProperty();</span>
<a name="l00032"></a>00032 <span class="comment"> *</span>
<a name="l00033"></a>00033 <span class="comment"> * If |DoSomething()| can trigger a GC, the stack location of |obj| must be</span>
<a name="l00034"></a>00034 <span class="comment"> * rooted to ensure that the GC does not move the JSObject referred to by</span>
<a name="l00035"></a>00035 <span class="comment"> * |obj| without updating |obj|&#39;s location itself. This rooting must happen</span>
<a name="l00036"></a>00036 <span class="comment"> * regardless of whether there are other roots which ensure that the object</span>
<a name="l00037"></a>00037 <span class="comment"> * itself will not be collected.</span>
<a name="l00038"></a>00038 <span class="comment"> *</span>
<a name="l00039"></a>00039 <span class="comment"> * If |DoSomething()| cannot trigger a GC, and the same holds for all other</span>
<a name="l00040"></a>00040 <span class="comment"> * calls made between |obj|&#39;s definitions and its last uses, then no rooting</span>
<a name="l00041"></a>00041 <span class="comment"> * is required.</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> * SpiderMonkey can trigger a GC at almost any time and in ways that are not</span>
<a name="l00044"></a>00044 <span class="comment"> * always clear. For example, the following innocuous-looking actions can</span>
<a name="l00045"></a>00045 <span class="comment"> * cause a GC: allocation of any new GC thing; JSObject::hasProperty;</span>
<a name="l00046"></a>00046 <span class="comment"> * JS_ReportError and friends; and ToNumber, among many others. The following</span>
<a name="l00047"></a>00047 <span class="comment"> * dangerous-looking actions cannot trigger a GC: js_malloc, cx-&gt;malloc_,</span>
<a name="l00048"></a>00048 <span class="comment"> * rt-&gt;malloc_, and friends and JS_ReportOutOfMemory.</span>
<a name="l00049"></a>00049 <span class="comment"> *</span>
<a name="l00050"></a>00050 <span class="comment"> * The following family of three classes will exactly root a stack location.</span>
<a name="l00051"></a>00051 <span class="comment"> * Incorrect usage of these classes will result in a compile error in almost</span>
<a name="l00052"></a>00052 <span class="comment"> * all cases. Therefore, it is very hard to be incorrectly rooted if you use</span>
<a name="l00053"></a>00053 <span class="comment"> * these classes exclusively. These classes are all templated on the type T of</span>
<a name="l00054"></a>00054 <span class="comment"> * the value being rooted.</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> * - Rooted&lt;T&gt; declares a variable of type T, whose value is always rooted.</span>
<a name="l00057"></a>00057 <span class="comment"> *   Rooted&lt;T&gt; may be automatically coerced to a Handle&lt;T&gt;, below. Rooted&lt;T&gt;</span>
<a name="l00058"></a>00058 <span class="comment"> *   should be used whenever a local variable&#39;s value may be held live across a</span>
<a name="l00059"></a>00059 <span class="comment"> *   call which can trigger a GC.</span>
<a name="l00060"></a>00060 <span class="comment"> *</span>
<a name="l00061"></a>00061 <span class="comment"> * - Handle&lt;T&gt; is a const reference to a Rooted&lt;T&gt;. Functions which take GC</span>
<a name="l00062"></a>00062 <span class="comment"> *   things or values as arguments and need to root those arguments should</span>
<a name="l00063"></a>00063 <span class="comment"> *   generally use handles for those arguments and avoid any explicit rooting.</span>
<a name="l00064"></a>00064 <span class="comment"> *   This has two benefits. First, when several such functions call each other</span>
<a name="l00065"></a>00065 <span class="comment"> *   then redundant rooting of multiple copies of the GC thing can be avoided.</span>
<a name="l00066"></a>00066 <span class="comment"> *   Second, if the caller does not pass a rooted value a compile error will be</span>
<a name="l00067"></a>00067 <span class="comment"> *   generated, which is quicker and easier to fix than when relying on a</span>
<a name="l00068"></a>00068 <span class="comment"> *   separate rooting analysis.</span>
<a name="l00069"></a>00069 <span class="comment"> *</span>
<a name="l00070"></a>00070 <span class="comment"> * - MutableHandle&lt;T&gt; is a non-const reference to Rooted&lt;T&gt;. It is used in the</span>
<a name="l00071"></a>00071 <span class="comment"> *   same way as Handle&lt;T&gt; and includes a |set(const T &amp;v)| method to allow</span>
<a name="l00072"></a>00072 <span class="comment"> *   updating the value of the referenced Rooted&lt;T&gt;. A MutableHandle&lt;T&gt; can be</span>
<a name="l00073"></a>00073 <span class="comment"> *   created from a Rooted&lt;T&gt; by using |Rooted&lt;T&gt;::operator&amp;()|.</span>
<a name="l00074"></a>00074 <span class="comment"> *</span>
<a name="l00075"></a>00075 <span class="comment"> * In some cases the small performance overhead of exact rooting (measured to</span>
<a name="l00076"></a>00076 <span class="comment"> * be a few nanoseconds on desktop) is too much. In these cases, try the</span>
<a name="l00077"></a>00077 <span class="comment"> * following:</span>
<a name="l00078"></a>00078 <span class="comment"> *</span>
<a name="l00079"></a>00079 <span class="comment"> * - Move all Rooted&lt;T&gt; above inner loops: this allows you to re-use the root</span>
<a name="l00080"></a>00080 <span class="comment"> *   on each iteration of the loop.</span>
<a name="l00081"></a>00081 <span class="comment"> *</span>
<a name="l00082"></a>00082 <span class="comment"> * - Pass Handle&lt;T&gt; through your hot call stack to avoid re-rooting costs at</span>
<a name="l00083"></a>00083 <span class="comment"> *   every invocation.</span>
<a name="l00084"></a>00084 <span class="comment"> *</span>
<a name="l00085"></a>00085 <span class="comment"> * The following diagram explains the list of supported, implicit type</span>
<a name="l00086"></a>00086 <span class="comment"> * conversions between classes of this family:</span>
<a name="l00087"></a>00087 <span class="comment"> *</span>
<a name="l00088"></a>00088 <span class="comment"> *  Rooted&lt;T&gt; ----&gt; Handle&lt;T&gt;</span>
<a name="l00089"></a>00089 <span class="comment"> *     |               ^</span>
<a name="l00090"></a>00090 <span class="comment"> *     |               |</span>
<a name="l00091"></a>00091 <span class="comment"> *     |               |</span>
<a name="l00092"></a>00092 <span class="comment"> *     +---&gt; MutableHandle&lt;T&gt;</span>
<a name="l00093"></a>00093 <span class="comment"> *     (via &amp;)</span>
<a name="l00094"></a>00094 <span class="comment"> *</span>
<a name="l00095"></a>00095 <span class="comment"> * All of these types have an implicit conversion to raw pointers.</span>
<a name="l00096"></a>00096 <span class="comment"> */</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="keyword">namespace </span>js {
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="keyword">class </span><a class="code" href="../../d6/da5/libpinyin_8js.html#a88683b64d84542943724ba0f211153af">Module</a>;
<a name="l00101"></a>00101 <span class="keyword">class </span>ScriptSourceObject;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00104"></a><a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">00104</a> <span class="keyword">struct </span><a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">GCMethods</a> {};
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00107"></a><a class="code" href="../../d3/d20/classjs_1_1_rooted_base.html">00107</a> <span class="keyword">class </span><a class="code" href="../../d3/d20/classjs_1_1_rooted_base.html">RootedBase</a> {};
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00110"></a><a class="code" href="../../d7/dd3/classjs_1_1_handle_base.html">00110</a> <span class="keyword">class </span><a class="code" href="../../d7/dd3/classjs_1_1_handle_base.html">HandleBase</a> {};
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00113"></a><a class="code" href="../../da/d61/classjs_1_1_mutable_handle_base.html">00113</a> <span class="keyword">class </span><a class="code" href="../../da/d61/classjs_1_1_mutable_handle_base.html">MutableHandleBase</a> {};
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00116"></a><a class="code" href="../../d8/d60/classjs_1_1_heap_base.html">00116</a> <span class="keyword">class </span><a class="code" href="../../d8/d60/classjs_1_1_heap_base.html">HeapBase</a> {};
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">/*</span>
<a name="l00119"></a>00119 <span class="comment"> * js::NullPtr acts like a NULL pointer in contexts that require a Handle.</span>
<a name="l00120"></a>00120 <span class="comment"> *</span>
<a name="l00121"></a>00121 <span class="comment"> * Handle provides an implicit constructor for js::NullPtr so that, given:</span>
<a name="l00122"></a>00122 <span class="comment"> *   foo(Handle&lt;JSObject*&gt; h);</span>
<a name="l00123"></a>00123 <span class="comment"> * callers can simply write:</span>
<a name="l00124"></a>00124 <span class="comment"> *   foo(js::NullPtr());</span>
<a name="l00125"></a>00125 <span class="comment"> * which avoids creating a Rooted&lt;JSObject*&gt; just to pass NULL.</span>
<a name="l00126"></a>00126 <span class="comment"> *</span>
<a name="l00127"></a>00127 <span class="comment"> * This is the SpiderMonkey internal variant. js::NullPtr should be used in</span>
<a name="l00128"></a>00128 <span class="comment"> * preference to JS::NullPtr to avoid the GOT access required for JS_PUBLIC_API</span>
<a name="l00129"></a>00129 <span class="comment"> * symbols.</span>
<a name="l00130"></a>00130 <span class="comment"> */</span>
<a name="l00131"></a><a class="code" href="../../d5/d23/structjs_1_1_null_ptr.html">00131</a> <span class="keyword">struct </span><a class="code" href="../../d5/d23/structjs_1_1_null_ptr.html">NullPtr</a>
<a name="l00132"></a>00132 {
<a name="l00133"></a><a class="code" href="../../d5/d23/structjs_1_1_null_ptr.html#a18e4b75e25eef6765f2411e1a05476ad">00133</a>     <span class="keyword">static</span> <span class="keywordtype">void</span> * <span class="keyword">const</span> <a class="code" href="../../d5/d23/structjs_1_1_null_ptr.html#a18e4b75e25eef6765f2411e1a05476ad">constNullValue</a>;
<a name="l00134"></a>00134 };
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="keyword">namespace </span>gc {
<a name="l00137"></a>00137 <span class="keyword">struct </span>Cell;
<a name="l00138"></a>00138 } <span class="comment">/* namespace gc */</span>
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 } <span class="comment">/* namespace js */</span>
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="keyword">namespace </span>JS {
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span>Rooted;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span>Handle;
<a name="l00147"></a>00147 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span>MutableHandle;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">/* This is exposing internal state of the GC for inlining purposes. */</span>
<a name="l00150"></a>00150 <a class="code" href="../../da/d7b/namespace_j_s.html#a2e605e903794faf0e672f343d0205d99">JS_FRIEND_API</a>(<span class="keywordtype">bool</span>) isGCEnabled();
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="preprocessor">#if defined(DEBUG) &amp;&amp; defined(JS_GC_ZEAL) &amp;&amp; defined(JSGC_ROOT_ANALYSIS) &amp;&amp; !defined(JS_THREADSAFE)</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l00154"></a>00154 CheckStackRoots(<a class="code" href="../../d9/d28/jspubtd_8h.html#a1511e24a5b9d6d2e0e689afd9c6c0b9b">JSContext</a> *<a class="code" href="../../de/d8f/jsdebug_8h.html#ac84a9ad5e2527762d63c6001438948b3">cx</a>);
<a name="l00155"></a>00155 <span class="preprocessor">#endif</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>
<a name="l00157"></a>00157 <span class="comment">/*</span>
<a name="l00158"></a>00158 <span class="comment"> * JS::NullPtr acts like a NULL pointer in contexts that require a Handle.</span>
<a name="l00159"></a>00159 <span class="comment"> *</span>
<a name="l00160"></a>00160 <span class="comment"> * Handle provides an implicit constructor for JS::NullPtr so that, given:</span>
<a name="l00161"></a>00161 <span class="comment"> *   foo(Handle&lt;JSObject*&gt; h);</span>
<a name="l00162"></a>00162 <span class="comment"> * callers can simply write:</span>
<a name="l00163"></a>00163 <span class="comment"> *   foo(JS::NullPtr());</span>
<a name="l00164"></a>00164 <span class="comment"> * which avoids creating a Rooted&lt;JSObject*&gt; just to pass NULL.</span>
<a name="l00165"></a>00165 <span class="comment"> */</span>
<a name="l00166"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a470e0743c0dbd0877012652011e907c2">00166</a> <span class="keyword">struct </span><a class="code" href="../../da/d7b/namespace_j_s.html#af066ac8d16defce202733c71cbc1970f">JS_PUBLIC_API</a>(NullPtr)
<a name="l00167"></a>00167 {
<a name="l00168"></a>00168     <span class="keyword">static</span> <span class="keywordtype">void</span> * <span class="keyword">const</span> constNullValue;
<a name="l00169"></a>00169 };
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="comment">/*</span>
<a name="l00172"></a>00172 <span class="comment"> * The Heap&lt;T&gt; class is a C/C++ heap-stored reference to a JS GC thing.  All</span>
<a name="l00173"></a>00173 <span class="comment"> * members of heap classes that refer to GC thing should use Heap&lt;T&gt; (or</span>
<a name="l00174"></a>00174 <span class="comment"> * possibly TenuredHeap&lt;T&gt;, described below).</span>
<a name="l00175"></a>00175 <span class="comment"> *</span>
<a name="l00176"></a>00176 <span class="comment"> * Heap&lt;T&gt; wraps the complex mechanisms required to ensure GC safety for the</span>
<a name="l00177"></a>00177 <span class="comment"> * contained reference into a C++ class that behaves similarly to a normal</span>
<a name="l00178"></a>00178 <span class="comment"> * pointer.</span>
<a name="l00179"></a>00179 <span class="comment"> *</span>
<a name="l00180"></a>00180 <span class="comment"> * GC references stored on the C/C++ stack must use Rooted/Handle/MutableHandle</span>
<a name="l00181"></a>00181 <span class="comment"> * instead.</span>
<a name="l00182"></a>00182 <span class="comment"> *</span>
<a name="l00183"></a>00183 <span class="comment"> * Requirements for type T:</span>
<a name="l00184"></a>00184 <span class="comment"> *  - Must be one of: Value, jsid, JSObject*, JSString*, JSScript*</span>
<a name="l00185"></a>00185 <span class="comment"> */</span>
<a name="l00186"></a>00186 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00187"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html">00187</a> <span class="keyword">class </span><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html">Heap</a> : <span class="keyword">public</span> js::HeapBase&lt;T&gt;
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189   <span class="keyword">public</span>:
<a name="l00190"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a23df619150094f262d8775b9be3b29f5">00190</a>     <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a23df619150094f262d8775b9be3b29f5">Heap</a>() {
<a name="l00191"></a>00191         <a class="code" href="../../d3/d68/_value_8h.html#a3b52e66790b3e7fa53b9794163d633e5">static_assert</a>(<span class="keyword">sizeof</span>(T) == <span class="keyword">sizeof</span>(<a class="code" href="../../db/d0b/class_j_s_1_1_heap.html">Heap&lt;T&gt;</a>),
<a name="l00192"></a>00192                       <span class="stringliteral">&quot;Heap&lt;T&gt; must be binary compatible with T.&quot;</span>);
<a name="l00193"></a>00193         init(<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::initial</a>());
<a name="l00194"></a>00194     }
<a name="l00195"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a1c620ce2c3ae0b0fb3bff10b88a53a38">00195</a>     <span class="keyword">explicit</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a1c620ce2c3ae0b0fb3bff10b88a53a38">Heap</a>(T <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) { init(p); }
<a name="l00196"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a98b24321d942506acf66250a8f15fccc">00196</a>     <span class="keyword">explicit</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a98b24321d942506acf66250a8f15fccc">Heap</a>(<span class="keyword">const</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html">Heap&lt;T&gt;</a> &amp;<a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) { init(p.ptr); }
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#ae3b568519d204b0eaf224e05323ca51e">00198</a>     <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#ae3b568519d204b0eaf224e05323ca51e">~Heap</a>() {
<a name="l00199"></a>00199         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::needsPostBarrier</a>(ptr))
<a name="l00200"></a>00200             relocate();
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a710a7a9d522827fd66825396fe162a81">00203</a>     <span class="keywordtype">bool</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a710a7a9d522827fd66825396fe162a81">operator==</a>(<span class="keyword">const</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html">Heap&lt;T&gt;</a> &amp;other) { <span class="keywordflow">return</span> ptr == other.ptr; }
<a name="l00204"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a98f5abd313582422afc6d15a19b25a89">00204</a>     <span class="keywordtype">bool</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a98f5abd313582422afc6d15a19b25a89">operator!=</a>(<span class="keyword">const</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html">Heap&lt;T&gt;</a> &amp;other) { <span class="keywordflow">return</span> ptr != other.ptr; }
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a562184cf903191f17de926ffc3a9390e">00206</a>     <span class="keywordtype">bool</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a562184cf903191f17de926ffc3a9390e">operator==</a>(<span class="keyword">const</span> T &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr == other; }
<a name="l00207"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a749df5ed45cef5814710a53d9352864f">00207</a>     <span class="keywordtype">bool</span> <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a749df5ed45cef5814710a53d9352864f">operator!=</a>(<span class="keyword">const</span> T &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr != other; }
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a7d67aff4f01e0a129ab8fdaa52e02fd2">00209</a>     <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a7d67aff4f01e0a129ab8fdaa52e02fd2">operator T</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00210"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#adfe1c944376a94dc50719dc0a88d0366">00210</a>     T <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#adfe1c944376a94dc50719dc0a88d0366">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00211"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#ac97872f2a208107769399acb87d52426">00211</a>     <span class="keyword">const</span> T *<a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#ac97872f2a208107769399acb87d52426">address</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> &amp;ptr; }
<a name="l00212"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a6bcaf77bd5c86d52a38e81d92fa1bdcd">00212</a>     <span class="keyword">const</span> T &amp;<span class="keyword">get</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> ptr; }
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a5af3af8f096f6c1e70582c3817964796">00214</a>     T *<a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a5af3af8f096f6c1e70582c3817964796">unsafeGet</a>() { <span class="keywordflow">return</span> &amp;ptr; }
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a6754d580b27d9e0703217e03997b763b">00216</a>     <a class="code" href="../../db/d0b/class_j_s_1_1_heap.html">Heap&lt;T&gt;</a> &amp;<a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a6754d580b27d9e0703217e03997b763b">operator=</a>(T <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) {
<a name="l00217"></a>00217         <span class="keyword">set</span>(<a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>);
<a name="l00218"></a>00218         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="../../db/d0b/class_j_s_1_1_heap.html#a0def831642db64bb1cbadf7533221220">00221</a>     <span class="keywordtype">void</span> <span class="keyword">set</span>(T newPtr) {
<a name="l00222"></a>00222         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::poisoned</a>(newPtr));
<a name="l00223"></a>00223         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::needsPostBarrier</a>(newPtr)) {
<a name="l00224"></a>00224             ptr = newPtr;
<a name="l00225"></a>00225             post();
<a name="l00226"></a>00226         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::needsPostBarrier</a>(ptr)) {
<a name="l00227"></a>00227             relocate();  <span class="comment">/* Called before overwriting ptr. */</span>
<a name="l00228"></a>00228             ptr = newPtr;
<a name="l00229"></a>00229         } <span class="keywordflow">else</span> {
<a name="l00230"></a>00230             ptr = newPtr;
<a name="l00231"></a>00231         }
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234   <span class="keyword">private</span>:
<a name="l00235"></a>00235     <span class="keywordtype">void</span> init(T newPtr) {
<a name="l00236"></a>00236         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::poisoned</a>(newPtr));
<a name="l00237"></a>00237         ptr = newPtr;
<a name="l00238"></a>00238         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::needsPostBarrier</a>(ptr))
<a name="l00239"></a>00239             post();
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <span class="keywordtype">void</span> post() {
<a name="l00243"></a>00243 <span class="preprocessor">#ifdef JSGC_GENERATIONAL</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>        <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::needsPostBarrier</a>(ptr));
<a name="l00245"></a>00245         <a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::postBarrier</a>(&amp;ptr);
<a name="l00246"></a>00246 <span class="preprocessor">#endif</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span>    }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="keywordtype">void</span> relocate() {
<a name="l00250"></a>00250 <span class="preprocessor">#ifdef JSGC_GENERATIONAL</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>        <a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::relocate</a>(&amp;ptr);
<a name="l00252"></a>00252 <span class="preprocessor">#endif</span>
<a name="l00253"></a>00253 <span class="preprocessor"></span>    }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     T ptr;
<a name="l00256"></a>00256 };
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00260"></a>00260 <span class="comment"> * For generational GC, assert that an object is in the tenured generation as</span>
<a name="l00261"></a>00261 <span class="comment"> * opposed to being in the nursery.</span>
<a name="l00262"></a>00262 <span class="comment"> */</span>
<a name="l00263"></a>00263 <span class="keyword">extern</span> <a class="code" href="../../da/d7b/namespace_j_s.html#a2e605e903794faf0e672f343d0205d99">JS_FRIEND_API</a>(<span class="keywordtype">void</span>)
<a name="l00264"></a>00264 <a class="code" href="../../da/d7b/namespace_j_s.html#ac13c02384cc431692eca45b59a6668a9">AssertGCThingMustBeTenured</a>(JSObject* <a class="code" href="../../da/d7b/namespace_j_s.html#a0842d82cd8a06e877277bf8e90de77d5">obj</a>);
<a name="l00265"></a>00265 <span class="preprocessor">#else</span>
<a name="l00266"></a>00266 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00267"></a><a class="code" href="../../da/d7b/namespace_j_s.html#ac13c02384cc431692eca45b59a6668a9">00267</a> <a class="code" href="../../da/d7b/namespace_j_s.html#ac13c02384cc431692eca45b59a6668a9">AssertGCThingMustBeTenured</a>(JSObject *obj) {}
<a name="l00268"></a>00268 <span class="preprocessor">#endif</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span>
<a name="l00270"></a>00270 <span class="comment">/*</span>
<a name="l00271"></a>00271 <span class="comment"> * The TenuredHeap&lt;T&gt; class is similar to the Heap&lt;T&gt; class above in that it</span>
<a name="l00272"></a>00272 <span class="comment"> * encapsulates the GC concerns of an on-heap reference to a JS object. However,</span>
<a name="l00273"></a>00273 <span class="comment"> * it has two important differences:</span>
<a name="l00274"></a>00274 <span class="comment"> *</span>
<a name="l00275"></a>00275 <span class="comment"> *  1) Pointers which are statically known to only reference &quot;tenured&quot; objects</span>
<a name="l00276"></a>00276 <span class="comment"> *     can avoid the extra overhead of SpiderMonkey&#39;s write barriers.</span>
<a name="l00277"></a>00277 <span class="comment"> *</span>
<a name="l00278"></a>00278 <span class="comment"> *  2) Objects in the &quot;tenured&quot; heap have stronger alignment restrictions than</span>
<a name="l00279"></a>00279 <span class="comment"> *     those in the &quot;nursery&quot;, so it is possible to store flags in the lower</span>
<a name="l00280"></a>00280 <span class="comment"> *     bits of pointers known to be tenured. TenuredHeap wraps a normal tagged</span>
<a name="l00281"></a>00281 <span class="comment"> *     pointer with a nice API for accessing the flag bits and adds various</span>
<a name="l00282"></a>00282 <span class="comment"> *     assertions to ensure that it is not mis-used.</span>
<a name="l00283"></a>00283 <span class="comment"> *</span>
<a name="l00284"></a>00284 <span class="comment"> * GC things are said to be &quot;tenured&quot; when they are located in the long-lived</span>
<a name="l00285"></a>00285 <span class="comment"> * heap: e.g. they have gained tenure as an object by surviving past at least</span>
<a name="l00286"></a>00286 <span class="comment"> * one GC. For performance, SpiderMonkey allocates some things which are known</span>
<a name="l00287"></a>00287 <span class="comment"> * to normally be long lived directly into the tenured generation; for example,</span>
<a name="l00288"></a>00288 <span class="comment"> * global objects. Additionally, SpiderMonkey does not visit individual objects</span>
<a name="l00289"></a>00289 <span class="comment"> * when deleting non-tenured objects, so object with finalizers are also always</span>
<a name="l00290"></a>00290 <span class="comment"> * tenured; for instance, this includes most DOM objects.</span>
<a name="l00291"></a>00291 <span class="comment"> *</span>
<a name="l00292"></a>00292 <span class="comment"> * The considerations to keep in mind when using a TenuredHeap&lt;T&gt; vs a normal</span>
<a name="l00293"></a>00293 <span class="comment"> * Heap&lt;T&gt; are:</span>
<a name="l00294"></a>00294 <span class="comment"> *</span>
<a name="l00295"></a>00295 <span class="comment"> *  - It is invalid for a TenuredHeap&lt;T&gt; to refer to a non-tenured thing.</span>
<a name="l00296"></a>00296 <span class="comment"> *  - It is however valid for a Heap&lt;T&gt; to refer to a tenured thing.</span>
<a name="l00297"></a>00297 <span class="comment"> *  - It is not possible to store flag bits in a Heap&lt;T&gt;.</span>
<a name="l00298"></a>00298 <span class="comment"> */</span>
<a name="l00299"></a>00299 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00300"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html">00300</a> <span class="keyword">class </span><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html">TenuredHeap</a> : <span class="keyword">public</span> js::HeapBase&lt;T&gt;
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302   <span class="keyword">public</span>:
<a name="l00303"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a6d2b22a8446681fc4076e6f308c585cd">00303</a>     <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a6d2b22a8446681fc4076e6f308c585cd">TenuredHeap</a>() : bits(0) {
<a name="l00304"></a>00304         <a class="code" href="../../d3/d68/_value_8h.html#a3b52e66790b3e7fa53b9794163d633e5">static_assert</a>(<span class="keyword">sizeof</span>(T) == <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html">TenuredHeap&lt;T&gt;</a>),
<a name="l00305"></a>00305                       <span class="stringliteral">&quot;TenuredHeap&lt;T&gt; must be binary compatible with T.&quot;</span>);
<a name="l00306"></a>00306     }
<a name="l00307"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#aa8205de8793e917bb27b62b5e7d07588">00307</a>     <span class="keyword">explicit</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#aa8205de8793e917bb27b62b5e7d07588">TenuredHeap</a>(T <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) : bits(0) { <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a5e7f29b747ed6132c6d523c58759aeee">setPtr</a>(p); }
<a name="l00308"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a9efc04e7a7466f2428c6171543830a26">00308</a>     <span class="keyword">explicit</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a9efc04e7a7466f2428c6171543830a26">TenuredHeap</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html">TenuredHeap&lt;T&gt;</a> &amp;<a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) : bits(0) { <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a5e7f29b747ed6132c6d523c58759aeee">setPtr</a>(p.ptr); }
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#add77cfcd80e2dcb5798b882629367baf">00310</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#add77cfcd80e2dcb5798b882629367baf">operator==</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html">TenuredHeap&lt;T&gt;</a> &amp;other) { <span class="keywordflow">return</span> bits == other.bits; }
<a name="l00311"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ae5519581d51b1111780fd114e2f3ff61">00311</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ae5519581d51b1111780fd114e2f3ff61">operator!=</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html">TenuredHeap&lt;T&gt;</a> &amp;other) { <span class="keywordflow">return</span> bits != other.bits; }
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a5e7f29b747ed6132c6d523c58759aeee">00313</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a5e7f29b747ed6132c6d523c58759aeee">setPtr</a>(T newPtr) {
<a name="l00314"></a>00314         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>((reinterpret_cast&lt;uintptr_t&gt;(newPtr) &amp; flagsMask) == 0);
<a name="l00315"></a>00315         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::poisoned</a>(newPtr));
<a name="l00316"></a>00316         <span class="keywordflow">if</span> (newPtr)
<a name="l00317"></a>00317             <a class="code" href="../../da/d7b/namespace_j_s.html#ac13c02384cc431692eca45b59a6668a9">AssertGCThingMustBeTenured</a>(newPtr);
<a name="l00318"></a>00318         bits = (bits &amp; flagsMask) | reinterpret_cast&lt;uintptr_t&gt;(newPtr);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00321"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#abf9063396b7feed64885ed3ce9739b0f">00321</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#abf9063396b7feed64885ed3ce9739b0f">setFlags</a>(uintptr_t flagsToSet) {
<a name="l00322"></a>00322         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>((flagsToSet &amp; ~flagsMask) == 0);
<a name="l00323"></a>00323         bits |= flagsToSet;
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a83331c6ce0559b707e964a2800e98869">00326</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a83331c6ce0559b707e964a2800e98869">unsetFlags</a>(uintptr_t flagsToUnset) {
<a name="l00327"></a>00327         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>((flagsToUnset &amp; ~flagsMask) == 0);
<a name="l00328"></a>00328         bits &amp;= ~flagsToUnset;
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330 
<a name="l00331"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#aabcd5fea85ea665ffb5159bda8cda95a">00331</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#aabcd5fea85ea665ffb5159bda8cda95a">hasFlag</a>(uintptr_t flag)<span class="keyword"> const </span>{
<a name="l00332"></a>00332         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>((flag &amp; ~flagsMask) == 0);
<a name="l00333"></a>00333         <span class="keywordflow">return</span> (bits &amp; flag) != 0;
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ada5248ede221237a722b82bbb6a4972f">00336</a>     T <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ada5248ede221237a722b82bbb6a4972f">getPtr</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span>T<span class="keyword">&gt;</span>(bits &amp; ~flagsMask); }
<a name="l00337"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a8f5ee5979b3a2b90a130fa8f98b5e609">00337</a>     uintptr_t <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a8f5ee5979b3a2b90a130fa8f98b5e609">getFlags</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> bits &amp; flagsMask; }
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ad3bc417078bb91ee721f06ad030c0001">00339</a>     <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ad3bc417078bb91ee721f06ad030c0001">operator T</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ada5248ede221237a722b82bbb6a4972f">getPtr</a>(); }
<a name="l00340"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a4f3c3167b444bed87d29819f408452dc">00340</a>     T <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a4f3c3167b444bed87d29819f408452dc">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ada5248ede221237a722b82bbb6a4972f">getPtr</a>(); }
<a name="l00341"></a>00341 
<a name="l00342"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#af10a61aa23a61223206f13a3427645d5">00342</a>     <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html">TenuredHeap&lt;T&gt;</a> &amp;<a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#af10a61aa23a61223206f13a3427645d5">operator=</a>(T <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) {
<a name="l00343"></a>00343         <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a5e7f29b747ed6132c6d523c58759aeee">setPtr</a>(p);
<a name="l00344"></a>00344         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="comment">/*</span>
<a name="l00348"></a>00348 <span class="comment">     * Set the pointer to a value which will cause a crash if it is</span>
<a name="l00349"></a>00349 <span class="comment">     * dereferenced.</span>
<a name="l00350"></a>00350 <span class="comment">     */</span>
<a name="l00351"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a319a089ed670fe40db5ad58ca40bf3b0">00351</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#a319a089ed670fe40db5ad58ca40bf3b0">setToCrashOnTouch</a>() {
<a name="l00352"></a>00352         bits = (bits &amp; flagsMask) | crashOnTouchPointer;
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 
<a name="l00355"></a><a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ab9c4fefae671da1c3db2c6c3528fa4c1">00355</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#ab9c4fefae671da1c3db2c6c3528fa4c1">isSetToCrashOnTouch</a>() {
<a name="l00356"></a>00356         <span class="keywordflow">return</span> (bits &amp; ~flagsMask) == crashOnTouchPointer;
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   <span class="keyword">private</span>:
<a name="l00360"></a>00360     <span class="keyword">enum</span> {
<a name="l00361"></a>00361         maskBits = 3,
<a name="l00362"></a>00362         flagsMask = (1 &lt;&lt; maskBits) - 1,
<a name="l00363"></a>00363         crashOnTouchPointer = 1 &lt;&lt; maskBits
<a name="l00364"></a>00364     };
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     uintptr_t bits;
<a name="l00367"></a>00367 };
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 <span class="comment">/*</span>
<a name="l00370"></a>00370 <span class="comment"> * Reference to a T that has been rooted elsewhere. This is most useful</span>
<a name="l00371"></a>00371 <span class="comment"> * as a parameter type, which guarantees that the T lvalue is properly</span>
<a name="l00372"></a>00372 <span class="comment"> * rooted. See &quot;Move GC Stack Rooting&quot; above.</span>
<a name="l00373"></a>00373 <span class="comment"> *</span>
<a name="l00374"></a>00374 <span class="comment"> * If you want to add additional methods to Handle for a specific</span>
<a name="l00375"></a>00375 <span class="comment"> * specialization, define a HandleBase&lt;T&gt; specialization containing them.</span>
<a name="l00376"></a>00376 <span class="comment"> */</span>
<a name="l00377"></a>00377 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00378"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">00378</a> <span class="keyword">class </span>MOZ_NONHEAP_CLASS <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle</a> : <span class="keyword">public</span> js::HandleBase&lt;T&gt;
<a name="l00379"></a>00379 {
<a name="l00380"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#a0547653642171748cff112f2f904b80f">00380</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle</a>&lt;T&gt;;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382   <span class="keyword">public</span>:
<a name="l00383"></a>00383     <span class="comment">/* Creates a handle from a handle of a type convertible to T. */</span>
<a name="l00384"></a>00384     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> S&gt;
<a name="l00385"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ac371028dd3a5c41f2087bd53d71f19f7">00385</a>     <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle</a>(<a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;S&gt;</a> <a class="code" href="../../d3/d4b/lockscreen_8js.html#af91fa9dd7bcc99f1ac5d9727c6cdc8cc">handle</a>,
<a name="l00386"></a>00386            <span class="keyword">typename</span> <a class="code" href="../../d2/d8e/structmozilla_1_1_enable_if.html">mozilla::EnableIf</a>&lt;<a class="code" href="../../db/db5/structmozilla_1_1_is_convertible.html">mozilla::IsConvertible&lt;S, T&gt;::value</a>, <span class="keywordtype">int</span>&gt;::<a class="code" href="../../d3/d0f/ns_display_item_types_8h.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a> dummy = 0)
<a name="l00387"></a>00387     {
<a name="l00388"></a>00388         <a class="code" href="../../d3/d68/_value_8h.html#a3b52e66790b3e7fa53b9794163d633e5">static_assert</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;T&gt;</a>) == <span class="keyword">sizeof</span>(T *),
<a name="l00389"></a>00389                       <span class="stringliteral">&quot;Handle must be binary compatible with T*.&quot;</span>);
<a name="l00390"></a>00390         ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>T *<span class="keyword">&gt;</span>(handle.<a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ad2b2ee4b6f81b3fb6b13cca84718d810">address</a>());
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="comment">/* Create a handle for a NULL pointer. */</span>
<a name="l00394"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#aa25574cc0b041ae40a015f07ec42185b">00394</a>     <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#aa25574cc0b041ae40a015f07ec42185b">Handle</a>(<a class="code" href="../../d5/d23/structjs_1_1_null_ptr.html">js::NullPtr</a>) {
<a name="l00395"></a>00395         <a class="code" href="../../d3/d68/_value_8h.html#a3b52e66790b3e7fa53b9794163d633e5">static_assert</a>(<a class="code" href="../../d3/d20/structmozilla_1_1_is_pointer.html">mozilla::IsPointer&lt;T&gt;::value</a>,
<a name="l00396"></a>00396                       <span class="stringliteral">&quot;js::NullPtr overload not valid for non-pointer types&quot;</span>);
<a name="l00397"></a>00397         ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>T *<span class="keyword">&gt;</span>(&amp;<a class="code" href="../../d5/d23/structjs_1_1_null_ptr.html#a18e4b75e25eef6765f2411e1a05476ad">js::NullPtr::constNullValue</a>);
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="comment">/* Create a handle for a NULL pointer. */</span>
<a name="l00401"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ab22b2369d981f33458661ea23e6d5917">00401</a>     <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ab22b2369d981f33458661ea23e6d5917">Handle</a>(JS::NullPtr) {
<a name="l00402"></a>00402         <a class="code" href="../../d3/d68/_value_8h.html#a3b52e66790b3e7fa53b9794163d633e5">static_assert</a>(<a class="code" href="../../d3/d20/structmozilla_1_1_is_pointer.html">mozilla::IsPointer&lt;T&gt;::value</a>,
<a name="l00403"></a>00403                       <span class="stringliteral">&quot;JS::NullPtr overload not valid for non-pointer types&quot;</span>);
<a name="l00404"></a>00404         ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>T *<span class="keyword">&gt;</span>(&amp;JS::NullPtr::constNullValue);
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ac0a461d4def232488e2d5080d40ebc46">00407</a>     <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ac0a461d4def232488e2d5080d40ebc46">Handle</a>(<a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;T&gt;</a> <a class="code" href="../../d3/d4b/lockscreen_8js.html#af91fa9dd7bcc99f1ac5d9727c6cdc8cc">handle</a>) {
<a name="l00408"></a>00408         ptr = handle.<a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a29f3c5d66a464e63edf39d6a33cf1485">address</a>();
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="comment">/*</span>
<a name="l00412"></a>00412 <span class="comment">     * Take care when calling this method!</span>
<a name="l00413"></a>00413 <span class="comment">     *</span>
<a name="l00414"></a>00414 <span class="comment">     * This creates a Handle from the raw location of a T.</span>
<a name="l00415"></a>00415 <span class="comment">     *</span>
<a name="l00416"></a>00416 <span class="comment">     * It should be called only if the following conditions hold:</span>
<a name="l00417"></a>00417 <span class="comment">     *</span>
<a name="l00418"></a>00418 <span class="comment">     *  1) the location of the T is guaranteed to be marked (for some reason</span>
<a name="l00419"></a>00419 <span class="comment">     *     other than being a Rooted), e.g., if it is guaranteed to be reachable</span>
<a name="l00420"></a>00420 <span class="comment">     *     from an implicit root.</span>
<a name="l00421"></a>00421 <span class="comment">     *</span>
<a name="l00422"></a>00422 <span class="comment">     *  2) the contents of the location are immutable, or at least cannot change</span>
<a name="l00423"></a>00423 <span class="comment">     *     for the lifetime of the handle, as its users may not expect its value</span>
<a name="l00424"></a>00424 <span class="comment">     *     to change underneath them.</span>
<a name="l00425"></a>00425 <span class="comment">     */</span>
<a name="l00426"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#a41d0190afa204515020b5f7626e97dd3">00426</a>     <span class="keyword">static</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle</a> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#a41d0190afa204515020b5f7626e97dd3">fromMarkedLocation</a>(<span class="keyword">const</span> T *<a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) {
<a name="l00427"></a>00427         <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle</a> h;
<a name="l00428"></a>00428         h.ptr = <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>;
<a name="l00429"></a>00429         <span class="keywordflow">return</span> h;
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="comment">/*</span>
<a name="l00433"></a>00433 <span class="comment">     * Construct a handle from an explicitly rooted location. This is the</span>
<a name="l00434"></a>00434 <span class="comment">     * normal way to create a handle, and normally happens implicitly.</span>
<a name="l00435"></a>00435 <span class="comment">     */</span>
<a name="l00436"></a>00436     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> S&gt;
<a name="l00437"></a>00437     <span class="keyword">inline</span>
<a name="l00438"></a>00438     <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle</a>(<span class="keyword">const</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;S&gt;</a> &amp;<a class="code" href="../../d1/df9/apps_2email_2js_2ext_2mailapi_2activesync_2configurator_8js.html#a11a10a6834f3c54a5380f4ff04d002a9">root</a>,
<a name="l00439"></a>00439            <span class="keyword">typename</span> <a class="code" href="../../d2/d8e/structmozilla_1_1_enable_if.html">mozilla::EnableIf</a>&lt;<a class="code" href="../../db/db5/structmozilla_1_1_is_convertible.html">mozilla::IsConvertible&lt;S, T&gt;::value</a>, <span class="keywordtype">int</span>&gt;::<a class="code" href="../../d3/d0f/ns_display_item_types_8h.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a> dummy = 0);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="comment">/* Construct a read only handle from a mutable handle. */</span>
<a name="l00442"></a>00442     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> S&gt;
<a name="l00443"></a>00443     <span class="keyword">inline</span>
<a name="l00444"></a>00444     <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle</a>(<a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;S&gt;</a> &amp;<a class="code" href="../../d1/df9/apps_2email_2js_2ext_2mailapi_2activesync_2configurator_8js.html#a11a10a6834f3c54a5380f4ff04d002a9">root</a>,
<a name="l00445"></a>00445            <span class="keyword">typename</span> <a class="code" href="../../d2/d8e/structmozilla_1_1_enable_if.html">mozilla::EnableIf</a>&lt;<a class="code" href="../../db/db5/structmozilla_1_1_is_convertible.html">mozilla::IsConvertible&lt;S, T&gt;::value</a>, <span class="keywordtype">int</span>&gt;::<a class="code" href="../../d3/d0f/ns_display_item_types_8h.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a> dummy = 0);
<a name="l00446"></a>00446 
<a name="l00447"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ad2b2ee4b6f81b3fb6b13cca84718d810">00447</a>     <span class="keyword">const</span> T *<a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ad2b2ee4b6f81b3fb6b13cca84718d810">address</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00448"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#a191fd3f89675b0917e12f831b4ad6697">00448</a>     <span class="keyword">const</span> T&amp; <span class="keyword">get</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> *ptr; }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <span class="comment">/*</span>
<a name="l00451"></a>00451 <span class="comment">     * Return a reference so passing a Handle&lt;T&gt; to something that</span>
<a name="l00452"></a>00452 <span class="comment">     * takes a |const T&amp;| is not a GC hazard.</span>
<a name="l00453"></a>00453 <span class="comment">     */</span>
<a name="l00454"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#a90b8fae2c0ceabe8aff7d3bd8f067524">00454</a>     operator const T&amp;()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">get</span>(); }
<a name="l00455"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ad497bb2f7e0c58055dd730aa3040cfd8">00455</a>     T <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ad497bb2f7e0c58055dd730aa3040cfd8">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">get</span>(); }
<a name="l00456"></a>00456 
<a name="l00457"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#acf4cf0ab5323f180c71f19121de68ba2">00457</a>     <span class="keywordtype">bool</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#acf4cf0ab5323f180c71f19121de68ba2">operator!=</a>(<span class="keyword">const</span> T &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *ptr != other; }
<a name="l00458"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#a6ab9ea0a1650a5f3691488fb3a2eab1f">00458</a>     <span class="keywordtype">bool</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#a6ab9ea0a1650a5f3691488fb3a2eab1f">operator==</a>(<span class="keyword">const</span> T &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *ptr == other; }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <span class="keyword">private</span>:
<a name="l00461"></a>00461     <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle</a>() {}
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     <span class="keyword">const</span> T *ptr;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> S&gt;
<a name="l00466"></a>00466     <span class="keywordtype">void</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#af10a61aa23a61223206f13a3427645d5">operator=</a>(S <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) MOZ_DELETE;
<a name="l00467"></a>00467 };
<a name="l00468"></a>00468 
<a name="l00469"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a27fbe8d507bcc80ecf65d4dfa346936e">00469</a> <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;JSObject*&gt;</a>                   <a class="code" href="../../da/d7b/namespace_j_s.html#a27fbe8d507bcc80ecf65d4dfa346936e">HandleObject</a>;
<a name="l00470"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a5c2f51befeeaa2b29e10c9ee7bb2a0c1">00470</a> <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;js::Module*&gt;</a>                 <a class="code" href="../../da/d7b/namespace_j_s.html#a5c2f51befeeaa2b29e10c9ee7bb2a0c1">HandleModule</a>;
<a name="l00471"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a418361489d0245f6a50b9ec05e716eee">00471</a> <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;js::ScriptSourceObject *&gt;</a>    <a class="code" href="../../da/d7b/namespace_j_s.html#a418361489d0245f6a50b9ec05e716eee">HandleScriptSource</a>;
<a name="l00472"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a21d6ad8907efe348adef8f94c6e8bc08">00472</a> <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;JSFunction*&gt;</a>                 <a class="code" href="../../da/d7b/namespace_j_s.html#a21d6ad8907efe348adef8f94c6e8bc08">HandleFunction</a>;
<a name="l00473"></a><a class="code" href="../../da/d7b/namespace_j_s.html#acaab8f8df0aded96a10580591374872f">00473</a> <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;JSScript*&gt;</a>                   <a class="code" href="../../da/d7b/namespace_j_s.html#acaab8f8df0aded96a10580591374872f">HandleScript</a>;
<a name="l00474"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a93fe2101649396e379a082a441066177">00474</a> <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;JSString*&gt;</a>                   <a class="code" href="../../da/d7b/namespace_j_s.html#a93fe2101649396e379a082a441066177">HandleString</a>;
<a name="l00475"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a3a21bbd1526caa6bd8cd8d7bdeb3f119">00475</a> <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;jsid&gt;</a>                        <a class="code" href="../../da/d7b/namespace_j_s.html#a3a21bbd1526caa6bd8cd8d7bdeb3f119">HandleId</a>;
<a name="l00476"></a><a class="code" href="../../da/d7b/namespace_j_s.html#ad0f815dced139d94ef7a891f97e3bb2c">00476</a> <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;Value&gt;</a>                       <a class="code" href="../../da/d7b/namespace_j_s.html#ad0f815dced139d94ef7a891f97e3bb2c">HandleValue</a>;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 <span class="comment">/*</span>
<a name="l00479"></a>00479 <span class="comment"> * Similar to a handle, but the underlying storage can be changed. This is</span>
<a name="l00480"></a>00480 <span class="comment"> * useful for outparams.</span>
<a name="l00481"></a>00481 <span class="comment"> *</span>
<a name="l00482"></a>00482 <span class="comment"> * If you want to add additional methods to MutableHandle for a specific</span>
<a name="l00483"></a>00483 <span class="comment"> * specialization, define a MutableHandleBase&lt;T&gt; specialization containing</span>
<a name="l00484"></a>00484 <span class="comment"> * them.</span>
<a name="l00485"></a>00485 <span class="comment"> */</span>
<a name="l00486"></a>00486 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00487"></a><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">00487</a> <span class="keyword">class </span>MOZ_STACK_CLASS <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle</a> : <span class="keyword">public</span> js::MutableHandleBase&lt;T&gt;
<a name="l00488"></a>00488 {
<a name="l00489"></a>00489   <span class="keyword">public</span>:
<a name="l00490"></a>00490     <span class="keyword">inline</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle</a>(<a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;T&gt;</a> *<a class="code" href="../../d1/df9/apps_2email_2js_2ext_2mailapi_2activesync_2configurator_8js.html#a11a10a6834f3c54a5380f4ff04d002a9">root</a>);
<a name="l00491"></a>00491 
<a name="l00492"></a><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a62abdee2e1a2def647c6e0de3c0fb717">00492</a>     <span class="keywordtype">void</span> <span class="keyword">set</span>(T <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) {
<a name="l00493"></a>00493         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::poisoned</a>(<a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>));
<a name="l00494"></a>00494         *ptr = <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>;
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="comment">/*</span>
<a name="l00498"></a>00498 <span class="comment">     * This may be called only if the location of the T is guaranteed</span>
<a name="l00499"></a>00499 <span class="comment">     * to be marked (for some reason other than being a Rooted),</span>
<a name="l00500"></a>00500 <span class="comment">     * e.g., if it is guaranteed to be reachable from an implicit root.</span>
<a name="l00501"></a>00501 <span class="comment">     *</span>
<a name="l00502"></a>00502 <span class="comment">     * Create a MutableHandle from a raw location of a T.</span>
<a name="l00503"></a>00503 <span class="comment">     */</span>
<a name="l00504"></a><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a23eda4494e7424d50f594ff83bf0fbb3">00504</a>     <span class="keyword">static</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle</a> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a23eda4494e7424d50f594ff83bf0fbb3">fromMarkedLocation</a>(T *<a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>) {
<a name="l00505"></a>00505         <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle</a> h;
<a name="l00506"></a>00506         h.ptr = <a class="code" href="../../db/de5/namespacedefault__timezones.html#a28422cbbc99cee3f1b68cd64c3ded285">p</a>;
<a name="l00507"></a>00507         <span class="keywordflow">return</span> h;
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a29f3c5d66a464e63edf39d6a33cf1485">00510</a>     T *<a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a29f3c5d66a464e63edf39d6a33cf1485">address</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00511"></a><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#af93e7950c57d120f05b2bb6f2e975c2f">00511</a>     <span class="keyword">const</span> T&amp; <span class="keyword">get</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> *ptr; }
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="comment">/*</span>
<a name="l00514"></a>00514 <span class="comment">     * Return a reference so passing a MutableHandle&lt;T&gt; to something that takes</span>
<a name="l00515"></a>00515 <span class="comment">     * a |const T&amp;| is not a GC hazard.</span>
<a name="l00516"></a>00516 <span class="comment">     */</span>
<a name="l00517"></a><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a72a9d77e8140fc1a917ee4a424ff0513">00517</a>     operator const T&amp;()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">get</span>(); }
<a name="l00518"></a><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a09bc884ff6fc43776aa62704e59b8f65">00518</a>     T <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a09bc884ff6fc43776aa62704e59b8f65">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">get</span>(); }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520   <span class="keyword">private</span>:
<a name="l00521"></a>00521     <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle</a>() {}
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     T *ptr;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> S&gt; <span class="keywordtype">void</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#af10a61aa23a61223206f13a3427645d5">operator=</a>(S <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) MOZ_DELETE;
<a name="l00526"></a>00526     <span class="keywordtype">void</span> <a class="code" href="../../d6/d84/class_j_s_1_1_tenured_heap.html#af10a61aa23a61223206f13a3427645d5">operator=</a>(MutableHandle other) MOZ_DELETE;
<a name="l00527"></a>00527 };
<a name="l00528"></a>00528 
<a name="l00529"></a><a class="code" href="../../da/d7b/namespace_j_s.html#ae1928b24f28263eb4671da639d098fa2">00529</a> <span class="keyword">typedef</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;JSObject*&gt;</a>   <a class="code" href="../../da/d7b/namespace_j_s.html#ae1928b24f28263eb4671da639d098fa2">MutableHandleObject</a>;
<a name="l00530"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a0c33004e8673a6a57470d5d7169f619c">00530</a> <span class="keyword">typedef</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;JSFunction*&gt;</a> <a class="code" href="../../da/d7b/namespace_j_s.html#a0c33004e8673a6a57470d5d7169f619c">MutableHandleFunction</a>;
<a name="l00531"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a8a758f50f481b3cb1421c1775f4c5a43">00531</a> <span class="keyword">typedef</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;JSScript*&gt;</a>   <a class="code" href="../../da/d7b/namespace_j_s.html#a8a758f50f481b3cb1421c1775f4c5a43">MutableHandleScript</a>;
<a name="l00532"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a390399c9f6d858dd884a5e9830d7e232">00532</a> <span class="keyword">typedef</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;JSString*&gt;</a>   <a class="code" href="../../da/d7b/namespace_j_s.html#a390399c9f6d858dd884a5e9830d7e232">MutableHandleString</a>;
<a name="l00533"></a><a class="code" href="../../da/d7b/namespace_j_s.html#adefae0e0e642dbd47bd9d5b2fdf78ca0">00533</a> <span class="keyword">typedef</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;jsid&gt;</a>        <a class="code" href="../../da/d7b/namespace_j_s.html#adefae0e0e642dbd47bd9d5b2fdf78ca0">MutableHandleId</a>;
<a name="l00534"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a3c796ebbafcdf51a26ea70b1a366a93e">00534</a> <span class="keyword">typedef</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;Value&gt;</a>       <a class="code" href="../../da/d7b/namespace_j_s.html#a3c796ebbafcdf51a26ea70b1a366a93e">MutableHandleValue</a>;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 <span class="preprocessor">#ifdef JSGC_GENERATIONAL</span>
<a name="l00537"></a>00537 <span class="preprocessor"></span><a class="code" href="../../da/d7b/namespace_j_s.html#af066ac8d16defce202733c71cbc1970f">JS_PUBLIC_API</a>(<span class="keywordtype">void</span>) HeapCellPostBarrier(js::gc::Cell **cellp);
<a name="l00538"></a>00538 <a class="code" href="../../da/d7b/namespace_j_s.html#af066ac8d16defce202733c71cbc1970f">JS_PUBLIC_API</a>(<span class="keywordtype">void</span>) HeapCellRelocate(js::gc::Cell **cellp);
<a name="l00539"></a>00539 <span class="preprocessor">#endif</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>
<a name="l00541"></a>00541 } <span class="comment">/* namespace JS */</span>
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 <span class="keyword">namespace </span>js {
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 <span class="comment">/*</span>
<a name="l00546"></a>00546 <span class="comment"> * InternalHandle is a handle to an internal pointer into a gcthing. Use</span>
<a name="l00547"></a>00547 <span class="comment"> * InternalHandle when you have a pointer to a direct field of a gcthing, or</span>
<a name="l00548"></a>00548 <span class="comment"> * when you need a parameter type for something that *may* be a pointer to a</span>
<a name="l00549"></a>00549 <span class="comment"> * direct field of a gcthing.</span>
<a name="l00550"></a>00550 <span class="comment"> */</span>
<a name="l00551"></a>00551 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00552"></a><a class="code" href="../../d1/db8/classjs_1_1_internal_handle.html">00552</a> <span class="keyword">class </span><a class="code" href="../../d1/db8/classjs_1_1_internal_handle.html">InternalHandle</a> {};
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00555"></a><a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html">00555</a> <span class="keyword">class </span><a class="code" href="../../d1/db8/classjs_1_1_internal_handle.html">InternalHandle</a>&lt;T*&gt;
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     <span class="keywordtype">void</span> * <span class="keyword">const</span> *holder;
<a name="l00558"></a>00558     <span class="keywordtype">size_t</span> <a class="code" href="../../da/d32/prio_8h.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a>;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560   <span class="keyword">public</span>:
<a name="l00561"></a>00561     <span class="comment">/*</span>
<a name="l00562"></a>00562 <span class="comment">     * Create an InternalHandle using a Handle to the gcthing containing the</span>
<a name="l00563"></a>00563 <span class="comment">     * field in question, and a pointer to the field.</span>
<a name="l00564"></a>00564 <span class="comment">     */</span>
<a name="l00565"></a>00565     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> H&gt;
<a name="l00566"></a><a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#a2ed00da90b872c54d5e189cc60f57411">00566</a>     <a class="code" href="../../d1/db8/classjs_1_1_internal_handle.html">InternalHandle</a>(<span class="keyword">const</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">JS::Handle&lt;H&gt;</a> &amp;<a class="code" href="../../d3/d4b/lockscreen_8js.html#af91fa9dd7bcc99f1ac5d9727c6cdc8cc">handle</a>, T *field)
<a name="l00567"></a>00567       : holder((<a class="code" href="../../d4/da9/png_8h.html#ab30926da86712184b070e550789f8bf7">void</a>**)handle.<a class="code" href="../../df/d9e/prnetdb_8h.html#a906995422a64396276c50a754ed3d21e">address</a>()), offset(uintptr_t(field) - uintptr_t(handle.<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>()))
<a name="l00568"></a>00568     {}
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="comment">/*</span>
<a name="l00571"></a>00571 <span class="comment">     * Create an InternalHandle to a field within a Rooted&lt;&gt;.</span>
<a name="l00572"></a>00572 <span class="comment">     */</span>
<a name="l00573"></a>00573     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> R&gt;
<a name="l00574"></a><a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#afd8c7658a3baba83dfa4b62bf232b22b">00574</a>     <a class="code" href="../../d1/db8/classjs_1_1_internal_handle.html">InternalHandle</a>(<span class="keyword">const</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">JS::Rooted&lt;R&gt;</a> &amp;<a class="code" href="../../d1/df9/apps_2email_2js_2ext_2mailapi_2activesync_2configurator_8js.html#a11a10a6834f3c54a5380f4ff04d002a9">root</a>, T *field)
<a name="l00575"></a>00575       : holder((<a class="code" href="../../d4/da9/png_8h.html#ab30926da86712184b070e550789f8bf7">void</a>**)root.<a class="code" href="../../df/d9e/prnetdb_8h.html#a906995422a64396276c50a754ed3d21e">address</a>()), offset(uintptr_t(field) - uintptr_t(root.<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>()))
<a name="l00576"></a>00576     {}
<a name="l00577"></a>00577 
<a name="l00578"></a><a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#a703cc6b235a1945bfb5207013450c85c">00578</a>     T *<span class="keyword">get</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span>T*<span class="keyword">&gt;</span>(uintptr_t(*holder) + <a class="code" href="../../da/d32/prio_8h.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a>); }
<a name="l00579"></a>00579 
<a name="l00580"></a><a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#aeeaea1c9c280824e7ef529131f5cdf5b">00580</a>     <span class="keyword">const</span> T &amp;<a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#aeeaea1c9c280824e7ef529131f5cdf5b">operator*</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *<span class="keyword">get</span>(); }
<a name="l00581"></a><a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#a4dec61de42e0eec77667f2520d8d50ee">00581</a>     T *<a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#a4dec61de42e0eec77667f2520d8d50ee">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">get</span>(); }
<a name="l00582"></a>00582 
<a name="l00583"></a><a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#a15434de751bf515b086e7e1b10037a92">00583</a>     <span class="keyword">static</span> <a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html">InternalHandle&lt;T*&gt;</a> <a class="code" href="../../df/da7/classjs_1_1_internal_handle_3_01_t_01_5_01_4.html#a15434de751bf515b086e7e1b10037a92">fromMarkedLocation</a>(T *fieldPtr) {
<a name="l00584"></a>00584         <span class="keywordflow">return</span> <a class="code" href="../../d1/db8/classjs_1_1_internal_handle.html">InternalHandle</a>(fieldPtr);
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587   <span class="keyword">private</span>:
<a name="l00588"></a>00588     <span class="comment">/*</span>
<a name="l00589"></a>00589 <span class="comment">     * Create an InternalHandle to something that is not a pointer to a</span>
<a name="l00590"></a>00590 <span class="comment">     * gcthing, and so does not need to be rooted in the first place. Use these</span>
<a name="l00591"></a>00591 <span class="comment">     * InternalHandles to pass pointers into functions that also need to accept</span>
<a name="l00592"></a>00592 <span class="comment">     * regular InternalHandles to gcthing fields.</span>
<a name="l00593"></a>00593 <span class="comment">     *</span>
<a name="l00594"></a>00594 <span class="comment">     * Make this private to prevent accidental misuse; this is only for</span>
<a name="l00595"></a>00595 <span class="comment">     * fromMarkedLocation().</span>
<a name="l00596"></a>00596 <span class="comment">     */</span>
<a name="l00597"></a>00597     <a class="code" href="../../d1/db8/classjs_1_1_internal_handle.html">InternalHandle</a>(T *field)
<a name="l00598"></a>00598       : holder(reinterpret_cast&lt;<a class="code" href="../../d4/da9/png_8h.html#ab30926da86712184b070e550789f8bf7">void</a> * <a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> *&gt;(&amp;js::<a class="code" href="../../d5/d23/structjs_1_1_null_ptr.html">NullPtr</a>::constNullValue)),
<a name="l00599"></a>00599         offset(uintptr_t(field))
<a name="l00600"></a>00600     {}
<a name="l00601"></a>00601 };
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 <span class="comment">/*</span>
<a name="l00604"></a>00604 <span class="comment"> * By default, pointers should use the inheritance hierarchy to find their</span>
<a name="l00605"></a>00605 <span class="comment"> * ThingRootKind. Some pointer types are explicitly set in jspubtd.h so that</span>
<a name="l00606"></a>00606 <span class="comment"> * Rooted&lt;T&gt; may be used without the class definition being available.</span>
<a name="l00607"></a>00607 <span class="comment"> */</span>
<a name="l00608"></a>00608 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00609"></a><a class="code" href="../../d4/dee/structjs_1_1_root_kind_3_01_t_01_5_01_4.html">00609</a> <span class="keyword">struct </span>RootKind&lt;T *&gt;
<a name="l00610"></a>00610 {
<a name="l00611"></a><a class="code" href="../../d4/dee/structjs_1_1_root_kind_3_01_t_01_5_01_4.html#a0a5d4237e5eafe25487a582216dba379">00611</a>     <span class="keyword">static</span> <a class="code" href="../../db/da2/namespacejs.html#aa5d49315248633a3172d03f50fd69250">ThingRootKind</a> <a class="code" href="../../d4/dee/structjs_1_1_root_kind_3_01_t_01_5_01_4.html#a0a5d4237e5eafe25487a582216dba379">rootKind</a>() { <span class="keywordflow">return</span> T::rootKind(); }
<a name="l00612"></a>00612 };
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00615"></a><a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html">00615</a> <span class="keyword">struct </span><a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">GCMethods</a>&lt;T *&gt;
<a name="l00616"></a>00616 {
<a name="l00617"></a><a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html#a07edf6deeeb31ae12652ac63c46d5bea">00617</a>     <span class="keyword">static</span> T *<a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html#a07edf6deeeb31ae12652ac63c46d5bea">initial</a>() { <span class="keywordflow">return</span> <a class="code" href="../../db/df5/ncompat_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; }
<a name="l00618"></a><a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html#a8e2dd95b5d4b6c9d58b82916048a0d68">00618</a>     <span class="keyword">static</span> <a class="code" href="../../db/da2/namespacejs.html#aa5d49315248633a3172d03f50fd69250">ThingRootKind</a> <a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html#a8e2dd95b5d4b6c9d58b82916048a0d68">kind</a>() { <span class="keywordflow">return</span> RootKind&lt;T *&gt;::rootKind(); }
<a name="l00619"></a><a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html#af046a12e72f88a7cb07c74e341b620b4">00619</a>     <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html#af046a12e72f88a7cb07c74e341b620b4">poisoned</a>(T *<a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) { <span class="keywordflow">return</span> <a class="code" href="../../da/d7b/namespace_j_s.html#a5f3ab236563114ba05aad0fec919edbb">JS::IsPoisonedPtr</a>(v); }
<a name="l00620"></a><a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html#a247e3e5d8054fb0abbbd11f1942254f6">00620</a>     <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../d9/d28/structjs_1_1_g_c_methods_3_01_t_01_5_01_4.html#a247e3e5d8054fb0abbbd11f1942254f6">needsPostBarrier</a>(T *<a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) { <span class="keywordflow">return</span> <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>; }
<a name="l00621"></a>00621 <span class="preprocessor">#ifdef JSGC_GENERATIONAL</span>
<a name="l00622"></a>00622 <span class="preprocessor"></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> postBarrier(T **<a class="code" href="../../de/dd6/_call_args_8h.html#a0e1edae250e9221382471f42214f7af0">vp</a>) {
<a name="l00623"></a>00623         JS::HeapCellPostBarrier(reinterpret_cast&lt;js::gc::Cell **&gt;(vp));
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625     <span class="keyword">static</span> <span class="keywordtype">void</span> relocate(T **vp) {
<a name="l00626"></a>00626         JS::HeapCellRelocate(reinterpret_cast&lt;js::gc::Cell **&gt;(vp));
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628 <span class="preprocessor">#endif</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span>};
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 <span class="preprocessor">#if defined(DEBUG)</span>
<a name="l00632"></a>00632 <span class="preprocessor"></span><span class="comment">/* This helper allows us to assert that Rooted&lt;T&gt; is scoped within a request. */</span>
<a name="l00633"></a>00633 <span class="keyword">extern</span> <a class="code" href="../../da/d7b/namespace_j_s.html#af066ac8d16defce202733c71cbc1970f">JS_PUBLIC_API</a>(<span class="keywordtype">bool</span>)
<a name="l00634"></a>00634 IsInRequest(<a class="code" href="../../d9/d28/jspubtd_8h.html#a1511e24a5b9d6d2e0e689afd9c6c0b9b">JSContext</a> *<a class="code" href="../../de/d8f/jsdebug_8h.html#ac84a9ad5e2527762d63c6001438948b3">cx</a>);
<a name="l00635"></a>00635 <span class="preprocessor">#endif</span>
<a name="l00636"></a>00636 <span class="preprocessor"></span>
<a name="l00637"></a>00637 } <span class="comment">/* namespace js */</span>
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 <span class="keyword">namespace </span>JS {
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 <span class="comment">/*</span>
<a name="l00642"></a>00642 <span class="comment"> * Local variable of type T whose value is always rooted. This is typically</span>
<a name="l00643"></a>00643 <span class="comment"> * used for local variables, or for non-rooted values being passed to a</span>
<a name="l00644"></a>00644 <span class="comment"> * function that requires a handle, e.g. Foo(Root&lt;T&gt;(cx, x)).</span>
<a name="l00645"></a>00645 <span class="comment"> *</span>
<a name="l00646"></a>00646 <span class="comment"> * If you want to add additional methods to Rooted for a specific</span>
<a name="l00647"></a>00647 <span class="comment"> * specialization, define a RootedBase&lt;T&gt; specialization containing them.</span>
<a name="l00648"></a>00648 <span class="comment"> */</span>
<a name="l00649"></a>00649 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00650"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">00650</a> <span class="keyword">class </span>MOZ_STACK_CLASS <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a> : <span class="keyword">public</span> js::RootedBase&lt;T&gt;
<a name="l00651"></a>00651 {
<a name="l00652"></a>00652     <span class="comment">/* Note: CX is a subclass of either ContextFriendFields or PerThreadDataFriendFields. */</span>
<a name="l00653"></a>00653     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> CX&gt;
<a name="l00654"></a>00654     <span class="keywordtype">void</span> <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(CX *<a class="code" href="../../de/d8f/jsdebug_8h.html#ac84a9ad5e2527762d63c6001438948b3">cx</a>) {
<a name="l00655"></a>00655 <span class="preprocessor">#ifdef JSGC_TRACK_EXACT_ROOTS</span>
<a name="l00656"></a>00656 <span class="preprocessor"></span>        <a class="code" href="../../db/da2/namespacejs.html#aa5d49315248633a3172d03f50fd69250">js::ThingRootKind</a> <a class="code" href="../../da/d7b/namespace_j_s.html#adfbe788b74138837e1581752ca60367d">kind</a> = <a class="code" href="../../da/d7b/namespace_j_s.html#adfbe788b74138837e1581752ca60367d">js::GCMethods&lt;T&gt;::kind</a>();
<a name="l00657"></a>00657         this-&gt;<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a> = &amp;cx-&gt;thingGCRooters[<a class="code" href="../../da/d7b/namespace_j_s.html#adfbe788b74138837e1581752ca60367d">kind</a>];
<a name="l00658"></a>00658         this-&gt;<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aa8ce26f0d9a701e8f80cbff3ed272d85">prev</a> = *<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a>;
<a name="l00659"></a>00659         *<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a> = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;void*&gt;</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
<a name="l00660"></a>00660 
<a name="l00661"></a>00661         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::poisoned</a>(ptr));
<a name="l00662"></a>00662 <span class="preprocessor">#endif</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span>    }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665   <span class="keyword">public</span>:
<a name="l00666"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a087c4d975fc9b294e1d0ed5c0dec6984">00666</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<a class="code" href="../../d9/d28/jspubtd_8h.html#a1511e24a5b9d6d2e0e689afd9c6c0b9b">JSContext</a> *cx
<a name="l00667"></a>00667            MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00668"></a>00668       : ptr(js::GCMethods&lt;T&gt;::initial())
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00671"></a>00671         <a class="code" href="../../d9/de9/_assertions_8h.html#aa2fa77a048d036cb2f902299ace18165">MOZ_ASSERT</a>(js::IsInRequest(cx));
<a name="l00672"></a>00672         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(<a class="code" href="../../d1/d50/structjs_1_1_context_friend_fields.html#a185ad442c721826c20e298df15ec3961">js::ContextFriendFields::get</a>(cx));
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 
<a name="l00675"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a56d8d2a402a3fdfc8f66af4c1a55aa72">00675</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<a class="code" href="../../d9/d28/jspubtd_8h.html#a1511e24a5b9d6d2e0e689afd9c6c0b9b">JSContext</a> *cx, T initial
<a name="l00676"></a>00676            MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00677"></a>00677       : ptr(initial)
<a name="l00678"></a>00678     {
<a name="l00679"></a>00679         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00680"></a>00680         <a class="code" href="../../d9/de9/_assertions_8h.html#aa2fa77a048d036cb2f902299ace18165">MOZ_ASSERT</a>(js::IsInRequest(cx));
<a name="l00681"></a>00681         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(<a class="code" href="../../d1/d50/structjs_1_1_context_friend_fields.html#a185ad442c721826c20e298df15ec3961">js::ContextFriendFields::get</a>(cx));
<a name="l00682"></a>00682     }
<a name="l00683"></a>00683 
<a name="l00684"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#ad72edcf78ea5e78235393419fe7f4434">00684</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<a class="code" href="../../d1/d50/structjs_1_1_context_friend_fields.html">js::ContextFriendFields</a> *cx
<a name="l00685"></a>00685            MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00686"></a>00686       : ptr(js::GCMethods&lt;T&gt;::initial())
<a name="l00687"></a>00687     {
<a name="l00688"></a>00688         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00689"></a>00689         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(cx);
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691 
<a name="l00692"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a9d4ec4fcae6919bcf88b6fa4c1c69546">00692</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<a class="code" href="../../d1/d50/structjs_1_1_context_friend_fields.html">js::ContextFriendFields</a> *cx, T initial
<a name="l00693"></a>00693            MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00694"></a>00694       : ptr(initial)
<a name="l00695"></a>00695     {
<a name="l00696"></a>00696         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00697"></a>00697         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(cx);
<a name="l00698"></a>00698     }
<a name="l00699"></a>00699 
<a name="l00700"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#af4024f7b89f67e751ca15731d4ee37cd">00700</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<a class="code" href="../../d8/d6c/structjs_1_1_per_thread_data_friend_fields.html">js::PerThreadDataFriendFields</a> *pt
<a name="l00701"></a>00701            MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00702"></a>00702       : ptr(js::GCMethods&lt;T&gt;::initial())
<a name="l00703"></a>00703     {
<a name="l00704"></a>00704         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00705"></a>00705         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(pt);
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707 
<a name="l00708"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a68b13b0dd6594d2f15a68c06e42a32f9">00708</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<a class="code" href="../../d8/d6c/structjs_1_1_per_thread_data_friend_fields.html">js::PerThreadDataFriendFields</a> *pt, T initial
<a name="l00709"></a>00709            MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00710"></a>00710       : ptr(initial)
<a name="l00711"></a>00711     {
<a name="l00712"></a>00712         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00713"></a>00713         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(pt);
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715 
<a name="l00716"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a147484f1731bc46eb1f2da94f1b44b29">00716</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<a class="code" href="../../d9/d28/jspubtd_8h.html#a3784945ce27c2255b53f51e5118c6728">JSRuntime</a> *<a class="code" href="../../d2/d7d/jsapi_8h.html#a3ba489a976915ca6161baede3c439066">rt</a>
<a name="l00717"></a>00717            MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00718"></a>00718       : ptr(js::GCMethods&lt;T&gt;::initial())
<a name="l00719"></a>00719     {
<a name="l00720"></a>00720         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00721"></a>00721         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(<a class="code" href="../../d8/d6c/structjs_1_1_per_thread_data_friend_fields.html#a986f182dd9e0f8cbba57e521aa392ee0">js::PerThreadDataFriendFields::getMainThread</a>(<a class="code" href="../../d2/d7d/jsapi_8h.html#a3ba489a976915ca6161baede3c439066">rt</a>));
<a name="l00722"></a>00722     }
<a name="l00723"></a>00723 
<a name="l00724"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a8da516d27ddd39e2cb0a49b5c0758ac2">00724</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<a class="code" href="../../d9/d28/jspubtd_8h.html#a3784945ce27c2255b53f51e5118c6728">JSRuntime</a> *<a class="code" href="../../d2/d7d/jsapi_8h.html#a3ba489a976915ca6161baede3c439066">rt</a>, T initial
<a name="l00725"></a>00725            MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00726"></a>00726       : ptr(initial)
<a name="l00727"></a>00727     {
<a name="l00728"></a>00728         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00729"></a>00729         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(<a class="code" href="../../d8/d6c/structjs_1_1_per_thread_data_friend_fields.html#a986f182dd9e0f8cbba57e521aa392ee0">js::PerThreadDataFriendFields::getMainThread</a>(rt));
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731 
<a name="l00732"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a6362b616cc06280f54465af51987b266">00732</a>     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a6362b616cc06280f54465af51987b266">~Rooted</a>() {
<a name="l00733"></a>00733 <span class="preprocessor">#ifdef JSGC_TRACK_EXACT_ROOTS</span>
<a name="l00734"></a>00734 <span class="preprocessor"></span>        <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(*<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a> == <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;void*&gt;</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>));
<a name="l00735"></a>00735         *<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a> = <a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aa8ce26f0d9a701e8f80cbff3ed272d85">prev</a>;
<a name="l00736"></a>00736 <span class="preprocessor">#endif</span>
<a name="l00737"></a>00737 <span class="preprocessor"></span>    }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 <span class="preprocessor">#ifdef JSGC_TRACK_EXACT_ROOTS</span>
<a name="l00740"></a>00740 <span class="preprocessor"></span>    <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;T&gt;</a> *<a class="code" href="../../d3/db2/prmwait_8h.html#a6aed8eca8bc323929991ebdb1a48929e">previous</a>() { <span class="keywordflow">return</span> <a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aa8ce26f0d9a701e8f80cbff3ed272d85">prev</a>; }
<a name="l00741"></a>00741 <span class="preprocessor">#endif</span>
<a name="l00742"></a>00742 <span class="preprocessor"></span>
<a name="l00743"></a>00743     <span class="comment">/*</span>
<a name="l00744"></a>00744 <span class="comment">     * Important: Return a reference here so passing a Rooted&lt;T&gt; to</span>
<a name="l00745"></a>00745 <span class="comment">     * something that takes a |const T&amp;| is not a GC hazard.</span>
<a name="l00746"></a>00746 <span class="comment">     */</span>
<a name="l00747"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a62d0c8d42d4320847f2cf8cd77041ec8">00747</a>     operator const T&amp;()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00748"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a9df62bb58ed5803d6bdc48a0950e6069">00748</a>     T <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a9df62bb58ed5803d6bdc48a0950e6069">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00749"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a07c39990607b88255e0ffeaf6096800f">00749</a>     T *<a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a07c39990607b88255e0ffeaf6096800f">address</a>() { <span class="keywordflow">return</span> &amp;ptr; }
<a name="l00750"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#ab050a13488409d193bd148b3bd658bbb">00750</a>     <span class="keyword">const</span> T *<a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#ab050a13488409d193bd148b3bd658bbb">address</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> &amp;ptr; }
<a name="l00751"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#ad43312fe7e145ad45e4b445c04474aa5">00751</a>     T &amp;<span class="keyword">get</span>() { <span class="keywordflow">return</span> ptr; }
<a name="l00752"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a94f7ab23a01239824860e8a1f3f45aea">00752</a>     <span class="keyword">const</span> T &amp;<span class="keyword">get</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> ptr; }
<a name="l00753"></a>00753 
<a name="l00754"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a5d8569fbd1ac5a1c541a84d9d1b93c97">00754</a>     T &amp;<a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a5d8569fbd1ac5a1c541a84d9d1b93c97">operator=</a>(T <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>) {
<a name="l00755"></a>00755         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::poisoned</a>(value));
<a name="l00756"></a>00756         ptr = <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>;
<a name="l00757"></a>00757         <span class="keywordflow">return</span> ptr;
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759 
<a name="l00760"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a8a14640affd3eb45e92e92fdbb8a298e">00760</a>     T &amp;<a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a8a14640affd3eb45e92e92fdbb8a298e">operator=</a>(<span class="keyword">const</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a> &amp;<a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>) {
<a name="l00761"></a>00761         ptr = <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>;
<a name="l00762"></a>00762         <span class="keywordflow">return</span> ptr;
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#acb2f0de6e82c0ac2ca7f398656c6c286">00765</a>     <span class="keywordtype">void</span> <span class="keyword">set</span>(T <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>) {
<a name="l00766"></a>00766         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::poisoned</a>(<a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>));
<a name="l00767"></a>00767         ptr = <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>;
<a name="l00768"></a>00768     }
<a name="l00769"></a>00769 
<a name="l00770"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a2f9a9427b508e6edb2f8625e4247ebf8">00770</a>     <span class="keywordtype">bool</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a2f9a9427b508e6edb2f8625e4247ebf8">operator!=</a>(<span class="keyword">const</span> T &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr != other; }
<a name="l00771"></a><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#aeba7549f91dc44ee1e0237ad5b63da01">00771</a>     <span class="keywordtype">bool</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#aeba7549f91dc44ee1e0237ad5b63da01">operator==</a>(<span class="keyword">const</span> T &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr == other; }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   <span class="keyword">private</span>:
<a name="l00774"></a>00774 <span class="preprocessor">#ifdef JSGC_TRACK_EXACT_ROOTS</span>
<a name="l00775"></a>00775 <span class="preprocessor"></span>    <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;void*&gt;</a> **<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a>, *<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aa8ce26f0d9a701e8f80cbff3ed272d85">prev</a>;
<a name="l00776"></a>00776 <span class="preprocessor">#endif</span>
<a name="l00777"></a>00777 <span class="preprocessor"></span>
<a name="l00778"></a>00778 <span class="preprocessor">#if defined(DEBUG) &amp;&amp; defined(JS_GC_ZEAL) &amp;&amp; defined(JSGC_ROOT_ANALYSIS) &amp;&amp; !defined(JS_THREADSAFE)</span>
<a name="l00779"></a>00779 <span class="preprocessor"></span>    <span class="comment">/* Has the rooting analysis ever scanned this Rooted&#39;s stack location? */</span>
<a name="l00780"></a>00780     <span class="keyword">friend</span> <span class="keywordtype">void</span> JS::CheckStackRoots(<a class="code" href="../../d9/d28/jspubtd_8h.html#a1511e24a5b9d6d2e0e689afd9c6c0b9b">JSContext</a>*);
<a name="l00781"></a>00781 <span class="preprocessor">#endif</span>
<a name="l00782"></a>00782 <span class="preprocessor"></span>
<a name="l00783"></a>00783 <span class="preprocessor">#ifdef JSGC_ROOT_ANALYSIS</span>
<a name="l00784"></a>00784 <span class="preprocessor"></span>    <span class="keywordtype">bool</span> scanned;
<a name="l00785"></a>00785 <span class="preprocessor">#endif</span>
<a name="l00786"></a>00786 <span class="preprocessor"></span>
<a name="l00787"></a>00787     <span class="comment">/*</span>
<a name="l00788"></a>00788 <span class="comment">     * |ptr| must be the last field in Rooted because the analysis treats all</span>
<a name="l00789"></a>00789 <span class="comment">     * Rooted as Rooted&lt;void*&gt; during the analysis. See bug 829372.</span>
<a name="l00790"></a>00790 <span class="comment">     */</span>
<a name="l00791"></a>00791     T ptr;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793     MOZ_DECL_USE_GUARD_OBJECT_NOTIFIER
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>(<span class="keyword">const</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a> &amp;) MOZ_DELETE;
<a name="l00796"></a>00796 };
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 <span class="preprocessor">#if !(defined(JSGC_ROOT_ANALYSIS) || defined(JSGC_USE_EXACT_ROOTING))</span>
<a name="l00799"></a>00799 <span class="preprocessor"></span><span class="comment">// Defined in vm/String.h.</span>
<a name="l00800"></a>00800 <span class="keyword">template</span> &lt;&gt;
<a name="l00801"></a>00801 <span class="keyword">class </span><a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted</a>&lt;JSStableString *&gt;;
<a name="l00802"></a>00802 <span class="preprocessor">#endif</span>
<a name="l00803"></a>00803 <span class="preprocessor"></span>
<a name="l00804"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a6a45a0739e18bafc59298859fa4a64d1">00804</a> <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;JSObject*&gt;</a>                   <a class="code" href="../../da/d7b/namespace_j_s.html#a6a45a0739e18bafc59298859fa4a64d1">RootedObject</a>;
<a name="l00805"></a><a class="code" href="../../da/d7b/namespace_j_s.html#aff42a824e22e03069c09665652f804a4">00805</a> <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;js::Module*&gt;</a>                 <a class="code" href="../../da/d7b/namespace_j_s.html#aff42a824e22e03069c09665652f804a4">RootedModule</a>;
<a name="l00806"></a><a class="code" href="../../da/d7b/namespace_j_s.html#ab03f7ab0ed08c2b580bfacb90c90105e">00806</a> <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;js::ScriptSourceObject *&gt;</a>    <a class="code" href="../../da/d7b/namespace_j_s.html#ab03f7ab0ed08c2b580bfacb90c90105e">RootedScriptSource</a>;
<a name="l00807"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a0ab7c70d407c322b294d0080fbd51cd9">00807</a> <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;JSFunction*&gt;</a>                 <a class="code" href="../../da/d7b/namespace_j_s.html#a0ab7c70d407c322b294d0080fbd51cd9">RootedFunction</a>;
<a name="l00808"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a30d442a5fa60d2d79152196e9298a241">00808</a> <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;JSScript*&gt;</a>                   <a class="code" href="../../da/d7b/namespace_j_s.html#a30d442a5fa60d2d79152196e9298a241">RootedScript</a>;
<a name="l00809"></a><a class="code" href="../../da/d7b/namespace_j_s.html#aa7295fdbff4de497145340fa589f3e17">00809</a> <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;JSString*&gt;</a>                   <a class="code" href="../../da/d7b/namespace_j_s.html#aa7295fdbff4de497145340fa589f3e17">RootedString</a>;
<a name="l00810"></a><a class="code" href="../../da/d7b/namespace_j_s.html#abe742ab7a30a3a0023bb45623db6f03f">00810</a> <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;jsid&gt;</a>                        <a class="code" href="../../da/d7b/namespace_j_s.html#abe742ab7a30a3a0023bb45623db6f03f">RootedId</a>;
<a name="l00811"></a><a class="code" href="../../da/d7b/namespace_j_s.html#a96bbe99e8c2140627b20caca1178feb6">00811</a> <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;JS::Value&gt;</a>                   <a class="code" href="../../da/d7b/namespace_j_s.html#a96bbe99e8c2140627b20caca1178feb6">RootedValue</a>;
<a name="l00812"></a>00812 
<a name="l00813"></a>00813 } <span class="comment">/* namespace JS */</span>
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 <span class="keyword">namespace </span>js {
<a name="l00816"></a>00816 
<a name="l00817"></a>00817 <span class="comment">/*</span>
<a name="l00818"></a>00818 <span class="comment"> * Mark a stack location as a root for the rooting analysis, without actually</span>
<a name="l00819"></a>00819 <span class="comment"> * rooting it in release builds. This should only be used for stack locations</span>
<a name="l00820"></a>00820 <span class="comment"> * of GC things that cannot be relocated by a garbage collection, and that</span>
<a name="l00821"></a>00821 <span class="comment"> * are definitely reachable via another path.</span>
<a name="l00822"></a>00822 <span class="comment"> */</span>
<a name="l00823"></a><a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">00823</a> <span class="keyword">class </span><a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">SkipRoot</a>
<a name="l00824"></a>00824 {
<a name="l00825"></a>00825 <span class="preprocessor">#if defined(DEBUG) &amp;&amp; defined(JS_GC_ZEAL) &amp;&amp; defined(JSGC_ROOT_ANALYSIS) &amp;&amp; !defined(JS_THREADSAFE)</span>
<a name="l00826"></a>00826 <span class="preprocessor"></span>
<a name="l00827"></a>00827     <a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">SkipRoot</a> **<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a>, *<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aa8ce26f0d9a701e8f80cbff3ed272d85">prev</a>;
<a name="l00828"></a>00828     <span class="keyword">const</span> uint8_t *<a class="code" href="../../d7/dbf/build__stage_2email_2shared_2js_2media_2remote__controls_8js.html#afea9dd5375e7783397a6e3911cc64e28">start</a>;
<a name="l00829"></a>00829     <span class="keyword">const</span> uint8_t *<a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> CX, <span class="keyword">typename</span> T&gt;
<a name="l00832"></a>00832     <span class="keywordtype">void</span> <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(CX *cx, <span class="keyword">const</span> T *ptr, <span class="keywordtype">size_t</span> <a class="code" href="../../de/deb/jsdbgapi_8h.html#af811e5c0ef06b777b160f87806b7285e">count</a>) {
<a name="l00833"></a>00833         <a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">SkipRoot</a> **head = &amp;cx-&gt;skipGCRooters;
<a name="l00834"></a>00834         this-&gt;<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a> = head;
<a name="l00835"></a>00835         this-&gt;<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aa8ce26f0d9a701e8f80cbff3ed272d85">prev</a> = *<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a>;
<a name="l00836"></a>00836         *<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a> = <span class="keyword">this</span>;
<a name="l00837"></a>00837         this-&gt;<a class="code" href="../../d7/dbf/build__stage_2email_2shared_2js_2media_2remote__controls_8js.html#afea9dd5375e7783397a6e3911cc64e28">start</a> = (<span class="keyword">const</span> uint8_t *) ptr;
<a name="l00838"></a>00838         this-&gt;<a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a> = this-&gt;<a class="code" href="../../d7/dbf/build__stage_2email_2shared_2js_2media_2remote__controls_8js.html#afea9dd5375e7783397a6e3911cc64e28">start</a> + (<span class="keyword">sizeof</span>(T) * count);
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   <span class="keyword">public</span>:
<a name="l00842"></a>00842     ~<a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">SkipRoot</a>() {
<a name="l00843"></a>00843         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(*<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a> == <span class="keyword">this</span>);
<a name="l00844"></a>00844         *<a class="code" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">stack</a> = <a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aa8ce26f0d9a701e8f80cbff3ed272d85">prev</a>;
<a name="l00845"></a>00845     }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     <a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">SkipRoot</a> *<a class="code" href="../../d3/db2/prmwait_8h.html#a6aed8eca8bc323929991ebdb1a48929e">previous</a>() { <span class="keywordflow">return</span> <a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aa8ce26f0d9a701e8f80cbff3ed272d85">prev</a>; }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     <span class="keywordtype">bool</span> contains(<span class="keyword">const</span> uint8_t *<a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>, <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d04/expat_8h.html#a5df20ff5bc70fb664abe3912796e90df">len</a>) {
<a name="l00850"></a>00850         <span class="keywordflow">return</span> v &gt;= <a class="code" href="../../d7/dbf/build__stage_2email_2shared_2js_2media_2remote__controls_8js.html#afea9dd5375e7783397a6e3911cc64e28">start</a> &amp;&amp; v + len &lt;= <a class="code" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>;
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853 <span class="preprocessor">#else </span><span class="comment">/* DEBUG &amp;&amp; JSGC_ROOT_ANALYSIS */</span>
<a name="l00854"></a>00854 
<a name="l00855"></a>00855     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00856"></a>00856     <span class="keywordtype">void</span> <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(<a class="code" href="../../d1/d50/structjs_1_1_context_friend_fields.html">js::ContextFriendFields</a> *cx, <span class="keyword">const</span> T *ptr, <span class="keywordtype">size_t</span> count) {}
<a name="l00857"></a>00857 
<a name="l00858"></a>00858   <span class="keyword">public</span>:
<a name="l00859"></a>00859 
<a name="l00860"></a>00860 <span class="preprocessor">#endif </span><span class="comment">/* DEBUG &amp;&amp; JSGC_ROOT_ANALYSIS */</span>
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00863"></a><a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html#ab5ded05375749b70043c3f94698cb652">00863</a>     <a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">SkipRoot</a>(<a class="code" href="../../d9/d28/jspubtd_8h.html#a1511e24a5b9d6d2e0e689afd9c6c0b9b">JSContext</a> *cx, <span class="keyword">const</span> T *ptr, <span class="keywordtype">size_t</span> count = 1
<a name="l00864"></a>00864              MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00865"></a>00865     {
<a name="l00866"></a>00866         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">ContextFriendFields::get</a>(cx), ptr, count);
<a name="l00867"></a>00867         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00871"></a><a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html#a6644e7d646c886a0748736e14f7c8820">00871</a>     <a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">SkipRoot</a>(<a class="code" href="../../d1/d50/structjs_1_1_context_friend_fields.html">ContextFriendFields</a> *cx, <span class="keyword">const</span> T *ptr, <span class="keywordtype">size_t</span> count = 1
<a name="l00872"></a>00872              MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00873"></a>00873     {
<a name="l00874"></a>00874         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(cx, ptr, count);
<a name="l00875"></a>00875         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00879"></a><a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html#a093a9c2657f7f5faea0c3786b4fc4e99">00879</a>     <a class="code" href="../../d7/dc6/classjs_1_1_skip_root.html">SkipRoot</a>(PerThreadData *pt, <span class="keyword">const</span> T *ptr, <span class="keywordtype">size_t</span> count = 1
<a name="l00880"></a>00880              MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00881"></a>00881     {
<a name="l00882"></a>00882         <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>(<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">PerThreadDataFriendFields::get</a>(pt), ptr, count);
<a name="l00883"></a>00883         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     MOZ_DECL_USE_GUARD_OBJECT_NOTIFIER
<a name="l00887"></a>00887 };
<a name="l00888"></a>00888 
<a name="l00889"></a>00889 <span class="comment">/* Interface substitute for Rooted&lt;T&gt; which does not root the variable&#39;s memory. */</span>
<a name="l00890"></a>00890 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00891"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html">00891</a> <span class="keyword">class </span><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html">FakeRooted</a> : <span class="keyword">public</span> <a class="code" href="../../d3/d20/classjs_1_1_rooted_base.html">RootedBase</a>&lt;T&gt;
<a name="l00892"></a>00892 {
<a name="l00893"></a>00893   <span class="keyword">public</span>:
<a name="l00894"></a>00894     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> CX&gt;
<a name="l00895"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a4f407537c1e6757fa3bbf743e016949a">00895</a>     <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html">FakeRooted</a>(CX *cx
<a name="l00896"></a>00896                MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00897"></a>00897       : ptr(<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">GCMethods</a>&lt;T&gt;::initial())
<a name="l00898"></a>00898     {
<a name="l00899"></a>00899         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901 
<a name="l00902"></a>00902     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> CX&gt;
<a name="l00903"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a85a43ceb8ad9cfadf90250eaa9cb05e4">00903</a>     <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html">FakeRooted</a>(CX *cx, T initial
<a name="l00904"></a>00904                MOZ_GUARD_OBJECT_NOTIFIER_PARAM)
<a name="l00905"></a>00905       : ptr(initial)
<a name="l00906"></a>00906     {
<a name="l00907"></a>00907         MOZ_GUARD_OBJECT_NOTIFIER_INIT;
<a name="l00908"></a>00908     }
<a name="l00909"></a>00909 
<a name="l00910"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#aeff8ea596057e0664c1e617328477c1e">00910</a>     <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#aeff8ea596057e0664c1e617328477c1e">operator T</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00911"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#aff3d72eb1bf8849b166996f880f9a7da">00911</a>     T <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#aff3d72eb1bf8849b166996f880f9a7da">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00912"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a59fadc4ae554f6c45352eb5cc8414f69">00912</a>     T *<a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a59fadc4ae554f6c45352eb5cc8414f69">address</a>() { <span class="keywordflow">return</span> &amp;ptr; }
<a name="l00913"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a0dfc267663d3f4dfbd1d14be1e2b7313">00913</a>     <span class="keyword">const</span> T *<a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a0dfc267663d3f4dfbd1d14be1e2b7313">address</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> &amp;ptr; }
<a name="l00914"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a7b2239f01b5ea3b7e7d78f2f586a59c8">00914</a>     T &amp;<span class="keyword">get</span>() { <span class="keywordflow">return</span> ptr; }
<a name="l00915"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a79413a8a20cc493af17924ba6ebe9947">00915</a>     <span class="keyword">const</span> T &amp;<span class="keyword">get</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> ptr; }
<a name="l00916"></a>00916 
<a name="l00917"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a8860fe4dd5253af005a45d0d52669978">00917</a>     T &amp;<a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a8860fe4dd5253af005a45d0d52669978">operator=</a>(T <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>) {
<a name="l00918"></a>00918         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">GCMethods&lt;T&gt;::poisoned</a>(value));
<a name="l00919"></a>00919         ptr = <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>;
<a name="l00920"></a>00920         <span class="keywordflow">return</span> ptr;
<a name="l00921"></a>00921     }
<a name="l00922"></a>00922 
<a name="l00923"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#ac130a1661494fc296dec31790878a9e0">00923</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#ac130a1661494fc296dec31790878a9e0">operator!=</a>(<span class="keyword">const</span> T &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr != other; }
<a name="l00924"></a><a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a374beea151f2885ed426e3b2f44b7bd4">00924</a>     <span class="keywordtype">bool</span> <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a374beea151f2885ed426e3b2f44b7bd4">operator==</a>(<span class="keyword">const</span> T &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr == other; }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926   <span class="keyword">private</span>:
<a name="l00927"></a>00927     T ptr;
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     MOZ_DECL_USE_GUARD_OBJECT_NOTIFIER
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html">FakeRooted</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html">FakeRooted</a> &amp;) MOZ_DELETE;
<a name="l00932"></a>00932 };
<a name="l00933"></a>00933 
<a name="l00934"></a>00934 <span class="comment">/* Interface substitute for MutableHandle&lt;T&gt; which is not required to point to rooted memory. */</span>
<a name="l00935"></a>00935 template &lt;typename T&gt;
<a name="l00936"></a><a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html">00936</a> class <a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html">FakeMutableHandle</a> : public js::<a class="code" href="../../da/d61/classjs_1_1_mutable_handle_base.html">MutableHandleBase</a>&lt;T&gt;
<a name="l00937"></a>00937 {
<a name="l00938"></a>00938   <span class="keyword">public</span>:
<a name="l00939"></a><a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#a94c68c5cee725412a41a92e71e95559d">00939</a>     <a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#a94c68c5cee725412a41a92e71e95559d">FakeMutableHandle</a>(T *t) {
<a name="l00940"></a>00940         ptr = t;
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942 
<a name="l00943"></a><a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#ae6b200823402d644944c5c7a01bedde9">00943</a>     <a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#ae6b200823402d644944c5c7a01bedde9">FakeMutableHandle</a>(<a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html">FakeRooted&lt;T&gt;</a> *<a class="code" href="../../d1/df9/apps_2email_2js_2ext_2mailapi_2activesync_2configurator_8js.html#a11a10a6834f3c54a5380f4ff04d002a9">root</a>) {
<a name="l00944"></a>00944         ptr = root-&gt;<a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html#a59fadc4ae554f6c45352eb5cc8414f69">address</a>();
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946 
<a name="l00947"></a><a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#a7c89c45ee64434b10602641d0882c410">00947</a>     <span class="keywordtype">void</span> <span class="keyword">set</span>(T <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) {
<a name="l00948"></a>00948         <a class="code" href="../../db/d2a/_utility_8h.html#a806452d73a088062220b0f84b77587fa">JS_ASSERT</a>(!<a class="code" href="../../d2/d74/structjs_1_1_g_c_methods.html">js::GCMethods&lt;T&gt;::poisoned</a>(<a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>));
<a name="l00949"></a>00949         *ptr = <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>;
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951 
<a name="l00952"></a><a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#ab9c502755803c10f2372a7fa57e70523">00952</a>     T *<a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#ab9c502755803c10f2372a7fa57e70523">address</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ptr; }
<a name="l00953"></a><a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#ac495f20f1113fb119f039e64e1247aaa">00953</a>     T <span class="keyword">get</span>() <span class="keyword">const</span> { <span class="keywordflow">return</span> *ptr; }
<a name="l00954"></a>00954 
<a name="l00955"></a><a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#a22cd5d3dc391504fe65b74e06576b9ad">00955</a>     <a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#a22cd5d3dc391504fe65b74e06576b9ad">operator T</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">get</span>(); }
<a name="l00956"></a><a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#a54db72c52ce93b83e81b053bb1edc3b7">00956</a>     T <a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html#a54db72c52ce93b83e81b053bb1edc3b7">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">get</span>(); }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958   <span class="keyword">private</span>:
<a name="l00959"></a>00959     <a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html">FakeMutableHandle</a>() {}
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     T *ptr;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> S&gt;
<a name="l00964"></a>00964     <span class="keywordtype">void</span> operator=(S <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) MOZ_DELETE;
<a name="l00965"></a>00965 };
<a name="l00966"></a>00966 
<a name="l00967"></a>00967 <span class="comment">/*</span>
<a name="l00968"></a>00968 <span class="comment"> * Types for a variable that either should or shouldn&#39;t be rooted, depending on</span>
<a name="l00969"></a>00969 <span class="comment"> * the template parameter Rooted. Used for implementing functions that can</span>
<a name="l00970"></a>00970 <span class="comment"> * operate on either rooted or unrooted data.</span>
<a name="l00971"></a>00971 <span class="comment"> *</span>
<a name="l00972"></a>00972 <span class="comment"> * The toHandle() and toMutableHandle() functions are for calling functions</span>
<a name="l00973"></a>00973 <span class="comment"> * which require handle types and are only called in the CanGC case. These</span>
<a name="l00974"></a>00974 <span class="comment"> * allow the calling code to type check.</span>
<a name="l00975"></a>00975 <span class="comment"> */</span>
<a name="l00976"></a><a class="code" href="../../db/da2/namespacejs.html#acac2f506be7f64e4f3795618ca10a5dd">00976</a> <span class="keyword">enum</span> <a class="code" href="../../db/da2/namespacejs.html#acac2f506be7f64e4f3795618ca10a5dd">AllowGC</a> {
<a name="l00977"></a><a class="code" href="../../db/da2/namespacejs.html#acac2f506be7f64e4f3795618ca10a5dda093973b1c5c5222d96dd78f7b4047dbd">00977</a>     <a class="code" href="../../db/da2/namespacejs.html#acac2f506be7f64e4f3795618ca10a5dda093973b1c5c5222d96dd78f7b4047dbd">NoGC</a> = 0,
<a name="l00978"></a><a class="code" href="../../db/da2/namespacejs.html#acac2f506be7f64e4f3795618ca10a5dda02d113b9e8e37960403b9c490594352f">00978</a>     <a class="code" href="../../db/da2/namespacejs.html#acac2f506be7f64e4f3795618ca10a5dda02d113b9e8e37960403b9c490594352f">CanGC</a> = 1
<a name="l00979"></a>00979 };
<a name="l00980"></a>00980 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, AllowGC allowGC&gt;
<a name="l00981"></a><a class="code" href="../../de/df2/classjs_1_1_maybe_rooted.html">00981</a> <span class="keyword">class </span><a class="code" href="../../de/df2/classjs_1_1_maybe_rooted.html">MaybeRooted</a>
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983 };
<a name="l00984"></a>00984 
<a name="l00985"></a><a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html">00985</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="../../de/df2/classjs_1_1_maybe_rooted.html">MaybeRooted</a>&lt;T, <a class="code" href="../../db/da2/namespacejs.html#acac2f506be7f64e4f3795618ca10a5dda02d113b9e8e37960403b9c490594352f">CanGC</a>&gt;
<a name="l00986"></a>00986 {
<a name="l00987"></a>00987   <span class="keyword">public</span>:
<a name="l00988"></a><a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#a4f5ecea0450340be4fd54b24170816ca">00988</a>     <span class="keyword">typedef</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">JS::Handle&lt;T&gt;</a> <a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#a4f5ecea0450340be4fd54b24170816ca">HandleType</a>;
<a name="l00989"></a><a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#a9fde09ddf15ece8a78b71f45af7bb93c">00989</a>     <span class="keyword">typedef</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">JS::Rooted&lt;T&gt;</a> <a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#a9fde09ddf15ece8a78b71f45af7bb93c">RootType</a>;
<a name="l00990"></a><a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#af15added277d1ab9a6144e29db31dee4">00990</a>     <span class="keyword">typedef</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">JS::MutableHandle&lt;T&gt;</a> <a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#af15added277d1ab9a6144e29db31dee4">MutableHandleType</a>;
<a name="l00991"></a>00991 
<a name="l00992"></a><a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#a9f4b6178aa7106eb8242eed58ec5225a">00992</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">JS::Handle&lt;T&gt;</a> <a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#a9f4b6178aa7106eb8242eed58ec5225a">toHandle</a>(<a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">HandleType</a> <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) {
<a name="l00993"></a>00993         <span class="keywordflow">return</span> <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>;
<a name="l00994"></a>00994     }
<a name="l00995"></a>00995 
<a name="l00996"></a><a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#a9ded6ab5ee6034d0295c0629dbc8994d">00996</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">JS::MutableHandle&lt;T&gt;</a> <a class="code" href="../../d8/d4d/classjs_1_1_maybe_rooted_3_01_t_00_01_can_g_c_01_4.html#a9ded6ab5ee6034d0295c0629dbc8994d">toMutableHandle</a>(<a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandleType</a> <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) {
<a name="l00997"></a>00997         <span class="keywordflow">return</span> <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>;
<a name="l00998"></a>00998     }
<a name="l00999"></a>00999 };
<a name="l01000"></a>01000 
<a name="l01001"></a><a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html">01001</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="../../de/df2/classjs_1_1_maybe_rooted.html">MaybeRooted</a>&lt;T, <a class="code" href="../../db/da2/namespacejs.html#acac2f506be7f64e4f3795618ca10a5dda093973b1c5c5222d96dd78f7b4047dbd">NoGC</a>&gt;
<a name="l01002"></a>01002 {
<a name="l01003"></a>01003   <span class="keyword">public</span>:
<a name="l01004"></a><a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a16241ea6edc3f8d71906bee8c59c5b2b">01004</a>     <span class="keyword">typedef</span> T <a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a16241ea6edc3f8d71906bee8c59c5b2b">HandleType</a>;
<a name="l01005"></a><a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a770579c637cf30c13d84d74ecfb804cc">01005</a>     <span class="keyword">typedef</span> <a class="code" href="../../dd/d95/classjs_1_1_fake_rooted.html">FakeRooted&lt;T&gt;</a> <a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a770579c637cf30c13d84d74ecfb804cc">RootType</a>;
<a name="l01006"></a><a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#ae62df52723c295882157a597444148ff">01006</a>     <span class="keyword">typedef</span> <a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html">FakeMutableHandle&lt;T&gt;</a> <a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#ae62df52723c295882157a597444148ff">MutableHandleType</a>;
<a name="l01007"></a>01007 
<a name="l01008"></a><a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a733d9e47d4b608b858135a67b1be58fb">01008</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">JS::Handle&lt;T&gt;</a> <a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a733d9e47d4b608b858135a67b1be58fb">toHandle</a>(<a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a16241ea6edc3f8d71906bee8c59c5b2b">HandleType</a> <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) {
<a name="l01009"></a>01009         <a class="code" href="../../d9/de9/_assertions_8h.html#a1aeff0372ebb7f3116748a2956a86236">MOZ_ASSUME_UNREACHABLE</a>(<span class="stringliteral">&quot;Bad conversion&quot;</span>);
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011 
<a name="l01012"></a><a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a9ea9ac7393485a18f0b6bf92bc478860">01012</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">JS::MutableHandle&lt;T&gt;</a> <a class="code" href="../../d1/ded/classjs_1_1_maybe_rooted_3_01_t_00_01_no_g_c_01_4.html#a9ea9ac7393485a18f0b6bf92bc478860">toMutableHandle</a>(<a class="code" href="../../d1/d0f/classjs_1_1_fake_mutable_handle.html">MutableHandleType</a> <a class="code" href="../../db/db1/namespace_j_s_1_1detail.html#a5d38b5ed0e5a6c44c34f95302820c4d7">v</a>) {
<a name="l01013"></a>01013         <a class="code" href="../../d9/de9/_assertions_8h.html#a1aeff0372ebb7f3116748a2956a86236">MOZ_ASSUME_UNREACHABLE</a>(<span class="stringliteral">&quot;Bad conversion&quot;</span>);
<a name="l01014"></a>01014     }
<a name="l01015"></a>01015 };
<a name="l01016"></a>01016 
<a name="l01017"></a>01017 } <span class="comment">/* namespace js */</span>
<a name="l01018"></a>01018 
<a name="l01019"></a>01019 <span class="keyword">namespace </span>JS {
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">template</span> &lt;<span class="keyword">typename</span> S&gt;
<a name="l01022"></a>01022 <span class="keyword">inline</span>
<a name="l01023"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#ae0315c2172bee9db226001161cd7abca">01023</a> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;T&gt;::Handle</a>(<span class="keyword">const</span> <a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;S&gt;</a> &amp;<a class="code" href="../../d1/df9/apps_2email_2js_2ext_2mailapi_2activesync_2configurator_8js.html#a11a10a6834f3c54a5380f4ff04d002a9">root</a>,
<a name="l01024"></a>01024                   <span class="keyword">typename</span> <a class="code" href="../../d2/d8e/structmozilla_1_1_enable_if.html">mozilla::EnableIf</a>&lt;<a class="code" href="../../db/db5/structmozilla_1_1_is_convertible.html">mozilla::IsConvertible&lt;S, T&gt;::value</a>, <span class="keywordtype">int</span>&gt;::<a class="code" href="../../d3/d0f/ns_display_item_types_8h.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a> dummy)
<a name="l01025"></a>01025 {
<a name="l01026"></a>01026     ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>T *<span class="keyword">&gt;</span>(root.<a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a07c39990607b88255e0ffeaf6096800f">address</a>());
<a name="l01027"></a>01027 }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">template</span> &lt;<span class="keyword">typename</span> S&gt;
<a name="l01030"></a>01030 <span class="keyword">inline</span>
<a name="l01031"></a><a class="code" href="../../df/dfb/class_j_s_1_1_handle.html#aa3e6ab4780648c9b13517e33e0a8aa56">01031</a> <a class="code" href="../../df/dfb/class_j_s_1_1_handle.html">Handle&lt;T&gt;::Handle</a>(<a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;S&gt;</a> &amp;<a class="code" href="../../d1/df9/apps_2email_2js_2ext_2mailapi_2activesync_2configurator_8js.html#a11a10a6834f3c54a5380f4ff04d002a9">root</a>,
<a name="l01032"></a>01032                   <span class="keyword">typename</span> <a class="code" href="../../d2/d8e/structmozilla_1_1_enable_if.html">mozilla::EnableIf</a>&lt;<a class="code" href="../../db/db5/structmozilla_1_1_is_convertible.html">mozilla::IsConvertible&lt;S, T&gt;::value</a>, <span class="keywordtype">int</span>&gt;::<a class="code" href="../../d3/d0f/ns_display_item_types_8h.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a> dummy)
<a name="l01033"></a>01033 {
<a name="l01034"></a>01034     ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>T *<span class="keyword">&gt;</span>(root.<a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a29f3c5d66a464e63edf39d6a33cf1485">address</a>());
<a name="l01035"></a>01035 }
<a name="l01036"></a>01036 
<a name="l01037"></a>01037 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l01038"></a>01038 <span class="keyword">inline</span>
<a name="l01039"></a><a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html#a50a9efba22521aab3a3a7621e6a0d311">01039</a> <a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;T&gt;::MutableHandle</a>(<a class="code" href="../../db/d76/class_j_s_1_1_rooted.html">Rooted&lt;T&gt;</a> *<a class="code" href="../../d1/df9/apps_2email_2js_2ext_2mailapi_2activesync_2configurator_8js.html#a11a10a6834f3c54a5380f4ff04d002a9">root</a>)
<a name="l01040"></a>01040 {
<a name="l01041"></a>01041     <a class="code" href="../../d3/d68/_value_8h.html#a3b52e66790b3e7fa53b9794163d633e5">static_assert</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d2f/class_j_s_1_1_mutable_handle.html">MutableHandle&lt;T&gt;</a>) == <span class="keyword">sizeof</span>(T *),
<a name="l01042"></a>01042                   <span class="stringliteral">&quot;MutableHandle must be binary compatible with T*.&quot;</span>);
<a name="l01043"></a>01043     ptr = root-&gt;<a class="code" href="../../db/d76/class_j_s_1_1_rooted.html#a07c39990607b88255e0ffeaf6096800f">address</a>();
<a name="l01044"></a>01044 }
<a name="l01045"></a>01045 
<a name="l01046"></a>01046 } <span class="comment">/* namespace JS */</span>
<a name="l01047"></a>01047 
<a name="l01048"></a>01048 <span class="keyword">namespace </span>js {
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 <span class="comment">/*</span>
<a name="l01051"></a>01051 <span class="comment"> * Hook for dynamic root analysis. Checks the native stack and poisons</span>
<a name="l01052"></a>01052 <span class="comment"> * references to GC things which have not been rooted.</span>
<a name="l01053"></a>01053 <span class="comment"> */</span>
<a name="l01054"></a><a class="code" href="../../db/da2/namespacejs.html#a23de41d54d4387f2c6532121efcad16d">01054</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../db/da2/namespacejs.html#a23de41d54d4387f2c6532121efcad16d">MaybeCheckStackRoots</a>(<a class="code" href="../../d9/d28/jspubtd_8h.html#a1511e24a5b9d6d2e0e689afd9c6c0b9b">JSContext</a> *cx)
<a name="l01055"></a>01055 {
<a name="l01056"></a>01056 <span class="preprocessor">#if defined(DEBUG) &amp;&amp; defined(JS_GC_ZEAL) &amp;&amp; defined(JSGC_ROOT_ANALYSIS) &amp;&amp; !defined(JS_THREADSAFE)</span>
<a name="l01057"></a>01057 <span class="preprocessor"></span>    JS::CheckStackRoots(cx);
<a name="l01058"></a>01058 <span class="preprocessor">#endif</span>
<a name="l01059"></a>01059 <span class="preprocessor"></span>}
<a name="l01060"></a>01060 
<a name="l01061"></a>01061 <span class="comment">/* Base class for automatic read-only object rooting during compilation. */</span>
<a name="l01062"></a><a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html">01062</a> <span class="keyword">class </span><a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html">CompilerRootNode</a>
<a name="l01063"></a>01063 {
<a name="l01064"></a>01064   <span class="keyword">protected</span>:
<a name="l01065"></a><a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html#afc83195b7840e043812aacb5b405d82a">01065</a>     <a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html#afc83195b7840e043812aacb5b405d82a">CompilerRootNode</a>(js::gc::Cell *ptr) : next(<a class="code" href="../../db/df5/ncompat_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), ptr_(ptr) {}
<a name="l01066"></a>01066 
<a name="l01067"></a>01067   <span class="keyword">public</span>:
<a name="l01068"></a><a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html#a92ebc94f943e7346572f473b92ed6e0b">01068</a>     <span class="keywordtype">void</span> **<a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html#a92ebc94f943e7346572f473b92ed6e0b">address</a>() { <span class="keywordflow">return</span> (<span class="keywordtype">void</span> **)&amp;ptr_; }
<a name="l01069"></a>01069 
<a name="l01070"></a>01070   <span class="keyword">public</span>:
<a name="l01071"></a><a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html#a29742d32841e42fb2096def1d75f7e9f">01071</a>     <a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html">CompilerRootNode</a> *<a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html#a29742d32841e42fb2096def1d75f7e9f">next</a>;
<a name="l01072"></a>01072 
<a name="l01073"></a>01073   <span class="keyword">protected</span>:
<a name="l01074"></a><a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html#af85823addbfd91bcfd2fd6977f434053">01074</a>     js::gc::Cell *<a class="code" href="../../d4/d34/classjs_1_1_compiler_root_node.html#af85823addbfd91bcfd2fd6977f434053">ptr_</a>;
<a name="l01075"></a>01075 };
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 }  <span class="comment">/* namespace js */</span>
<a name="l01078"></a>01078 
<a name="l01079"></a>01079 <span class="preprocessor">#endif  </span><span class="comment">/* js_RootingAPI_h */</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d6/d11/_rooting_a_p_i_8h.html">RootingAPI.h</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:05に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
