<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: account_test.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d6/d4d/store_2account__test_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a>  </div>
  <div class="headertitle">
<div class="title">account_test.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../d6/d4d/store_2account__test_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d4d/store_2account__test_8js.html#af9bb97dbe03dda4851bf224837e120fe">requireLib</a> ('db.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d4d/store_2account__test_8js.html#ac491a89a893a3904b6111b079a42635e">suite</a> ('store/account', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>;var <a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>;var <a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../df/d6d/prpdce_8h.html#a244bf4809fa769d3064852f1f46df24f">this.timeout</a>(5000);<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>=<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">testSupport.calendar.app</a>();<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>=<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">app.db</a>;<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>=db.getStore('Account');<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">db.open</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!err);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){testSupport.calendar.clearStore(<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">subject.db</a>,['accounts', 'calendars'], <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">db.close</a>();});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('initialization', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.instanceOf(<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>, Calendar.Store.Abstract);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">subject.db</a>, <a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>);assert.deepEqual(subject._cached,{});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#markWithError', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var errEvent;var accounts=testSupport.calendar.dbFixtures( 'account', 'Account',{one:{_id:55, providerType: 'Mock'}});var calendars=testSupport.calendar.dbFixtures( 'calendar', '<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>',{one:{_id: 'one', accountId:55}, two:{_id: 'two', accountId:55}});var <a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>=accounts.one;});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('marking <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>=new Calendar.Error.Authentication();subject.markWithError(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> markedWithError(expectedCount){expectedCount=expectedCount||1;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('after erorr <a class="el" href="../../dd/dc2/plarenas_8h.html#af34a496b61ba99953cf618a41fc44b0b">mark</a>#'+expectedCount, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">subject.get</a>(model._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(getErr, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!getErr, 'is successful');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d8f/jsdebug_8h.html#af0b029640ba74e8a63ae0af6f51680ca">result.error.count</a>, expectedCount, 'has <a class="el" href="../../de/d8f/jsdebug_8h.html#af0b029640ba74e8a63ae0af6f51680ca">count</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">result.error.name</a>, <a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">error.name</a>, '<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a> is marked with <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>');assert.instanceOf(<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">result.error.date</a>, Date, 'has <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a> of occurrence');});});});}markedWithError(1);<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('second <a class="el" href="../../dd/dc2/plarenas_8h.html#af34a496b61ba99953cf618a41fc44b0b">mark</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.markWithError(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});markedWithError(2);});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('dependant calendars', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var err;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){err=new Calendar.Error.Authentication();subject.markWithError(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, err, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> verifyCalendar(<a class="el" href="../../d2/d7d/jsapi_8h.html#a02d8cbd1392e102198d5bb521715f608">key</a>){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('ensure calendar is marked: '+<a class="el" href="../../d2/d7d/jsapi_8h.html#a02d8cbd1392e102198d5bb521715f608">key</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){app.store('<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>').<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#a02d8cbd1392e102198d5bb521715f608">key</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(getErr, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, 'has calendar');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">result.error</a>, 'sets <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">result.error.name</a>, <a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">err.name</a>, 'sets <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>');});});});}verifyCalendar('one');verifyCalendar('two');});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#availablePresets', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var presetAccount;var presets={ 'multiUse':{}, 'singleUse':{singleUse:true}};<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('without single <a class="el" href="../../d7/d1b/test-agent-server_8js.html#aab71dcc804ca4aa3ed2bf7ba887635db">use</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.availablePresets({ 'foo':{}}, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, available){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(err){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(available,['foo']);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('when single <a class="el" href="../../d7/d1b/test-agent-server_8js.html#aab71dcc804ca4aa3ed2bf7ba887635db">use</a> is available', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.availablePresets(presets, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, available){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(err){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(err);}<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(available,['multiUse', 'singleUse']);});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('when single <a class="el" href="../../d7/d1b/test-agent-server_8js.html#aab71dcc804ca4aa3ed2bf7ba887635db">use</a> is used', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){presetAccount=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('account',{preset: 'singleUse'});subject.persist(presetAccount, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('exclusion of single <a class="el" href="../../d7/d1b/test-agent-server_8js.html#aab71dcc804ca4aa3ed2bf7ba887635db">use</a> preset', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.availablePresets(presets, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, available){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(err){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(err);}<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(available,['multiUse']);});});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#verifyAndPersist', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>;var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>;var <a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>;var calledWith;var modelParams;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>={};modelParams=<a class="el" href="../../d2/de4/pdf_8js.html#a60466015cef6827275ce6b41f91e63a2">Factory.build</a>('account',{providerType: 'Caldav'});<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>=new Calendar.Models.Account(modelParams);app._providers['Caldav']={getAccount:function(details, <a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>){calledWith=details;<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#adf7ce41cd256eda7ce1f6adeea723bd3">setTimeout</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>(<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>);}, 0);}};});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('duplicate account failure', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var existingAccount;var existingParams={providerType: 'Caldav', user: 'foobar', fullUrl: 'http:};<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> sendsDuplicateError(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, 'is not persisted');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(err, 'sends <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a> <a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">on</a> duplicate account');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">err.name</a>, 'account-exist');});};}<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){existingAccount=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('account', existingParams);subject.persist(existingAccount, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('initial <a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a> is duplicate', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var account=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('account', existingParams);subject.verifyAndPersist(account, sendsDuplicateError(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a> is updated <a class="el" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> be duplicate', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var account=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('account', existingParams);<a class="el" href="../../de/d8f/jsdebug_8h.html#ad8babe1ecde8f9f6d224a06ea1a99480">account.user</a>= '';<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>={<a class="el" href="../../de/d8f/jsdebug_8h.html#ad8babe1ecde8f9f6d224a06ea1a99480">user:existingParams.user</a>};subject.verifyAndPersist(account, sendsDuplicateError(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>));});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('existing account', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">model.error</a>={};subject.persist(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('should be able <a class="el" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> <a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>={};model.password= 'new';subject.verifyAndPersist(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(err){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(err);}<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">subject.get</a>(model._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(getErr, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(getErr){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(err);}<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(result.password, 'new', 'updates pass');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">result.error</a>, 'clears errors');});});});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('when verify fails', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>=new <a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Error</a>('bad stuff');subject.verifyAndPersist(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(err, <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>);assert.deepEqual(calledWith, model.toJSON());});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('persist+<a class="el" href="../../de/d8f/jsdebug_8h.html#a39bb9861b2cb39f94badb5db778de746">url</a> <a class="el" href="../../d9/dd6/_r_e_a_d_m_e_8md.html#ac1934db4e0289fcc2a08b0c7de017cf2">change</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('caldav.account');subject.verifyAndPersist(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.instanceOf(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>, Calendar.Models.Account);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(data.domain, result.domain);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(data.entrypoint, result.entrypoint);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(data.calendarHome, result.calendarHome);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('persist+oauth <a class="el" href="../../d9/dd6/_r_e_a_d_m_e_8md.html#ac1934db4e0289fcc2a08b0c7de017cf2">change</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){model.oauth={code: 'xxx'};<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('caldav.account',{oauth:{refresh_token: 'xxx'}});subject.verifyAndPersist(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(data.oauth, result.oauth);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('persist no <a class="el" href="../../d9/dd6/_r_e_a_d_m_e_8md.html#ac1934db4e0289fcc2a08b0c7de017cf2">change</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>={};subject.verifyAndPersist(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.instanceOf(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>, Calendar.Models.Account);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(data.domain, modelParams.domain);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(data.calendarHome, modelParams.calendarHome);});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var calStore;var <a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>;var calendars;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calendars={};calStore=subject.db.getStore('<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>');<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>=subject._createModel({providerType: 'Local'});subject.persist(<a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(model._id);calendars[1]=new <a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar.Models.Calendar</a>({accountId:model._id, remote:{id:777}});calStore.persist(calendars[1], <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calendars[2]=new <a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar.Models.Calendar</a>({accountId: 'some-other', remote:{id:666}});calStore.persist(calendars[2], <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('removal', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>=model._id;<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">subject.remove</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('removes account', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">subject.get</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, 'removes account');});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('removes associated calendars', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calStore.all(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, calendars){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(calendars.accountId!=<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, 'removes calendars');});});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#_createModel', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('with <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=subject._createModel({providerType: 'Local'}, '<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(result.providerType, 'Local');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(result._id, '<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>');assert.instanceOf(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, Calendar.Models.Account);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('without <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=subject._createModel({providerType: 'Local'});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(result.providerType, 'Local');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#a8e4d922ae3532f8bdfcadccef0881707">assert.isFalse</a>(('_id'in <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>));});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#sync:add, <a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a>, <a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var remote;var events;var account;var <a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>;var calendarStore;var cals;var remoteCalledWith;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> watchEvent(eventName){<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">calendarStore.on</a>(eventName, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!(eventName in events)){events[eventName]=[];}events[eventName].<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">push</a>(arguments);});}<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calendarStore=subject.db.getStore('<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>');account=<a class="el" href="../../d1/dce/utils_81_83_8js.html#ab92647390e7481607cad94f9c4cf38f0">Factory.create</a>('account',{_id:1, providerType: 'Mock'});cals={};<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">cals.add</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('calendar',{accountId:account._id, remote:{name: '<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">add</a>'}});<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">cals.remove</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('calendar',{accountId:account._id, remote:{name: '<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a>'}});<a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">cals.update</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('calendar',{accountId:account._id, remote:{name: '<a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a>'}, error:{}});});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calendarStore.persist(<a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">cals.update</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calendarStore.persist(<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">cals.remove</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calendarStore._remoteByAccount=<a class="el" href="../../d1/dce/utils_81_83_8js.html#ab92647390e7481607cad94f9c4cf38f0">Object.create</a>(<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>);calendarStore._cached=<a class="el" href="../../d1/dce/utils_81_83_8js.html#ab92647390e7481607cad94f9c4cf38f0">Object.create</a>(<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>);calendarStore.all(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){events={};remoteCalledWith=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;watchEvent('<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">add</a>');watchEvent('<a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a>');watchEvent('<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a>');remote={};remote[<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">cals.update.remote.id</a>]={<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id:cals.update.remote.id</a>, name: 'update!', description: 'new <a class="el" href="../../d3/db2/prmwait_8h.html#a5e84b7cc06d3eb73dd860fa1d85dedd6">desc</a>'};remote[<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">cals.add.remote.id</a>]={<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id:cals.add.remote.id</a>, name: 'new item'};app.provider('Mock').stageFindCalendars(<a class="el" href="../../de/d8f/jsdebug_8h.html#ad8babe1ecde8f9f6d224a06ea1a99480">account.user</a>, <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>, remote);<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">subject.sync</a>(account, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(err){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(err);}<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});var syncResults;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calendarStore.remotesByAccount(account._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){syncResults=<a class="el" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>;});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('after <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(Object.keys(syncResults).<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">length</a>, 2, 'should only have two records');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">events.remove</a>[0][0]);var updateObj=<a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">events.update</a>[0][1].remote;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">updateObj.id</a>, <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">cals.update.remote.id</a>);var addObj=<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">events.add</a>[0][1].remote;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">addObj.id</a>, <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">cals.add.remote.id</a>);var remoteUpdate=syncResults[<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">cals.update.remote.id</a>];var remoteAdd=syncResults[<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">cals.add.remote.id</a>];assert.instanceOf(remoteUpdate, <a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar.Models.Calendar</a>, 'should <a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a> <a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a>');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">remoteUpdate.error</a>, 'removes <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(remoteUpdate.remote.description, 'new <a class="el" href="../../d3/db2/prmwait_8h.html#a5e84b7cc06d3eb73dd860fa1d85dedd6">desc</a>', 'should <a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a> <a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#aea526ac279d0b19b1c082209fc199b73">changed</a> descripton');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">remoteUpdate.name</a>, 'update!', 'should <a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a> <a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#aea526ac279d0b19b1c082209fc199b73">changed</a> <a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>');assert.instanceOf(remoteAdd, <a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar.Models.Calendar</a>, 'should <a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">add</a> new calendar');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">remoteAdd.name</a>, 'new item', 'should <a class="el" href="../../d7/d1b/test-agent-server_8js.html#aab71dcc804ca4aa3ed2bf7ba887635db">use</a> remote <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a> when creating new calendar');});});})</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="af9bb97dbe03dda4851bf224837e120fe"></a><!-- doxytag: member="store/account_test.js::requireLib" ref="af9bb97dbe03dda4851bf224837e120fe" args="('db.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/d0e/manager__test_8js.html#a160383846e1e348b6643e19d5c153d05">requireLib</a> </td>
          <td>(</td>
          <td class="paramtype">'db.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac491a89a893a3904b6111b079a42635e"></a><!-- doxytag: member="store/account_test.js::suite" ref="ac491a89a893a3904b6111b079a42635e" args="('store/account', function(){var subject;var db;var app;setup(function(done){this.timeout(5000);app=testSupport.calendar.app();db=app.db;subject=db.getStore('Account');db.open(function(err){assert.ok(!err);done();});});teardown(function(done){testSupport.calendar.clearStore(subject.db,['accounts', 'calendars'], done);});teardown(function(){db.close();});test('initialization', function(){assert.instanceOf(subject, Calendar.Store.Abstract);assert.equal(subject.db, db);assert.deepEqual(subject._cached,{});});suite('#markWithError', function(){var errEvent;var accounts=testSupport.calendar.dbFixtures( 'account', 'Account',{one:{_id:55, providerType: 'Mock'}});var calendars=testSupport.calendar.dbFixtures( 'calendar', 'Calendar',{one:{_id: 'one', accountId:55}, two:{_id: 'two', accountId:55}});var model;setup(function(){model=accounts.one;});suite('marking error', function(){var error;setup(function(done){error=new Calendar.Error.Authentication();subject.markWithError(model, error, done);});function markedWithError(expectedCount){expectedCount=expectedCount||1;test('after erorr mark#'+expectedCount, function(done){subject.get(model._id, function(getErr, result){done(function(){assert.ok(!getErr, 'is successful');assert.equal(result.error.count, expectedCount, 'has count');assert.equal(result.error.name, error.name, 'model is marked with error');assert.instanceOf(result.error.date, Date, 'has date of occurrence');});});});}markedWithError(1);suite('second mark', function(){setup(function(done){subject.markWithError(model, error, done);});markedWithError(2);});});suite('dependant calendars', function(){var err;setup(function(done){err=new Calendar.Error.Authentication();subject.markWithError(model, err, done);});function verifyCalendar(key){test('ensure calendar is marked: '+key, function(done){app.store('Calendar').get(key, function(getErr, result){done(function(){assert.ok(result, 'has calendar');assert.ok(result.error, 'sets error');assert.equal(result.error.name, err.name, 'sets error');});});});}verifyCalendar('one');verifyCalendar('two');});});suite('#availablePresets', function(){var presetAccount;var presets={ 'multiUse':{}, 'singleUse':{singleUse:true}};test('without single use', function(done){subject.availablePresets({ 'foo':{}}, function(err, available){if(err){done();}done(function(){assert.deepEqual(available,['foo']);});});});test('when single use is available', function(done){subject.availablePresets(presets, function(err, available){if(err){done(err);}done(function(){assert.deepEqual(available,['multiUse', 'singleUse']);});});});suite('when single use is used', function(){setup(function(done){presetAccount=Factory('account',{preset: 'singleUse'});subject.persist(presetAccount, done);});test('exclusion of single use preset', function(done){subject.availablePresets(presets, function(err, available){if(err){return done(err);}done(function(){assert.deepEqual(available,['multiUse']);});});});});});suite('#verifyAndPersist', function(){var error;var result;var model;var calledWith;var modelParams;setup(function(){error=null;result={};modelParams=Factory.build('account',{providerType: 'Caldav'});model=new Calendar.Models.Account(modelParams);app._providers['Caldav']={getAccount:function(details, callback){calledWith=details;setTimeout(function(){callback(error, result);}, 0);}};});suite('duplicate account failure', function(){var existingAccount;var existingParams={providerType: 'Caldav', user: 'foobar', fullUrl: 'http:};function sendsDuplicateError(done){return function(err, id, model){done(function(){assert.ok(!id, 'is not persisted');assert.ok(err, 'sends error on duplicate account');assert.equal(err.name, 'account&#45;exist');});};}setup(function(done){existingAccount=Factory('account', existingParams);subject.persist(existingAccount, done);});test('initial input is duplicate', function(done){var account=Factory('account', existingParams);subject.verifyAndPersist(account, sendsDuplicateError(done));});test('input is updated to be duplicate', function(done){var account=Factory('account', existingParams);account.user= '';result={user:existingParams.user};subject.verifyAndPersist(account, sendsDuplicateError(done));});});suite('existing account', function(){setup(function(done){model.error={};subject.persist(model, done);});test('should be able to update', function(done){result={};model.password= 'new';subject.verifyAndPersist(model, function(err, data){if(err){return done(err);}subject.get(model._id, function(getErr, result){if(getErr){return done(err);}done(function(){assert.equal(result.password, 'new', 'updates pass');assert.ok(!result.error, 'clears errors');});});});});});test('when verify fails', function(done){error=new Error('bad stuff');subject.verifyAndPersist(model, function(err, data){done(function(){assert.ok(!data);assert.equal(err, error);assert.deepEqual(calledWith, model.toJSON());});});});test('persist+url change', function(done){result=Factory('caldav.account');subject.verifyAndPersist(model, function(err, id, data){done(function(){assert.instanceOf(data, Calendar.Models.Account);assert.equal(data.domain, result.domain);assert.equal(data.entrypoint, result.entrypoint);assert.equal(data.calendarHome, result.calendarHome);});});});test('persist+oauth change', function(done){model.oauth={code: 'xxx'};result=Factory('caldav.account',{oauth:{refresh_token: 'xxx'}});subject.verifyAndPersist(model, function(err, id, data){done(function(){assert.equal(data.oauth, result.oauth);});});});test('persist no change', function(done){result={};subject.verifyAndPersist(model, function(err, id, data){done(function(){assert.instanceOf(data, Calendar.Models.Account);assert.equal(data.domain, modelParams.domain);assert.equal(data.calendarHome, modelParams.calendarHome);});});});});suite('#remove', function(){var calStore;var model;var calendars;setup(function(done){calendars={};calStore=subject.db.getStore('Calendar');model=subject._createModel({providerType: 'Local'});subject.persist(model, done);});setup(function(done){assert.ok(model._id);calendars[1]=new Calendar.Models.Calendar({accountId:model._id, remote:{id:777}});calStore.persist(calendars[1], done);});setup(function(done){calendars[2]=new Calendar.Models.Calendar({accountId: 'some&#45;other', remote:{id:666}});calStore.persist(calendars[2], done);});suite('removal', function(){var id;setup(function(done){id=model._id;subject.remove(id, done);});test('removes account', function(done){subject.get(id, function(err, result){done(function(){assert.ok(!result, 'removes account');});});});test('removes associated calendars', function(done){calStore.all(function(err, calendars){done(function(){assert.ok(calendars.accountId!=id, 'removes calendars');});});});});});suite('#_createModel', function(){test('with id', function(){var result=subject._createModel({providerType: 'Local'}, 'id');assert.equal(result.providerType, 'Local');assert.equal(result._id, 'id');assert.instanceOf(result, Calendar.Models.Account);});test('without id', function(){var result=subject._createModel({providerType: 'Local'});assert.equal(result.providerType, 'Local');assert.isFalse(('_id'in result));});});suite('#sync:add, remove, update', function(){var remote;var events;var account;var results;var calendarStore;var cals;var remoteCalledWith;function watchEvent(eventName){calendarStore.on(eventName, function(){if(!(eventName in events)){events[eventName]=[];}events[eventName].push(arguments);});}setup(function(){calendarStore=subject.db.getStore('Calendar');account=Factory.create('account',{_id:1, providerType: 'Mock'});cals={};cals.add=Factory('calendar',{accountId:account._id, remote:{name: 'add'}});cals.remove=Factory('calendar',{accountId:account._id, remote:{name: 'remove'}});cals.update=Factory('calendar',{accountId:account._id, remote:{name: 'update'}, error:{}});});setup(function(done){calendarStore.persist(cals.update, done);});setup(function(done){calendarStore.persist(cals.remove, done);});setup(function(done){calendarStore._remoteByAccount=Object.create(null);calendarStore._cached=Object.create(null);calendarStore.all(done);});setup(function(done){events={};remoteCalledWith=null;watchEvent('add');watchEvent('update');watchEvent('remove');remote={};remote[cals.update.remote.id]={id:cals.update.remote.id, name: 'update!', description: 'new desc'};remote[cals.add.remote.id]={id:cals.add.remote.id, name: 'new item'};app.provider('Mock').stageFindCalendars(account.user, null, remote);subject.sync(account, function(err){if(err){return done(err);}done();});});var syncResults;setup(function(done){calendarStore.remotesByAccount(account._id, function(err, list){done(function(){syncResults=list;});});});test('after sync', function(){assert.equal(Object.keys(syncResults).length, 2, 'should only have two records');assert.ok(events.remove[0][0]);var updateObj=events.update[0][1].remote;assert.equal(updateObj.id, cals.update.remote.id);var addObj=events.add[0][1].remote;assert.equal(addObj.id, cals.add.remote.id);var remoteUpdate=syncResults[cals.update.remote.id];var remoteAdd=syncResults[cals.add.remote.id];assert.instanceOf(remoteUpdate, Calendar.Models.Calendar, 'should update cache');assert.ok(!remoteUpdate.error, 'removes error');assert.equal(remoteUpdate.remote.description, 'new desc', 'should update changed descripton');assert.equal(remoteUpdate.name, 'update!', 'should update changed name');assert.instanceOf(remoteAdd, Calendar.Models.Calendar, 'should add new calendar');assert.equal(remoteAdd.name, 'new item', 'should use remote data when creating new calendar');});});})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a> </td>
          <td>(</td>
          <td class="paramtype">'store/account'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d6/d4d/store_2account__test_8js.html">account_test.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:41に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
