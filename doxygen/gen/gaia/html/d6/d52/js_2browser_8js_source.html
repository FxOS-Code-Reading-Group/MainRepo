<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: browser.js ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d6/d52/js_2browser_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">browser.js</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/d52/js_2browser_8js.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../d6/d52/js_2browser_8js.html#ae2475e10618961c050dcba04e8c42331">00001</a> <span class="stringliteral">&#39;use strict&#39;</span>;
<a name="l00002"></a>00002 
<a name="l00003"></a><a class="code" href="../../d6/d52/js_2browser_8js.html#a9dd8177744f47621e365cae274f7d5eb">00003</a> var <a class="code" href="../../d6/d52/js_2browser_8js.html#a9dd8177744f47621e365cae274f7d5eb">rscheme</a> = /^(?:[<a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a>-z\u00a1-\uffff0-9-+]+)(?::|:\/\/)/<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>;
<a name="l00004"></a><a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">00004</a> var <a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a> = <a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n.get;
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="../../d6/d52/js_2browser_8js.html#a9d3c011e763d482f6888c21d76a81ba0">00006</a> var <a class="code" href="../../d6/d52/js_2browser_8js.html#a9d3c011e763d482f6888c21d76a81ba0">Browser</a> = {
<a name="l00007"></a>00007 
<a name="l00008"></a>00008   currentTab: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l00009"></a>00009   tabCounter: 0,
<a name="l00010"></a>00010   tabs: {},
<a name="l00011"></a>00011 
<a name="l00012"></a>00012   styleSheet: <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.styleSheets[0],
<a name="l00013"></a>00013   cssTranslateId: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l00014"></a>00014 
<a name="l00015"></a>00015   GO: 0,
<a name="l00016"></a>00016   REFRESH: 1,
<a name="l00017"></a>00017   STOP: 2,
<a name="l00018"></a>00018   SEARCH: 3,
<a name="l00019"></a>00019 
<a name="l00020"></a>00020   VISIBLE: 0,
<a name="l00021"></a>00021   TRANSITIONING: 1,
<a name="l00022"></a>00022   HIDDEN: 2,
<a name="l00023"></a>00023 
<a name="l00024"></a>00024   PAGE_SCREEN: <span class="stringliteral">&#39;page-screen&#39;</span>,
<a name="l00025"></a>00025   TABS_SCREEN: <span class="stringliteral">&#39;tabs-screen&#39;</span>,
<a name="l00026"></a>00026   AWESOME_SCREEN: <span class="stringliteral">&#39;awesome-screen&#39;</span>,
<a name="l00027"></a>00027   SETTINGS_SCREEN: <span class="stringliteral">&#39;settings-screen&#39;</span>,
<a name="l00028"></a>00028   previousScreen: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l00029"></a>00029   currentScreen: <span class="stringliteral">&#39;page-screen&#39;</span>,
<a name="l00030"></a>00030 
<a name="l00031"></a>00031   <span class="comment">// This data is set from browser settings,</span>
<a name="l00032"></a>00032   <span class="comment">// populated from init.json on first run</span>
<a name="l00033"></a>00033   searchEngine: {},
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   DEVICE_RATIO: <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.devicePixelRatio,
<a name="l00036"></a>00036   UPPER_SCROLL_THRESHOLD: 50, <span class="comment">// hide address bar</span>
<a name="l00037"></a>00037   LOWER_SCROLL_THRESHOLD: 5, <span class="comment">// show address bar</span>
<a name="l00038"></a>00038   MAX_TOP_SITES: 4, <span class="comment">// max number of top sites to display</span>
<a name="l00039"></a>00039   MAX_THUMBNAIL_WIDTH: 140,
<a name="l00040"></a>00040   MAX_THUMBNAIL_HEIGHT: 100,
<a name="l00041"></a>00041   FIRST_TAB: <span class="stringliteral">&#39;tab_0&#39;</span>,
<a name="l00042"></a>00042   MAX_SAVING_RETRIES: 100, <span class="comment">// max number of retries when saving images with a</span>
<a name="l00043"></a>00043                            <span class="comment">// new name.</span>
<a name="l00044"></a>00044   urlButtonMode: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l00045"></a>00045   addressBarState: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   inTransition: <span class="keyword">false</span>,
<a name="l00048"></a>00048 
<a name="l00049"></a>00049   waitingActivities: [],
<a name="l00050"></a>00050   hasLoaded: <span class="keyword">false</span>,
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="comment">// store the current scroll position, so we can re-calculate whether</span>
<a name="l00053"></a>00053   <span class="comment">// we need to show the addressbar when loading the page is complete</span>
<a name="l00054"></a>00054   lastScrollOffset: 0,
<a name="l00055"></a>00055 
<a name="l00056"></a>00056   <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>: <span class="keyword">function</span> browser_init() {
<a name="l00057"></a>00057     this.getAllElements();
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     <span class="comment">// Add event listeners</span>
<a name="l00060"></a>00060     this.urlBar.addEventListener(<span class="stringliteral">&#39;submit&#39;</span>, this.handleUrlFormSubmit.bind(<span class="keyword">this</span>));
<a name="l00061"></a>00061     this.urlInput.addEventListener(<span class="stringliteral">&#39;focus&#39;</span>, this.urlFocus.bind(<span class="keyword">this</span>));
<a name="l00062"></a>00062     this.urlInput.addEventListener(<span class="stringliteral">&#39;blur&#39;</span>, this.urlBlur.bind(<span class="keyword">this</span>));
<a name="l00063"></a>00063     this.urlInput.addEventListener(<span class="stringliteral">&#39;mouseup&#39;</span>, this.urlMouseUp.bind(<span class="keyword">this</span>));
<a name="l00064"></a>00064     this.urlInput.addEventListener(<span class="stringliteral">&#39;keyup&#39;</span>,
<a name="l00065"></a>00065       this.handleUrlInputKeypress.bind(<span class="keyword">this</span>));
<a name="l00066"></a>00066     this.urlButton.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00067"></a>00067       this.handleUrlFormSubmit.bind(<span class="keyword">this</span>));
<a name="l00068"></a>00068     this.tabsBadge.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00069"></a>00069       this.handleTabsBadgeClicked.bind(<span class="keyword">this</span>));
<a name="l00070"></a>00070 
<a name="l00071"></a>00071     <span class="comment">// Hack to make integration tests pass, see bug 912150</span>
<a name="l00072"></a>00072     this.urlInput.addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.urlFocus.bind(<span class="keyword">this</span>));
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.init((<span class="keyword">function</span>() {
<a name="l00075"></a>00075       this.selectTab(this.createTab());
<a name="l00076"></a>00076       this.addressBarState = this.VISIBLE;
<a name="l00077"></a>00077       <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.getSetting(<span class="stringliteral">&#39;defaultSearchEngine&#39;</span>, (<span class="keyword">function</span>(<a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>) {
<a name="l00078"></a>00078         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>)
<a name="l00079"></a>00079           <span class="keywordflow">return</span>;
<a name="l00080"></a>00080         <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.getSearchEngine(<a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>, (<span class="keyword">function</span>(searchEngine) {
<a name="l00081"></a>00081           <span class="keywordflow">if</span> (!searchEngine)
<a name="l00082"></a>00082             <span class="keywordflow">return</span>;
<a name="l00083"></a>00083           this.searchEngine = searchEngine;
<a name="l00084"></a>00084         }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>));
<a name="l00085"></a>00085       }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>));
<a name="l00086"></a>00086     }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>));
<a name="l00087"></a>00087   },
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   <a class="code" href="../../d3/d4b/lockscreen_8js.html#af3924f720ff704b73f4892a5b9a529fe">toCamelCase</a>: <span class="keyword">function</span> <a class="code" href="../../d3/d4b/lockscreen_8js.html#af3924f720ff704b73f4892a5b9a529fe">toCamelCase</a>(<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>) {
<a name="l00090"></a>00090     <span class="keywordflow">return</span> <a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>.replace(/\-(.)/<a class="code" href="../../d8/dad/apps_2email_2js_2ext_2mailapi_2chewlayer_8js.html#a73c18c59a39b18382081ec00bb456d43">g</a>, <span class="keyword">function</span> replacer(<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>, p1) {
<a name="l00091"></a>00091       <span class="keywordflow">return</span> p1.toUpperCase();
<a name="l00092"></a>00092     });
<a name="l00093"></a>00093   },
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   getAllElements: <span class="keyword">function</span> browser_getAllElements() {
<a name="l00096"></a>00096     var elementIDs = [
<a name="l00097"></a>00097       <span class="stringliteral">&#39;toolbar-start&#39;</span>, <span class="stringliteral">&#39;url-bar&#39;</span>, <span class="stringliteral">&#39;url-input&#39;</span>, <span class="stringliteral">&#39;url-button&#39;</span>, <span class="stringliteral">&#39;awesomescreen&#39;</span>,
<a name="l00098"></a>00098       <span class="stringliteral">&#39;ssl-indicator&#39;</span>, <span class="stringliteral">&#39;tabs-badge&#39;</span>, <span class="stringliteral">&#39;throbber&#39;</span>, <span class="stringliteral">&#39;frames&#39;</span>, <span class="stringliteral">&#39;main-screen&#39;</span>,
<a name="l00099"></a>00099       <span class="stringliteral">&#39;crashscreen&#39;</span>, <span class="stringliteral">&#39;bookmark-menu&#39;</span>, <span class="stringliteral">&#39;bookmark-entry-sheet&#39;</span>,
<a name="l00100"></a>00100       <span class="stringliteral">&#39;startscreen&#39;</span>, <span class="stringliteral">&#39;top-site-thumbnails&#39;</span>,
<a name="l00101"></a>00101       <span class="stringliteral">&#39;no-top-sites&#39;</span>, <span class="stringliteral">&#39;tray&#39;</span>, <span class="stringliteral">&#39;danger-dialog&#39;</span>];
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     <span class="comment">// Loop and add element with camel style name to Modal Dialog attribute.</span>
<a name="l00104"></a>00104     elementIDs.forEach(<span class="keyword">function</span> createElementRef(<a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>) {
<a name="l00105"></a>00105       <span class="keyword">this</span>[this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#af3924f720ff704b73f4892a5b9a529fe">toCamelCase</a>(<a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>)] = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>);
<a name="l00106"></a>00106     }, <span class="keyword">this</span>);
<a name="l00107"></a>00107   },
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   loadRemaining: <span class="keyword">function</span> browser_loadRemaining() {
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (this.hasLoaded)
<a name="l00111"></a>00111       <span class="keywordflow">return</span>;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     var elementsToLoad = [
<a name="l00114"></a>00114       <span class="comment">// DOM Nodes with commented content to load</span>
<a name="l00115"></a>00115       this.awesomescreen,
<a name="l00116"></a>00116       this.crashscreen,
<a name="l00117"></a>00117       this.tray,
<a name="l00118"></a>00118       this.bookmarkMenu,
<a name="l00119"></a>00119       this.bookmarkEntrySheet,
<a name="l00120"></a>00120       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;settings&#39;</span>),
<a name="l00121"></a>00121       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;modal-dialog-alert&#39;</span>),
<a name="l00122"></a>00122       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;modal-dialog-prompt&#39;</span>),
<a name="l00123"></a>00123       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;modal-dialog-confirm&#39;</span>),
<a name="l00124"></a>00124       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;modal-dialog-custom-prompt&#39;</span>),
<a name="l00125"></a>00125       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;http-authentication-dialog&#39;</span>),
<a name="l00126"></a>00126       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;danger-dialog&#39;</span>)
<a name="l00127"></a>00127     ];
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     var filesToLoad = [
<a name="l00130"></a>00130       <span class="comment">// css files</span>
<a name="l00131"></a>00131       <span class="stringliteral">&#39;shared/style/headers.css&#39;</span>,
<a name="l00132"></a>00132       <span class="stringliteral">&#39;shared/style/buttons.css&#39;</span>,
<a name="l00133"></a>00133       <span class="stringliteral">&#39;shared/style/input_areas.css&#39;</span>,
<a name="l00134"></a>00134       <span class="stringliteral">&#39;shared/style/status.css&#39;</span>,
<a name="l00135"></a>00135       <span class="stringliteral">&#39;shared/style/confirm.css&#39;</span>,
<a name="l00136"></a>00136       <span class="stringliteral">&#39;style/modal_dialog/modal_dialog.css&#39;</span>,
<a name="l00137"></a>00137       <span class="stringliteral">&#39;style/modal_dialog/prompt.css&#39;</span>,
<a name="l00138"></a>00138       <span class="stringliteral">&#39;style/themes/default/core.css&#39;</span>,
<a name="l00139"></a>00139       <span class="stringliteral">&#39;style/themes/default/buttons.css&#39;</span>,
<a name="l00140"></a>00140       <span class="stringliteral">&#39;style/action_menu.css&#39;</span>,
<a name="l00141"></a>00141       <span class="stringliteral">&#39;style/authentication_dialog.css&#39;</span>,
<a name="l00142"></a>00142       <span class="stringliteral">&#39;style/settings.css&#39;</span>,
<a name="l00143"></a>00143       <span class="stringliteral">&#39;style/awesomescreen.css&#39;</span>,
<a name="l00144"></a>00144 
<a name="l00145"></a>00145       <span class="comment">// shared JS files</span>
<a name="l00146"></a>00146       <span class="stringliteral">&#39;shared/js/gesture_detector.js&#39;</span>
<a name="l00147"></a>00147     ];
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     var jsFiles = [
<a name="l00150"></a>00150       <span class="stringliteral">&#39;js/awesomescreen.js&#39;</span>,
<a name="l00151"></a>00151       <span class="stringliteral">&#39;js/settings.js&#39;</span>,
<a name="l00152"></a>00152       <span class="stringliteral">&#39;js/modal_dialog.js&#39;</span>,
<a name="l00153"></a>00153       <span class="stringliteral">&#39;js/authentication_dialog.js&#39;</span>
<a name="l00154"></a>00154     ];
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     var domElements = [
<a name="l00157"></a>00157       <span class="stringliteral">&#39;tabs-list&#39;</span>, <span class="stringliteral">&#39;settings-button&#39;</span>,
<a name="l00158"></a>00158       <span class="stringliteral">&#39;close-tab&#39;</span>, <span class="stringliteral">&#39;try-reloading&#39;</span>, <span class="stringliteral">&#39;bookmark-menu-add&#39;</span>,
<a name="l00159"></a>00159       <span class="stringliteral">&#39;bookmark-menu-remove&#39;</span>, <span class="stringliteral">&#39;bookmark-menu-cancel&#39;</span>, <span class="stringliteral">&#39;bookmark-menu-edit&#39;</span>,
<a name="l00160"></a>00160       <span class="stringliteral">&#39;bookmark-entry-sheet-cancel&#39;</span>, <span class="stringliteral">&#39;bookmark-entry-sheet-done&#39;</span>,
<a name="l00161"></a>00161       <span class="stringliteral">&#39;bookmark-title&#39;</span>, <span class="stringliteral">&#39;bookmark-url&#39;</span>, <span class="stringliteral">&#39;bookmark-previous-url&#39;</span>,
<a name="l00162"></a>00162       <span class="stringliteral">&#39;bookmark-menu-add-home&#39;</span>, <span class="stringliteral">&#39;new-tab-button&#39;</span>,
<a name="l00163"></a>00163       <span class="stringliteral">&#39;danger-dialog-message&#39;</span>, <span class="stringliteral">&#39;danger-dialog-cancel&#39;</span>, <span class="stringliteral">&#39;danger-dialog-ok&#39;</span>
<a name="l00164"></a>00164     ];
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     var loadBrowserFiles = <span class="keyword">function</span>() {
<a name="l00167"></a>00167       <a class="code" href="../../d3/db5/build__stage_2email_2shared_2js_2lazy__loader_8js.html#aaf5eec8afd0243eeb2166f74e472c877">LazyLoader</a>.load(jsFiles, <span class="keyword">function</span>() {
<a name="l00168"></a>00168         var <a class="code" href="../../da/dce/details__test_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">mozL10n</a> = <a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n;
<a name="l00169"></a>00169         mozL10n.ready(<span class="keyword">function</span> browser_localizeElements() {
<a name="l00170"></a>00170           elementsToLoad.forEach(<span class="keyword">function</span> l10nElement(element) {
<a name="l00171"></a>00171             mozL10n.translate(element);
<a name="l00172"></a>00172           });
<a name="l00173"></a>00173         });
<a name="l00174"></a>00174         domElements.forEach(<span class="keyword">function</span> createElementRef(<a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>) {
<a name="l00175"></a>00175           <span class="keyword">this</span>[this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#af3924f720ff704b73f4892a5b9a529fe">toCamelCase</a>(<a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>)] = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>);
<a name="l00176"></a>00176         }, <span class="keyword">this</span>);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         this.initRemainingListeners();
<a name="l00179"></a>00179         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.classList.add(<span class="stringliteral">&#39;loaded&#39;</span>);
<a name="l00180"></a>00180         this.hasLoaded = <span class="keyword">true</span>;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (this.waitingActivities.length) {
<a name="l00183"></a>00183           this.waitingActivities.forEach(this.handleActivity, <span class="keyword">this</span>);
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185       }.bind(<span class="keyword">this</span>));
<a name="l00186"></a>00186     };
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <a class="code" href="../../d3/db5/build__stage_2email_2shared_2js_2lazy__loader_8js.html#aaf5eec8afd0243eeb2166f74e472c877">LazyLoader</a>.load(elementsToLoad.concat(filesToLoad),
<a name="l00189"></a>00189       loadBrowserFiles.bind(<span class="keyword">this</span>));
<a name="l00190"></a>00190   },
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   initRemainingListeners: <span class="keyword">function</span> browser_initRemainingListeners() {
<a name="l00193"></a>00193      this.settingsButton.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00194"></a>00194        <a class="code" href="../../de/d5e/apps_2browser_2js_2settings_8js.html#a2f596332cd75ad3af3b5639f64da6573">Settings</a>.show.bind(<a class="code" href="../../de/d5e/apps_2browser_2js_2settings_8js.html#a2f596332cd75ad3af3b5639f64da6573">Settings</a>));
<a name="l00195"></a>00195      this.newTabButton.addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.handleNewTab.bind(<span class="keyword">this</span>));
<a name="l00196"></a>00196      this.closeTab.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00197"></a>00197        this.handleCloseTab.bind(<span class="keyword">this</span>));
<a name="l00198"></a>00198      this.tryReloading.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00199"></a>00199        this.handleTryReloading.bind(<span class="keyword">this</span>));
<a name="l00200"></a>00200      this.bookmarkMenuAdd.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00201"></a>00201        this.addBookmark.bind(<span class="keyword">this</span>));
<a name="l00202"></a>00202      this.bookmarkMenuRemove.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00203"></a>00203        this.removeBookmark.bind(<span class="keyword">this</span>));
<a name="l00204"></a>00204      this.bookmarkMenuCancel.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00205"></a>00205        this.hideBookmarkMenu.bind(<span class="keyword">this</span>));
<a name="l00206"></a>00206      this.bookmarkMenuEdit.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00207"></a>00207        this.showBookmarkEntrySheet.bind(<span class="keyword">this</span>));
<a name="l00208"></a>00208      this.bookmarkMenuAddHome.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00209"></a>00209        this.addLinkToHome.bind(<span class="keyword">this</span>));
<a name="l00210"></a>00210      this.bookmarkEntrySheetCancel.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00211"></a>00211        this.hideBookmarkEntrySheet.bind(<span class="keyword">this</span>));
<a name="l00212"></a>00212      this.bookmarkEntrySheetDone.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00213"></a>00213        this.saveBookmark.bind(<span class="keyword">this</span>));
<a name="l00214"></a>00214      this.topSiteThumbnails.addEventListener(<span class="stringliteral">&#39;click&#39;</span>,
<a name="l00215"></a>00215        this.followLink.bind(<span class="keyword">this</span>));
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     this.tabsSwipeMngr.browser = <span class="keyword">this</span>;
<a name="l00218"></a>00218      [<span class="stringliteral">&#39;mousedown&#39;</span>, <span class="stringliteral">&#39;pan&#39;</span>, <span class="stringliteral">&#39;tap&#39;</span>, <span class="stringliteral">&#39;swipe&#39;</span>].forEach(<span class="keyword">function</span>(evt) {
<a name="l00219"></a>00219        this.tabsList.addEventListener(evt,
<a name="l00220"></a>00220          this.tabsSwipeMngr[evt].<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(this.tabsSwipeMngr));
<a name="l00221"></a>00221      }, <span class="keyword">this</span>);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223      this.screenSwipeMngr.browser = <span class="keyword">this</span>;
<a name="l00224"></a>00224      this.screenSwipeMngr.screen = this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>;
<a name="l00225"></a>00225      this.screenSwipeMngr.gestureDetector =
<a name="l00226"></a>00226        <span class="keyword">new</span> <a class="code" href="../../d8/df0/frames_8js.html#a050c35bd1ae66a249cd6c3554661e24a">GestureDetector</a>(this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228      [<span class="stringliteral">&#39;mousedown&#39;</span>, <span class="stringliteral">&#39;pan&#39;</span>, <span class="stringliteral">&#39;tap&#39;</span>, <span class="stringliteral">&#39;swipe&#39;</span>].forEach(<span class="keyword">function</span>(evt) {
<a name="l00229"></a>00229        this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.addEventListener(evt,
<a name="l00230"></a>00230          this.screenSwipeMngr[evt].<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(this.screenSwipeMngr));
<a name="l00231"></a>00231      }, <span class="keyword">this</span>);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233      <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.addEventListener(<span class="stringliteral">&#39;visibilitychange&#39;</span>,
<a name="l00234"></a>00234        this.handleVisibilityChange.bind(<span class="keyword">this</span>));
<a name="l00235"></a>00235 
<a name="l00236"></a>00236      <a class="code" href="../../de/d5e/apps_2browser_2js_2settings_8js.html#a2f596332cd75ad3af3b5639f64da6573">Settings</a>.init();
<a name="l00237"></a>00237      <a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.init();
<a name="l00238"></a>00238      <a class="code" href="../../d5/d7e/awesomescreen_8js.html#a2d725ab043526df3d05cc057e330f721">Awesomescreen</a>.init();
<a name="l00239"></a>00239      <a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.init(<span class="keyword">false</span>);
<a name="l00240"></a>00240   },
<a name="l00241"></a>00241 
<a name="l00251"></a>00251   getConfigurationData: <span class="keyword">function</span> browser_getDefaultData(variant, <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>) {
<a name="l00252"></a>00252     var DEFAULT_MCC = <span class="stringliteral">&#39;000&#39;</span>;
<a name="l00253"></a>00253     var DEFAULT_MNC = <span class="stringliteral">&#39;000&#39;</span>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     var <a class="code" href="../../da/d84/openvideo_8js.html#a329f2008ea05312f90696aa4401250ed">xhr</a> = <span class="keyword">new</span> <a class="code" href="../../d0/dfb/namespacemozilla_1_1dom_1_1prototypes_1_1id.html#addcec93baff9084aadf2519231ea4a28a2619068a621e6b22d7995161b2cea021">XMLHttpRequest</a>();
<a name="l00256"></a>00256     xhr.open(<span class="stringliteral">&#39;GET&#39;</span>, <span class="stringliteral">&#39;/js/init.json&#39;</span>, <span class="keyword">true</span>);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     xhr.addEventListener(<span class="stringliteral">&#39;load&#39;</span>, (<span class="keyword">function</span> browser_defaultDataListener() {
<a name="l00259"></a>00259       <span class="keywordflow">if</span> (!(xhr.status === 200 | xhr.status === 0)) {
<a name="l00260"></a>00260         <a class="code" href="../../d9/d42/caldav__worker_8js.html#ac798a668e63cdb5c7af2b97ab014f85f">console</a>.error(<span class="stringliteral">&#39;Unknown response when getting configuration data.&#39;</span>);
<a name="l00261"></a>00261         <span class="keywordflow">return</span>;
<a name="l00262"></a>00262       }
<a name="l00263"></a>00263       var <a class="code" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a> = JSON.parse(xhr.responseText);
<a name="l00264"></a>00264       var mccCode = <a class="code" href="../../d6/d5e/utilities_8js.html#a6bf710b1d82acf19476a82885b72d8b4">NumberHelper</a>.zfill(variant.mcc, 3);
<a name="l00265"></a>00265       var mncCode = <a class="code" href="../../d6/d5e/utilities_8js.html#a6bf710b1d82acf19476a82885b72d8b4">NumberHelper</a>.zfill(variant.mnc, 3);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       <span class="keywordflow">if</span> (data[mccCode + mncCode]) {
<a name="l00268"></a>00268         <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>(data[mccCode + mncCode]);
<a name="l00269"></a>00269       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data[mccCode + DEFAULT_MNC]) {
<a name="l00270"></a>00270         <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>(data[mccCode + DEFAULT_MNC]);
<a name="l00271"></a>00271       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data[DEFAULT_MCC + DEFAULT_MNC]) {
<a name="l00272"></a>00272         <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>(data[DEFAULT_MCC + DEFAULT_MNC]);
<a name="l00273"></a>00273       } <span class="keywordflow">else</span> {
<a name="l00274"></a>00274         <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>);
<a name="l00275"></a>00275         <a class="code" href="../../d9/d42/caldav__worker_8js.html#ac798a668e63cdb5c7af2b97ab014f85f">console</a>.error(<span class="stringliteral">&#39;No configuration data found.&#39;</span>);
<a name="l00276"></a>00276       }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     <a class="code" href="../../da/d84/openvideo_8js.html#a329f2008ea05312f90696aa4401250ed">xhr</a>.onerror = <span class="keyword">function</span> getDefaultDataError() {
<a name="l00281"></a>00281       <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>);
<a name="l00282"></a>00282       <a class="code" href="../../d9/d42/caldav__worker_8js.html#ac798a668e63cdb5c7af2b97ab014f85f">console</a>.error(<span class="stringliteral">&#39;Error getting configuration data.&#39;</span>);
<a name="l00283"></a>00283     };
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <a class="code" href="../../da/d84/openvideo_8js.html#a329f2008ea05312f90696aa4401250ed">xhr</a>.send();
<a name="l00286"></a>00286   },
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   <span class="comment">// Clicking the page preview on the left gutter of the tab page opens</span>
<a name="l00289"></a>00289   <span class="comment">// that page</span>
<a name="l00290"></a>00290   handlePageScreenClicked: <span class="keyword">function</span> browser_handlePageScreenClicked(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00291"></a>00291     <span class="keywordflow">if</span> (this.inTransition) {
<a name="l00292"></a>00292       <span class="keywordflow">return</span>;
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (this.currentScreen === this.TABS_SCREEN) {
<a name="l00295"></a>00295       this.showPageScreen();
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297   },
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   handleTryReloading: <span class="keyword">function</span> browser_handleTryReloading() {
<a name="l00300"></a>00300     this.reviveCrashedTab(this.currentTab);
<a name="l00301"></a>00301   },
<a name="l00302"></a>00302 
<a name="l00303"></a>00303   handleCloseTab: <span class="keyword">function</span> browser_handleCloseTab() {
<a name="l00304"></a>00304     this.hideCrashScreen();
<a name="l00305"></a>00305     this.deleteTab(this.currentTab.id);
<a name="l00306"></a>00306     this.setTabVisibility(this.currentTab, <span class="keyword">true</span>);
<a name="l00307"></a>00307     this.updateTabsCount();
<a name="l00308"></a>00308   },
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="comment">// Tabs badge is the button at the top right, used to show the number of tabs</span>
<a name="l00311"></a>00311   <span class="comment">// and to create new ones</span>
<a name="l00312"></a>00312   handleTabsBadgeClicked: <span class="keyword">function</span> browser_handleTabsBadgeClicked(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (this.inTransition)
<a name="l00314"></a>00314       <span class="keywordflow">return</span>;
<a name="l00315"></a>00315     this.showTabScreen();
<a name="l00316"></a>00316   },
<a name="l00317"></a>00317 
<a name="l00318"></a>00318   handleNewTab: <span class="keyword">function</span> browserHandleNewTab(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00319"></a>00319     this.inTransition = <span class="keyword">true</span>;
<a name="l00320"></a>00320     var tabId = this.createTab();
<a name="l00321"></a>00321     this.showNewTabAnimation((<span class="keyword">function</span> browser_showNewTabAnimation() {
<a name="l00322"></a>00322       this.selectTab(tabId);
<a name="l00323"></a>00323       <a class="code" href="../../d5/d7e/awesomescreen_8js.html#a2d725ab043526df3d05cc057e330f721">Awesomescreen</a>.show();
<a name="l00324"></a>00324     }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>));
<a name="l00325"></a>00325   },
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="comment">// Each browser gets their own listener</span>
<a name="l00328"></a>00328   handleBrowserEvent: <span class="keyword">function</span> browser_handleBrowserEvent(tab) {
<a name="l00329"></a>00329     <span class="keywordflow">return</span> (<span class="keyword">function</span>(evt) {
<a name="l00330"></a>00330       var isCurrentTab = this.currentTab.id === tab.id;
<a name="l00331"></a>00331       <span class="keywordflow">switch</span> (evt.type) {
<a name="l00332"></a>00332 
<a name="l00333"></a>00333       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowserloadstart&#39;</span>:
<a name="l00334"></a>00334         <span class="comment">// iframe will call loadstart on creation, ignore</span>
<a name="l00335"></a>00335         <a class="code" href="../../d6/d52/js_2browser_8js.html#a7321fd84345f4f9455f25996b932b8fd">if</a> (!tab.url || tab.crashed) {
<a name="l00336"></a>00336           <span class="keywordflow">return</span>;
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338         <span class="comment">// If address bar is hidden then show it</span>
<a name="l00339"></a>00339         <span class="keywordflow">if</span> (this.addressBarState === this.HIDDEN) {
<a name="l00340"></a>00340           this.showAddressBar();
<a name="l00341"></a>00341         }
<a name="l00342"></a>00342         tab.loading = <span class="keyword">true</span>;
<a name="l00343"></a>00343         <span class="keywordflow">if</span> (isCurrentTab &amp;&amp; this.currentScreen === this.PAGE_SCREEN) {
<a name="l00344"></a>00344           this.throbber.classList.add(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l00345"></a>00345           this.setUrlButtonMode(this.STOP);
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347         tab.title = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00348"></a>00348         tab.iconUrl = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00349"></a>00349         <span class="keywordflow">break</span>;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowserloadend&#39;</span>:
<a name="l00352"></a>00352         <span class="keywordflow">if</span> (!tab.loading) {
<a name="l00353"></a>00353           <span class="keywordflow">return</span>;
<a name="l00354"></a>00354         }
<a name="l00355"></a>00355         tab.loading = <span class="keyword">false</span>;
<a name="l00356"></a>00356         <span class="keywordflow">if</span> (isCurrentTab &amp;&amp; this.currentScreen === this.PAGE_SCREEN) {
<a name="l00357"></a>00357           this.throbber.classList.remove(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l00358"></a>00358           this.setUrlBar(tab.title || tab.url);
<a name="l00359"></a>00359           this.setUrlButtonMode(this.REFRESH);
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361         <span class="comment">// Capture screenshot for tab thumbnail</span>
<a name="l00362"></a>00362         <span class="keywordflow">if</span> (tab.dom.getScreenshot) {
<a name="l00363"></a>00363           tab.dom.getScreenshot(this.MAX_THUMBNAIL_WIDTH * this.DEVICE_RATIO,
<a name="l00364"></a>00364             this.MAX_THUMBNAIL_HEIGHT * this.DEVICE_RATIO).onsuccess =
<a name="l00365"></a>00365           (<span class="keyword">function</span>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00366"></a>00366             tab.screenshot = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target.result;
<a name="l00367"></a>00367             <span class="keywordflow">if</span> (this.currentScreen === this.TABS_SCREEN) {
<a name="l00368"></a>00368               this.showTabScreen();
<a name="l00369"></a>00369             }
<a name="l00370"></a>00370             <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.updateScreenshot(tab.url, tab.screenshot);
<a name="l00371"></a>00371           }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>);
<a name="l00372"></a>00372         }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         <span class="comment">// If no icon URL found yet, try loading from default location</span>
<a name="l00375"></a>00375         <span class="keywordflow">if</span> (!tab.iconUrl) {
<a name="l00376"></a>00376           var <a class="code" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="charliteral">&#39;a&#39;</span>);
<a name="l00377"></a>00377           a.href = tab.url;
<a name="l00378"></a>00378           var <a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#ab7e06d3fa6e5b9f42c44a95747abfabc">iconUrl</a> = a.protocol + <span class="stringliteral">&#39;//&#39;</span> + a.hostname + <span class="charliteral">&#39;/&#39;</span> + <span class="stringliteral">&#39;favicon.ico&#39;</span>;
<a name="l00379"></a>00379           <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.setAndLoadIconForPage(tab.url, iconUrl);
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382         <span class="comment">// We always show the address bar when loading</span>
<a name="l00383"></a>00383         <span class="comment">// After loading we might need to hide it</span>
<a name="l00384"></a>00384         this.handleScroll({ detail: { <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a2d367ff48e26f53b84f9b2fe7d6065d6">top</a>: this.lastScrollOffset } });
<a name="l00385"></a>00385 
<a name="l00386"></a>00386         <span class="keywordflow">break</span>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowserlocationchange&#39;</span>:
<a name="l00389"></a>00389         this.lastScrollOffset = 0;
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (evt.detail === <span class="stringliteral">&#39;about:blank&#39;</span>) {
<a name="l00391"></a>00391           <span class="keywordflow">return</span>;
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393         tab.url = evt.detail;
<a name="l00394"></a>00394         this.updateHistory(evt.detail);
<a name="l00395"></a>00395         <span class="keywordflow">if</span> (isCurrentTab) {
<a name="l00396"></a>00396           <span class="keywordflow">if</span> (this.currentScreen === this.PAGE_SCREEN) {
<a name="l00397"></a>00397             this.setUrlBar(tab.url);
<a name="l00398"></a>00398           }
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400         <span class="keywordflow">break</span>;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowsertitlechange&#39;</span>:
<a name="l00403"></a>00403         <span class="keywordflow">if</span> (evt.detail) {
<a name="l00404"></a>00404           tab.title = evt.detail;
<a name="l00405"></a>00405           <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.setPageTitle(tab.url, tab.title);
<a name="l00406"></a>00406           <span class="keywordflow">if</span> (isCurrentTab &amp;&amp; !tab.loading &amp;&amp;
<a name="l00407"></a>00407               <span class="keyword">this</span>.currentScreen === <span class="keyword">this</span>.PAGE_SCREEN) {
<a name="l00408"></a>00408             this.setUrlBar(tab.title);
<a name="l00409"></a>00409           }
<a name="l00410"></a>00410           <span class="comment">// Refresh the tab screen if we are currently viewing it, for dynamic</span>
<a name="l00411"></a>00411           <span class="comment">// or not yet loaded titles</span>
<a name="l00412"></a>00412           <span class="keywordflow">if</span> (this.currentScreen === this.TABS_SCREEN) {
<a name="l00413"></a>00413             this.showTabScreen();
<a name="l00414"></a>00414           }
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416         <span class="keywordflow">break</span>;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowsericonchange&#39;</span>:
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (evt.detail.href &amp;&amp; evt.detail.href != tab.iconUrl) {
<a name="l00420"></a>00420           tab.iconUrl = evt.detail.href;
<a name="l00421"></a>00421           <span class="comment">// TODO: Pick up the best icon</span>
<a name="l00422"></a>00422           <span class="comment">// based on evt.detail.sizes and device size.</span>
<a name="l00423"></a>00423           <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.setAndLoadIconForPage(tab.url, tab.iconUrl);
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425         <span class="keywordflow">break</span>;
<a name="l00426"></a>00426 
<a name="l00427"></a>00427       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowsercontextmenu&#39;</span>:
<a name="l00428"></a>00428         <span class="keywordflow">if</span> (!this.contextMenuHasCalled) {
<a name="l00429"></a>00429           this.contextMenuHasCalled = <span class="keyword">true</span>;
<a name="l00430"></a>00430           this.showContextMenu(evt);
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432         <span class="keywordflow">break</span>;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowsersecuritychange&#39;</span>:
<a name="l00435"></a>00435         tab.security = evt.detail;
<a name="l00436"></a>00436         <span class="keywordflow">if</span> (isCurrentTab) {
<a name="l00437"></a>00437           this.updateSecurityIcon();
<a name="l00438"></a>00438         }
<a name="l00439"></a>00439         <span class="keywordflow">break</span>;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowseropenwindow&#39;</span>:
<a name="l00442"></a>00442         this.handleWindowOpen(evt);
<a name="l00443"></a>00443         <span class="keywordflow">break</span>;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowserclose&#39;</span>:
<a name="l00446"></a>00446         this.handleWindowClose(tab.id);
<a name="l00447"></a>00447         this.setTabVisibility(this.currentTab, <span class="keyword">true</span>);
<a name="l00448"></a>00448         this.updateTabsCount();
<a name="l00449"></a>00449         <span class="keywordflow">if</span> (tab.id === <a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.currentOrigin) {
<a name="l00450"></a>00450           <a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.hide();
<a name="l00451"></a>00451         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tab.id === <a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.currentOrigin) {
<a name="l00452"></a>00452           <a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.hide();
<a name="l00453"></a>00453         }
<a name="l00454"></a>00454         <span class="keywordflow">break</span>;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowserusernameandpasswordrequired&#39;</span>:
<a name="l00457"></a>00457         <span class="keywordflow">if</span> (!isCurrentTab) {
<a name="l00458"></a>00458           this.hideCurrentTab();
<a name="l00459"></a>00459           this.selectTab(tab.id);
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461         <span class="keywordflow">if</span> (this.currentScreen !== this.PAGE_SCREEN) {
<a name="l00462"></a>00462           this.showPageScreen();
<a name="l00463"></a>00463         }
<a name="l00464"></a>00464         <a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.handleEvent(evt, tab.id);
<a name="l00465"></a>00465         <span class="keywordflow">break</span>;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowsershowmodalprompt&#39;</span>:
<a name="l00468"></a>00468         <span class="keywordflow">if</span> (!isCurrentTab) {
<a name="l00469"></a>00469           this.hideCurrentTab();
<a name="l00470"></a>00470           this.selectTab(tab.id);
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472         <span class="keywordflow">if</span> (this.currentScreen !== this.PAGE_SCREEN) {
<a name="l00473"></a>00473           this.showPageScreen();
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475         <a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.handleEvent(evt, tab.id);
<a name="l00476"></a>00476         <span class="keywordflow">break</span>;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowsererror&#39;</span>:
<a name="l00479"></a>00479         <span class="keywordflow">if</span> (evt.detail.type === <span class="stringliteral">&#39;fatal&#39;</span>)
<a name="l00480"></a>00480           this.handleCrashedTab(tab);
<a name="l00481"></a>00481         <span class="keywordflow">break</span>;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       <span class="keywordflow">case</span> <span class="stringliteral">&#39;mozbrowserasyncscroll&#39;</span>:
<a name="l00484"></a>00484         this.handleScroll(evt);
<a name="l00485"></a>00485         <span class="keywordflow">break</span>;
<a name="l00486"></a>00486       }
<a name="l00487"></a>00487     }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>);
<a name="l00488"></a>00488   },
<a name="l00489"></a>00489 
<a name="l00490"></a>00490   handleScroll: <span class="keyword">function</span> browser_handleScroll(evt) {
<a name="l00491"></a>00491     this.lastScrollOffset = evt.detail.top;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="keywordflow">if</span> (evt.detail.top &lt; <span class="keyword">this</span>.LOWER_SCROLL_THRESHOLD) {
<a name="l00494"></a>00494       this.showAddressBar();
<a name="l00495"></a>00495     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (evt.detail.top &gt; <span class="keyword">this</span>.UPPER_SCROLL_THRESHOLD) {
<a name="l00496"></a>00496       this.hideAddressBar();
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498   },
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   hideAddressBar: <span class="keyword">function</span> browser_hideAddressBar() {
<a name="l00501"></a>00501     <span class="keywordflow">if</span> (this.addressBarState === this.HIDDEN ||
<a name="l00502"></a>00502         this.addressBarState === this.TRANSITIONING) {
<a name="l00503"></a>00503       <span class="keywordflow">return</span>;
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     <span class="comment">// don&#39;t hide the address bar when loading</span>
<a name="l00507"></a>00507     <span class="keywordflow">if</span> (this.currentTab.loading)
<a name="l00508"></a>00508       <span class="keywordflow">return</span>;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     var addressBarHidden = (<span class="keyword">function</span> browser_addressBarHidden() {
<a name="l00511"></a>00511       this.addressBarState = this.HIDDEN;
<a name="l00512"></a>00512       this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.removeEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, addressBarHidden);
<a name="l00513"></a>00513     }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>);
<a name="l00514"></a>00514     this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.addEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, addressBarHidden);
<a name="l00515"></a>00515     this.addressBarState = this.TRANSITIONING;
<a name="l00516"></a>00516     this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.classList.add(<span class="stringliteral">&#39;expanded&#39;</span>);
<a name="l00517"></a>00517     this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.clientTop;
<a name="l00518"></a>00518     this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.classList.add(<span class="stringliteral">&#39;address-hidden&#39;</span>);
<a name="l00519"></a>00519   },
<a name="l00520"></a>00520 
<a name="l00521"></a>00521   showAddressBar: <span class="keyword">function</span> browser_showAddressBar() {
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (this.addressBarState === this.VISIBLE ||
<a name="l00523"></a>00523         this.addressBarState === this.TRANSITIONING) {
<a name="l00524"></a>00524       <span class="keywordflow">return</span>;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527     var addressBarVisible = (<span class="keyword">function</span> browser_addressBarVisible() {
<a name="l00528"></a>00528       this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.classList.remove(<span class="stringliteral">&#39;expanded&#39;</span>);
<a name="l00529"></a>00529       this.addressBarState = this.VISIBLE;
<a name="l00530"></a>00530       this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.removeEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, addressBarVisible);
<a name="l00531"></a>00531     }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>);
<a name="l00532"></a>00532     this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.addEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, addressBarVisible);
<a name="l00533"></a>00533     this.addressBarState = this.TRANSITIONING;
<a name="l00534"></a>00534     this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.clientTop;
<a name="l00535"></a>00535     this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.classList.remove(<span class="stringliteral">&#39;address-hidden&#39;</span>);
<a name="l00536"></a>00536   },
<a name="l00537"></a>00537 
<a name="l00538"></a>00538   handleUrlInputKeypress: <span class="keyword">function</span> browser_handleUrlInputKeypress(evt) {
<a name="l00539"></a>00539     var <a class="code" href="../../d6/da7/wire__format__lite_8h.html#a2965939d8d22ec60c89f74062f0c370c">input</a> = this.urlInput.value;
<a name="l00540"></a>00540     <a class="code" href="../../d5/d7e/awesomescreen_8js.html#a2d725ab043526df3d05cc057e330f721">Awesomescreen</a>.update(input);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (input === <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00543"></a>00543       this.setUrlButtonMode(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>);
<a name="l00544"></a>00544       <span class="keywordflow">return</span>;
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     this.setUrlButtonMode(
<a name="l00548"></a>00548       <a class="code" href="../../d6/d5e/utilities_8js.html#af089147935d3cf3c8c91e5fb7113d387">UrlHelper</a>.isNotURL(input) ? this.SEARCH : this.GO
<a name="l00549"></a>00549     );
<a name="l00550"></a>00550   },
<a name="l00551"></a>00551 
<a name="l00552"></a>00552   showCrashScreen: <span class="keyword">function</span> browser_showCrashScreen() {
<a name="l00553"></a>00553     this.crashscreen.style.display = <span class="stringliteral">&#39;block&#39;</span>;
<a name="l00554"></a>00554   },
<a name="l00555"></a>00555 
<a name="l00556"></a>00556   hideCrashScreen: <span class="keyword">function</span> browser_hideCrashScreen() {
<a name="l00557"></a>00557     this.crashscreen.style.display = <span class="stringliteral">&#39;none&#39;</span>;
<a name="l00558"></a>00558   },
<a name="l00559"></a>00559 
<a name="l00560"></a>00560   handleCrashedTab: <span class="keyword">function</span> browser_handleCrashedTab(tab) {
<a name="l00561"></a>00561     <span class="comment">// No need to show the crash screen for background tabs,</span>
<a name="l00562"></a>00562     <span class="comment">// they will be revived when selected</span>
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (tab.id === <span class="keyword">this</span>.currentTab.id &amp;&amp; !<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.hidden) {
<a name="l00564"></a>00564       this.showCrashScreen();
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566     tab.loading = <span class="keyword">false</span>;
<a name="l00567"></a>00567     tab.crashed = <span class="keyword">true</span>;
<a name="l00568"></a>00568     <a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.clear(tab.id);
<a name="l00569"></a>00569     <a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.clear(tab.id);
<a name="l00570"></a>00570     this.<a class="code" href="../../d8/df0/frames_8js.html#aa4b20d1ccb4713cd1de75d236b5e9211">frames</a>.removeChild(tab.dom);
<a name="l00571"></a>00571     <span class="keyword">delete</span> tab.dom;
<a name="l00572"></a>00572     <span class="keyword">delete</span> tab.screenshot;
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (this.currentScreen === this.TABS_SCREEN) {
<a name="l00574"></a>00574       this.showTabScreen();
<a name="l00575"></a>00575     }
<a name="l00576"></a>00576   },
<a name="l00577"></a>00577 
<a name="l00578"></a>00578   handleVisibilityChange: <span class="keyword">function</span> browser_handleVisibilityChange() {
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.hidden &amp;&amp; <span class="keyword">this</span>.currentTab.crashed)
<a name="l00580"></a>00580       this.reviveCrashedTab(this.currentTab);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582     <span class="comment">// Bug 845661 - Attention screen does not appears when</span>
<a name="l00583"></a>00583     <span class="comment">// the url bar input is focused.</span>
<a name="l00584"></a>00584     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.hidden) {
<a name="l00585"></a>00585       this.urlInput.blur();
<a name="l00586"></a>00586       this.currentTab.dom.blur();
<a name="l00587"></a>00587     }
<a name="l00588"></a>00588   },
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   reviveCrashedTab: <span class="keyword">function</span> browser_reviveCrashedTab(tab) {
<a name="l00591"></a>00591     this.createTab(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>, <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>, tab);
<a name="l00592"></a>00592     this.setTabVisibility(tab, <span class="keyword">true</span>);
<a name="l00593"></a>00593     <a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>.refreshButtons();
<a name="l00594"></a>00594     this.navigate(tab.url);
<a name="l00595"></a>00595     tab.crashed = <span class="keyword">false</span>;
<a name="l00596"></a>00596     this.hideCrashScreen();
<a name="l00597"></a>00597   },
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   handleWindowOpen: <span class="keyword">function</span> browser_handleWindowOpen(evt) {
<a name="l00600"></a>00600     var <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a> = evt.detail.url;
<a name="l00601"></a>00601     var frame = evt.detail.frameElement;
<a name="l00602"></a>00602     var tab = this.createTab(url, frame);
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     this.hideCurrentTab();
<a name="l00605"></a>00605     this.selectTab(tab);
<a name="l00606"></a>00606     <span class="comment">// The frame will already be loading once we receive it, which</span>
<a name="l00607"></a>00607     <span class="comment">// means we need to assume it is loading</span>
<a name="l00608"></a>00608     this.currentTab.loading = <span class="keyword">true</span>;
<a name="l00609"></a>00609     this.setTabVisibility(this.currentTab, <span class="keyword">true</span>);
<a name="l00610"></a>00610     this.updateTabsCount();
<a name="l00611"></a>00611   },
<a name="l00612"></a>00612 
<a name="l00613"></a>00613   handleWindowClose: <span class="keyword">function</span> browser_handleWindowClose(tabId) {
<a name="l00614"></a>00614     <span class="keywordflow">if</span> (!tabId)
<a name="l00615"></a>00615       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     this.deleteTab(tabId);
<a name="l00618"></a>00618     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00619"></a>00619   },
<a name="l00620"></a>00620 
<a name="l00621"></a>00621   updateTabsCount: <span class="keyword">function</span> browser_updateTabsCount() {
<a name="l00622"></a>00622     this.tabsBadge.innerHTML = Object.keys(this.tabs).length +
<a name="l00623"></a>00623       <span class="stringliteral">&#39;&lt;span id=&quot;more-tabs&quot;&gt;&amp;#x203A;&lt;/span&gt;&#39;</span>;
<a name="l00624"></a>00624   },
<a name="l00625"></a>00625 
<a name="l00626"></a>00626   updateSecurityIcon: <span class="keyword">function</span> browser_updateSecurityIcon() {
<a name="l00627"></a>00627     <span class="keywordflow">if</span> (!this.currentTab.security) {
<a name="l00628"></a>00628       this.sslIndicator.value = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00629"></a>00629       <span class="keywordflow">return</span>;
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631     this.sslIndicator.value = this.currentTab.security.state;
<a name="l00632"></a>00632   },
<a name="l00633"></a>00633 
<a name="l00634"></a>00634   navigate: <span class="keyword">function</span> browser_navigate(<a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>) {
<a name="l00635"></a>00635     this.hideStartscreen();
<a name="l00636"></a>00636     this.showPageScreen();
<a name="l00637"></a>00637     this.currentTab.title = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00638"></a>00638     this.currentTab.url = <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>;
<a name="l00639"></a>00639     this.currentTab.dom.setAttribute(<span class="stringliteral">&#39;src&#39;</span>, <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>);
<a name="l00640"></a>00640     this.setUrlBar(<a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>);
<a name="l00641"></a>00641   },
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   getUrlFromInput: <span class="keyword">function</span> browser_getUrlFromInput(input) {
<a name="l00644"></a>00644     var hasScheme = !!(<a class="code" href="../../d6/d52/js_2browser_8js.html#a9dd8177744f47621e365cae274f7d5eb">rscheme</a>.exec(input) || [])[0];
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="comment">// Not a valid URL, could be a search term</span>
<a name="l00647"></a>00647     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d5e/utilities_8js.html#af089147935d3cf3c8c91e5fb7113d387">UrlHelper</a>.isNotURL(input) &amp;&amp; this.searchEngine.uri) {
<a name="l00648"></a>00648       var <a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a> = this.searchEngine.uri.replace(<span class="stringliteral">&#39;{searchTerms}&#39;</span>, input);
<a name="l00649"></a>00649       <span class="keywordflow">return</span> <a class="code" href="../../d9/d04/expat_8h.html#a5a9fdd6c2606370ad12f24c078ac6585">uri</a>;
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="comment">// No scheme, prepend basic protocol and return</span>
<a name="l00653"></a>00653     <span class="keywordflow">if</span> (!hasScheme) {
<a name="l00654"></a>00654       <span class="keywordflow">return</span> <span class="stringliteral">&#39;http://&#39;</span> + <a class="code" href="../../d6/da7/wire__format__lite_8h.html#a2965939d8d22ec60c89f74062f0c370c">input</a>;
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keywordflow">return</span> <a class="code" href="../../d6/da7/wire__format__lite_8h.html#a2965939d8d22ec60c89f74062f0c370c">input</a>;
<a name="l00658"></a>00658   },
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   handleUrlFormSubmit: <span class="keyword">function</span> browser_handleUrlFormSubmit(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00662"></a>00662       <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665     <span class="keywordflow">if</span> (this.urlButtonMode === <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>) {
<a name="l00666"></a>00666       <span class="keywordflow">return</span>;
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <span class="keywordflow">if</span> (this.urlButtonMode == this.REFRESH &amp;&amp; this.currentTab.crashed) {
<a name="l00671"></a>00671       this.setUrlBar(this.currentTab.url);
<a name="l00672"></a>00672       this.reviveCrashedTab(this.currentTab);
<a name="l00673"></a>00673       <span class="keywordflow">return</span>;
<a name="l00674"></a>00674     }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (this.urlButtonMode == this.REFRESH &amp;&amp; !this.currentTab.crashed) {
<a name="l00677"></a>00677       <span class="comment">// https://bugzilla.mozilla.org/show_bug.cgi?id=829616</span>
<a name="l00678"></a>00678       <span class="comment">// Switch the hard-reload to soft-reload since hard-reload still has</span>
<a name="l00679"></a>00679       <span class="comment">// some issue to be fix (bug 831153).</span>
<a name="l00680"></a>00680       this.currentTab.dom.reload(<span class="keyword">false</span>);
<a name="l00681"></a>00681       <span class="keywordflow">return</span>;
<a name="l00682"></a>00682     }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (this.urlButtonMode == this.STOP &amp;&amp; !this.currentTab.crashed) {
<a name="l00685"></a>00685       this.currentTab.dom.stop();
<a name="l00686"></a>00686       <span class="keywordflow">return</span>;
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     var <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a> = this.getUrlFromInput(this.urlInput.value);
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     <span class="keywordflow">if</span> (url !== this.currentTab.url) {
<a name="l00692"></a>00692       this.setUrlBar(url);
<a name="l00693"></a>00693       this.currentTab.url = <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>;
<a name="l00694"></a>00694     }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     this.urlInput.blur();
<a name="l00697"></a>00697 
<a name="l00698"></a>00698     <span class="keywordflow">if</span> (this.currentTab.crashed) {
<a name="l00699"></a>00699       this.reviveCrashedTab(this.currentTab);
<a name="l00700"></a>00700       <span class="keywordflow">return</span>;
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     this.navigate(url);
<a name="l00704"></a>00704   },
<a name="l00705"></a>00705 
<a name="l00706"></a>00706   goBack: <span class="keyword">function</span> browser_goBack() {
<a name="l00707"></a>00707     this.currentTab.dom.goBack();
<a name="l00708"></a>00708   },
<a name="l00709"></a>00709 
<a name="l00710"></a>00710   goForward: <span class="keyword">function</span> browser_goForward() {
<a name="l00711"></a>00711     this.currentTab.dom.goForward();
<a name="l00712"></a>00712   },
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   addBookmark: <span class="keyword">function</span> browser_addBookmark(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00715"></a>00715     <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l00716"></a>00716     <span class="keywordflow">if</span> (!this.currentTab.url)
<a name="l00717"></a>00717       <span class="keywordflow">return</span>;
<a name="l00718"></a>00718     <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.addBookmark(this.currentTab.url, <span class="keyword">this</span>.currentTab.title,
<a name="l00719"></a>00719       <a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>.refreshBookmarkButton.bind(<a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>));
<a name="l00720"></a>00720     this.hideBookmarkMenu();
<a name="l00721"></a>00721   },
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   removeBookmark: <span class="keyword">function</span> browser_removeBookmark(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00724"></a>00724     <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l00725"></a>00725     <span class="keywordflow">if</span> (!this.bookmarkMenuRemove.dataset.url)
<a name="l00726"></a>00726       <span class="keywordflow">return</span>;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.removeBookmark(this.bookmarkMenuRemove.dataset.url,
<a name="l00729"></a>00729       <span class="keyword">function</span>() {
<a name="l00730"></a>00730         <a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>.refreshBookmarkButton();
<a name="l00731"></a>00731         <a class="code" href="../../d5/d7e/awesomescreen_8js.html#a2d725ab043526df3d05cc057e330f721">Awesomescreen</a>.refreshBookmarks();
<a name="l00732"></a>00732     });
<a name="l00733"></a>00733     this.hideBookmarkMenu();
<a name="l00734"></a>00734   },
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <span class="comment">// responsible to show the specific action menu</span>
<a name="l00737"></a>00737   showActionMenu: <span class="keyword">function</span> browser_showActionMenu(url, from) {
<a name="l00738"></a>00738       <span class="keywordflow">if</span> (!url)
<a name="l00739"></a>00739         <span class="keywordflow">return</span>;
<a name="l00740"></a>00740       this.bookmarkMenu.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00741"></a>00741       <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.getBookmark(url, (<span class="keyword">function</span>(bookmark) {
<a name="l00742"></a>00742         <span class="keywordflow">if</span> (bookmark) {
<a name="l00743"></a>00743           <span class="keywordflow">if</span> (from &amp;&amp; from === <span class="stringliteral">&#39;bookmarksTab&#39;</span>) { <span class="comment">//show actions in bookmark tab</span>
<a name="l00744"></a>00744 
<a name="l00745"></a>00745             this.bookmarkMenuAdd.parentNode.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00746"></a>00746             <span class="comment">//append url to button&#39;s dataset</span>
<a name="l00747"></a>00747             this.bookmarkMenuRemove.dataset.url = <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>;
<a name="l00748"></a>00748             this.bookmarkMenuRemove.parentNode.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00749"></a>00749             <span class="comment">//XXX not implement yet: edit bookmark in bookmarktab #838041</span>
<a name="l00750"></a>00750             this.bookmarkMenuEdit.parentNode.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00751"></a>00751             <span class="comment">//XXX not implement yet: link to home in bookmarktab #850999</span>
<a name="l00752"></a>00752             this.bookmarkMenuAddHome.parentNode.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00753"></a>00753 
<a name="l00754"></a>00754           } <span class="keywordflow">else</span> { <span class="comment">//show actions in browser page</span>
<a name="l00755"></a>00755 
<a name="l00756"></a>00756             this.bookmarkMenuAdd.parentNode.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00757"></a>00757             this.bookmarkMenuRemove.dataset.url = <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>;
<a name="l00758"></a>00758             this.bookmarkMenuRemove.parentNode.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00759"></a>00759             this.bookmarkMenuEdit.dataset.url = <a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>;
<a name="l00760"></a>00760             this.bookmarkMenuEdit.parentNode.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00761"></a>00761             <span class="comment">//XXX not implement yet: link to home in bookmarktab #850999</span>
<a name="l00762"></a>00762             this.bookmarkMenuAddHome.parentNode.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00763"></a>00763 
<a name="l00764"></a>00764           }
<a name="l00765"></a>00765         } <span class="keywordflow">else</span> { <span class="comment">//show actions in browser page</span>
<a name="l00766"></a>00766 
<a name="l00767"></a>00767           this.bookmarkMenuAdd.parentNode.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00768"></a>00768           this.bookmarkMenuRemove.parentNode.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00769"></a>00769           this.bookmarkMenuEdit.parentNode.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00770"></a>00770           <span class="comment">//XXX not implement yet: link to home in bookmarktab #850999</span>
<a name="l00771"></a>00771           this.bookmarkMenuAddHome.parentNode.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00772"></a>00772 
<a name="l00773"></a>00773         }
<a name="l00774"></a>00774       }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>));
<a name="l00775"></a>00775   },
<a name="l00776"></a>00776 
<a name="l00777"></a>00777   <span class="comment">// Adaptor to show menu while press bookmark star</span>
<a name="l00778"></a>00778   showBookmarkMenu: <span class="keyword">function</span> browser_showBookmarkMenu() {
<a name="l00779"></a>00779     this.showActionMenu(this.currentTab.url);
<a name="l00780"></a>00780   },
<a name="l00781"></a>00781 
<a name="l00782"></a>00782   <span class="comment">// Adaptor to show menu while longpress in bookmark tab</span>
<a name="l00783"></a>00783   showBookmarkTabContextMenu: <span class="keyword">function</span> browser_showBookmarkTabContextMenu(url) {
<a name="l00784"></a>00784     this.showActionMenu(url, <span class="stringliteral">&#39;bookmarksTab&#39;</span>);
<a name="l00785"></a>00785   },
<a name="l00786"></a>00786 
<a name="l00787"></a>00787   hideBookmarkMenu: <span class="keyword">function</span> browser_hideBookmarkMenu() {
<a name="l00788"></a>00788     this.bookmarkMenu.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00789"></a>00789   },
<a name="l00790"></a>00790 
<a name="l00791"></a>00791   showBookmarkEntrySheet: <span class="keyword">function</span> browser_showBookmarkEntrySheet() {
<a name="l00792"></a>00792     <span class="keywordflow">if</span> (!this.currentTab.url)
<a name="l00793"></a>00793       <span class="keywordflow">return</span>;
<a name="l00794"></a>00794     this.hideBookmarkMenu();
<a name="l00795"></a>00795     this.bookmarkEntrySheet.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00796"></a>00796     <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.getBookmark(this.currentTab.url, (<span class="keyword">function</span>(bookmark) {
<a name="l00797"></a>00797       <a class="code" href="../../d6/d52/js_2browser_8js.html#a7321fd84345f4f9455f25996b932b8fd">if</a> (!bookmark) {
<a name="l00798"></a>00798         this.hideBookmarkEntrySheet();
<a name="l00799"></a>00799         <span class="keywordflow">return</span>;
<a name="l00800"></a>00800       }
<a name="l00801"></a>00801       this.bookmarkTitle.value = bookmark.title;
<a name="l00802"></a>00802       this.bookmarkUrl.value = bookmark.uri;
<a name="l00803"></a>00803       this.bookmarkPreviousUrl.value = bookmark.uri;
<a name="l00804"></a>00804     }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>));
<a name="l00805"></a>00805   },
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   hideBookmarkEntrySheet: <span class="keyword">function</span> browser_hideBookmarkEntrySheet() {
<a name="l00808"></a>00808     this.bookmarkEntrySheet.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l00809"></a>00809     this.bookmarkTitle.value = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00810"></a>00810     this.bookmarkUrl.value = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00811"></a>00811     this.bookmarkPreviousUrl.value = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00812"></a>00812   },
<a name="l00813"></a>00813 
<a name="l00814"></a>00814   saveBookmark: <span class="keyword">function</span> browser_saveBookmark() {
<a name="l00815"></a>00815     var url = this.bookmarkUrl.value;
<a name="l00816"></a>00816     var <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa5a506cf1e53b91549e35a5d3bc3dc06">title</a> = this.bookmarkTitle.value;
<a name="l00817"></a>00817     var previousUrl = this.bookmarkPreviousUrl.value;
<a name="l00818"></a>00818     <span class="keywordflow">if</span> (url != previousUrl) {
<a name="l00819"></a>00819       <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.removeBookmark(previousUrl,
<a name="l00820"></a>00820         <a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>.refreshBookmarkButton.bind(<a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>));
<a name="l00821"></a>00821       <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.updateBookmark(url, title);
<a name="l00822"></a>00822     } <span class="keywordflow">else</span> {
<a name="l00823"></a>00823       <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.updateBookmark(url, title);
<a name="l00824"></a>00824     }
<a name="l00825"></a>00825     this.hideBookmarkEntrySheet();
<a name="l00826"></a>00826   },
<a name="l00827"></a>00827 
<a name="l00828"></a>00828   addLinkToHome: <span class="keyword">function</span> browser_addLinkToHome() {
<a name="l00829"></a>00829     <span class="keywordflow">if</span> (!this.currentTab.url)
<a name="l00830"></a>00830       <span class="keywordflow">return</span>;
<a name="l00831"></a>00831 
<a name="l00832"></a>00832     <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.getPlace(this.currentTab.url, (<span class="keyword">function</span>(place) {
<a name="l00833"></a>00833       <span class="keyword">new</span> <a class="code" href="../../d0/dfb/namespacemozilla_1_1dom_1_1prototypes_1_1id.html#addcec93baff9084aadf2519231ea4a28ab7e07971d28f2ebf8ff15ee0f268f2e1">MozActivity</a>({
<a name="l00834"></a>00834         <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: <span class="stringliteral">&#39;save-bookmark&#39;</span>,
<a name="l00835"></a>00835         <a class="code" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>: {
<a name="l00836"></a>00836           <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>: <span class="stringliteral">&#39;url&#39;</span>,
<a name="l00837"></a>00837           url: this.currentTab.url,
<a name="l00838"></a>00838           <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: this.currentTab.title,
<a name="l00839"></a>00839           icon: place.iconUri,
<a name="l00840"></a>00840           useAsyncPanZoom: <span class="keyword">true</span>
<a name="l00841"></a>00841         }
<a name="l00842"></a>00842       });
<a name="l00843"></a>00843     }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>));
<a name="l00844"></a>00844     this.hideBookmarkMenu();
<a name="l00845"></a>00845   },
<a name="l00846"></a>00846 
<a name="l00847"></a>00847   updateHistory: <span class="keyword">function</span> browser_updateHistory(url) {
<a name="l00848"></a>00848     <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.addVisit(url);
<a name="l00849"></a>00849     <a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>.refreshButtons();
<a name="l00850"></a>00850   },
<a name="l00851"></a>00851 
<a name="l00852"></a>00852   shouldFocus: <span class="keyword">false</span>,
<a name="l00853"></a>00853 
<a name="l00854"></a>00854   urlMouseUp: <span class="keyword">function</span> browser_urlMouseUp(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00855"></a>00855     <span class="keywordflow">if</span> (this.shouldFocus) {
<a name="l00856"></a>00856       <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l00857"></a>00857       this.urlInput.focus();
<a name="l00858"></a>00858       this.urlInput.select();
<a name="l00859"></a>00859       this.shouldFocus = <span class="keyword">false</span>;
<a name="l00860"></a>00860     }
<a name="l00861"></a>00861   },
<a name="l00862"></a>00862 
<a name="l00863"></a>00863   urlFocus: <span class="keyword">function</span> browser_urlFocus(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00864"></a>00864     <span class="comment">// Hack to make integration tests pass, see bug 912150</span>
<a name="l00865"></a>00865     <span class="keywordflow">if</span> (this.urlBar.classList.contains(<span class="stringliteral">&#39;focus&#39;</span>))
<a name="l00866"></a>00866       <span class="keywordflow">return</span>;
<a name="l00867"></a>00867     this.urlBar.classList.add(<span class="stringliteral">&#39;focus&#39;</span>);
<a name="l00868"></a>00868     <span class="keywordflow">if</span> (this.currentScreen === this.PAGE_SCREEN) {
<a name="l00869"></a>00869       this.urlInput.value = this.currentTab.url;
<a name="l00870"></a>00870       this.sslIndicator.value = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00871"></a>00871       this.setUrlBar(this.currentTab.url);
<a name="l00872"></a>00872       <a class="code" href="../../d5/d7e/awesomescreen_8js.html#a2d725ab043526df3d05cc057e330f721">Awesomescreen</a>.show();
<a name="l00873"></a>00873       this.shouldFocus = <span class="keyword">true</span>;
<a name="l00874"></a>00874     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this.currentScreen === this.AWESOME_SCREEN) {
<a name="l00875"></a>00875       this.shouldFocus = <span class="keyword">true</span>;
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877   },
<a name="l00878"></a>00878 
<a name="l00879"></a>00879   urlBlur: <span class="keyword">function</span> browser_urlBlur() {
<a name="l00880"></a>00880     this.urlBar.classList.remove(<span class="stringliteral">&#39;focus&#39;</span>);
<a name="l00881"></a>00881   },
<a name="l00882"></a>00882 
<a name="l00883"></a>00883   setUrlBar: <span class="keyword">function</span> browser_setUrlBar(<a class="code" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>) {
<a name="l00884"></a>00884     this.urlInput.value = <a class="code" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>;
<a name="l00885"></a>00885   },
<a name="l00886"></a>00886 
<a name="l00887"></a>00887   setUrlButtonMode: <span class="keyword">function</span> browser_setUrlButtonMode(<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a>) {
<a name="l00888"></a>00888     this.urlButtonMode = <a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a>;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     <span class="keywordflow">if</span> (this.urlButtonMode === <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>) {
<a name="l00891"></a>00891       this.urlButton.style.backgroundImage = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00892"></a>00892       this.urlButton.style.display = <span class="stringliteral">&#39;none&#39;</span>;
<a name="l00893"></a>00893       <span class="keywordflow">return</span>;
<a name="l00894"></a>00894     }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     this.urlButton.style.display = <span class="stringliteral">&#39;block&#39;</span>;
<a name="l00897"></a>00897 
<a name="l00898"></a>00898     <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a>) {
<a name="l00899"></a>00899       <span class="keywordflow">case</span> this.GO:
<a name="l00900"></a>00900         this.urlButton.style.backgroundImage = <span class="stringliteral">&#39;url(style/images/go.png)&#39;</span>;
<a name="l00901"></a>00901         <span class="keywordflow">break</span>;
<a name="l00902"></a>00902       <span class="keywordflow">case</span> this.REFRESH:
<a name="l00903"></a>00903         this.urlButton.style.backgroundImage = <span class="stringliteral">&#39;url(style/images/refresh.png)&#39;</span>;
<a name="l00904"></a>00904         <span class="keywordflow">break</span>;
<a name="l00905"></a>00905       <span class="keywordflow">case</span> this.STOP:
<a name="l00906"></a>00906         this.urlButton.style.backgroundImage = <span class="stringliteral">&#39;url(style/images/stop.png)&#39;</span>;
<a name="l00907"></a>00907         <span class="keywordflow">break</span>;
<a name="l00908"></a>00908       <span class="keywordflow">case</span> this.SEARCH:
<a name="l00909"></a>00909         this.urlButton.style.backgroundImage = <span class="stringliteral">&#39;url(style/images/search.png)&#39;</span>;
<a name="l00910"></a>00910         <span class="keywordflow">break</span>;
<a name="l00911"></a>00911     }
<a name="l00912"></a>00912   },
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   openInNewTab: <span class="keyword">function</span> browser_openInNewTab(url) {
<a name="l00915"></a>00915     this.createTab(url);
<a name="l00916"></a>00916     this.updateTabsCount();
<a name="l00917"></a>00917   },
<a name="l00918"></a>00918 
<a name="l00919"></a>00919   <span class="comment">// Saves a media file to device storage.</span>
<a name="l00920"></a>00920   saveMedia: <span class="keyword">function</span> browser_saveMedia(url, <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>) {
<a name="l00921"></a>00921     <span class="keyword">function</span> displayMessage(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>) {
<a name="l00922"></a>00922       var <a class="code" href="../../da/da1/communications_2contacts_2js_2utilities_2status_8js.html#a0818854fd36b9ae0fdfe5872464dae94">status</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementById(<span class="stringliteral">&#39;save-media-status&#39;</span>);
<a name="l00923"></a>00923       status.firstElementChild.textContent = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l00924"></a>00924       status.classList.add(<span class="stringliteral">&#39;visible&#39;</span>);
<a name="l00925"></a>00925       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.setTimeout(<span class="keyword">function</span>() {
<a name="l00926"></a>00926         status.classList.remove(<span class="stringliteral">&#39;visible&#39;</span>);
<a name="l00927"></a>00927       }, 3000);
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930     <span class="keyword">function</span> storeBlob(blob, <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>, retryCount) {
<a name="l00931"></a>00931       <span class="comment">/*</span>
<a name="l00932"></a>00932 <span class="comment">       * XXX: Bug 852864 - DeviceStorage addNamed failed with TypeMismatchError</span>
<a name="l00933"></a>00933 <span class="comment">       * 3gp and ogg types of audio files are returned as blobs of video type.</span>
<a name="l00934"></a>00934 <span class="comment">       * The workaround here is saving the blob to corresponding storage based</span>
<a name="l00935"></a>00935 <span class="comment">       * on the type of it instead of the type specified by users. Which allows</span>
<a name="l00936"></a>00936 <span class="comment">       * users able to save those types of audio files.</span>
<a name="l00937"></a>00937 <span class="comment">       */</span>
<a name="l00938"></a>00938       var storageTypeMap = {
<a name="l00939"></a>00939         <span class="stringliteral">&#39;image&#39;</span>: <span class="stringliteral">&#39;pictures&#39;</span>,
<a name="l00940"></a>00940         <span class="stringliteral">&#39;video&#39;</span>: <span class="stringliteral">&#39;videos&#39;</span>,
<a name="l00941"></a>00941         <span class="stringliteral">&#39;audio&#39;</span>: <span class="stringliteral">&#39;music&#39;</span>
<a name="l00942"></a>00942       };
<a name="l00943"></a>00943       var blobType = blob.type.split(<span class="charliteral">&#39;/&#39;</span>)[0];
<a name="l00944"></a>00944       var storageType = storageTypeMap[blobType];
<a name="l00945"></a>00945       <span class="keywordflow">if</span> (!storageType) {
<a name="l00946"></a>00946         displayMessage(<a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<span class="stringliteral">&#39;error-saving-&#39;</span> + <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>));
<a name="l00947"></a>00947         <span class="keywordflow">return</span>;
<a name="l00948"></a>00948       }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950       var storage = <a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.getDeviceStorage(storageType);
<a name="l00951"></a>00951       var addreq = storage.addNamed(blob, <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953       addreq.onsuccess = <span class="keyword">function</span>() {
<a name="l00954"></a>00954         displayMessage(<a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a> + <span class="stringliteral">&#39;-saved&#39;</span>));
<a name="l00955"></a>00955       };
<a name="l00956"></a>00956       addreq.onerror = <span class="keyword">function</span>() {
<a name="l00957"></a>00957         <span class="comment">// Prepend some always changing id and try to store again, but give up</span>
<a name="l00958"></a>00958         <span class="comment">// after MAX_SAVING_RETRIES retries.</span>
<a name="l00959"></a>00959         <span class="keywordflow">if</span> (addreq.error.name === <span class="stringliteral">&#39;NoModificationAllowedError&#39;</span> &amp;&amp;
<a name="l00960"></a>00960             retryCount !== Browser.MAX_SAVING_RETRIES) {
<a name="l00961"></a>00961           <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a> = Date.now() + <span class="charliteral">&#39;-&#39;</span> + <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>;
<a name="l00962"></a>00962           storeBlob(blob, <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>, retryCount + 1);
<a name="l00963"></a>00963         } <span class="keywordflow">else</span> {
<a name="l00964"></a>00964           displayMessage(<a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<span class="stringliteral">&#39;error-saving-&#39;</span> + <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>));
<a name="l00965"></a>00965         }
<a name="l00966"></a>00966       };
<a name="l00967"></a>00967     }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     var <a class="code" href="../../da/d84/openvideo_8js.html#a329f2008ea05312f90696aa4401250ed">xhr</a> = <span class="keyword">new</span> <a class="code" href="../../d0/dfb/namespacemozilla_1_1dom_1_1prototypes_1_1id.html#addcec93baff9084aadf2519231ea4a28a2619068a621e6b22d7995161b2cea021">XMLHttpRequest</a>({mozSystem: <span class="keyword">true</span>});
<a name="l00970"></a>00970     xhr.open(<span class="stringliteral">&#39;GET&#39;</span>, url, <span class="keyword">true</span>);
<a name="l00971"></a>00971     xhr.responseType = <span class="stringliteral">&#39;blob&#39;</span>;
<a name="l00972"></a>00972     xhr.onload = <span class="keyword">function</span> browser_mediaDataListener() {
<a name="l00973"></a>00973       <span class="keywordflow">if</span> (xhr.status !== 200 || !xhr.response) {
<a name="l00974"></a>00974         displayMessage(<a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<span class="stringliteral">&#39;error-saving-&#39;</span> + <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>));
<a name="l00975"></a>00975         <span class="keywordflow">return</span>;
<a name="l00976"></a>00976       }
<a name="l00977"></a>00977 
<a name="l00978"></a>00978       <span class="comment">// Save the blob to device storage.</span>
<a name="l00979"></a>00979       <span class="comment">// Extract a filename from the URL, and to some sanitizing.</span>
<a name="l00980"></a>00980       var <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a> = url.split(<span class="charliteral">&#39;/&#39;</span>).reverse()[0].toLowerCase().split(/[&amp;?#]/<a class="code" href="../../d8/dad/apps_2email_2js_2ext_2mailapi_2chewlayer_8js.html#a73c18c59a39b18382081ec00bb456d43">g</a>)[0]
<a name="l00981"></a>00981                     .replace(/[^a-z0-9\.]/<a class="code" href="../../d8/dad/apps_2email_2js_2ext_2mailapi_2chewlayer_8js.html#a73c18c59a39b18382081ec00bb456d43">g</a>, <span class="charliteral">&#39;_&#39;</span>);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983       <span class="comment">// If we have no file extension, use the content-type header to</span>
<a name="l00984"></a>00984       <span class="comment">// add one.</span>
<a name="l00985"></a>00985       var ext = <a class="code" href="../../de/d0b/build__stage_2email_2shared_2js_2mime__mapper_8js.html#a9b930e9b34b95fa32e6b47e7d2442a72">MimeMapper</a>.guessExtensionFromType(xhr.response.type);
<a name="l00986"></a>00986       <span class="keywordflow">if</span> (ext &amp;&amp; name.indexOf(ext) === -1) {
<a name="l00987"></a>00987         name += <span class="charliteral">&#39;.&#39;</span> + ext;
<a name="l00988"></a>00988       }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990       storeBlob(xhr.response, name, 0);
<a name="l00991"></a>00991     };
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     xhr.onerror = <span class="keyword">function</span> getDefaultDataError() {
<a name="l00994"></a>00994       displayMessage(<a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<span class="stringliteral">&#39;error-saving-&#39;</span> + <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>));
<a name="l00995"></a>00995     };
<a name="l00996"></a>00996     xhr.send();
<a name="l00997"></a>00997   },
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   <span class="comment">// This generates callbacks for context menu targets that have</span>
<a name="l01000"></a>01000   <span class="comment">// default actions attached</span>
<a name="l01001"></a>01001   generateSystemMenuItem: <span class="keyword">function</span> browser_generateSystemMenuItem(item) {
<a name="l01002"></a>01002     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l01003"></a>01003     var nodeName = item.nodeName ? item.nodeName.toUpperCase() : <span class="stringliteral">&#39;&#39;</span>;
<a name="l01004"></a>01004     <span class="keywordflow">switch</span> (nodeName) {
<a name="l01005"></a>01005       <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:
<a name="l01006"></a>01006         <span class="keywordflow">return</span> {
<a name="l01007"></a>01007           <span class="keywordtype">id</span>: <span class="stringliteral">&#39;open-in-new-tab&#39;</span>,
<a name="l01008"></a>01008           label: <a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<span class="stringliteral">&#39;open-in-new-tab&#39;</span>),
<a name="l01009"></a>01009           <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>: <span class="keyword">function</span>() {
<a name="l01010"></a>01010             <span class="keyword">self</span>.openInNewTab(item.data.uri);
<a name="l01011"></a>01011           }
<a name="l01012"></a>01012         };
<a name="l01013"></a>01013       <span class="keywordflow">case</span> <span class="stringliteral">&#39;IMG&#39;</span>:
<a name="l01014"></a>01014       <span class="keywordflow">case</span> <span class="stringliteral">&#39;VIDEO&#39;</span>:
<a name="l01015"></a>01015       <span class="keywordflow">case</span> <span class="stringliteral">&#39;AUDIO&#39;</span>:
<a name="l01016"></a>01016         var typeMap = {
<a name="l01017"></a>01017           <span class="stringliteral">&#39;IMG&#39;</span>: <span class="stringliteral">&#39;image&#39;</span>,
<a name="l01018"></a>01018           <span class="stringliteral">&#39;VIDEO&#39;</span>: <span class="stringliteral">&#39;video&#39;</span>,
<a name="l01019"></a>01019           <span class="stringliteral">&#39;AUDIO&#39;</span>: <span class="stringliteral">&#39;audio&#39;</span>
<a name="l01020"></a>01020         };
<a name="l01021"></a>01021         var <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a> = typeMap[item.nodeName];
<a name="l01022"></a>01022         <span class="keywordflow">if</span> (nodeName === <span class="stringliteral">&#39;VIDEO&#39;</span> &amp;&amp; !item.data.hasVideo) {
<a name="l01023"></a>01023           type = <span class="stringliteral">&#39;audio&#39;</span>;
<a name="l01024"></a>01024         }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026         <span class="keywordflow">return</span> {
<a name="l01027"></a>01027           label: <a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<span class="stringliteral">&#39;save-&#39;</span> + type),
<a name="l01028"></a>01028           <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>: <span class="keyword">function</span>() {
<a name="l01029"></a>01029             <span class="keyword">self</span>.saveMedia(item.data.uri, type);
<a name="l01030"></a>01030           }
<a name="l01031"></a>01031         };
<a name="l01032"></a>01032       <span class="keywordflow">default</span>:
<a name="l01033"></a>01033         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035   },
<a name="l01036"></a>01036 
<a name="l01037"></a>01037   showContextMenu: <span class="keyword">function</span> browser_showContextMenu(evt) {
<a name="l01038"></a>01038     var menuItems = [];
<a name="l01039"></a>01039     var menuData = evt.detail;
<a name="l01040"></a>01040     var <a class="code" href="../../d1/d04/app__install__manager_8js.html#a888e6068bf00699dfddf2b6ee25e6c7a">dialog</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;section&#39;</span>);
<a name="l01041"></a>01041     var menu = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;menu&#39;</span>);
<a name="l01042"></a>01042     var <a class="code" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l01043"></a>01043     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l01044"></a>01044     <span class="comment">// SystemTargets are default elements that have contextmenu</span>
<a name="l01045"></a>01045     <span class="comment">// actions associated</span>
<a name="l01046"></a>01046     evt.detail.systemTargets.forEach(<span class="keyword">function</span>(item) {
<a name="l01047"></a>01047       var <a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a4ef488940623c6d0eab866a64228de55">action</a> = this.generateSystemMenuItem(item);
<a name="l01048"></a>01048       <span class="keywordflow">if</span> (action) {
<a name="l01049"></a>01049         menuItems.push(action);
<a name="l01050"></a>01050       }
<a name="l01051"></a>01051     }, <span class="keyword">this</span>);
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     <span class="comment">// Content passes in a nested menu object to be displayed</span>
<a name="l01054"></a>01054     <span class="comment">// and expects &#39;contextMenuItemSelected&#39; to be called</span>
<a name="l01055"></a>01055     <span class="comment">// with the id of the selected menuitem</span>
<a name="l01056"></a>01056     var collectMenuItems = <span class="keyword">function</span>(menu) {
<a name="l01057"></a>01057       menu.items.forEach(<span class="keyword">function</span>(item) {
<a name="l01058"></a>01058         <span class="keywordflow">if</span> (item.type === <span class="stringliteral">&#39;menuitem&#39;</span>) {
<a name="l01059"></a>01059           menuItems.push({
<a name="l01060"></a>01060             icon: item.icon,
<a name="l01061"></a>01061             label: item.label,
<a name="l01062"></a>01062             <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>: <span class="keyword">function</span>() {
<a name="l01063"></a>01063               <span class="keyword">self</span>.contextMenuHasCalled = <span class="keyword">false</span>;
<a name="l01064"></a>01064               evt.detail.contextMenuItemSelected(item.id);
<a name="l01065"></a>01065             }
<a name="l01066"></a>01066           });
<a name="l01067"></a>01067         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (item.type === <span class="stringliteral">&#39;menu&#39;</span>) {
<a name="l01068"></a>01068           collectMenuItems(item);
<a name="l01069"></a>01069         }
<a name="l01070"></a>01070       });
<a name="l01071"></a>01071     };
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     <span class="keywordflow">if</span> (menuData.contextmenu) {
<a name="l01074"></a>01074       collectMenuItems(menuData.contextmenu);
<a name="l01075"></a>01075     }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <span class="keywordflow">if</span> (Object.keys(menuItems).length === 0) {
<a name="l01078"></a>01078       <span class="keyword">self</span>.contextMenuHasCalled = <span class="keyword">false</span>;
<a name="l01079"></a>01079       <span class="keywordflow">return</span>;
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     menuItems.forEach(<span class="keyword">function</span>(menuitem) {
<a name="l01083"></a>01083       var li = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;li&#39;</span>);
<a name="l01084"></a>01084       li.id = menuitem.id;
<a name="l01085"></a>01085       var <a class="code" href="../../d3/d4b/lockscreen_8js.html#a56a6742e738e925221d41ea45da5851d">button</a> = this.createButton(menuitem.label, menuitem.icon);
<a name="l01086"></a>01086 
<a name="l01087"></a>01087       button.addEventListener(<span class="stringliteral">&#39;click&#39;</span>, <span class="keyword">function</span>() {
<a name="l01088"></a>01088         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.removeChild(dialog);
<a name="l01089"></a>01089         menuitem.callback();
<a name="l01090"></a>01090       });
<a name="l01091"></a>01091 
<a name="l01092"></a>01092       li.appendChild(button);
<a name="l01093"></a>01093       list.appendChild(li);
<a name="l01094"></a>01094     }, <span class="keyword">this</span>);
<a name="l01095"></a>01095 
<a name="l01096"></a>01096     var <a class="code" href="../../dc/d35/inline-receiver_8js.html#a01de14b323a40639980004403daa8432">cancel</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;li&#39;</span>);
<a name="l01097"></a>01097     cancel.appendChild(this.createButton(<span class="stringliteral">&#39;Cancel&#39;</span>));
<a name="l01098"></a>01098     list.appendChild(cancel);
<a name="l01099"></a>01099 
<a name="l01100"></a>01100     cancel.addEventListener(<span class="stringliteral">&#39;click&#39;</span>, <span class="keyword">function</span>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01101"></a>01101       <span class="keyword">self</span>.contextMenuHasCalled = <span class="keyword">false</span>;
<a name="l01102"></a>01102       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.removeChild(dialog);
<a name="l01103"></a>01103     });
<a name="l01104"></a>01104 
<a name="l01105"></a>01105     menu.classList.add(<span class="stringliteral">&#39;actions&#39;</span>);
<a name="l01106"></a>01106     menu.appendChild(list);
<a name="l01107"></a>01107     dialog.setAttribute(<span class="stringliteral">&#39;role&#39;</span>, <span class="stringliteral">&#39;dialog&#39;</span>);
<a name="l01108"></a>01108     dialog.appendChild(menu);
<a name="l01109"></a>01109     <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.appendChild(dialog);
<a name="l01110"></a>01110   },
<a name="l01111"></a>01111 
<a name="l01112"></a>01112   createButton: <span class="keyword">function</span> browser_createButton(<a class="code" href="../../dd/dfa/classtext.html">text</a>, image) {
<a name="l01113"></a>01113     var button = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;button&#39;</span>);
<a name="l01114"></a>01114     var textNode = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createTextNode(<a class="code" href="../../dd/dfa/classtext.html">text</a>);
<a name="l01115"></a>01115     <span class="keywordflow">if</span> (image) {
<a name="l01116"></a>01116       var img = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;img&#39;</span>);
<a name="l01117"></a>01117       img.setAttribute(<span class="stringliteral">&#39;src&#39;</span>, image);
<a name="l01118"></a>01118       button.appendChild(img);
<a name="l01119"></a>01119     }
<a name="l01120"></a>01120     button.appendChild(textNode);
<a name="l01121"></a>01121     <span class="keywordflow">return</span> <a class="code" href="../../d3/d4b/lockscreen_8js.html#a56a6742e738e925221d41ea45da5851d">button</a>;
<a name="l01122"></a>01122   },
<a name="l01123"></a>01123 
<a name="l01124"></a>01124   followLink: <span class="keyword">function</span> browser_followLink(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01125"></a>01125     <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l01126"></a>01126     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target.nodeName === <span class="charliteral">&#39;A&#39;</span>) {
<a name="l01127"></a>01127       this.navigate(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target.getAttribute(<span class="stringliteral">&#39;href&#39;</span>));
<a name="l01128"></a>01128       this.hideStartscreen();
<a name="l01129"></a>01129     }
<a name="l01130"></a>01130   },
<a name="l01131"></a>01131 
<a name="l01132"></a>01132   setTabVisibility: <span class="keyword">function</span>(tab, <a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>) {
<a name="l01133"></a>01133     <span class="keywordflow">if</span> (!tab.dom)
<a name="l01134"></a>01134       <span class="keywordflow">return</span>;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.originHasEvent(tab.id)) {
<a name="l01137"></a>01137       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>) {
<a name="l01138"></a>01138         <a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.show(tab.id);
<a name="l01139"></a>01139       } <span class="keywordflow">else</span> {
<a name="l01140"></a>01140         <a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.hide();
<a name="l01141"></a>01141       }
<a name="l01142"></a>01142     }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     <span class="keywordflow">if</span> (<a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.originHasEvent(tab.id)) {
<a name="l01145"></a>01145       <span class="keywordflow">if</span> (<a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>) {
<a name="l01146"></a>01146         <a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.show(tab.id);
<a name="l01147"></a>01147       } <span class="keywordflow">else</span> {
<a name="l01148"></a>01148         <a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.hide();
<a name="l01149"></a>01149       }
<a name="l01150"></a>01150     }
<a name="l01151"></a>01151 
<a name="l01152"></a>01152     this.setVisibleWrapper(tab, <a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>);
<a name="l01153"></a>01153     var <a class="code" href="../../d2/d7d/jsapi_8h.html#aad848dcccd4ec008220ff05f5e400551">fun</a> = tab.loading ? <span class="stringliteral">&#39;add&#39;</span> : <span class="stringliteral">&#39;remove&#39;</span>;
<a name="l01154"></a>01154     this.throbber.classList[<a class="code" href="../../d2/d7d/jsapi_8h.html#aad848dcccd4ec008220ff05f5e400551">fun</a>](<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l01155"></a>01155     tab.dom.style.display = <a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a> ? <span class="stringliteral">&#39;block&#39;</span> : <span class="stringliteral">&#39;none&#39;</span>;
<a name="l01156"></a>01156     tab.dom.style.top = <span class="stringliteral">&#39;0px&#39;</span>;
<a name="l01157"></a>01157   },
<a name="l01158"></a>01158 
<a name="l01159"></a>01159   <span class="comment">// dom.setVisible is loaded asynchronously from BrowserElementChildPreload</span>
<a name="l01160"></a>01160   <span class="comment">// and may require a yield before we call it, we want to make sure to</span>
<a name="l01161"></a>01161   <span class="comment">// clear any previous call</span>
<a name="l01162"></a>01162   setVisibleWrapper: <span class="keyword">function</span>(tab, <a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>) {
<a name="l01163"></a>01163     <span class="keywordflow">if</span> (tab.setVisibleTimeout) {
<a name="l01164"></a>01164       <a class="code" href="../../da/da1/timers_8js.html#ab37ff0db33a3bf80b0163adc40a58424">clearTimeout</a>(tab.setVisibleTimeout);
<a name="l01165"></a>01165     }
<a name="l01166"></a>01166     <span class="keywordflow">if</span> (tab.dom.setVisible) {
<a name="l01167"></a>01167       tab.dom.setVisible(<a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>);
<a name="l01168"></a>01168       <span class="keywordflow">return</span>;
<a name="l01169"></a>01169     }
<a name="l01170"></a>01170     tab.setVisibleTimeout = <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(<span class="keyword">function</span>() {
<a name="l01171"></a>01171       <span class="keywordflow">if</span> (tab.dom.setVisible)
<a name="l01172"></a>01172         tab.dom.setVisible(<a class="code" href="../../d3/d4a/mock__recipients_8js.html#a6d342aea8f30c5f641ed5ff6e0f4de13">visible</a>);
<a name="l01173"></a>01173     });
<a name="l01174"></a>01174   },
<a name="l01175"></a>01175 
<a name="l01176"></a>01176   bindBrowserEvents: <span class="keyword">function</span> browser_bindBrowserEvents(iframe, tab) {
<a name="l01177"></a>01177     var browserEvents = [<span class="stringliteral">&#39;loadstart&#39;</span>, <span class="stringliteral">&#39;loadend&#39;</span>, <span class="stringliteral">&#39;locationchange&#39;</span>,
<a name="l01178"></a>01178                          <span class="stringliteral">&#39;titlechange&#39;</span>, <span class="stringliteral">&#39;iconchange&#39;</span>, <span class="stringliteral">&#39;contextmenu&#39;</span>,
<a name="l01179"></a>01179                          <span class="stringliteral">&#39;securitychange&#39;</span>, <span class="stringliteral">&#39;openwindow&#39;</span>, <span class="stringliteral">&#39;close&#39;</span>,
<a name="l01180"></a>01180                          <span class="stringliteral">&#39;showmodalprompt&#39;</span>, <span class="stringliteral">&#39;error&#39;</span>, <span class="stringliteral">&#39;asyncscroll&#39;</span>,
<a name="l01181"></a>01181                          <span class="stringliteral">&#39;usernameandpasswordrequired&#39;</span>];
<a name="l01182"></a>01182     browserEvents.forEach(<span class="keyword">function</span> attachBrowserEvent(type) {
<a name="l01183"></a>01183       iframe.addEventListener(<span class="stringliteral">&#39;mozbrowser&#39;</span> + type,
<a name="l01184"></a>01184                               this.handleBrowserEvent(tab));
<a name="l01185"></a>01185     }, <span class="keyword">this</span>);
<a name="l01186"></a>01186   },
<a name="l01187"></a>01187 
<a name="l01188"></a>01188   createTab: <span class="keyword">function</span> browser_createTab(url, iframe, tab) {
<a name="l01189"></a>01189     <span class="keywordflow">if</span> (!iframe) {
<a name="l01190"></a>01190       iframe = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;iframe&#39;</span>);
<a name="l01191"></a>01191       iframe.setAttribute(<span class="stringliteral">&#39;mozbrowser&#39;</span>, <span class="keyword">true</span>);
<a name="l01192"></a>01192       iframe.setAttribute(<span class="stringliteral">&#39;mozallowfullscreen&#39;</span>, <span class="keyword">true</span>);
<a name="l01193"></a>01193       iframe.classList.add(<span class="stringliteral">&#39;browser-tab&#39;</span>);
<a name="l01194"></a>01194 
<a name="l01195"></a>01195       <span class="keywordflow">if</span> (url) {
<a name="l01196"></a>01196         iframe.setAttribute(<span class="stringliteral">&#39;src&#39;</span>, url);
<a name="l01197"></a>01197       }
<a name="l01198"></a>01198     }
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     iframe.style.top = <span class="stringliteral">&#39;-9999px&#39;</span>;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     iframe.setAttribute(<span class="stringliteral">&#39;mozasyncpanzoom&#39;</span>, <span class="stringliteral">&#39;true&#39;</span>);
<a name="l01203"></a>01203     <span class="comment">// FIXME: content shouldn&#39;t control this directly</span>
<a name="l01204"></a>01204     iframe.setAttribute(<span class="stringliteral">&#39;remote&#39;</span>, <span class="stringliteral">&#39;true&#39;</span>);
<a name="l01205"></a>01205 
<a name="l01206"></a>01206     <span class="keywordflow">if</span> (tab) {
<a name="l01207"></a>01207       tab.dom = iframe;
<a name="l01208"></a>01208     } <span class="keywordflow">else</span> {
<a name="l01209"></a>01209       tab = {
<a name="l01210"></a>01210         <span class="keywordtype">id</span>: <span class="stringliteral">&#39;tab_&#39;</span> + this.tabCounter++,
<a name="l01211"></a>01211         <a class="code" href="../../da/dce/details__test_8js.html#a017102f866db15b37d9657454efde4ff">dom</a>: iframe,
<a name="l01212"></a>01212         url: url || <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01213"></a>01213         title: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01214"></a>01214         loading: <span class="keyword">false</span>,
<a name="l01215"></a>01215         screenshot: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01216"></a>01216         security: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>
<a name="l01217"></a>01217       };
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220     <span class="comment">// Default newly created frames to the background</span>
<a name="l01221"></a>01221     this.setVisibleWrapper(tab, <span class="keyword">false</span>);
<a name="l01222"></a>01222     this.bindBrowserEvents(iframe, tab);
<a name="l01223"></a>01223     this.tabs[tab.id] = tab;
<a name="l01224"></a>01224     this.<a class="code" href="../../d8/df0/frames_8js.html#aa4b20d1ccb4713cd1de75d236b5e9211">frames</a>.appendChild(iframe);
<a name="l01225"></a>01225     <span class="keywordflow">return</span> tab.id;
<a name="l01226"></a>01226   },
<a name="l01227"></a>01227 
<a name="l01228"></a>01228   deleteTab: <span class="keyword">function</span> browser_deleteTab(<span class="keywordtype">id</span>) {
<a name="l01229"></a>01229     var tabIds = Object.keys(this.tabs);
<a name="l01230"></a>01230     <span class="keywordflow">if</span> (this.tabs[<span class="keywordtype">id</span>].<a class="code" href="../../da/dce/details__test_8js.html#a017102f866db15b37d9657454efde4ff">dom</a>)
<a name="l01231"></a>01231       this.tabs[<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>].dom.parentNode.removeChild(this.tabs[<span class="keywordtype">id</span>].dom);
<a name="l01232"></a>01232     <span class="keyword">delete</span> this.tabs[<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>];
<a name="l01233"></a>01233     <a class="code" href="../../d9/d71/browser_2js_2modal__dialog_8js.html#a6c2683010fcedc7e3ba7d2193506f7d7">ModalDialog</a>.clear(<span class="keywordtype">id</span>);
<a name="l01234"></a>01234     <a class="code" href="../../d3/db2/browser_2js_2authentication__dialog_8js.html#a293b161aaffa7e445eb0d00785677525">AuthenticationDialog</a>.clear(<span class="keywordtype">id</span>);
<a name="l01235"></a>01235 
<a name="l01236"></a>01236     <span class="comment">// If that was the last tab, create a new one and show start screen</span>
<a name="l01237"></a>01237     <span class="keywordflow">if</span> (Object.keys(<span class="keyword">this</span>.tabs).length == 0) {
<a name="l01238"></a>01238       this.selectTab(this.createTab());
<a name="l01239"></a>01239       this.switchScreen(this.PAGE_SCREEN);
<a name="l01240"></a>01240       <span class="keywordflow">return</span>;
<a name="l01241"></a>01241     }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243     <span class="comment">// Otherwise, if closing current tab, switch to another one</span>
<a name="l01244"></a>01244     <span class="keywordflow">if</span> (this.currentTab &amp;&amp; this.currentTab.id === <span class="keywordtype">id</span>) {
<a name="l01245"></a>01245       <span class="comment">// The tab to be selected when the current one is deleted</span>
<a name="l01246"></a>01246       var newTab = tabIds.indexOf(<span class="keywordtype">id</span>);
<a name="l01247"></a>01247       <span class="keywordflow">if</span> (newTab === tabIds.length - 1) {
<a name="l01248"></a>01248         newTab -= 1;
<a name="l01249"></a>01249       }
<a name="l01250"></a>01250       this.selectTab(Object.keys(<span class="keyword">this</span>.tabs)[newTab]);
<a name="l01251"></a>01251     }
<a name="l01252"></a>01252   },
<a name="l01253"></a>01253 
<a name="l01254"></a>01254   <span class="comment">// Show a quick animation while creating a new tab to indicate</span>
<a name="l01255"></a>01255   <span class="comment">// that a new tab has been created</span>
<a name="l01256"></a>01256   showNewTabAnimation: <span class="keyword">function</span> browser_showNewTab(showTabCompleteFun) {
<a name="l01257"></a>01257     var ul = this.tabsList.childNodes[0];
<a name="l01258"></a>01258     var li = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;li&#39;</span>);
<a name="l01259"></a>01259     li.innerHTML = <span class="stringliteral">&#39;&lt;a&gt;&lt;img /&gt;&lt;span&gt;&#39;</span> + <a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<span class="stringliteral">&#39;new-tab&#39;</span>) + <span class="stringliteral">&#39;&lt;/span&gt;&lt;/a&gt;&#39;</span>;
<a name="l01260"></a>01260     li.style.height = <span class="stringliteral">&#39;0px&#39;</span>;
<a name="l01261"></a>01261     li.style.transition = <span class="stringliteral">&#39;height 0.2s ease-in&#39;</span>;
<a name="l01262"></a>01262     ul.insertBefore(li, ul.childNodes[0]);
<a name="l01263"></a>01263 
<a name="l01264"></a>01264     li.addEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, <span class="keyword">function</span>() {
<a name="l01265"></a>01265       <span class="comment">// Pause so the user has time to see the new tab</span>
<a name="l01266"></a>01266       <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(showTabCompleteFun, 100);
<a name="l01267"></a>01267     });
<a name="l01268"></a>01268 
<a name="l01269"></a>01269     <span class="comment">// Hack to force transition to apply synchronously</span>
<a name="l01270"></a>01270     <span class="comment">// http://lists.w3.org/Archives/Public/www-style/2011Mar/0729.html</span>
<a name="l01271"></a>01271     li.clientTop;
<a name="l01272"></a>01272     li.style.height = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01273"></a>01273   },
<a name="l01274"></a>01274 
<a name="l01275"></a>01275   hideCurrentTab: <span class="keyword">function</span> browser_hideCurrentTab() {
<a name="l01276"></a>01276     var tab = this.currentTab;
<a name="l01277"></a>01277     this.setTabVisibility(tab, <span class="keyword">false</span>);
<a name="l01278"></a>01278     this.throbber.classList.remove(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l01279"></a>01279   },
<a name="l01280"></a>01280 
<a name="l01281"></a>01281   selectTab: <span class="keyword">function</span> browser_selectTab(<span class="keywordtype">id</span>) {
<a name="l01282"></a>01282     this.currentTab = this.tabs[<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>];
<a name="l01283"></a>01283     <span class="comment">// If the tab crashed, bring it back to life</span>
<a name="l01284"></a>01284     <span class="keywordflow">if</span> (this.currentTab.crashed)
<a name="l01285"></a>01285       this.reviveCrashedTab(this.currentTab);
<a name="l01286"></a>01286     <span class="comment">// We may have picked a currently loading background tab</span>
<a name="l01287"></a>01287     <span class="comment">// that was positioned off screen</span>
<a name="l01288"></a>01288     this.setUrlBar(this.currentTab.title);
<a name="l01289"></a>01289     this.updateSecurityIcon();
<a name="l01290"></a>01290     <a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>.refreshButtons();
<a name="l01291"></a>01291     <span class="comment">// Show start screen if the tab hasn&#39;t been navigated</span>
<a name="l01292"></a>01292     <span class="keywordflow">if</span> (this.currentTab.url == <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>) {
<a name="l01293"></a>01293       this.showStartscreen();
<a name="l01294"></a>01294     } <span class="keywordflow">else</span> {
<a name="l01295"></a>01295       this.hideStartscreen();
<a name="l01296"></a>01296     }
<a name="l01297"></a>01297   },
<a name="l01298"></a>01298 
<a name="l01299"></a>01299   switchScreen: <span class="keyword">function</span> browser_switchScreen(<a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#a143b83738f9fab453e3116d14dfac0e7">screen</a>) {
<a name="l01300"></a>01300     <span class="keywordflow">if</span> (this.currentScreen === this.TABS_SCREEN) {
<a name="l01301"></a>01301       this.screenSwipeMngr.gestureDetector.stopDetecting();
<a name="l01302"></a>01302     }
<a name="l01303"></a>01303     <span class="keywordflow">if</span> (this.currentScreen !== <a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#a143b83738f9fab453e3116d14dfac0e7">screen</a>) {
<a name="l01304"></a>01304       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.classList.remove(this.currentScreen);
<a name="l01305"></a>01305       this.previousScreen = this.currentScreen;
<a name="l01306"></a>01306       this.currentScreen = <a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#a143b83738f9fab453e3116d14dfac0e7">screen</a>;
<a name="l01307"></a>01307       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.classList.add(this.currentScreen);
<a name="l01308"></a>01308     }
<a name="l01309"></a>01309   },
<a name="l01310"></a>01310 
<a name="l01311"></a>01311   showStartscreen: <span class="keyword">function</span> browser_showStartscreen() {
<a name="l01312"></a>01312     <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.classList.add(<span class="stringliteral">&#39;start-page&#39;</span>);
<a name="l01313"></a>01313     this.startscreen.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l01314"></a>01314     <a class="code" href="../../d1/d0b/browser__db_8js.html#a66e47ba7a7dafec6e99efcbd4e6e8d18">BrowserDB</a>.getTopSites(this.MAX_TOP_SITES, <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01315"></a>01315       <span class="keyword">function</span>(places) {
<a name="l01316"></a>01316       this.showTopSiteThumbnails(places);
<a name="l01317"></a>01317       this.loadRemaining();
<a name="l01318"></a>01318     }.bind(<span class="keyword">this</span>));
<a name="l01319"></a>01319     <a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>.bookmarkButton.classList.remove(<span class="stringliteral">&#39;bookmarked&#39;</span>);
<a name="l01320"></a>01320   },
<a name="l01321"></a>01321 
<a name="l01322"></a>01322   _topSiteThumbnailObjectURLs: [],
<a name="l01323"></a>01323   clearTopSiteThumbnails: <span class="keyword">function</span> browser_clearTopSiteThumbnails() {
<a name="l01324"></a>01324     this.topSiteThumbnails.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01325"></a>01325 
<a name="l01326"></a>01326     <span class="comment">// Revoke the object URLs so we don&#39;t leak their blobs.  (For some reason,</span>
<a name="l01327"></a>01327     <span class="comment">// you can&#39;t do forEach(URL.revokeObjectURL) -- that causes an exception.)</span>
<a name="l01328"></a>01328     this._topSiteThumbnailObjectURLs.forEach(<span class="keyword">function</span>(url) {
<a name="l01329"></a>01329       <a class="code" href="../../d6/dfe/class_u_r_l.html">URL</a>.revokeObjectURL(url);
<a name="l01330"></a>01330     });
<a name="l01331"></a>01331     this._topSiteThumbnailObjectURLs = [];
<a name="l01332"></a>01332   },
<a name="l01333"></a>01333 
<a name="l01334"></a>01334   hideStartscreen: <span class="keyword">function</span> browser_hideStartScreen() {
<a name="l01335"></a>01335     <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.classList.remove(<span class="stringliteral">&#39;start-page&#39;</span>);
<a name="l01336"></a>01336     this.startscreen.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l01337"></a>01337     this.clearTopSiteThumbnails();
<a name="l01338"></a>01338   },
<a name="l01339"></a>01339 
<a name="l01340"></a>01340   showTopSiteThumbnails: <span class="keyword">function</span> browser_showStartscreenThumbnails(places) {
<a name="l01341"></a>01341     this.clearTopSiteThumbnails();
<a name="l01342"></a>01342 
<a name="l01343"></a>01343     var <a class="code" href="../../d3/d91/j3d_8js.html#a3f87557d7488bfe7545844c394baa854">length</a> = places.length;
<a name="l01344"></a>01344     <span class="comment">// Display a message if Top Sites empty</span>
<a name="l01345"></a>01345     <span class="keywordflow">if</span> (length == 0) {
<a name="l01346"></a>01346       this.noTopSites.classList.remove(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l01347"></a>01347       <span class="keywordflow">return</span>;
<a name="l01348"></a>01348     } <span class="keywordflow">else</span> {
<a name="l01349"></a>01349       this.noTopSites.classList.add(<span class="stringliteral">&#39;hidden&#39;</span>);
<a name="l01350"></a>01350     }
<a name="l01351"></a>01351     <span class="comment">// If an odd number greater than one, remove one</span>
<a name="l01352"></a>01352     <span class="keywordflow">if</span> (length % 2 &amp;&amp; length &gt; 1)
<a name="l01353"></a>01353       places.pop();
<a name="l01354"></a>01354     <span class="comment">// If only one, pad with another empty one</span>
<a name="l01355"></a>01355     <span class="keywordflow">if</span> (length == 1)
<a name="l01356"></a>01356       places.push({uri: <span class="stringliteral">&#39;&#39;</span>, title: <span class="stringliteral">&#39;&#39;</span>});
<a name="l01357"></a>01357 
<a name="l01358"></a>01358     places.forEach(<span class="keyword">function</span> processPlace(place) {
<a name="l01359"></a>01359       var thumbnail = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;li&#39;</span>);
<a name="l01360"></a>01360       var link = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="charliteral">&#39;a&#39;</span>);
<a name="l01361"></a>01361       var title = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;span&#39;</span>);
<a name="l01362"></a>01362       link.href = place.uri;
<a name="l01363"></a>01363       title.textContent = place.title ? place.title : place.uri;
<a name="l01364"></a>01364 
<a name="l01365"></a>01365       <span class="keywordflow">if</span> (place.screenshot) {
<a name="l01366"></a>01366         var objectURL = <a class="code" href="../../d6/dfe/class_u_r_l.html">URL</a>.createObjectURL(place.screenshot);
<a name="l01367"></a>01367         this._topSiteThumbnailObjectURLs.push(objectURL);
<a name="l01368"></a>01368         link.style.backgroundImage = <span class="stringliteral">&#39;url(&#39;</span> + objectURL + <span class="charliteral">&#39;)&#39;</span>;
<a name="l01369"></a>01369       }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371       thumbnail.appendChild(link);
<a name="l01372"></a>01372       thumbnail.appendChild(title);
<a name="l01373"></a>01373       this.topSiteThumbnails.appendChild(thumbnail);
<a name="l01374"></a>01374     }, <span class="keyword">this</span>);
<a name="l01375"></a>01375   },
<a name="l01376"></a>01376 
<a name="l01377"></a>01377   showPageScreen: <span class="keyword">function</span> browser_showPageScreen() {
<a name="l01378"></a>01378     <span class="keywordflow">if</span> (this.currentScreen === this.TABS_SCREEN) {
<a name="l01379"></a>01379       var switchLive = (<span class="keyword">function</span> browser_switchLive() {
<a name="l01380"></a>01380         this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.removeEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, switchLive, <span class="keyword">true</span>);
<a name="l01381"></a>01381         this.setTabVisibility(this.currentTab, <span class="keyword">true</span>);
<a name="l01382"></a>01382       }).<a class="code" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<span class="keyword">this</span>);
<a name="l01383"></a>01383       this.<a class="code" href="../../d3/d4b/lockscreen_8js.html#a5f3a3306271bb5a83acc956fc4594829">mainScreen</a>.addEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, switchLive, <span class="keyword">true</span>);
<a name="l01384"></a>01384     } <span class="keywordflow">else</span> {
<a name="l01385"></a>01385       this.setTabVisibility(this.currentTab, <span class="keyword">true</span>);
<a name="l01386"></a>01386     }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388     <span class="keywordflow">if</span> (this.currentTab.loading) {
<a name="l01389"></a>01389       this.setUrlButtonMode(this.STOP);
<a name="l01390"></a>01390       this.throbber.classList.add(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l01391"></a>01391     } <span class="keywordflow">else</span> {
<a name="l01392"></a>01392       var urlButton = this.currentTab.url ? this.REFRESH : <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l01393"></a>01393       this.setUrlButtonMode(urlButton);
<a name="l01394"></a>01394       this.throbber.classList.remove(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l01395"></a>01395     }
<a name="l01396"></a>01396 
<a name="l01397"></a>01397     this.switchScreen(this.PAGE_SCREEN);
<a name="l01398"></a>01398     this.setUrlBar(this.currentTab.title || <span class="keyword">this</span>.currentTab.url);
<a name="l01399"></a>01399     <span class="keywordflow">if</span> (this.currentTab.crashed) {
<a name="l01400"></a>01400       this.showCrashScreen();
<a name="l01401"></a>01401     } <span class="keywordflow">else</span> {
<a name="l01402"></a>01402       this.hideCrashScreen();
<a name="l01403"></a>01403     }
<a name="l01404"></a>01404     this.updateTabsCount();
<a name="l01405"></a>01405     this.inTransition = <span class="keyword">false</span>;
<a name="l01406"></a>01406   },
<a name="l01407"></a>01407 
<a name="l01408"></a>01408   _tabScreenObjectURLs: [],
<a name="l01409"></a>01409   showTabScreen: <span class="keyword">function</span> browser_showTabScreen() {
<a name="l01410"></a>01410 
<a name="l01411"></a>01411     <span class="comment">// TODO: We shouldnt hide the current tab when switching to the tab</span>
<a name="l01412"></a>01412     <span class="comment">// screen, it should be visible in the gutter, but that currently triggers</span>
<a name="l01413"></a>01413     <span class="comment">// https://bugzilla.mozilla.org/show_bug.cgi?id=777781</span>
<a name="l01414"></a>01414     this.hideCurrentTab();
<a name="l01415"></a>01415     this.tabsBadge.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01416"></a>01416 
<a name="l01417"></a>01417     var ul = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ul&#39;</span>);
<a name="l01418"></a>01418 
<a name="l01419"></a>01419     this.tabsList.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01420"></a>01420     <span class="comment">// Revoke our old object URLs, so we don&#39;t leak.  (It is tempting to do</span>
<a name="l01421"></a>01421     <span class="comment">// forEach(URL.revokeObjectURL), but that throws an exception.</span>
<a name="l01422"></a>01422     this._tabScreenObjectURLs.forEach(<span class="keyword">function</span>(url) {
<a name="l01423"></a>01423       <a class="code" href="../../d6/dfe/class_u_r_l.html">URL</a>.revokeObjectURL(url);
<a name="l01424"></a>01424     });
<a name="l01425"></a>01425     this._tabScreenObjectURLs = [];
<a name="l01426"></a>01426 
<a name="l01427"></a>01427     <span class="keywordflow">for</span> (var tab in this.tabs) {
<a name="l01428"></a>01428       var li = this.generateTabLi(this.tabs[tab]);
<a name="l01429"></a>01429       ul.appendChild(li);
<a name="l01430"></a>01430     }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432     this.tabsList.appendChild(ul);
<a name="l01433"></a>01433     this.switchScreen(this.TABS_SCREEN);
<a name="l01434"></a>01434     this.screenSwipeMngr.gestureDetector.startDetecting();
<a name="l01435"></a>01435     <span class="keyword">new</span> <a class="code" href="../../d8/df0/frames_8js.html#a050c35bd1ae66a249cd6c3554661e24a">GestureDetector</a>(ul).startDetecting();
<a name="l01436"></a>01436     this.inTransition = <span class="keyword">false</span>;
<a name="l01437"></a>01437   },
<a name="l01438"></a>01438 
<a name="l01439"></a>01439   generateTabLi: <span class="keyword">function</span> browser_generateTabLi(tab) {
<a name="l01440"></a>01440     var title = tab.title || tab.url || <a class="code" href="../../d6/d52/js_2browser_8js.html#a6e69a5af94d7d53886e51f89fb3bd6b4">_</a>(<span class="stringliteral">&#39;new-tab&#39;</span>);
<a name="l01441"></a>01441     var a = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="charliteral">&#39;a&#39;</span>);
<a name="l01442"></a>01442     var li = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;li&#39;</span>);
<a name="l01443"></a>01443     var span = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;span&#39;</span>);
<a name="l01444"></a>01444     var preview = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;div&#39;</span>);
<a name="l01445"></a>01445     var <a class="code" href="../../dd/dfa/classtext.html">text</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createTextNode(title);
<a name="l01446"></a>01446 
<a name="l01447"></a>01447     var <a class="code" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">close</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;button&#39;</span>);
<a name="l01448"></a>01448     close.classList.add(<span class="stringliteral">&#39;close&#39;</span>);
<a name="l01449"></a>01449     close.setAttribute(<span class="stringliteral">&#39;data-id&#39;</span>, tab.id);
<a name="l01450"></a>01450     a.appendChild(close);
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     a.setAttribute(<span class="stringliteral">&#39;data-id&#39;</span>, tab.id);
<a name="l01453"></a>01453     preview.classList.add(<span class="stringliteral">&#39;preview&#39;</span>);
<a name="l01454"></a>01454 
<a name="l01455"></a>01455     span.appendChild(text);
<a name="l01456"></a>01456     a.appendChild(preview);
<a name="l01457"></a>01457     a.appendChild(span);
<a name="l01458"></a>01458     li.appendChild(a);
<a name="l01459"></a>01459 
<a name="l01460"></a>01460     <span class="keywordflow">if</span> (tab.crashed) {
<a name="l01461"></a>01461       preview.classList.add(<span class="stringliteral">&#39;crashed&#39;</span>);
<a name="l01462"></a>01462     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tab.screenshot) {
<a name="l01463"></a>01463       var objectURL = <a class="code" href="../../d6/dfe/class_u_r_l.html">URL</a>.createObjectURL(tab.screenshot);
<a name="l01464"></a>01464       this._tabScreenObjectURLs.push(objectURL);
<a name="l01465"></a>01465       preview.style.backgroundImage = <span class="stringliteral">&#39;url(&#39;</span> + objectURL + <span class="charliteral">&#39;)&#39;</span>;
<a name="l01466"></a>01466     }
<a name="l01467"></a>01467 
<a name="l01468"></a>01468     <span class="keywordflow">if</span> (tab == this.currentTab) {
<a name="l01469"></a>01469       li.classList.add(<span class="stringliteral">&#39;current&#39;</span>);
<a name="l01470"></a>01470     }
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     <span class="keywordflow">return</span> li;
<a name="l01473"></a>01473   },
<a name="l01474"></a>01474 
<a name="l01475"></a>01475   showDangerDialog: <span class="keyword">function</span> browser_showDangerDialog(title, btn, <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>) {
<a name="l01476"></a>01476     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l01477"></a>01477     var <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a> = <a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n.get(title);
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     var <a class="code" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">ok</a> = <span class="keyword">function</span>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01480"></a>01480       <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l01481"></a>01481       removeEventListeners();
<a name="l01482"></a>01482       btn.setAttribute(<span class="stringliteral">&#39;disabled&#39;</span>, <span class="stringliteral">&#39;disabled&#39;</span>);
<a name="l01483"></a>01483       <span class="keyword">self</span>.dangerDialog.hidden = <span class="keyword">true</span>;
<a name="l01484"></a>01484       <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>();
<a name="l01485"></a>01485     };
<a name="l01486"></a>01486 
<a name="l01487"></a>01487     var cancel = <span class="keyword">function</span>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01488"></a>01488       <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l01489"></a>01489       removeEventListeners();
<a name="l01490"></a>01490       <span class="keyword">self</span>.dangerDialogCancel.removeEventListener(<span class="stringliteral">&#39;click&#39;</span>, cancel);
<a name="l01491"></a>01491       <span class="keyword">self</span>.dangerDialog.hidden = <span class="keyword">true</span>;
<a name="l01492"></a>01492     };
<a name="l01493"></a>01493 
<a name="l01494"></a>01494     var removeEventListeners = <span class="keyword">function</span>() {
<a name="l01495"></a>01495       <span class="keyword">self</span>.dangerDialogOk.removeEventListener(<span class="stringliteral">&#39;click&#39;</span>, ok);
<a name="l01496"></a>01496       <span class="keyword">self</span>.dangerDialogCancel.removeEventListener(<span class="stringliteral">&#39;click&#39;</span>, cancel);
<a name="l01497"></a>01497     };
<a name="l01498"></a>01498 
<a name="l01499"></a>01499     this.dangerDialogMessage.textContent = <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>;
<a name="l01500"></a>01500     this.dangerDialog.hidden = <span class="keyword">false</span>;
<a name="l01501"></a>01501 
<a name="l01502"></a>01502     this.dangerDialogOk.addEventListener(<span class="stringliteral">&#39;click&#39;</span>, ok);
<a name="l01503"></a>01503     this.dangerDialogCancel.addEventListener(<span class="stringliteral">&#39;click&#39;</span>, cancel);
<a name="l01504"></a>01504   },
<a name="l01505"></a>01505 
<a name="l01509"></a>01509   clearTabsSessionHistory: <span class="keyword">function</span> browser_clearTabsSessionHistory() {
<a name="l01510"></a>01510     var tabIds = Object.keys(this.tabs);
<a name="l01511"></a>01511     tabIds.forEach(<span class="keyword">function</span>(tabId) {
<a name="l01512"></a>01512       var tab = this.tabs[tabId];
<a name="l01513"></a>01513       <span class="keywordflow">if</span> (tab.dom.purgeHistory) {
<a name="l01514"></a>01514         tab.dom.purgeHistory().onsuccess = <span class="keyword">function</span>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01515"></a>01515           <span class="keywordflow">if</span> (tab == this.currentTab) {
<a name="l01516"></a>01516             <a class="code" href="../../d8/dea/toolbar_8js.html#a6b91e34f52228140b213263d3bc7d00d">Toolbar</a>.refreshButtons();
<a name="l01517"></a>01517           }
<a name="l01518"></a>01518         };
<a name="l01519"></a>01519       }
<a name="l01520"></a>01520     }, <span class="keyword">this</span>);
<a name="l01521"></a>01521   },
<a name="l01522"></a>01522 
<a name="l01523"></a>01523   screenSwipeMngr: {
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     <a class="code" href="../../d0/da2/gallery_8js.html#ad8d2e967e68a60d54c588d6823984541">TRANSITION_SPEED</a>: 1.8,
<a name="l01526"></a>01526     <a class="code" href="../../d0/da2/gallery_8js.html#a473a610b53b4a3ebf03fb3ffc7dd43b4">TRANSITION_FRACTION</a>: 0.75,
<a name="l01527"></a>01527     DEFAULT_TRANSITION: <span class="stringliteral">&#39;transform 0.2s ease-in-out, height 0.2s ease-in-out&#39;</span>,
<a name="l01528"></a>01528 
<a name="l01529"></a>01529     gestureDetector: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01530"></a>01530     browser: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01531"></a>01531     <a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#a143b83738f9fab453e3116d14dfac0e7">screen</a>: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01532"></a>01532     winWidth: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01533"></a>01533 
<a name="l01534"></a>01534     mousedown: <span class="keyword">function</span> screenSwipe_mousedown(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01535"></a>01535       <span class="comment">// The mousedown event can be fired at any time, the other</span>
<a name="l01536"></a>01536       <span class="comment">// events are only fired when tabs screen is active</span>
<a name="l01537"></a>01537       <span class="keywordflow">if</span> (this.browser.currentScreen !== <span class="keyword">this</span>.browser.TABS_SCREEN) {
<a name="l01538"></a>01538         <span class="keywordflow">return</span>;
<a name="l01539"></a>01539       }
<a name="l01540"></a>01540       <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l01541"></a>01541       this.winWidth = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.innerWidth;
<a name="l01542"></a>01542       this.<a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#a143b83738f9fab453e3116d14dfac0e7">screen</a>.style.MozTransition = <span class="stringliteral">&#39;none&#39;</span>;
<a name="l01543"></a>01543     },
<a name="l01544"></a>01544 
<a name="l01545"></a>01545     <a class="code" href="../../d6/d40/build__stage_2email_2shared_2js_2media_2media__frame_8js.html#a0118c22264bfb2702043c95ec9a8e6b2">pan</a>: <span class="keyword">function</span> screenSwipe_pan(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01546"></a>01546       <span class="keywordflow">if</span> (<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.absolute.dx &lt; 0) {
<a name="l01547"></a>01547         <span class="keywordflow">return</span>;
<a name="l01548"></a>01548       }
<a name="l01549"></a>01549       var leftPos = -(this.winWidth - 50) + <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.absolute.dx;
<a name="l01550"></a>01550       <span class="keyword">this</span>.screen.style.transform = <span class="stringliteral">&#39;translate(&#39;</span> + leftPos + <span class="stringliteral">&#39;px)&#39;</span>;
<a name="l01551"></a>01551     },
<a name="l01552"></a>01552 
<a name="l01553"></a>01553     tap: <span class="keyword">function</span> screenSwipe_tap(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01554"></a>01554       this.<a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#a143b83738f9fab453e3116d14dfac0e7">screen</a>.style.MozTransition = this.DEFAULT_TRANSITION;
<a name="l01555"></a>01555       this.browser.showPageScreen();
<a name="l01556"></a>01556     },
<a name="l01557"></a>01557 
<a name="l01558"></a>01558     <a class="code" href="../../d8/dd3/head_8js.html#a9118729bb0e6af929a26ffd9baafca8b">swipe</a>: <span class="keyword">function</span> screenSwipe_swipe(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01559"></a>01559       <span class="comment">// We only want to deal with left to right swipes</span>
<a name="l01560"></a>01560       var fastenough = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.vx &gt; this.<a class="code" href="../../d0/da2/gallery_8js.html#ad8d2e967e68a60d54c588d6823984541">TRANSITION_SPEED</a>;
<a name="l01561"></a>01561       var distance = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.start.screenX - <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.end.screenX;
<a name="l01562"></a>01562       var farenough = Math.abs(distance) &gt;
<a name="l01563"></a>01563         this.winWidth * this.<a class="code" href="../../d0/da2/gallery_8js.html#a473a610b53b4a3ebf03fb3ffc7dd43b4">TRANSITION_FRACTION</a>;
<a name="l01564"></a>01564       this.<a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#a143b83738f9fab453e3116d14dfac0e7">screen</a>.style.MozTransition = this.DEFAULT_TRANSITION;
<a name="l01565"></a>01565       this.<a class="code" href="../../dc/db8/system_2test_2unit_2action__menu__test_8js.html#a143b83738f9fab453e3116d14dfac0e7">screen</a>.style.transform = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01566"></a>01566       <span class="keywordflow">if</span> (farenough || fastenough) {
<a name="l01567"></a>01567         this.browser.showPageScreen();
<a name="l01568"></a>01568         <span class="keywordflow">return</span>;
<a name="l01569"></a>01569       }
<a name="l01570"></a>01570     }
<a name="l01571"></a>01571   },
<a name="l01572"></a>01572 
<a name="l01573"></a>01573   tabsSwipeMngr: {
<a name="l01574"></a>01574 
<a name="l01575"></a>01575     <a class="code" href="../../d0/da2/gallery_8js.html#ad8d2e967e68a60d54c588d6823984541">TRANSITION_SPEED</a>: 1.8,
<a name="l01576"></a>01576     TRANSITION_FRACTION: 0.50,
<a name="l01577"></a>01577 
<a name="l01578"></a>01578     browser: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01579"></a>01579     tab: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01580"></a>01580     <span class="keywordtype">id</span>: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01581"></a>01581     containerWidth: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l01582"></a>01582 
<a name="l01583"></a>01583     mousedown: <span class="keyword">function</span> tabSwipe_mousedown(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01584"></a>01584       <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.preventDefault();
<a name="l01585"></a>01585 
<a name="l01586"></a>01586       this.isCloseButton = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target.nodeName === <span class="stringliteral">&#39;BUTTON&#39;</span>;
<a name="l01587"></a>01587       this.tab = this.isCloseButton ? <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target.parentNode : <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target;
<a name="l01588"></a>01588       this.<span class="keywordtype">id</span> = this.tab.getAttribute(<span class="stringliteral">&#39;data-id&#39;</span>);
<a name="l01589"></a>01589       this.containerWidth = this.tab.parentNode.clientWidth;
<a name="l01590"></a>01590 
<a name="l01591"></a>01591       <span class="keywordflow">if</span> (this.isCloseButton) {
<a name="l01592"></a>01592         <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.stopPropagation();
<a name="l01593"></a>01593         <span class="keywordflow">return</span>;
<a name="l01594"></a>01594       }
<a name="l01595"></a>01595 
<a name="l01596"></a>01596       <span class="keywordflow">if</span> (this.browser.inTransition)
<a name="l01597"></a>01597         <span class="keywordflow">return</span>;
<a name="l01598"></a>01598 
<a name="l01599"></a>01599       this.tab.classList.add(<span class="stringliteral">&#39;active&#39;</span>);
<a name="l01600"></a>01600       this.tab.style.MozTransition = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01601"></a>01601     },
<a name="l01602"></a>01602 
<a name="l01603"></a>01603     <a class="code" href="../../d6/d40/build__stage_2email_2shared_2js_2media_2media__frame_8js.html#a0118c22264bfb2702043c95ec9a8e6b2">pan</a>: <span class="keyword">function</span> tabSwipe_pan(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01604"></a>01604       <span class="keywordflow">if</span> (this.browser.inTransition)
<a name="l01605"></a>01605         <span class="keywordflow">return</span>;
<a name="l01606"></a>01606       var movement = Math.min(this.containerWidth,
<a name="l01607"></a>01607                               Math.abs(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.absolute.dx));
<a name="l01608"></a>01608       <span class="keywordflow">if</span> (movement &gt; 0) {
<a name="l01609"></a>01609         this.tab.style.opacity = 1 - (movement / this.containerWidth);
<a name="l01610"></a>01610       }
<a name="l01611"></a>01611       this.tab.style.left = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.absolute.dx + <span class="stringliteral">&#39;px&#39;</span>;
<a name="l01612"></a>01612     },
<a name="l01613"></a>01613 
<a name="l01614"></a>01614     tap: <span class="keyword">function</span> tabSwipe_tap() {
<a name="l01615"></a>01615       <span class="keywordflow">if</span> (this.browser.inTransition) {
<a name="l01616"></a>01616         <span class="keywordflow">return</span>;
<a name="l01617"></a>01617       }
<a name="l01618"></a>01618       <span class="keywordflow">if</span> (this.isCloseButton) {
<a name="l01619"></a>01619         this.tab.style.left = <span class="stringliteral">&#39;0px&#39;</span>;
<a name="l01620"></a>01620         this.deleteTab(100, this.containerWidth);
<a name="l01621"></a>01621         <span class="keywordflow">return</span>;
<a name="l01622"></a>01622       }
<a name="l01623"></a>01623 
<a name="l01624"></a>01624       this.browser.selectTab(this.<span class="keywordtype">id</span>);
<a name="l01625"></a>01625       this.browser.showPageScreen();
<a name="l01626"></a>01626     },
<a name="l01627"></a>01627 
<a name="l01628"></a>01628     <a class="code" href="../../d8/dd3/head_8js.html#a9118729bb0e6af929a26ffd9baafca8b">swipe</a>: <span class="keyword">function</span> tabSwipe_swipe(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01629"></a>01629       <span class="keywordflow">if</span> (this.browser.inTransition)
<a name="l01630"></a>01630         <span class="keywordflow">return</span>;
<a name="l01631"></a>01631 
<a name="l01632"></a>01632       var distance = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.start.screenX - <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.end.screenX;
<a name="l01633"></a>01633       var fastenough = Math.abs(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.vx) &gt; this.<a class="code" href="../../d0/da2/gallery_8js.html#ad8d2e967e68a60d54c588d6823984541">TRANSITION_SPEED</a>;
<a name="l01634"></a>01634       var farenough = Math.abs(distance) &gt;
<a name="l01635"></a>01635         this.containerWidth * this.<a class="code" href="../../d0/da2/gallery_8js.html#a473a610b53b4a3ebf03fb3ffc7dd43b4">TRANSITION_FRACTION</a>;
<a name="l01636"></a>01636 
<a name="l01637"></a>01637       <span class="keywordflow">if</span> (!(farenough || fastenough)) {
<a name="l01638"></a>01638         <span class="comment">// Werent far or fast enough to delete, restore</span>
<a name="l01639"></a>01639         var <a class="code" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a> = Math.abs(distance) / this.<a class="code" href="../../d0/da2/gallery_8js.html#ad8d2e967e68a60d54c588d6823984541">TRANSITION_SPEED</a>;
<a name="l01640"></a>01640         var transition = <span class="stringliteral">&#39;left &#39;</span> + time + <span class="stringliteral">&#39;ms linear&#39;</span>;
<a name="l01641"></a>01641         this.tab.style.MozTransition = transition;
<a name="l01642"></a>01642         this.tab.style.left = <span class="stringliteral">&#39;0px&#39;</span>;
<a name="l01643"></a>01643         this.tab.style.opacity = 1;
<a name="l01644"></a>01644         this.tab.classList.remove(<span class="stringliteral">&#39;active&#39;</span>);
<a name="l01645"></a>01645         <span class="keywordflow">return</span>;
<a name="l01646"></a>01646       }
<a name="l01647"></a>01647 
<a name="l01648"></a>01648       var speed = Math.max(Math.abs(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.vx), 1.8);
<a name="l01649"></a>01649       var time = (this.containerWidth - Math.abs(distance)) / speed;
<a name="l01650"></a>01650       var <a class="code" href="../../da/d32/prio_8h.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.detail.direction === <span class="stringliteral">&#39;right&#39;</span> ?
<a name="l01651"></a>01651         this.containerWidth : -this.containerWidth;
<a name="l01652"></a>01652 
<a name="l01653"></a>01653       this.deleteTab(time, offset);
<a name="l01654"></a>01654     },
<a name="l01655"></a>01655 
<a name="l01656"></a>01656     deleteTab: <span class="keyword">function</span> tabSwipe_deleteTab(time, <a class="code" href="../../da/d32/prio_8h.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a>) {
<a name="l01657"></a>01657       var browser = this.browser;
<a name="l01658"></a>01658       var <span class="keywordtype">id</span> = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>;
<a name="l01659"></a>01659       var li = this.tab.parentNode;
<a name="l01660"></a>01660       var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l01661"></a>01661 
<a name="l01662"></a>01662       <span class="comment">// First animate the tab offscreen</span>
<a name="l01663"></a>01663       this.tab.addEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, <span class="keyword">function</span>() {
<a name="l01664"></a>01664         <span class="comment">// Then animate the space dissapearing</span>
<a name="l01665"></a>01665         li.addEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, <span class="keyword">function</span>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l01666"></a>01666           <span class="comment">// Then delete everything</span>
<a name="l01667"></a>01667           browser.deleteTab(<span class="keywordtype">id</span>);
<a name="l01668"></a>01668           li.parentNode.removeChild(li);
<a name="l01669"></a>01669           browser.updateTabsCount();
<a name="l01670"></a>01670         }, <span class="keyword">true</span>);
<a name="l01671"></a>01671         li.style.MozTransition = <span class="stringliteral">&#39;height &#39;</span> + 100 + <span class="stringliteral">&#39;ms linear&#39;</span>;
<a name="l01672"></a>01672         li.style.height = <span class="stringliteral">&#39;0px&#39;</span>;
<a name="l01673"></a>01673       }, <span class="keyword">true</span>);
<a name="l01674"></a>01674 
<a name="l01675"></a>01675       this.tab.style.MozTransition = <span class="stringliteral">&#39;left &#39;</span> + time + <span class="stringliteral">&#39;ms linear&#39;</span>;
<a name="l01676"></a>01676       this.tab.clientTop;
<a name="l01677"></a>01677       this.tab.style.left = <a class="code" href="../../da/d32/prio_8h.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> + <span class="stringliteral">&#39;px&#39;</span>;
<a name="l01678"></a>01678     }
<a name="l01679"></a>01679   },
<a name="l01680"></a>01680 
<a name="l01681"></a>01681   handleActivity: <span class="keyword">function</span> browser_handleActivity(<a class="code" href="../../de/dc7/share-receiver_8js.html#add7056b1c8a53d2db94122b6cd76b964">activity</a>) {
<a name="l01682"></a>01682     <span class="comment">// Activities can send multiple names, right now we only handle</span>
<a name="l01683"></a>01683     <span class="comment">// one so we only filter on types</span>
<a name="l01684"></a>01684     <span class="keywordflow">switch</span> (<a class="code" href="../../de/dc7/share-receiver_8js.html#add7056b1c8a53d2db94122b6cd76b964">activity</a>.source.data.type) {
<a name="l01685"></a>01685       <span class="keywordflow">case</span> <span class="stringliteral">&#39;url&#39;</span>:
<a name="l01686"></a>01686         var url = this.getUrlFromInput(<a class="code" href="../../de/dc7/share-receiver_8js.html#add7056b1c8a53d2db94122b6cd76b964">activity</a>.source.data.url);
<a name="l01687"></a>01687         <span class="keywordflow">if</span> (this.currentTab) {
<a name="l01688"></a>01688           <span class="keywordflow">if</span> (this.currentTab.url) {
<a name="l01689"></a>01689             this.hideCurrentTab();
<a name="l01690"></a>01690             this.selectTab(this.createTab(url));
<a name="l01691"></a>01691           } <span class="keywordflow">else</span> {
<a name="l01692"></a>01692             this.navigate(url);
<a name="l01693"></a>01693           }
<a name="l01694"></a>01694         }
<a name="l01695"></a>01695         this.showPageScreen();
<a name="l01696"></a>01696         <span class="keywordflow">break</span>;
<a name="l01697"></a>01697     }
<a name="l01698"></a>01698   }
<a name="l01699"></a>01699 };
<a name="l01700"></a>01700 
<a name="l01701"></a>01701 <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.addEventListener(<span class="stringliteral">&#39;load&#39;</span>, <span class="keyword">function</span> browserOnLoad(evt) {
<a name="l01702"></a>01702   <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.removeEventListener(<span class="stringliteral">&#39;load&#39;</span>, browserOnLoad);
<a name="l01703"></a>01703   Browser.init();
<a name="l01704"></a>01704 });
<a name="l01705"></a>01705 
<a name="l01706"></a>01706 
<a name="l01707"></a><a class="code" href="../../d6/d52/js_2browser_8js.html#a35ca1017bd581c0cd64ad0e3defc07d8">01707</a> <span class="keyword">function</span> <a class="code" href="../../d6/d52/js_2browser_8js.html#a35ca1017bd581c0cd64ad0e3defc07d8">actHandle</a>(<a class="code" href="../../de/dc7/share-receiver_8js.html#add7056b1c8a53d2db94122b6cd76b964">activity</a>) {
<a name="l01708"></a>01708   <span class="keywordflow">if</span> (Browser.hasLoaded) {
<a name="l01709"></a>01709     Browser.handleActivity(<a class="code" href="../../de/dc7/share-receiver_8js.html#add7056b1c8a53d2db94122b6cd76b964">activity</a>);
<a name="l01710"></a>01710   } <span class="keywordflow">else</span> {
<a name="l01711"></a>01711     Browser.waitingActivities.push(<a class="code" href="../../de/dc7/share-receiver_8js.html#add7056b1c8a53d2db94122b6cd76b964">activity</a>);
<a name="l01712"></a>01712   }
<a name="l01713"></a>01713   <a class="code" href="../../de/dc7/share-receiver_8js.html#add7056b1c8a53d2db94122b6cd76b964">activity</a>.postResult({ status: <span class="stringliteral">&#39;accepted&#39;</span> });
<a name="l01714"></a>01714 }
<a name="l01715"></a>01715 
<a name="l01716"></a><a class="code" href="../../d6/d52/js_2browser_8js.html#a7321fd84345f4f9455f25996b932b8fd">01716</a> <span class="keywordflow">if</span> (<a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.navigator.mozSetMessageHandler) {
<a name="l01717"></a>01717   <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.navigator.mozSetMessageHandler(<span class="stringliteral">&#39;activity&#39;</span>, <a class="code" href="../../d6/d52/js_2browser_8js.html#a35ca1017bd581c0cd64ad0e3defc07d8">actHandle</a>);
<a name="l01718"></a>01718 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d6/d52/js_2browser_8js.html">browser.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:51:06に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
