<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: AsyncChannel.h ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d2/da7/_async_channel_8h.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">AsyncChannel.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d2/da7/_async_channel_8h.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a name="l00002"></a>00002 <span class="comment"> * vim: sw=4 ts=4 et :</span>
<a name="l00003"></a>00003 <span class="comment"> */</span>
<a name="l00004"></a>00004 <span class="comment">/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a name="l00005"></a>00005 <span class="comment"> * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a name="l00006"></a>00006 <span class="comment"> * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#ifndef ipc_glue_AsyncChannel_h</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">#define ipc_glue_AsyncChannel_h 1</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;base/basictypes.h&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;base/message_loop.h&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dbd/_weak_ptr_8h.html">mozilla/WeakPtr.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d29/_monitor_8h.html">mozilla/Monitor.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d93/_transport_8h.html">mozilla/ipc/Transport.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keyword">namespace </span>mozilla {
<a name="l00021"></a>00021 <span class="keyword">namespace </span>ipc {
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html">00023</a> <span class="keyword">struct </span><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html">HasResultCodes</a>
<a name="l00024"></a>00024 {
<a name="l00025"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4">00025</a>     <span class="keyword">enum</span> <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4">Result</a> {
<a name="l00026"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a34b736af1901f4f243c834039c553acb">00026</a>         <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a34b736af1901f4f243c834039c553acb">MsgProcessed</a>,
<a name="l00027"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4aefc62c007494d12290568d06fc74c670">00027</a>         <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4aefc62c007494d12290568d06fc74c670">MsgDropped</a>,
<a name="l00028"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a9a5053c31e13fd8005435fc9f417f1ce">00028</a>         <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a9a5053c31e13fd8005435fc9f417f1ce">MsgNotKnown</a>,
<a name="l00029"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4ad1050d0afe3ae803d7bd1b5c238ff4b8">00029</a>         <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4ad1050d0afe3ae803d7bd1b5c238ff4b8">MsgNotAllowed</a>,
<a name="l00030"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a22191788ad8c4c2e73800adf5798ba02">00030</a>         <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a22191788ad8c4c2e73800adf5798ba02">MsgPayloadError</a>,
<a name="l00031"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4ab48810d9c747ecb75dc99aa7ffe1eef0">00031</a>         <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4ab48810d9c747ecb75dc99aa7ffe1eef0">MsgProcessingError</a>,
<a name="l00032"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a7038a4c6965d0171a261d15589035b75">00032</a>         <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a7038a4c6965d0171a261d15589035b75">MsgRouteError</a>,
<a name="l00033"></a><a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a232a31b84d9682615a136c4ac9de2733">00033</a>         <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4a232a31b84d9682615a136c4ac9de2733">MsgValueError</a>
<a name="l00034"></a>00034     };
<a name="l00035"></a>00035 };
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="../../d5/dc9/classmozilla_1_1ipc_1_1_ref_counted_monitor.html">00038</a> <span class="keyword">class </span><a class="code" href="../../d5/dc9/classmozilla_1_1ipc_1_1_ref_counted_monitor.html">RefCountedMonitor</a> : <span class="keyword">public</span> <a class="code" href="../../dd/d10/classmozilla_1_1_monitor.html">Monitor</a>
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040 <span class="keyword">public</span>:
<a name="l00041"></a><a class="code" href="../../d5/dc9/classmozilla_1_1ipc_1_1_ref_counted_monitor.html#a0aa0a9cb7ed0fbc396c3b11d24ec40ce">00041</a>     <a class="code" href="../../d5/dc9/classmozilla_1_1ipc_1_1_ref_counted_monitor.html#a0aa0a9cb7ed0fbc396c3b11d24ec40ce">RefCountedMonitor</a>() 
<a name="l00042"></a>00042         : <a class="code" href="../../dd/d10/classmozilla_1_1_monitor.html">Monitor</a>(<span class="stringliteral">&quot;mozilla.ipc.AsyncChannel.mMonitor&quot;</span>)
<a name="l00043"></a>00043     {}
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     <a class="code" href="../../d0/d5a/ns_i_supports_impl_8h.html#ac4bdc476a7f9eddfb535c3ff08591209">NS_INLINE_DECL_THREADSAFE_REFCOUNTING</a>(<a class="code" href="../../d5/dc9/classmozilla_1_1ipc_1_1_ref_counted_monitor.html">RefCountedMonitor</a>)
<a name="l00046"></a>00046 };
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">00048</a> <span class="keyword">class </span><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> : <span class="keyword">protected</span> <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html">HasResultCodes</a>
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050 <span class="keyword">protected</span>:
<a name="l00051"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a8ac83b1eb00d1ceb2b663fcca78558bd">00051</a>     <span class="keyword">typedef</span> <a class="code" href="../../dd/d10/classmozilla_1_1_monitor.html">mozilla::Monitor</a> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a8ac83b1eb00d1ceb2b663fcca78558bd">Monitor</a>;
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703d">00053</a>     <span class="keyword">enum</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703d">ChannelState</a> {
<a name="l00054"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da3dc63e61178174439517635d73e3d042">00054</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da3dc63e61178174439517635d73e3d042">ChannelClosed</a>,
<a name="l00055"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da0081651e3d96442dde7234c10b5f05c7">00055</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da0081651e3d96442dde7234c10b5f05c7">ChannelOpening</a>,
<a name="l00056"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da32046d26ed9fac29ba27e7c89156f2ce">00056</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da32046d26ed9fac29ba27e7c89156f2ce">ChannelConnected</a>,
<a name="l00057"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da3a0ae839c8569562a35535f5322afa4f">00057</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da3a0ae839c8569562a35535f5322afa4f">ChannelTimeout</a>,
<a name="l00058"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da9ffcf7d6f2df86f05790376bbac79ecc">00058</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da9ffcf7d6f2df86f05790376bbac79ecc">ChannelClosing</a>,
<a name="l00059"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da66902557d063ad45e5a42bcfaad7ed3e">00059</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da66902557d063ad45e5a42bcfaad7ed3e">ChannelError</a>
<a name="l00060"></a>00060     };
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="keyword">public</span>:
<a name="l00063"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">00063</a>     <span class="keyword">typedef</span> <a class="code" href="../../d3/d80/homescreen_2js_2message_8js.html#a2b999b964c05992f7c4361df3fcb3017">IPC::Message</a> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>;
<a name="l00064"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5649c862c228ad6266419a6e80b71983">00064</a>     <span class="keyword">typedef</span> <a class="code" href="../../df/d8a/namespacemozilla_1_1ipc.html#aaba58dd8b489d430532d3ceb72706115">mozilla::ipc::Transport</a> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5649c862c228ad6266419a6e80b71983">Transport</a>;
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html">00066</a>     <span class="keyword">class </span><span class="comment">/*NS_INTERFACE_CLASS*/</span> <a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html">AsyncListener</a>
<a name="l00067"></a>00067         : <span class="keyword">protected</span> <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html">HasResultCodes</a>
<a name="l00068"></a>00068         , <span class="keyword">public</span> mozilla::<a class="code" href="../../d1/d9d/classmozilla_1_1_supports_weak_ptr.html">SupportsWeakPtr</a>&lt;AsyncListener&gt;
<a name="l00069"></a>00069     {
<a name="l00070"></a>00070     <span class="keyword">public</span>:
<a name="l00071"></a><a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#a22fa4fc11518872ab1fe35ce575b8bbc">00071</a>         <span class="keyword">virtual</span> <a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#a22fa4fc11518872ab1fe35ce575b8bbc">~AsyncListener</a>() { }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#a3af70202128036c6f60d23555f198990">OnChannelClose</a>() = 0;
<a name="l00074"></a>00074         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#a92c5152e570a9c26a78c9b24f38977b7">OnChannelError</a>() = 0;
<a name="l00075"></a>00075         <span class="keyword">virtual</span> <a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4">Result</a> <a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#a3bf2a22974075f12c5395f36df35dc79">OnMessageReceived</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>&amp; aMessage) = 0;
<a name="l00076"></a>00076         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#aaaa73440df3bbe8d38dd840b28cfae99">OnProcessingError</a>(<a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4">Result</a> aError) = 0;
<a name="l00077"></a>00077         <span class="comment">// FIXME/bug 792652: this doesn&#39;t really belong here, but a</span>
<a name="l00078"></a>00078         <span class="comment">// large refactoring is needed to put it where it belongs.</span>
<a name="l00079"></a>00079         <span class="keyword">virtual</span> int32_t <a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#a90be45b2a52c117aaff69a8b0a22165d">GetProtocolTypeId</a>() = 0;
<a name="l00080"></a><a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#ab4b826016096ac90f4431d3ae24901cc">00080</a>         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d27/classmozilla_1_1ipc_1_1_async_channel_1_1_async_listener.html#ab4b826016096ac90f4431d3ae24901cc">OnChannelConnected</a>(int32_t peer_pid) {}
<a name="l00081"></a>00081     };
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351deadbc0ed7ad800dd8d3d3573a36051e517">00083</a>     <span class="keyword">enum</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351de">Side</a> { <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351dea557ec74539cc0e19982b5327b5ad6546">Parent</a>, <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351deae1efa29ff64f6c221111187f35f1bfb6">Child</a>, <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351deadbc0ed7ad800dd8d3d3573a36051e517">Unknown</a> };
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="keyword">public</span>:
<a name="l00086"></a>00086     <span class="comment">//</span>
<a name="l00087"></a>00087     <span class="comment">// These methods are called on the &quot;worker&quot; thread</span>
<a name="l00088"></a>00088     <span class="comment">//</span>
<a name="l00089"></a>00089     <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a6d58464bbd9a56df2942f0194e8f22a0">AsyncChannel</a>(AsyncListener* aListener);
<a name="l00090"></a>00090     <span class="keyword">virtual</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a2ce932930f20c5cdbba54ef2c3026635">~AsyncChannel</a>();
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="comment">// &quot;Open&quot; from the perspective of the transport layer; the underlying</span>
<a name="l00093"></a>00093     <span class="comment">// socketpair/pipe should already be created.</span>
<a name="l00094"></a>00094     <span class="comment">//</span>
<a name="l00095"></a>00095     <span class="comment">// Returns true iff the transport layer was successfully connected,</span>
<a name="l00096"></a>00096     <span class="comment">// i.e., mChannelState == ChannelConnected.</span>
<a name="l00097"></a>00097     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#adc095e4594fcc3e82d53059b5c7ba1f3">Open</a>(<a class="code" href="../../df/d8a/namespacemozilla_1_1ipc.html#aaba58dd8b489d430532d3ceb72706115">Transport</a>* aTransport, MessageLoop* aIOLoop=0, <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351de">Side</a> aSide=<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351deadbc0ed7ad800dd8d3d3573a36051e517">Unknown</a>);
<a name="l00098"></a>00098     
<a name="l00099"></a>00099     <span class="comment">// &quot;Open&quot; a connection to another thread in the same process.</span>
<a name="l00100"></a>00100     <span class="comment">//</span>
<a name="l00101"></a>00101     <span class="comment">// Returns true iff the transport layer was successfully connected,</span>
<a name="l00102"></a>00102     <span class="comment">// i.e., mChannelState == ChannelConnected.</span>
<a name="l00103"></a>00103     <span class="comment">//</span>
<a name="l00104"></a>00104     <span class="comment">// For more details on the process of opening a channel between</span>
<a name="l00105"></a>00105     <span class="comment">// threads, see the extended comment on this function</span>
<a name="l00106"></a>00106     <span class="comment">// in AsyncChannel.cpp.</span>
<a name="l00107"></a>00107     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#adc095e4594fcc3e82d53059b5c7ba1f3">Open</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> *aTargetChan, MessageLoop *aTargetLoop, <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351de">Side</a> aSide);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="comment">// Close the underlying transport channel.</span>
<a name="l00110"></a>00110     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4ad7625142aeafb6e9e4e12e90a550ea">Close</a>();
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <span class="comment">// Force the channel to behave as if a channel error occurred. Valid</span>
<a name="l00113"></a>00113     <span class="comment">// for process links only, not thread links.</span>
<a name="l00114"></a>00114     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a298c461c1ac3250db7a1894c53a9c662">CloseWithError</a>();
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="comment">// Asynchronously send a message to the other side of the channel</span>
<a name="l00117"></a>00117     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5fde5c97ff6dada30762e79a32658a4d">Send</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>* <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="comment">// Asynchronously deliver a message back to this side of the</span>
<a name="l00120"></a>00120     <span class="comment">// channel</span>
<a name="l00121"></a>00121     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a016f6e379c3d5e93df584aa0d88b8362">Echo</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>* <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="comment">// Send OnChannelConnected notification to listeners.</span>
<a name="l00124"></a>00124     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ad5a7af8c5abd27cc5a986449dea1e5f5">DispatchOnChannelConnected</a>(int32_t peer_pid);
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="comment">// Unsound_IsClosed and Unsound_NumQueuedMessages are safe to call from any</span>
<a name="l00127"></a>00127     <span class="comment">// thread, but they make no guarantees about whether you&#39;ll get an</span>
<a name="l00128"></a>00128     <span class="comment">// up-to-date value; the values are written on one thread and read without</span>
<a name="l00129"></a>00129     <span class="comment">// locking, on potentially different threads.  Thus you should only use</span>
<a name="l00130"></a>00130     <span class="comment">// them when you don&#39;t particularly care about getting a recent value (e.g.</span>
<a name="l00131"></a>00131     <span class="comment">// in a memory report).</span>
<a name="l00132"></a>00132     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ade20027b888dce174a0c8bc9aff6eeef">Unsound_IsClosed</a>() <span class="keyword">const</span>;
<a name="l00133"></a>00133     uint32_t <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5f401c24bd48468ca7f848476b422b31">Unsound_NumQueuedMessages</a>() <span class="keyword">const</span>;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="comment">//</span>
<a name="l00136"></a>00136     <span class="comment">// Each AsyncChannel is associated with either a ProcessLink or a</span>
<a name="l00137"></a>00137     <span class="comment">// ThreadLink via the field mLink.  The type of link is determined</span>
<a name="l00138"></a>00138     <span class="comment">// by whether this AsyncChannel is communicating with another</span>
<a name="l00139"></a>00139     <span class="comment">// process or another thread.  In the former case, file</span>
<a name="l00140"></a>00140     <span class="comment">// descriptors or a socket are used via the I/O queue.  In the</span>
<a name="l00141"></a>00141     <span class="comment">// latter case, messages are enqueued directly onto the target</span>
<a name="l00142"></a>00142     <span class="comment">// thread&#39;s work queue.</span>
<a name="l00143"></a>00143     <span class="comment">//</span>
<a name="l00144"></a>00144 
<a name="l00145"></a><a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html">00145</a>     <span class="keyword">class </span><a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html">Link</a> {
<a name="l00146"></a>00146     <span class="keyword">protected</span>:
<a name="l00147"></a><a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a729b7c5f0f00886feda0aa59371cab65">00147</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> *<a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a729b7c5f0f00886feda0aa59371cab65">mChan</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="keyword">public</span>:
<a name="l00150"></a>00150         <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a847d119ffeecdd40af72738330789284">Link</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> *aChan);
<a name="l00151"></a>00151         <span class="keyword">virtual</span> <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a514de07eb5f7d3a8ec4af38e98c26b20">~Link</a>();
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <span class="comment">// n.b.: These methods all require that the channel monitor is</span>
<a name="l00154"></a>00154         <span class="comment">// held when they are invoked.</span>
<a name="l00155"></a>00155         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a1a748571e7c41f111dedeb5c0cefb388">EchoMessage</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a> *<a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>) = 0;
<a name="l00156"></a>00156         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a88aacc624f9080d0c983f36da869cad7">SendMessage</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a> *<a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>) = 0;
<a name="l00157"></a>00157         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a772ebc5920580bc789db675543d8faf6">SendClose</a>() = 0;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a397fe5f4e4646ead6da558509cfbae92">Unsound_IsClosed</a>() <span class="keyword">const</span> = 0;
<a name="l00160"></a>00160         <span class="keyword">virtual</span> uint32_t <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html#a66d796324daeed541b2b6013028e5ce0">Unsound_NumQueuedMessages</a>() <span class="keyword">const</span> = 0;
<a name="l00161"></a>00161     };
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html">00163</a>     <span class="keyword">class </span><a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html">ProcessLink</a> : <span class="keyword">public</span> <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html">Link</a>, <span class="keyword">public</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5649c862c228ad6266419a6e80b71983">Transport</a>::Listener {
<a name="l00164"></a>00164     <span class="keyword">protected</span>:
<a name="l00165"></a><a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aa768e2677e7061698e412776ac1c4389">00165</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5649c862c228ad6266419a6e80b71983">Transport</a>* <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aa768e2677e7061698e412776ac1c4389">mTransport</a>;
<a name="l00166"></a><a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aacdc03ef8b2362f0f54a4f1207c5fc8b">00166</a>         MessageLoop* <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aacdc03ef8b2362f0f54a4f1207c5fc8b">mIOLoop</a>;       <span class="comment">// thread where IO happens</span>
<a name="l00167"></a><a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a09a05ac1704dd4a85b66832bda2cceda">00167</a>         Transport::Listener* <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a09a05ac1704dd4a85b66832bda2cceda">mExistingListener</a>; <span class="comment">// channel&#39;s previous listener</span>
<a name="l00168"></a>00168     
<a name="l00169"></a>00169         <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a186003ae8bed1d75e384706e7f5dc841">OnCloseChannel</a>();
<a name="l00170"></a>00170         <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a17cd2fd83b976c6f21395f00c3472847">OnChannelOpened</a>();
<a name="l00171"></a>00171         <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a7b7e96c58e7fde66fdac41c8f871f371">OnTakeConnectedChannel</a>();
<a name="l00172"></a>00172         <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a7a6c6e43faf36ec5344b0abdbb0a433b">OnEchoMessage</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>* <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>);
<a name="l00173"></a>00173 
<a name="l00174"></a><a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a80035bad432227cd332b4213bf0dd569">00174</a>         <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a80035bad432227cd332b4213bf0dd569">AssertIOThread</a>()<span class="keyword"> const</span>
<a name="l00175"></a>00175 <span class="keyword">        </span>{
<a name="l00176"></a>00176             <a class="code" href="../../dc/d6d/ns_debug_8h.html#a4ef7a344da984edc896f5515d228e537">NS_ABORT_IF_FALSE</a>(<a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aacdc03ef8b2362f0f54a4f1207c5fc8b">mIOLoop</a> == MessageLoop::current(),
<a name="l00177"></a>00177                               <span class="stringliteral">&quot;not on I/O thread!&quot;</span>);
<a name="l00178"></a>00178         }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keyword">public</span>:
<a name="l00181"></a>00181         <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a044135edfc6a425eb5bfb2271d6fab26">ProcessLink</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> *chan);
<a name="l00182"></a>00182         <span class="keyword">virtual</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a439409dd7f6155b4247deeeab63819cf">~ProcessLink</a>();
<a name="l00183"></a>00183         <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a7696ab7bd7e6277e97fb4f1a1cd93f29">Open</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5649c862c228ad6266419a6e80b71983">Transport</a>* aTransport, MessageLoop *aIOLoop, <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351de">Side</a> aSide);
<a name="l00184"></a>00184         
<a name="l00185"></a>00185         <span class="comment">// Run on the I/O thread, only when using inter-process link.</span>
<a name="l00186"></a>00186         <span class="comment">// These methods acquire the monitor and forward to the</span>
<a name="l00187"></a>00187         <span class="comment">// similarly named methods in AsyncChannel below</span>
<a name="l00188"></a>00188         <span class="comment">// (OnMessageReceivedFromLink(), etc)</span>
<a name="l00189"></a>00189         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#ab6211e755a2fc9395b9073bffe693668">OnMessageReceived</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>&amp; <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>) MOZ_OVERRIDE;
<a name="l00190"></a>00190         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a919d79b804b8d0ed906ecee876c3d018">OnChannelConnected</a>(int32_t peer_pid) MOZ_OVERRIDE;
<a name="l00191"></a>00191         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a52d3dfca2783cf5a84ea4f63ee88900f">OnChannelError</a>() MOZ_OVERRIDE;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         virtual <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a5b783d4041e2ab9187f99f2be4ba1416">EchoMessage</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a> *<a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>) MOZ_OVERRIDE;
<a name="l00194"></a>00194         virtual <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aee8b085d7319cc814f3e9f5fe4d6373d">SendMessage</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a> *<a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>) MOZ_OVERRIDE;
<a name="l00195"></a>00195         virtual <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aa16a45fa63b3162ee21deee48b5f0cd2">SendClose</a>() MOZ_OVERRIDE;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         virtual <span class="keywordtype">bool</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a4d8a9e941633bc7b66f4dabfb39c0fda">Unsound_IsClosed</a>() <a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> MOZ_OVERRIDE;
<a name="l00198"></a>00198         virtual uint32_t <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a809a84841b571cd5fc1dd34a29dde6b4">Unsound_NumQueuedMessages</a>() <a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> MOZ_OVERRIDE;
<a name="l00199"></a>00199     };
<a name="l00200"></a>00200     
<a name="l00201"></a><a class="code" href="../../db/d22/classmozilla_1_1ipc_1_1_async_channel_1_1_thread_link.html">00201</a>     class <a class="code" href="../../db/d22/classmozilla_1_1ipc_1_1_async_channel_1_1_thread_link.html">ThreadLink</a> : public <a class="code" href="../../de/dca/classmozilla_1_1ipc_1_1_async_channel_1_1_link.html">Link</a> {
<a name="l00202"></a>00202     <span class="keyword">protected</span>:
<a name="l00203"></a><a class="code" href="../../db/d22/classmozilla_1_1ipc_1_1_async_channel_1_1_thread_link.html#a9aa90a4667d272dbcaa352d9675d85fb">00203</a>         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a>* <a class="code" href="../../db/d22/classmozilla_1_1ipc_1_1_async_channel_1_1_thread_link.html#a9aa90a4667d272dbcaa352d9675d85fb">mTargetChan</a>;
<a name="l00204"></a>00204     
<a name="l00205"></a>00205     <span class="keyword">public</span>:
<a name="l00206"></a>00206         <a class="code" href="../../db/d22/classmozilla_1_1ipc_1_1_async_channel_1_1_thread_link.html">ThreadLink</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> *aChan, <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> *aTargetChan);
<a name="l00207"></a>00207         <span class="keyword">virtual</span> ~<a class="code" href="../../db/d22/classmozilla_1_1ipc_1_1_async_channel_1_1_thread_link.html">ThreadLink</a>();
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a5b783d4041e2ab9187f99f2be4ba1416">EchoMessage</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a> *<a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>) MOZ_OVERRIDE;
<a name="l00210"></a>00210         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aee8b085d7319cc814f3e9f5fe4d6373d">SendMessage</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a> *<a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>) MOZ_OVERRIDE;
<a name="l00211"></a>00211         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#aa16a45fa63b3162ee21deee48b5f0cd2">SendClose</a>() MOZ_OVERRIDE;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         virtual <span class="keywordtype">bool</span> <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a4d8a9e941633bc7b66f4dabfb39c0fda">Unsound_IsClosed</a>() <a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> MOZ_OVERRIDE;
<a name="l00214"></a>00214         virtual uint32_t <a class="code" href="../../d7/d36/classmozilla_1_1ipc_1_1_async_channel_1_1_process_link.html#a809a84841b571cd5fc1dd34a29dde6b4">Unsound_NumQueuedMessages</a>() <a class="code" href="../../d6/d92/cdefs_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> MOZ_OVERRIDE;
<a name="l00215"></a>00215     };
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 protected:
<a name="l00218"></a>00218     <span class="comment">// The &quot;link&quot; thread is either the I/O thread (ProcessLink) or the</span>
<a name="l00219"></a>00219     <span class="comment">// other actor&#39;s work thread (ThreadLink).  In either case, it is</span>
<a name="l00220"></a>00220     <span class="comment">// NOT our worker thread.</span>
<a name="l00221"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ab5de1eeb0ceb95f36e5c7b88b6aed176">00221</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ab5de1eeb0ceb95f36e5c7b88b6aed176">AssertLinkThread</a>()<span class="keyword"> const</span>
<a name="l00222"></a>00222 <span class="keyword">    </span>{
<a name="l00223"></a>00223         <a class="code" href="../../dc/d6d/ns_debug_8h.html#a4ef7a344da984edc896f5515d228e537">NS_ABORT_IF_FALSE</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#afefdd64408e701eb13398f2d710b3bb9">mWorkerLoopID</a> != MessageLoop::current()-&gt;<span class="keywordtype">id</span>(),
<a name="l00224"></a>00224                           <span class="stringliteral">&quot;on worker thread but should not be!&quot;</span>);
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">// Can be run on either thread</span>
<a name="l00228"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aacc4b98ddad0e571c51cf9522db69ef9">00228</a>     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aacc4b98ddad0e571c51cf9522db69ef9">AssertWorkerThread</a>()<span class="keyword"> const</span>
<a name="l00229"></a>00229 <span class="keyword">    </span>{
<a name="l00230"></a>00230         <a class="code" href="../../dc/d6d/ns_debug_8h.html#a4ef7a344da984edc896f5515d228e537">NS_ABORT_IF_FALSE</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#afefdd64408e701eb13398f2d710b3bb9">mWorkerLoopID</a> == MessageLoop::current()-&gt;<span class="keywordtype">id</span>(),
<a name="l00231"></a>00231                           <span class="stringliteral">&quot;not on worker thread!&quot;</span>);
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 
<a name="l00234"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#adb8014209be5e14dc97cc2a0e75c3fea">00234</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#adb8014209be5e14dc97cc2a0e75c3fea">Connected</a>()<span class="keyword"> const </span>{
<a name="l00235"></a>00235         <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a1256251e64fdefc2728f28fb0294bfcb">mMonitor</a>-&gt;AssertCurrentThreadOwns();
<a name="l00236"></a>00236         <span class="comment">// The transport layer allows us to send messages before</span>
<a name="l00237"></a>00237         <span class="comment">// receiving the &quot;connected&quot; ack from the remote side.</span>
<a name="l00238"></a>00238         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da0081651e3d96442dde7234c10b5f05c7">ChannelOpening</a> == <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a078363118cfb1d16492c2c032c7eb984">mChannelState</a> ||
<a name="l00239"></a>00239                 <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703da32046d26ed9fac29ba27e7c89156f2ce">ChannelConnected</a> == <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a078363118cfb1d16492c2c032c7eb984">mChannelState</a>);
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <span class="comment">// Return true if |msg| is a special message targeted at the IO</span>
<a name="l00243"></a>00243     <span class="comment">// thread, in which case it shouldn&#39;t be delivered to the worker.</span>
<a name="l00244"></a>00244     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a073c7031b4e72d19817603b3b948b88d">MaybeInterceptSpecialIOMessage</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>&amp; <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>);
<a name="l00245"></a>00245     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a962cbeacc3fed732a8b45ddafc60768d">ProcessGoodbyeMessage</a>();
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     <span class="comment">// Runs on the link thread. Invoked either from the I/O thread methods above</span>
<a name="l00248"></a>00248     <span class="comment">// or directly from the other actor if using a thread-based link.</span>
<a name="l00249"></a>00249     <span class="comment">// </span>
<a name="l00250"></a>00250     <span class="comment">// n.b.: mMonitor is always held when these methods are invoked.</span>
<a name="l00251"></a>00251     <span class="comment">// In the case of a ProcessLink, it is acquired by the ProcessLink.</span>
<a name="l00252"></a>00252     <span class="comment">// In the case of a ThreadLink, it is acquired by the other actor, </span>
<a name="l00253"></a>00253     <span class="comment">// which then invokes these methods directly.</span>
<a name="l00254"></a>00254     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a6be9d73a23ac162f2c9181cc220a7771">OnMessageReceivedFromLink</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>&amp; <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>);
<a name="l00255"></a>00255     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#af8e0c86a1007d7962ec6aaf80581fbf6">OnChannelErrorFromLink</a>();
<a name="l00256"></a>00256     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a3c8809c3b3c8020788b9a5ba685db9cf">PostErrorNotifyTask</a>();
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     <span class="comment">// Run on the worker thread</span>
<a name="l00259"></a>00259     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#adc56ce6ec4608247523701f070fe7851">OnDispatchMessage</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>&amp; aMsg);
<a name="l00260"></a>00260     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a37d6efae7390c077aa004720a381e0bf">OnSpecialMessage</a>(uint16_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>&amp; <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>);
<a name="l00261"></a>00261     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ada3b1c3c816e4d3684e36b2631971b6c">SendSpecialMessage</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4d0b7ee2f684312d3be9d03a7490c4ce">Message</a>* <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a>) <span class="keyword">const</span>;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="comment">// Tell the IO thread to close the channel and wait for it to ACK.</span>
<a name="l00264"></a>00264     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a8af43da9b8455d75bd75f8066b81573e">SynchronouslyClose</a>();
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a89402a6cadb5e90c0a9bdd88de35e567">MaybeHandleError</a>(<a class="code" href="../../df/d8b/structmozilla_1_1ipc_1_1_has_result_codes.html#ae4ceb3b2a815774b1088ca96ba901fd4">Result</a> <a class="code" href="../../d3/d4b/lockscreen_8js.html#a3bc1c2f8ec4ed34fc21f9f10eacbfa93">code</a>, <span class="keyword">const</span> <span class="keywordtype">char</span>* channelName);
<a name="l00267"></a>00267     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a749ab48bf0bbfabf2474a30bf0797885">ReportConnectionError</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* channelName) <span class="keyword">const</span>;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     <span class="comment">// Run on the worker thread</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a0e5cc3e67646c704901ea62c19bd98d1">OnNotifyMaybeChannelError</a>();
<a name="l00272"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4f46b03587eb835e4cf260bbc0fb81dd">00272</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a4f46b03587eb835e4cf260bbc0fb81dd">ShouldDeferNotifyMaybeError</a>()<span class="keyword"> const </span>{
<a name="l00273"></a>00273         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#abdca0c22703de3432bfecdeb042f4d92">NotifyChannelClosed</a>();
<a name="l00276"></a>00276     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#abc1d10adec3296e6858fd7bdc61c3d4c">NotifyMaybeChannelError</a>();
<a name="l00277"></a>00277     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ab0da52f9068a3a2b0a181a750c499eac">OnOpenAsSlave</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> *aTargetChan, <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351de">Side</a> aSide);
<a name="l00278"></a>00278     <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac8fb1bc2c9ae15f0003f14cf13fa018f">CommonThreadOpenInit</a>(<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html">AsyncChannel</a> *aTargetChan, <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#aad2fd5a70a9f45dd1459065a23c351de">Side</a> aSide);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ab72e7e385d3d679f1a643083f32fa2b1">Clear</a>();
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a35d8c9cf87361d9b45cc0f3626ae8885">00282</a>     <a class="code" href="../../d6/dcd/classmozilla_1_1_weak_ptr.html">mozilla::WeakPtr&lt;AsyncListener&gt;</a> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a35d8c9cf87361d9b45cc0f3626ae8885">mListener</a>;
<a name="l00283"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a078363118cfb1d16492c2c032c7eb984">00283</a>     <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac004b147d4b396a76043c9e569a5703d">ChannelState</a> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a078363118cfb1d16492c2c032c7eb984">mChannelState</a>;
<a name="l00284"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a1256251e64fdefc2728f28fb0294bfcb">00284</a>     <a class="code" href="../../d0/d01/classns_ref_ptr.html">nsRefPtr&lt;RefCountedMonitor&gt;</a> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a1256251e64fdefc2728f28fb0294bfcb">mMonitor</a>;
<a name="l00285"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac9372449dfcfb358803485b5fceb8676">00285</a>     MessageLoop* <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#ac9372449dfcfb358803485b5fceb8676">mWorkerLoop</a>;   <span class="comment">// thread where work is done</span>
<a name="l00286"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5d3eae800bc981fb96a0aef0a3354624">00286</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a5d3eae800bc981fb96a0aef0a3354624">mChild</a>;                <span class="comment">// am I the child or parent?</span>
<a name="l00287"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a15778004e953f3638cc23fc57561a805">00287</a>     CancelableTask* <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a15778004e953f3638cc23fc57561a805">mChannelErrorTask</a>; <span class="comment">// NotifyMaybeChannelError runnable</span>
<a name="l00288"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a029ce4eceef5b03bd0231cd1df7153ea">00288</a>     Link *<a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#a029ce4eceef5b03bd0231cd1df7153ea">mLink</a>;                <span class="comment">// link to other thread/process</span>
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <span class="comment">// id() of mWorkerLoop.  This persists even after mWorkerLoop is cleared</span>
<a name="l00291"></a>00291     <span class="comment">// during channel shutdown.</span>
<a name="l00292"></a><a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#afefdd64408e701eb13398f2d710b3bb9">00292</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d7e/classmozilla_1_1ipc_1_1_async_channel.html#afefdd64408e701eb13398f2d710b3bb9">mWorkerLoopID</a>;
<a name="l00293"></a>00293 };
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 } <span class="comment">// namespace ipc</span>
<a name="l00296"></a>00296 } <span class="comment">// namespace mozilla</span>
<a name="l00297"></a>00297 <span class="preprocessor">#endif  // ifndef ipc_glue_AsyncChannel_h</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d2/da7/_async_channel_8h.html">AsyncChannel.h</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:50:54に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
