<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: utils_test.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d2/dfb/clock_2test_2unit_2utils__test_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a>  </div>
  <div class="headertitle">
<div class="title">utils_test.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../d2/dfb/clock_2test_2unit_2utils__test_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dfb/clock_2test_2unit_2utils__test_8js.html#ae3f4a220224ec995993868b05e81bfc1">requireApp</a> ('clock/js/constants.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dfb/clock_2test_2unit_2utils__test_8js.html#aa2c0db5e71a62ddea94df80b79196a7f">suite</a> ('<a class="el" href="../../d3/d91/j3d_8js.html#a960e7c2189224c021b07d962e5c60bd0">Time</a> functions', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#changeSelectByValue', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var changeSelectByValue, selectDOM;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){changeSelectByValue=Utils.changeSelectByValue;selectDOM=document.createElement('<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a974637b453a6c3808b55236762181a2f">select</a>');<a class="el" href="../../d1/d04/app__install__manager_8js.html#acd145aedb51101ac15a526f73673b0b9">selectDOM.innerHTML</a>=['&lt; option <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>=&quot;a&quot;&gt;A&lt;/option &gt;', '&lt; option <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>=&quot;b&quot;&gt;B&lt;/option &gt;', '&lt; option <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>=&quot;c&quot;selected &gt;C&lt;/option &gt;'].<a class="el" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>('');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('correctly selects the specified element', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){changeSelectByValue(selectDOM, '<a class="el" href="../../da/ded/jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(selectDOM.selectedIndex, 1);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('has no effect when specified element does not exist', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){changeSelectByValue(selectDOM, '<a class="el" href="../../d2/d77/build__stage_2email_2js_2ext_2mailapi_2chewlayer_8js.html#a73c18c59a39b18382081ec00bb456d43">g</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(selectDOM.selectedIndex, 2);});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#parseTime', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var parseTime;suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){parseTime=Utils.parseTime;});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('12:10am', function(){var time=parseTime('12:10AM');assert.equal(time.hour, 0);assert.equal(time.minute, 10);});test('12:00pm', function(){var time=parseTime('12:00PM');assert.equal(time.hour, 12);assert.equal(time.minute, 00);});test('11:30pm', function(){var time=parseTime('11:30PM');assert.equal(time.hour, 23);assert.equal(time.minute, 30);});test('00:15', function(){var time=parseTime('12:15AM');assert.equal(time.hour, 0);assert.equal(time.minute, 15);});test('23:45', function(){var time=parseTime('23:45');assert.equal(time.hour, 23);assert.equal(time.minute, 45);});});suite('#dateMath', function(){suiteSetup(function(){this.sixAm=1373954400000;this.dat=new Date(this.sixAm+15120000);this.allNeg={hours:-4, minutes:-15, seconds:-2};this.someNeg={hours:4, minutes:-15, seconds:2};this.overflow={hours:4, minutes:0, seconds:902};this.skip={hours:4, seconds:902};});setup(function(){this.clock=this.sinon.useFakeTimers(this.sixAm);});suite('toMS', function(){test('returns correct millisecond value ', function(){assert.equal(Utils.dateMath.toMS(this.skip), 15302000);assert.equal(Utils.dateMath.toMS(this.overflow), 15302000);});test('any/all negative input result in negative output ', function(){assert.ok(Utils.dateMath.toMS(this.someNeg)&lt; 0);assert.ok(Utils.dateMath.toMS(this.allNeg)&lt; 0);});test('all positive input result in positive output ', function(){assert.ok(Utils.dateMath.toMS(this.dat) &gt; 0);assert.ok(Utils.dateMath.toMS(this.skip) &gt; 0);});test('accepts plural or singular unit names ', function(){assert.equal(Utils.dateMath.toMS(this.skip,{unitsPartial:['hours', 'second']}), 15302000);});});suite('fromMS', function(){suiteSetup(function(){this.negtime=-140000;this.hour=1000 *60 *60;this.fourish=15120000;});test('returns a correctly formed object ', function(){assert.deepEqual(Utils.dateMath.fromMS(this.fourish,{unitsPartial:['hours', 'minutes']}),{hours:4, minutes:12});});test('returns correct signs ', function(){var pos, neg;pos=Utils.dateMath.fromMS(this.hour);neg=Utils.dateMath.fromMS(this.negtime);assert.ok(Object.keys(pos).every(function(unit){return pos[unit] &gt;=0;}));assert.ok(Object.keys(neg).every(function(unit){return neg[unit]&lt;=0;}));});test('returns desired granularity ', function(){assert.deepEqual(Utils.dateMath.fromMS(this.hour,{unitsPartial:['minutes']}),{minutes:60});assert.deepEqual(Utils.dateMath.fromMS(this.fourish,{unitsPartial:['minutes']}),{minutes:252});});test('accepts plural or singular unit names ', function(){assert.deepEqual(Utils.dateMath.fromMS(this.fourish,{unitsPartial:['hour', 'minute']}),{hours:4, minutes:12});});});});suite('data tests', function(){suite('compare tests', function(){test('numbers', function(){assert.equal(Utils.data.defaultCompare(42, 42), 0);assert.equal(Utils.data.defaultCompare(0, 0), 0);assert.equal(Utils.data.defaultCompare(0, 1),-1);assert.equal(Utils.data.defaultCompare(1, 0), 1);var e1, e2;try{Utils.data.defaultCompare(1,{});}catch(err){e1=err;}assert.ok(e1);try{Utils.data.defaultCompare({}, 1);}catch(err){e2=err;}assert.ok(e2);});test('strings', function(){assert.equal(Utils.data.defaultCompare('abc', 'abc'), 0);assert.equal(Utils.data.defaultCompare('abc', 'abd'),-1);assert.equal(Utils.data.defaultCompare('abc', 'abb'), 1);assert.equal(Utils.data.defaultCompare('abc', 'abcd'),-1);assert.equal(Utils.data.defaultCompare('abc', 'ab'), 1);var e;try{Utils.data.defaultCompare('abc', 1);}catch(err){e=err;}assert.ok(e);});test('arrays', function(){assert.equal(Utils.data.defaultCompare([1, 2, 3],[1, 2, 3]), 0);assert.equal(Utils.data.defaultCompare([1, 2, 3],[1, 2, 4]),-1);assert.equal(Utils.data.defaultCompare([1, 2, 3],[1, 2, 2]), 1);var e;try{Utils.data.defaultCompare('abc', 1);}catch(err){e=err;}assert.ok(e);});});suite('binarySearch', function(){var genMatchTest=function(arr, search, idx){test('length '+arr.length+ ', match for '+JSON.stringify(search), function(){var res=Utils.data.binarySearch({value:search}, arr, Utils.data.keyedCompare('value'));assert.deepEqual(res,{match:true, index:idx, value:arr[idx]});});};var genNoMatchTest=function(arr, search, idx){test('length '+arr.length+ ', no match for '+JSON.stringify(search), function(){var res=Utils.data.binarySearch({value:search}, arr, Utils.data.keyedCompare('value'));assert.deepEqual(res,{match:false, index:idx});});};var array14=[{value:1},{value:11},{value:25},{value:28},{value:30},{value:36},{value:48},{value:54},{value:54},{value:59},{value:61},{value:82},{value:82},{value:85}];var array15=[{value:1},{value:11},{value:25},{value:28},{value:30},{value:36},{value:48},{value:54},{value:54},{value:59},{value:61},{value:82},{value:82},{value:85},{value:98}];test('zero length', function(){var res=Utils.data.binarySearch(34,[]);assert.deepEqual(res,{match:false, index:0});});test('length one, no match', function(){var res=Utils.data.binarySearch(34,[5]);assert.deepEqual(res,{match:false, index:1});});test('length one, match', function(){var res=Utils.data.binarySearch(34,[34]);assert.deepEqual(res,{match:true, index:0, value:34});});genMatchTest(array14, 1, 0);genMatchTest(array14, 85, 13);genNoMatchTest(array14,-1, 0);genNoMatchTest(array14, 52, 7);genNoMatchTest(array14, 101, 14);genMatchTest(array15, 1, 0);genMatchTest(array15, 98, 14);genNoMatchTest(array15,-1, 0);genNoMatchTest(array15, 52, 7);genNoMatchTest(array15, 101, 15);});suite('sortedInsert', function(){var array=[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82, 91];test('zero length insert', function(){var x=[];var res=Utils.data.sortedInsert(3, x);assert.deepEqual(x,[3]);assert.equal(res, 0);});test('beginning insert', function(){var x=array.slice();var res=Utils.data.sortedInsert(-10, x);assert.equal(x[0],-10);assert.equal(x.length, array.length+1);assert.equal(res, 0);});test('middle insert', function(){var x=array.slice();var res=Utils.data.sortedInsert(43, x);assert.equal(x[6], 43);assert.equal(x.length, array.length+1);assert.equal(res, 6);});test('end insert', function(){var x=array.slice();var res=Utils.data.sortedInsert(99, x);assert.equal(x[x.length-1], 99);assert.equal(x.length, array.length+1);assert.equal(res, array.length);});});suite('sortedRemove', function(){var array=[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82, 91];test('zero length remove', function(){var x=[];var res=Utils.data.sortedRemove(3, x);assert.equal(res, false);});test('length one remove', function(){var x=[3];var res=Utils.data.sortedRemove(3, x);assert.deepEqual(x,[]);assert.equal(res, true);});test('beginning remove', function(){var x=array.slice();var res=Utils.data.sortedRemove(1, x);assert.deepEqual(x,[8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82, 91]);assert.equal(res, true);});test('middle remove', function(){var x=array.slice();var res=Utils.data.sortedRemove(58, x);assert.deepEqual(x,[1, 8, 9, 19, 38, 42, 44, 56, 64, 74, 82, 91]);assert.equal(res, true);});test('end remove', function(){var x=array.slice();var res=Utils.data.sortedRemove(91, x);assert.deepEqual(x,[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82]);assert.equal(res, true);});test('beginning multi remove', function(){var x=[3, 3, 3, 3, 3, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82];var res=Utils.data.sortedRemove(3, x, undefined, true);assert.deepEqual(x,[8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82]);assert.equal(res, true);});test('middle multi remove', function(){var x=[1, 8, 9, 19, 21, 21, 21, 21, 38, 42, 44, 56, 58, 64, 74, 82];var res=Utils.data.sortedRemove(21, x, undefined, true);assert.deepEqual(x,[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82]);assert.equal(res, true);});test('end multi remove', function(){var x=[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82, 99, 99, 99];var res=Utils.data.sortedRemove(99, x, undefined, true);assert.deepEqual(x,[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82]);assert.equal(res, true);});});});suite('extend tests', function(){function hasOwn(obj, prop){return Object.prototype.hasOwnProperty.call(obj, prop);}function hasAny(obj, prop){return hasOwn(obj, prop)||(obj!==Object.prototype &amp;&amp;hasAny(obj.__proto__, prop));}function testObject(){return Object.create(Object.create({grandparents:4},{parents:{value:2}}),{me:{value:1}});}test('basic extend', function(){var x={};var y=Utils.extend(x,{a:1, b:2, c:3});assert.ok(x===y, 'x===y');assert.ok(hasOwn(x, 'a')&amp;&amp;x.a===1);assert.ok(hasOwn(x, 'b')&amp;&amp;x.b===2);assert.ok(hasOwn(x, 'c')&amp;&amp;x.c===3);});test('extend only affects child instance', function(){var x=testObject(), y;y=Utils.extend(x,{favoriteColor: 'green'});assert.ok(x===y, 'x===y');assert.equal(x.favoriteColor, 'green');assert.ok(hasOwn(x, 'favoriteColor'));assert.ok(!hasAny(x.__proto__, 'favoriteColor'));});test('multiple extend', function(){var x=Utils.extend({},{a:42},{a:1, b:19, c:45},{b:199});assert.equal(x.a, 1);assert.equal(x.b, 199);assert.equal(x.c, 45);});});suite('safeCpuLock tests', function(){setup(function(){this.mocklock=new MockRequestWakeLock();this.sinon.stub(navigator, 'requestWakeLock', this.mocklock.requestWakeLock.bind(this.mocklock));this.sinon.useFakeTimers();});teardown(function(){this.sinon.restore(navigator, 'requestWakeLock');});test('locks CPU', function(){var callback=this.sinon.spy(function(unlock){assert.ok(navigator.requestWakeLock.calledOnce);});Utils.safeCpuLock(15000, callback);this.sinon.clock.tick(16000);assert.ok(callback.calledOnce);});test('single unlock', function(){Utils.safeCpuLock(15000, function(unlock){unlock();});this.sinon.clock.tick(16000);var locks=this.mocklock.getissued();assert.equal(locks.length, 1);assert.equal(locks[0].unlocks, 1);});test('no duplicate unlock', function(){var here=0;Utils.safeCpuLock(15000, function(unlock){setTimeout(function(){here++;unlock();}, 16000);here++;});this.sinon.clock.tick(17000);var locks=this.mocklock.getissued();assert.equal(locks.length, 1);assert.equal(locks[0].unlocks, 1);assert.equal(here, 2);});test('timeout unlock', function(){var here=false;Utils.safeCpuLock(15000, function(unlock){here=true;});this.sinon.clock.tick(16000);var locks=this.mocklock.getissued();assert.equal(locks.length, 1);assert.equal(locks[0].unlocks, 1);assert.ok(here);});test('exception in callback still unlocks CPU', function(){var here=false;try{Utils.safeCpuLock(15000, function(unlock){here=true;throw new Error('gotcha');});this.sinon.clock.tick(16000);}catch(err){assert.equal(err.message, 'gotcha');}var locks=this.mocklock.getissued();assert.equal(locks.length, 1);assert.equal(locks[0].unlocks, 1);assert.ok(here);});});suite('format', function(){suite('time(hh, mm) ', function(){var is12hStub, formatTime;setup(function(){formatTime=Utils.format.time;is12hStub=sinon.stub(Utils, 'is12hFormat');});teardown(function(){is12hStub.restore();});test('12:00am, with 12 hour clock settings', function(){is12hStub.returns(true);assert.equal(formatTime(0, 0), '12:00AM');});test('12:30pm, with 12 hour clock settings', function(){is12hStub.returns(true);assert.equal(formatTime(12, 30), '12:30PM');});test('11:30pm, with 12 hour clock settings', function(){is12hStub.returns(true);assert.equal(formatTime(23, 30), '11:30PM');});test('12:30am, with 24 hour clock settings', function(){is12hStub.returns(false);assert.equal(formatTime(0, 30), '00:30');});test('12:30pm, with 24 hour clock settings', function(){is12hStub.returns(false);assert.equal(formatTime(12, 30), '12:30');});test('11:30pm, with 24 hour clock settings', function(){is12hStub.returns(false);assert.equal(formatTime(23, 30), '23:30');});});suite('hms()', function(){var hms;suiteSetup(function(){hms=Utils.format.hms;});suite('hms(seconds) ', function(){var fixtures=[{args:[0], expect: '00:00:00'},{args:[1], expect: '00:00:01'},{args:[59], expect: '00:00:59'},{args:[60], expect: '00:01:00'},{args:[3600], expect: '01:00:00'}];fixtures.forEach(function(fixture){var{args, expect}=fixture;var title=args.map(String).join(', ')+ '=&gt; '+expect+ ' ';test(title, function(){assert.equal(hms.apply(null, args), expect);});});});suite('hms(seconds, format) ', function(){var fixtures=[{args:[0, 'ss'], expect: '00'},{args:[1, 'ss'], expect: '01'},{args:[60, 'ss'], expect: '00'},{args:[0, 'mm:ss'], expect: '00:00'},{args:[59, 'mm:ss'], expect: '00:59'},{args:[60, 'mm:ss'], expect: '01:00'},{args:[3600, 'mm:ss'], expect: '00:00'},{args:[3600, 'hh:mm:ss'], expect: '01:00:00'}];fixtures.forEach(function(fixture){var{args, expect}=fixture;var title=args.map(String).join(', ')+ '=&gt; '+expect+ ' ';test(title, function(){assert.equal(hms.apply(null, args), expect);});});});});});suite('async', function(){test('generators', function(){var spy=this.sinon.spy(function(){assert.equal(arguments[0], null);assert.equal(arguments.length, 1);});var gen=Utils.async.generator(spy);var collection=[];for(var i=0;i&lt; 100;i++){collection.push(gen());}assert.ok(!spy.called);for(var k of collection){k();}assert.ok(spy.calledOnce);});test('generators error', function(){var spy=this.sinon.spy(function(){assert.equal(arguments[0], 1);assert.equal(arguments.length, 1);});var gen=Utils.async.generator(spy);var collection=[];for(var i=0;i&lt; 100;i++){collection.push(gen());}assert.ok(!spy.called);var j=1;for(var k of collection){k(j++);}assert.ok(spy.calledOnce);});test('namedParallel', function(){var spy=this.sinon.spy(function(){assert.equal(arguments[0], null);assert.equal(arguments.length, 1);});var names=Utils.async.namedParallel([ 'testa', 'testb', 'testc'], spy);assert.ok(!spy.called);names.testa();assert.ok(!spy.called);names.testb();assert.ok(!spy.called);names.testc();assert.ok(spy.calledOnce);});test('namedParallel error', function(){var spy=this.sinon.spy(function(){assert.equal(arguments[0], 'testing b');assert.equal(arguments.length, 1);});var names=Utils.async.namedParallel([ 'testa', 'testb', 'testc'], spy);assert.ok(!spy.called);names.testa();assert.ok(!spy.called);names.testb('testing b');assert.ok(spy.calledOnce);names.testc();assert.ok(spy.calledOnce);});});})</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="ae3f4a220224ec995993868b05e81bfc1"></a><!-- doxytag: member="clock/test/unit/utils_test.js::requireApp" ref="ae3f4a220224ec995993868b05e81bfc1" args="('clock/js/constants.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d16/shared_2test_2unit_2mocks_2mock__settings__listener_8js.html#ada5f8f0f77028802cd46c92cb1ce8fce">requireApp</a> </td>
          <td>(</td>
          <td class="paramtype">'clock/js/constants.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aa2c0db5e71a62ddea94df80b79196a7f"></a><!-- doxytag: member="clock/test/unit/utils_test.js::suite" ref="aa2c0db5e71a62ddea94df80b79196a7f" args="('Time functions', function(){suite('#changeSelectByValue', function(){var changeSelectByValue, selectDOM;setup(function(){changeSelectByValue=Utils.changeSelectByValue;selectDOM=document.createElement('select');selectDOM.innerHTML=['&lt; option value=&quot;a&quot;&gt;A&lt;/option &gt;', '&lt; option value=&quot;b&quot;&gt;B&lt;/option &gt;', '&lt; option value=&quot;c&quot;selected &gt;C&lt;/option &gt;'].join('');});test('correctly selects the specified element', function(){changeSelectByValue(selectDOM, 'b');assert.equal(selectDOM.selectedIndex, 1);});test('has no effect when specified element does not exist', function(){changeSelectByValue(selectDOM, 'g');assert.equal(selectDOM.selectedIndex, 2);});});suite('#parseTime', function(){var parseTime;suiteSetup(function(){parseTime=Utils.parseTime;});test('12:10am', function(){var time=parseTime('12:10AM');assert.equal(time.hour, 0);assert.equal(time.minute, 10);});test('12:00pm', function(){var time=parseTime('12:00PM');assert.equal(time.hour, 12);assert.equal(time.minute, 00);});test('11:30pm', function(){var time=parseTime('11:30PM');assert.equal(time.hour, 23);assert.equal(time.minute, 30);});test('00:15', function(){var time=parseTime('12:15AM');assert.equal(time.hour, 0);assert.equal(time.minute, 15);});test('23:45', function(){var time=parseTime('23:45');assert.equal(time.hour, 23);assert.equal(time.minute, 45);});});suite('#dateMath', function(){suiteSetup(function(){this.sixAm=1373954400000;this.dat=new Date(this.sixAm+15120000);this.allNeg={hours:&#45;4, minutes:&#45;15, seconds:&#45;2};this.someNeg={hours:4, minutes:&#45;15, seconds:2};this.overflow={hours:4, minutes:0, seconds:902};this.skip={hours:4, seconds:902};});setup(function(){this.clock=this.sinon.useFakeTimers(this.sixAm);});suite('toMS', function(){test('returns correct millisecond value ', function(){assert.equal(Utils.dateMath.toMS(this.skip), 15302000);assert.equal(Utils.dateMath.toMS(this.overflow), 15302000);});test('any/all negative input result in negative output ', function(){assert.ok(Utils.dateMath.toMS(this.someNeg)&lt; 0);assert.ok(Utils.dateMath.toMS(this.allNeg)&lt; 0);});test('all positive input result in positive output ', function(){assert.ok(Utils.dateMath.toMS(this.dat) &gt; 0);assert.ok(Utils.dateMath.toMS(this.skip) &gt; 0);});test('accepts plural or singular unit names ', function(){assert.equal(Utils.dateMath.toMS(this.skip,{unitsPartial:['hours', 'second']}), 15302000);});});suite('fromMS', function(){suiteSetup(function(){this.negtime=&#45;140000;this.hour=1000 *60 *60;this.fourish=15120000;});test('returns a correctly formed object ', function(){assert.deepEqual(Utils.dateMath.fromMS(this.fourish,{unitsPartial:['hours', 'minutes']}),{hours:4, minutes:12});});test('returns correct signs ', function(){var pos, neg;pos=Utils.dateMath.fromMS(this.hour);neg=Utils.dateMath.fromMS(this.negtime);assert.ok(Object.keys(pos).every(function(unit){return pos[unit] &gt;=0;}));assert.ok(Object.keys(neg).every(function(unit){return neg[unit]&lt;=0;}));});test('returns desired granularity ', function(){assert.deepEqual(Utils.dateMath.fromMS(this.hour,{unitsPartial:['minutes']}),{minutes:60});assert.deepEqual(Utils.dateMath.fromMS(this.fourish,{unitsPartial:['minutes']}),{minutes:252});});test('accepts plural or singular unit names ', function(){assert.deepEqual(Utils.dateMath.fromMS(this.fourish,{unitsPartial:['hour', 'minute']}),{hours:4, minutes:12});});});});suite('data tests', function(){suite('compare tests', function(){test('numbers', function(){assert.equal(Utils.data.defaultCompare(42, 42), 0);assert.equal(Utils.data.defaultCompare(0, 0), 0);assert.equal(Utils.data.defaultCompare(0, 1),&#45;1);assert.equal(Utils.data.defaultCompare(1, 0), 1);var e1, e2;try{Utils.data.defaultCompare(1,{});}catch(err){e1=err;}assert.ok(e1);try{Utils.data.defaultCompare({}, 1);}catch(err){e2=err;}assert.ok(e2);});test('strings', function(){assert.equal(Utils.data.defaultCompare('abc', 'abc'), 0);assert.equal(Utils.data.defaultCompare('abc', 'abd'),&#45;1);assert.equal(Utils.data.defaultCompare('abc', 'abb'), 1);assert.equal(Utils.data.defaultCompare('abc', 'abcd'),&#45;1);assert.equal(Utils.data.defaultCompare('abc', 'ab'), 1);var e;try{Utils.data.defaultCompare('abc', 1);}catch(err){e=err;}assert.ok(e);});test('arrays', function(){assert.equal(Utils.data.defaultCompare([1, 2, 3],[1, 2, 3]), 0);assert.equal(Utils.data.defaultCompare([1, 2, 3],[1, 2, 4]),&#45;1);assert.equal(Utils.data.defaultCompare([1, 2, 3],[1, 2, 2]), 1);var e;try{Utils.data.defaultCompare('abc', 1);}catch(err){e=err;}assert.ok(e);});});suite('binarySearch', function(){var genMatchTest=function(arr, search, idx){test('length '+arr.length+ ', match for '+JSON.stringify(search), function(){var res=Utils.data.binarySearch({value:search}, arr, Utils.data.keyedCompare('value'));assert.deepEqual(res,{match:true, index:idx, value:arr[idx]});});};var genNoMatchTest=function(arr, search, idx){test('length '+arr.length+ ', no match for '+JSON.stringify(search), function(){var res=Utils.data.binarySearch({value:search}, arr, Utils.data.keyedCompare('value'));assert.deepEqual(res,{match:false, index:idx});});};var array14=[{value:1},{value:11},{value:25},{value:28},{value:30},{value:36},{value:48},{value:54},{value:54},{value:59},{value:61},{value:82},{value:82},{value:85}];var array15=[{value:1},{value:11},{value:25},{value:28},{value:30},{value:36},{value:48},{value:54},{value:54},{value:59},{value:61},{value:82},{value:82},{value:85},{value:98}];test('zero length', function(){var res=Utils.data.binarySearch(34,[]);assert.deepEqual(res,{match:false, index:0});});test('length one, no match', function(){var res=Utils.data.binarySearch(34,[5]);assert.deepEqual(res,{match:false, index:1});});test('length one, match', function(){var res=Utils.data.binarySearch(34,[34]);assert.deepEqual(res,{match:true, index:0, value:34});});genMatchTest(array14, 1, 0);genMatchTest(array14, 85, 13);genNoMatchTest(array14,&#45;1, 0);genNoMatchTest(array14, 52, 7);genNoMatchTest(array14, 101, 14);genMatchTest(array15, 1, 0);genMatchTest(array15, 98, 14);genNoMatchTest(array15,&#45;1, 0);genNoMatchTest(array15, 52, 7);genNoMatchTest(array15, 101, 15);});suite('sortedInsert', function(){var array=[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82, 91];test('zero length insert', function(){var x=[];var res=Utils.data.sortedInsert(3, x);assert.deepEqual(x,[3]);assert.equal(res, 0);});test('beginning insert', function(){var x=array.slice();var res=Utils.data.sortedInsert(&#45;10, x);assert.equal(x[0],&#45;10);assert.equal(x.length, array.length+1);assert.equal(res, 0);});test('middle insert', function(){var x=array.slice();var res=Utils.data.sortedInsert(43, x);assert.equal(x[6], 43);assert.equal(x.length, array.length+1);assert.equal(res, 6);});test('end insert', function(){var x=array.slice();var res=Utils.data.sortedInsert(99, x);assert.equal(x[x.length&#45;1], 99);assert.equal(x.length, array.length+1);assert.equal(res, array.length);});});suite('sortedRemove', function(){var array=[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82, 91];test('zero length remove', function(){var x=[];var res=Utils.data.sortedRemove(3, x);assert.equal(res, false);});test('length one remove', function(){var x=[3];var res=Utils.data.sortedRemove(3, x);assert.deepEqual(x,[]);assert.equal(res, true);});test('beginning remove', function(){var x=array.slice();var res=Utils.data.sortedRemove(1, x);assert.deepEqual(x,[8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82, 91]);assert.equal(res, true);});test('middle remove', function(){var x=array.slice();var res=Utils.data.sortedRemove(58, x);assert.deepEqual(x,[1, 8, 9, 19, 38, 42, 44, 56, 64, 74, 82, 91]);assert.equal(res, true);});test('end remove', function(){var x=array.slice();var res=Utils.data.sortedRemove(91, x);assert.deepEqual(x,[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82]);assert.equal(res, true);});test('beginning multi remove', function(){var x=[3, 3, 3, 3, 3, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82];var res=Utils.data.sortedRemove(3, x, undefined, true);assert.deepEqual(x,[8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82]);assert.equal(res, true);});test('middle multi remove', function(){var x=[1, 8, 9, 19, 21, 21, 21, 21, 38, 42, 44, 56, 58, 64, 74, 82];var res=Utils.data.sortedRemove(21, x, undefined, true);assert.deepEqual(x,[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82]);assert.equal(res, true);});test('end multi remove', function(){var x=[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82, 99, 99, 99];var res=Utils.data.sortedRemove(99, x, undefined, true);assert.deepEqual(x,[1, 8, 9, 19, 38, 42, 44, 56, 58, 64, 74, 82]);assert.equal(res, true);});});});suite('extend tests', function(){function hasOwn(obj, prop){return Object.prototype.hasOwnProperty.call(obj, prop);}function hasAny(obj, prop){return hasOwn(obj, prop)||(obj!==Object.prototype &amp;&amp;hasAny(obj.__proto__, prop));}function testObject(){return Object.create(Object.create({grandparents:4},{parents:{value:2}}),{me:{value:1}});}test('basic extend', function(){var x={};var y=Utils.extend(x,{a:1, b:2, c:3});assert.ok(x===y, 'x===y');assert.ok(hasOwn(x, 'a')&amp;&amp;x.a===1);assert.ok(hasOwn(x, 'b')&amp;&amp;x.b===2);assert.ok(hasOwn(x, 'c')&amp;&amp;x.c===3);});test('extend only affects child instance', function(){var x=testObject(), y;y=Utils.extend(x,{favoriteColor: 'green'});assert.ok(x===y, 'x===y');assert.equal(x.favoriteColor, 'green');assert.ok(hasOwn(x, 'favoriteColor'));assert.ok(!hasAny(x.__proto__, 'favoriteColor'));});test('multiple extend', function(){var x=Utils.extend({},{a:42},{a:1, b:19, c:45},{b:199});assert.equal(x.a, 1);assert.equal(x.b, 199);assert.equal(x.c, 45);});});suite('safeCpuLock tests', function(){setup(function(){this.mocklock=new MockRequestWakeLock();this.sinon.stub(navigator, 'requestWakeLock', this.mocklock.requestWakeLock.bind(this.mocklock));this.sinon.useFakeTimers();});teardown(function(){this.sinon.restore(navigator, 'requestWakeLock');});test('locks CPU', function(){var callback=this.sinon.spy(function(unlock){assert.ok(navigator.requestWakeLock.calledOnce);});Utils.safeCpuLock(15000, callback);this.sinon.clock.tick(16000);assert.ok(callback.calledOnce);});test('single unlock', function(){Utils.safeCpuLock(15000, function(unlock){unlock();});this.sinon.clock.tick(16000);var locks=this.mocklock.getissued();assert.equal(locks.length, 1);assert.equal(locks[0].unlocks, 1);});test('no duplicate unlock', function(){var here=0;Utils.safeCpuLock(15000, function(unlock){setTimeout(function(){here++;unlock();}, 16000);here++;});this.sinon.clock.tick(17000);var locks=this.mocklock.getissued();assert.equal(locks.length, 1);assert.equal(locks[0].unlocks, 1);assert.equal(here, 2);});test('timeout unlock', function(){var here=false;Utils.safeCpuLock(15000, function(unlock){here=true;});this.sinon.clock.tick(16000);var locks=this.mocklock.getissued();assert.equal(locks.length, 1);assert.equal(locks[0].unlocks, 1);assert.ok(here);});test('exception in callback still unlocks CPU', function(){var here=false;try{Utils.safeCpuLock(15000, function(unlock){here=true;throw new Error('gotcha');});this.sinon.clock.tick(16000);}catch(err){assert.equal(err.message, 'gotcha');}var locks=this.mocklock.getissued();assert.equal(locks.length, 1);assert.equal(locks[0].unlocks, 1);assert.ok(here);});});suite('format', function(){suite('time(hh, mm) ', function(){var is12hStub, formatTime;setup(function(){formatTime=Utils.format.time;is12hStub=sinon.stub(Utils, 'is12hFormat');});teardown(function(){is12hStub.restore();});test('12:00am, with 12 hour clock settings', function(){is12hStub.returns(true);assert.equal(formatTime(0, 0), '12:00AM');});test('12:30pm, with 12 hour clock settings', function(){is12hStub.returns(true);assert.equal(formatTime(12, 30), '12:30PM');});test('11:30pm, with 12 hour clock settings', function(){is12hStub.returns(true);assert.equal(formatTime(23, 30), '11:30PM');});test('12:30am, with 24 hour clock settings', function(){is12hStub.returns(false);assert.equal(formatTime(0, 30), '00:30');});test('12:30pm, with 24 hour clock settings', function(){is12hStub.returns(false);assert.equal(formatTime(12, 30), '12:30');});test('11:30pm, with 24 hour clock settings', function(){is12hStub.returns(false);assert.equal(formatTime(23, 30), '23:30');});});suite('hms()', function(){var hms;suiteSetup(function(){hms=Utils.format.hms;});suite('hms(seconds) ', function(){var fixtures=[{args:[0], expect: '00:00:00'},{args:[1], expect: '00:00:01'},{args:[59], expect: '00:00:59'},{args:[60], expect: '00:01:00'},{args:[3600], expect: '01:00:00'}];fixtures.forEach(function(fixture){var{args, expect}=fixture;var title=args.map(String).join(', ')+ '=&gt; '+expect+ ' ';test(title, function(){assert.equal(hms.apply(null, args), expect);});});});suite('hms(seconds, format) ', function(){var fixtures=[{args:[0, 'ss'], expect: '00'},{args:[1, 'ss'], expect: '01'},{args:[60, 'ss'], expect: '00'},{args:[0, 'mm:ss'], expect: '00:00'},{args:[59, 'mm:ss'], expect: '00:59'},{args:[60, 'mm:ss'], expect: '01:00'},{args:[3600, 'mm:ss'], expect: '00:00'},{args:[3600, 'hh:mm:ss'], expect: '01:00:00'}];fixtures.forEach(function(fixture){var{args, expect}=fixture;var title=args.map(String).join(', ')+ '=&gt; '+expect+ ' ';test(title, function(){assert.equal(hms.apply(null, args), expect);});});});});});suite('async', function(){test('generators', function(){var spy=this.sinon.spy(function(){assert.equal(arguments[0], null);assert.equal(arguments.length, 1);});var gen=Utils.async.generator(spy);var collection=[];for(var i=0;i&lt; 100;i++){collection.push(gen());}assert.ok(!spy.called);for(var k of collection){k();}assert.ok(spy.calledOnce);});test('generators error', function(){var spy=this.sinon.spy(function(){assert.equal(arguments[0], 1);assert.equal(arguments.length, 1);});var gen=Utils.async.generator(spy);var collection=[];for(var i=0;i&lt; 100;i++){collection.push(gen());}assert.ok(!spy.called);var j=1;for(var k of collection){k(j++);}assert.ok(spy.calledOnce);});test('namedParallel', function(){var spy=this.sinon.spy(function(){assert.equal(arguments[0], null);assert.equal(arguments.length, 1);});var names=Utils.async.namedParallel([ 'testa', 'testb', 'testc'], spy);assert.ok(!spy.called);names.testa();assert.ok(!spy.called);names.testb();assert.ok(!spy.called);names.testc();assert.ok(spy.calledOnce);});test('namedParallel error', function(){var spy=this.sinon.spy(function(){assert.equal(arguments[0], 'testing b');assert.equal(arguments.length, 1);});var names=Utils.async.namedParallel([ 'testa', 'testb', 'testc'], spy);assert.ok(!spy.called);names.testa();assert.ok(!spy.called);names.testb('testing b');assert.ok(spy.calledOnce);names.testc();assert.ok(spy.calledOnce);});});})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a> </td>
          <td>(</td>
          <td class="paramtype">'<a class="el" href="../../d3/d91/j3d_8js.html#a960e7c2189224c021b07d962e5c60bd0">Time</a> functions'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d2/dfb/clock_2test_2unit_2utils__test_8js.html">utils_test.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:58:09に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
