<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: time_test.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d7/d9d/time__test_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a> &#124;
<a href="#var-members">変数</a>  </div>
  <div class="headertitle">
<div class="title">time_test.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../d7/d9d/time__test_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d9d/time__test_8js.html#ade2b8ef9b5f0579bea9b6c507f5ed8d3">requireLib</a> ('timespan.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d9d/time__test_8js.html#a9f53b76e6b83cd72712f6eae32efe52c">suite</a> ('<a class="el" href="../../d3/d91/j3d_8js.html#a960e7c2189224c021b07d962e5c60bd0">Controllers.Time</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>;var <a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>;var busytimeStore;var <a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> logSpan(span){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../de/dfc/events_8js.html#adca5ce0ed65a1514a671ae81eb33bd53">Array.isArray</a>(span)){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">span.forEach</a>(logSpan);}<a class="el" href="../../d9/d43/membuster_8js.html#aad81d14d4c8eea114056d7dc1f18f9b7">console.log</a>();<a class="el" href="../../d9/d43/membuster_8js.html#aad81d14d4c8eea114056d7dc1f18f9b7">console.log</a>('START:', new Date(<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">span.start</a>));<a class="el" href="../../d9/d43/membuster_8js.html#aad81d14d4c8eea114056d7dc1f18f9b7">console.log</a>('END:', new Date(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">span.end</a>));<a class="el" href="../../d9/d43/membuster_8js.html#aad81d14d4c8eea114056d7dc1f18f9b7">console.log</a>();}<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>=<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">testSupport.calendar.app</a>();<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>=new <a class="el" href="../../d3/d91/j3d_8js.html#a960e7c2189224c021b07d962e5c60bd0">Calendar.Controllers.Time</a>(<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>);busytimeStore=app.store('Busytime');<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>=<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">app.db</a>;<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">db.open</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){testSupport.calendar.clearStore(<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">app.db</a>,['events', 'busytimes', 'alarms'], <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">app.db.close</a>();});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../df/df8/apps_2costcontrol_2js_2views_2telephony_8js.html#aadd09be4bbc684e0d1228336d4fdc5c4">initialize</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">subject.app</a>, <a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>);assert.instanceOf(<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>, Calendar.Responder);assert.instanceOf(subject._collection, <a class="el" href="../../db/df2/interval__tree_8js.html#a7f9b5e6cd32d5ec2758607845668b93f">Calendar.IntervalTree</a>);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!subject.pending);assert.deepEqual(subject._timespans,[]);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac6a12d37a530b7cf73589f08f0fbf311">handleEvent</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> <a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a> <a class="el" href="../../df/d6d/prpdce_8h.html#a3a0acaef79170339a71bc1c4c54ad225">lock</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#a77912f28da5efe73d20f6c0c487bac9f">app.syncController.emit</a>('syncStart');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('locks after syncStart', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(subject.cacheLocked);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('unlocks after <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var calledWith=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;subject.purgeCache=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calledWith=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;};<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#a77912f28da5efe73d20f6c0c487bac9f">app.syncController.emit</a>('syncComplete');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#a8e4d922ae3532f8bdfcadccef0881707">assert.isFalse</a>(subject.cacheLocked);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(calledWith, 'purged');});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('switching between days', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> subject.mostRecentDayType;}subject.selectedDay=new Date(2012, 1, 5);assert.deepEqual(subject.mostRecentDay, subject.selectedDay, 'mostRecentDay-selected day');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>(), 'selectedDay', '&quot;selectedDay&quot;change should <a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a> <a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>');subject.move(new Date(2012, 1, 10));<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>(), 'day', 'move-sets most recent <a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>');assert.deepEqual(subject.mostRecentDay, <a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#acd1cdae9d6d8493a6f34d308f8259f55">subject.position</a>, 'mostRecentDay-day');subject.move(new Date(2012, 1, 15));<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>(), 'day');subject.selectedDay=new Date(2012, 1, 20);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>(), 'selectedDay');});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('#<a class="el" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">scale</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var calledWith;<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('scaleChange', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calledWith=arguments;});<a class="el" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">subject.scale</a>= '<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>';assert.deepEqual(calledWith,['<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>', <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>]);calledWith=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;<a class="el" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">subject.scale</a>= '<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>';assert.isNull(calledWith, 'should not trigger <a class="el" href="../../d9/dd6/_r_e_a_d_m_e_8md.html#ac1934db4e0289fcc2a08b0c7de017cf2">change</a> when <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a> is <a class="el" href="../../d2/d7d/jsapi_8h.html#abfba8fa3513c8942905cf6144b77a52d">same</a>');<a class="el" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">subject.scale</a>= 'day';assert.deepEqual(calledWith,['day', '<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>']);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a> busytime', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var span;var <a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>;var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){span=new <a class="el" href="../../d1/d7c/timespan_8js.html#a8eb67af7ea9a444c87cbe98b94d387c7">Calendar.Timespan</a>(0, Infinity);<a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime');subject.observeTime(span, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>;});subject.cacheBusytime(<a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('#cacheBusytime', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">event.type</a>, '<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">add</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../dc/d6a/xpt__xdr_8h.html#aa1c343a750ba3a3ef9940c20288abcef">event.data</a>, <a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>);var query=subject.queryCache(span);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(query[0], <a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){subject.removeCachedBusytime(busy._id);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">event.type</a>, '<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../dc/d6a/xpt__xdr_8h.html#aa1c343a750ba3a3ef9940c20288abcef">event.data</a>, <a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>);var query=subject.queryCache(<a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>);<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(query, 0);});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a> <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>;var <a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');<a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:event._id});app.store('<a class="el" href="../../d8/dd1/test_2marionette_2event_8js.html#aded1d021a890cccaab7c7ebd7450f106">Event</a>').persist(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);subject.cacheEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('#cacheEvent', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.findAssociated(<a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>, <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0];<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../df/db4/_h_i_s_t_o_r_y_8md.html#a9bdb27563ba547d319ee562ba0f3bb98">result.event</a>, <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>);});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#removeCachedEvent', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../da/dab/system_2camera_2js_2filmstrip_8js.html#a30a5f1efdb2e5f6d5981b81ea3205a55">clear</a> <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.removeCachedEvent(event._id);subject.findAssociated(<a class="el" href="../../d9/dc5/mock__handled__call_8js.html#a003d47644bddbfa64a6983bd1cda3ce7">busy</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0];<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.notEqual(<a class="el" href="../../df/db4/_h_i_s_t_o_r_y_8md.html#a9bdb27563ba547d319ee562ba0f3bb98">result.event</a>, <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>);assert.deepEqual(<a class="el" href="../../df/db4/_h_i_s_t_o_r_y_8md.html#a9bdb27563ba547d319ee562ba0f3bb98">result.event</a>, <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../da/dab/system_2camera_2js_2filmstrip_8js.html#a30a5f1efdb2e5f6d5981b81ea3205a55">clear</a> associated busytime <a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var notAssociated=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId: 'notme'});var associated=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:event._id});subject.cacheBusytime(associated);subject.cacheBusytime(notAssociated);subject.removeCachedEvent(event._id);assert.isNull(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a78826d1185ecdcfc63deffaedf15c7bd">subject._collection.indexOf</a>(associated), 'associated');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a78826d1185ecdcfc63deffaedf15c7bd">subject._collection.indexOf</a>(notAssociated)!=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>, 'not associated');});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#findAssociated', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var alarmStore;var eventStore;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){alarmStore=app.store('Alarm');eventStore=app.store('<a class="el" href="../../d8/dd1/test_2marionette_2event_8js.html#aded1d021a890cccaab7c7ebd7450f106">Event</a>');});var hasAlarm;var noAlarm;var alarm;var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{_id: 'foobar'});hasAlarm=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:event._id});noAlarm=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{eventId:event._id});alarm=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('alarm',{eventId:event._id, busytimeId:hasAlarm._id});var trans=app.db.transaction(['alarms', 'events', 'busytimes'], 'readwrite');trans.oncomplete=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};eventStore.persist(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, trans);busytimeStore.persist(hasAlarm, trans);busytimeStore.persist(noAlarm, trans);alarmStore.persist(alarm, trans);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('everything is cached', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.cacheEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>);var opts={alarms:true, event:true};subject.findAssociated(hasAlarm, opts, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!err);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0].<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0].busytime._id, alarm.busytimeId);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('empty', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var busytime=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime');subject.findAssociated(busytime, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!err);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>);<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>, 1);assert.deepEqual(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0],{busytime:busytime});});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('when given <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> busytime <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>(not cached)', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var expected={busytime:hasAlarm, event:event};subject.findAssociated(hasAlarm._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>, 1, 'has <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>');var item=<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0];<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(item.busytime._id, hasAlarm._id, 'has alarm');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(item.event._id, event._id, 'has <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('when given <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> busytime <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>(cached)', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var expected={busytime:hasAlarm, event:event};subject.cacheBusytime(hasAlarm);subject.findAssociated(hasAlarm._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var item=<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0];assert.deepEqual(item, expected);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('default', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var expected={busytime:hasAlarm, event:event};subject.findAssociated(hasAlarm, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var item=<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!err, '<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(item, '<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>');var eventId=item.event._id;<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(subject._eventsCache[eventId], 'caches <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');assert.deepEqual(item, expected, '<a class="el" href="../../df/d12/latin__test_8js.html#a34687689873d42dec2c94cc27f36e1e9">output</a>');});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('no <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>-with missing alarm', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var expected={busytime:noAlarm, alarms:[]};var <a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>={event:false, alarms:true};subject.findAssociated(noAlarm, <a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!err);<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, 1);assert.deepEqual(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>[0], expected);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('multiple', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a42c43c76081a7df8ae2954f16ee9338b">req</a>=[noAlarm, hasAlarm];var <a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>={event:true, alarms:true};subject.findAssociated(<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a42c43c76081a7df8ae2954f16ee9338b">req</a>, <a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(err){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(err);<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>;}<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var resultNoAlarm=<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[0];var resultAlarm=<a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>[1];var expectedNoAlarm={event:event, busytime:noAlarm, alarms:[]};var expectedAlarm={event:event, busytime:hasAlarm, alarms:[alarm]};assert.deepEqual(resultNoAlarm, expectedNoAlarm, 'busytime without alarm');assert.deepEqual(resultAlarm.eventId, expectedAlarm.eventId, 'busytime with alarm-eventId');assert.deepEqual(resultAlarm.busytimeId, expectedAlarm.busytimeId, 'busytime with alarm-busytimeId');});});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('#moveToMostRecentDay', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>=new Date();var calledMove;subject.move(<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>);subject.move=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){Calendar.Controllers.Time.prototype.move.apply(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>, arguments);calledMove=arguments;};subject.selectedDay=new Date(2012, 1, 1);subject.moveToMostRecentDay();<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(calledMove[0], subject.selectedDay, 'should move <a class="el" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> selected day');calledMove=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;subject.moveToMostRecentDay();<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!calledMove, 'should not move when&quot;day&quot;was last <a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#aea526ac279d0b19b1c082209fc199b73">changed</a>');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('#selectedDay', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var calledWith;<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('selectedDayChange', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calledWith=arguments;});var <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>=new Date(2012, 1, 1);subject.selectedDay=<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(calledWith[0], <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(subject.selectedDay, <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>);calledWith=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;subject.selectedDay=new Date(2012, 1, 1);assert.isNull(calledWith, 'should not fire <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> when day is <a class="el" href="../../d2/d7d/jsapi_8h.html#abfba8fa3513c8942905cf6144b77a52d">same</a>');var newDate=new Date(2012, 1, 2);subject.selectedDay=newDate;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(subject.selectedDay, newDate);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(calledWith[0], newDate);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(calledWith[1], <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#purgeCache', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var spans;var <a class="el" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a>;var events;var toBeRemoved;var expected;var spanLength;var afterCallback;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> loadSpans(<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">start</a>, inc, <a class="el" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a>){var <a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a>=inc;inc=0;var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;var <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>;<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt; <a class="el" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a>;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){inc=inc+<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a>;<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>=new Date(start.getFullYear(), inc, 1);subject.move(<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>);}}<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){events=[];toBeRemoved=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;expected=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;afterCallback=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();<a class="el" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a>=subject._maxTimespans;var longSpan=new <a class="el" href="../../d1/d7c/timespan_8js.html#a8eb67af7ea9a444c87cbe98b94d387c7">Calendar.Timespan</a>(new Date(2010, 0, 1), new Date(2013, 0, 1));<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>( 'purge', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(span){<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">events.push</a>(span);});loadSpans(new Date(2012, 0, 1),-1, <a class="el" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a> *2);spanLength=(<a class="el" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a> *2)+2;});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> cacheTest(<a class="el" href="../../d3/db2/prmwait_8h.html#a5e84b7cc06d3eb73dd860fa1d85dedd6">desc</a>, <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>(<a class="el" href="../../d3/db2/prmwait_8h.html#a5e84b7cc06d3eb73dd860fa1d85dedd6">desc</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){spans=subject._timespans;<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(spans, spanLength);subject.cacheEvent(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>'));<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>();<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('loadingComplete', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(subject._timespans, <a class="el" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a>);assert.deepEqual(subject._eventsCache,{}, 'removes <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a> <a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a>');<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(toBeRemoved){assert.deepEqual(events, toBeRemoved);}<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(expected){assert.deepEqual(subject._timespans, expected);}<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(afterCallback){afterCallback();}});});});}<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('when locked', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var calledWith=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;subject._updateBusytimeCache=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calledWith=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;};subject.cacheLocked=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;subject.cacheEvent(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>'));subject.cacheBusytime(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime'));subject.purgeCache();<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#a8e4d922ae3532f8bdfcadccef0881707">assert.isFalse</a>(calledWith, 'miss-purged busytimes');<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(Object.keys(subject._eventsCache), 1, 'miss-purged events');subject.cacheLocked=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;subject.purgeCache();<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(calledWith, 'hit-busytimes');<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(Object.keys(subject._eventsCache), 0);});cacheTest('future-<a class="el" href="../../d3/db2/prmwait_8h.html#a6aed8eca8bc323929991ebdb1a48929e">previous</a> is missing', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>= 'future';subject._currentTimespan=spans[0];expected=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(0, 6);});cacheTest('future-does not fit', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>= 'future';subject._currentTimespan=spans[12];expected=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(8, 14);});cacheTest('future-fits', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>= 'future';subject._currentTimespan=spans[9];toBeRemoved=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(0, 8);expected=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(8, 14);});cacheTest('past-fits', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var expectedItems=[];<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>= 'past';subject._currentTimespan=spans[8];toBeRemoved=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(0, 3);toBeRemoved=toBeRemoved.concat(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(9));expected=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(3, 9);<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">expectedItems.push</a>(<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">subject._collection.add</a>(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{startDate:new Date(1991, 1, 1), endDate:new Date(2020, 1, 1)})));<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">subject._collection.add</a>(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{_startDateMS:(new Date(2000, 0, 1)).valueOf(), _endDateMS:expected[0].<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">start</a>}));<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">expectedItems.push</a>(<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">subject._collection.add</a>(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{_startDateMS:expected[0].<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">start</a>+1, _endDateMS:expected[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">expected.length</a>-1].<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>-1})));<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">subject._collection.add</a>(<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{_startDateMS:expected[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">expected.length</a>-1].<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>+1, _endDateMS:(new Date(2020, 0, 1)).valueOf()}));afterCallback=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(subject._collection.items, expectedItems, 'should interval tree items outside of <a class="el" href="../../da/ddf/ns_i_d_o_m_progress_event_8idl.html#ac3db248c35e11a75b4e99f0087d77c90">total</a> span');};});cacheTest('past-does not fit', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>= 'past';subject._currentTimespan=spans[1];expected=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(0, 6);});cacheTest('past-next is missing', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>= 'past';subject._currentTimespan=spans[13];expected=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">spans.slice</a>(8, 14);});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../d3/d4b/lockscreen_8js.html#af91fa9dd7bcc99f1ac5d9727c6cdc8cc">handle</a> busytime events', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var store;var collection;var span;var events;var inRange;var outOfRange;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){collection=subject._collection;events={add:[], remove:[]};store=app.store('Busytime');span=new <a class="el" href="../../d1/d7c/timespan_8js.html#a8eb67af7ea9a444c87cbe98b94d387c7">Calendar.Timespan</a>(new Date(2012, 1, 1), new Date(2012, 1, 5));subject.observeTime(span, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d1/d03/locales_2_r_e_a_d_m_e_8md.html#abfc48c566ed05b3908825f01ea7462a4">e</a>){events[<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">e.type</a>].<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">push</a>(<a class="el" href="../../dc/d6a/xpt__xdr_8h.html#aa1c343a750ba3a3ef9940c20288abcef">e.data</a>);});inRange=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{startDate:new Date(2012, 1, 2), endDate:new Date(2012, 1, 3)});outOfRange=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{startDate:new Date(2012, 1, 6), endDate:new Date(2012, 1, 8)});subject.cacheBusytime(inRange);subject.cacheBusytime(outOfRange);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">add</a> <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.isNotNull(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a78826d1185ecdcfc63deffaedf15c7bd">collection.indexOf</a>(inRange), 'should <a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a> in range item');assert.isNotNull(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a78826d1185ecdcfc63deffaedf15c7bd">collection.indexOf</a>(outOfRange), 'should <a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a> out of range item');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">events.add.length</a>, 1);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../df/d44/permission__manager_8js.html#ae5a9ec7a035c6634f85498958b2c7a12">events.add</a>[0], inRange, 'should <a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#a77912f28da5efe73d20f6c0c487bac9f">emit</a> <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a> <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a> <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#a77912f28da5efe73d20f6c0c487bac9f">busytimeStore.emit</a>('<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a>', outOfRange._id);<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#a77912f28da5efe73d20f6c0c487bac9f">busytimeStore.emit</a>('<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a>', inRange._id);assert.isNull(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a78826d1185ecdcfc63deffaedf15c7bd">collection.indexOf</a>(outOfRange), 'should <a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a> outOfRange');assert.isNull(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a78826d1185ecdcfc63deffaedf15c7bd">collection.indexOf</a>(inRange), 'should <a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">remove</a> inRange');<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">events.remove</a>, 1);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d1/d04/app__install__manager_8js.html#a9a509fff9fcf53ecd0f73c0d965a7d6b">events.remove</a>[0], inRange);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('#queryCache', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var span=new <a class="el" href="../../d1/d7c/timespan_8js.html#a8eb67af7ea9a444c87cbe98b94d387c7">Calendar.Timespan</a>(new Date(2000, 1, 1), new Date(2015, 1, 1));var <a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>=subject._collection.query(span);<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(<a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>, 2);assert.deepEqual(subject.queryCache(span), <a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>);});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#move', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var events;var <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> clearEvents(){events={year:[], month:[], day:[]};}<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){clearEvents();<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>=new Date(2012, 5, 5);var <a class="el" href="../../d3/d4b/lockscreen_8js.html#af91fa9dd7bcc99f1ac5d9727c6cdc8cc">handle</a>={handleEvent:function(<a class="el" href="../../d1/d03/locales_2_r_e_a_d_m_e_8md.html#abfc48c566ed05b3908825f01ea7462a4">e</a>){var <a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>=<a class="el" href="../../dc/d89/wappush_2js_2message_8js.html#a7c5f9536f6c7849a4a7a592bfedf18f1">e.type.replace</a>('Change', '');events[<a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>].<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">push</a>(<a class="el" href="../../dc/d6a/xpt__xdr_8h.html#aa1c343a750ba3a3ef9940c20288abcef">e.data</a>[0]);}};<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('yearChange', <a class="el" href="../../d3/d4b/lockscreen_8js.html#af91fa9dd7bcc99f1ac5d9727c6cdc8cc">handle</a>);<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('monthChange', <a class="el" href="../../d3/d4b/lockscreen_8js.html#af91fa9dd7bcc99f1ac5d9727c6cdc8cc">handle</a>);<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('dayChange', <a class="el" href="../../d3/d4b/lockscreen_8js.html#af91fa9dd7bcc99f1ac5d9727c6cdc8cc">handle</a>);subject.move(<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>);});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> fires(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>, <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>){var eventValue=events[<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>][0];assert.deepEqual(eventValue, <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>, 'fires: '+<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>+ '<a class="el" href="../../d9/dd6/_r_e_a_d_m_e_8md.html#ac1934db4e0289fcc2a08b0c7de017cf2">change</a>');assert.deepEqual(<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>[<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>], <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>, 'should update.'+<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>);}<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> doesNotFire(<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>){assert.deepEqual(events[<a class="el" href="../../de/d81/xpt__struct_8h.html#ac827fa5fbcdd05dd9ed05984a80679b8">type</a>],[]);}<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('initial move', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){fires('<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>', new Date(2012, 0, 1));fires('month', new Date(2012, 5, 1));fires('day', new Date(2012, 5, 5));<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>, 'future');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('move day', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){clearEvents();subject.move(new Date(2012, 5, 6));doesNotFire('<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>');doesNotFire('month');fires('day', new Date(2012, 5, 6));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('move month', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){clearEvents();subject.move(new Date(2012, 8, 6));doesNotFire('<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>');fires('month', new Date(2012, 8, 1));fires('day', new Date(2012, 8, 6));<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>, 'future');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('move into the past', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){clearEvents();subject.move(new Date(2011, 5, 4));fires('<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>', new Date(2011, 0, 1));fires('month', new Date(2011, 5, 1));fires('day', new Date(2011, 5, 4));<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>, 'past');});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#_onLoadingComplete', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var past;var <a class="el" href="../../d2/d7d/jsapi_8h.html#acc0bd842c306223f94e6a78225bd19a3">present</a>;var future;var startDate=new Date(2012, 0, 1);<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();var trans=busytimeStore.db.transaction( 'busytimes', 'readwrite');past=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{startDate:new Date(2011, 11, 1), endDate:new Date(2012, 0, 1)});<a class="el" href="../../d2/d7d/jsapi_8h.html#acc0bd842c306223f94e6a78225bd19a3">present</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{startDate:new Date(2012, 0, 1), endDate:new Date(2012, 1, 1)});future=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('busytime',{startDate:new Date(2012, 1, 1), endDate:new Date(2012, 2, 1)});trans.oncomplete=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};busytimeStore.persist(past, trans);busytimeStore.persist(<a class="el" href="../../d2/d7d/jsapi_8h.html#acc0bd842c306223f94e6a78225bd19a3">present</a>, trans);busytimeStore.persist(future, trans);});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('loadingComplete', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});subject.move(startDate);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../db/d6b/make__gaia__shared_8js.html#ac5aa547163f784b68be607a47eb170b1">load</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var span=new <a class="el" href="../../d1/d7c/timespan_8js.html#a8eb67af7ea9a444c87cbe98b94d387c7">Calendar.Timespan</a>(0, Infinity);var <a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>=subject.queryCache(span);<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(<a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>, 3);<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">results.forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(item){delete item._startDateMS;delete item._endDateMS;});assert.deepEqual(<a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>,[past, <a class="el" href="../../d2/d7d/jsapi_8h.html#acc0bd842c306223f94e6a78225bd19a3">present</a>, future]);});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('(span loading)#_loadMonthSpan', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var stored;var spanOfMonth;var initialMove;var loadResults;var <a class="el" href="../../d7/d23/emitter__test_8js.html#abb11362bf22c7a94c6f2c8c25b44880e">loaded</a>;suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){spanOfMonth=Calendar.Calc.spanOfMonth;});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> monthSpan(<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>){var month=new Date(date.getFullYear(), date.getMonth(), 1);<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> spanOfMonth(month);}<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> hasSpan(store, range){var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;var <a class="el" href="../../d9/d04/expat_8h.html#a5df20ff5bc70fb664abe3912796e90df">len</a>=<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">store.length</a>;var item;<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt; <a class="el" href="../../d9/d04/expat_8h.html#a5df20ff5bc70fb664abe3912796e90df">len</a>;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){item=store[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>];<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(item.isEqual(range)){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;}}<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;}<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d7/d23/emitter__test_8js.html#abb11362bf22c7a94c6f2c8c25b44880e">loaded</a>=[];busytimeStore.loadSpan=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(span, <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>){<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">loaded.push</a>(span);<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>){<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#adf7ce41cd256eda7ce1f6adeea723bd3">setTimeout</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>, 0, <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>,[]);}};initialMove=new Date(2012, 1, 5);<a class="el" href="../../d9/d6e/ttlview_8js.html#aab157f1dc1e984fa6ce7c5b7670324ef">subject.observe</a>();subject.move(initialMove);<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('loadingComplete', <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);stored=subject._timespans;});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('initial move', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var expected=[monthSpan(new Date(2012, 0, 1)), monthSpan(new Date(2012, 1, 1)), monthSpan(new Date(2012, 2, 1))];var currentLoadSpan=expected[1];var futureLoadSpan=currentLoadSpan.trimOverlap(expected[2]);var pastLoadSpan=currentLoadSpan.trimOverlap(expected[0]);assert.deepEqual(subject._timespans, expected);assert.deepEqual(<a class="el" href="../../d7/d23/emitter__test_8js.html#abb11362bf22c7a94c6f2c8c25b44880e">loaded</a>,[currentLoadSpan, futureLoadSpan, pastLoadSpan]);});var idx;var tries;var isComplete;var startInc;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){idx=1;tries=24;isComplete=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> loadTest(<a class="el" href="../../d3/db2/prmwait_8h.html#a5e84b7cc06d3eb73dd860fa1d85dedd6">desc</a>, inc, <a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">direction</a>, loadRangeCb){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>(<a class="el" href="../../d3/db2/prmwait_8h.html#a5e84b7cc06d3eb73dd860fa1d85dedd6">desc</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){isComplete=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;startInc=inc;<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('loadingComplete', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!isComplete){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(new <a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Error</a>('loading complete fired too early'));}<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!subject.pending, 'should not be pending');<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(subject._timespans, subject._maxTimespans);});});var month;var nextDate;var currentDate;<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(;idx&lt; tries;idx++){month=(initialMove.getMonth()+(startInc *idx));nextDate=new Date(2012, month+startInc, 1);currentDate=new Date(2012, month, 1);var nextSpan=spanOfMonth(nextDate);var currentSpan=spanOfMonth(currentDate);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(hasSpan(stored, currentSpan), 'should have span due <a class="el" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> preloading');var loadRange=loadRangeCb(nextSpan);subject.move(currentDate);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">subject.direction</a>, <a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aaf8d770e458379d429b5e1733bf3d84a">direction</a>);assert.deepEqual(subject._currentTimespan, currentSpan);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(hasSpan(stored, nextSpan), 'should record new range');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(hasSpan(<a class="el" href="../../d7/d23/emitter__test_8js.html#abb11362bf22c7a94c6f2c8c25b44880e">loaded</a>, loadRange), 'should <a class="el" href="../../df/d44/permission__manager_8js.html#ad9abb423164fcb98d6ad9333893e4682">request</a> trimmed <a class="el" href="../../db/d6b/make__gaia__shared_8js.html#ac5aa547163f784b68be607a47eb170b1">load</a> range');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(subject.pending, 'should trigger <a class="el" href="../../db/d6b/make__gaia__shared_8js.html#ac5aa547163f784b68be607a47eb170b1">load</a>');}isComplete=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;});}loadTest('into the past',-1, 'past', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(nextSpan){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> stored[0].trimOverlap(nextSpan);});loadTest('into the future', 1, 'future', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(nextSpan){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> stored[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">stored.length</a>-1].trimOverlap(nextSpan);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('jump', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">subject._timespans.length</a>=0;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> month(<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>, month){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> spanOfMonth(new Date(<a class="el" href="../../d2/d7d/jsapi_8h.html#abeac221e38b7b9ce7df8722c842bf671">year</a>, month));}<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">subject.on</a>('loadingComplete', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var expected=[month(2010, 11), month(2011, 0), month(2011, 1), month(2011, 11), month(2012, 0), month(2012, 1)];<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(subject._timespans, 6);assert.deepEqual(subject._timespans, expected);});});subject.move(new Date(2011, 0, 1));subject.move(new Date(2012, 0, 1));});});})</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
変数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d9d/time__test_8js.html#a9b03e8a9f4440c3c0c605b05ef1b0885">page</a> = <a class="el" href="../../d7/d9d/time__test_8js.html#a9b03e8a9f4440c3c0c605b05ef1b0885">window.page</a> || {}</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="ade2b8ef9b5f0579bea9b6c507f5ed8d3"></a><!-- doxytag: member="time_test.js::requireLib" ref="ade2b8ef9b5f0579bea9b6c507f5ed8d3" args="('timespan.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/d0e/manager__test_8js.html#a160383846e1e348b6643e19d5c153d05">requireLib</a> </td>
          <td>(</td>
          <td class="paramtype">'timespan.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9f53b76e6b83cd72712f6eae32efe52c"></a><!-- doxytag: member="time_test.js::suite" ref="a9f53b76e6b83cd72712f6eae32efe52c" args="('Controllers.Time', function(){var subject;var app;var busytimeStore;var db;function logSpan(span){if(Array.isArray(span)){return span.forEach(logSpan);}console.log();console.log('START:', new Date(span.start));console.log('END:', new Date(span.end));console.log();}setup(function(done){app=testSupport.calendar.app();subject=new Calendar.Controllers.Time(app);busytimeStore=app.store('Busytime');db=app.db;db.open(function(){done();});});teardown(function(done){testSupport.calendar.clearStore(app.db,['events', 'busytimes', 'alarms'], done);});teardown(function(){app.db.close();});test('initialize', function(){assert.equal(subject.app, app);assert.instanceOf(subject, Calendar.Responder);assert.instanceOf(subject._collection, Calendar.IntervalTree);assert.ok(!subject.pending);assert.deepEqual(subject._timespans,[]);});suite('#handleEvent', function(){suite('sync cache lock', function(){setup(function(){subject.observe();app.syncController.emit('syncStart');});test('locks after syncStart', function(){assert.isTrue(subject.cacheLocked);});test('unlocks after sync end', function(){var calledWith=false;subject.purgeCache=function(){calledWith=true;};app.syncController.emit('syncComplete');assert.isFalse(subject.cacheLocked);assert.isTrue(calledWith, 'purged');});});test('switching between days', function(){function type(){return subject.mostRecentDayType;}subject.selectedDay=new Date(2012, 1, 5);assert.deepEqual(subject.mostRecentDay, subject.selectedDay, 'mostRecentDay&#45;selected day');assert.equal(type(), 'selectedDay', '&quot;selectedDay&quot;change should update type');subject.move(new Date(2012, 1, 10));assert.equal(type(), 'day', 'move&#45;sets most recent type');assert.deepEqual(subject.mostRecentDay, subject.position, 'mostRecentDay&#45;day');subject.move(new Date(2012, 1, 15));assert.equal(type(), 'day');subject.selectedDay=new Date(2012, 1, 20);assert.equal(type(), 'selectedDay');});});test('#scale', function(){var calledWith;subject.on('scaleChange', function(){calledWith=arguments;});subject.scale= 'year';assert.deepEqual(calledWith,['year', null]);calledWith=null;subject.scale= 'year';assert.isNull(calledWith, 'should not trigger change when value is same');subject.scale= 'day';assert.deepEqual(calledWith,['day', 'year']);});suite('cache busytime', function(){var span;var busy;var event;setup(function(){span=new Calendar.Timespan(0, Infinity);busy=Factory('busytime');subject.observeTime(span, function(result){event=result;});subject.cacheBusytime(busy);});test('#cacheBusytime', function(){assert.equal(event.type, 'add');assert.equal(event.data, busy);var query=subject.queryCache(span);assert.equal(query[0], busy);});test('remove', function(){subject.removeCachedBusytime(busy._id);assert.equal(event.type, 'remove');assert.equal(event.data, busy);var query=subject.queryCache(busy);assert.length(query, 0);});});suite('cache event', function(){var event;var busy;setup(function(done){event=Factory('event');busy=Factory('busytime',{eventId:event._id});app.store('Event').persist(event, done);subject.cacheEvent(event);});test('#cacheEvent', function(done){subject.findAssociated(busy, null, function(err, data){var result=data[0];done(function(){assert.equal(result.event, event);});});});suite('#removeCachedEvent', function(){test('clear event', function(done){subject.removeCachedEvent(event._id);subject.findAssociated(busy, function(err, data){var result=data[0];done(function(){assert.notEqual(result.event, event);assert.deepEqual(result.event, event);});});});test('clear associated busytime cache', function(){var notAssociated=Factory('busytime',{eventId: 'notme'});var associated=Factory('busytime',{eventId:event._id});subject.cacheBusytime(associated);subject.cacheBusytime(notAssociated);subject.removeCachedEvent(event._id);assert.isNull(subject._collection.indexOf(associated), 'associated');assert.ok(subject._collection.indexOf(notAssociated)!=null, 'not associated');});});});suite('#findAssociated', function(){var alarmStore;var eventStore;setup(function(){alarmStore=app.store('Alarm');eventStore=app.store('Event');});var hasAlarm;var noAlarm;var alarm;var event;setup(function(done){event=Factory('event',{_id: 'foobar'});hasAlarm=Factory('busytime',{eventId:event._id});noAlarm=Factory('busytime',{eventId:event._id});alarm=Factory('alarm',{eventId:event._id, busytimeId:hasAlarm._id});var trans=app.db.transaction(['alarms', 'events', 'busytimes'], 'readwrite');trans.oncomplete=function(){done();};eventStore.persist(event, trans);busytimeStore.persist(hasAlarm, trans);busytimeStore.persist(noAlarm, trans);alarmStore.persist(alarm, trans);});test('everything is cached', function(done){subject.cacheEvent(event);var opts={alarms:true, event:true};subject.findAssociated(hasAlarm, opts, function(err, data){done(function(){assert.ok(!err);assert.equal(data[0].event, event);assert.equal(data[0].busytime._id, alarm.busytimeId);});});});test('empty', function(done){var busytime=Factory('busytime');subject.findAssociated(busytime, function(err, data){done(function(){assert.ok(!err);assert.ok(data);assert.length(data, 1);assert.deepEqual(data[0],{busytime:busytime});});});});test('when given a busytime id(not cached)', function(done){var expected={busytime:hasAlarm, event:event};subject.findAssociated(hasAlarm._id, function(err, data){done(function(){assert.length(data, 1, 'has data');var item=data[0];assert.equal(item.busytime._id, hasAlarm._id, 'has alarm');assert.equal(item.event._id, event._id, 'has event');});});});test('when given a busytime id(cached)', function(done){var expected={busytime:hasAlarm, event:event};subject.cacheBusytime(hasAlarm);subject.findAssociated(hasAlarm._id, function(err, data){done(function(){var item=data[0];assert.deepEqual(item, expected);});});});test('default', function(done){var expected={busytime:hasAlarm, event:event};subject.findAssociated(hasAlarm, function(err, data){done(function(){var item=data[0];assert.ok(!err, 'error');assert.ok(item, 'result');var eventId=item.event._id;assert.ok(subject._eventsCache[eventId], 'caches event');assert.deepEqual(item, expected, 'output');});});});test('no event&#45;with missing alarm', function(done){var expected={busytime:noAlarm, alarms:[]};var options={event:false, alarms:true};subject.findAssociated(noAlarm, options, function(err, result){done(function(){assert.ok(!err);assert.length(result, 1);assert.deepEqual(result[0], expected);});});});test('multiple', function(done){var req=[noAlarm, hasAlarm];var options={event:true, alarms:true};subject.findAssociated(req, options, function(err, data){if(err){done(err);return;}done(function(){var resultNoAlarm=data[0];var resultAlarm=data[1];var expectedNoAlarm={event:event, busytime:noAlarm, alarms:[]};var expectedAlarm={event:event, busytime:hasAlarm, alarms:[alarm]};assert.deepEqual(resultNoAlarm, expectedNoAlarm, 'busytime without alarm');assert.deepEqual(resultAlarm.eventId, expectedAlarm.eventId, 'busytime with alarm&#45;eventId');assert.deepEqual(resultAlarm.busytimeId, expectedAlarm.busytimeId, 'busytime with alarm&#45;busytimeId');});});});});test('#moveToMostRecentDay', function(){var date=new Date();var calledMove;subject.move(date);subject.move=function(){Calendar.Controllers.Time.prototype.move.apply(this, arguments);calledMove=arguments;};subject.selectedDay=new Date(2012, 1, 1);subject.moveToMostRecentDay();assert.equal(calledMove[0], subject.selectedDay, 'should move to selected day');calledMove=null;subject.moveToMostRecentDay();assert.ok(!calledMove, 'should not move when&quot;day&quot;was last changed');});test('#selectedDay', function(){var calledWith;subject.on('selectedDayChange', function(){calledWith=arguments;});var date=new Date(2012, 1, 1);subject.selectedDay=date;assert.equal(calledWith[0], date);assert.equal(subject.selectedDay, date);calledWith=null;subject.selectedDay=new Date(2012, 1, 1);assert.isNull(calledWith, 'should not fire event when day is same');var newDate=new Date(2012, 1, 2);subject.selectedDay=newDate;assert.equal(subject.selectedDay, newDate);assert.equal(calledWith[0], newDate);assert.equal(calledWith[1], date);});suite('#purgeCache', function(){var spans;var max;var events;var toBeRemoved;var expected;var spanLength;var afterCallback;function loadSpans(start, inc, max){var first=inc;inc=0;var i=0;var date;for(;i&lt; max;i++){inc=inc+first;date=new Date(start.getFullYear(), inc, 1);subject.move(date);}}setup(function(){events=[];toBeRemoved=null;expected=null;afterCallback=null;subject.observe();max=subject._maxTimespans;var longSpan=new Calendar.Timespan(new Date(2010, 0, 1), new Date(2013, 0, 1));subject.on( 'purge', function(span){events.push(span);});loadSpans(new Date(2012, 0, 1),&#45;1, max *2);spanLength=(max *2)+2;});function cacheTest(desc, cb){test(desc, function(done){spans=subject._timespans;assert.length(spans, spanLength);subject.cacheEvent(Factory('event'));cb();subject.on('loadingComplete', function(){done(function(){assert.length(subject._timespans, max);assert.deepEqual(subject._eventsCache,{}, 'removes event cache');if(toBeRemoved){assert.deepEqual(events, toBeRemoved);}if(expected){assert.deepEqual(subject._timespans, expected);}if(afterCallback){afterCallback();}});});});}test('when locked', function(){var calledWith=false;subject._updateBusytimeCache=function(){calledWith=true;};subject.cacheLocked=true;subject.cacheEvent(Factory('event'));subject.cacheBusytime(Factory('busytime'));subject.purgeCache();assert.isFalse(calledWith, 'miss&#45;purged busytimes');assert.length(Object.keys(subject._eventsCache), 1, 'miss&#45;purged events');subject.cacheLocked=false;subject.purgeCache();assert.isTrue(calledWith, 'hit&#45;busytimes');assert.length(Object.keys(subject._eventsCache), 0);});cacheTest('future&#45;previous is missing', function(){subject.direction= 'future';subject._currentTimespan=spans[0];expected=spans.slice(0, 6);});cacheTest('future&#45;does not fit', function(){subject.direction= 'future';subject._currentTimespan=spans[12];expected=spans.slice(8, 14);});cacheTest('future&#45;fits', function(){subject.direction= 'future';subject._currentTimespan=spans[9];toBeRemoved=spans.slice(0, 8);expected=spans.slice(8, 14);});cacheTest('past&#45;fits', function(){var expectedItems=[];subject.direction= 'past';subject._currentTimespan=spans[8];toBeRemoved=spans.slice(0, 3);toBeRemoved=toBeRemoved.concat(spans.slice(9));expected=spans.slice(3, 9);expectedItems.push(subject._collection.add(Factory('busytime',{startDate:new Date(1991, 1, 1), endDate:new Date(2020, 1, 1)})));subject._collection.add(Factory('busytime',{_startDateMS:(new Date(2000, 0, 1)).valueOf(), _endDateMS:expected[0].start}));expectedItems.push(subject._collection.add(Factory('busytime',{_startDateMS:expected[0].start+1, _endDateMS:expected[expected.length&#45;1].end&#45;1})));subject._collection.add(Factory('busytime',{_startDateMS:expected[expected.length&#45;1].end+1, _endDateMS:(new Date(2020, 0, 1)).valueOf()}));afterCallback=function(){assert.deepEqual(subject._collection.items, expectedItems, 'should interval tree items outside of total span');};});cacheTest('past&#45;does not fit', function(){subject.direction= 'past';subject._currentTimespan=spans[1];expected=spans.slice(0, 6);});cacheTest('past&#45;next is missing', function(){subject.direction= 'past';subject._currentTimespan=spans[13];expected=spans.slice(8, 14);});});suite('handle busytime events', function(){var store;var collection;var span;var events;var inRange;var outOfRange;setup(function(){collection=subject._collection;events={add:[], remove:[]};store=app.store('Busytime');span=new Calendar.Timespan(new Date(2012, 1, 1), new Date(2012, 1, 5));subject.observeTime(span, function(e){events[e.type].push(e.data);});inRange=Factory('busytime',{startDate:new Date(2012, 1, 2), endDate:new Date(2012, 1, 3)});outOfRange=Factory('busytime',{startDate:new Date(2012, 1, 6), endDate:new Date(2012, 1, 8)});subject.cacheBusytime(inRange);subject.cacheBusytime(outOfRange);});test('add time', function(){assert.isNotNull(collection.indexOf(inRange), 'should cache in range item');assert.isNotNull(collection.indexOf(outOfRange), 'should cache out of range item');assert.equal(events.add.length, 1);assert.equal(events.add[0], inRange, 'should emit time event');});test('remove time', function(){subject.observe();busytimeStore.emit('remove', outOfRange._id);busytimeStore.emit('remove', inRange._id);assert.isNull(collection.indexOf(outOfRange), 'should remove outOfRange');assert.isNull(collection.indexOf(inRange), 'should remove inRange');assert.length(events.remove, 1);assert.equal(events.remove[0], inRange);});test('#queryCache', function(){var span=new Calendar.Timespan(new Date(2000, 1, 1), new Date(2015, 1, 1));var results=subject._collection.query(span);assert.length(results, 2);assert.deepEqual(subject.queryCache(span), results);});});suite('#move', function(){var events;var date;function clearEvents(){events={year:[], month:[], day:[]};}setup(function(){clearEvents();date=new Date(2012, 5, 5);var handle={handleEvent:function(e){var name=e.type.replace('Change', '');events[name].push(e.data[0]);}};subject.on('yearChange', handle);subject.on('monthChange', handle);subject.on('dayChange', handle);subject.move(date);});function fires(type, value){var eventValue=events[type][0];assert.deepEqual(eventValue, value, 'fires: '+type+ 'change');assert.deepEqual(subject[type], value, 'should update.'+type);}function doesNotFire(type){assert.deepEqual(events[type],[]);}test('initial move', function(){fires('year', new Date(2012, 0, 1));fires('month', new Date(2012, 5, 1));fires('day', new Date(2012, 5, 5));assert.equal(subject.direction, 'future');});test('move day', function(){clearEvents();subject.move(new Date(2012, 5, 6));doesNotFire('year');doesNotFire('month');fires('day', new Date(2012, 5, 6));});test('move month', function(){clearEvents();subject.move(new Date(2012, 8, 6));doesNotFire('year');fires('month', new Date(2012, 8, 1));fires('day', new Date(2012, 8, 6));assert.equal(subject.direction, 'future');});test('move into the past', function(){clearEvents();subject.move(new Date(2011, 5, 4));fires('year', new Date(2011, 0, 1));fires('month', new Date(2011, 5, 1));fires('day', new Date(2011, 5, 4));assert.equal(subject.direction, 'past');});});suite('#_onLoadingComplete', function(){var past;var present;var future;var startDate=new Date(2012, 0, 1);setup(function(done){subject.observe();var trans=busytimeStore.db.transaction( 'busytimes', 'readwrite');past=Factory('busytime',{startDate:new Date(2011, 11, 1), endDate:new Date(2012, 0, 1)});present=Factory('busytime',{startDate:new Date(2012, 0, 1), endDate:new Date(2012, 1, 1)});future=Factory('busytime',{startDate:new Date(2012, 1, 1), endDate:new Date(2012, 2, 1)});trans.oncomplete=function(){done();};busytimeStore.persist(past, trans);busytimeStore.persist(present, trans);busytimeStore.persist(future, trans);});setup(function(done){subject.on('loadingComplete', function(){done();});subject.move(startDate);});test('load', function(){var span=new Calendar.Timespan(0, Infinity);var results=subject.queryCache(span);assert.length(results, 3);results.forEach(function(item){delete item._startDateMS;delete item._endDateMS;});assert.deepEqual(results,[past, present, future]);});});suite('(span loading)#_loadMonthSpan', function(){var stored;var spanOfMonth;var initialMove;var loadResults;var loaded;suiteSetup(function(){spanOfMonth=Calendar.Calc.spanOfMonth;});function monthSpan(date){var month=new Date(date.getFullYear(), date.getMonth(), 1);return spanOfMonth(month);}function hasSpan(store, range){var i=0;var len=store.length;var item;for(;i&lt; len;i++){item=store[i];if(item.isEqual(range)){return true;}}return false;}setup(function(done){loaded=[];busytimeStore.loadSpan=function(span, cb){loaded.push(span);if(cb){setTimeout(cb, 0, null,[]);}};initialMove=new Date(2012, 1, 5);subject.observe();subject.move(initialMove);subject.on('loadingComplete', done);stored=subject._timespans;});test('initial move', function(){var expected=[monthSpan(new Date(2012, 0, 1)), monthSpan(new Date(2012, 1, 1)), monthSpan(new Date(2012, 2, 1))];var currentLoadSpan=expected[1];var futureLoadSpan=currentLoadSpan.trimOverlap(expected[2]);var pastLoadSpan=currentLoadSpan.trimOverlap(expected[0]);assert.deepEqual(subject._timespans, expected);assert.deepEqual(loaded,[currentLoadSpan, futureLoadSpan, pastLoadSpan]);});var idx;var tries;var isComplete;var startInc;setup(function(){idx=1;tries=24;isComplete=false;});function loadTest(desc, inc, direction, loadRangeCb){test(desc, function(done){isComplete=false;startInc=inc;subject.on('loadingComplete', function(){if(!isComplete){done(new Error('loading complete fired too early'));}done(function(){assert.ok(!subject.pending, 'should not be pending');assert.length(subject._timespans, subject._maxTimespans);});});var month;var nextDate;var currentDate;for(;idx&lt; tries;idx++){month=(initialMove.getMonth()+(startInc *idx));nextDate=new Date(2012, month+startInc, 1);currentDate=new Date(2012, month, 1);var nextSpan=spanOfMonth(nextDate);var currentSpan=spanOfMonth(currentDate);assert.ok(hasSpan(stored, currentSpan), 'should have span due to preloading');var loadRange=loadRangeCb(nextSpan);subject.move(currentDate);assert.equal(subject.direction, direction);assert.deepEqual(subject._currentTimespan, currentSpan);assert.ok(hasSpan(stored, nextSpan), 'should record new range');assert.ok(hasSpan(loaded, loadRange), 'should request trimmed load range');assert.ok(subject.pending, 'should trigger load');}isComplete=true;});}loadTest('into the past',&#45;1, 'past', function(nextSpan){return stored[0].trimOverlap(nextSpan);});loadTest('into the future', 1, 'future', function(nextSpan){return stored[stored.length&#45;1].trimOverlap(nextSpan);});test('jump', function(done){subject._timespans.length=0;function month(year, month){return spanOfMonth(new Date(year, month));}subject.on('loadingComplete', function(){done(function(){var expected=[month(2010, 11), month(2011, 0), month(2011, 1), month(2011, 11), month(2012, 0), month(2012, 1)];assert.length(subject._timespans, 6);assert.deepEqual(subject._timespans, expected);});});subject.move(new Date(2011, 0, 1));subject.move(new Date(2012, 0, 1));});});})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a> </td>
          <td>(</td>
          <td class="paramtype">'<a class="el" href="../../d3/d91/j3d_8js.html#a960e7c2189224c021b07d962e5c60bd0">Controllers.Time</a>'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>変数</h2>
<a class="anchor" id="a9b03e8a9f4440c3c0c605b05ef1b0885"></a><!-- doxytag: member="time_test.js::page" ref="a9b03e8a9f4440c3c0c605b05ef1b0885" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a> <a class="el" href="../../d7/d9d/time__test_8js.html#a9b03e8a9f4440c3c0c605b05ef1b0885">page</a> = <a class="el" href="../../d7/d9d/time__test_8js.html#a9b03e8a9f4440c3c0c605b05ef1b0885">window.page</a> || {}</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p> <a class="el" href="../../d7/d9d/time__test_8js_source.html">time_test.js</a> の <a class="el" href="../../d7/d9d/time__test_8js_source.html#l00004">4</a> 行で定義されています。</p>

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d7/d9d/time__test_8js.html">time_test.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:58:06に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
