<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: alarm_test.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d7/d7d/clock_2test_2unit_2alarm__test_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a>  </div>
  <div class="headertitle">
<div class="title">alarm_test.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../d7/d7d/clock_2test_2unit_2alarm__test_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d7d/clock_2test_2unit_2alarm__test_8js.html#ae3f4a220224ec995993868b05e81bfc1">requireApp</a> ('clock/js/constants.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d7d/clock_2test_2unit_2alarm__test_8js.html#a8d19a020a983521cb52903d455f57ef7">suite</a> ('Alarm Test', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var nativeMozL10n=<a class="el" href="../../df/dc7/viewer_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">navigator.mozL10n</a>;var nativeAlarmsDB=<a class="el" href="../../d5/d9d/alarmsdb_8js.html#a3ee863d451570b3d2c34763a5255fd43">window.AlarmsDB</a>;var nativeActiveAlarmHandler;suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../df/dc7/viewer_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">navigator.mozL10n</a>=<a class="el" href="../../dd/daf/system_2test_2unit_2mock__l10n_8js.html#af9a9d6d42b9a7f8153f63783711f14c3">MockL10n</a>;<a class="el" href="../../d5/d9d/alarmsdb_8js.html#a3ee863d451570b3d2c34763a5255fd43">window.AlarmsDB</a>=new MockAlarmsDB();navigator.mozAlarms=new <a class="el" href="../../d6/df3/wifi__test_8js.html#a835d106b4baae046300bd4fb377fc863">MockMozAlarms</a>(<a class="el" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">ActiveAlarm.handler</a>);});suiteTeardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../df/dc7/viewer_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">navigator.mozL10n</a>=nativeMozL10n;<a class="el" href="../../d5/d9d/alarmsdb_8js.html#a3ee863d451570b3d2c34763a5255fd43">window.AlarmsDB</a>=nativeAlarmsDB;});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){this.sinon.stub(<a class="el" href="../../de/d1a/active__alarm_8js.html#a4f0d896c4b0f6f35b0c097dc51c26d60">ActiveAlarm</a>, '<a class="el" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">handler</a>');});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('Date handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var clockSetter=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(thisVal){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(x){<a class="el" href="../../d3/d91/j3d_8js.html#aeba439cf129372b4ebc312b3a29efe66">this.sinon.clock.tick</a>((-1 *<a class="el" href="../../d3/d91/j3d_8js.html#aeba439cf129372b4ebc312b3a29efe66">this.sinon.clock.tick</a>())+x);}.<a class="el" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(thisVal);};var days=['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){this.startDate=new Date(1374102438043);this.startDate.setHours(19, 7, 18);<a class="el" href="../../d3/d4b/lockscreen_8js.html#a5ad25e705333134dd79a0ba0e766f6bc">while</a>(this.startDate.getDay()!==3){this.startDate.setHours(this.startDate.getHours()+24);}<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">this.start</a>=this.startDate.getTime();this.alarm=new Alarm({hour:this.startDate.getHours(), minute:this.startDate.getMinutes(), repeat:{tuesday:true, thursday:true, saturday:true, sunday:true}});this.sinon.useFakeTimers();});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('initialization', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(<a class="el" href="../../d3/d91/j3d_8js.html#a4e10274dcc3f346cdbb535933d1d4f27">this.alarm.time</a>,[19, 7]);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('repeat', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(this.alarm.repeat,{tuesday:true, thursday:true, saturday:true, sunday:true});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('configuration', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d3/d91/j3d_8js.html#a4e10274dcc3f346cdbb535933d1d4f27">this.alarm.time</a>=[15, 43];assert.deepEqual(<a class="el" href="../../d3/d91/j3d_8js.html#a4e10274dcc3f346cdbb535933d1d4f27">this.alarm.time</a>,[15, 43]);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('repeat', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){this.alarm.repeat={monday:true, tuesday:true};assert.deepEqual(this.alarm.repeat,{monday:true, tuesday:true});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('Alarm snooze', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('snooze <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a> 5 minutes', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){clockSetter(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>)(<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">this.start</a>);this.alarm.snooze=5;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.getNextSnoozeFireTime().getTime(), <a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">this.start</a>+(5 *60 *1000));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('snooze <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a> 5 minutes, <a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a> seconds and milliseconds', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var msOffset=12512;clockSetter(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>)(<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">this.start</a>+msOffset);this.alarm.snooze=5;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.getNextSnoozeFireTime().getTime(), <a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">this.start</a>+(5 *60 *1000)+msOffset);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('snooze <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a> 5 minutes', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){clockSetter(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>)(<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">this.start</a>);this.alarm.snooze=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.getNextSnoozeFireTime(), <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>, 'no snooze <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#a7d50e9587913d4f6634c0b0c8de693c7">set</a>, getNextSnoozeFireTime should be <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>');});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Alarm custom summary', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var shortNames=[1, 2, 3, 4, 5, 6, 0].map(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(x){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> 'weekday-'+x+ '-short';});<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt; 128;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>([0, 31, 96, 127].<a class="el" href="../../d4/d23/binary__string__view_8js.html#a78826d1185ecdcfc63deffaedf15c7bd">indexOf</a>(<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>)!==-1){continue;}var expected=[];var repeat={};<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>&lt; 7;<a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>++){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>((<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &amp;(1&lt;&lt; <a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>))!==0){<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">expected.push</a>(shortNames[<a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>]);repeat[days[<a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>]]=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;}}this.alarm.repeat=repeat;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.summarizeDaysOfWeek(), <a class="el" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">expected.join</a>(', '), 'Summarizing '+<a class="el" href="../../d1/d22/ical_8js.html#a8076921037776baf4e4838660048f802">JSON.stringify</a>(repeat));}});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Weekend alarm summary', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){this.alarm.repeat={saturday:true, sunday:true};<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.summarizeDaysOfWeek(), 'weekends');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Weekday alarm summary', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){this.alarm.repeat={monday:true, tuesday:true, wednesday:true, thursday:true, friday:true};<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.summarizeDaysOfWeek(), 'weekdays');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Every day alarm summary', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){this.alarm.repeat={monday:true, tuesday:true, wednesday:true, thursday:true, friday:true, saturday:true, sunday:true};<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.summarizeDaysOfWeek(), 'everyday');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Never alarm summary', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){this.alarm.repeat={};<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.summarizeDaysOfWeek(), 'never');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Alarm Passed Today', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var setClock=clockSetter(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>);var alarmDate=new Date(1374057000000);alarmDate.setHours(18, 30, 0);var alarmTime=alarmDate.getTime();<a class="el" href="../../d3/d91/j3d_8js.html#a4e10274dcc3f346cdbb535933d1d4f27">this.alarm.time</a>=[alarmDate.getHours(), alarmDate.getMinutes()];var minuteOffsets=[-61,-60,-1, 0, 1, 60, 61];<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt; <a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">minuteOffsets.length</a>;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){setClock(alarmTime+(minuteOffsets[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>]*60000));<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.isAlarmPassedToday(), minuteOffsets[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>] &gt;=0);}});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('isDateInRepeat', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var daymap=new Map();var repeatodd={monday:true, wednesday:true, friday:true};var repeateven={sunday:true, tuesday:true, thursday:true, saturday:true};var cur=new Date();<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt; 7;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#a7d50e9587913d4f6634c0b0c8de693c7">daymap.set</a>(cur.getDay(), cur);cur=new Date(cur.getTime()+(24 *3600 *1000));}<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var el of daymap){(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(el){var repday=(el[0]+6)%7;var oddeven=((el[0]%2)===1)?repeatodd:repeateven;var evenodd=((el[0]%2)===0)?repeatodd:repeateven;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>(days[repday]+ '['+el[0]+ '] is in '+<a class="el" href="../../d1/d22/ical_8js.html#a8076921037776baf4e4838660048f802">JSON.stringify</a>(oddeven), <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var testalarm=new Alarm({repeat:oddeven});<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(testalarm.isDateInRepeat(<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">daymap.get</a>(el[0])));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>(days[repday]+ '['+el[0]+ '] is not in '+<a class="el" href="../../d1/d22/ical_8js.html#a8076921037776baf4e4838660048f802">JSON.stringify</a>(evenodd), <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var testalarm=new Alarm({repeat:evenodd});<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!testalarm.isDateInRepeat(<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">daymap.get</a>(el[0])));});})(el);}});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('repeatDays', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt;=7;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){var rep={};<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>&lt; <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>;<a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>++){rep[days[<a class="el" href="../../da/d7d/sylvester_8js.html#a8a080bd96df5681d77f59f96dc5da089">j</a>]]=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;}(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(testrepeat, <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>(<a class="el" href="../../d1/d22/ical_8js.html#a8076921037776baf4e4838660048f802">JSON.stringify</a>(testrepeat)+ 'has '+<a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>+ 'repeat days', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var testalarm=new Alarm({repeat:testrepeat});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(testalarm.repeatDays(), <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>);});})(rep, <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>);}});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('Next alarm <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var alarmTime, alarmDate, setClock;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){setClock=clockSetter(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>);alarmTime=1374057000000;alarmDate=new Date(alarmTime);alarmDate.setHours(6, 30, 0);<a class="el" href="../../d3/d4b/lockscreen_8js.html#a5ad25e705333134dd79a0ba0e766f6bc">while</a>(alarmDate.getDay()!==3){alarmDate.setHours(alarmDate.getHours()+24);}alarmTime=alarmDate.getTime();<a class="el" href="../../d3/d91/j3d_8js.html#a4e10274dcc3f346cdbb535933d1d4f27">this.alarm.time</a>=[alarmDate.getHours(), alarmDate.getMinutes()];this.alarm.repeat={};});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('No repeat-&gt; today', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){setClock(alarmTime-60000);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.getNextAlarmFireTime().getTime(), alarmTime);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('No repeat-&gt; tomorrow', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){setClock(alarmTime+60000);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.getNextAlarmFireTime().getTime(), alarmTime+(24 *60 *60 *1000));});<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt;=7;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){var thisDay=days[(2+<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>)%7];<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Check '+((<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &gt; 0)? 'alarm-passed': 'alarm-today')+ 'with repeat '+thisDay,(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>, thisDay){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var compareDate=new Date(alarmTime);compareDate.setDate(compareDate.getDate()+<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>);<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>===0){setClock(alarmTime-60000);}else{setClock(alarmTime+60000);}var repeat={};repeat[thisDay]=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;this.alarm.repeat=repeat;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(this.alarm.getNextAlarmFireTime().getTime(), compareDate.getTime());};})(<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>, thisDay));}});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('Alarm scheduling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var navMozAlarms, setClock;suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){navMozAlarms=navigator.mozAlarms;navigator.mozAlarms=new <a class="el" href="../../d6/df3/wifi__test_8js.html#a835d106b4baae046300bd4fb377fc863">MockMozAlarms</a>(<a class="el" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">ActiveAlarm.handler</a>);});suiteTeardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){navigator.mozAlarms=navMozAlarms;});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){setClock=clockSetter(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>);<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">this.date</a>=new Date(1374102438043);this.date.setHours(6, 17, 0, 0);<a class="el" href="../../d3/d4b/lockscreen_8js.html#a5ad25e705333134dd79a0ba0e766f6bc">while</a>(this.date.getDay()!==3){<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">this.date</a>=new Date(this.date.getTime()+(24 *3600 *1000));}setClock(this.date.getTime());this.alarm=new Alarm({id:1, repeat:{wednesday:true, friday:true}, hour:this.date.getHours(), minute:this.date.getMinutes(), snooze:17});});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var alarms=navigator.mozAlarms.alarms;<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt; <a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">alarms.length</a>;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){<a class="el" href="../../da/da1/timers_8js.html#ab37ff0db33a3bf80b0163adc40a58424">clearTimeout</a>(alarms[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].<a class="el" href="../../da/d32/prio_8h.html#a0f2163507f01dc9bb68ca5c72cacaa34">timeout</a>);}navigator.mozAlarms.alarms=[];});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Scheduling <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> normal alarm <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a> the <a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a> <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>, repeat', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var cur=this.date.getTime()+(60 *1000);setClock(cur);this.alarm.schedule({type: 'normal', first:true}, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, alarm){var alarms=navigator.mozAlarms.alarms;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">alarms.length</a>, 1);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, alarm.registeredAlarms['normal']);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].date.getTime(), this.date.getTime()+(2 *24 *3600 *1000));<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}.<a class="el" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>));<a class="el" href="../../d3/d91/j3d_8js.html#aeba439cf129372b4ebc312b3a29efe66">this.sinon.clock.tick</a>(1000);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Scheduling <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> normal alarm <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a> the <a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a> <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>, no repeat', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){this.alarm.repeat={};var cur=this.date.getTime()+(60 *1000);setClock(cur);this.alarm.schedule({type: 'normal', first:true}, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, alarm){var alarms=navigator.mozAlarms.alarms;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">alarms.length</a>, 1);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, alarm.registeredAlarms['normal']);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].date.getTime(), this.date.getTime()+(24 *3600 *1000));<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}.<a class="el" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>));<a class="el" href="../../d3/d91/j3d_8js.html#aeba439cf129372b4ebc312b3a29efe66">this.sinon.clock.tick</a>(1000);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Scheduling <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> normal alarm <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a> the second <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>, repeat', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){setClock(this.date.getTime());this.alarm.schedule({type: 'normal', first:false}, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, alarm){var alarms=navigator.mozAlarms.alarms;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">alarms.length</a>, 1);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, alarm.registeredAlarms['normal']);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].date.getTime(), this.date.getTime()+(2 *24 *3600 *1000));<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}.<a class="el" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>));<a class="el" href="../../d3/d91/j3d_8js.html#aeba439cf129372b4ebc312b3a29efe66">this.sinon.clock.tick</a>(1000);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Scheduling <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> normal alarm <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a> the <a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a> <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>, no repeat', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){this.alarm.repeat={};var cur=this.date.getTime()+(60 *1000);setClock(cur);this.alarm.schedule({type: 'normal', first:true}, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, alarm){var alarms=navigator.mozAlarms.alarms;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">alarms.length</a>, 1);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, alarm.registeredAlarms['normal']);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].date.getTime(), this.date.getTime()+(24 *3600 *1000));<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}.<a class="el" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>));<a class="el" href="../../d3/d91/j3d_8js.html#aeba439cf129372b4ebc312b3a29efe66">this.sinon.clock.tick</a>(1000);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Scheduling <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> normal alarm <a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a> the second <a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>, no repeat', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){this.alarm.repeat={};var cur=this.date.getTime()+(60 *1000);setClock(cur);this.alarm.schedule({type: 'normal', first:false}, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, alarm){var alarms=navigator.mozAlarms.alarms;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">alarms.length</a>, 0);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}.<a class="el" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>));<a class="el" href="../../d3/d91/j3d_8js.html#aeba439cf129372b4ebc312b3a29efe66">this.sinon.clock.tick</a>(1000);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('Scheduling <a class="el" href="../../d5/de7/jquery_8js.html#aa4d4888597588a84fd5b1184d00c91f3">a</a> snooze alarm', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){this.alarm.repeat={};setClock(this.date.getTime());this.alarm.schedule({type: 'snooze'}, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, alarm){var alarms=navigator.mozAlarms.alarms;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">alarms.length</a>, 1);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, alarm.registeredAlarms['snooze']);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(alarms[0].date.getTime(), this.date.getTime()+(17 *60 *1000));<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}.<a class="el" href="../../d3/d91/j3d_8js.html#a1ad2f17c038f79ef240a44e21a46ef14">bind</a>(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>));<a class="el" href="../../d3/d91/j3d_8js.html#aeba439cf129372b4ebc312b3a29efe66">this.sinon.clock.tick</a>(1000);});});});})</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="ae3f4a220224ec995993868b05e81bfc1"></a><!-- doxytag: member="clock/test/unit/alarm_test.js::requireApp" ref="ae3f4a220224ec995993868b05e81bfc1" args="('clock/js/constants.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d16/shared_2test_2unit_2mocks_2mock__settings__listener_8js.html#ada5f8f0f77028802cd46c92cb1ce8fce">requireApp</a> </td>
          <td>(</td>
          <td class="paramtype">'clock/js/constants.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8d19a020a983521cb52903d455f57ef7"></a><!-- doxytag: member="clock/test/unit/alarm_test.js::suite" ref="a8d19a020a983521cb52903d455f57ef7" args="('Alarm Test', function(){var nativeMozL10n=navigator.mozL10n;var nativeAlarmsDB=window.AlarmsDB;var nativeActiveAlarmHandler;suiteSetup(function(){navigator.mozL10n=MockL10n;window.AlarmsDB=new MockAlarmsDB();navigator.mozAlarms=new MockMozAlarms(ActiveAlarm.handler);});suiteTeardown(function(){navigator.mozL10n=nativeMozL10n;window.AlarmsDB=nativeAlarmsDB;});setup(function(){this.sinon.stub(ActiveAlarm, 'handler');});suite('Date handling', function(){var clockSetter=function(thisVal){return function(x){this.sinon.clock.tick((&#45;1 *this.sinon.clock.tick())+x);}.bind(thisVal);};var days=['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];setup(function(){this.startDate=new Date(1374102438043);this.startDate.setHours(19, 7, 18);while(this.startDate.getDay()!==3){this.startDate.setHours(this.startDate.getHours()+24);}this.start=this.startDate.getTime();this.alarm=new Alarm({hour:this.startDate.getHours(), minute:this.startDate.getMinutes(), repeat:{tuesday:true, thursday:true, saturday:true, sunday:true}});this.sinon.useFakeTimers();});suite('initialization', function(){test('time', function(){assert.deepEqual(this.alarm.time,[19, 7]);});test('repeat', function(){assert.deepEqual(this.alarm.repeat,{tuesday:true, thursday:true, saturday:true, sunday:true});});});suite('configuration', function(){test('time', function(){this.alarm.time=[15, 43];assert.deepEqual(this.alarm.time,[15, 43]);});test('repeat', function(){this.alarm.repeat={monday:true, tuesday:true};assert.deepEqual(this.alarm.repeat,{monday:true, tuesday:true});});});suite('Alarm snooze', function(){test('snooze for 5 minutes', function(){clockSetter(this)(this.start);this.alarm.snooze=5;assert.equal(this.alarm.getNextSnoozeFireTime().getTime(), this.start+(5 *60 *1000));});test('snooze for 5 minutes, test seconds and milliseconds', function(){var msOffset=12512;clockSetter(this)(this.start+msOffset);this.alarm.snooze=5;assert.equal(this.alarm.getNextSnoozeFireTime().getTime(), this.start+(5 *60 *1000)+msOffset);});test('snooze for 5 minutes', function(){clockSetter(this)(this.start);this.alarm.snooze=null;assert.equal(this.alarm.getNextSnoozeFireTime(), null, 'no snooze set, getNextSnoozeFireTime should be null');});});test('Alarm custom summary', function(){var shortNames=[1, 2, 3, 4, 5, 6, 0].map(function(x){return 'weekday&#45;'+x+ '&#45;short';});for(var i=0;i&lt; 128;i++){if([0, 31, 96, 127].indexOf(i)!==&#45;1){continue;}var expected=[];var repeat={};for(var j=0;j&lt; 7;j++){if((i &amp;(1&lt;&lt; j))!==0){expected.push(shortNames[j]);repeat[days[j]]=true;}}this.alarm.repeat=repeat;assert.equal(this.alarm.summarizeDaysOfWeek(), expected.join(', '), 'Summarizing '+JSON.stringify(repeat));}});test('Weekend alarm summary', function(){this.alarm.repeat={saturday:true, sunday:true};assert.equal(this.alarm.summarizeDaysOfWeek(), 'weekends');});test('Weekday alarm summary', function(){this.alarm.repeat={monday:true, tuesday:true, wednesday:true, thursday:true, friday:true};assert.equal(this.alarm.summarizeDaysOfWeek(), 'weekdays');});test('Every day alarm summary', function(){this.alarm.repeat={monday:true, tuesday:true, wednesday:true, thursday:true, friday:true, saturday:true, sunday:true};assert.equal(this.alarm.summarizeDaysOfWeek(), 'everyday');});test('Never alarm summary', function(){this.alarm.repeat={};assert.equal(this.alarm.summarizeDaysOfWeek(), 'never');});test('Alarm Passed Today', function(){var setClock=clockSetter(this);var alarmDate=new Date(1374057000000);alarmDate.setHours(18, 30, 0);var alarmTime=alarmDate.getTime();this.alarm.time=[alarmDate.getHours(), alarmDate.getMinutes()];var minuteOffsets=[&#45;61,&#45;60,&#45;1, 0, 1, 60, 61];for(var i=0;i&lt; minuteOffsets.length;i++){setClock(alarmTime+(minuteOffsets[i]*60000));assert.equal(this.alarm.isAlarmPassedToday(), minuteOffsets[i] &gt;=0);}});suite('isDateInRepeat', function(){var daymap=new Map();var repeatodd={monday:true, wednesday:true, friday:true};var repeateven={sunday:true, tuesday:true, thursday:true, saturday:true};var cur=new Date();for(var i=0;i&lt; 7;i++){daymap.set(cur.getDay(), cur);cur=new Date(cur.getTime()+(24 *3600 *1000));}for(var el of daymap){(function(el){var repday=(el[0]+6)%7;var oddeven=((el[0]%2)===1)?repeatodd:repeateven;var evenodd=((el[0]%2)===0)?repeatodd:repeateven;test(days[repday]+ '['+el[0]+ '] is in '+JSON.stringify(oddeven), function(){var testalarm=new Alarm({repeat:oddeven});assert.ok(testalarm.isDateInRepeat(daymap.get(el[0])));});test(days[repday]+ '['+el[0]+ '] is not in '+JSON.stringify(evenodd), function(){var testalarm=new Alarm({repeat:evenodd});assert.ok(!testalarm.isDateInRepeat(daymap.get(el[0])));});})(el);}});suite('repeatDays', function(){for(var i=0;i&lt;=7;i++){var rep={};for(var j=0;j&lt; i;j++){rep[days[j]]=true;}(function(testrepeat, value){test(JSON.stringify(testrepeat)+ 'has '+value+ 'repeat days', function(){var testalarm=new Alarm({repeat:testrepeat});assert.equal(testalarm.repeatDays(), value);});})(rep, i);}});suite('Next alarm time', function(){var alarmTime, alarmDate, setClock;setup(function(){setClock=clockSetter(this);alarmTime=1374057000000;alarmDate=new Date(alarmTime);alarmDate.setHours(6, 30, 0);while(alarmDate.getDay()!==3){alarmDate.setHours(alarmDate.getHours()+24);}alarmTime=alarmDate.getTime();this.alarm.time=[alarmDate.getHours(), alarmDate.getMinutes()];this.alarm.repeat={};});test('No repeat&#45;&gt; today', function(){setClock(alarmTime&#45;60000);assert.equal(this.alarm.getNextAlarmFireTime().getTime(), alarmTime);});test('No repeat&#45;&gt; tomorrow', function(){setClock(alarmTime+60000);assert.equal(this.alarm.getNextAlarmFireTime().getTime(), alarmTime+(24 *60 *60 *1000));});for(var i=0;i&lt;=7;i++){var thisDay=days[(2+i)%7];test('Check '+((i &gt; 0)? 'alarm&#45;passed': 'alarm&#45;today')+ 'with repeat '+thisDay,(function(i, thisDay){return function(){var compareDate=new Date(alarmTime);compareDate.setDate(compareDate.getDate()+i);if(i===0){setClock(alarmTime&#45;60000);}else{setClock(alarmTime+60000);}var repeat={};repeat[thisDay]=true;this.alarm.repeat=repeat;assert.equal(this.alarm.getNextAlarmFireTime().getTime(), compareDate.getTime());};})(i, thisDay));}});suite('Alarm scheduling', function(){var navMozAlarms, setClock;suiteSetup(function(){navMozAlarms=navigator.mozAlarms;navigator.mozAlarms=new MockMozAlarms(ActiveAlarm.handler);});suiteTeardown(function(){navigator.mozAlarms=navMozAlarms;});setup(function(){setClock=clockSetter(this);this.date=new Date(1374102438043);this.date.setHours(6, 17, 0, 0);while(this.date.getDay()!==3){this.date=new Date(this.date.getTime()+(24 *3600 *1000));}setClock(this.date.getTime());this.alarm=new Alarm({id:1, repeat:{wednesday:true, friday:true}, hour:this.date.getHours(), minute:this.date.getMinutes(), snooze:17});});teardown(function(){var alarms=navigator.mozAlarms.alarms;for(var i=0;i&lt; alarms.length;i++){clearTimeout(alarms[i].timeout);}navigator.mozAlarms.alarms=[];});test('Scheduling a normal alarm for the first time, repeat', function(done){var cur=this.date.getTime()+(60 *1000);setClock(cur);this.alarm.schedule({type: 'normal', first:true}, function(err, alarm){var alarms=navigator.mozAlarms.alarms;assert.equal(alarms.length, 1);assert.equal(alarms[0].id, alarm.registeredAlarms['normal']);assert.equal(alarms[0].date.getTime(), this.date.getTime()+(2 *24 *3600 *1000));done();}.bind(this));this.sinon.clock.tick(1000);});test('Scheduling a normal alarm for the first time, no repeat', function(done){this.alarm.repeat={};var cur=this.date.getTime()+(60 *1000);setClock(cur);this.alarm.schedule({type: 'normal', first:true}, function(err, alarm){var alarms=navigator.mozAlarms.alarms;assert.equal(alarms.length, 1);assert.equal(alarms[0].id, alarm.registeredAlarms['normal']);assert.equal(alarms[0].date.getTime(), this.date.getTime()+(24 *3600 *1000));done();}.bind(this));this.sinon.clock.tick(1000);});test('Scheduling a normal alarm for the second time, repeat', function(done){setClock(this.date.getTime());this.alarm.schedule({type: 'normal', first:false}, function(err, alarm){var alarms=navigator.mozAlarms.alarms;assert.equal(alarms.length, 1);assert.equal(alarms[0].id, alarm.registeredAlarms['normal']);assert.equal(alarms[0].date.getTime(), this.date.getTime()+(2 *24 *3600 *1000));done();}.bind(this));this.sinon.clock.tick(1000);});test('Scheduling a normal alarm for the first time, no repeat', function(done){this.alarm.repeat={};var cur=this.date.getTime()+(60 *1000);setClock(cur);this.alarm.schedule({type: 'normal', first:true}, function(err, alarm){var alarms=navigator.mozAlarms.alarms;assert.equal(alarms.length, 1);assert.equal(alarms[0].id, alarm.registeredAlarms['normal']);assert.equal(alarms[0].date.getTime(), this.date.getTime()+(24 *3600 *1000));done();}.bind(this));this.sinon.clock.tick(1000);});test('Scheduling a normal alarm for the second time, no repeat', function(done){this.alarm.repeat={};var cur=this.date.getTime()+(60 *1000);setClock(cur);this.alarm.schedule({type: 'normal', first:false}, function(err, alarm){var alarms=navigator.mozAlarms.alarms;assert.equal(alarms.length, 0);done();}.bind(this));this.sinon.clock.tick(1000);});test('Scheduling a snooze alarm', function(done){this.alarm.repeat={};setClock(this.date.getTime());this.alarm.schedule({type: 'snooze'}, function(err, alarm){var alarms=navigator.mozAlarms.alarms;assert.equal(alarms.length, 1);assert.equal(alarms[0].id, alarm.registeredAlarms['snooze']);assert.equal(alarms[0].date.getTime(), this.date.getTime()+(17 *60 *1000));done();}.bind(this));this.sinon.clock.tick(1000);});});});})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a> </td>
          <td>(</td>
          <td class="paramtype">'Alarm Test'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d7/d7d/clock_2test_2unit_2alarm__test_8js.html">alarm_test.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:42に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
