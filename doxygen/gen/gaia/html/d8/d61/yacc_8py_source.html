<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: yacc.py ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d8/d61/yacc_8py.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">yacc.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d8/d61/yacc_8py.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html">00001</a> <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment"># ply: yacc.py</span>
<a name="l00003"></a>00003 <span class="comment">#</span>
<a name="l00004"></a>00004 <span class="comment"># Copyright (C) 2001-2009,</span>
<a name="l00005"></a>00005 <span class="comment"># David M. Beazley (Dabeaz LLC)</span>
<a name="l00006"></a>00006 <span class="comment"># All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">#</span>
<a name="l00008"></a>00008 <span class="comment"># Redistribution and use in source and binary forms, with or without</span>
<a name="l00009"></a>00009 <span class="comment"># modification, are permitted provided that the following conditions are</span>
<a name="l00010"></a>00010 <span class="comment"># met:</span>
<a name="l00011"></a>00011 <span class="comment"># </span>
<a name="l00012"></a>00012 <span class="comment"># * Redistributions of source code must retain the above copyright notice,</span>
<a name="l00013"></a>00013 <span class="comment">#   this list of conditions and the following disclaimer.  </span>
<a name="l00014"></a>00014 <span class="comment"># * Redistributions in binary form must reproduce the above copyright notice, </span>
<a name="l00015"></a>00015 <span class="comment">#   this list of conditions and the following disclaimer in the documentation</span>
<a name="l00016"></a>00016 <span class="comment">#   and/or other materials provided with the distribution.  </span>
<a name="l00017"></a>00017 <span class="comment"># * Neither the name of the David Beazley or Dabeaz LLC may be used to</span>
<a name="l00018"></a>00018 <span class="comment">#   endorse or promote products derived from this software without</span>
<a name="l00019"></a>00019 <span class="comment">#  specific prior written permission. </span>
<a name="l00020"></a>00020 <span class="comment">#</span>
<a name="l00021"></a>00021 <span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00022"></a>00022 <span class="comment"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00023"></a>00023 <span class="comment"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00024"></a>00024 <span class="comment"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00025"></a>00025 <span class="comment"># OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00026"></a>00026 <span class="comment"># SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00027"></a>00027 <span class="comment"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00028"></a>00028 <span class="comment"># DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00029"></a>00029 <span class="comment"># THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00030"></a>00030 <span class="comment"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00031"></a>00031 <span class="comment"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00032"></a>00032 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l00033"></a>00033 <span class="comment">#</span>
<a name="l00034"></a>00034 <span class="comment"># This implements an LR parser that is constructed from grammar rules defined</span>
<a name="l00035"></a>00035 <span class="comment"># as Python functions. The grammer is specified by supplying the BNF inside</span>
<a name="l00036"></a>00036 <span class="comment"># Python documentation strings.  The inspiration for this technique was borrowed</span>
<a name="l00037"></a>00037 <span class="comment"># from John Aycock&#39;s Spark parsing system.  PLY might be viewed as cross between</span>
<a name="l00038"></a>00038 <span class="comment"># Spark and the GNU bison utility.</span>
<a name="l00039"></a>00039 <span class="comment">#</span>
<a name="l00040"></a>00040 <span class="comment"># The current implementation is only somewhat object-oriented. The</span>
<a name="l00041"></a>00041 <span class="comment"># LR parser itself is defined in terms of an object (which allows multiple</span>
<a name="l00042"></a>00042 <span class="comment"># parsers to co-exist).  However, most of the variables used during table</span>
<a name="l00043"></a>00043 <span class="comment"># construction are defined in terms of global variables.  Users shouldn&#39;t</span>
<a name="l00044"></a>00044 <span class="comment"># notice unless they are trying to define multiple parsers at the same</span>
<a name="l00045"></a>00045 <span class="comment"># time using threads (in which case they should have their head examined).</span>
<a name="l00046"></a>00046 <span class="comment">#</span>
<a name="l00047"></a>00047 <span class="comment"># This implementation supports both SLR and LALR(1) parsing.  LALR(1)</span>
<a name="l00048"></a>00048 <span class="comment"># support was originally implemented by Elias Ioup (ezioup@alumni.uchicago.edu),</span>
<a name="l00049"></a>00049 <span class="comment"># using the algorithm found in Aho, Sethi, and Ullman &quot;Compilers: Principles,</span>
<a name="l00050"></a>00050 <span class="comment"># Techniques, and Tools&quot; (The Dragon Book).  LALR(1) has since been replaced</span>
<a name="l00051"></a>00051 <span class="comment"># by the more efficient DeRemer and Pennello algorithm.</span>
<a name="l00052"></a>00052 <span class="comment">#</span>
<a name="l00053"></a>00053 <span class="comment"># :::::::: WARNING :::::::</span>
<a name="l00054"></a>00054 <span class="comment">#</span>
<a name="l00055"></a>00055 <span class="comment"># Construction of LR parsing tables is fairly complicated and expensive.</span>
<a name="l00056"></a>00056 <span class="comment"># To make this module run fast, a *LOT* of work has been put into</span>
<a name="l00057"></a>00057 <span class="comment"># optimization---often at the expensive of readability and what might</span>
<a name="l00058"></a>00058 <span class="comment"># consider to be good Python &quot;coding style.&quot;   Modify the code at your</span>
<a name="l00059"></a>00059 <span class="comment"># own risk!</span>
<a name="l00060"></a>00060 <span class="comment"># ----------------------------------------------------------------------------</span>
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#ad33006d5a80a203ee1ce1a7d3e2252f6">00062</a> __version__    = <span class="stringliteral">&quot;3.3&quot;</span>
<a name="l00063"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a589cef2e250486ccde4ea16ed5f622b5">00063</a> __tabversion__ = <span class="stringliteral">&quot;3.2&quot;</span>       <span class="comment"># Table version</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="comment">#-----------------------------------------------------------------------------</span>
<a name="l00066"></a>00066 <span class="comment">#                     === User configurable parameters ===</span>
<a name="l00067"></a>00067 <span class="comment">#</span>
<a name="l00068"></a>00068 <span class="comment"># Change these to modify the default behavior of yacc (if you wish)</span>
<a name="l00069"></a>00069 <span class="comment">#-----------------------------------------------------------------------------</span>
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#abd8500abab29247f82284e2c48a632bb">00071</a> yaccdebug   = 1                <span class="comment"># Debugging mode.  If set, yacc generates a</span>
<a name="l00072"></a>00072                                <span class="comment"># a &#39;parser.out&#39; file in the current directory</span>
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a46194fdcba33265c9e5a120a21c8c169">00074</a> debug_file  = <span class="stringliteral">&#39;parser.out&#39;</span>     <span class="comment"># Default name of the debugging file</span>
<a name="l00075"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a5d6054035b62c6486a66dad1709f75db">00075</a> tab_module  = <span class="stringliteral">&#39;parsetab&#39;</span>       <span class="comment"># Default name of the table module</span>
<a name="l00076"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a03005fb1fbd33d7de8ba8aece06f97d3">00076</a> default_lr  = <span class="stringliteral">&#39;LALR&#39;</span>           <span class="comment"># Default LR table generation method</span>
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a023d75b52b7f8365772209707c320a08">00078</a> error_count = 3                <span class="comment"># Number of symbols that must be shifted to leave recovery mode</span>
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#af5cfa366198150e67523cce656939f22">00080</a> yaccdevel   = 0                <span class="comment"># Set to True if developing yacc.  This turns off optimized</span>
<a name="l00081"></a>00081                                <span class="comment"># implementations of certain functions.</span>
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#abd6473a9d7b0e9f8896155295e7d4430">00083</a> resultlimit = 40               <span class="comment"># Size limit of results when running in debug mode.</span>
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a35c264a70f7b1e873620943c4f5d85e0">00085</a> pickle_protocol = 0            <span class="comment"># Protocol to use when writing pickle files</span>
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="keyword">import</span> re, types, sys, os.path
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment"># Compatibility function for python 2.6/3.0</span>
<a name="l00090"></a>00090 <span class="keywordflow">if</span> sys.version_info[0] &lt; 3:
<a name="l00091"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">00091</a>     <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(f):
<a name="l00092"></a>00092         <span class="keywordflow">return</span> f.func_code
<a name="l00093"></a>00093 <span class="keywordflow">else</span>:
<a name="l00094"></a>00094     <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(f):
<a name="l00095"></a>00095         <span class="keywordflow">return</span> f.__code__
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment"># Compatibility</span>
<a name="l00098"></a>00098 <span class="keywordflow">try</span>:
<a name="l00099"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a1b5067ce51567bc3e62fd73b942a0c56">00099</a>     MAXINT = sys.maxint
<a name="l00100"></a>00100 <span class="keywordflow">except</span> AttributeError:
<a name="l00101"></a>00101     MAXINT = sys.maxsize
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="comment"># Python 2.x/3.0 compatibility.</span>
<a name="l00104"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#acb247fbbf4ace4412a91df37b83596a8">00104</a> <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#acb247fbbf4ace4412a91df37b83596a8">load_ply_lex</a>():
<a name="l00105"></a>00105     <span class="keywordflow">if</span> sys.version_info[0] &lt; 3:
<a name="l00106"></a>00106         <span class="keyword">import</span> lex
<a name="l00107"></a>00107     <span class="keywordflow">else</span>:
<a name="l00108"></a>00108         <span class="keyword">import</span> ply.lex <span class="keyword">as</span> lex
<a name="l00109"></a>00109     <span class="keywordflow">return</span> lex
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="comment"># This object is a stand-in for a logging object created by the </span>
<a name="l00112"></a>00112 <span class="comment"># logging module.   PLY will use this by default to create things</span>
<a name="l00113"></a>00113 <span class="comment"># such as the parser.out file.  If a user wants more detailed</span>
<a name="l00114"></a>00114 <span class="comment"># information, they can create their own logging object and pass</span>
<a name="l00115"></a>00115 <span class="comment"># it into PLY.</span>
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html">00117</a> <span class="keyword">class </span><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html">PlyLogger</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l00118"></a><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#acca7d7da4a4a4c327876ef670016037d">00118</a>     <span class="keyword">def </span><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#a107bd5892ee316cda7cdcedce56fa7a5">__init__</a>(self,f):
<a name="l00119"></a>00119         self.<a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#acca7d7da4a4a4c327876ef670016037d">f</a> = f
<a name="l00120"></a><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#afef0a2201f3dfc6df0ad647acc6c147a">00120</a>     <span class="keyword">def </span><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#afef0a2201f3dfc6df0ad647acc6c147a">debug</a>(self,msg,*args,**kwargs):
<a name="l00121"></a>00121         self.f.write((msg % args) + <span class="stringliteral">&quot;\n&quot;</span>)
<a name="l00122"></a><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#ac6f7572d60f670ad6980bb2c299ad41a">00122</a>     info     = debug
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#aa5b711a08d47bc558fd47aac7928cbbb">00124</a>     <span class="keyword">def </span><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#aa5b711a08d47bc558fd47aac7928cbbb">warning</a>(self,msg,*args,**kwargs):
<a name="l00125"></a>00125         self.f.write(<span class="stringliteral">&quot;WARNING: &quot;</span>+ (msg % args) + <span class="stringliteral">&quot;\n&quot;</span>)
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#af5fed0f980e30c514b3155fb618ee8d5">00127</a>     <span class="keyword">def </span><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#af5fed0f980e30c514b3155fb618ee8d5">error</a>(self,msg,*args,**kwargs):
<a name="l00128"></a>00128         self.f.write(<span class="stringliteral">&quot;ERROR: &quot;</span> + (msg % args) + <span class="stringliteral">&quot;\n&quot;</span>)
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html#a66a9cfbcabe7f463ad085b39e93c7f71">00130</a>     critical = debug
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="comment"># Null logger is used when no output is generated. Does nothing.</span>
<a name="l00133"></a><a class="code" href="../../da/d0e/classply_1_1yacc_1_1_null_logger.html">00133</a> <span class="keyword">class </span><a class="code" href="../../da/d0e/classply_1_1yacc_1_1_null_logger.html">NullLogger</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l00134"></a><a class="code" href="../../da/d0e/classply_1_1yacc_1_1_null_logger.html#a33f2fde8543dd8126276c22ba43505c9">00134</a>     <span class="keyword">def </span><a class="code" href="../../da/d0e/classply_1_1yacc_1_1_null_logger.html#a33f2fde8543dd8126276c22ba43505c9">__getattribute__</a>(self,name):
<a name="l00135"></a>00135         <span class="keywordflow">return</span> self
<a name="l00136"></a><a class="code" href="../../da/d0e/classply_1_1yacc_1_1_null_logger.html#a95f5d0bc8aeb9d4fd3c7e2f33b598636">00136</a>     <span class="keyword">def </span><a class="code" href="../../da/d0e/classply_1_1yacc_1_1_null_logger.html#a95f5d0bc8aeb9d4fd3c7e2f33b598636">__call__</a>(self,*args,**kwargs):
<a name="l00137"></a>00137         <span class="keywordflow">return</span> self
<a name="l00138"></a>00138         
<a name="l00139"></a>00139 <span class="comment"># Exception raised for yacc-related errors</span>
<a name="l00140"></a><a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">00140</a> <span class="keyword">class </span><a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">YaccError</a>(Exception):   <span class="keywordflow">pass</span>
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="comment"># Format the result message that the parser produces when running in debug mode.</span>
<a name="l00143"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a0ca9513bd4b7a488845448e2f274aee4">00143</a> <span class="keyword">def</span> format_result(r):
<a name="l00144"></a>00144     repr_str = repr(r)
<a name="l00145"></a>00145     <span class="keywordflow">if</span> <span class="stringliteral">&#39;\n&#39;</span> <span class="keywordflow">in</span> repr_str: repr_str = repr(repr_str)
<a name="l00146"></a>00146     <span class="keywordflow">if</span> len(repr_str) &gt; resultlimit:
<a name="l00147"></a>00147         repr_str = repr_str[:resultlimit]+<span class="stringliteral">&quot; ...&quot;</span>
<a name="l00148"></a>00148     result = <span class="stringliteral">&quot;&lt;%s @ 0x%x&gt; (%s)&quot;</span> % (<a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>(r).__name__,<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(r),repr_str)
<a name="l00149"></a>00149     <span class="keywordflow">return</span> result
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="comment"># Format stack entries when the parser is running in debug mode</span>
<a name="l00153"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#aac0da43c76a890dc4a423db18b24d443">00153</a> <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#aac0da43c76a890dc4a423db18b24d443">format_stack_entry</a>(r):
<a name="l00154"></a>00154     repr_str = repr(r)
<a name="l00155"></a>00155     <span class="keywordflow">if</span> <span class="stringliteral">&#39;\n&#39;</span> <span class="keywordflow">in</span> repr_str: repr_str = repr(repr_str)
<a name="l00156"></a>00156     <span class="keywordflow">if</span> len(repr_str) &lt; 16:
<a name="l00157"></a>00157         <span class="keywordflow">return</span> repr_str
<a name="l00158"></a>00158     <span class="keywordflow">else</span>:
<a name="l00159"></a>00159         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;%s @ 0x%x&gt;&quot;</span> % (<a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>(r).__name__,<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(r))
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="comment">#-----------------------------------------------------------------------------</span>
<a name="l00162"></a>00162 <span class="comment">#                        ===  LR Parsing Engine ===</span>
<a name="l00163"></a>00163 <span class="comment">#</span>
<a name="l00164"></a>00164 <span class="comment"># The following classes are used for the LR parser itself.  These are not</span>
<a name="l00165"></a>00165 <span class="comment"># used during table construction and are independent of the actual LR</span>
<a name="l00166"></a>00166 <span class="comment"># table generation algorithm</span>
<a name="l00167"></a>00167 <span class="comment">#-----------------------------------------------------------------------------</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="comment"># This class is used to hold non-terminal grammar symbols during parsing.</span>
<a name="l00170"></a>00170 <span class="comment"># It normally has the following attributes set:</span>
<a name="l00171"></a>00171 <span class="comment">#        .type       = Grammar symbol type</span>
<a name="l00172"></a>00172 <span class="comment">#        .value      = Symbol value</span>
<a name="l00173"></a>00173 <span class="comment">#        .lineno     = Starting line number</span>
<a name="l00174"></a>00174 <span class="comment">#        .endlineno  = Ending line number (optional, set automatically)</span>
<a name="l00175"></a>00175 <span class="comment">#        .lexpos     = Starting lex position</span>
<a name="l00176"></a>00176 <span class="comment">#        .endlexpos  = Ending lex position (optional, set automatically)</span>
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">00178</a> <span class="keyword">class </span><a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>:
<a name="l00179"></a><a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html#a65d199f2248683c7362c8bcacef5ce48">00179</a>     <span class="keyword">def </span><a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html#a65d199f2248683c7362c8bcacef5ce48">__str__</a>(self):    <span class="keywordflow">return</span> self.type
<a name="l00180"></a><a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html#a8f36a271500fee02a72ead4c80bcff3e">00180</a>     <span class="keyword">def </span><a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html#a8f36a271500fee02a72ead4c80bcff3e">__repr__</a>(self):   <span class="keywordflow">return</span> str(self)
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="comment"># This class is a wrapper around the objects actually passed to each</span>
<a name="l00183"></a>00183 <span class="comment"># grammar rule.   Index lookup and assignment actually assign the</span>
<a name="l00184"></a>00184 <span class="comment"># .value attribute of the underlying YaccSymbol object.</span>
<a name="l00185"></a>00185 <span class="comment"># The lineno() method returns the line number of a given</span>
<a name="l00186"></a>00186 <span class="comment"># item (or 0 if not defined).   The linespan() method returns</span>
<a name="l00187"></a>00187 <span class="comment"># a tuple of (startline,endline) representing the range of lines</span>
<a name="l00188"></a>00188 <span class="comment"># for a symbol.  The lexspan() method returns a tuple (lexpos,endlexpos)</span>
<a name="l00189"></a>00189 <span class="comment"># representing the range of positional information for a symbol.</span>
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html">00191</a> <span class="keyword">class </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html">YaccProduction</a>:
<a name="l00192"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a0a97e88c82c72aa9f996926c643422ab">00192</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a7c346236920ecadf2ef0fc71f0006531">__init__</a>(self,s,stack=None):
<a name="l00193"></a>00193         self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a> = s
<a name="l00194"></a>00194         self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a0a97e88c82c72aa9f996926c643422ab">stack</a> = stack
<a name="l00195"></a>00195         self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a04f2073bb22e0191c8a400e09b456796">lexer</a> = <span class="keywordtype">None</span>
<a name="l00196"></a>00196         self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a057670afa5a1b88548e20fd4534c38f0">parser</a>= <span class="keywordtype">None</span>
<a name="l00197"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a5872d4c6c5398f8cd1942212f4499c34">00197</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a5872d4c6c5398f8cd1942212f4499c34">__getitem__</a>(self,n):
<a name="l00198"></a>00198         <span class="keywordflow">if</span> n &gt;= 0: <span class="keywordflow">return</span> self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n].value
<a name="l00199"></a>00199         <span class="keywordflow">else</span>: <span class="keywordflow">return</span> self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a0a97e88c82c72aa9f996926c643422ab">stack</a>[n].value
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a2329d881f09e25c03ae2023f9f41162b">00201</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a2329d881f09e25c03ae2023f9f41162b">__setitem__</a>(self,n,v):
<a name="l00202"></a>00202         self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n].value = v
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#aee0eda04e8bf6eb66ec34b38ae55aecb">00204</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#aee0eda04e8bf6eb66ec34b38ae55aecb">__getslice__</a>(self,i,j):
<a name="l00205"></a>00205         <span class="keywordflow">return</span> [s.value <span class="keywordflow">for</span> s <span class="keywordflow">in</span> self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[i:j]]
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a6346add36165827f2099edb25b7815a5">00207</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a6346add36165827f2099edb25b7815a5">__len__</a>(self):
<a name="l00208"></a>00208         <span class="keywordflow">return</span> len(self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>)
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a79c73bde0a5cd521c6ccb57b9f069d9e">00210</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a79c73bde0a5cd521c6ccb57b9f069d9e">lineno</a>(self,n):
<a name="l00211"></a>00211         <span class="keywordflow">return</span> getattr(self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n],<span class="stringliteral">&quot;lineno&quot;</span>,0)
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a61c023548fca65355cd627ddb24e4840">00213</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a61c023548fca65355cd627ddb24e4840">set_lineno</a>(self,n,lineno):
<a name="l00214"></a>00214         self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n].lineno = lineno
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a4190298df704d2c3b092223f58b19ccf">00216</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a4190298df704d2c3b092223f58b19ccf">linespan</a>(self,n):
<a name="l00217"></a>00217         startline = getattr(self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n],<span class="stringliteral">&quot;lineno&quot;</span>,0)
<a name="l00218"></a>00218         endline = getattr(self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n],<span class="stringliteral">&quot;endlineno&quot;</span>,startline)
<a name="l00219"></a>00219         <span class="keywordflow">return</span> startline,endline
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a84c780b18083b164c06bc37ed41fb3eb">00221</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a84c780b18083b164c06bc37ed41fb3eb">lexpos</a>(self,n):
<a name="l00222"></a>00222         <span class="keywordflow">return</span> getattr(self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n],<span class="stringliteral">&quot;lexpos&quot;</span>,0)
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#aa9ae05986ede22a57d26c69da32d915d">00224</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#aa9ae05986ede22a57d26c69da32d915d">lexspan</a>(self,n):
<a name="l00225"></a>00225         startpos = getattr(self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n],<span class="stringliteral">&quot;lexpos&quot;</span>,0)
<a name="l00226"></a>00226         endpos = getattr(self.<a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#a3a7756251d9ea33eb8b65ae8e2a6b99c">slice</a>[n],<span class="stringliteral">&quot;endlexpos&quot;</span>,startpos)
<a name="l00227"></a>00227         <span class="keywordflow">return</span> startpos,endpos
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#ad1bc20441a96dc7be2287911c941d37a">00229</a>     <span class="keyword">def </span><a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html#ad1bc20441a96dc7be2287911c941d37a">error</a>(self):
<a name="l00230"></a>00230        <span class="keywordflow">raise</span> SyntaxError
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l00234"></a>00234 <span class="comment">#                               == LRParser ==</span>
<a name="l00235"></a>00235 <span class="comment">#</span>
<a name="l00236"></a>00236 <span class="comment"># The LR Parsing engine.</span>
<a name="l00237"></a>00237 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l00238"></a>00238 
<a name="l00239"></a><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html">00239</a> <span class="keyword">class </span><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html">LRParser</a>:
<a name="l00240"></a><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#aa2b9d7661ccca32a7f5fa73c25f6506c">00240</a>     <span class="keyword">def </span><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#ad07a7d983a3ca1cd6b65a16fee698058">__init__</a>(self,lrtab,errorf):
<a name="l00241"></a>00241         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#aa2b9d7661ccca32a7f5fa73c25f6506c">productions</a> = lrtab.lr_productions
<a name="l00242"></a>00242         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a61812c4bf807ce15c0cdc830585a212e">action</a>      = lrtab.lr_action
<a name="l00243"></a>00243         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a90508392166473d06a483de637c932d2">goto</a>        = lrtab.lr_goto
<a name="l00244"></a>00244         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a066cb59fe7db4589adf9c8d04bddc822">errorfunc</a>   = errorf
<a name="l00245"></a>00245 
<a name="l00246"></a><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">00246</a>     <span class="keyword">def </span><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#ab9e5060941c2f85b54e23ad8ff936b5c">errok</a>(self):
<a name="l00247"></a>00247         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a>     = 1
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a18aba3dc442455043c2627c74dd793f5">00249</a>     <span class="keyword">def </span><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a18aba3dc442455043c2627c74dd793f5">restart</a>(self):
<a name="l00250"></a>00250         del self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a89f06e59a8ed07bbfa71d19061d88c5c">statestack</a>[:]
<a name="l00251"></a>00251         del self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a21b9cef8dd3185c2499bd9d223a0183f">symstack</a>[:]
<a name="l00252"></a>00252         sym = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00253"></a>00253         sym.type = <span class="stringliteral">&#39;$end&#39;</span>
<a name="l00254"></a>00254         self.symstack.append(sym)
<a name="l00255"></a>00255         self.statestack.append(0)
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a55e0f3ae422cec676d469c285a88191e">00257</a>     <span class="keyword">def </span><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a55e0f3ae422cec676d469c285a88191e">parse</a>(self,input=None,lexer=None,debug=0,tracking=0,tokenfunc=None):
<a name="l00258"></a>00258         <span class="keywordflow">if</span> debug <span class="keywordflow">or</span> yaccdevel:
<a name="l00259"></a>00259             <span class="keywordflow">if</span> isinstance(debug,int):
<a name="l00260"></a>00260                 debug = <a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html">PlyLogger</a>(sys.stderr)
<a name="l00261"></a>00261             <span class="keywordflow">return</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a0ca9028badbeb165d086e0a274dee75b">parsedebug</a>(input,lexer,debug,tracking,tokenfunc)
<a name="l00262"></a>00262         <span class="keywordflow">elif</span> tracking:
<a name="l00263"></a>00263             <span class="keywordflow">return</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a266bb47611f5cc4a02f59211da034589">parseopt</a>(input,lexer,debug,tracking,tokenfunc)
<a name="l00264"></a>00264         <span class="keywordflow">else</span>:
<a name="l00265"></a>00265             <span class="keywordflow">return</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a22489ab04621fda488cebd298d1c6ffd">parseopt_notrack</a>(input,lexer,debug,tracking,tokenfunc)
<a name="l00266"></a>00266         
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00269"></a>00269     <span class="comment"># parsedebug().</span>
<a name="l00270"></a>00270     <span class="comment">#</span>
<a name="l00271"></a>00271     <span class="comment"># This is the debugging enabled version of parse().  All changes made to the</span>
<a name="l00272"></a>00272     <span class="comment"># parsing engine should be made here.   For the non-debugging version,</span>
<a name="l00273"></a>00273     <span class="comment"># copy this code to a method parseopt() and delete all of the sections</span>
<a name="l00274"></a>00274     <span class="comment"># enclosed in:</span>
<a name="l00275"></a>00275     <span class="comment">#</span>
<a name="l00276"></a>00276     <span class="comment">#      #--! DEBUG</span>
<a name="l00277"></a>00277     <span class="comment">#      statements</span>
<a name="l00278"></a>00278     <span class="comment">#      #--! DEBUG</span>
<a name="l00279"></a>00279     <span class="comment">#</span>
<a name="l00280"></a>00280     <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a21b9cef8dd3185c2499bd9d223a0183f">00282</a>     <span class="keyword">def </span><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a0ca9028badbeb165d086e0a274dee75b">parsedebug</a>(self,input=None,lexer=None,debug=None,tracking=0,tokenfunc=None):
<a name="l00283"></a>00283         lookahead = <span class="keywordtype">None</span>                 <span class="comment"># Current lookahead symbol</span>
<a name="l00284"></a>00284         lookaheadstack = [ ]             <span class="comment"># Stack of lookahead symbols</span>
<a name="l00285"></a>00285         actions = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a61812c4bf807ce15c0cdc830585a212e">action</a>            <span class="comment"># Local reference to action table (to avoid lookup on self.)</span>
<a name="l00286"></a>00286         goto    = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a90508392166473d06a483de637c932d2">goto</a>              <span class="comment"># Local reference to goto table (to avoid lookup on self.)</span>
<a name="l00287"></a>00287         prod    = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#aa2b9d7661ccca32a7f5fa73c25f6506c">productions</a>       <span class="comment"># Local reference to production list (to avoid lookup on self.)</span>
<a name="l00288"></a>00288         pslice  = <a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html">YaccProduction</a>(<span class="keywordtype">None</span>)   <span class="comment"># Production object passed to grammar rules</span>
<a name="l00289"></a>00289         errorcount = 0                   <span class="comment"># Used during error recovery </span>
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <span class="comment"># --! DEBUG</span>
<a name="l00292"></a>00292         debug.info(<span class="stringliteral">&quot;PLY: PARSE DEBUG START&quot;</span>)
<a name="l00293"></a>00293         <span class="comment"># --! DEBUG</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="comment"># If no lexer was given, we will try to use the lex module</span>
<a name="l00296"></a>00296         <span class="keywordflow">if</span> <span class="keywordflow">not</span> lexer:
<a name="l00297"></a>00297             lex = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#acb247fbbf4ace4412a91df37b83596a8">load_ply_lex</a>()
<a name="l00298"></a>00298             lexer = lex.lexer
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         <span class="comment"># Set up the lexer and parser objects on pslice</span>
<a name="l00301"></a>00301         pslice.lexer = lexer
<a name="l00302"></a>00302         pslice.parser = self
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="comment"># If input was supplied, pass to lexer</span>
<a name="l00305"></a>00305         <span class="keywordflow">if</span> input <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00306"></a>00306             lexer.input(input)
<a name="l00307"></a>00307 
<a name="l00308"></a>00308         <span class="keywordflow">if</span> tokenfunc <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00309"></a>00309            <span class="comment"># Tokenize function</span>
<a name="l00310"></a>00310            get_token = lexer.token
<a name="l00311"></a>00311         <span class="keywordflow">else</span>:
<a name="l00312"></a>00312            get_token = tokenfunc
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="comment"># Set up the state and symbol stacks</span>
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         statestack = [ ]                <span class="comment"># Stack of parsing states</span>
<a name="l00317"></a>00317         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a89f06e59a8ed07bbfa71d19061d88c5c">statestack</a> = statestack
<a name="l00318"></a>00318         symstack   = [ ]                <span class="comment"># Stack of grammar symbols</span>
<a name="l00319"></a>00319         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a21b9cef8dd3185c2499bd9d223a0183f">symstack</a> = symstack
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         pslice.stack = symstack         <span class="comment"># Put in the production</span>
<a name="l00322"></a>00322         errtoken   = <span class="keywordtype">None</span>               <span class="comment"># Err token</span>
<a name="l00323"></a>00323 
<a name="l00324"></a>00324         <span class="comment"># The start state is assumed to be (0,$end)</span>
<a name="l00325"></a>00325 
<a name="l00326"></a>00326         statestack.append(0)
<a name="l00327"></a>00327         sym = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00328"></a>00328         sym.type = <span class="stringliteral">&quot;$end&quot;</span>
<a name="l00329"></a>00329         symstack.append(sym)
<a name="l00330"></a>00330         state = 0
<a name="l00331"></a>00331         <span class="keywordflow">while</span> 1:
<a name="l00332"></a>00332             <span class="comment"># Get the next symbol on the input.  If a lookahead symbol</span>
<a name="l00333"></a>00333             <span class="comment"># is already set, we just use that. Otherwise, we&#39;ll pull</span>
<a name="l00334"></a>00334             <span class="comment"># the next token off of the lookaheadstack or from the lexer</span>
<a name="l00335"></a>00335 
<a name="l00336"></a>00336             <span class="comment"># --! DEBUG</span>
<a name="l00337"></a>00337             debug.debug(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00338"></a>00338             debug.debug(<span class="stringliteral">&#39;State  : %s&#39;</span>, state)
<a name="l00339"></a>00339             <span class="comment"># --! DEBUG</span>
<a name="l00340"></a>00340 
<a name="l00341"></a>00341             <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookahead:
<a name="l00342"></a>00342                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookaheadstack:
<a name="l00343"></a>00343                     lookahead = get_token()     <span class="comment"># Get the next token</span>
<a name="l00344"></a>00344                 <span class="keywordflow">else</span>:
<a name="l00345"></a>00345                     lookahead = lookaheadstack.pop()
<a name="l00346"></a>00346                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookahead:
<a name="l00347"></a>00347                     lookahead = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00348"></a>00348                     lookahead.type = <span class="stringliteral">&quot;$end&quot;</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350             <span class="comment"># --! DEBUG</span>
<a name="l00351"></a>00351             debug.debug(<span class="stringliteral">&#39;Stack  : %s&#39;</span>,
<a name="l00352"></a>00352                         (<span class="stringliteral">&quot;%s . %s&quot;</span> % (<span class="stringliteral">&quot; &quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>([xx.type <span class="keywordflow">for</span> xx <span class="keywordflow">in</span> symstack][1:]), <a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(lookahead))).lstrip())
<a name="l00353"></a>00353             <span class="comment"># --! DEBUG</span>
<a name="l00354"></a>00354 
<a name="l00355"></a>00355             <span class="comment"># Check the action table</span>
<a name="l00356"></a>00356             ltype = lookahead.type
<a name="l00357"></a>00357             t = actions[state].<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>(ltype)
<a name="l00358"></a>00358 
<a name="l00359"></a>00359             <span class="keywordflow">if</span> t <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00360"></a>00360                 <span class="keywordflow">if</span> t &gt; 0:
<a name="l00361"></a>00361                     <span class="comment"># shift a symbol on the stack</span>
<a name="l00362"></a>00362                     statestack.append(t)
<a name="l00363"></a>00363                     state = t
<a name="l00364"></a>00364                     
<a name="l00365"></a>00365                     <span class="comment"># --! DEBUG</span>
<a name="l00366"></a>00366                     debug.debug(<span class="stringliteral">&quot;Action : Shift and goto state %s&quot;</span>, t)
<a name="l00367"></a>00367                     <span class="comment"># --! DEBUG</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369                     symstack.append(lookahead)
<a name="l00370"></a>00370                     lookahead = <span class="keywordtype">None</span>
<a name="l00371"></a>00371 
<a name="l00372"></a>00372                     <span class="comment"># Decrease error count on successful shift</span>
<a name="l00373"></a>00373                     <span class="keywordflow">if</span> errorcount: errorcount -=1
<a name="l00374"></a>00374                     <span class="keywordflow">continue</span>
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                 <span class="keywordflow">if</span> t &lt; 0:
<a name="l00377"></a>00377                     <span class="comment"># reduce a symbol on the stack, emit a production</span>
<a name="l00378"></a>00378                     p = prod[-t]
<a name="l00379"></a>00379                     pname = p.name
<a name="l00380"></a>00380                     plen  = p.len
<a name="l00381"></a>00381 
<a name="l00382"></a>00382                     <span class="comment"># Get production function</span>
<a name="l00383"></a>00383                     sym = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00384"></a>00384                     sym.type = pname       <span class="comment"># Production name</span>
<a name="l00385"></a>00385                     sym.value = <span class="keywordtype">None</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387                     <span class="comment"># --! DEBUG</span>
<a name="l00388"></a>00388                     <span class="keywordflow">if</span> plen:
<a name="l00389"></a>00389                         debug.info(<span class="stringliteral">&quot;Action : Reduce rule [%s] with %s and goto state %d&quot;</span>, p.str, <span class="stringliteral">&quot;[&quot;</span>+<span class="stringliteral">&quot;,&quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>([<a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#aac0da43c76a890dc4a423db18b24d443">format_stack_entry</a>(_v.value) <span class="keywordflow">for</span> _v <span class="keywordflow">in</span> symstack[-plen:]])+<span class="stringliteral">&quot;]&quot;</span>,-t)
<a name="l00390"></a>00390                     <span class="keywordflow">else</span>:
<a name="l00391"></a>00391                         debug.info(<span class="stringliteral">&quot;Action : Reduce rule [%s] with %s and goto state %d&quot;</span>, p.str, [],-t)
<a name="l00392"></a>00392                         
<a name="l00393"></a>00393                     <span class="comment"># --! DEBUG</span>
<a name="l00394"></a>00394 
<a name="l00395"></a>00395                     <span class="keywordflow">if</span> plen:
<a name="l00396"></a>00396                         targ = symstack[-plen-1:]
<a name="l00397"></a>00397                         targ[0] = sym
<a name="l00398"></a>00398 
<a name="l00399"></a>00399                         <span class="comment"># --! TRACKING</span>
<a name="l00400"></a>00400                         <span class="keywordflow">if</span> tracking:
<a name="l00401"></a>00401                            t1 = targ[1]
<a name="l00402"></a>00402                            sym.lineno = t1.lineno
<a name="l00403"></a>00403                            sym.lexpos = t1.lexpos
<a name="l00404"></a>00404                            t1 = targ[-1]
<a name="l00405"></a>00405                            sym.endlineno = getattr(t1,<span class="stringliteral">&quot;endlineno&quot;</span>,t1.lineno)
<a name="l00406"></a>00406                            sym.endlexpos = getattr(t1,<span class="stringliteral">&quot;endlexpos&quot;</span>,t1.lexpos)
<a name="l00407"></a>00407 
<a name="l00408"></a>00408                         <span class="comment"># --! TRACKING</span>
<a name="l00409"></a>00409 
<a name="l00410"></a>00410                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00411"></a>00411                         <span class="comment"># The code enclosed in this section is duplicated </span>
<a name="l00412"></a>00412                         <span class="comment"># below as a performance optimization.  Make sure</span>
<a name="l00413"></a>00413                         <span class="comment"># changes get made in both locations.</span>
<a name="l00414"></a>00414 
<a name="l00415"></a>00415                         pslice.slice = targ
<a name="l00416"></a>00416                         
<a name="l00417"></a>00417                         <span class="keywordflow">try</span>:
<a name="l00418"></a>00418                             <span class="comment"># Call the grammar rule with our special slice object</span>
<a name="l00419"></a>00419                             del symstack[-plen:]
<a name="l00420"></a>00420                             del statestack[-plen:]
<a name="l00421"></a>00421                             p.callable(pslice)
<a name="l00422"></a>00422                             <span class="comment"># --! DEBUG</span>
<a name="l00423"></a>00423                             debug.info(<span class="stringliteral">&quot;Result : %s&quot;</span>, <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a0ca9513bd4b7a488845448e2f274aee4">format_result</a>(pslice[0]))
<a name="l00424"></a>00424                             <span class="comment"># --! DEBUG</span>
<a name="l00425"></a>00425                             symstack.append(sym)
<a name="l00426"></a>00426                             state = goto[statestack[-1]][pname]
<a name="l00427"></a>00427                             statestack.append(state)
<a name="l00428"></a>00428                         <span class="keywordflow">except</span> SyntaxError:
<a name="l00429"></a>00429                             <span class="comment"># If an error was set. Enter error recovery state</span>
<a name="l00430"></a>00430                             lookaheadstack.append(lookahead)
<a name="l00431"></a>00431                             symstack.pop()
<a name="l00432"></a>00432                             statestack.pop()
<a name="l00433"></a>00433                             state = statestack[-1]
<a name="l00434"></a>00434                             sym.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l00435"></a>00435                             lookahead = sym
<a name="l00436"></a>00436                             errorcount = error_count
<a name="l00437"></a>00437                             self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l00438"></a>00438                         <span class="keywordflow">continue</span>
<a name="l00439"></a>00439                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00440"></a>00440     
<a name="l00441"></a>00441                     <span class="keywordflow">else</span>:
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                         <span class="comment"># --! TRACKING</span>
<a name="l00444"></a>00444                         <span class="keywordflow">if</span> tracking:
<a name="l00445"></a>00445                            sym.lineno = lexer.lineno
<a name="l00446"></a>00446                            sym.lexpos = lexer.lexpos
<a name="l00447"></a>00447                         <span class="comment"># --! TRACKING</span>
<a name="l00448"></a>00448 
<a name="l00449"></a>00449                         targ = [ sym ]
<a name="l00450"></a>00450 
<a name="l00451"></a>00451                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00452"></a>00452                         <span class="comment"># The code enclosed in this section is duplicated </span>
<a name="l00453"></a>00453                         <span class="comment"># above as a performance optimization.  Make sure</span>
<a name="l00454"></a>00454                         <span class="comment"># changes get made in both locations.</span>
<a name="l00455"></a>00455 
<a name="l00456"></a>00456                         pslice.slice = targ
<a name="l00457"></a>00457 
<a name="l00458"></a>00458                         <span class="keywordflow">try</span>:
<a name="l00459"></a>00459                             <span class="comment"># Call the grammar rule with our special slice object</span>
<a name="l00460"></a>00460                             p.callable(pslice)
<a name="l00461"></a>00461                             <span class="comment"># --! DEBUG</span>
<a name="l00462"></a>00462                             debug.info(<span class="stringliteral">&quot;Result : %s&quot;</span>, <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a0ca9513bd4b7a488845448e2f274aee4">format_result</a>(pslice[0]))
<a name="l00463"></a>00463                             <span class="comment"># --! DEBUG</span>
<a name="l00464"></a>00464                             symstack.append(sym)
<a name="l00465"></a>00465                             state = goto[statestack[-1]][pname]
<a name="l00466"></a>00466                             statestack.append(state)
<a name="l00467"></a>00467                         <span class="keywordflow">except</span> SyntaxError:
<a name="l00468"></a>00468                             <span class="comment"># If an error was set. Enter error recovery state</span>
<a name="l00469"></a>00469                             lookaheadstack.append(lookahead)
<a name="l00470"></a>00470                             symstack.pop()
<a name="l00471"></a>00471                             statestack.pop()
<a name="l00472"></a>00472                             state = statestack[-1]
<a name="l00473"></a>00473                             sym.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l00474"></a>00474                             lookahead = sym
<a name="l00475"></a>00475                             errorcount = error_count
<a name="l00476"></a>00476                             self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l00477"></a>00477                         <span class="keywordflow">continue</span>
<a name="l00478"></a>00478                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00479"></a>00479 
<a name="l00480"></a>00480                 <span class="keywordflow">if</span> t == 0:
<a name="l00481"></a>00481                     n = symstack[-1]
<a name="l00482"></a>00482                     result = getattr(n,<span class="stringliteral">&quot;value&quot;</span>,<span class="keywordtype">None</span>)
<a name="l00483"></a>00483                     <span class="comment"># --! DEBUG</span>
<a name="l00484"></a>00484                     debug.info(<span class="stringliteral">&quot;Done   : Returning %s&quot;</span>, <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a0ca9513bd4b7a488845448e2f274aee4">format_result</a>(result))
<a name="l00485"></a>00485                     debug.info(<span class="stringliteral">&quot;PLY: PARSE DEBUG END&quot;</span>)
<a name="l00486"></a>00486                     <span class="comment"># --! DEBUG</span>
<a name="l00487"></a>00487                     <span class="keywordflow">return</span> result
<a name="l00488"></a>00488 
<a name="l00489"></a>00489             <span class="keywordflow">if</span> t == <span class="keywordtype">None</span>:
<a name="l00490"></a>00490 
<a name="l00491"></a>00491                 <span class="comment"># --! DEBUG</span>
<a name="l00492"></a>00492                 debug.error(<span class="stringliteral">&#39;Error  : %s&#39;</span>,
<a name="l00493"></a>00493                             (<span class="stringliteral">&quot;%s . %s&quot;</span> % (<span class="stringliteral">&quot; &quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>([xx.type <span class="keywordflow">for</span> xx <span class="keywordflow">in</span> symstack][1:]), <a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(lookahead))).lstrip())
<a name="l00494"></a>00494                 <span class="comment"># --! DEBUG</span>
<a name="l00495"></a>00495 
<a name="l00496"></a>00496                 <span class="comment"># We have some kind of parsing error here.  To handle</span>
<a name="l00497"></a>00497                 <span class="comment"># this, we are going to push the current token onto</span>
<a name="l00498"></a>00498                 <span class="comment"># the tokenstack and replace it with an &#39;error&#39; token.</span>
<a name="l00499"></a>00499                 <span class="comment"># If there are any synchronization rules, they may</span>
<a name="l00500"></a>00500                 <span class="comment"># catch it.</span>
<a name="l00501"></a>00501                 <span class="comment">#</span>
<a name="l00502"></a>00502                 <span class="comment"># In addition to pushing the error token, we call call</span>
<a name="l00503"></a>00503                 <span class="comment"># the user defined p_error() function if this is the</span>
<a name="l00504"></a>00504                 <span class="comment"># first syntax error.  This function is only called if</span>
<a name="l00505"></a>00505                 <span class="comment"># errorcount == 0.</span>
<a name="l00506"></a>00506                 <span class="keywordflow">if</span> errorcount == 0 <span class="keywordflow">or</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a>:
<a name="l00507"></a>00507                     errorcount = error_count
<a name="l00508"></a>00508                     self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l00509"></a>00509                     errtoken = lookahead
<a name="l00510"></a>00510                     <span class="keywordflow">if</span> errtoken.type == <span class="stringliteral">&quot;$end&quot;</span>:
<a name="l00511"></a>00511                         errtoken = <span class="keywordtype">None</span>               <span class="comment"># End of file!</span>
<a name="l00512"></a>00512                     <span class="keywordflow">if</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a066cb59fe7db4589adf9c8d04bddc822">errorfunc</a>:
<a name="l00513"></a>00513                         <span class="keyword">global</span> errok,token,restart
<a name="l00514"></a>00514                         errok = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#ab9e5060941c2f85b54e23ad8ff936b5c">errok</a>        <span class="comment"># Set some special functions available in error recovery</span>
<a name="l00515"></a>00515                         token = get_token
<a name="l00516"></a>00516                         restart = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a18aba3dc442455043c2627c74dd793f5">restart</a>
<a name="l00517"></a>00517                         <span class="keywordflow">if</span> errtoken <span class="keywordflow">and</span> <span class="keywordflow">not</span> hasattr(errtoken,<span class="stringliteral">&#39;lexer&#39;</span>):
<a name="l00518"></a>00518                             errtoken.lexer = lexer
<a name="l00519"></a>00519                         tok = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a066cb59fe7db4589adf9c8d04bddc822">errorfunc</a>(errtoken)
<a name="l00520"></a>00520                         del errok, token, restart   <span class="comment"># Delete special functions</span>
<a name="l00521"></a>00521 
<a name="l00522"></a>00522                         <span class="keywordflow">if</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a>:
<a name="l00523"></a>00523                             <span class="comment"># User must have done some kind of panic</span>
<a name="l00524"></a>00524                             <span class="comment"># mode recovery on their own.  The</span>
<a name="l00525"></a>00525                             <span class="comment"># returned token is the next lookahead</span>
<a name="l00526"></a>00526                             lookahead = tok
<a name="l00527"></a>00527                             errtoken = <span class="keywordtype">None</span>
<a name="l00528"></a>00528                             <span class="keywordflow">continue</span>
<a name="l00529"></a>00529                     <span class="keywordflow">else</span>:
<a name="l00530"></a>00530                         <span class="keywordflow">if</span> errtoken:
<a name="l00531"></a>00531                             <span class="keywordflow">if</span> hasattr(errtoken,<span class="stringliteral">&quot;lineno&quot;</span>): lineno = lookahead.lineno
<a name="l00532"></a>00532                             <span class="keywordflow">else</span>: lineno = 0
<a name="l00533"></a>00533                             <span class="keywordflow">if</span> lineno:
<a name="l00534"></a>00534                                 sys.stderr.write(<span class="stringliteral">&quot;yacc: Syntax error at line %d, token=%s\n&quot;</span> % (lineno, errtoken.type))
<a name="l00535"></a>00535                             <span class="keywordflow">else</span>:
<a name="l00536"></a>00536                                 sys.stderr.write(<span class="stringliteral">&quot;yacc: Syntax error, token=%s&quot;</span> % errtoken.type)
<a name="l00537"></a>00537                         <span class="keywordflow">else</span>:
<a name="l00538"></a>00538                             sys.stderr.write(<span class="stringliteral">&quot;yacc: Parse error in input. EOF\n&quot;</span>)
<a name="l00539"></a>00539                             <span class="keywordflow">return</span>
<a name="l00540"></a>00540 
<a name="l00541"></a>00541                 <span class="keywordflow">else</span>:
<a name="l00542"></a>00542                     errorcount = error_count
<a name="l00543"></a>00543 
<a name="l00544"></a>00544                 <span class="comment"># case 1:  the statestack only has 1 entry on it.  If we&#39;re in this state, the</span>
<a name="l00545"></a>00545                 <span class="comment"># entire parse has been rolled back and we&#39;re completely hosed.   The token is</span>
<a name="l00546"></a>00546                 <span class="comment"># discarded and we just keep going.</span>
<a name="l00547"></a>00547 
<a name="l00548"></a>00548                 <span class="keywordflow">if</span> len(statestack) &lt;= 1 <span class="keywordflow">and</span> lookahead.type != <span class="stringliteral">&quot;$end&quot;</span>:
<a name="l00549"></a>00549                     lookahead = <span class="keywordtype">None</span>
<a name="l00550"></a>00550                     errtoken = <span class="keywordtype">None</span>
<a name="l00551"></a>00551                     state = 0
<a name="l00552"></a>00552                     <span class="comment"># Nuke the pushback stack</span>
<a name="l00553"></a>00553                     del lookaheadstack[:]
<a name="l00554"></a>00554                     <span class="keywordflow">continue</span>
<a name="l00555"></a>00555 
<a name="l00556"></a>00556                 <span class="comment"># case 2: the statestack has a couple of entries on it, but we&#39;re</span>
<a name="l00557"></a>00557                 <span class="comment"># at the end of the file. nuke the top entry and generate an error token</span>
<a name="l00558"></a>00558 
<a name="l00559"></a>00559                 <span class="comment"># Start nuking entries on the stack</span>
<a name="l00560"></a>00560                 <span class="keywordflow">if</span> lookahead.type == <span class="stringliteral">&quot;$end&quot;</span>:
<a name="l00561"></a>00561                     <span class="comment"># Whoa. We&#39;re really hosed here. Bail out</span>
<a name="l00562"></a>00562                     <span class="keywordflow">return</span>
<a name="l00563"></a>00563 
<a name="l00564"></a>00564                 <span class="keywordflow">if</span> lookahead.type != <span class="stringliteral">&#39;error&#39;</span>:
<a name="l00565"></a>00565                     sym = symstack[-1]
<a name="l00566"></a>00566                     <span class="keywordflow">if</span> sym.type == <span class="stringliteral">&#39;error&#39;</span>:
<a name="l00567"></a>00567                         <span class="comment"># Hmmm. Error is on top of stack, we&#39;ll just nuke input</span>
<a name="l00568"></a>00568                         <span class="comment"># symbol and continue</span>
<a name="l00569"></a>00569                         lookahead = <span class="keywordtype">None</span>
<a name="l00570"></a>00570                         <span class="keywordflow">continue</span>
<a name="l00571"></a>00571                     t = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00572"></a>00572                     t.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l00573"></a>00573                     <span class="keywordflow">if</span> hasattr(lookahead,<span class="stringliteral">&quot;lineno&quot;</span>):
<a name="l00574"></a>00574                         t.lineno = lookahead.lineno
<a name="l00575"></a>00575                     t.value = lookahead
<a name="l00576"></a>00576                     lookaheadstack.append(lookahead)
<a name="l00577"></a>00577                     lookahead = t
<a name="l00578"></a>00578                 <span class="keywordflow">else</span>:
<a name="l00579"></a>00579                     symstack.pop()
<a name="l00580"></a>00580                     statestack.pop()
<a name="l00581"></a>00581                     state = statestack[-1]       <span class="comment"># Potential bug fix</span>
<a name="l00582"></a>00582 
<a name="l00583"></a>00583                 <span class="keywordflow">continue</span>
<a name="l00584"></a>00584 
<a name="l00585"></a>00585             <span class="comment"># Call an error function here</span>
<a name="l00586"></a>00586             <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&quot;yacc: internal parser error!!!\n&quot;</span>)
<a name="l00587"></a>00587 
<a name="l00588"></a>00588     <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00589"></a>00589     <span class="comment"># parseopt().</span>
<a name="l00590"></a>00590     <span class="comment">#</span>
<a name="l00591"></a>00591     <span class="comment"># Optimized version of parse() method.  DO NOT EDIT THIS CODE DIRECTLY.</span>
<a name="l00592"></a>00592     <span class="comment"># Edit the debug version above, then copy any modifications to the method</span>
<a name="l00593"></a>00593     <span class="comment"># below while removing #--! DEBUG sections.</span>
<a name="l00594"></a>00594     <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 
<a name="l00597"></a><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a266bb47611f5cc4a02f59211da034589">00597</a>     <span class="keyword">def </span><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a266bb47611f5cc4a02f59211da034589">parseopt</a>(self,input=None,lexer=None,debug=0,tracking=0,tokenfunc=None):
<a name="l00598"></a>00598         lookahead = <span class="keywordtype">None</span>                 <span class="comment"># Current lookahead symbol</span>
<a name="l00599"></a>00599         lookaheadstack = [ ]             <span class="comment"># Stack of lookahead symbols</span>
<a name="l00600"></a>00600         actions = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a61812c4bf807ce15c0cdc830585a212e">action</a>            <span class="comment"># Local reference to action table (to avoid lookup on self.)</span>
<a name="l00601"></a>00601         goto    = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a90508392166473d06a483de637c932d2">goto</a>              <span class="comment"># Local reference to goto table (to avoid lookup on self.)</span>
<a name="l00602"></a>00602         prod    = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#aa2b9d7661ccca32a7f5fa73c25f6506c">productions</a>       <span class="comment"># Local reference to production list (to avoid lookup on self.)</span>
<a name="l00603"></a>00603         pslice  = <a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html">YaccProduction</a>(<span class="keywordtype">None</span>)   <span class="comment"># Production object passed to grammar rules</span>
<a name="l00604"></a>00604         errorcount = 0                   <span class="comment"># Used during error recovery </span>
<a name="l00605"></a>00605 
<a name="l00606"></a>00606         <span class="comment"># If no lexer was given, we will try to use the lex module</span>
<a name="l00607"></a>00607         <span class="keywordflow">if</span> <span class="keywordflow">not</span> lexer:
<a name="l00608"></a>00608             lex = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#acb247fbbf4ace4412a91df37b83596a8">load_ply_lex</a>()
<a name="l00609"></a>00609             lexer = lex.lexer
<a name="l00610"></a>00610         
<a name="l00611"></a>00611         <span class="comment"># Set up the lexer and parser objects on pslice</span>
<a name="l00612"></a>00612         pslice.lexer = lexer
<a name="l00613"></a>00613         pslice.parser = self
<a name="l00614"></a>00614 
<a name="l00615"></a>00615         <span class="comment"># If input was supplied, pass to lexer</span>
<a name="l00616"></a>00616         <span class="keywordflow">if</span> input <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00617"></a>00617             lexer.input(input)
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         <span class="keywordflow">if</span> tokenfunc <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00620"></a>00620            <span class="comment"># Tokenize function</span>
<a name="l00621"></a>00621            get_token = lexer.token
<a name="l00622"></a>00622         <span class="keywordflow">else</span>:
<a name="l00623"></a>00623            get_token = tokenfunc
<a name="l00624"></a>00624 
<a name="l00625"></a>00625         <span class="comment"># Set up the state and symbol stacks</span>
<a name="l00626"></a>00626 
<a name="l00627"></a>00627         statestack = [ ]                <span class="comment"># Stack of parsing states</span>
<a name="l00628"></a>00628         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a89f06e59a8ed07bbfa71d19061d88c5c">statestack</a> = statestack
<a name="l00629"></a>00629         symstack   = [ ]                <span class="comment"># Stack of grammar symbols</span>
<a name="l00630"></a>00630         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a21b9cef8dd3185c2499bd9d223a0183f">symstack</a> = symstack
<a name="l00631"></a>00631 
<a name="l00632"></a>00632         pslice.stack = symstack         <span class="comment"># Put in the production</span>
<a name="l00633"></a>00633         errtoken   = <span class="keywordtype">None</span>               <span class="comment"># Err token</span>
<a name="l00634"></a>00634 
<a name="l00635"></a>00635         <span class="comment"># The start state is assumed to be (0,$end)</span>
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         statestack.append(0)
<a name="l00638"></a>00638         sym = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00639"></a>00639         sym.type = <span class="stringliteral">&#39;$end&#39;</span>
<a name="l00640"></a>00640         symstack.append(sym)
<a name="l00641"></a>00641         state = 0
<a name="l00642"></a>00642         <span class="keywordflow">while</span> 1:
<a name="l00643"></a>00643             <span class="comment"># Get the next symbol on the input.  If a lookahead symbol</span>
<a name="l00644"></a>00644             <span class="comment"># is already set, we just use that. Otherwise, we&#39;ll pull</span>
<a name="l00645"></a>00645             <span class="comment"># the next token off of the lookaheadstack or from the lexer</span>
<a name="l00646"></a>00646 
<a name="l00647"></a>00647             <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookahead:
<a name="l00648"></a>00648                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookaheadstack:
<a name="l00649"></a>00649                     lookahead = get_token()     <span class="comment"># Get the next token</span>
<a name="l00650"></a>00650                 <span class="keywordflow">else</span>:
<a name="l00651"></a>00651                     lookahead = lookaheadstack.pop()
<a name="l00652"></a>00652                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookahead:
<a name="l00653"></a>00653                     lookahead = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00654"></a>00654                     lookahead.type = <span class="stringliteral">&#39;$end&#39;</span>
<a name="l00655"></a>00655 
<a name="l00656"></a>00656             <span class="comment"># Check the action table</span>
<a name="l00657"></a>00657             ltype = lookahead.type
<a name="l00658"></a>00658             t = actions[state].<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>(ltype)
<a name="l00659"></a>00659 
<a name="l00660"></a>00660             <span class="keywordflow">if</span> t <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00661"></a>00661                 <span class="keywordflow">if</span> t &gt; 0:
<a name="l00662"></a>00662                     <span class="comment"># shift a symbol on the stack</span>
<a name="l00663"></a>00663                     statestack.append(t)
<a name="l00664"></a>00664                     state = t
<a name="l00665"></a>00665 
<a name="l00666"></a>00666                     symstack.append(lookahead)
<a name="l00667"></a>00667                     lookahead = <span class="keywordtype">None</span>
<a name="l00668"></a>00668 
<a name="l00669"></a>00669                     <span class="comment"># Decrease error count on successful shift</span>
<a name="l00670"></a>00670                     <span class="keywordflow">if</span> errorcount: errorcount -=1
<a name="l00671"></a>00671                     <span class="keywordflow">continue</span>
<a name="l00672"></a>00672 
<a name="l00673"></a>00673                 <span class="keywordflow">if</span> t &lt; 0:
<a name="l00674"></a>00674                     <span class="comment"># reduce a symbol on the stack, emit a production</span>
<a name="l00675"></a>00675                     p = prod[-t]
<a name="l00676"></a>00676                     pname = p.name
<a name="l00677"></a>00677                     plen  = p.len
<a name="l00678"></a>00678 
<a name="l00679"></a>00679                     <span class="comment"># Get production function</span>
<a name="l00680"></a>00680                     sym = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00681"></a>00681                     sym.type = pname       <span class="comment"># Production name</span>
<a name="l00682"></a>00682                     sym.value = <span class="keywordtype">None</span>
<a name="l00683"></a>00683 
<a name="l00684"></a>00684                     <span class="keywordflow">if</span> plen:
<a name="l00685"></a>00685                         targ = symstack[-plen-1:]
<a name="l00686"></a>00686                         targ[0] = sym
<a name="l00687"></a>00687 
<a name="l00688"></a>00688                         <span class="comment"># --! TRACKING</span>
<a name="l00689"></a>00689                         <span class="keywordflow">if</span> tracking:
<a name="l00690"></a>00690                            t1 = targ[1]
<a name="l00691"></a>00691                            sym.lineno = t1.lineno
<a name="l00692"></a>00692                            sym.lexpos = t1.lexpos
<a name="l00693"></a>00693                            t1 = targ[-1]
<a name="l00694"></a>00694                            sym.endlineno = getattr(t1,<span class="stringliteral">&quot;endlineno&quot;</span>,t1.lineno)
<a name="l00695"></a>00695                            sym.endlexpos = getattr(t1,<span class="stringliteral">&quot;endlexpos&quot;</span>,t1.lexpos)
<a name="l00696"></a>00696 
<a name="l00697"></a>00697                         <span class="comment"># --! TRACKING</span>
<a name="l00698"></a>00698 
<a name="l00699"></a>00699                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00700"></a>00700                         <span class="comment"># The code enclosed in this section is duplicated </span>
<a name="l00701"></a>00701                         <span class="comment"># below as a performance optimization.  Make sure</span>
<a name="l00702"></a>00702                         <span class="comment"># changes get made in both locations.</span>
<a name="l00703"></a>00703 
<a name="l00704"></a>00704                         pslice.slice = targ
<a name="l00705"></a>00705                         
<a name="l00706"></a>00706                         <span class="keywordflow">try</span>:
<a name="l00707"></a>00707                             <span class="comment"># Call the grammar rule with our special slice object</span>
<a name="l00708"></a>00708                             del symstack[-plen:]
<a name="l00709"></a>00709                             del statestack[-plen:]
<a name="l00710"></a>00710                             p.callable(pslice)
<a name="l00711"></a>00711                             symstack.append(sym)
<a name="l00712"></a>00712                             state = goto[statestack[-1]][pname]
<a name="l00713"></a>00713                             statestack.append(state)
<a name="l00714"></a>00714                         <span class="keywordflow">except</span> SyntaxError:
<a name="l00715"></a>00715                             <span class="comment"># If an error was set. Enter error recovery state</span>
<a name="l00716"></a>00716                             lookaheadstack.append(lookahead)
<a name="l00717"></a>00717                             symstack.pop()
<a name="l00718"></a>00718                             statestack.pop()
<a name="l00719"></a>00719                             state = statestack[-1]
<a name="l00720"></a>00720                             sym.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l00721"></a>00721                             lookahead = sym
<a name="l00722"></a>00722                             errorcount = error_count
<a name="l00723"></a>00723                             self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l00724"></a>00724                         <span class="keywordflow">continue</span>
<a name="l00725"></a>00725                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00726"></a>00726     
<a name="l00727"></a>00727                     <span class="keywordflow">else</span>:
<a name="l00728"></a>00728 
<a name="l00729"></a>00729                         <span class="comment"># --! TRACKING</span>
<a name="l00730"></a>00730                         <span class="keywordflow">if</span> tracking:
<a name="l00731"></a>00731                            sym.lineno = lexer.lineno
<a name="l00732"></a>00732                            sym.lexpos = lexer.lexpos
<a name="l00733"></a>00733                         <span class="comment"># --! TRACKING</span>
<a name="l00734"></a>00734 
<a name="l00735"></a>00735                         targ = [ sym ]
<a name="l00736"></a>00736 
<a name="l00737"></a>00737                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00738"></a>00738                         <span class="comment"># The code enclosed in this section is duplicated </span>
<a name="l00739"></a>00739                         <span class="comment"># above as a performance optimization.  Make sure</span>
<a name="l00740"></a>00740                         <span class="comment"># changes get made in both locations.</span>
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                         pslice.slice = targ
<a name="l00743"></a>00743 
<a name="l00744"></a>00744                         <span class="keywordflow">try</span>:
<a name="l00745"></a>00745                             <span class="comment"># Call the grammar rule with our special slice object</span>
<a name="l00746"></a>00746                             p.callable(pslice)
<a name="l00747"></a>00747                             symstack.append(sym)
<a name="l00748"></a>00748                             state = goto[statestack[-1]][pname]
<a name="l00749"></a>00749                             statestack.append(state)
<a name="l00750"></a>00750                         <span class="keywordflow">except</span> SyntaxError:
<a name="l00751"></a>00751                             <span class="comment"># If an error was set. Enter error recovery state</span>
<a name="l00752"></a>00752                             lookaheadstack.append(lookahead)
<a name="l00753"></a>00753                             symstack.pop()
<a name="l00754"></a>00754                             statestack.pop()
<a name="l00755"></a>00755                             state = statestack[-1]
<a name="l00756"></a>00756                             sym.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l00757"></a>00757                             lookahead = sym
<a name="l00758"></a>00758                             errorcount = error_count
<a name="l00759"></a>00759                             self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l00760"></a>00760                         <span class="keywordflow">continue</span>
<a name="l00761"></a>00761                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00762"></a>00762 
<a name="l00763"></a>00763                 <span class="keywordflow">if</span> t == 0:
<a name="l00764"></a>00764                     n = symstack[-1]
<a name="l00765"></a>00765                     <span class="keywordflow">return</span> getattr(n,<span class="stringliteral">&quot;value&quot;</span>,<span class="keywordtype">None</span>)
<a name="l00766"></a>00766 
<a name="l00767"></a>00767             <span class="keywordflow">if</span> t == <span class="keywordtype">None</span>:
<a name="l00768"></a>00768 
<a name="l00769"></a>00769                 <span class="comment"># We have some kind of parsing error here.  To handle</span>
<a name="l00770"></a>00770                 <span class="comment"># this, we are going to push the current token onto</span>
<a name="l00771"></a>00771                 <span class="comment"># the tokenstack and replace it with an &#39;error&#39; token.</span>
<a name="l00772"></a>00772                 <span class="comment"># If there are any synchronization rules, they may</span>
<a name="l00773"></a>00773                 <span class="comment"># catch it.</span>
<a name="l00774"></a>00774                 <span class="comment">#</span>
<a name="l00775"></a>00775                 <span class="comment"># In addition to pushing the error token, we call call</span>
<a name="l00776"></a>00776                 <span class="comment"># the user defined p_error() function if this is the</span>
<a name="l00777"></a>00777                 <span class="comment"># first syntax error.  This function is only called if</span>
<a name="l00778"></a>00778                 <span class="comment"># errorcount == 0.</span>
<a name="l00779"></a>00779                 <span class="keywordflow">if</span> errorcount == 0 <span class="keywordflow">or</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a>:
<a name="l00780"></a>00780                     errorcount = error_count
<a name="l00781"></a>00781                     self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l00782"></a>00782                     errtoken = lookahead
<a name="l00783"></a>00783                     <span class="keywordflow">if</span> errtoken.type == <span class="stringliteral">&#39;$end&#39;</span>:
<a name="l00784"></a>00784                         errtoken = <span class="keywordtype">None</span>               <span class="comment"># End of file!</span>
<a name="l00785"></a>00785                     <span class="keywordflow">if</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a066cb59fe7db4589adf9c8d04bddc822">errorfunc</a>:
<a name="l00786"></a>00786                         <span class="keyword">global</span> errok,token,restart
<a name="l00787"></a>00787                         errok = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#ab9e5060941c2f85b54e23ad8ff936b5c">errok</a>        <span class="comment"># Set some special functions available in error recovery</span>
<a name="l00788"></a>00788                         token = get_token
<a name="l00789"></a>00789                         restart = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a18aba3dc442455043c2627c74dd793f5">restart</a>
<a name="l00790"></a>00790                         <span class="keywordflow">if</span> errtoken <span class="keywordflow">and</span> <span class="keywordflow">not</span> hasattr(errtoken,<span class="stringliteral">&#39;lexer&#39;</span>):
<a name="l00791"></a>00791                             errtoken.lexer = lexer
<a name="l00792"></a>00792                         tok = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a066cb59fe7db4589adf9c8d04bddc822">errorfunc</a>(errtoken)
<a name="l00793"></a>00793                         del errok, token, restart   <span class="comment"># Delete special functions</span>
<a name="l00794"></a>00794 
<a name="l00795"></a>00795                         <span class="keywordflow">if</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a>:
<a name="l00796"></a>00796                             <span class="comment"># User must have done some kind of panic</span>
<a name="l00797"></a>00797                             <span class="comment"># mode recovery on their own.  The</span>
<a name="l00798"></a>00798                             <span class="comment"># returned token is the next lookahead</span>
<a name="l00799"></a>00799                             lookahead = tok
<a name="l00800"></a>00800                             errtoken = <span class="keywordtype">None</span>
<a name="l00801"></a>00801                             <span class="keywordflow">continue</span>
<a name="l00802"></a>00802                     <span class="keywordflow">else</span>:
<a name="l00803"></a>00803                         <span class="keywordflow">if</span> errtoken:
<a name="l00804"></a>00804                             <span class="keywordflow">if</span> hasattr(errtoken,<span class="stringliteral">&quot;lineno&quot;</span>): lineno = lookahead.lineno
<a name="l00805"></a>00805                             <span class="keywordflow">else</span>: lineno = 0
<a name="l00806"></a>00806                             <span class="keywordflow">if</span> lineno:
<a name="l00807"></a>00807                                 sys.stderr.write(<span class="stringliteral">&quot;yacc: Syntax error at line %d, token=%s\n&quot;</span> % (lineno, errtoken.type))
<a name="l00808"></a>00808                             <span class="keywordflow">else</span>:
<a name="l00809"></a>00809                                 sys.stderr.write(<span class="stringliteral">&quot;yacc: Syntax error, token=%s&quot;</span> % errtoken.type)
<a name="l00810"></a>00810                         <span class="keywordflow">else</span>:
<a name="l00811"></a>00811                             sys.stderr.write(<span class="stringliteral">&quot;yacc: Parse error in input. EOF\n&quot;</span>)
<a name="l00812"></a>00812                             <span class="keywordflow">return</span>
<a name="l00813"></a>00813 
<a name="l00814"></a>00814                 <span class="keywordflow">else</span>:
<a name="l00815"></a>00815                     errorcount = error_count
<a name="l00816"></a>00816 
<a name="l00817"></a>00817                 <span class="comment"># case 1:  the statestack only has 1 entry on it.  If we&#39;re in this state, the</span>
<a name="l00818"></a>00818                 <span class="comment"># entire parse has been rolled back and we&#39;re completely hosed.   The token is</span>
<a name="l00819"></a>00819                 <span class="comment"># discarded and we just keep going.</span>
<a name="l00820"></a>00820 
<a name="l00821"></a>00821                 <span class="keywordflow">if</span> len(statestack) &lt;= 1 <span class="keywordflow">and</span> lookahead.type != <span class="stringliteral">&#39;$end&#39;</span>:
<a name="l00822"></a>00822                     lookahead = <span class="keywordtype">None</span>
<a name="l00823"></a>00823                     errtoken = <span class="keywordtype">None</span>
<a name="l00824"></a>00824                     state = 0
<a name="l00825"></a>00825                     <span class="comment"># Nuke the pushback stack</span>
<a name="l00826"></a>00826                     del lookaheadstack[:]
<a name="l00827"></a>00827                     <span class="keywordflow">continue</span>
<a name="l00828"></a>00828 
<a name="l00829"></a>00829                 <span class="comment"># case 2: the statestack has a couple of entries on it, but we&#39;re</span>
<a name="l00830"></a>00830                 <span class="comment"># at the end of the file. nuke the top entry and generate an error token</span>
<a name="l00831"></a>00831 
<a name="l00832"></a>00832                 <span class="comment"># Start nuking entries on the stack</span>
<a name="l00833"></a>00833                 <span class="keywordflow">if</span> lookahead.type == <span class="stringliteral">&#39;$end&#39;</span>:
<a name="l00834"></a>00834                     <span class="comment"># Whoa. We&#39;re really hosed here. Bail out</span>
<a name="l00835"></a>00835                     <span class="keywordflow">return</span>
<a name="l00836"></a>00836 
<a name="l00837"></a>00837                 <span class="keywordflow">if</span> lookahead.type != <span class="stringliteral">&#39;error&#39;</span>:
<a name="l00838"></a>00838                     sym = symstack[-1]
<a name="l00839"></a>00839                     <span class="keywordflow">if</span> sym.type == <span class="stringliteral">&#39;error&#39;</span>:
<a name="l00840"></a>00840                         <span class="comment"># Hmmm. Error is on top of stack, we&#39;ll just nuke input</span>
<a name="l00841"></a>00841                         <span class="comment"># symbol and continue</span>
<a name="l00842"></a>00842                         lookahead = <span class="keywordtype">None</span>
<a name="l00843"></a>00843                         <span class="keywordflow">continue</span>
<a name="l00844"></a>00844                     t = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00845"></a>00845                     t.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l00846"></a>00846                     <span class="keywordflow">if</span> hasattr(lookahead,<span class="stringliteral">&quot;lineno&quot;</span>):
<a name="l00847"></a>00847                         t.lineno = lookahead.lineno
<a name="l00848"></a>00848                     t.value = lookahead
<a name="l00849"></a>00849                     lookaheadstack.append(lookahead)
<a name="l00850"></a>00850                     lookahead = t
<a name="l00851"></a>00851                 <span class="keywordflow">else</span>:
<a name="l00852"></a>00852                     symstack.pop()
<a name="l00853"></a>00853                     statestack.pop()
<a name="l00854"></a>00854                     state = statestack[-1]       <span class="comment"># Potential bug fix</span>
<a name="l00855"></a>00855 
<a name="l00856"></a>00856                 <span class="keywordflow">continue</span>
<a name="l00857"></a>00857 
<a name="l00858"></a>00858             <span class="comment"># Call an error function here</span>
<a name="l00859"></a>00859             <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&quot;yacc: internal parser error!!!\n&quot;</span>)
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00862"></a>00862     <span class="comment"># parseopt_notrack().</span>
<a name="l00863"></a>00863     <span class="comment">#</span>
<a name="l00864"></a>00864     <span class="comment"># Optimized version of parseopt() with line number tracking removed. </span>
<a name="l00865"></a>00865     <span class="comment"># DO NOT EDIT THIS CODE DIRECTLY. Copy the optimized version and remove</span>
<a name="l00866"></a>00866     <span class="comment"># code in the #--! TRACKING sections</span>
<a name="l00867"></a>00867     <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00868"></a>00868 
<a name="l00869"></a><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a22489ab04621fda488cebd298d1c6ffd">00869</a>     <span class="keyword">def </span><a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a22489ab04621fda488cebd298d1c6ffd">parseopt_notrack</a>(self,input=None,lexer=None,debug=0,tracking=0,tokenfunc=None):
<a name="l00870"></a>00870         lookahead = <span class="keywordtype">None</span>                 <span class="comment"># Current lookahead symbol</span>
<a name="l00871"></a>00871         lookaheadstack = [ ]             <span class="comment"># Stack of lookahead symbols</span>
<a name="l00872"></a>00872         actions = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a61812c4bf807ce15c0cdc830585a212e">action</a>            <span class="comment"># Local reference to action table (to avoid lookup on self.)</span>
<a name="l00873"></a>00873         goto    = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a90508392166473d06a483de637c932d2">goto</a>              <span class="comment"># Local reference to goto table (to avoid lookup on self.)</span>
<a name="l00874"></a>00874         prod    = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#aa2b9d7661ccca32a7f5fa73c25f6506c">productions</a>       <span class="comment"># Local reference to production list (to avoid lookup on self.)</span>
<a name="l00875"></a>00875         pslice  = <a class="code" href="../../d5/dd5/classply_1_1yacc_1_1_yacc_production.html">YaccProduction</a>(<span class="keywordtype">None</span>)   <span class="comment"># Production object passed to grammar rules</span>
<a name="l00876"></a>00876         errorcount = 0                   <span class="comment"># Used during error recovery </span>
<a name="l00877"></a>00877 
<a name="l00878"></a>00878         <span class="comment"># If no lexer was given, we will try to use the lex module</span>
<a name="l00879"></a>00879         <span class="keywordflow">if</span> <span class="keywordflow">not</span> lexer:
<a name="l00880"></a>00880             lex = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#acb247fbbf4ace4412a91df37b83596a8">load_ply_lex</a>()
<a name="l00881"></a>00881             lexer = lex.lexer
<a name="l00882"></a>00882         
<a name="l00883"></a>00883         <span class="comment"># Set up the lexer and parser objects on pslice</span>
<a name="l00884"></a>00884         pslice.lexer = lexer
<a name="l00885"></a>00885         pslice.parser = self
<a name="l00886"></a>00886 
<a name="l00887"></a>00887         <span class="comment"># If input was supplied, pass to lexer</span>
<a name="l00888"></a>00888         <span class="keywordflow">if</span> input <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00889"></a>00889             lexer.input(input)
<a name="l00890"></a>00890 
<a name="l00891"></a>00891         <span class="keywordflow">if</span> tokenfunc <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00892"></a>00892            <span class="comment"># Tokenize function</span>
<a name="l00893"></a>00893            get_token = lexer.token
<a name="l00894"></a>00894         <span class="keywordflow">else</span>:
<a name="l00895"></a>00895            get_token = tokenfunc
<a name="l00896"></a>00896 
<a name="l00897"></a>00897         <span class="comment"># Set up the state and symbol stacks</span>
<a name="l00898"></a>00898 
<a name="l00899"></a>00899         statestack = [ ]                <span class="comment"># Stack of parsing states</span>
<a name="l00900"></a>00900         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a89f06e59a8ed07bbfa71d19061d88c5c">statestack</a> = statestack
<a name="l00901"></a>00901         symstack   = [ ]                <span class="comment"># Stack of grammar symbols</span>
<a name="l00902"></a>00902         self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a21b9cef8dd3185c2499bd9d223a0183f">symstack</a> = symstack
<a name="l00903"></a>00903 
<a name="l00904"></a>00904         pslice.stack = symstack         <span class="comment"># Put in the production</span>
<a name="l00905"></a>00905         errtoken   = <span class="keywordtype">None</span>               <span class="comment"># Err token</span>
<a name="l00906"></a>00906 
<a name="l00907"></a>00907         <span class="comment"># The start state is assumed to be (0,$end)</span>
<a name="l00908"></a>00908 
<a name="l00909"></a>00909         statestack.append(0)
<a name="l00910"></a>00910         sym = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00911"></a>00911         sym.type = <span class="stringliteral">&#39;$end&#39;</span>
<a name="l00912"></a>00912         symstack.append(sym)
<a name="l00913"></a>00913         state = 0
<a name="l00914"></a>00914         <span class="keywordflow">while</span> 1:
<a name="l00915"></a>00915             <span class="comment"># Get the next symbol on the input.  If a lookahead symbol</span>
<a name="l00916"></a>00916             <span class="comment"># is already set, we just use that. Otherwise, we&#39;ll pull</span>
<a name="l00917"></a>00917             <span class="comment"># the next token off of the lookaheadstack or from the lexer</span>
<a name="l00918"></a>00918 
<a name="l00919"></a>00919             <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookahead:
<a name="l00920"></a>00920                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookaheadstack:
<a name="l00921"></a>00921                     lookahead = get_token()     <span class="comment"># Get the next token</span>
<a name="l00922"></a>00922                 <span class="keywordflow">else</span>:
<a name="l00923"></a>00923                     lookahead = lookaheadstack.pop()
<a name="l00924"></a>00924                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> lookahead:
<a name="l00925"></a>00925                     lookahead = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00926"></a>00926                     lookahead.type = <span class="stringliteral">&#39;$end&#39;</span>
<a name="l00927"></a>00927 
<a name="l00928"></a>00928             <span class="comment"># Check the action table</span>
<a name="l00929"></a>00929             ltype = lookahead.type
<a name="l00930"></a>00930             t = actions[state].<a class="code" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">get</a>(ltype)
<a name="l00931"></a>00931 
<a name="l00932"></a>00932             <span class="keywordflow">if</span> t <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00933"></a>00933                 <span class="keywordflow">if</span> t &gt; 0:
<a name="l00934"></a>00934                     <span class="comment"># shift a symbol on the stack</span>
<a name="l00935"></a>00935                     statestack.append(t)
<a name="l00936"></a>00936                     state = t
<a name="l00937"></a>00937 
<a name="l00938"></a>00938                     symstack.append(lookahead)
<a name="l00939"></a>00939                     lookahead = <span class="keywordtype">None</span>
<a name="l00940"></a>00940 
<a name="l00941"></a>00941                     <span class="comment"># Decrease error count on successful shift</span>
<a name="l00942"></a>00942                     <span class="keywordflow">if</span> errorcount: errorcount -=1
<a name="l00943"></a>00943                     <span class="keywordflow">continue</span>
<a name="l00944"></a>00944 
<a name="l00945"></a>00945                 <span class="keywordflow">if</span> t &lt; 0:
<a name="l00946"></a>00946                     <span class="comment"># reduce a symbol on the stack, emit a production</span>
<a name="l00947"></a>00947                     p = prod[-t]
<a name="l00948"></a>00948                     pname = p.name
<a name="l00949"></a>00949                     plen  = p.len
<a name="l00950"></a>00950 
<a name="l00951"></a>00951                     <span class="comment"># Get production function</span>
<a name="l00952"></a>00952                     sym = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l00953"></a>00953                     sym.type = pname       <span class="comment"># Production name</span>
<a name="l00954"></a>00954                     sym.value = <span class="keywordtype">None</span>
<a name="l00955"></a>00955 
<a name="l00956"></a>00956                     <span class="keywordflow">if</span> plen:
<a name="l00957"></a>00957                         targ = symstack[-plen-1:]
<a name="l00958"></a>00958                         targ[0] = sym
<a name="l00959"></a>00959 
<a name="l00960"></a>00960                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00961"></a>00961                         <span class="comment"># The code enclosed in this section is duplicated </span>
<a name="l00962"></a>00962                         <span class="comment"># below as a performance optimization.  Make sure</span>
<a name="l00963"></a>00963                         <span class="comment"># changes get made in both locations.</span>
<a name="l00964"></a>00964 
<a name="l00965"></a>00965                         pslice.slice = targ
<a name="l00966"></a>00966                         
<a name="l00967"></a>00967                         <span class="keywordflow">try</span>:
<a name="l00968"></a>00968                             <span class="comment"># Call the grammar rule with our special slice object</span>
<a name="l00969"></a>00969                             del symstack[-plen:]
<a name="l00970"></a>00970                             del statestack[-plen:]
<a name="l00971"></a>00971                             p.callable(pslice)
<a name="l00972"></a>00972                             symstack.append(sym)
<a name="l00973"></a>00973                             state = goto[statestack[-1]][pname]
<a name="l00974"></a>00974                             statestack.append(state)
<a name="l00975"></a>00975                         <span class="keywordflow">except</span> SyntaxError:
<a name="l00976"></a>00976                             <span class="comment"># If an error was set. Enter error recovery state</span>
<a name="l00977"></a>00977                             lookaheadstack.append(lookahead)
<a name="l00978"></a>00978                             symstack.pop()
<a name="l00979"></a>00979                             statestack.pop()
<a name="l00980"></a>00980                             state = statestack[-1]
<a name="l00981"></a>00981                             sym.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l00982"></a>00982                             lookahead = sym
<a name="l00983"></a>00983                             errorcount = error_count
<a name="l00984"></a>00984                             self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l00985"></a>00985                         <span class="keywordflow">continue</span>
<a name="l00986"></a>00986                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00987"></a>00987     
<a name="l00988"></a>00988                     <span class="keywordflow">else</span>:
<a name="l00989"></a>00989 
<a name="l00990"></a>00990                         targ = [ sym ]
<a name="l00991"></a>00991 
<a name="l00992"></a>00992                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00993"></a>00993                         <span class="comment"># The code enclosed in this section is duplicated </span>
<a name="l00994"></a>00994                         <span class="comment"># above as a performance optimization.  Make sure</span>
<a name="l00995"></a>00995                         <span class="comment"># changes get made in both locations.</span>
<a name="l00996"></a>00996 
<a name="l00997"></a>00997                         pslice.slice = targ
<a name="l00998"></a>00998 
<a name="l00999"></a>00999                         <span class="keywordflow">try</span>:
<a name="l01000"></a>01000                             <span class="comment"># Call the grammar rule with our special slice object</span>
<a name="l01001"></a>01001                             p.callable(pslice)
<a name="l01002"></a>01002                             symstack.append(sym)
<a name="l01003"></a>01003                             state = goto[statestack[-1]][pname]
<a name="l01004"></a>01004                             statestack.append(state)
<a name="l01005"></a>01005                         <span class="keywordflow">except</span> SyntaxError:
<a name="l01006"></a>01006                             <span class="comment"># If an error was set. Enter error recovery state</span>
<a name="l01007"></a>01007                             lookaheadstack.append(lookahead)
<a name="l01008"></a>01008                             symstack.pop()
<a name="l01009"></a>01009                             statestack.pop()
<a name="l01010"></a>01010                             state = statestack[-1]
<a name="l01011"></a>01011                             sym.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l01012"></a>01012                             lookahead = sym
<a name="l01013"></a>01013                             errorcount = error_count
<a name="l01014"></a>01014                             self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l01015"></a>01015                         <span class="keywordflow">continue</span>
<a name="l01016"></a>01016                         <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l01017"></a>01017 
<a name="l01018"></a>01018                 <span class="keywordflow">if</span> t == 0:
<a name="l01019"></a>01019                     n = symstack[-1]
<a name="l01020"></a>01020                     <span class="keywordflow">return</span> getattr(n,<span class="stringliteral">&quot;value&quot;</span>,<span class="keywordtype">None</span>)
<a name="l01021"></a>01021 
<a name="l01022"></a>01022             <span class="keywordflow">if</span> t == <span class="keywordtype">None</span>:
<a name="l01023"></a>01023 
<a name="l01024"></a>01024                 <span class="comment"># We have some kind of parsing error here.  To handle</span>
<a name="l01025"></a>01025                 <span class="comment"># this, we are going to push the current token onto</span>
<a name="l01026"></a>01026                 <span class="comment"># the tokenstack and replace it with an &#39;error&#39; token.</span>
<a name="l01027"></a>01027                 <span class="comment"># If there are any synchronization rules, they may</span>
<a name="l01028"></a>01028                 <span class="comment"># catch it.</span>
<a name="l01029"></a>01029                 <span class="comment">#</span>
<a name="l01030"></a>01030                 <span class="comment"># In addition to pushing the error token, we call call</span>
<a name="l01031"></a>01031                 <span class="comment"># the user defined p_error() function if this is the</span>
<a name="l01032"></a>01032                 <span class="comment"># first syntax error.  This function is only called if</span>
<a name="l01033"></a>01033                 <span class="comment"># errorcount == 0.</span>
<a name="l01034"></a>01034                 <span class="keywordflow">if</span> errorcount == 0 <span class="keywordflow">or</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a>:
<a name="l01035"></a>01035                     errorcount = error_count
<a name="l01036"></a>01036                     self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a> = 0
<a name="l01037"></a>01037                     errtoken = lookahead
<a name="l01038"></a>01038                     <span class="keywordflow">if</span> errtoken.type == <span class="stringliteral">&#39;$end&#39;</span>:
<a name="l01039"></a>01039                         errtoken = <span class="keywordtype">None</span>               <span class="comment"># End of file!</span>
<a name="l01040"></a>01040                     <span class="keywordflow">if</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a066cb59fe7db4589adf9c8d04bddc822">errorfunc</a>:
<a name="l01041"></a>01041                         <span class="keyword">global</span> errok,token,restart
<a name="l01042"></a>01042                         errok = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#ab9e5060941c2f85b54e23ad8ff936b5c">errok</a>        <span class="comment"># Set some special functions available in error recovery</span>
<a name="l01043"></a>01043                         token = get_token
<a name="l01044"></a>01044                         restart = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a18aba3dc442455043c2627c74dd793f5">restart</a>
<a name="l01045"></a>01045                         <span class="keywordflow">if</span> errtoken <span class="keywordflow">and</span> <span class="keywordflow">not</span> hasattr(errtoken,<span class="stringliteral">&#39;lexer&#39;</span>):
<a name="l01046"></a>01046                             errtoken.lexer = lexer
<a name="l01047"></a>01047                         tok = self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a066cb59fe7db4589adf9c8d04bddc822">errorfunc</a>(errtoken)
<a name="l01048"></a>01048                         del errok, token, restart   <span class="comment"># Delete special functions</span>
<a name="l01049"></a>01049 
<a name="l01050"></a>01050                         <span class="keywordflow">if</span> self.<a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html#a27aebb35c2e776ac8bcb3769b10391f0">errorok</a>:
<a name="l01051"></a>01051                             <span class="comment"># User must have done some kind of panic</span>
<a name="l01052"></a>01052                             <span class="comment"># mode recovery on their own.  The</span>
<a name="l01053"></a>01053                             <span class="comment"># returned token is the next lookahead</span>
<a name="l01054"></a>01054                             lookahead = tok
<a name="l01055"></a>01055                             errtoken = <span class="keywordtype">None</span>
<a name="l01056"></a>01056                             <span class="keywordflow">continue</span>
<a name="l01057"></a>01057                     <span class="keywordflow">else</span>:
<a name="l01058"></a>01058                         <span class="keywordflow">if</span> errtoken:
<a name="l01059"></a>01059                             <span class="keywordflow">if</span> hasattr(errtoken,<span class="stringliteral">&quot;lineno&quot;</span>): lineno = lookahead.lineno
<a name="l01060"></a>01060                             <span class="keywordflow">else</span>: lineno = 0
<a name="l01061"></a>01061                             <span class="keywordflow">if</span> lineno:
<a name="l01062"></a>01062                                 sys.stderr.write(<span class="stringliteral">&quot;yacc: Syntax error at line %d, token=%s\n&quot;</span> % (lineno, errtoken.type))
<a name="l01063"></a>01063                             <span class="keywordflow">else</span>:
<a name="l01064"></a>01064                                 sys.stderr.write(<span class="stringliteral">&quot;yacc: Syntax error, token=%s&quot;</span> % errtoken.type)
<a name="l01065"></a>01065                         <span class="keywordflow">else</span>:
<a name="l01066"></a>01066                             sys.stderr.write(<span class="stringliteral">&quot;yacc: Parse error in input. EOF\n&quot;</span>)
<a name="l01067"></a>01067                             <span class="keywordflow">return</span>
<a name="l01068"></a>01068 
<a name="l01069"></a>01069                 <span class="keywordflow">else</span>:
<a name="l01070"></a>01070                     errorcount = error_count
<a name="l01071"></a>01071 
<a name="l01072"></a>01072                 <span class="comment"># case 1:  the statestack only has 1 entry on it.  If we&#39;re in this state, the</span>
<a name="l01073"></a>01073                 <span class="comment"># entire parse has been rolled back and we&#39;re completely hosed.   The token is</span>
<a name="l01074"></a>01074                 <span class="comment"># discarded and we just keep going.</span>
<a name="l01075"></a>01075 
<a name="l01076"></a>01076                 <span class="keywordflow">if</span> len(statestack) &lt;= 1 <span class="keywordflow">and</span> lookahead.type != <span class="stringliteral">&#39;$end&#39;</span>:
<a name="l01077"></a>01077                     lookahead = <span class="keywordtype">None</span>
<a name="l01078"></a>01078                     errtoken = <span class="keywordtype">None</span>
<a name="l01079"></a>01079                     state = 0
<a name="l01080"></a>01080                     <span class="comment"># Nuke the pushback stack</span>
<a name="l01081"></a>01081                     del lookaheadstack[:]
<a name="l01082"></a>01082                     <span class="keywordflow">continue</span>
<a name="l01083"></a>01083 
<a name="l01084"></a>01084                 <span class="comment"># case 2: the statestack has a couple of entries on it, but we&#39;re</span>
<a name="l01085"></a>01085                 <span class="comment"># at the end of the file. nuke the top entry and generate an error token</span>
<a name="l01086"></a>01086 
<a name="l01087"></a>01087                 <span class="comment"># Start nuking entries on the stack</span>
<a name="l01088"></a>01088                 <span class="keywordflow">if</span> lookahead.type == <span class="stringliteral">&#39;$end&#39;</span>:
<a name="l01089"></a>01089                     <span class="comment"># Whoa. We&#39;re really hosed here. Bail out</span>
<a name="l01090"></a>01090                     <span class="keywordflow">return</span>
<a name="l01091"></a>01091 
<a name="l01092"></a>01092                 <span class="keywordflow">if</span> lookahead.type != <span class="stringliteral">&#39;error&#39;</span>:
<a name="l01093"></a>01093                     sym = symstack[-1]
<a name="l01094"></a>01094                     <span class="keywordflow">if</span> sym.type == <span class="stringliteral">&#39;error&#39;</span>:
<a name="l01095"></a>01095                         <span class="comment"># Hmmm. Error is on top of stack, we&#39;ll just nuke input</span>
<a name="l01096"></a>01096                         <span class="comment"># symbol and continue</span>
<a name="l01097"></a>01097                         lookahead = <span class="keywordtype">None</span>
<a name="l01098"></a>01098                         <span class="keywordflow">continue</span>
<a name="l01099"></a>01099                     t = <a class="code" href="../../d1/d39/classply_1_1yacc_1_1_yacc_symbol.html">YaccSymbol</a>()
<a name="l01100"></a>01100                     t.type = <span class="stringliteral">&#39;error&#39;</span>
<a name="l01101"></a>01101                     <span class="keywordflow">if</span> hasattr(lookahead,<span class="stringliteral">&quot;lineno&quot;</span>):
<a name="l01102"></a>01102                         t.lineno = lookahead.lineno
<a name="l01103"></a>01103                     t.value = lookahead
<a name="l01104"></a>01104                     lookaheadstack.append(lookahead)
<a name="l01105"></a>01105                     lookahead = t
<a name="l01106"></a>01106                 <span class="keywordflow">else</span>:
<a name="l01107"></a>01107                     symstack.pop()
<a name="l01108"></a>01108                     statestack.pop()
<a name="l01109"></a>01109                     state = statestack[-1]       <span class="comment"># Potential bug fix</span>
<a name="l01110"></a>01110 
<a name="l01111"></a>01111                 <span class="keywordflow">continue</span>
<a name="l01112"></a>01112 
<a name="l01113"></a>01113             <span class="comment"># Call an error function here</span>
<a name="l01114"></a>01114             <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&quot;yacc: internal parser error!!!\n&quot;</span>)
<a name="l01115"></a>01115 
<a name="l01116"></a>01116 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01117"></a>01117 <span class="comment">#                          === Grammar Representation ===</span>
<a name="l01118"></a>01118 <span class="comment">#</span>
<a name="l01119"></a>01119 <span class="comment"># The following functions, classes, and variables are used to represent and</span>
<a name="l01120"></a>01120 <span class="comment"># manipulate the rules that make up a grammar. </span>
<a name="l01121"></a>01121 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01122"></a>01122 
<a name="l01123"></a>01123 <span class="keyword">import</span> re
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 <span class="comment"># regex matching identifiers</span>
<a name="l01126"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#afe33e3936782a89a342528bfe7e9c351">01126</a> _is_identifier = re.compile(<span class="stringliteral">r&#39;^[a-zA-Z0-9_-]+$&#39;</span>)
<a name="l01127"></a>01127 
<a name="l01128"></a>01128 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01129"></a>01129 <span class="comment"># class Production:</span>
<a name="l01130"></a>01130 <span class="comment">#</span>
<a name="l01131"></a>01131 <span class="comment"># This class stores the raw information about a single production or grammar rule.</span>
<a name="l01132"></a>01132 <span class="comment"># A grammar rule refers to a specification such as this:</span>
<a name="l01133"></a>01133 <span class="comment">#</span>
<a name="l01134"></a>01134 <span class="comment">#       expr : expr PLUS term </span>
<a name="l01135"></a>01135 <span class="comment">#</span>
<a name="l01136"></a>01136 <span class="comment"># Here are the basic attributes defined on all productions</span>
<a name="l01137"></a>01137 <span class="comment">#</span>
<a name="l01138"></a>01138 <span class="comment">#       name     - Name of the production.  For example &#39;expr&#39;</span>
<a name="l01139"></a>01139 <span class="comment">#       prod     - A list of symbols on the right side [&#39;expr&#39;,&#39;PLUS&#39;,&#39;term&#39;]</span>
<a name="l01140"></a>01140 <span class="comment">#       prec     - Production precedence level</span>
<a name="l01141"></a>01141 <span class="comment">#       number   - Production number.</span>
<a name="l01142"></a>01142 <span class="comment">#       func     - Function that executes on reduce</span>
<a name="l01143"></a>01143 <span class="comment">#       file     - File where production function is defined</span>
<a name="l01144"></a>01144 <span class="comment">#       lineno   - Line number where production function is defined</span>
<a name="l01145"></a>01145 <span class="comment">#</span>
<a name="l01146"></a>01146 <span class="comment"># The following attributes are defined or optional.</span>
<a name="l01147"></a>01147 <span class="comment">#</span>
<a name="l01148"></a>01148 <span class="comment">#       len       - Length of the production (number of symbols on right hand side)</span>
<a name="l01149"></a>01149 <span class="comment">#       usyms     - Set of unique symbols found in the production</span>
<a name="l01150"></a>01150 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01151"></a>01151 
<a name="l01152"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html">01152</a> <span class="keyword">class </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html">Production</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l01153"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#aed4a6d4fad8c1b8f081a38f7a2939482">01153</a>     reduced = 0
<a name="l01154"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a483ef11d833a46198adc02d43216dc05">01154</a>     <span class="keyword">def </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a890a2ee03cc9882e6515cb44d44da116">__init__</a>(self,number,name,prod,precedence=(<span class="stringliteral">&#39;right&#39;</span>,0),func=<span class="keywordtype">None</span>,file=<span class="stringliteral">&#39;&#39;</span>,line=0):
<a name="l01155"></a>01155         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#adbaa52fdfc9b8e18dc875a662f14ef33">name</a>     = name
<a name="l01156"></a>01156         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acaa383a686160c873f689115ae4802a8">prod</a>     = tuple(prod)
<a name="l01157"></a>01157         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#aa7d1aee70dde02deba68903cc15e0261">number</a>   = number
<a name="l01158"></a>01158         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#abd0f37f5e006d8ada12b0f83be25c88d">func</a>     = func
<a name="l01159"></a>01159         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a4422135f4dab455324b7b93209a587fe">callable</a> = <span class="keywordtype">None</span>
<a name="l01160"></a>01160         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a9c13d183572ae5abf3134e87d10ea52e">file</a>     = file
<a name="l01161"></a>01161         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#ac2a617f4d24828b7364078663d378e2b">line</a>     = line
<a name="l01162"></a>01162         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a62631174dc76dd40b1094f3c393ea152">prec</a>     = precedence
<a name="l01163"></a>01163 
<a name="l01164"></a>01164         <span class="comment"># Internal settings used during table construction</span>
<a name="l01165"></a>01165         
<a name="l01166"></a>01166         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#ae9d22d8aad3dc025059d5e10b1259dd6">len</a>  = len(self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acaa383a686160c873f689115ae4802a8">prod</a>)   <span class="comment"># Length of the production</span>
<a name="l01167"></a>01167 
<a name="l01168"></a>01168         <span class="comment"># Create a list of unique production symbols used in the production</span>
<a name="l01169"></a>01169         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a483ef11d833a46198adc02d43216dc05">usyms</a> = [ ]             
<a name="l01170"></a>01170         <span class="keywordflow">for</span> s <span class="keywordflow">in</span> self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acaa383a686160c873f689115ae4802a8">prod</a>:
<a name="l01171"></a>01171             <span class="keywordflow">if</span> s <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a483ef11d833a46198adc02d43216dc05">usyms</a>:
<a name="l01172"></a>01172                 self.usyms.append(s)
<a name="l01173"></a>01173 
<a name="l01174"></a>01174         <span class="comment"># List of all LR items for the production</span>
<a name="l01175"></a>01175         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#ac9f18ceae82bb67e795403e9e6d38c4a">lr_items</a> = []
<a name="l01176"></a>01176         self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a0ee40d19dc4fa6cd5067deaef3a5f515">lr_next</a> = <span class="keywordtype">None</span>
<a name="l01177"></a>01177 
<a name="l01178"></a>01178         <span class="comment"># Create a string representation</span>
<a name="l01179"></a>01179         <span class="keywordflow">if</span> self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acaa383a686160c873f689115ae4802a8">prod</a>:
<a name="l01180"></a>01180             self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a6635062819ac96422f9a419e174129dd">str</a> = <span class="stringliteral">&quot;%s -&gt; %s&quot;</span> % (self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#adbaa52fdfc9b8e18dc875a662f14ef33">name</a>,<span class="stringliteral">&quot; &quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>(self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acaa383a686160c873f689115ae4802a8">prod</a>))
<a name="l01181"></a>01181         <span class="keywordflow">else</span>:
<a name="l01182"></a>01182             self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a6635062819ac96422f9a419e174129dd">str</a> = <span class="stringliteral">&quot;%s -&gt; &lt;empty&gt;&quot;</span> % self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#adbaa52fdfc9b8e18dc875a662f14ef33">name</a>
<a name="l01183"></a>01183 
<a name="l01184"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a474abb4d4e281f0f6623e78c62be8524">01184</a>     <span class="keyword">def </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a474abb4d4e281f0f6623e78c62be8524">__str__</a>(self):
<a name="l01185"></a>01185         <span class="keywordflow">return</span> self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a6635062819ac96422f9a419e174129dd">str</a>
<a name="l01186"></a>01186 
<a name="l01187"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acb8dc108b1bc58fa207ed5f95c8483cf">01187</a>     <span class="keyword">def </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acb8dc108b1bc58fa207ed5f95c8483cf">__repr__</a>(self):
<a name="l01188"></a>01188         <span class="keywordflow">return</span> <span class="stringliteral">&quot;Production(&quot;</span>+<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a6635062819ac96422f9a419e174129dd">str</a>(self)+<span class="stringliteral">&quot;)&quot;</span>
<a name="l01189"></a>01189 
<a name="l01190"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#ae14f44083a5becbefa1471274e68357c">01190</a>     <span class="keyword">def </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#ae14f44083a5becbefa1471274e68357c">__len__</a>(self):
<a name="l01191"></a>01191         <span class="keywordflow">return</span> len(self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acaa383a686160c873f689115ae4802a8">prod</a>)
<a name="l01192"></a>01192 
<a name="l01193"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a32a5cb8185e267aa42ed297aea2ab7e3">01193</a>     <span class="keyword">def </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a32a5cb8185e267aa42ed297aea2ab7e3">__nonzero__</a>(self):
<a name="l01194"></a>01194         <span class="keywordflow">return</span> 1
<a name="l01195"></a>01195 
<a name="l01196"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#ae95c6dadb9acf2e2d59c84ff022c6eeb">01196</a>     <span class="keyword">def </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#ae95c6dadb9acf2e2d59c84ff022c6eeb">__getitem__</a>(self,index):
<a name="l01197"></a>01197         <span class="keywordflow">return</span> self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acaa383a686160c873f689115ae4802a8">prod</a>[index]
<a name="l01198"></a>01198             
<a name="l01199"></a>01199     <span class="comment"># Return the nth lr_item from the production (or None if at the end)</span>
<a name="l01200"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#af1f5959b80b383f14e2308057e59a118">01200</a>     <span class="keyword">def </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#af1f5959b80b383f14e2308057e59a118">lr_item</a>(self,n):
<a name="l01201"></a>01201         <span class="keywordflow">if</span> n &gt; len(self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#acaa383a686160c873f689115ae4802a8">prod</a>): <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l01202"></a>01202         p = <a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html">LRItem</a>(self,n)
<a name="l01203"></a>01203 
<a name="l01204"></a>01204         <span class="comment"># Precompute the list of productions immediately following.  Hack. Remove later</span>
<a name="l01205"></a>01205         <span class="keywordflow">try</span>:
<a name="l01206"></a>01206             p.lr_after = Prodnames[p.prod[n+1]]
<a name="l01207"></a>01207         <span class="keywordflow">except</span> (IndexError,KeyError):
<a name="l01208"></a>01208             p.lr_after = []
<a name="l01209"></a>01209         <span class="keywordflow">try</span>:
<a name="l01210"></a>01210             p.lr_before = p.prod[n-1]
<a name="l01211"></a>01211         <span class="keywordflow">except</span> IndexError:
<a name="l01212"></a>01212             p.lr_before = <span class="keywordtype">None</span>
<a name="l01213"></a>01213 
<a name="l01214"></a>01214         <span class="keywordflow">return</span> p
<a name="l01215"></a>01215     
<a name="l01216"></a>01216     <span class="comment"># Bind the production function name to a callable</span>
<a name="l01217"></a><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#af3001d4f765cb3efa9cacc31919b09d2">01217</a>     <span class="keyword">def </span><a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#af3001d4f765cb3efa9cacc31919b09d2">bind</a>(self,pdict):
<a name="l01218"></a>01218         <span class="keywordflow">if</span> self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#abd0f37f5e006d8ada12b0f83be25c88d">func</a>:
<a name="l01219"></a>01219             self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#a4422135f4dab455324b7b93209a587fe">callable</a> = pdict[self.<a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html#abd0f37f5e006d8ada12b0f83be25c88d">func</a>]
<a name="l01220"></a>01220 
<a name="l01221"></a>01221 <span class="comment"># This class serves as a minimal standin for Production objects when</span>
<a name="l01222"></a>01222 <span class="comment"># reading table data from files.   It only contains information</span>
<a name="l01223"></a>01223 <span class="comment"># actually used by the LR parsing engine, plus some additional</span>
<a name="l01224"></a>01224 <span class="comment"># debugging information.</span>
<a name="l01225"></a><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html">01225</a> <span class="keyword">class </span><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html">MiniProduction</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l01226"></a><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#afdfa3e82858ec6b6c9ad7366a8b69047">01226</a>     <span class="keyword">def </span><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a707ceaaa1fb60af01f8b452b2aa2e8fe">__init__</a>(self,str,name,len,func,file,line):
<a name="l01227"></a>01227         self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#acc0d1916426056610764db013fe5f0c9">name</a>     = name
<a name="l01228"></a>01228         self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a668fa955643e919a139061a7ad2b456a">len</a>      = len
<a name="l01229"></a>01229         self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a0410bca35adf8601b282e4acef833a76">func</a>     = func
<a name="l01230"></a>01230         self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a215eae5382408537e8c38db694b1b81f">callable</a> = <span class="keywordtype">None</span>
<a name="l01231"></a>01231         self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a9bf012de35371a46680ee9119a81a286">file</a>     = file
<a name="l01232"></a>01232         self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#ae253229ef7170afcda99c3ad3651f00f">line</a>     = line
<a name="l01233"></a>01233         self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#afdfa3e82858ec6b6c9ad7366a8b69047">str</a>      = str
<a name="l01234"></a><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a239e7693ea834923eef756efb4471539">01234</a>     <span class="keyword">def </span><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a239e7693ea834923eef756efb4471539">__str__</a>(self):
<a name="l01235"></a>01235         <span class="keywordflow">return</span> self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#afdfa3e82858ec6b6c9ad7366a8b69047">str</a>
<a name="l01236"></a><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a939c416a45f2ad652c936d9f99ac6439">01236</a>     <span class="keyword">def </span><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a939c416a45f2ad652c936d9f99ac6439">__repr__</a>(self):
<a name="l01237"></a>01237         <span class="keywordflow">return</span> <span class="stringliteral">&quot;MiniProduction(%s)&quot;</span> % self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#afdfa3e82858ec6b6c9ad7366a8b69047">str</a>
<a name="l01238"></a>01238 
<a name="l01239"></a>01239     <span class="comment"># Bind the production function name to a callable</span>
<a name="l01240"></a><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a4defd2834d9a622d89127fc31ef7648f">01240</a>     <span class="keyword">def </span><a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a4defd2834d9a622d89127fc31ef7648f">bind</a>(self,pdict):
<a name="l01241"></a>01241         <span class="keywordflow">if</span> self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a0410bca35adf8601b282e4acef833a76">func</a>:
<a name="l01242"></a>01242             self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a215eae5382408537e8c38db694b1b81f">callable</a> = pdict[self.<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html#a0410bca35adf8601b282e4acef833a76">func</a>]
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 
<a name="l01245"></a>01245 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01246"></a>01246 <span class="comment"># class LRItem</span>
<a name="l01247"></a>01247 <span class="comment">#</span>
<a name="l01248"></a>01248 <span class="comment"># This class represents a specific stage of parsing a production rule.  For</span>
<a name="l01249"></a>01249 <span class="comment"># example: </span>
<a name="l01250"></a>01250 <span class="comment">#</span>
<a name="l01251"></a>01251 <span class="comment">#       expr : expr . PLUS term </span>
<a name="l01252"></a>01252 <span class="comment">#</span>
<a name="l01253"></a>01253 <span class="comment"># In the above, the &quot;.&quot; represents the current location of the parse.  Here</span>
<a name="l01254"></a>01254 <span class="comment"># basic attributes:</span>
<a name="l01255"></a>01255 <span class="comment">#</span>
<a name="l01256"></a>01256 <span class="comment">#       name       - Name of the production.  For example &#39;expr&#39;</span>
<a name="l01257"></a>01257 <span class="comment">#       prod       - A list of symbols on the right side [&#39;expr&#39;,&#39;.&#39;, &#39;PLUS&#39;,&#39;term&#39;]</span>
<a name="l01258"></a>01258 <span class="comment">#       number     - Production number.</span>
<a name="l01259"></a>01259 <span class="comment">#</span>
<a name="l01260"></a>01260 <span class="comment">#       lr_next      Next LR item. Example, if we are &#39; expr -&gt; expr . PLUS term&#39;</span>
<a name="l01261"></a>01261 <span class="comment">#                    then lr_next refers to &#39;expr -&gt; expr PLUS . term&#39;</span>
<a name="l01262"></a>01262 <span class="comment">#       lr_index   - LR item index (location of the &quot;.&quot;) in the prod list.</span>
<a name="l01263"></a>01263 <span class="comment">#       lookaheads - LALR lookahead symbols for this item</span>
<a name="l01264"></a>01264 <span class="comment">#       len        - Length of the production (number of symbols on right hand side)</span>
<a name="l01265"></a>01265 <span class="comment">#       lr_after    - List of all productions that immediately follow</span>
<a name="l01266"></a>01266 <span class="comment">#       lr_before   - Grammar symbol immediately before</span>
<a name="l01267"></a>01267 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01268"></a>01268 
<a name="l01269"></a><a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html">01269</a> <span class="keyword">class </span><a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html">LRItem</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l01270"></a><a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a41da99a26b90b602bfa1d21f93e4f302">01270</a>     <span class="keyword">def </span><a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#ab000fa77a544d2d5860942ae8ab0a314">__init__</a>(self,p,n):
<a name="l01271"></a>01271         self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a0f1c6cd4f25728dc95760478a067ee55">name</a>       = p.name
<a name="l01272"></a>01272         self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a4faa00a4dc355578d86c268aca554bfc">prod</a>       = <a class="code" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>(p.prod)
<a name="l01273"></a>01273         self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a12a4aecd6d0c3f7213930dc482c38506">number</a>     = p.number
<a name="l01274"></a>01274         self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a39e8151be9fd2cf14fd32763cf0b9954">lr_index</a>   = n
<a name="l01275"></a>01275         self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a5a919ed8b4882343744efb03558c5138">lookaheads</a> = { }
<a name="l01276"></a>01276         self.prod.insert(n,<span class="stringliteral">&quot;.&quot;</span>)
<a name="l01277"></a>01277         self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a4faa00a4dc355578d86c268aca554bfc">prod</a>       = tuple(self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a4faa00a4dc355578d86c268aca554bfc">prod</a>)
<a name="l01278"></a>01278         self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a4619fbc03d3a15077cfcc4748a26449c">len</a>        = len(self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a4faa00a4dc355578d86c268aca554bfc">prod</a>)
<a name="l01279"></a>01279         self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a41da99a26b90b602bfa1d21f93e4f302">usyms</a>      = p.usyms
<a name="l01280"></a>01280 
<a name="l01281"></a><a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a070d7ffa9ff2e24e2ce9650005034520">01281</a>     <span class="keyword">def </span><a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a070d7ffa9ff2e24e2ce9650005034520">__str__</a>(self):
<a name="l01282"></a>01282         <span class="keywordflow">if</span> self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a4faa00a4dc355578d86c268aca554bfc">prod</a>:
<a name="l01283"></a>01283             s = <span class="stringliteral">&quot;%s -&gt; %s&quot;</span> % (self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a0f1c6cd4f25728dc95760478a067ee55">name</a>,<span class="stringliteral">&quot; &quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>(self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a4faa00a4dc355578d86c268aca554bfc">prod</a>))
<a name="l01284"></a>01284         <span class="keywordflow">else</span>:
<a name="l01285"></a>01285             s = <span class="stringliteral">&quot;%s -&gt; &lt;empty&gt;&quot;</span> % self.<a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#a0f1c6cd4f25728dc95760478a067ee55">name</a>
<a name="l01286"></a>01286         <span class="keywordflow">return</span> s
<a name="l01287"></a>01287 
<a name="l01288"></a><a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#af4c8092474e4f3d93d53d32374e4c20c">01288</a>     <span class="keyword">def </span><a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html#af4c8092474e4f3d93d53d32374e4c20c">__repr__</a>(self):
<a name="l01289"></a>01289         <span class="keywordflow">return</span> <span class="stringliteral">&quot;LRItem(&quot;</span>+<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(self)+<span class="stringliteral">&quot;)&quot;</span>
<a name="l01290"></a>01290 
<a name="l01291"></a>01291 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01292"></a>01292 <span class="comment"># rightmost_terminal()</span>
<a name="l01293"></a>01293 <span class="comment">#</span>
<a name="l01294"></a>01294 <span class="comment"># Return the rightmost terminal from a list of symbols.  Used in add_production()</span>
<a name="l01295"></a>01295 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01296"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a551edfc68b91473f429fba16cbdbef03">01296</a> <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a551edfc68b91473f429fba16cbdbef03">rightmost_terminal</a>(symbols, terminals):
<a name="l01297"></a>01297     i = len(symbols) - 1
<a name="l01298"></a>01298     <span class="keywordflow">while</span> i &gt;= 0:
<a name="l01299"></a>01299         <span class="keywordflow">if</span> symbols[i] <span class="keywordflow">in</span> terminals:
<a name="l01300"></a>01300             <span class="keywordflow">return</span> symbols[i]
<a name="l01301"></a>01301         i -= 1
<a name="l01302"></a>01302     <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l01303"></a>01303 
<a name="l01304"></a>01304 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01305"></a>01305 <span class="comment">#                           === GRAMMAR CLASS ===</span>
<a name="l01306"></a>01306 <span class="comment">#</span>
<a name="l01307"></a>01307 <span class="comment"># The following class represents the contents of the specified grammar along</span>
<a name="l01308"></a>01308 <span class="comment"># with various computed properties such as first sets, follow sets, LR items, etc.</span>
<a name="l01309"></a>01309 <span class="comment"># This data is used for critical parts of the table generation process later.</span>
<a name="l01310"></a>01310 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01311"></a>01311 
<a name="l01312"></a><a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">01312</a> <span class="keyword">class </span><a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">YaccError</a>): <span class="keywordflow">pass</span>
<a name="l01313"></a>01313 
<a name="l01314"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html">01314</a> <span class="keyword">class</span> Grammar(object):
<a name="l01315"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aea65bb89b66e9a9a70ad0ff52061fbbb">01315</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a0b7d89348c7c808e4e5731cd6386a2d0">__init__</a>(self,terminals):
<a name="l01316"></a>01316         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>  = [<span class="keywordtype">None</span>]  <span class="comment"># A list of all of the productions.  The first</span>
<a name="l01317"></a>01317                                     <span class="comment"># entry is always reserved for the purpose of</span>
<a name="l01318"></a>01318                                     <span class="comment"># building an augmented grammar</span>
<a name="l01319"></a>01319 
<a name="l01320"></a>01320         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9ce85163a8522e86ae0376e88939709b">Prodnames</a>    = { }     <span class="comment"># A dictionary mapping the names of nonterminals to a list of all</span>
<a name="l01321"></a>01321                                     <span class="comment"># productions of that nonterminal.</span>
<a name="l01322"></a>01322 
<a name="l01323"></a>01323         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a7faa998ea594b337b6c7de2e87b017e4">Prodmap</a>      = { }     <span class="comment"># A dictionary that is only used to detect duplicate</span>
<a name="l01324"></a>01324                                     <span class="comment"># productions.</span>
<a name="l01325"></a>01325 
<a name="l01326"></a>01326         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>    = { }     <span class="comment"># A dictionary mapping the names of terminal symbols to a</span>
<a name="l01327"></a>01327                                     <span class="comment"># list of the rules where they are used.</span>
<a name="l01328"></a>01328 
<a name="l01329"></a>01329         <span class="keywordflow">for</span> term <span class="keywordflow">in</span> terminals:
<a name="l01330"></a>01330             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>[term] = []
<a name="l01331"></a>01331 
<a name="l01332"></a>01332         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>[<span class="stringliteral">&#39;error&#39;</span>] = []
<a name="l01333"></a>01333 
<a name="l01334"></a>01334         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a> = { }     <span class="comment"># A dictionary mapping names of nonterminals to a list</span>
<a name="l01335"></a>01335                                     <span class="comment"># of rule numbers where they are used.</span>
<a name="l01336"></a>01336 
<a name="l01337"></a>01337         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>        = { }     <span class="comment"># A dictionary of precomputed FIRST(x) symbols</span>
<a name="l01338"></a>01338 
<a name="l01339"></a>01339         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>       = { }     <span class="comment"># A dictionary of precomputed FOLLOW(x) symbols</span>
<a name="l01340"></a>01340 
<a name="l01341"></a>01341         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a5df6550f8c4488d480dc3a289d5f65fe">Precedence</a>   = { }     <span class="comment"># Precedence rules for each terminal. Contains tuples of the</span>
<a name="l01342"></a>01342                                     <span class="comment"># form (&#39;right&#39;,level) or (&#39;nonassoc&#39;, level) or (&#39;left&#39;,level)</span>
<a name="l01343"></a>01343 
<a name="l01344"></a>01344         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aea65bb89b66e9a9a70ad0ff52061fbbb">UsedPrecedence</a> = { }   <span class="comment"># Precedence rules that were actually used by the grammer.</span>
<a name="l01345"></a>01345                                     <span class="comment"># This is only used to provide error checking and to generate</span>
<a name="l01346"></a>01346                                     <span class="comment"># a warning about unused precedence rules.</span>
<a name="l01347"></a>01347 
<a name="l01348"></a>01348         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a5b9b422b10f0141562ffdb4fc5d972a5">Start</a> = <span class="keywordtype">None</span>           <span class="comment"># Starting symbol for the grammar</span>
<a name="l01349"></a>01349 
<a name="l01350"></a>01350 
<a name="l01351"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a4fb8093e00ec5306512f7d20d7c3f584">01351</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a4fb8093e00ec5306512f7d20d7c3f584">__len__</a>(self):
<a name="l01352"></a>01352         <span class="keywordflow">return</span> len(self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>)
<a name="l01353"></a>01353 
<a name="l01354"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a4d2cfaee1af52a73fd8214132e6fa810">01354</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a4d2cfaee1af52a73fd8214132e6fa810">__getitem__</a>(self,index):
<a name="l01355"></a>01355         <span class="keywordflow">return</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>[index]
<a name="l01356"></a>01356 
<a name="l01357"></a>01357     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01358"></a>01358     <span class="comment"># set_precedence()</span>
<a name="l01359"></a>01359     <span class="comment">#</span>
<a name="l01360"></a>01360     <span class="comment"># Sets the precedence for a given terminal. assoc is the associativity such as</span>
<a name="l01361"></a>01361     <span class="comment"># &#39;left&#39;,&#39;right&#39;, or &#39;nonassoc&#39;.  level is a numeric level.</span>
<a name="l01362"></a>01362     <span class="comment">#</span>
<a name="l01363"></a>01363     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01364"></a>01364 
<a name="l01365"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a41bd843e723fb4b392cfe9cde4fe504e">01365</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a41bd843e723fb4b392cfe9cde4fe504e">set_precedence</a>(self,term,assoc,level):
<a name="l01366"></a>01366         <span class="keyword">assert</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a> == [<span class="keywordtype">None</span>],<span class="stringliteral">&quot;Must call set_precedence() before add_production()&quot;</span>
<a name="l01367"></a>01367         <span class="keywordflow">if</span> term <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a5df6550f8c4488d480dc3a289d5f65fe">Precedence</a>:
<a name="l01368"></a>01368             <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;Precedence already specified for terminal &#39;%s&#39;&quot;</span> % term)
<a name="l01369"></a>01369         <span class="keywordflow">if</span> assoc <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;left&#39;</span>,<span class="stringliteral">&#39;right&#39;</span>,<span class="stringliteral">&#39;nonassoc&#39;</span>]:
<a name="l01370"></a>01370             <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;Associativity must be one of &#39;left&#39;,&#39;right&#39;, or &#39;nonassoc&#39;&quot;</span>)
<a name="l01371"></a>01371         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a5df6550f8c4488d480dc3a289d5f65fe">Precedence</a>[term] = (assoc,level)
<a name="l01372"></a>01372  
<a name="l01373"></a>01373     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01374"></a>01374     <span class="comment"># add_production()</span>
<a name="l01375"></a>01375     <span class="comment">#</span>
<a name="l01376"></a>01376     <span class="comment"># Given an action function, this function assembles a production rule and</span>
<a name="l01377"></a>01377     <span class="comment"># computes its precedence level.</span>
<a name="l01378"></a>01378     <span class="comment">#</span>
<a name="l01379"></a>01379     <span class="comment"># The production rule is supplied as a list of symbols.   For example,</span>
<a name="l01380"></a>01380     <span class="comment"># a rule such as &#39;expr : expr PLUS term&#39; has a production name of &#39;expr&#39; and</span>
<a name="l01381"></a>01381     <span class="comment"># symbols [&#39;expr&#39;,&#39;PLUS&#39;,&#39;term&#39;].</span>
<a name="l01382"></a>01382     <span class="comment">#</span>
<a name="l01383"></a>01383     <span class="comment"># Precedence is determined by the precedence of the right-most non-terminal</span>
<a name="l01384"></a>01384     <span class="comment"># or the precedence of a terminal specified by %prec.</span>
<a name="l01385"></a>01385     <span class="comment">#</span>
<a name="l01386"></a>01386     <span class="comment"># A variety of error checks are performed to make sure production symbols</span>
<a name="l01387"></a>01387     <span class="comment"># are valid and that %prec is used correctly.</span>
<a name="l01388"></a>01388     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01389"></a>01389 
<a name="l01390"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9447a4783eeb41d037a72707875668ab">01390</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9447a4783eeb41d037a72707875668ab">add_production</a>(self,prodname,syms,func=None,file=&#39;&#39;,line=0):
<a name="l01391"></a>01391 
<a name="l01392"></a>01392         <span class="keywordflow">if</span> prodname <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>:
<a name="l01393"></a>01393             <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Illegal rule name &#39;%s&#39;. Already defined as a token&quot;</span> % (file,line,prodname))
<a name="l01394"></a>01394         <span class="keywordflow">if</span> prodname == <span class="stringliteral">&#39;error&#39;</span>:
<a name="l01395"></a>01395             <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Illegal rule name &#39;%s&#39;. error is a reserved word&quot;</span> % (file,line,prodname))
<a name="l01396"></a>01396         <span class="keywordflow">if</span> <span class="keywordflow">not</span> _is_identifier.match(prodname):
<a name="l01397"></a>01397             <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Illegal rule name &#39;%s&#39;&quot;</span> % (file,line,prodname))
<a name="l01398"></a>01398 
<a name="l01399"></a>01399         <span class="comment"># Look for literal tokens </span>
<a name="l01400"></a>01400         <span class="keywordflow">for</span> n,s <span class="keywordflow">in</span> enumerate(syms):
<a name="l01401"></a>01401             <span class="keywordflow">if</span> s[0] <span class="keywordflow">in</span> <span class="stringliteral">&quot;&#39;\&quot;&quot;</span>:
<a name="l01402"></a>01402                  <span class="keywordflow">try</span>:
<a name="l01403"></a>01403                      c = eval(s)
<a name="l01404"></a>01404                      <span class="keywordflow">if</span> (len(c) &gt; 1):
<a name="l01405"></a>01405                           <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Literal token %s in rule &#39;%s&#39; may only be a single character&quot;</span> % (file,line,s, prodname))
<a name="l01406"></a>01406                      <span class="keywordflow">if</span> <span class="keywordflow">not</span> c <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>:
<a name="l01407"></a>01407                           self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>[c] = []
<a name="l01408"></a>01408                      syms[n] = c
<a name="l01409"></a>01409                      <span class="keywordflow">continue</span>
<a name="l01410"></a>01410                  <span class="keywordflow">except</span> SyntaxError:
<a name="l01411"></a>01411                      <span class="keywordflow">pass</span>
<a name="l01412"></a>01412             <span class="keywordflow">if</span> <span class="keywordflow">not</span> _is_identifier.match(s) <span class="keywordflow">and</span> s != <span class="stringliteral">&#39;%prec&#39;</span>:
<a name="l01413"></a>01413                 <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Illegal name &#39;%s&#39; in rule &#39;%s&#39;&quot;</span> % (file,line,s, prodname))
<a name="l01414"></a>01414         
<a name="l01415"></a>01415         <span class="comment"># Determine the precedence level</span>
<a name="l01416"></a>01416         <span class="keywordflow">if</span> <span class="stringliteral">&#39;%prec&#39;</span> <span class="keywordflow">in</span> syms:
<a name="l01417"></a>01417             <span class="keywordflow">if</span> syms[-1] == <span class="stringliteral">&#39;%prec&#39;</span>:
<a name="l01418"></a>01418                 <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Syntax error. Nothing follows %%prec&quot;</span> % (file,line))
<a name="l01419"></a>01419             <span class="keywordflow">if</span> syms[-2] != <span class="stringliteral">&#39;%prec&#39;</span>:
<a name="l01420"></a>01420                 <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Syntax error. %%prec can only appear at the end of a grammar rule&quot;</span> % (file,line))
<a name="l01421"></a>01421             precname = syms[-1]
<a name="l01422"></a>01422             prodprec = self.Precedence.get(precname,<span class="keywordtype">None</span>)
<a name="l01423"></a>01423             <span class="keywordflow">if</span> <span class="keywordflow">not</span> prodprec:
<a name="l01424"></a>01424                 <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Nothing known about the precedence of &#39;%s&#39;&quot;</span> % (file,line,precname))
<a name="l01425"></a>01425             <span class="keywordflow">else</span>:
<a name="l01426"></a>01426                 self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aea65bb89b66e9a9a70ad0ff52061fbbb">UsedPrecedence</a>[precname] = 1
<a name="l01427"></a>01427             del syms[-2:]     <span class="comment"># Drop %prec from the rule</span>
<a name="l01428"></a>01428         <span class="keywordflow">else</span>:
<a name="l01429"></a>01429             <span class="comment"># If no %prec, precedence is determined by the rightmost terminal symbol</span>
<a name="l01430"></a>01430             precname = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a551edfc68b91473f429fba16cbdbef03">rightmost_terminal</a>(syms,self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>)
<a name="l01431"></a>01431             prodprec = self.Precedence.get(precname,(<span class="stringliteral">&#39;right&#39;</span>,0)) 
<a name="l01432"></a>01432             
<a name="l01433"></a>01433         <span class="comment"># See if the rule is already in the rulemap</span>
<a name="l01434"></a>01434         map = <span class="stringliteral">&quot;%s -&gt; %s&quot;</span> % (prodname,syms)
<a name="l01435"></a>01435         <span class="keywordflow">if</span> map <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a7faa998ea594b337b6c7de2e87b017e4">Prodmap</a>:
<a name="l01436"></a>01436             m = self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a7faa998ea594b337b6c7de2e87b017e4">Prodmap</a>[map]
<a name="l01437"></a>01437             <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;%s:%d: Duplicate rule %s. &quot;</span> % (file,line, m) +
<a name="l01438"></a>01438                                <span class="stringliteral">&quot;Previous definition at %s:%d&quot;</span> % (m.file, m.line))
<a name="l01439"></a>01439 
<a name="l01440"></a>01440         <span class="comment"># From this point on, everything is valid.  Create a new Production instance</span>
<a name="l01441"></a>01441         pnumber  = len(self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>)
<a name="l01442"></a>01442         <span class="keywordflow">if</span> <span class="keywordflow">not</span> prodname <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>:
<a name="l01443"></a>01443             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>[prodname] = [ ]
<a name="l01444"></a>01444 
<a name="l01445"></a>01445         <span class="comment"># Add the production number to Terminals and Nonterminals</span>
<a name="l01446"></a>01446         <span class="keywordflow">for</span> t <span class="keywordflow">in</span> syms:
<a name="l01447"></a>01447             <span class="keywordflow">if</span> t <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>:
<a name="l01448"></a>01448                 self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>[t].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(pnumber)
<a name="l01449"></a>01449             <span class="keywordflow">else</span>:
<a name="l01450"></a>01450                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> t <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>:
<a name="l01451"></a>01451                     self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>[t] = [ ]
<a name="l01452"></a>01452                 self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>[t].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(pnumber)
<a name="l01453"></a>01453 
<a name="l01454"></a>01454         <span class="comment"># Create a production and add it to the list of productions</span>
<a name="l01455"></a>01455         p = <a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html">Production</a>(pnumber,prodname,syms,prodprec,func,file,line)
<a name="l01456"></a>01456         self.Productions.append(p)
<a name="l01457"></a>01457         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a7faa998ea594b337b6c7de2e87b017e4">Prodmap</a>[map] = p
<a name="l01458"></a>01458 
<a name="l01459"></a>01459         <span class="comment"># Add to the global productions list</span>
<a name="l01460"></a>01460         <span class="keywordflow">try</span>:
<a name="l01461"></a>01461             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9ce85163a8522e86ae0376e88939709b">Prodnames</a>[prodname].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(p)
<a name="l01462"></a>01462         <span class="keywordflow">except</span> KeyError:
<a name="l01463"></a>01463             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9ce85163a8522e86ae0376e88939709b">Prodnames</a>[prodname] = [ p ]
<a name="l01464"></a>01464         <span class="keywordflow">return</span> 0
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01467"></a>01467     <span class="comment"># set_start()</span>
<a name="l01468"></a>01468     <span class="comment">#</span>
<a name="l01469"></a>01469     <span class="comment"># Sets the starting symbol and creates the augmented grammar.  Production </span>
<a name="l01470"></a>01470     <span class="comment"># rule 0 is S&#39; -&gt; start where start is the start symbol.</span>
<a name="l01471"></a>01471     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01472"></a>01472 
<a name="l01473"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a7292ae73bdc9faa882a3694496cb34f8">01473</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a7292ae73bdc9faa882a3694496cb34f8">set_start</a>(self,start=None):
<a name="l01474"></a>01474         <span class="keywordflow">if</span> <span class="keywordflow">not</span> start:
<a name="l01475"></a>01475             start = self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>[1].name
<a name="l01476"></a>01476         <span class="keywordflow">if</span> start <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>:
<a name="l01477"></a>01477             <span class="keywordflow">raise</span> <a class="code" href="../../d9/d37/classply_1_1yacc_1_1_grammar_error.html">GrammarError</a>(<span class="stringliteral">&quot;start symbol %s undefined&quot;</span> % start)
<a name="l01478"></a>01478         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>[0] = <a class="code" href="../../d5/df4/classply_1_1yacc_1_1_production.html">Production</a>(0,<span class="stringliteral">&quot;S&#39;&quot;</span>,[start])
<a name="l01479"></a>01479         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>[start].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(0)
<a name="l01480"></a>01480         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a5b9b422b10f0141562ffdb4fc5d972a5">Start</a> = start
<a name="l01481"></a>01481 
<a name="l01482"></a>01482     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01483"></a>01483     <span class="comment"># find_unreachable()</span>
<a name="l01484"></a>01484     <span class="comment">#</span>
<a name="l01485"></a>01485     <span class="comment"># Find all of the nonterminal symbols that can&#39;t be reached from the starting</span>
<a name="l01486"></a>01486     <span class="comment"># symbol.  Returns a list of nonterminals that can&#39;t be reached.</span>
<a name="l01487"></a>01487     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01488"></a>01488 
<a name="l01489"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#abab6f458bd94ee09df25ced7cb302746">01489</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#abab6f458bd94ee09df25ced7cb302746">find_unreachable</a>(self):
<a name="l01490"></a>01490         
<a name="l01491"></a>01491         <span class="comment"># Mark all symbols that are reachable from a symbol s</span>
<a name="l01492"></a>01492         <span class="keyword">def </span>mark_reachable_from(s):
<a name="l01493"></a>01493             <span class="keywordflow">if</span> reachable[s]:
<a name="l01494"></a>01494                 <span class="comment"># We&#39;ve already reached symbol s.</span>
<a name="l01495"></a>01495                 <span class="keywordflow">return</span>
<a name="l01496"></a>01496             reachable[s] = 1
<a name="l01497"></a>01497             <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.Prodnames.get(s,[]):
<a name="l01498"></a>01498                 <span class="keywordflow">for</span> r <span class="keywordflow">in</span> p.prod:
<a name="l01499"></a>01499                     mark_reachable_from(r)
<a name="l01500"></a>01500 
<a name="l01501"></a>01501         reachable   = { }
<a name="l01502"></a>01502         <span class="keywordflow">for</span> s <span class="keywordflow">in</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>(self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>) + <a class="code" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>(self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>):
<a name="l01503"></a>01503             reachable[s] = 0
<a name="l01504"></a>01504 
<a name="l01505"></a>01505         mark_reachable_from( self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>[0].prod[0] )
<a name="l01506"></a>01506 
<a name="l01507"></a>01507         <span class="keywordflow">return</span> [s <span class="keywordflow">for</span> s <span class="keywordflow">in</span> <a class="code" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>(self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>)
<a name="l01508"></a>01508                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> reachable[s]]
<a name="l01509"></a>01509     
<a name="l01510"></a>01510     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01511"></a>01511     <span class="comment"># infinite_cycles()</span>
<a name="l01512"></a>01512     <span class="comment">#</span>
<a name="l01513"></a>01513     <span class="comment"># This function looks at the various parsing rules and tries to detect</span>
<a name="l01514"></a>01514     <span class="comment"># infinite recursion cycles (grammar rules where there is no possible way</span>
<a name="l01515"></a>01515     <span class="comment"># to derive a string of only terminals).</span>
<a name="l01516"></a>01516     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01517"></a>01517 
<a name="l01518"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac0fc3fa50bfb573485fb4ccda2c3e6aa">01518</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac0fc3fa50bfb573485fb4ccda2c3e6aa">infinite_cycles</a>(self):
<a name="l01519"></a>01519         terminates = {}
<a name="l01520"></a>01520 
<a name="l01521"></a>01521         <span class="comment"># Terminals:</span>
<a name="l01522"></a>01522         <span class="keywordflow">for</span> t <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>:
<a name="l01523"></a>01523             terminates[t] = 1
<a name="l01524"></a>01524 
<a name="l01525"></a>01525         terminates[<span class="stringliteral">&#39;$end&#39;</span>] = 1
<a name="l01526"></a>01526 
<a name="l01527"></a>01527         <span class="comment"># Nonterminals:</span>
<a name="l01528"></a>01528 
<a name="l01529"></a>01529         <span class="comment"># Initialize to false:</span>
<a name="l01530"></a>01530         <span class="keywordflow">for</span> n <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>:
<a name="l01531"></a>01531             terminates[n] = 0
<a name="l01532"></a>01532 
<a name="l01533"></a>01533         <span class="comment"># Then propagate termination until no change:</span>
<a name="l01534"></a>01534         <span class="keywordflow">while</span> 1:
<a name="l01535"></a>01535             some_change = 0
<a name="l01536"></a>01536             <span class="keywordflow">for</span> (n,pl) <span class="keywordflow">in</span> self.Prodnames.items():
<a name="l01537"></a>01537                 <span class="comment"># Nonterminal n terminates iff any of its productions terminates.</span>
<a name="l01538"></a>01538                 <span class="keywordflow">for</span> p <span class="keywordflow">in</span> pl:
<a name="l01539"></a>01539                     <span class="comment"># Production p terminates iff all of its rhs symbols terminate.</span>
<a name="l01540"></a>01540                     <span class="keywordflow">for</span> s <span class="keywordflow">in</span> p.prod:
<a name="l01541"></a>01541                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> terminates[s]:
<a name="l01542"></a>01542                             <span class="comment"># The symbol s does not terminate,</span>
<a name="l01543"></a>01543                             <span class="comment"># so production p does not terminate.</span>
<a name="l01544"></a>01544                             p_terminates = 0
<a name="l01545"></a>01545                             <span class="keywordflow">break</span>
<a name="l01546"></a>01546                     <span class="keywordflow">else</span>:
<a name="l01547"></a>01547                         <span class="comment"># didn&#39;t break from the loop,</span>
<a name="l01548"></a>01548                         <span class="comment"># so every symbol s terminates</span>
<a name="l01549"></a>01549                         <span class="comment"># so production p terminates.</span>
<a name="l01550"></a>01550                         p_terminates = 1
<a name="l01551"></a>01551 
<a name="l01552"></a>01552                     <span class="keywordflow">if</span> p_terminates:
<a name="l01553"></a>01553                         <span class="comment"># symbol n terminates!</span>
<a name="l01554"></a>01554                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> terminates[n]:
<a name="l01555"></a>01555                             terminates[n] = 1
<a name="l01556"></a>01556                             some_change = 1
<a name="l01557"></a>01557                         <span class="comment"># Don&#39;t need to consider any more productions for this n.</span>
<a name="l01558"></a>01558                         <span class="keywordflow">break</span>
<a name="l01559"></a>01559 
<a name="l01560"></a>01560             <span class="keywordflow">if</span> <span class="keywordflow">not</span> some_change:
<a name="l01561"></a>01561                 <span class="keywordflow">break</span>
<a name="l01562"></a>01562 
<a name="l01563"></a>01563         infinite = []
<a name="l01564"></a>01564         <span class="keywordflow">for</span> (s,term) <span class="keywordflow">in</span> terminates.items():
<a name="l01565"></a>01565             <span class="keywordflow">if</span> <span class="keywordflow">not</span> term:
<a name="l01566"></a>01566                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> s <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9ce85163a8522e86ae0376e88939709b">Prodnames</a> <span class="keywordflow">and</span> <span class="keywordflow">not</span> s <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a> <span class="keywordflow">and</span> s != <span class="stringliteral">&#39;error&#39;</span>:
<a name="l01567"></a>01567                     <span class="comment"># s is used-but-not-defined, and we&#39;ve already warned of that,</span>
<a name="l01568"></a>01568                     <span class="comment"># so it would be overkill to say that it&#39;s also non-terminating.</span>
<a name="l01569"></a>01569                     <span class="keywordflow">pass</span>
<a name="l01570"></a>01570                 <span class="keywordflow">else</span>:
<a name="l01571"></a>01571                     infinite.append(s)
<a name="l01572"></a>01572 
<a name="l01573"></a>01573         <span class="keywordflow">return</span> infinite
<a name="l01574"></a>01574 
<a name="l01575"></a>01575 
<a name="l01576"></a>01576     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01577"></a>01577     <span class="comment"># undefined_symbols()</span>
<a name="l01578"></a>01578     <span class="comment">#</span>
<a name="l01579"></a>01579     <span class="comment"># Find all symbols that were used the grammar, but not defined as tokens or</span>
<a name="l01580"></a>01580     <span class="comment"># grammar rules.  Returns a list of tuples (sym, prod) where sym in the symbol</span>
<a name="l01581"></a>01581     <span class="comment"># and prod is the production where the symbol was used. </span>
<a name="l01582"></a>01582     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01583"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a73919bf1fa1b4dd6d96b91cad80df786">01583</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a73919bf1fa1b4dd6d96b91cad80df786">undefined_symbols</a>(self):
<a name="l01584"></a>01584         result = []
<a name="l01585"></a>01585         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>:
<a name="l01586"></a>01586             <span class="keywordflow">if</span> <span class="keywordflow">not</span> p: <span class="keywordflow">continue</span>
<a name="l01587"></a>01587 
<a name="l01588"></a>01588             <span class="keywordflow">for</span> s <span class="keywordflow">in</span> p.prod:
<a name="l01589"></a>01589                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> s <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9ce85163a8522e86ae0376e88939709b">Prodnames</a> <span class="keywordflow">and</span> <span class="keywordflow">not</span> s <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a> <span class="keywordflow">and</span> s != <span class="stringliteral">&#39;error&#39;</span>:
<a name="l01590"></a>01590                     result.append((s,p))
<a name="l01591"></a>01591         <span class="keywordflow">return</span> result
<a name="l01592"></a>01592 
<a name="l01593"></a>01593     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01594"></a>01594     <span class="comment"># unused_terminals()</span>
<a name="l01595"></a>01595     <span class="comment">#</span>
<a name="l01596"></a>01596     <span class="comment"># Find all terminals that were defined, but not used by the grammar.  Returns</span>
<a name="l01597"></a>01597     <span class="comment"># a list of all symbols.</span>
<a name="l01598"></a>01598     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01599"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a32db3293574df28419c5ef1492c67670">01599</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a32db3293574df28419c5ef1492c67670">unused_terminals</a>(self):
<a name="l01600"></a>01600         unused_tok = []
<a name="l01601"></a>01601         <span class="keywordflow">for</span> s,v <span class="keywordflow">in</span> self.Terminals.items():
<a name="l01602"></a>01602             <span class="keywordflow">if</span> s != <span class="stringliteral">&#39;error&#39;</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> v:
<a name="l01603"></a>01603                 unused_tok.append(s)
<a name="l01604"></a>01604 
<a name="l01605"></a>01605         <span class="keywordflow">return</span> unused_tok
<a name="l01606"></a>01606 
<a name="l01607"></a>01607     <span class="comment"># ------------------------------------------------------------------------------</span>
<a name="l01608"></a>01608     <span class="comment"># unused_rules()</span>
<a name="l01609"></a>01609     <span class="comment">#</span>
<a name="l01610"></a>01610     <span class="comment"># Find all grammar rules that were defined,  but not used (maybe not reachable)</span>
<a name="l01611"></a>01611     <span class="comment"># Returns a list of productions.</span>
<a name="l01612"></a>01612     <span class="comment"># ------------------------------------------------------------------------------</span>
<a name="l01613"></a>01613 
<a name="l01614"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#af6cf1ee8fd6e804a799e09349f081356">01614</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#af6cf1ee8fd6e804a799e09349f081356">unused_rules</a>(self):
<a name="l01615"></a>01615         unused_prod = []
<a name="l01616"></a>01616         <span class="keywordflow">for</span> s,v <span class="keywordflow">in</span> self.Nonterminals.items():
<a name="l01617"></a>01617             <span class="keywordflow">if</span> <span class="keywordflow">not</span> v:
<a name="l01618"></a>01618                 p = self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9ce85163a8522e86ae0376e88939709b">Prodnames</a>[s][0]
<a name="l01619"></a>01619                 unused_prod.append(p)
<a name="l01620"></a>01620         <span class="keywordflow">return</span> unused_prod
<a name="l01621"></a>01621 
<a name="l01622"></a>01622     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01623"></a>01623     <span class="comment"># unused_precedence()</span>
<a name="l01624"></a>01624     <span class="comment">#</span>
<a name="l01625"></a>01625     <span class="comment"># Returns a list of tuples (term,precedence) corresponding to precedence</span>
<a name="l01626"></a>01626     <span class="comment"># rules that were never used by the grammar.  term is the name of the terminal</span>
<a name="l01627"></a>01627     <span class="comment"># on which precedence was applied and precedence is a string such as &#39;left&#39; or</span>
<a name="l01628"></a>01628     <span class="comment"># &#39;right&#39; corresponding to the type of precedence. </span>
<a name="l01629"></a>01629     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01630"></a>01630 
<a name="l01631"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#abe2530d8a65c40139d1400c6dd5cdc6a">01631</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#abe2530d8a65c40139d1400c6dd5cdc6a">unused_precedence</a>(self):
<a name="l01632"></a>01632         unused = []
<a name="l01633"></a>01633         <span class="keywordflow">for</span> termname <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a5df6550f8c4488d480dc3a289d5f65fe">Precedence</a>:
<a name="l01634"></a>01634             <span class="keywordflow">if</span> <span class="keywordflow">not</span> (termname <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a> <span class="keywordflow">or</span> termname <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aea65bb89b66e9a9a70ad0ff52061fbbb">UsedPrecedence</a>):
<a name="l01635"></a>01635                 unused.append((termname,self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a5df6550f8c4488d480dc3a289d5f65fe">Precedence</a>[termname][0]))
<a name="l01636"></a>01636                 
<a name="l01637"></a>01637         <span class="keywordflow">return</span> unused
<a name="l01638"></a>01638 
<a name="l01639"></a>01639     <span class="comment"># -------------------------------------------------------------------------</span>
<a name="l01640"></a>01640     <span class="comment"># _first()</span>
<a name="l01641"></a>01641     <span class="comment">#</span>
<a name="l01642"></a>01642     <span class="comment"># Compute the value of FIRST1(beta) where beta is a tuple of symbols.</span>
<a name="l01643"></a>01643     <span class="comment">#</span>
<a name="l01644"></a>01644     <span class="comment"># During execution of compute_first1, the result may be incomplete.</span>
<a name="l01645"></a>01645     <span class="comment"># Afterward (e.g., when called from compute_follow()), it will be complete.</span>
<a name="l01646"></a>01646     <span class="comment"># -------------------------------------------------------------------------</span>
<a name="l01647"></a>01647     <span class="keyword">def </span>_first(self,beta):
<a name="l01648"></a>01648 
<a name="l01649"></a>01649         <span class="comment"># We are computing First(x1,x2,x3,...,xn)</span>
<a name="l01650"></a>01650         result = [ ]
<a name="l01651"></a>01651         <span class="keywordflow">for</span> x <span class="keywordflow">in</span> beta:
<a name="l01652"></a>01652             x_produces_empty = 0
<a name="l01653"></a>01653 
<a name="l01654"></a>01654             <span class="comment"># Add all the non-&lt;empty&gt; symbols of First[x] to the result.</span>
<a name="l01655"></a>01655             <span class="keywordflow">for</span> f <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>[x]:
<a name="l01656"></a>01656                 <span class="keywordflow">if</span> f == <span class="stringliteral">&#39;&lt;empty&gt;&#39;</span>:
<a name="l01657"></a>01657                     x_produces_empty = 1
<a name="l01658"></a>01658                 <span class="keywordflow">else</span>:
<a name="l01659"></a>01659                     <span class="keywordflow">if</span> f <span class="keywordflow">not</span> <span class="keywordflow">in</span> result: result.append(f)
<a name="l01660"></a>01660 
<a name="l01661"></a>01661             <span class="keywordflow">if</span> x_produces_empty:
<a name="l01662"></a>01662                 <span class="comment"># We have to consider the next x in beta,</span>
<a name="l01663"></a>01663                 <span class="comment"># i.e. stay in the loop.</span>
<a name="l01664"></a>01664                 <span class="keywordflow">pass</span>
<a name="l01665"></a>01665             <span class="keywordflow">else</span>:
<a name="l01666"></a>01666                 <span class="comment"># We don&#39;t have to consider any further symbols in beta.</span>
<a name="l01667"></a>01667                 <span class="keywordflow">break</span>
<a name="l01668"></a>01668         <span class="keywordflow">else</span>:
<a name="l01669"></a>01669             <span class="comment"># There was no &#39;break&#39; from the loop,</span>
<a name="l01670"></a>01670             <span class="comment"># so x_produces_empty was true for all x in beta,</span>
<a name="l01671"></a>01671             <span class="comment"># so beta produces empty as well.</span>
<a name="l01672"></a>01672             result.append(<span class="stringliteral">&#39;&lt;empty&gt;&#39;</span>)
<a name="l01673"></a>01673 
<a name="l01674"></a>01674         <span class="keywordflow">return</span> result
<a name="l01675"></a>01675 
<a name="l01676"></a>01676     <span class="comment"># -------------------------------------------------------------------------</span>
<a name="l01677"></a>01677     <span class="comment"># compute_first()</span>
<a name="l01678"></a>01678     <span class="comment">#</span>
<a name="l01679"></a>01679     <span class="comment"># Compute the value of FIRST1(X) for all symbols</span>
<a name="l01680"></a>01680     <span class="comment"># -------------------------------------------------------------------------</span>
<a name="l01681"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a034f6f9fd6c3752ede24717617ab7829">01681</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a034f6f9fd6c3752ede24717617ab7829">compute_first</a>(self):
<a name="l01682"></a>01682         <span class="keywordflow">if</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>:
<a name="l01683"></a>01683             <span class="keywordflow">return</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>
<a name="l01684"></a>01684 
<a name="l01685"></a>01685         <span class="comment"># Terminals:</span>
<a name="l01686"></a>01686         <span class="keywordflow">for</span> t <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ac9a1ace28c90bc577f54a9889c5d9b8f">Terminals</a>:
<a name="l01687"></a>01687             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>[t] = [t]
<a name="l01688"></a>01688 
<a name="l01689"></a>01689         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>[<span class="stringliteral">&#39;$end&#39;</span>] = [<span class="stringliteral">&#39;$end&#39;</span>]
<a name="l01690"></a>01690 
<a name="l01691"></a>01691         <span class="comment"># Nonterminals:</span>
<a name="l01692"></a>01692 
<a name="l01693"></a>01693         <span class="comment"># Initialize to the empty set:</span>
<a name="l01694"></a>01694         <span class="keywordflow">for</span> n <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>:
<a name="l01695"></a>01695             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>[n] = []
<a name="l01696"></a>01696 
<a name="l01697"></a>01697         <span class="comment"># Then propagate symbols until no change:</span>
<a name="l01698"></a>01698         <span class="keywordflow">while</span> 1:
<a name="l01699"></a>01699             some_change = 0
<a name="l01700"></a>01700             <span class="keywordflow">for</span> n <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>:
<a name="l01701"></a>01701                 <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9ce85163a8522e86ae0376e88939709b">Prodnames</a>[n]:
<a name="l01702"></a>01702                     <span class="keywordflow">for</span> f <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a7d8070a5561e73cef466fdae82ee91e6">_first</a>(p.prod):
<a name="l01703"></a>01703                         <span class="keywordflow">if</span> f <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>[n]:
<a name="l01704"></a>01704                             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>[n].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>( f )
<a name="l01705"></a>01705                             some_change = 1
<a name="l01706"></a>01706             <span class="keywordflow">if</span> <span class="keywordflow">not</span> some_change:
<a name="l01707"></a>01707                 <span class="keywordflow">break</span>
<a name="l01708"></a>01708         
<a name="l01709"></a>01709         <span class="keywordflow">return</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>
<a name="l01710"></a>01710 
<a name="l01711"></a>01711     <span class="comment"># ---------------------------------------------------------------------</span>
<a name="l01712"></a>01712     <span class="comment"># compute_follow()</span>
<a name="l01713"></a>01713     <span class="comment">#</span>
<a name="l01714"></a>01714     <span class="comment"># Computes all of the follow sets for every non-terminal symbol.  The</span>
<a name="l01715"></a>01715     <span class="comment"># follow set is the set of all symbols that might follow a given</span>
<a name="l01716"></a>01716     <span class="comment"># non-terminal.  See the Dragon book, 2nd Ed. p. 189.</span>
<a name="l01717"></a>01717     <span class="comment"># ---------------------------------------------------------------------</span>
<a name="l01718"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a607985c8b766fda9f9b783bb9d1b2a81">01718</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a607985c8b766fda9f9b783bb9d1b2a81">compute_follow</a>(self,start=None):
<a name="l01719"></a>01719         <span class="comment"># If already computed, return the result</span>
<a name="l01720"></a>01720         <span class="keywordflow">if</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>:
<a name="l01721"></a>01721             <span class="keywordflow">return</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>
<a name="l01722"></a>01722 
<a name="l01723"></a>01723         <span class="comment"># If first sets not computed yet, do that first.</span>
<a name="l01724"></a>01724         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3989fd4bc33412c31ffe6d97bf01afdc">First</a>:
<a name="l01725"></a>01725             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a034f6f9fd6c3752ede24717617ab7829">compute_first</a>()
<a name="l01726"></a>01726 
<a name="l01727"></a>01727         <span class="comment"># Add &#39;$end&#39; to the follow list of the start symbol</span>
<a name="l01728"></a>01728         <span class="keywordflow">for</span> k <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>:
<a name="l01729"></a>01729             self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>[k] = [ ]
<a name="l01730"></a>01730 
<a name="l01731"></a>01731         <span class="keywordflow">if</span> <span class="keywordflow">not</span> start:
<a name="l01732"></a>01732             start = self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>[1].name
<a name="l01733"></a>01733 
<a name="l01734"></a>01734         self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>[start] = [ <span class="stringliteral">&#39;$end&#39;</span> ]
<a name="l01735"></a>01735 
<a name="l01736"></a>01736         <span class="keywordflow">while</span> 1:
<a name="l01737"></a>01737             didadd = 0
<a name="l01738"></a>01738             <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>[1:]:
<a name="l01739"></a>01739                 <span class="comment"># Here is the production set</span>
<a name="l01740"></a>01740                 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(p.prod)):
<a name="l01741"></a>01741                     B = p.prod[i]
<a name="l01742"></a>01742                     <span class="keywordflow">if</span> B <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#aef6b262029476955ff9e84105da5642f">Nonterminals</a>:
<a name="l01743"></a>01743                         <span class="comment"># Okay. We got a non-terminal in a production</span>
<a name="l01744"></a>01744                         fst = self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a7d8070a5561e73cef466fdae82ee91e6">_first</a>(p.prod[i+1:])
<a name="l01745"></a>01745                         hasempty = 0
<a name="l01746"></a>01746                         <span class="keywordflow">for</span> f <span class="keywordflow">in</span> fst:
<a name="l01747"></a>01747                             <span class="keywordflow">if</span> f != <span class="stringliteral">&#39;&lt;empty&gt;&#39;</span> <span class="keywordflow">and</span> f <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>[B]:
<a name="l01748"></a>01748                                 self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>[B].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(f)
<a name="l01749"></a>01749                                 didadd = 1
<a name="l01750"></a>01750                             <span class="keywordflow">if</span> f == <span class="stringliteral">&#39;&lt;empty&gt;&#39;</span>:
<a name="l01751"></a>01751                                 hasempty = 1
<a name="l01752"></a>01752                         <span class="keywordflow">if</span> hasempty <span class="keywordflow">or</span> i == (len(p.prod)-1):
<a name="l01753"></a>01753                             <span class="comment"># Add elements of follow(a) to follow(b)</span>
<a name="l01754"></a>01754                             <span class="keywordflow">for</span> f <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>[p.name]:
<a name="l01755"></a>01755                                 <span class="keywordflow">if</span> f <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>[B]:
<a name="l01756"></a>01756                                     self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>[B].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(f)
<a name="l01757"></a>01757                                     didadd = 1
<a name="l01758"></a>01758             <span class="keywordflow">if</span> <span class="keywordflow">not</span> didadd: <span class="keywordflow">break</span>
<a name="l01759"></a>01759         <span class="keywordflow">return</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a3ee311b8653b2db2511b1c528ce30f47">Follow</a>
<a name="l01760"></a>01760 
<a name="l01761"></a>01761 
<a name="l01762"></a>01762     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01763"></a>01763     <span class="comment"># build_lritems()</span>
<a name="l01764"></a>01764     <span class="comment">#</span>
<a name="l01765"></a>01765     <span class="comment"># This function walks the list of productions and builds a complete set of the</span>
<a name="l01766"></a>01766     <span class="comment"># LR items.  The LR items are stored in two ways:  First, they are uniquely</span>
<a name="l01767"></a>01767     <span class="comment"># numbered and placed in the list _lritems.  Second, a linked list of LR items</span>
<a name="l01768"></a>01768     <span class="comment"># is built for each production.  For example:</span>
<a name="l01769"></a>01769     <span class="comment">#</span>
<a name="l01770"></a>01770     <span class="comment">#   E -&gt; E PLUS E</span>
<a name="l01771"></a>01771     <span class="comment">#</span>
<a name="l01772"></a>01772     <span class="comment"># Creates the list</span>
<a name="l01773"></a>01773     <span class="comment">#</span>
<a name="l01774"></a>01774     <span class="comment">#  [E -&gt; . E PLUS E, E -&gt; E . PLUS E, E -&gt; E PLUS . E, E -&gt; E PLUS E . ]</span>
<a name="l01775"></a>01775     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01776"></a>01776 
<a name="l01777"></a><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ab773f12036a98f6e205e8a872942ab78">01777</a>     <span class="keyword">def </span><a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ab773f12036a98f6e205e8a872942ab78">build_lritems</a>(self):
<a name="l01778"></a>01778         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#ad0f454b10841bfc71fd1dd0f18e0b22a">Productions</a>:
<a name="l01779"></a>01779             lastlri = p
<a name="l01780"></a>01780             i = 0
<a name="l01781"></a>01781             lr_items = []
<a name="l01782"></a>01782             <span class="keywordflow">while</span> 1:
<a name="l01783"></a>01783                 <span class="keywordflow">if</span> i &gt; len(p):
<a name="l01784"></a>01784                     lri = <span class="keywordtype">None</span>
<a name="l01785"></a>01785                 <span class="keywordflow">else</span>:
<a name="l01786"></a>01786                     lri = <a class="code" href="../../d6/d5a/classply_1_1yacc_1_1_l_r_item.html">LRItem</a>(p,i)
<a name="l01787"></a>01787                     <span class="comment"># Precompute the list of productions immediately following</span>
<a name="l01788"></a>01788                     <span class="keywordflow">try</span>:
<a name="l01789"></a>01789                         lri.lr_after = self.<a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html#a9ce85163a8522e86ae0376e88939709b">Prodnames</a>[lri.prod[i+1]]
<a name="l01790"></a>01790                     <span class="keywordflow">except</span> (IndexError,KeyError):
<a name="l01791"></a>01791                         lri.lr_after = []
<a name="l01792"></a>01792                     <span class="keywordflow">try</span>:
<a name="l01793"></a>01793                         lri.lr_before = lri.prod[i-1]
<a name="l01794"></a>01794                     <span class="keywordflow">except</span> IndexError:
<a name="l01795"></a>01795                         lri.lr_before = <span class="keywordtype">None</span>
<a name="l01796"></a>01796 
<a name="l01797"></a>01797                 lastlri.lr_next = lri
<a name="l01798"></a>01798                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> lri: <span class="keywordflow">break</span>
<a name="l01799"></a>01799                 lr_items.append(lri)
<a name="l01800"></a>01800                 lastlri = lri
<a name="l01801"></a>01801                 i += 1
<a name="l01802"></a>01802             p.lr_items = lr_items
<a name="l01803"></a>01803 
<a name="l01804"></a>01804 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01805"></a>01805 <span class="comment">#                            == Class LRTable ==</span>
<a name="l01806"></a>01806 <span class="comment">#</span>
<a name="l01807"></a>01807 <span class="comment"># This basic class represents a basic table of LR parsing information.  </span>
<a name="l01808"></a>01808 <span class="comment"># Methods for generating the tables are not defined here.  They are defined</span>
<a name="l01809"></a>01809 <span class="comment"># in the derived class LRGeneratedTable.</span>
<a name="l01810"></a>01810 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01811"></a>01811 
<a name="l01812"></a><a class="code" href="../../d1/d94/classply_1_1yacc_1_1_version_error.html">01812</a> <span class="keyword">class </span><a class="code" href="../../d1/d94/classply_1_1yacc_1_1_version_error.html">VersionError</a>(<a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">YaccError</a>): <span class="keywordflow">pass</span>
<a name="l01813"></a>01813 
<a name="l01814"></a><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html">01814</a> <span class="keyword">class</span> LRTable(object):
<a name="l01815"></a><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a8cbdfd82da85dfa4606609420944f267">01815</a>     <span class="keyword">def </span><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a13b392648f1d03d190f677d21e7391e7">__init__</a>(self):
<a name="l01816"></a>01816         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a663c2683533acc0bcf7ca0620183433e">lr_action</a> = <span class="keywordtype">None</span>
<a name="l01817"></a>01817         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a0c248e4556701644811ec9466712ea20">lr_goto</a> = <span class="keywordtype">None</span>
<a name="l01818"></a>01818         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a8cbdfd82da85dfa4606609420944f267">lr_productions</a> = <span class="keywordtype">None</span>
<a name="l01819"></a>01819         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a2cdba85d2754b0266ea67293ba484693">lr_method</a> = <span class="keywordtype">None</span>
<a name="l01820"></a>01820 
<a name="l01821"></a><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a96e55694c2c4f8728ebc37ac2999e65f">01821</a>     <span class="keyword">def </span><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a96e55694c2c4f8728ebc37ac2999e65f">read_table</a>(self,module):
<a name="l01822"></a>01822         <span class="keywordflow">if</span> isinstance(module,types.ModuleType):
<a name="l01823"></a>01823             parsetab = module
<a name="l01824"></a>01824         <span class="keywordflow">else</span>:
<a name="l01825"></a>01825             <span class="keywordflow">if</span> sys.version_info[0] &lt; 3:
<a name="l01826"></a>01826                 <a class="code" href="../../dd/dfd/build__stage_2email_2shared_2test_2integration_2profile__builder_8js.html#a2f76ddb4f47454e20c129320c48d846d">exec</a>(<span class="stringliteral">&quot;import %s as parsetab&quot;</span> % module)
<a name="l01827"></a>01827             <span class="keywordflow">else</span>:
<a name="l01828"></a>01828                 env = { }
<a name="l01829"></a>01829                 <a class="code" href="../../dd/dfd/build__stage_2email_2shared_2test_2integration_2profile__builder_8js.html#a2f76ddb4f47454e20c129320c48d846d">exec</a>(<span class="stringliteral">&quot;import %s as parsetab&quot;</span> % module, env, env)
<a name="l01830"></a>01830                 parsetab = env[<span class="stringliteral">&#39;parsetab&#39;</span>]
<a name="l01831"></a>01831 
<a name="l01832"></a>01832         <span class="keywordflow">if</span> parsetab._tabversion != __tabversion__:
<a name="l01833"></a>01833             <span class="keywordflow">raise</span> <a class="code" href="../../d1/d94/classply_1_1yacc_1_1_version_error.html">VersionError</a>(<span class="stringliteral">&quot;yacc table file version is out of date&quot;</span>)
<a name="l01834"></a>01834 
<a name="l01835"></a>01835         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a663c2683533acc0bcf7ca0620183433e">lr_action</a> = parsetab._lr_action
<a name="l01836"></a>01836         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a0c248e4556701644811ec9466712ea20">lr_goto</a> = parsetab._lr_goto
<a name="l01837"></a>01837 
<a name="l01838"></a>01838         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a8cbdfd82da85dfa4606609420944f267">lr_productions</a> = []
<a name="l01839"></a>01839         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> parsetab._lr_productions:
<a name="l01840"></a>01840             self.lr_productions.append(<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html">MiniProduction</a>(*p))
<a name="l01841"></a>01841 
<a name="l01842"></a>01842         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a2cdba85d2754b0266ea67293ba484693">lr_method</a> = parsetab._lr_method
<a name="l01843"></a>01843         <span class="keywordflow">return</span> parsetab._lr_signature
<a name="l01844"></a>01844 
<a name="l01845"></a><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a607c5f68d7459232825c255c273175a7">01845</a>     <span class="keyword">def </span><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a607c5f68d7459232825c255c273175a7">read_pickle</a>(self,filename):
<a name="l01846"></a>01846         <span class="keywordflow">try</span>:
<a name="l01847"></a>01847             <span class="keyword">import</span> cPickle <span class="keyword">as</span> pickle
<a name="l01848"></a>01848         <span class="keywordflow">except</span> ImportError:
<a name="l01849"></a>01849             <span class="keyword">import</span> pickle
<a name="l01850"></a>01850 
<a name="l01851"></a>01851         in_f = <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(filename,<span class="stringliteral">&quot;rb&quot;</span>)
<a name="l01852"></a>01852 
<a name="l01853"></a>01853         tabversion = pickle.load(in_f)
<a name="l01854"></a>01854         <span class="keywordflow">if</span> tabversion != __tabversion__:
<a name="l01855"></a>01855             <span class="keywordflow">raise</span> <a class="code" href="../../d1/d94/classply_1_1yacc_1_1_version_error.html">VersionError</a>(<span class="stringliteral">&quot;yacc table file version is out of date&quot;</span>)
<a name="l01856"></a>01856         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a2cdba85d2754b0266ea67293ba484693">lr_method</a> = pickle.load(in_f)
<a name="l01857"></a>01857         signature      = pickle.load(in_f)
<a name="l01858"></a>01858         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a663c2683533acc0bcf7ca0620183433e">lr_action</a> = pickle.load(in_f)
<a name="l01859"></a>01859         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a0c248e4556701644811ec9466712ea20">lr_goto</a>   = pickle.load(in_f)
<a name="l01860"></a>01860         productions    = pickle.load(in_f)
<a name="l01861"></a>01861 
<a name="l01862"></a>01862         self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a8cbdfd82da85dfa4606609420944f267">lr_productions</a> = []
<a name="l01863"></a>01863         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> productions:
<a name="l01864"></a>01864             self.lr_productions.append(<a class="code" href="../../d4/d7b/classply_1_1yacc_1_1_mini_production.html">MiniProduction</a>(*p))
<a name="l01865"></a>01865 
<a name="l01866"></a>01866         in_f.close()
<a name="l01867"></a>01867         <span class="keywordflow">return</span> signature
<a name="l01868"></a>01868 
<a name="l01869"></a>01869     <span class="comment"># Bind all production function names to callable objects in pdict</span>
<a name="l01870"></a><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a33ce7f48fe6aca9fd381e8d4daf4a8fd">01870</a>     <span class="keyword">def </span><a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a33ce7f48fe6aca9fd381e8d4daf4a8fd">bind_callables</a>(self,pdict):
<a name="l01871"></a>01871         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html#a8cbdfd82da85dfa4606609420944f267">lr_productions</a>:
<a name="l01872"></a>01872             p.bind(pdict)
<a name="l01873"></a>01873     
<a name="l01874"></a>01874 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01875"></a>01875 <span class="comment">#                           === LR Generator ===</span>
<a name="l01876"></a>01876 <span class="comment">#</span>
<a name="l01877"></a>01877 <span class="comment"># The following classes and functions are used to generate LR parsing tables on </span>
<a name="l01878"></a>01878 <span class="comment"># a grammar.</span>
<a name="l01879"></a>01879 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01880"></a>01880 
<a name="l01881"></a>01881 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01882"></a>01882 <span class="comment"># digraph()</span>
<a name="l01883"></a>01883 <span class="comment"># traverse()</span>
<a name="l01884"></a>01884 <span class="comment">#</span>
<a name="l01885"></a>01885 <span class="comment"># The following two functions are used to compute set valued functions</span>
<a name="l01886"></a>01886 <span class="comment"># of the form:</span>
<a name="l01887"></a>01887 <span class="comment">#</span>
<a name="l01888"></a>01888 <span class="comment">#     F(x) = F&#39;(x) U U{F(y) | x R y}</span>
<a name="l01889"></a>01889 <span class="comment">#</span>
<a name="l01890"></a>01890 <span class="comment"># This is used to compute the values of Read() sets as well as FOLLOW sets</span>
<a name="l01891"></a>01891 <span class="comment"># in LALR(1) generation.</span>
<a name="l01892"></a>01892 <span class="comment">#</span>
<a name="l01893"></a>01893 <span class="comment"># Inputs:  X    - An input set</span>
<a name="l01894"></a>01894 <span class="comment">#          R    - A relation</span>
<a name="l01895"></a>01895 <span class="comment">#          FP   - Set-valued function</span>
<a name="l01896"></a>01896 <span class="comment"># ------------------------------------------------------------------------------</span>
<a name="l01897"></a>01897 
<a name="l01898"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#afb4cd446fffbf54b478a20ac54db7f15">01898</a> <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#afb4cd446fffbf54b478a20ac54db7f15">digraph</a>(X,R,FP):
<a name="l01899"></a>01899     N = { }
<a name="l01900"></a>01900     <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X:
<a name="l01901"></a>01901        N[x] = 0
<a name="l01902"></a>01902     stack = []
<a name="l01903"></a>01903     F = { }
<a name="l01904"></a>01904     <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X:
<a name="l01905"></a>01905         <span class="keywordflow">if</span> N[x] == 0: <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a753467831b0e96858831748e8c8e7af9">traverse</a>(x,N,stack,F,X,R,FP)
<a name="l01906"></a>01906     <span class="keywordflow">return</span> F
<a name="l01907"></a>01907 
<a name="l01908"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a753467831b0e96858831748e8c8e7af9">01908</a> <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a753467831b0e96858831748e8c8e7af9">traverse</a>(x,N,stack,F,X,R,FP):
<a name="l01909"></a>01909     stack.append(x)
<a name="l01910"></a>01910     d = len(stack)
<a name="l01911"></a>01911     N[x] = d
<a name="l01912"></a>01912     F[x] = FP(x)             <span class="comment"># F(X) &lt;- F&#39;(x)</span>
<a name="l01913"></a>01913 
<a name="l01914"></a>01914     rel = R(x)               <span class="comment"># Get y&#39;s related to x</span>
<a name="l01915"></a>01915     <span class="keywordflow">for</span> y <span class="keywordflow">in</span> rel:
<a name="l01916"></a>01916         <span class="keywordflow">if</span> N[y] == 0:
<a name="l01917"></a>01917              <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a753467831b0e96858831748e8c8e7af9">traverse</a>(y,N,stack,F,X,R,FP)
<a name="l01918"></a>01918         N[x] = <a class="code" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#aad36546e8175d2922bee165fe028fedc">min</a>(N[x],N[y])
<a name="l01919"></a>01919         <span class="keywordflow">for</span> a <span class="keywordflow">in</span> F.get(y,[]):
<a name="l01920"></a>01920             <span class="keywordflow">if</span> a <span class="keywordflow">not</span> <span class="keywordflow">in</span> F[x]: F[x].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(a)
<a name="l01921"></a>01921     <span class="keywordflow">if</span> N[x] == d:
<a name="l01922"></a>01922        N[stack[-1]] = MAXINT
<a name="l01923"></a>01923        F[stack[-1]] = F[x]
<a name="l01924"></a>01924        element = stack.pop()
<a name="l01925"></a>01925        <span class="keywordflow">while</span> element != x:
<a name="l01926"></a>01926            N[stack[-1]] = MAXINT
<a name="l01927"></a>01927            F[stack[-1]] = F[x]
<a name="l01928"></a>01928            element = stack.pop()
<a name="l01929"></a>01929 
<a name="l01930"></a><a class="code" href="../../d3/d83/classply_1_1yacc_1_1_l_a_l_r_error.html">01930</a> <span class="keyword">class </span><a class="code" href="../../d3/d83/classply_1_1yacc_1_1_l_a_l_r_error.html">LALRError</a>(<a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">YaccError</a>): <span class="keywordflow">pass</span>
<a name="l01931"></a>01931 
<a name="l01932"></a>01932 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01933"></a>01933 <span class="comment">#                             == LRGeneratedTable ==</span>
<a name="l01934"></a>01934 <span class="comment">#</span>
<a name="l01935"></a>01935 <span class="comment"># This class implements the LR table generation algorithm.  There are no</span>
<a name="l01936"></a>01936 <span class="comment"># public methods except for write()</span>
<a name="l01937"></a>01937 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l01938"></a>01938 
<a name="l01939"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html">01939</a> <span class="keyword">class</span> LRGeneratedTable(LRTable):
<a name="l01940"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ad5f17eeaa1a395afd46dcb73f22a7f55">01940</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a0799fb745eaf21cf44389003f41c24ce">__init__</a>(self,grammar,method=&#39;LALR&#39;,log=None):
<a name="l01941"></a>01941         <span class="keywordflow">if</span> method <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;SLR&#39;</span>,<span class="stringliteral">&#39;LALR&#39;</span>]:
<a name="l01942"></a>01942             <span class="keywordflow">raise</span> <a class="code" href="../../d3/d83/classply_1_1yacc_1_1_l_a_l_r_error.html">LALRError</a>(<span class="stringliteral">&quot;Unsupported method %s&quot;</span> % method)
<a name="l01943"></a>01943 
<a name="l01944"></a>01944         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a> = grammar
<a name="l01945"></a>01945         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a9c9cda8b5f756356117f9051a52f92e5">lr_method</a> = method
<a name="l01946"></a>01946 
<a name="l01947"></a>01947         <span class="comment"># Set up the logger</span>
<a name="l01948"></a>01948         <span class="keywordflow">if</span> <span class="keywordflow">not</span> log:
<a name="l01949"></a>01949             log = <a class="code" href="../../da/d0e/classply_1_1yacc_1_1_null_logger.html">NullLogger</a>()
<a name="l01950"></a>01950         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a7ec61acd6e84bb4e9d9f30ece21bef20">log</a> = log
<a name="l01951"></a>01951 
<a name="l01952"></a>01952         <span class="comment"># Internal attributes</span>
<a name="l01953"></a>01953         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a4b6fb6d9ddf90906fd1236eadf9b43b2">lr_action</a>     = {}        <span class="comment"># Action table</span>
<a name="l01954"></a>01954         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ab7de7d19c9c5e175b91825f0c0c7148e">lr_goto</a>       = {}        <span class="comment"># Goto table</span>
<a name="l01955"></a>01955         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#adeb13037a87416fd811da735618702f9">lr_productions</a>  = grammar.Productions    <span class="comment"># Copy of grammar Production array</span>
<a name="l01956"></a>01956         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a65c17ad82921f80bfa38b9dc41fadd50">lr_goto_cache</a> = {}        <span class="comment"># Cache of computed gotos</span>
<a name="l01957"></a>01957         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ab82e152cdf15aa0e191ddff594bbfdd5">lr0_cidhash</a>   = {}        <span class="comment"># Cache of closures</span>
<a name="l01958"></a>01958 
<a name="l01959"></a>01959         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a2dff74a2faed5b715a0820ef804bc1a2">_add_count</a>    = 0         <span class="comment"># Internal counter used to detect cycles</span>
<a name="l01960"></a>01960 
<a name="l01961"></a>01961         <span class="comment"># Diagonistic information filled in by the table generator</span>
<a name="l01962"></a>01962         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a474713e3a8f8d49ddcecffc3cec2ab8b">sr_conflict</a>   = 0
<a name="l01963"></a>01963         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a2fc03c3690c619158a4be4596311d86a">rr_conflict</a>   = 0
<a name="l01964"></a>01964         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a1b87d6db18168ae9a38047ea1394a8d6">conflicts</a>     = []        <span class="comment"># List of conflicts</span>
<a name="l01965"></a>01965 
<a name="l01966"></a>01966         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ad5f17eeaa1a395afd46dcb73f22a7f55">sr_conflicts</a>  = []
<a name="l01967"></a>01967         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ae7ed1c9e80ced80667cb01ffd5019d92">rr_conflicts</a>  = []
<a name="l01968"></a>01968 
<a name="l01969"></a>01969         <span class="comment"># Build the tables</span>
<a name="l01970"></a>01970         self.grammar.build_lritems()
<a name="l01971"></a>01971         self.grammar.compute_first()
<a name="l01972"></a>01972         self.grammar.compute_follow()
<a name="l01973"></a>01973         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a548eb88f53ecbb01d21adbf164ff53ed">lr_parse_table</a>()
<a name="l01974"></a>01974 
<a name="l01975"></a>01975     <span class="comment"># Compute the LR(0) closure operation on I, where I is a set of LR(0) items.</span>
<a name="l01976"></a>01976 
<a name="l01977"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a63374d5187eea6460fe7e4c12e01a6c6">01977</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a63374d5187eea6460fe7e4c12e01a6c6">lr0_closure</a>(self,I):
<a name="l01978"></a>01978         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a2dff74a2faed5b715a0820ef804bc1a2">_add_count</a> += 1
<a name="l01979"></a>01979 
<a name="l01980"></a>01980         <span class="comment"># Add everything in I to J</span>
<a name="l01981"></a>01981         J = I[:]
<a name="l01982"></a>01982         didadd = 1
<a name="l01983"></a>01983         <span class="keywordflow">while</span> didadd:
<a name="l01984"></a>01984             didadd = 0
<a name="l01985"></a>01985             <span class="keywordflow">for</span> j <span class="keywordflow">in</span> J:
<a name="l01986"></a>01986                 <span class="keywordflow">for</span> x <span class="keywordflow">in</span> j.lr_after:
<a name="l01987"></a>01987                     <span class="keywordflow">if</span> getattr(x,<span class="stringliteral">&quot;lr0_added&quot;</span>,0) == self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a2dff74a2faed5b715a0820ef804bc1a2">_add_count</a>: <span class="keywordflow">continue</span>
<a name="l01988"></a>01988                     <span class="comment"># Add B --&gt; .G to J</span>
<a name="l01989"></a>01989                     J.append(x.lr_next)
<a name="l01990"></a>01990                     x.lr0_added = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a2dff74a2faed5b715a0820ef804bc1a2">_add_count</a>
<a name="l01991"></a>01991                     didadd = 1
<a name="l01992"></a>01992 
<a name="l01993"></a>01993         <span class="keywordflow">return</span> J
<a name="l01994"></a>01994 
<a name="l01995"></a>01995     <span class="comment"># Compute the LR(0) goto function goto(I,X) where I is a set</span>
<a name="l01996"></a>01996     <span class="comment"># of LR(0) items and X is a grammar symbol.   This function is written</span>
<a name="l01997"></a>01997     <span class="comment"># in a way that guarantees uniqueness of the generated goto sets</span>
<a name="l01998"></a>01998     <span class="comment"># (i.e. the same goto set will never be returned as two different Python</span>
<a name="l01999"></a>01999     <span class="comment"># objects).  With uniqueness, we can later do fast set comparisons using</span>
<a name="l02000"></a>02000     <span class="comment"># id(obj) instead of element-wise comparison.</span>
<a name="l02001"></a>02001 
<a name="l02002"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a36280125fa4a55e7c77fea65cdb77961">02002</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a36280125fa4a55e7c77fea65cdb77961">lr0_goto</a>(self,I,x):
<a name="l02003"></a>02003         <span class="comment"># First we look for a previously cached entry</span>
<a name="l02004"></a>02004         g = self.lr_goto_cache.get((<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(I),x),<span class="keywordtype">None</span>)
<a name="l02005"></a>02005         <span class="keywordflow">if</span> g: <span class="keywordflow">return</span> g
<a name="l02006"></a>02006 
<a name="l02007"></a>02007         <span class="comment"># Now we generate the goto set in a way that guarantees uniqueness</span>
<a name="l02008"></a>02008         <span class="comment"># of the result</span>
<a name="l02009"></a>02009 
<a name="l02010"></a>02010         s = self.lr_goto_cache.get(x,<span class="keywordtype">None</span>)
<a name="l02011"></a>02011         <span class="keywordflow">if</span> <span class="keywordflow">not</span> s:
<a name="l02012"></a>02012             s = { }
<a name="l02013"></a>02013             self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a65c17ad82921f80bfa38b9dc41fadd50">lr_goto_cache</a>[x] = s
<a name="l02014"></a>02014 
<a name="l02015"></a>02015         gs = [ ]
<a name="l02016"></a>02016         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> I:
<a name="l02017"></a>02017             n = p.lr_next
<a name="l02018"></a>02018             <span class="keywordflow">if</span> n <span class="keywordflow">and</span> n.lr_before == x:
<a name="l02019"></a>02019                 s1 = s.get(<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(n),<span class="keywordtype">None</span>)
<a name="l02020"></a>02020                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> s1:
<a name="l02021"></a>02021                     s1 = { }
<a name="l02022"></a>02022                     s[<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(n)] = s1
<a name="l02023"></a>02023                 gs.append(n)
<a name="l02024"></a>02024                 s = s1
<a name="l02025"></a>02025         g = s.get(<span class="stringliteral">&#39;$end&#39;</span>,<span class="keywordtype">None</span>)
<a name="l02026"></a>02026         <span class="keywordflow">if</span> <span class="keywordflow">not</span> g:
<a name="l02027"></a>02027             <span class="keywordflow">if</span> gs:
<a name="l02028"></a>02028                 g = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a63374d5187eea6460fe7e4c12e01a6c6">lr0_closure</a>(gs)
<a name="l02029"></a>02029                 s[<span class="stringliteral">&#39;$end&#39;</span>] = g
<a name="l02030"></a>02030             <span class="keywordflow">else</span>:
<a name="l02031"></a>02031                 s[<span class="stringliteral">&#39;$end&#39;</span>] = gs
<a name="l02032"></a>02032         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a65c17ad82921f80bfa38b9dc41fadd50">lr_goto_cache</a>[(<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(I),x)] = g
<a name="l02033"></a>02033         <span class="keywordflow">return</span> g
<a name="l02034"></a>02034 
<a name="l02035"></a>02035     <span class="comment"># Compute the LR(0) sets of item function</span>
<a name="l02036"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ad5f070fa3a226c3d58349a249090c4fb">02036</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ad5f070fa3a226c3d58349a249090c4fb">lr0_items</a>(self):
<a name="l02037"></a>02037 
<a name="l02038"></a>02038         C = [ self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a63374d5187eea6460fe7e4c12e01a6c6">lr0_closure</a>([self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Productions[0].lr_next]) ]
<a name="l02039"></a>02039         i = 0
<a name="l02040"></a>02040         <span class="keywordflow">for</span> I <span class="keywordflow">in</span> C:
<a name="l02041"></a>02041             self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ab82e152cdf15aa0e191ddff594bbfdd5">lr0_cidhash</a>[<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(I)] = i
<a name="l02042"></a>02042             i += 1
<a name="l02043"></a>02043 
<a name="l02044"></a>02044         <span class="comment"># Loop over the items in C and each grammar symbols</span>
<a name="l02045"></a>02045         i = 0
<a name="l02046"></a>02046         <span class="keywordflow">while</span> i &lt; len(C):
<a name="l02047"></a>02047             I = C[i]
<a name="l02048"></a>02048             i += 1
<a name="l02049"></a>02049 
<a name="l02050"></a>02050             <span class="comment"># Collect all of the symbols that could possibly be in the goto(I,X) sets</span>
<a name="l02051"></a>02051             asyms = { }
<a name="l02052"></a>02052             <span class="keywordflow">for</span> ii <span class="keywordflow">in</span> I:
<a name="l02053"></a>02053                 <span class="keywordflow">for</span> s <span class="keywordflow">in</span> ii.usyms:
<a name="l02054"></a>02054                     asyms[s] = <span class="keywordtype">None</span>
<a name="l02055"></a>02055 
<a name="l02056"></a>02056             <span class="keywordflow">for</span> x <span class="keywordflow">in</span> asyms:
<a name="l02057"></a>02057                 g = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a36280125fa4a55e7c77fea65cdb77961">lr0_goto</a>(I,x)
<a name="l02058"></a>02058                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> g:  <span class="keywordflow">continue</span>
<a name="l02059"></a>02059                 <span class="keywordflow">if</span> <a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(g) <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ab82e152cdf15aa0e191ddff594bbfdd5">lr0_cidhash</a>: <span class="keywordflow">continue</span>
<a name="l02060"></a>02060                 self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ab82e152cdf15aa0e191ddff594bbfdd5">lr0_cidhash</a>[<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(g)] = len(C)
<a name="l02061"></a>02061                 C.append(g)
<a name="l02062"></a>02062 
<a name="l02063"></a>02063         <span class="keywordflow">return</span> C
<a name="l02064"></a>02064 
<a name="l02065"></a>02065     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02066"></a>02066     <span class="comment">#                       ==== LALR(1) Parsing ====</span>
<a name="l02067"></a>02067     <span class="comment">#</span>
<a name="l02068"></a>02068     <span class="comment"># LALR(1) parsing is almost exactly the same as SLR except that instead of</span>
<a name="l02069"></a>02069     <span class="comment"># relying upon Follow() sets when performing reductions, a more selective</span>
<a name="l02070"></a>02070     <span class="comment"># lookahead set that incorporates the state of the LR(0) machine is utilized.</span>
<a name="l02071"></a>02071     <span class="comment"># Thus, we mainly just have to focus on calculating the lookahead sets.</span>
<a name="l02072"></a>02072     <span class="comment">#</span>
<a name="l02073"></a>02073     <span class="comment"># The method used here is due to DeRemer and Pennelo (1982).</span>
<a name="l02074"></a>02074     <span class="comment">#</span>
<a name="l02075"></a>02075     <span class="comment"># DeRemer, F. L., and T. J. Pennelo: &quot;Efficient Computation of LALR(1)</span>
<a name="l02076"></a>02076     <span class="comment">#     Lookahead Sets&quot;, ACM Transactions on Programming Languages and Systems,</span>
<a name="l02077"></a>02077     <span class="comment">#     Vol. 4, No. 4, Oct. 1982, pp. 615-649</span>
<a name="l02078"></a>02078     <span class="comment">#</span>
<a name="l02079"></a>02079     <span class="comment"># Further details can also be found in:</span>
<a name="l02080"></a>02080     <span class="comment">#</span>
<a name="l02081"></a>02081     <span class="comment">#  J. Tremblay and P. Sorenson, &quot;The Theory and Practice of Compiler Writing&quot;,</span>
<a name="l02082"></a>02082     <span class="comment">#      McGraw-Hill Book Company, (1985).</span>
<a name="l02083"></a>02083     <span class="comment">#</span>
<a name="l02084"></a>02084     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02085"></a>02085 
<a name="l02086"></a>02086     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02087"></a>02087     <span class="comment"># compute_nullable_nonterminals()</span>
<a name="l02088"></a>02088     <span class="comment">#</span>
<a name="l02089"></a>02089     <span class="comment"># Creates a dictionary containing all of the non-terminals that might produce</span>
<a name="l02090"></a>02090     <span class="comment"># an empty production.</span>
<a name="l02091"></a>02091     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02092"></a>02092 
<a name="l02093"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a5ac3ea4ac9870ea5690e1db401108067">02093</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a5ac3ea4ac9870ea5690e1db401108067">compute_nullable_nonterminals</a>(self):
<a name="l02094"></a>02094         nullable = {}
<a name="l02095"></a>02095         num_nullable = 0
<a name="l02096"></a>02096         <span class="keywordflow">while</span> 1:
<a name="l02097"></a>02097            <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Productions[1:]:
<a name="l02098"></a>02098                <span class="keywordflow">if</span> p.len == 0:
<a name="l02099"></a>02099                     nullable[p.name] = 1
<a name="l02100"></a>02100                     <span class="keywordflow">continue</span>
<a name="l02101"></a>02101                <span class="keywordflow">for</span> t <span class="keywordflow">in</span> p.prod:
<a name="l02102"></a>02102                     <span class="keywordflow">if</span> <span class="keywordflow">not</span> t <span class="keywordflow">in</span> nullable: <span class="keywordflow">break</span>
<a name="l02103"></a>02103                <span class="keywordflow">else</span>:
<a name="l02104"></a>02104                     nullable[p.name] = 1
<a name="l02105"></a>02105            <span class="keywordflow">if</span> len(nullable) == num_nullable: <span class="keywordflow">break</span>
<a name="l02106"></a>02106            num_nullable = len(nullable)
<a name="l02107"></a>02107         <span class="keywordflow">return</span> nullable
<a name="l02108"></a>02108 
<a name="l02109"></a>02109     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02110"></a>02110     <span class="comment"># find_nonterminal_trans(C)</span>
<a name="l02111"></a>02111     <span class="comment">#</span>
<a name="l02112"></a>02112     <span class="comment"># Given a set of LR(0) items, this functions finds all of the non-terminal</span>
<a name="l02113"></a>02113     <span class="comment"># transitions.    These are transitions in which a dot appears immediately before</span>
<a name="l02114"></a>02114     <span class="comment"># a non-terminal.   Returns a list of tuples of the form (state,N) where state</span>
<a name="l02115"></a>02115     <span class="comment"># is the state number and N is the nonterminal symbol.</span>
<a name="l02116"></a>02116     <span class="comment">#</span>
<a name="l02117"></a>02117     <span class="comment"># The input C is the set of LR(0) items.</span>
<a name="l02118"></a>02118     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02119"></a>02119 
<a name="l02120"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a21524677535ec064318adbcc85d42747">02120</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a21524677535ec064318adbcc85d42747">find_nonterminal_transitions</a>(self,C):
<a name="l02121"></a>02121          trans = []
<a name="l02122"></a>02122          <span class="keywordflow">for</span> state <span class="keywordflow">in</span> range(len(C)):
<a name="l02123"></a>02123              <span class="keywordflow">for</span> p <span class="keywordflow">in</span> C[state]:
<a name="l02124"></a>02124                  <span class="keywordflow">if</span> p.lr_index &lt; p.len - 1:
<a name="l02125"></a>02125                       t = (state,p.prod[p.lr_index+1])
<a name="l02126"></a>02126                       <span class="keywordflow">if</span> t[1] <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Nonterminals:
<a name="l02127"></a>02127                             <span class="keywordflow">if</span> t <span class="keywordflow">not</span> <span class="keywordflow">in</span> trans: trans.append(t)
<a name="l02128"></a>02128              state = state + 1
<a name="l02129"></a>02129          <span class="keywordflow">return</span> trans
<a name="l02130"></a>02130 
<a name="l02131"></a>02131     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02132"></a>02132     <span class="comment"># dr_relation()</span>
<a name="l02133"></a>02133     <span class="comment">#</span>
<a name="l02134"></a>02134     <span class="comment"># Computes the DR(p,A) relationships for non-terminal transitions.  The input</span>
<a name="l02135"></a>02135     <span class="comment"># is a tuple (state,N) where state is a number and N is a nonterminal symbol.</span>
<a name="l02136"></a>02136     <span class="comment">#</span>
<a name="l02137"></a>02137     <span class="comment"># Returns a list of terminals.</span>
<a name="l02138"></a>02138     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02139"></a>02139 
<a name="l02140"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a765303c7895714e6f63223c44078017f">02140</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a765303c7895714e6f63223c44078017f">dr_relation</a>(self,C,trans,nullable):
<a name="l02141"></a>02141         dr_set = { }
<a name="l02142"></a>02142         state,N = trans
<a name="l02143"></a>02143         terms = []
<a name="l02144"></a>02144 
<a name="l02145"></a>02145         g = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a36280125fa4a55e7c77fea65cdb77961">lr0_goto</a>(C[state],N)
<a name="l02146"></a>02146         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> g:
<a name="l02147"></a>02147            <span class="keywordflow">if</span> p.lr_index &lt; p.len - 1:
<a name="l02148"></a>02148                a = p.prod[p.lr_index+1]
<a name="l02149"></a>02149                <span class="keywordflow">if</span> a <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Terminals:
<a name="l02150"></a>02150                    <span class="keywordflow">if</span> a <span class="keywordflow">not</span> <span class="keywordflow">in</span> terms: terms.append(a)
<a name="l02151"></a>02151 
<a name="l02152"></a>02152         <span class="comment"># This extra bit is to handle the start state</span>
<a name="l02153"></a>02153         <span class="keywordflow">if</span> state == 0 <span class="keywordflow">and</span> N == self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Productions[0].prod[0]:
<a name="l02154"></a>02154            terms.append(<span class="stringliteral">&#39;$end&#39;</span>)
<a name="l02155"></a>02155 
<a name="l02156"></a>02156         <span class="keywordflow">return</span> terms
<a name="l02157"></a>02157 
<a name="l02158"></a>02158     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02159"></a>02159     <span class="comment"># reads_relation()</span>
<a name="l02160"></a>02160     <span class="comment">#</span>
<a name="l02161"></a>02161     <span class="comment"># Computes the READS() relation (p,A) READS (t,C).</span>
<a name="l02162"></a>02162     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02163"></a>02163 
<a name="l02164"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ad2fd92ea95904eb789afa75d18eb5343">02164</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ad2fd92ea95904eb789afa75d18eb5343">reads_relation</a>(self,C, trans, empty):
<a name="l02165"></a>02165         <span class="comment"># Look for empty transitions</span>
<a name="l02166"></a>02166         rel = []
<a name="l02167"></a>02167         state, N = trans
<a name="l02168"></a>02168 
<a name="l02169"></a>02169         g = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a36280125fa4a55e7c77fea65cdb77961">lr0_goto</a>(C[state],N)
<a name="l02170"></a>02170         j = self.lr0_cidhash.get(<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(g),-1)
<a name="l02171"></a>02171         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> g:
<a name="l02172"></a>02172             <span class="keywordflow">if</span> p.lr_index &lt; p.len - 1:
<a name="l02173"></a>02173                  a = p.prod[p.lr_index + 1]
<a name="l02174"></a>02174                  <span class="keywordflow">if</span> a <span class="keywordflow">in</span> empty:
<a name="l02175"></a>02175                       rel.append((j,a))
<a name="l02176"></a>02176 
<a name="l02177"></a>02177         <span class="keywordflow">return</span> rel
<a name="l02178"></a>02178 
<a name="l02179"></a>02179     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02180"></a>02180     <span class="comment"># compute_lookback_includes()</span>
<a name="l02181"></a>02181     <span class="comment">#</span>
<a name="l02182"></a>02182     <span class="comment"># Determines the lookback and includes relations</span>
<a name="l02183"></a>02183     <span class="comment">#</span>
<a name="l02184"></a>02184     <span class="comment"># LOOKBACK:</span>
<a name="l02185"></a>02185     <span class="comment">#</span>
<a name="l02186"></a>02186     <span class="comment"># This relation is determined by running the LR(0) state machine forward.</span>
<a name="l02187"></a>02187     <span class="comment"># For example, starting with a production &quot;N : . A B C&quot;, we run it forward</span>
<a name="l02188"></a>02188     <span class="comment"># to obtain &quot;N : A B C .&quot;   We then build a relationship between this final</span>
<a name="l02189"></a>02189     <span class="comment"># state and the starting state.   These relationships are stored in a dictionary</span>
<a name="l02190"></a>02190     <span class="comment"># lookdict.</span>
<a name="l02191"></a>02191     <span class="comment">#</span>
<a name="l02192"></a>02192     <span class="comment"># INCLUDES:</span>
<a name="l02193"></a>02193     <span class="comment">#</span>
<a name="l02194"></a>02194     <span class="comment"># Computes the INCLUDE() relation (p,A) INCLUDES (p&#39;,B).</span>
<a name="l02195"></a>02195     <span class="comment">#</span>
<a name="l02196"></a>02196     <span class="comment"># This relation is used to determine non-terminal transitions that occur</span>
<a name="l02197"></a>02197     <span class="comment"># inside of other non-terminal transition states.   (p,A) INCLUDES (p&#39;, B)</span>
<a name="l02198"></a>02198     <span class="comment"># if the following holds:</span>
<a name="l02199"></a>02199     <span class="comment">#</span>
<a name="l02200"></a>02200     <span class="comment">#       B -&gt; LAT, where T -&gt; epsilon and p&#39; -L-&gt; p</span>
<a name="l02201"></a>02201     <span class="comment">#</span>
<a name="l02202"></a>02202     <span class="comment"># L is essentially a prefix (which may be empty), T is a suffix that must be</span>
<a name="l02203"></a>02203     <span class="comment"># able to derive an empty string.  State p&#39; must lead to state p with the string L.</span>
<a name="l02204"></a>02204     <span class="comment">#</span>
<a name="l02205"></a>02205     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02206"></a>02206 
<a name="l02207"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a48df924cf7762aef02c949a0ef1595a3">02207</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a48df924cf7762aef02c949a0ef1595a3">compute_lookback_includes</a>(self,C,trans,nullable):
<a name="l02208"></a>02208 
<a name="l02209"></a>02209         lookdict = {}          <span class="comment"># Dictionary of lookback relations</span>
<a name="l02210"></a>02210         includedict = {}       <span class="comment"># Dictionary of include relations</span>
<a name="l02211"></a>02211 
<a name="l02212"></a>02212         <span class="comment"># Make a dictionary of non-terminal transitions</span>
<a name="l02213"></a>02213         dtrans = {}
<a name="l02214"></a>02214         <span class="keywordflow">for</span> t <span class="keywordflow">in</span> trans:
<a name="l02215"></a>02215             dtrans[t] = 1
<a name="l02216"></a>02216 
<a name="l02217"></a>02217         <span class="comment"># Loop over all transitions and compute lookbacks and includes</span>
<a name="l02218"></a>02218         <span class="keywordflow">for</span> state,N <span class="keywordflow">in</span> trans:
<a name="l02219"></a>02219             lookb = []
<a name="l02220"></a>02220             includes = []
<a name="l02221"></a>02221             <span class="keywordflow">for</span> p <span class="keywordflow">in</span> C[state]:
<a name="l02222"></a>02222                 <span class="keywordflow">if</span> p.name != N: <span class="keywordflow">continue</span>
<a name="l02223"></a>02223 
<a name="l02224"></a>02224                 <span class="comment"># Okay, we have a name match.  We now follow the production all the way</span>
<a name="l02225"></a>02225                 <span class="comment"># through the state machine until we get the . on the right hand side</span>
<a name="l02226"></a>02226 
<a name="l02227"></a>02227                 lr_index = p.lr_index
<a name="l02228"></a>02228                 j = state
<a name="l02229"></a>02229                 <span class="keywordflow">while</span> lr_index &lt; p.len - 1:
<a name="l02230"></a>02230                      lr_index = lr_index + 1
<a name="l02231"></a>02231                      t = p.prod[lr_index]
<a name="l02232"></a>02232 
<a name="l02233"></a>02233                      <span class="comment"># Check to see if this symbol and state are a non-terminal transition</span>
<a name="l02234"></a>02234                      <span class="keywordflow">if</span> (j,t) <span class="keywordflow">in</span> dtrans:
<a name="l02235"></a>02235                            <span class="comment"># Yes.  Okay, there is some chance that this is an includes relation</span>
<a name="l02236"></a>02236                            <span class="comment"># the only way to know for certain is whether the rest of the</span>
<a name="l02237"></a>02237                            <span class="comment"># production derives empty</span>
<a name="l02238"></a>02238 
<a name="l02239"></a>02239                            li = lr_index + 1
<a name="l02240"></a>02240                            <span class="keywordflow">while</span> li &lt; p.len:
<a name="l02241"></a>02241                                 <span class="keywordflow">if</span> p.prod[li] <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Terminals: <span class="keywordflow">break</span>      <span class="comment"># No forget it</span>
<a name="l02242"></a>02242                                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> p.prod[li] <span class="keywordflow">in</span> nullable: <span class="keywordflow">break</span>
<a name="l02243"></a>02243                                 li = li + 1
<a name="l02244"></a>02244                            <span class="keywordflow">else</span>:
<a name="l02245"></a>02245                                 <span class="comment"># Appears to be a relation between (j,t) and (state,N)</span>
<a name="l02246"></a>02246                                 includes.append((j,t))
<a name="l02247"></a>02247 
<a name="l02248"></a>02248                      g = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a36280125fa4a55e7c77fea65cdb77961">lr0_goto</a>(C[j],t)               <span class="comment"># Go to next set</span>
<a name="l02249"></a>02249                      j = self.lr0_cidhash.get(<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(g),-1)     <span class="comment"># Go to next state</span>
<a name="l02250"></a>02250 
<a name="l02251"></a>02251                 <span class="comment"># When we get here, j is the final state, now we have to locate the production</span>
<a name="l02252"></a>02252                 <span class="keywordflow">for</span> r <span class="keywordflow">in</span> C[j]:
<a name="l02253"></a>02253                      <span class="keywordflow">if</span> r.name != p.name: <span class="keywordflow">continue</span>
<a name="l02254"></a>02254                      <span class="keywordflow">if</span> r.len != p.len:   <span class="keywordflow">continue</span>
<a name="l02255"></a>02255                      i = 0
<a name="l02256"></a>02256                      <span class="comment"># This look is comparing a production &quot;. A B C&quot; with &quot;A B C .&quot;</span>
<a name="l02257"></a>02257                      <span class="keywordflow">while</span> i &lt; r.lr_index:
<a name="l02258"></a>02258                           <span class="keywordflow">if</span> r.prod[i] != p.prod[i+1]: <span class="keywordflow">break</span>
<a name="l02259"></a>02259                           i = i + 1
<a name="l02260"></a>02260                      <span class="keywordflow">else</span>:
<a name="l02261"></a>02261                           lookb.append((j,r))
<a name="l02262"></a>02262             <span class="keywordflow">for</span> i <span class="keywordflow">in</span> includes:
<a name="l02263"></a>02263                  <span class="keywordflow">if</span> <span class="keywordflow">not</span> i <span class="keywordflow">in</span> includedict: includedict[i] = []
<a name="l02264"></a>02264                  includedict[i].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>((state,N))
<a name="l02265"></a>02265             lookdict[(state,N)] = lookb
<a name="l02266"></a>02266 
<a name="l02267"></a>02267         <span class="keywordflow">return</span> lookdict,includedict
<a name="l02268"></a>02268 
<a name="l02269"></a>02269     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02270"></a>02270     <span class="comment"># compute_read_sets()</span>
<a name="l02271"></a>02271     <span class="comment">#</span>
<a name="l02272"></a>02272     <span class="comment"># Given a set of LR(0) items, this function computes the read sets.</span>
<a name="l02273"></a>02273     <span class="comment">#</span>
<a name="l02274"></a>02274     <span class="comment"># Inputs:  C        =  Set of LR(0) items</span>
<a name="l02275"></a>02275     <span class="comment">#          ntrans   = Set of nonterminal transitions</span>
<a name="l02276"></a>02276     <span class="comment">#          nullable = Set of empty transitions</span>
<a name="l02277"></a>02277     <span class="comment">#</span>
<a name="l02278"></a>02278     <span class="comment"># Returns a set containing the read sets</span>
<a name="l02279"></a>02279     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02280"></a>02280 
<a name="l02281"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#aa0a66d55357fee23808addeedaa016a0">02281</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#aa0a66d55357fee23808addeedaa016a0">compute_read_sets</a>(self,C, ntrans, nullable):
<a name="l02282"></a>02282         FP = <span class="keyword">lambda</span> x: self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a765303c7895714e6f63223c44078017f">dr_relation</a>(C,x,nullable)
<a name="l02283"></a>02283         R =  <span class="keyword">lambda</span> x: self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ad2fd92ea95904eb789afa75d18eb5343">reads_relation</a>(C,x,nullable)
<a name="l02284"></a>02284         F = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#afb4cd446fffbf54b478a20ac54db7f15">digraph</a>(ntrans,R,FP)
<a name="l02285"></a>02285         <span class="keywordflow">return</span> F
<a name="l02286"></a>02286 
<a name="l02287"></a>02287     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02288"></a>02288     <span class="comment"># compute_follow_sets()</span>
<a name="l02289"></a>02289     <span class="comment">#</span>
<a name="l02290"></a>02290     <span class="comment"># Given a set of LR(0) items, a set of non-terminal transitions, a readset,</span>
<a name="l02291"></a>02291     <span class="comment"># and an include set, this function computes the follow sets</span>
<a name="l02292"></a>02292     <span class="comment">#</span>
<a name="l02293"></a>02293     <span class="comment"># Follow(p,A) = Read(p,A) U U {Follow(p&#39;,B) | (p,A) INCLUDES (p&#39;,B)}</span>
<a name="l02294"></a>02294     <span class="comment">#</span>
<a name="l02295"></a>02295     <span class="comment"># Inputs:</span>
<a name="l02296"></a>02296     <span class="comment">#            ntrans     = Set of nonterminal transitions</span>
<a name="l02297"></a>02297     <span class="comment">#            readsets   = Readset (previously computed)</span>
<a name="l02298"></a>02298     <span class="comment">#            inclsets   = Include sets (previously computed)</span>
<a name="l02299"></a>02299     <span class="comment">#</span>
<a name="l02300"></a>02300     <span class="comment"># Returns a set containing the follow sets</span>
<a name="l02301"></a>02301     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02302"></a>02302 
<a name="l02303"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a454fa63801e226bdc9350481e4d240d4">02303</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a454fa63801e226bdc9350481e4d240d4">compute_follow_sets</a>(self,ntrans,readsets,inclsets):
<a name="l02304"></a>02304          FP = <span class="keyword">lambda</span> x: readsets[x]
<a name="l02305"></a>02305          R  = <span class="keyword">lambda</span> x: inclsets.get(x,[])
<a name="l02306"></a>02306          F = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#afb4cd446fffbf54b478a20ac54db7f15">digraph</a>(ntrans,R,FP)
<a name="l02307"></a>02307          <span class="keywordflow">return</span> F
<a name="l02308"></a>02308 
<a name="l02309"></a>02309     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02310"></a>02310     <span class="comment"># add_lookaheads()</span>
<a name="l02311"></a>02311     <span class="comment">#</span>
<a name="l02312"></a>02312     <span class="comment"># Attaches the lookahead symbols to grammar rules.</span>
<a name="l02313"></a>02313     <span class="comment">#</span>
<a name="l02314"></a>02314     <span class="comment"># Inputs:    lookbacks         -  Set of lookback relations</span>
<a name="l02315"></a>02315     <span class="comment">#            followset         -  Computed follow set</span>
<a name="l02316"></a>02316     <span class="comment">#</span>
<a name="l02317"></a>02317     <span class="comment"># This function directly attaches the lookaheads to productions contained</span>
<a name="l02318"></a>02318     <span class="comment"># in the lookbacks set</span>
<a name="l02319"></a>02319     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02320"></a>02320 
<a name="l02321"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a6e1526e9fc0fa8433bb73df175627605">02321</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a6e1526e9fc0fa8433bb73df175627605">add_lookaheads</a>(self,lookbacks,followset):
<a name="l02322"></a>02322         <span class="keywordflow">for</span> trans,lb <span class="keywordflow">in</span> lookbacks.items():
<a name="l02323"></a>02323             <span class="comment"># Loop over productions in lookback</span>
<a name="l02324"></a>02324             <span class="keywordflow">for</span> state,p <span class="keywordflow">in</span> lb:
<a name="l02325"></a>02325                  <span class="keywordflow">if</span> <span class="keywordflow">not</span> state <span class="keywordflow">in</span> p.lookaheads:
<a name="l02326"></a>02326                       p.lookaheads[state] = []
<a name="l02327"></a>02327                  f = followset.get(trans,[])
<a name="l02328"></a>02328                  <span class="keywordflow">for</span> a <span class="keywordflow">in</span> f:
<a name="l02329"></a>02329                       <span class="keywordflow">if</span> a <span class="keywordflow">not</span> <span class="keywordflow">in</span> p.lookaheads[state]: p.lookaheads[state].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(a)
<a name="l02330"></a>02330 
<a name="l02331"></a>02331     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02332"></a>02332     <span class="comment"># add_lalr_lookaheads()</span>
<a name="l02333"></a>02333     <span class="comment">#</span>
<a name="l02334"></a>02334     <span class="comment"># This function does all of the work of adding lookahead information for use</span>
<a name="l02335"></a>02335     <span class="comment"># with LALR parsing</span>
<a name="l02336"></a>02336     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02337"></a>02337 
<a name="l02338"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ac21bf8a67db508dd2a3500884137117b">02338</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ac21bf8a67db508dd2a3500884137117b">add_lalr_lookaheads</a>(self,C):
<a name="l02339"></a>02339         <span class="comment"># Determine all of the nullable nonterminals</span>
<a name="l02340"></a>02340         nullable = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a5ac3ea4ac9870ea5690e1db401108067">compute_nullable_nonterminals</a>()
<a name="l02341"></a>02341 
<a name="l02342"></a>02342         <span class="comment"># Find all non-terminal transitions</span>
<a name="l02343"></a>02343         trans = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a21524677535ec064318adbcc85d42747">find_nonterminal_transitions</a>(C)
<a name="l02344"></a>02344 
<a name="l02345"></a>02345         <span class="comment"># Compute read sets</span>
<a name="l02346"></a>02346         readsets = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#aa0a66d55357fee23808addeedaa016a0">compute_read_sets</a>(C,trans,nullable)
<a name="l02347"></a>02347 
<a name="l02348"></a>02348         <span class="comment"># Compute lookback/includes relations</span>
<a name="l02349"></a>02349         lookd, included = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a48df924cf7762aef02c949a0ef1595a3">compute_lookback_includes</a>(C,trans,nullable)
<a name="l02350"></a>02350 
<a name="l02351"></a>02351         <span class="comment"># Compute LALR FOLLOW sets</span>
<a name="l02352"></a>02352         followsets = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a454fa63801e226bdc9350481e4d240d4">compute_follow_sets</a>(trans,readsets,included)
<a name="l02353"></a>02353 
<a name="l02354"></a>02354         <span class="comment"># Add all of the lookaheads</span>
<a name="l02355"></a>02355         self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a6e1526e9fc0fa8433bb73df175627605">add_lookaheads</a>(lookd,followsets)
<a name="l02356"></a>02356 
<a name="l02357"></a>02357     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02358"></a>02358     <span class="comment"># lr_parse_table()</span>
<a name="l02359"></a>02359     <span class="comment">#</span>
<a name="l02360"></a>02360     <span class="comment"># This function constructs the parse tables for SLR or LALR</span>
<a name="l02361"></a>02361     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02362"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a548eb88f53ecbb01d21adbf164ff53ed">02362</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a548eb88f53ecbb01d21adbf164ff53ed">lr_parse_table</a>(self):
<a name="l02363"></a>02363         Productions = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Productions
<a name="l02364"></a>02364         Precedence  = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Precedence
<a name="l02365"></a>02365         goto   = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ab7de7d19c9c5e175b91825f0c0c7148e">lr_goto</a>         <span class="comment"># Goto array</span>
<a name="l02366"></a>02366         action = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a4b6fb6d9ddf90906fd1236eadf9b43b2">lr_action</a>       <span class="comment"># Action array</span>
<a name="l02367"></a>02367         log    = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a7ec61acd6e84bb4e9d9f30ece21bef20">log</a>             <span class="comment"># Logger for output</span>
<a name="l02368"></a>02368 
<a name="l02369"></a>02369         actionp = { }                 <span class="comment"># Action production array (temporary)</span>
<a name="l02370"></a>02370         
<a name="l02371"></a>02371         log.info(<span class="stringliteral">&quot;Parsing method: %s&quot;</span>, self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a9c9cda8b5f756356117f9051a52f92e5">lr_method</a>)
<a name="l02372"></a>02372 
<a name="l02373"></a>02373         <span class="comment"># Step 1: Construct C = { I0, I1, ... IN}, collection of LR(0) items</span>
<a name="l02374"></a>02374         <span class="comment"># This determines the number of states</span>
<a name="l02375"></a>02375 
<a name="l02376"></a>02376         C = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ad5f070fa3a226c3d58349a249090c4fb">lr0_items</a>()
<a name="l02377"></a>02377 
<a name="l02378"></a>02378         <span class="keywordflow">if</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a9c9cda8b5f756356117f9051a52f92e5">lr_method</a> == <span class="stringliteral">&#39;LALR&#39;</span>:
<a name="l02379"></a>02379             self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ac21bf8a67db508dd2a3500884137117b">add_lalr_lookaheads</a>(C)
<a name="l02380"></a>02380 
<a name="l02381"></a>02381         <span class="comment"># Build the parser table, state by state</span>
<a name="l02382"></a>02382         st = 0
<a name="l02383"></a>02383         <span class="keywordflow">for</span> I <span class="keywordflow">in</span> C:
<a name="l02384"></a>02384             <span class="comment"># Loop over each production in I</span>
<a name="l02385"></a>02385             actlist = [ ]              <span class="comment"># List of actions</span>
<a name="l02386"></a>02386             st_action  = { }
<a name="l02387"></a>02387             st_actionp = { }
<a name="l02388"></a>02388             st_goto    = { }
<a name="l02389"></a>02389             log.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l02390"></a>02390             log.info(<span class="stringliteral">&quot;state %d&quot;</span>, st)
<a name="l02391"></a>02391             log.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l02392"></a>02392             <span class="keywordflow">for</span> p <span class="keywordflow">in</span> I:
<a name="l02393"></a>02393                 log.info(<span class="stringliteral">&quot;    (%d) %s&quot;</span>, p.number, <a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(p))
<a name="l02394"></a>02394             log.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l02395"></a>02395 
<a name="l02396"></a>02396             <span class="keywordflow">for</span> p <span class="keywordflow">in</span> I:
<a name="l02397"></a>02397                     <span class="keywordflow">if</span> p.len == p.lr_index + 1:
<a name="l02398"></a>02398                         <span class="keywordflow">if</span> p.name == <span class="stringliteral">&quot;S&#39;&quot;</span>:
<a name="l02399"></a>02399                             <span class="comment"># Start symbol. Accept!</span>
<a name="l02400"></a>02400                             st_action[<span class="stringliteral">&quot;$end&quot;</span>] = 0
<a name="l02401"></a>02401                             st_actionp[<span class="stringliteral">&quot;$end&quot;</span>] = p
<a name="l02402"></a>02402                         <span class="keywordflow">else</span>:
<a name="l02403"></a>02403                             <span class="comment"># We are at the end of a production.  Reduce!</span>
<a name="l02404"></a>02404                             <span class="keywordflow">if</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a9c9cda8b5f756356117f9051a52f92e5">lr_method</a> == <span class="stringliteral">&#39;LALR&#39;</span>:
<a name="l02405"></a>02405                                 laheads = p.lookaheads[st]
<a name="l02406"></a>02406                             <span class="keywordflow">else</span>:
<a name="l02407"></a>02407                                 laheads = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Follow[p.name]
<a name="l02408"></a>02408                             <span class="keywordflow">for</span> a <span class="keywordflow">in</span> laheads:
<a name="l02409"></a>02409                                 actlist.append((a,p,<span class="stringliteral">&quot;reduce using rule %d (%s)&quot;</span> % (p.number,p)))
<a name="l02410"></a>02410                                 r = st_action.get(a,<span class="keywordtype">None</span>)
<a name="l02411"></a>02411                                 <span class="keywordflow">if</span> r <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l02412"></a>02412                                     <span class="comment"># Whoa. Have a shift/reduce or reduce/reduce conflict</span>
<a name="l02413"></a>02413                                     <span class="keywordflow">if</span> r &gt; 0:
<a name="l02414"></a>02414                                         <span class="comment"># Need to decide on shift or reduce here</span>
<a name="l02415"></a>02415                                         <span class="comment"># By default we favor shifting. Need to add</span>
<a name="l02416"></a>02416                                         <span class="comment"># some precedence rules here.</span>
<a name="l02417"></a>02417                                         sprec,slevel = Productions[st_actionp[a].number].prec
<a name="l02418"></a>02418                                         rprec,rlevel = Precedence.get(a,(<span class="stringliteral">&#39;right&#39;</span>,0))
<a name="l02419"></a>02419                                         <span class="keywordflow">if</span> (slevel &lt; rlevel) <span class="keywordflow">or</span> ((slevel == rlevel) <span class="keywordflow">and</span> (rprec == <span class="stringliteral">&#39;left&#39;</span>)):
<a name="l02420"></a>02420                                             <span class="comment"># We really need to reduce here.</span>
<a name="l02421"></a>02421                                             st_action[a] = -p.number
<a name="l02422"></a>02422                                             st_actionp[a] = p
<a name="l02423"></a>02423                                             <span class="keywordflow">if</span> <span class="keywordflow">not</span> slevel <span class="keywordflow">and</span> <span class="keywordflow">not</span> rlevel:
<a name="l02424"></a>02424                                                 log.info(<span class="stringliteral">&quot;  ! shift/reduce conflict for %s resolved as reduce&quot;</span>,a)
<a name="l02425"></a>02425                                                 self.sr_conflicts.append((st,a,<span class="stringliteral">&#39;reduce&#39;</span>))
<a name="l02426"></a>02426                                             Productions[p.number].reduced += 1
<a name="l02427"></a>02427                                         <span class="keywordflow">elif</span> (slevel == rlevel) <span class="keywordflow">and</span> (rprec == <span class="stringliteral">&#39;nonassoc&#39;</span>):
<a name="l02428"></a>02428                                             st_action[a] = <span class="keywordtype">None</span>
<a name="l02429"></a>02429                                         <span class="keywordflow">else</span>:
<a name="l02430"></a>02430                                             <span class="comment"># Hmmm. Guess we&#39;ll keep the shift</span>
<a name="l02431"></a>02431                                             <span class="keywordflow">if</span> <span class="keywordflow">not</span> rlevel:
<a name="l02432"></a>02432                                                 log.info(<span class="stringliteral">&quot;  ! shift/reduce conflict for %s resolved as shift&quot;</span>,a)
<a name="l02433"></a>02433                                                 self.sr_conflicts.append((st,a,<span class="stringliteral">&#39;shift&#39;</span>))
<a name="l02434"></a>02434                                     <span class="keywordflow">elif</span> r &lt; 0:
<a name="l02435"></a>02435                                         <span class="comment"># Reduce/reduce conflict.   In this case, we favor the rule</span>
<a name="l02436"></a>02436                                         <span class="comment"># that was defined first in the grammar file</span>
<a name="l02437"></a>02437                                         oldp = Productions[-r]
<a name="l02438"></a>02438                                         pp = Productions[p.number]
<a name="l02439"></a>02439                                         <span class="keywordflow">if</span> oldp.line &gt; pp.line:
<a name="l02440"></a>02440                                             st_action[a] = -p.number
<a name="l02441"></a>02441                                             st_actionp[a] = p
<a name="l02442"></a>02442                                             chosenp,rejectp = pp,oldp
<a name="l02443"></a>02443                                             Productions[p.number].reduced += 1
<a name="l02444"></a>02444                                             Productions[oldp.number].reduced -= 1
<a name="l02445"></a>02445                                         <span class="keywordflow">else</span>:
<a name="l02446"></a>02446                                             chosenp,rejectp = oldp,pp
<a name="l02447"></a>02447                                         self.rr_conflicts.append((st,chosenp,rejectp))
<a name="l02448"></a>02448                                         log.info(<span class="stringliteral">&quot;  ! reduce/reduce conflict for %s resolved using rule %d (%s)&quot;</span>, a,st_actionp[a].number, st_actionp[a])
<a name="l02449"></a>02449                                     <span class="keywordflow">else</span>:
<a name="l02450"></a>02450                                         <span class="keywordflow">raise</span> <a class="code" href="../../d3/d83/classply_1_1yacc_1_1_l_a_l_r_error.html">LALRError</a>(<span class="stringliteral">&quot;Unknown conflict in state %d&quot;</span> % st)
<a name="l02451"></a>02451                                 <span class="keywordflow">else</span>:
<a name="l02452"></a>02452                                     st_action[a] = -p.number
<a name="l02453"></a>02453                                     st_actionp[a] = p
<a name="l02454"></a>02454                                     Productions[p.number].reduced += 1
<a name="l02455"></a>02455                     <span class="keywordflow">else</span>:
<a name="l02456"></a>02456                         i = p.lr_index
<a name="l02457"></a>02457                         a = p.prod[i+1]       <span class="comment"># Get symbol right after the &quot;.&quot;</span>
<a name="l02458"></a>02458                         <span class="keywordflow">if</span> a <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Terminals:
<a name="l02459"></a>02459                             g = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a36280125fa4a55e7c77fea65cdb77961">lr0_goto</a>(I,a)
<a name="l02460"></a>02460                             j = self.lr0_cidhash.get(<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(g),-1)
<a name="l02461"></a>02461                             <span class="keywordflow">if</span> j &gt;= 0:
<a name="l02462"></a>02462                                 <span class="comment"># We are in a shift state</span>
<a name="l02463"></a>02463                                 actlist.append((a,p,<span class="stringliteral">&quot;shift and go to state %d&quot;</span> % j))
<a name="l02464"></a>02464                                 r = st_action.get(a,<span class="keywordtype">None</span>)
<a name="l02465"></a>02465                                 <span class="keywordflow">if</span> r <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l02466"></a>02466                                     <span class="comment"># Whoa have a shift/reduce or shift/shift conflict</span>
<a name="l02467"></a>02467                                     <span class="keywordflow">if</span> r &gt; 0:
<a name="l02468"></a>02468                                         <span class="keywordflow">if</span> r != j:
<a name="l02469"></a>02469                                             <span class="keywordflow">raise</span> <a class="code" href="../../d3/d83/classply_1_1yacc_1_1_l_a_l_r_error.html">LALRError</a>(<span class="stringliteral">&quot;Shift/shift conflict in state %d&quot;</span> % st)
<a name="l02470"></a>02470                                     <span class="keywordflow">elif</span> r &lt; 0:
<a name="l02471"></a>02471                                         <span class="comment"># Do a precedence check.</span>
<a name="l02472"></a>02472                                         <span class="comment">#   -  if precedence of reduce rule is higher, we reduce.</span>
<a name="l02473"></a>02473                                         <span class="comment">#   -  if precedence of reduce is same and left assoc, we reduce.</span>
<a name="l02474"></a>02474                                         <span class="comment">#   -  otherwise we shift</span>
<a name="l02475"></a>02475                                         rprec,rlevel = Productions[st_actionp[a].number].prec
<a name="l02476"></a>02476                                         sprec,slevel = Precedence.get(a,(<span class="stringliteral">&#39;right&#39;</span>,0))
<a name="l02477"></a>02477                                         <span class="keywordflow">if</span> (slevel &gt; rlevel) <span class="keywordflow">or</span> ((slevel == rlevel) <span class="keywordflow">and</span> (rprec == <span class="stringliteral">&#39;right&#39;</span>)):
<a name="l02478"></a>02478                                             <span class="comment"># We decide to shift here... highest precedence to shift</span>
<a name="l02479"></a>02479                                             Productions[st_actionp[a].number].reduced -= 1
<a name="l02480"></a>02480                                             st_action[a] = j
<a name="l02481"></a>02481                                             st_actionp[a] = p
<a name="l02482"></a>02482                                             <span class="keywordflow">if</span> <span class="keywordflow">not</span> rlevel:
<a name="l02483"></a>02483                                                 log.info(<span class="stringliteral">&quot;  ! shift/reduce conflict for %s resolved as shift&quot;</span>,a)
<a name="l02484"></a>02484                                                 self.sr_conflicts.append((st,a,<span class="stringliteral">&#39;shift&#39;</span>))
<a name="l02485"></a>02485                                         <span class="keywordflow">elif</span> (slevel == rlevel) <span class="keywordflow">and</span> (rprec == <span class="stringliteral">&#39;nonassoc&#39;</span>):
<a name="l02486"></a>02486                                             st_action[a] = <span class="keywordtype">None</span>
<a name="l02487"></a>02487                                         <span class="keywordflow">else</span>:
<a name="l02488"></a>02488                                             <span class="comment"># Hmmm. Guess we&#39;ll keep the reduce</span>
<a name="l02489"></a>02489                                             <span class="keywordflow">if</span> <span class="keywordflow">not</span> slevel <span class="keywordflow">and</span> <span class="keywordflow">not</span> rlevel:
<a name="l02490"></a>02490                                                 log.info(<span class="stringliteral">&quot;  ! shift/reduce conflict for %s resolved as reduce&quot;</span>,a)
<a name="l02491"></a>02491                                                 self.sr_conflicts.append((st,a,<span class="stringliteral">&#39;reduce&#39;</span>))
<a name="l02492"></a>02492 
<a name="l02493"></a>02493                                     <span class="keywordflow">else</span>:
<a name="l02494"></a>02494                                         <span class="keywordflow">raise</span> <a class="code" href="../../d3/d83/classply_1_1yacc_1_1_l_a_l_r_error.html">LALRError</a>(<span class="stringliteral">&quot;Unknown conflict in state %d&quot;</span> % st)
<a name="l02495"></a>02495                                 <span class="keywordflow">else</span>:
<a name="l02496"></a>02496                                     st_action[a] = j
<a name="l02497"></a>02497                                     st_actionp[a] = p
<a name="l02498"></a>02498 
<a name="l02499"></a>02499             <span class="comment"># Print the actions associated with each terminal</span>
<a name="l02500"></a>02500             _actprint = { }
<a name="l02501"></a>02501             <span class="keywordflow">for</span> a,p,m <span class="keywordflow">in</span> actlist:
<a name="l02502"></a>02502                 <span class="keywordflow">if</span> a <span class="keywordflow">in</span> st_action:
<a name="l02503"></a>02503                     <span class="keywordflow">if</span> p <span class="keywordflow">is</span> st_actionp[a]:
<a name="l02504"></a>02504                         log.info(<span class="stringliteral">&quot;    %-15s %s&quot;</span>,a,m)
<a name="l02505"></a>02505                         _actprint[(a,m)] = 1
<a name="l02506"></a>02506             log.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l02507"></a>02507             <span class="comment"># Print the actions that were not used. (debugging)</span>
<a name="l02508"></a>02508             not_used = 0
<a name="l02509"></a>02509             <span class="keywordflow">for</span> a,p,m <span class="keywordflow">in</span> actlist:
<a name="l02510"></a>02510                 <span class="keywordflow">if</span> a <span class="keywordflow">in</span> st_action:
<a name="l02511"></a>02511                     <span class="keywordflow">if</span> p <span class="keywordflow">is</span> <span class="keywordflow">not</span> st_actionp[a]:
<a name="l02512"></a>02512                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> (a,m) <span class="keywordflow">in</span> _actprint:
<a name="l02513"></a>02513                             log.debug(<span class="stringliteral">&quot;  ! %-15s [ %s ]&quot;</span>,a,m)
<a name="l02514"></a>02514                             not_used = 1
<a name="l02515"></a>02515                             _actprint[(a,m)] = 1
<a name="l02516"></a>02516             <span class="keywordflow">if</span> not_used:
<a name="l02517"></a>02517                 log.debug(<span class="stringliteral">&quot;&quot;</span>)
<a name="l02518"></a>02518 
<a name="l02519"></a>02519             <span class="comment"># Construct the goto table for this state</span>
<a name="l02520"></a>02520 
<a name="l02521"></a>02521             nkeys = { }
<a name="l02522"></a>02522             <span class="keywordflow">for</span> ii <span class="keywordflow">in</span> I:
<a name="l02523"></a>02523                 <span class="keywordflow">for</span> s <span class="keywordflow">in</span> ii.usyms:
<a name="l02524"></a>02524                     <span class="keywordflow">if</span> s <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a8bef26ee7fee7b8b9d028952d28d0ddc">grammar</a>.Nonterminals:
<a name="l02525"></a>02525                         nkeys[s] = <span class="keywordtype">None</span>
<a name="l02526"></a>02526             <span class="keywordflow">for</span> n <span class="keywordflow">in</span> nkeys:
<a name="l02527"></a>02527                 g = self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a36280125fa4a55e7c77fea65cdb77961">lr0_goto</a>(I,n)
<a name="l02528"></a>02528                 j = self.lr0_cidhash.get(<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(g),-1)
<a name="l02529"></a>02529                 <span class="keywordflow">if</span> j &gt;= 0:
<a name="l02530"></a>02530                     st_goto[n] = j
<a name="l02531"></a>02531                     log.info(<span class="stringliteral">&quot;    %-30s shift and go to state %d&quot;</span>,n,j)
<a name="l02532"></a>02532 
<a name="l02533"></a>02533             action[st] = st_action
<a name="l02534"></a>02534             actionp[st] = st_actionp
<a name="l02535"></a>02535             goto[st] = st_goto
<a name="l02536"></a>02536             st += 1
<a name="l02537"></a>02537 
<a name="l02538"></a>02538 
<a name="l02539"></a>02539     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02540"></a>02540     <span class="comment"># write()</span>
<a name="l02541"></a>02541     <span class="comment">#</span>
<a name="l02542"></a>02542     <span class="comment"># This function writes the LR parsing tables to a file</span>
<a name="l02543"></a>02543     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02544"></a>02544 
<a name="l02545"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#adf603aa460388ef6555d696c5952d684">02545</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#adf603aa460388ef6555d696c5952d684">write_table</a>(self,modulename,outputdir=&#39;&#39;,signature=&quot;&quot;):
<a name="l02546"></a>02546         basemodulename = modulename.split(<span class="stringliteral">&quot;.&quot;</span>)[-1]
<a name="l02547"></a>02547         filename = os.path.join(outputdir,basemodulename) + <span class="stringliteral">&quot;.py&quot;</span>
<a name="l02548"></a>02548         <span class="keywordflow">try</span>:
<a name="l02549"></a>02549             f = <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(filename,<span class="stringliteral">&quot;w&quot;</span>)
<a name="l02550"></a>02550 
<a name="l02551"></a>02551             f.write(<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02552"></a>02552 <span class="stringliteral"># %s</span>
<a name="l02553"></a>02553 <span class="stringliteral"># This file is automatically generated. Do not edit.</span>
<a name="l02554"></a>02554 <span class="stringliteral">_tabversion = %r</span>
<a name="l02555"></a>02555 <span class="stringliteral"></span>
<a name="l02556"></a>02556 <span class="stringliteral">_lr_method = %r</span>
<a name="l02557"></a>02557 <span class="stringliteral"></span>
<a name="l02558"></a>02558 <span class="stringliteral">_lr_signature = %r</span>
<a name="l02559"></a>02559 <span class="stringliteral">    &quot;&quot;&quot;</span> % (filename, __tabversion__, self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a9c9cda8b5f756356117f9051a52f92e5">lr_method</a>, signature))
<a name="l02560"></a>02560 
<a name="l02561"></a>02561             <span class="comment"># Change smaller to 0 to go back to original tables</span>
<a name="l02562"></a>02562             smaller = 1
<a name="l02563"></a>02563 
<a name="l02564"></a>02564             <span class="comment"># Factor out names to try and make smaller</span>
<a name="l02565"></a>02565             <span class="keywordflow">if</span> smaller:
<a name="l02566"></a>02566                 items = { }
<a name="l02567"></a>02567 
<a name="l02568"></a>02568                 <span class="keywordflow">for</span> s,nd <span class="keywordflow">in</span> self.lr_action.items():
<a name="l02569"></a>02569                    <span class="keywordflow">for</span> name,v <span class="keywordflow">in</span> nd.items():
<a name="l02570"></a>02570                       i = items.get(name)
<a name="l02571"></a>02571                       <span class="keywordflow">if</span> <span class="keywordflow">not</span> i:
<a name="l02572"></a>02572                          i = ([],[])
<a name="l02573"></a>02573                          items[name] = i
<a name="l02574"></a>02574                       i[0].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(s)
<a name="l02575"></a>02575                       i[1].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(v)
<a name="l02576"></a>02576 
<a name="l02577"></a>02577                 f.write(<span class="stringliteral">&quot;\n_lr_action_items = {&quot;</span>)
<a name="l02578"></a>02578                 <span class="keywordflow">for</span> k,v <span class="keywordflow">in</span> items.items():
<a name="l02579"></a>02579                     f.write(<span class="stringliteral">&quot;%r:([&quot;</span> % k)
<a name="l02580"></a>02580                     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> v[0]:
<a name="l02581"></a>02581                         f.write(<span class="stringliteral">&quot;%r,&quot;</span> % i)
<a name="l02582"></a>02582                     f.write(<span class="stringliteral">&quot;],[&quot;</span>)
<a name="l02583"></a>02583                     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> v[1]:
<a name="l02584"></a>02584                         f.write(<span class="stringliteral">&quot;%r,&quot;</span> % i)
<a name="l02585"></a>02585 
<a name="l02586"></a>02586                     f.write(<span class="stringliteral">&quot;]),&quot;</span>)
<a name="l02587"></a>02587                 f.write(<span class="stringliteral">&quot;}\n&quot;</span>)
<a name="l02588"></a>02588 
<a name="l02589"></a>02589                 f.write(<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02590"></a>02590 <span class="stringliteral">_lr_action = { }</span>
<a name="l02591"></a>02591 <span class="stringliteral">for _k, _v in _lr_action_items.items():</span>
<a name="l02592"></a>02592 <span class="stringliteral">   for _x,_y in zip(_v[0],_v[1]):</span>
<a name="l02593"></a>02593 <span class="stringliteral">      if not _x in _lr_action:  _lr_action[_x] = { }</span>
<a name="l02594"></a>02594 <span class="stringliteral">      _lr_action[_x][_k] = _y</span>
<a name="l02595"></a>02595 <span class="stringliteral">del _lr_action_items</span>
<a name="l02596"></a>02596 <span class="stringliteral">&quot;&quot;&quot;</span>)
<a name="l02597"></a>02597 
<a name="l02598"></a>02598             <span class="keywordflow">else</span>:
<a name="l02599"></a>02599                 f.write(<span class="stringliteral">&quot;\n_lr_action = { &quot;</span>);
<a name="l02600"></a>02600                 <span class="keywordflow">for</span> k,v <span class="keywordflow">in</span> self.lr_action.items():
<a name="l02601"></a>02601                     f.write(<span class="stringliteral">&quot;(%r,%r):%r,&quot;</span> % (k[0],k[1],v))
<a name="l02602"></a>02602                 f.write(<span class="stringliteral">&quot;}\n&quot;</span>);
<a name="l02603"></a>02603 
<a name="l02604"></a>02604             <span class="keywordflow">if</span> smaller:
<a name="l02605"></a>02605                 <span class="comment"># Factor out names to try and make smaller</span>
<a name="l02606"></a>02606                 items = { }
<a name="l02607"></a>02607 
<a name="l02608"></a>02608                 <span class="keywordflow">for</span> s,nd <span class="keywordflow">in</span> self.lr_goto.items():
<a name="l02609"></a>02609                    <span class="keywordflow">for</span> name,v <span class="keywordflow">in</span> nd.items():
<a name="l02610"></a>02610                       i = items.get(name)
<a name="l02611"></a>02611                       <span class="keywordflow">if</span> <span class="keywordflow">not</span> i:
<a name="l02612"></a>02612                          i = ([],[])
<a name="l02613"></a>02613                          items[name] = i
<a name="l02614"></a>02614                       i[0].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(s)
<a name="l02615"></a>02615                       i[1].<a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#afe45b12054b6269d2537c8e0e4233b68">append</a>(v)
<a name="l02616"></a>02616 
<a name="l02617"></a>02617                 f.write(<span class="stringliteral">&quot;\n_lr_goto_items = {&quot;</span>)
<a name="l02618"></a>02618                 <span class="keywordflow">for</span> k,v <span class="keywordflow">in</span> items.items():
<a name="l02619"></a>02619                     f.write(<span class="stringliteral">&quot;%r:([&quot;</span> % k)
<a name="l02620"></a>02620                     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> v[0]:
<a name="l02621"></a>02621                         f.write(<span class="stringliteral">&quot;%r,&quot;</span> % i)
<a name="l02622"></a>02622                     f.write(<span class="stringliteral">&quot;],[&quot;</span>)
<a name="l02623"></a>02623                     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> v[1]:
<a name="l02624"></a>02624                         f.write(<span class="stringliteral">&quot;%r,&quot;</span> % i)
<a name="l02625"></a>02625 
<a name="l02626"></a>02626                     f.write(<span class="stringliteral">&quot;]),&quot;</span>)
<a name="l02627"></a>02627                 f.write(<span class="stringliteral">&quot;}\n&quot;</span>)
<a name="l02628"></a>02628 
<a name="l02629"></a>02629                 f.write(<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l02630"></a>02630 <span class="stringliteral">_lr_goto = { }</span>
<a name="l02631"></a>02631 <span class="stringliteral">for _k, _v in _lr_goto_items.items():</span>
<a name="l02632"></a>02632 <span class="stringliteral">   for _x,_y in zip(_v[0],_v[1]):</span>
<a name="l02633"></a>02633 <span class="stringliteral">       if not _x in _lr_goto: _lr_goto[_x] = { }</span>
<a name="l02634"></a>02634 <span class="stringliteral">       _lr_goto[_x][_k] = _y</span>
<a name="l02635"></a>02635 <span class="stringliteral">del _lr_goto_items</span>
<a name="l02636"></a>02636 <span class="stringliteral">&quot;&quot;&quot;</span>)
<a name="l02637"></a>02637             <span class="keywordflow">else</span>:
<a name="l02638"></a>02638                 f.write(<span class="stringliteral">&quot;\n_lr_goto = { &quot;</span>);
<a name="l02639"></a>02639                 <span class="keywordflow">for</span> k,v <span class="keywordflow">in</span> self.lr_goto.items():
<a name="l02640"></a>02640                     f.write(<span class="stringliteral">&quot;(%r,%r):%r,&quot;</span> % (k[0],k[1],v))
<a name="l02641"></a>02641                 f.write(<span class="stringliteral">&quot;}\n&quot;</span>);
<a name="l02642"></a>02642 
<a name="l02643"></a>02643             <span class="comment"># Write production table</span>
<a name="l02644"></a>02644             f.write(<span class="stringliteral">&quot;_lr_productions = [\n&quot;</span>)
<a name="l02645"></a>02645             <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#adeb13037a87416fd811da735618702f9">lr_productions</a>:
<a name="l02646"></a>02646                 <span class="keywordflow">if</span> p.func:
<a name="l02647"></a>02647                     f.write(<span class="stringliteral">&quot;  (%r,%r,%d,%r,%r,%d),\n&quot;</span> % (p.str,p.name, p.len, p.func,p.file,p.line))
<a name="l02648"></a>02648                 <span class="keywordflow">else</span>:
<a name="l02649"></a>02649                     f.write(<span class="stringliteral">&quot;  (%r,%r,%d,None,None,None),\n&quot;</span> % (<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(p),p.name, p.len))
<a name="l02650"></a>02650             f.write(<span class="stringliteral">&quot;]\n&quot;</span>)
<a name="l02651"></a>02651             f.close()
<a name="l02652"></a>02652 
<a name="l02653"></a>02653         <span class="keywordflow">except</span> IOError:
<a name="l02654"></a>02654             e = sys.exc_info()[1]
<a name="l02655"></a>02655             sys.stderr.write(<span class="stringliteral">&quot;Unable to create &#39;%s&#39;\n&quot;</span> % filename)
<a name="l02656"></a>02656             sys.stderr.write(<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(e)+<span class="stringliteral">&quot;\n&quot;</span>)
<a name="l02657"></a>02657             <span class="keywordflow">return</span>
<a name="l02658"></a>02658 
<a name="l02659"></a>02659 
<a name="l02660"></a>02660     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02661"></a>02661     <span class="comment"># pickle_table()</span>
<a name="l02662"></a>02662     <span class="comment">#</span>
<a name="l02663"></a>02663     <span class="comment"># This function pickles the LR parsing tables to a supplied file object</span>
<a name="l02664"></a>02664     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02665"></a>02665 
<a name="l02666"></a><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a6cda95d168ef78c33f25ee5df8a8881d">02666</a>     <span class="keyword">def </span><a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a6cda95d168ef78c33f25ee5df8a8881d">pickle_table</a>(self,filename,signature=&quot;&quot;):
<a name="l02667"></a>02667         <span class="keywordflow">try</span>:
<a name="l02668"></a>02668             <span class="keyword">import</span> cPickle <span class="keyword">as</span> pickle
<a name="l02669"></a>02669         <span class="keywordflow">except</span> ImportError:
<a name="l02670"></a>02670             <span class="keyword">import</span> pickle
<a name="l02671"></a>02671         outf = <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(filename,<span class="stringliteral">&quot;wb&quot;</span>)
<a name="l02672"></a>02672         pickle.dump(__tabversion__,outf,pickle_protocol)
<a name="l02673"></a>02673         pickle.dump(self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a9c9cda8b5f756356117f9051a52f92e5">lr_method</a>,outf,pickle_protocol)
<a name="l02674"></a>02674         pickle.dump(signature,outf,pickle_protocol)
<a name="l02675"></a>02675         pickle.dump(self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#a4b6fb6d9ddf90906fd1236eadf9b43b2">lr_action</a>,outf,pickle_protocol)
<a name="l02676"></a>02676         pickle.dump(self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#ab7de7d19c9c5e175b91825f0c0c7148e">lr_goto</a>,outf,pickle_protocol)
<a name="l02677"></a>02677 
<a name="l02678"></a>02678         outp = []
<a name="l02679"></a>02679         <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html#adeb13037a87416fd811da735618702f9">lr_productions</a>:
<a name="l02680"></a>02680             <span class="keywordflow">if</span> p.func:
<a name="l02681"></a>02681                 outp.append((p.str,p.name, p.len, p.func,p.file,p.line))
<a name="l02682"></a>02682             <span class="keywordflow">else</span>:
<a name="l02683"></a>02683                 outp.append((<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(p),p.name,p.len,<span class="keywordtype">None</span>,<span class="keywordtype">None</span>,<span class="keywordtype">None</span>))
<a name="l02684"></a>02684         pickle.dump(outp,outf,pickle_protocol)
<a name="l02685"></a>02685         outf.close()
<a name="l02686"></a>02686 
<a name="l02687"></a>02687 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02688"></a>02688 <span class="comment">#                            === INTROSPECTION ===</span>
<a name="l02689"></a>02689 <span class="comment">#</span>
<a name="l02690"></a>02690 <span class="comment"># The following functions and classes are used to implement the PLY</span>
<a name="l02691"></a>02691 <span class="comment"># introspection features followed by the yacc() function itself.</span>
<a name="l02692"></a>02692 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02693"></a>02693 
<a name="l02694"></a>02694 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02695"></a>02695 <span class="comment"># get_caller_module_dict()</span>
<a name="l02696"></a>02696 <span class="comment">#</span>
<a name="l02697"></a>02697 <span class="comment"># This function returns a dictionary containing all of the symbols defined within</span>
<a name="l02698"></a>02698 <span class="comment"># a caller further down the call stack.  This is used to get the environment</span>
<a name="l02699"></a>02699 <span class="comment"># associated with the yacc() call if none was provided.</span>
<a name="l02700"></a>02700 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02701"></a>02701 
<a name="l02702"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a54b9c52bac1dac1a8fb36c9e2ac43c3d">02702</a> <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a54b9c52bac1dac1a8fb36c9e2ac43c3d">get_caller_module_dict</a>(levels):
<a name="l02703"></a>02703     <span class="keywordflow">try</span>:
<a name="l02704"></a>02704         <span class="keywordflow">raise</span> RuntimeError
<a name="l02705"></a>02705     <span class="keywordflow">except</span> RuntimeError:
<a name="l02706"></a>02706         e,b,t = sys.exc_info()
<a name="l02707"></a>02707         f = t.tb_frame
<a name="l02708"></a>02708         <span class="keywordflow">while</span> levels &gt; 0:
<a name="l02709"></a>02709             f = f.f_back                   
<a name="l02710"></a>02710             levels -= 1
<a name="l02711"></a>02711         ldict = f.f_globals.copy()
<a name="l02712"></a>02712         <span class="keywordflow">if</span> f.f_globals != f.f_locals:
<a name="l02713"></a>02713             ldict.update(f.f_locals)
<a name="l02714"></a>02714 
<a name="l02715"></a>02715         <span class="keywordflow">return</span> ldict
<a name="l02716"></a>02716 
<a name="l02717"></a>02717 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02718"></a>02718 <span class="comment"># parse_grammar()</span>
<a name="l02719"></a>02719 <span class="comment">#</span>
<a name="l02720"></a>02720 <span class="comment"># This takes a raw grammar rule string and parses it into production data</span>
<a name="l02721"></a>02721 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02722"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a747747eaa91c8715dccd315e27361099">02722</a> <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a747747eaa91c8715dccd315e27361099">parse_grammar</a>(doc,file,line):
<a name="l02723"></a>02723     grammar = []
<a name="l02724"></a>02724     <span class="comment"># Split the doc string into lines</span>
<a name="l02725"></a>02725     pstrings = doc.splitlines()
<a name="l02726"></a>02726     lastp = <span class="keywordtype">None</span>
<a name="l02727"></a>02727     dline = line
<a name="l02728"></a>02728     <span class="keywordflow">for</span> ps <span class="keywordflow">in</span> pstrings:
<a name="l02729"></a>02729         dline += 1
<a name="l02730"></a>02730         p = ps.split()
<a name="l02731"></a>02731         <span class="keywordflow">if</span> <span class="keywordflow">not</span> p: <span class="keywordflow">continue</span>
<a name="l02732"></a>02732         <span class="keywordflow">try</span>:
<a name="l02733"></a>02733             <span class="keywordflow">if</span> p[0] == <span class="stringliteral">&#39;|&#39;</span>:
<a name="l02734"></a>02734                 <span class="comment"># This is a continuation of a previous rule</span>
<a name="l02735"></a>02735                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> lastp:
<a name="l02736"></a>02736                     <span class="keywordflow">raise</span> SyntaxError(<span class="stringliteral">&quot;%s:%d: Misplaced &#39;|&#39;&quot;</span> % (file,dline))
<a name="l02737"></a>02737                 prodname = lastp
<a name="l02738"></a>02738                 syms = p[1:]
<a name="l02739"></a>02739             <span class="keywordflow">else</span>:
<a name="l02740"></a>02740                 prodname = p[0]
<a name="l02741"></a>02741                 lastp = prodname
<a name="l02742"></a>02742                 syms   = p[2:]
<a name="l02743"></a>02743                 assign = p[1]
<a name="l02744"></a>02744                 <span class="keywordflow">if</span> assign != <span class="stringliteral">&#39;:&#39;</span> <span class="keywordflow">and</span> assign != <span class="stringliteral">&#39;::=&#39;</span>:
<a name="l02745"></a>02745                     <span class="keywordflow">raise</span> SyntaxError(<span class="stringliteral">&quot;%s:%d: Syntax error. Expected &#39;:&#39;&quot;</span> % (file,dline))
<a name="l02746"></a>02746 
<a name="l02747"></a>02747             grammar.append((file,dline,prodname,syms))
<a name="l02748"></a>02748         <span class="keywordflow">except</span> SyntaxError:
<a name="l02749"></a>02749             <span class="keywordflow">raise</span>
<a name="l02750"></a>02750         <span class="keywordflow">except</span> Exception:
<a name="l02751"></a>02751             <span class="keywordflow">raise</span> SyntaxError(<span class="stringliteral">&quot;%s:%d: Syntax error in rule &#39;%s&#39;&quot;</span> % (file,dline,ps.strip()))
<a name="l02752"></a>02752 
<a name="l02753"></a>02753     <span class="keywordflow">return</span> grammar
<a name="l02754"></a>02754 
<a name="l02755"></a>02755 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02756"></a>02756 <span class="comment"># ParserReflect()</span>
<a name="l02757"></a>02757 <span class="comment">#</span>
<a name="l02758"></a>02758 <span class="comment"># This class represents information extracted for building a parser including</span>
<a name="l02759"></a>02759 <span class="comment"># start symbol, error function, tokens, precedence list, action functions,</span>
<a name="l02760"></a>02760 <span class="comment"># etc.</span>
<a name="l02761"></a>02761 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02762"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html">02762</a> <span class="keyword">class </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html">ParserReflect</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l02763"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6e88f953f525bc704a4fc6d8fe27f5d0">02763</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6ae5db8b0d1f436c66bfe9a60f4c6db4">__init__</a>(self,pdict,log=None):
<a name="l02764"></a>02764         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#aa63b4f2bb953536305f1fffb234eaa93">pdict</a>      = pdict
<a name="l02765"></a>02765         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ac29a5dd307b7ec1bec5b0eb94aa0fef2">start</a>      = <span class="keywordtype">None</span>
<a name="l02766"></a>02766         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88bd74c7db99946acf8dd10876fb126b">error_func</a> = <span class="keywordtype">None</span>
<a name="l02767"></a>02767         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6e88f953f525bc704a4fc6d8fe27f5d0">tokens</a>     = <span class="keywordtype">None</span>
<a name="l02768"></a>02768         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad8e073d4a74efb19a1c73d2cf98dba11">files</a>      = {}
<a name="l02769"></a>02769         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#af1a96b355ba0dcdb77d63747be8c1888">grammar</a>    = []
<a name="l02770"></a>02770         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a>      = 0
<a name="l02771"></a>02771 
<a name="l02772"></a>02772         <span class="keywordflow">if</span> log <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l02773"></a>02773             self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a1a4eb145f0ecc2f6b928072c72d06cfb">log</a> = <a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html">PlyLogger</a>(sys.stderr)
<a name="l02774"></a>02774         <span class="keywordflow">else</span>:
<a name="l02775"></a>02775             self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a1a4eb145f0ecc2f6b928072c72d06cfb">log</a> = log
<a name="l02776"></a>02776 
<a name="l02777"></a>02777     <span class="comment"># Get all of the basic information</span>
<a name="l02778"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ac63b904782b42763d4916aac99060d5b">02778</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ac63b904782b42763d4916aac99060d5b">get_all</a>(self):
<a name="l02779"></a>02779         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a2afa7511f99432c15aac8b0dbb5700e2">get_start</a>()
<a name="l02780"></a>02780         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#afb172f30088eb9629128c1ad10fa86d7">get_error_func</a>()
<a name="l02781"></a>02781         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#abad30a1606ed8dc60ff60919578b6389">get_tokens</a>()
<a name="l02782"></a>02782         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#aea729b9ca0c9037892b0f7e2e10e4c9a">get_precedence</a>()
<a name="l02783"></a>02783         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#afa331cb90ecdfc0b2c6ae564387a6ed2">get_pfunctions</a>()
<a name="l02784"></a>02784         
<a name="l02785"></a>02785     <span class="comment"># Validate all of the information</span>
<a name="l02786"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a1e68a5d69b474c37ab91dff471fa0e6a">02786</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a1e68a5d69b474c37ab91dff471fa0e6a">validate_all</a>(self):
<a name="l02787"></a>02787         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad7195b35a34f279e10faab6e5bd0896e">validate_start</a>()
<a name="l02788"></a>02788         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a7d7ff7f7b9ad7d818ebf0bc42e1e72c9">validate_error_func</a>()
<a name="l02789"></a>02789         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a0d1a0ff9356f3380d9536c7efef843ce">validate_tokens</a>()
<a name="l02790"></a>02790         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a1dcb81a5d8dbe09d64835053bbab08ce">validate_precedence</a>()
<a name="l02791"></a>02791         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a376d7adfc204ef995935e03340590d1e">validate_pfunctions</a>()
<a name="l02792"></a>02792         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88e212c9579a1351da9f123ed5fe3103">validate_files</a>()
<a name="l02793"></a>02793         <span class="keywordflow">return</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a>
<a name="l02794"></a>02794 
<a name="l02795"></a>02795     <span class="comment"># Compute a signature over the grammar</span>
<a name="l02796"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab2a84fd2c94dd6f1715cdbfec6917b9b">02796</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab2a84fd2c94dd6f1715cdbfec6917b9b">signature</a>(self):
<a name="l02797"></a>02797         <span class="keywordflow">try</span>:
<a name="l02798"></a>02798             <span class="keyword">from</span> hashlib <span class="keyword">import</span> md5
<a name="l02799"></a>02799         <span class="keywordflow">except</span> ImportError:
<a name="l02800"></a>02800             <span class="keyword">from</span> md5 <span class="keyword">import</span> md5
<a name="l02801"></a>02801         <span class="keywordflow">try</span>:
<a name="l02802"></a>02802             sig = md5()
<a name="l02803"></a>02803             <span class="keywordflow">if</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ac29a5dd307b7ec1bec5b0eb94aa0fef2">start</a>:
<a name="l02804"></a>02804                 sig.update(self.start.encode(<span class="stringliteral">&#39;latin-1&#39;</span>))
<a name="l02805"></a>02805             <span class="keywordflow">if</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab9b6921c145d9a8a60dde7f68f2136ea">prec</a>:
<a name="l02806"></a>02806                 sig.update(<span class="stringliteral">&quot;&quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>([<span class="stringliteral">&quot;&quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>(p) <span class="keywordflow">for</span> p <span class="keywordflow">in</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab9b6921c145d9a8a60dde7f68f2136ea">prec</a>]).encode(<span class="stringliteral">&#39;latin-1&#39;</span>))
<a name="l02807"></a>02807             <span class="keywordflow">if</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6e88f953f525bc704a4fc6d8fe27f5d0">tokens</a>:
<a name="l02808"></a>02808                 sig.update(<span class="stringliteral">&quot; &quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6e88f953f525bc704a4fc6d8fe27f5d0">tokens</a>).encode(<span class="stringliteral">&#39;latin-1&#39;</span>))
<a name="l02809"></a>02809             <span class="keywordflow">for</span> f <span class="keywordflow">in</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad37a63828f6391f500c0c2bd62c297ae">pfuncs</a>:
<a name="l02810"></a>02810                 <span class="keywordflow">if</span> f[3]:
<a name="l02811"></a>02811                     sig.update(f[3].encode(<span class="stringliteral">&#39;latin-1&#39;</span>))
<a name="l02812"></a>02812         <span class="keywordflow">except</span> (TypeError,ValueError):
<a name="l02813"></a>02813             <span class="keywordflow">pass</span>
<a name="l02814"></a>02814         <span class="keywordflow">return</span> sig.digest()
<a name="l02815"></a>02815 
<a name="l02816"></a>02816     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02817"></a>02817     <span class="comment"># validate_file()</span>
<a name="l02818"></a>02818     <span class="comment">#</span>
<a name="l02819"></a>02819     <span class="comment"># This method checks to see if there are duplicated p_rulename() functions</span>
<a name="l02820"></a>02820     <span class="comment"># in the parser module file.  Without this function, it is really easy for</span>
<a name="l02821"></a>02821     <span class="comment"># users to make mistakes by cutting and pasting code fragments (and it&#39;s a real</span>
<a name="l02822"></a>02822     <span class="comment"># bugger to try and figure out why the resulting parser doesn&#39;t work).  Therefore,</span>
<a name="l02823"></a>02823     <span class="comment"># we just do a little regular expression pattern matching of def statements</span>
<a name="l02824"></a>02824     <span class="comment"># to try and detect duplicates.</span>
<a name="l02825"></a>02825     <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l02826"></a>02826 
<a name="l02827"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88e212c9579a1351da9f123ed5fe3103">02827</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88e212c9579a1351da9f123ed5fe3103">validate_files</a>(self):
<a name="l02828"></a>02828         <span class="comment"># Match def p_funcname(</span>
<a name="l02829"></a>02829         fre = re.compile(<span class="stringliteral">r&#39;\s*def\s+(p_[a-zA-Z_0-9]*)\(&#39;</span>)
<a name="l02830"></a>02830 
<a name="l02831"></a>02831         <span class="keywordflow">for</span> filename <span class="keywordflow">in</span> self.files.keys():
<a name="l02832"></a>02832             base,ext = os.path.splitext(filename)
<a name="l02833"></a>02833             <span class="keywordflow">if</span> ext != <span class="stringliteral">&#39;.py&#39;</span>: <span class="keywordflow">return</span> 1          <span class="comment"># No idea. Assume it&#39;s okay.</span>
<a name="l02834"></a>02834 
<a name="l02835"></a>02835             <span class="keywordflow">try</span>:
<a name="l02836"></a>02836                 f = <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(filename)
<a name="l02837"></a>02837                 lines = f.readlines()
<a name="l02838"></a>02838                 f.close()
<a name="l02839"></a>02839             <span class="keywordflow">except</span> IOError:
<a name="l02840"></a>02840                 <span class="keywordflow">continue</span>
<a name="l02841"></a>02841 
<a name="l02842"></a>02842             counthash = { }
<a name="l02843"></a>02843             <span class="keywordflow">for</span> linen,l <span class="keywordflow">in</span> enumerate(lines):
<a name="l02844"></a>02844                 linen += 1
<a name="l02845"></a>02845                 m = fre.match(l)
<a name="l02846"></a>02846                 <span class="keywordflow">if</span> m:
<a name="l02847"></a>02847                     name = m.group(1)
<a name="l02848"></a>02848                     prev = counthash.get(name)
<a name="l02849"></a>02849                     <span class="keywordflow">if</span> <span class="keywordflow">not</span> prev:
<a name="l02850"></a>02850                         counthash[name] = linen
<a name="l02851"></a>02851                     <span class="keywordflow">else</span>:
<a name="l02852"></a>02852                         self.log.warning(<span class="stringliteral">&quot;%s:%d: Function %s redefined. Previously defined on line %d&quot;</span>, filename,linen,name,prev)
<a name="l02853"></a>02853 
<a name="l02854"></a>02854     <span class="comment"># Get the start symbol</span>
<a name="l02855"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a2afa7511f99432c15aac8b0dbb5700e2">02855</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a2afa7511f99432c15aac8b0dbb5700e2">get_start</a>(self):
<a name="l02856"></a>02856         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ac29a5dd307b7ec1bec5b0eb94aa0fef2">start</a> = self.pdict.get(<span class="stringliteral">&#39;start&#39;</span>)
<a name="l02857"></a>02857 
<a name="l02858"></a>02858     <span class="comment"># Validate the start symbol</span>
<a name="l02859"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad7195b35a34f279e10faab6e5bd0896e">02859</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad7195b35a34f279e10faab6e5bd0896e">validate_start</a>(self):
<a name="l02860"></a>02860         <span class="keywordflow">if</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ac29a5dd307b7ec1bec5b0eb94aa0fef2">start</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l02861"></a>02861             <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ac29a5dd307b7ec1bec5b0eb94aa0fef2">start</a>,str):
<a name="l02862"></a>02862                 self.log.error(<span class="stringliteral">&quot;&#39;start&#39; must be a string&quot;</span>)
<a name="l02863"></a>02863 
<a name="l02864"></a>02864     <span class="comment"># Look for error handler</span>
<a name="l02865"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#afb172f30088eb9629128c1ad10fa86d7">02865</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#afb172f30088eb9629128c1ad10fa86d7">get_error_func</a>(self):
<a name="l02866"></a>02866         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88bd74c7db99946acf8dd10876fb126b">error_func</a> = self.pdict.get(<span class="stringliteral">&#39;p_error&#39;</span>)
<a name="l02867"></a>02867 
<a name="l02868"></a>02868     <span class="comment"># Validate the error function</span>
<a name="l02869"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a7d7ff7f7b9ad7d818ebf0bc42e1e72c9">02869</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a7d7ff7f7b9ad7d818ebf0bc42e1e72c9">validate_error_func</a>(self):
<a name="l02870"></a>02870         <span class="keywordflow">if</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88bd74c7db99946acf8dd10876fb126b">error_func</a>:
<a name="l02871"></a>02871             <span class="keywordflow">if</span> isinstance(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88bd74c7db99946acf8dd10876fb126b">error_func</a>,types.FunctionType):
<a name="l02872"></a>02872                 ismethod = 0
<a name="l02873"></a>02873             <span class="keywordflow">elif</span> isinstance(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88bd74c7db99946acf8dd10876fb126b">error_func</a>, types.MethodType):
<a name="l02874"></a>02874                 ismethod = 1
<a name="l02875"></a>02875             <span class="keywordflow">else</span>:
<a name="l02876"></a>02876                 self.log.error(<span class="stringliteral">&quot;&#39;p_error&#39; defined, but is not a function or method&quot;</span>)
<a name="l02877"></a>02877                 self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02878"></a>02878                 <span class="keywordflow">return</span>
<a name="l02879"></a>02879 
<a name="l02880"></a>02880             eline = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88bd74c7db99946acf8dd10876fb126b">error_func</a>).co_firstlineno
<a name="l02881"></a>02881             efile = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88bd74c7db99946acf8dd10876fb126b">error_func</a>).co_filename
<a name="l02882"></a>02882             self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad8e073d4a74efb19a1c73d2cf98dba11">files</a>[efile] = 1
<a name="l02883"></a>02883 
<a name="l02884"></a>02884             <span class="keywordflow">if</span> (<a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a88bd74c7db99946acf8dd10876fb126b">error_func</a>).co_argcount != 1+ismethod):
<a name="l02885"></a>02885                 self.log.error(<span class="stringliteral">&quot;%s:%d: p_error() requires 1 argument&quot;</span>,efile,eline)
<a name="l02886"></a>02886                 self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02887"></a>02887 
<a name="l02888"></a>02888     <span class="comment"># Get the tokens map</span>
<a name="l02889"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#abad30a1606ed8dc60ff60919578b6389">02889</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#abad30a1606ed8dc60ff60919578b6389">get_tokens</a>(self):
<a name="l02890"></a>02890         tokens = self.pdict.get(<span class="stringliteral">&quot;tokens&quot;</span>,<span class="keywordtype">None</span>)
<a name="l02891"></a>02891         <span class="keywordflow">if</span> <span class="keywordflow">not</span> tokens:
<a name="l02892"></a>02892             self.log.error(<span class="stringliteral">&quot;No token list is defined&quot;</span>)
<a name="l02893"></a>02893             self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02894"></a>02894             <span class="keywordflow">return</span>
<a name="l02895"></a>02895 
<a name="l02896"></a>02896         <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(tokens,(list, tuple)):
<a name="l02897"></a>02897             self.log.error(<span class="stringliteral">&quot;tokens must be a list or tuple&quot;</span>)
<a name="l02898"></a>02898             self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02899"></a>02899             <span class="keywordflow">return</span>
<a name="l02900"></a>02900         
<a name="l02901"></a>02901         <span class="keywordflow">if</span> <span class="keywordflow">not</span> tokens:
<a name="l02902"></a>02902             self.log.error(<span class="stringliteral">&quot;tokens is empty&quot;</span>)
<a name="l02903"></a>02903             self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02904"></a>02904             <span class="keywordflow">return</span>
<a name="l02905"></a>02905 
<a name="l02906"></a>02906         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6e88f953f525bc704a4fc6d8fe27f5d0">tokens</a> = tokens
<a name="l02907"></a>02907 
<a name="l02908"></a>02908     <span class="comment"># Validate the tokens</span>
<a name="l02909"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a0d1a0ff9356f3380d9536c7efef843ce">02909</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a0d1a0ff9356f3380d9536c7efef843ce">validate_tokens</a>(self):
<a name="l02910"></a>02910         <span class="comment"># Validate the tokens.</span>
<a name="l02911"></a>02911         <span class="keywordflow">if</span> <span class="stringliteral">&#39;error&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6e88f953f525bc704a4fc6d8fe27f5d0">tokens</a>:
<a name="l02912"></a>02912             self.log.error(<span class="stringliteral">&quot;Illegal token name &#39;error&#39;. Is a reserved word&quot;</span>)
<a name="l02913"></a>02913             self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02914"></a>02914             <span class="keywordflow">return</span>
<a name="l02915"></a>02915 
<a name="l02916"></a>02916         terminals = {}
<a name="l02917"></a>02917         <span class="keywordflow">for</span> n <span class="keywordflow">in</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6e88f953f525bc704a4fc6d8fe27f5d0">tokens</a>:
<a name="l02918"></a>02918             <span class="keywordflow">if</span> n <span class="keywordflow">in</span> terminals:
<a name="l02919"></a>02919                 self.log.warning(<span class="stringliteral">&quot;Token &#39;%s&#39; multiply defined&quot;</span>, n)
<a name="l02920"></a>02920             terminals[n] = 1
<a name="l02921"></a>02921 
<a name="l02922"></a>02922     <span class="comment"># Get the precedence map (if any)</span>
<a name="l02923"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab9b6921c145d9a8a60dde7f68f2136ea">02923</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#aea729b9ca0c9037892b0f7e2e10e4c9a">get_precedence</a>(self):
<a name="l02924"></a>02924         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab9b6921c145d9a8a60dde7f68f2136ea">prec</a> = self.pdict.get(<span class="stringliteral">&quot;precedence&quot;</span>,<span class="keywordtype">None</span>)
<a name="l02925"></a>02925 
<a name="l02926"></a>02926     <span class="comment"># Validate and parse the precedence map</span>
<a name="l02927"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a1dcb81a5d8dbe09d64835053bbab08ce">02927</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a1dcb81a5d8dbe09d64835053bbab08ce">validate_precedence</a>(self):
<a name="l02928"></a>02928         preclist = []
<a name="l02929"></a>02929         <span class="keywordflow">if</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab9b6921c145d9a8a60dde7f68f2136ea">prec</a>:
<a name="l02930"></a>02930             <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab9b6921c145d9a8a60dde7f68f2136ea">prec</a>,(list,tuple)):
<a name="l02931"></a>02931                 self.log.error(<span class="stringliteral">&quot;precedence must be a list or tuple&quot;</span>)
<a name="l02932"></a>02932                 self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02933"></a>02933                 <span class="keywordflow">return</span>
<a name="l02934"></a>02934             <span class="keywordflow">for</span> level,p <span class="keywordflow">in</span> enumerate(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ab9b6921c145d9a8a60dde7f68f2136ea">prec</a>):
<a name="l02935"></a>02935                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(p,(list,tuple)):
<a name="l02936"></a>02936                     self.log.error(<span class="stringliteral">&quot;Bad precedence table&quot;</span>)
<a name="l02937"></a>02937                     self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02938"></a>02938                     <span class="keywordflow">return</span>
<a name="l02939"></a>02939 
<a name="l02940"></a>02940                 <span class="keywordflow">if</span> len(p) &lt; 2:
<a name="l02941"></a>02941                     self.log.error(<span class="stringliteral">&quot;Malformed precedence entry %s. Must be (assoc, term, ..., term)&quot;</span>,p)
<a name="l02942"></a>02942                     self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02943"></a>02943                     <span class="keywordflow">return</span>
<a name="l02944"></a>02944                 assoc = p[0]
<a name="l02945"></a>02945                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(assoc,str):
<a name="l02946"></a>02946                     self.log.error(<span class="stringliteral">&quot;precedence associativity must be a string&quot;</span>)
<a name="l02947"></a>02947                     self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02948"></a>02948                     <span class="keywordflow">return</span>
<a name="l02949"></a>02949                 <span class="keywordflow">for</span> term <span class="keywordflow">in</span> p[1:]:
<a name="l02950"></a>02950                     <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(term,str):
<a name="l02951"></a>02951                         self.log.error(<span class="stringliteral">&quot;precedence items must be strings&quot;</span>)
<a name="l02952"></a>02952                         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02953"></a>02953                         <span class="keywordflow">return</span>
<a name="l02954"></a>02954                     preclist.append((term,assoc,level+1))
<a name="l02955"></a>02955         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a6c34bcbbeb72159c62e35731460b0818">preclist</a> = preclist
<a name="l02956"></a>02956 
<a name="l02957"></a>02957     <span class="comment"># Get all p_functions from the grammar</span>
<a name="l02958"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad37a63828f6391f500c0c2bd62c297ae">02958</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#afa331cb90ecdfc0b2c6ae564387a6ed2">get_pfunctions</a>(self):
<a name="l02959"></a>02959         p_functions = []
<a name="l02960"></a>02960         <span class="keywordflow">for</span> name, item <span class="keywordflow">in</span> self.pdict.items():
<a name="l02961"></a>02961             <span class="keywordflow">if</span> name[:2] != <span class="stringliteral">&#39;p_&#39;</span>: <span class="keywordflow">continue</span>
<a name="l02962"></a>02962             <span class="keywordflow">if</span> name == <span class="stringliteral">&#39;p_error&#39;</span>: <span class="keywordflow">continue</span>
<a name="l02963"></a>02963             <span class="keywordflow">if</span> isinstance(item,(types.FunctionType,types.MethodType)):
<a name="l02964"></a>02964                 line = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(item).co_firstlineno
<a name="l02965"></a>02965                 file = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(item).co_filename
<a name="l02966"></a>02966                 p_functions.append((line,file,name,item.__doc__))
<a name="l02967"></a>02967 
<a name="l02968"></a>02968         <span class="comment"># Sort all of the actions by line number</span>
<a name="l02969"></a>02969         p_functions.sort()
<a name="l02970"></a>02970         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad37a63828f6391f500c0c2bd62c297ae">pfuncs</a> = p_functions
<a name="l02971"></a>02971 
<a name="l02972"></a>02972 
<a name="l02973"></a>02973     <span class="comment"># Validate all of the p_functions</span>
<a name="l02974"></a><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a376d7adfc204ef995935e03340590d1e">02974</a>     <span class="keyword">def </span><a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#a376d7adfc204ef995935e03340590d1e">validate_pfunctions</a>(self):
<a name="l02975"></a>02975         grammar = []
<a name="l02976"></a>02976         <span class="comment"># Check for non-empty symbols</span>
<a name="l02977"></a>02977         <span class="keywordflow">if</span> len(self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad37a63828f6391f500c0c2bd62c297ae">pfuncs</a>) == 0:
<a name="l02978"></a>02978             self.log.error(<span class="stringliteral">&quot;no rules of the form p_rulename are defined&quot;</span>)
<a name="l02979"></a>02979             self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02980"></a>02980             <span class="keywordflow">return</span> 
<a name="l02981"></a>02981         
<a name="l02982"></a>02982         <span class="keywordflow">for</span> line, file, name, doc <span class="keywordflow">in</span> self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad37a63828f6391f500c0c2bd62c297ae">pfuncs</a>:
<a name="l02983"></a>02983             func = self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#aa63b4f2bb953536305f1fffb234eaa93">pdict</a>[name]
<a name="l02984"></a>02984             <span class="keywordflow">if</span> isinstance(func, types.MethodType):
<a name="l02985"></a>02985                 reqargs = 2
<a name="l02986"></a>02986             <span class="keywordflow">else</span>:
<a name="l02987"></a>02987                 reqargs = 1
<a name="l02988"></a>02988             <span class="keywordflow">if</span> <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(func).co_argcount &gt; reqargs:
<a name="l02989"></a>02989                 self.log.error(<span class="stringliteral">&quot;%s:%d: Rule &#39;%s&#39; has too many arguments&quot;</span>,file,line,func.__name__)
<a name="l02990"></a>02990                 self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02991"></a>02991             <span class="keywordflow">elif</span> <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(func).co_argcount &lt; reqargs:
<a name="l02992"></a>02992                 self.log.error(<span class="stringliteral">&quot;%s:%d: Rule &#39;%s&#39; requires an argument&quot;</span>,file,line,func.__name__)
<a name="l02993"></a>02993                 self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l02994"></a>02994             <span class="keywordflow">elif</span> <span class="keywordflow">not</span> func.__doc__:
<a name="l02995"></a>02995                 self.log.warning(<span class="stringliteral">&quot;%s:%d: No documentation string specified in function &#39;%s&#39; (ignored)&quot;</span>,file,line,func.__name__)
<a name="l02996"></a>02996             <span class="keywordflow">else</span>:
<a name="l02997"></a>02997                 <span class="keywordflow">try</span>:
<a name="l02998"></a>02998                     parsed_g = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a747747eaa91c8715dccd315e27361099">parse_grammar</a>(doc,file,line)
<a name="l02999"></a>02999                     <span class="keywordflow">for</span> g <span class="keywordflow">in</span> parsed_g:
<a name="l03000"></a>03000                         grammar.append((name, g))
<a name="l03001"></a>03001                 <span class="keywordflow">except</span> SyntaxError:
<a name="l03002"></a>03002                     e = sys.exc_info()[1]
<a name="l03003"></a>03003                     self.log.error(<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(e))
<a name="l03004"></a>03004                     self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ade5966f9bd749ad68a54f791306bd787">error</a> = 1
<a name="l03005"></a>03005 
<a name="l03006"></a>03006                 <span class="comment"># Looks like a valid grammar rule</span>
<a name="l03007"></a>03007                 <span class="comment"># Mark the file in which defined.</span>
<a name="l03008"></a>03008                 self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#ad8e073d4a74efb19a1c73d2cf98dba11">files</a>[file] = 1
<a name="l03009"></a>03009 
<a name="l03010"></a>03010         <span class="comment"># Secondary validation step that looks for p_ definitions that are not functions</span>
<a name="l03011"></a>03011         <span class="comment"># or functions that look like they might be grammar rules.</span>
<a name="l03012"></a>03012 
<a name="l03013"></a>03013         <span class="keywordflow">for</span> n,v <span class="keywordflow">in</span> self.pdict.items():
<a name="l03014"></a>03014             <span class="keywordflow">if</span> n[0:2] == <span class="stringliteral">&#39;p_&#39;</span> <span class="keywordflow">and</span> isinstance(v, (types.FunctionType, types.MethodType)): <span class="keywordflow">continue</span>
<a name="l03015"></a>03015             <span class="keywordflow">if</span> n[0:2] == <span class="stringliteral">&#39;t_&#39;</span>: <span class="keywordflow">continue</span>
<a name="l03016"></a>03016             <span class="keywordflow">if</span> n[0:2] == <span class="stringliteral">&#39;p_&#39;</span> <span class="keywordflow">and</span> n != <span class="stringliteral">&#39;p_error&#39;</span>:
<a name="l03017"></a>03017                 self.log.warning(<span class="stringliteral">&quot;&#39;%s&#39; not defined as a function&quot;</span>, n)
<a name="l03018"></a>03018             <span class="keywordflow">if</span> ((isinstance(v,types.FunctionType) <span class="keywordflow">and</span> <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(v).co_argcount == 1) <span class="keywordflow">or</span>
<a name="l03019"></a>03019                 (isinstance(v,types.MethodType) <span class="keywordflow">and</span> <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(v).co_argcount == 2)):
<a name="l03020"></a>03020                 <span class="keywordflow">try</span>:
<a name="l03021"></a>03021                     doc = v.__doc__.split(<span class="stringliteral">&quot; &quot;</span>)
<a name="l03022"></a>03022                     <span class="keywordflow">if</span> doc[1] == <span class="stringliteral">&#39;:&#39;</span>:
<a name="l03023"></a>03023                         self.log.warning(<span class="stringliteral">&quot;%s:%d: Possible grammar rule &#39;%s&#39; defined without p_ prefix&quot;</span>,
<a name="l03024"></a>03024                                          <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(v).co_filename, <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a38689bd14eb84fcf4b2f14bde4df5fa6">func_code</a>(v).co_firstlineno,n)
<a name="l03025"></a>03025                 <span class="keywordflow">except</span> Exception:
<a name="l03026"></a>03026                     <span class="keywordflow">pass</span>
<a name="l03027"></a>03027 
<a name="l03028"></a>03028         self.<a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html#af1a96b355ba0dcdb77d63747be8c1888">grammar</a> = grammar
<a name="l03029"></a>03029 
<a name="l03030"></a>03030 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l03031"></a>03031 <span class="comment"># yacc(module)</span>
<a name="l03032"></a>03032 <span class="comment">#</span>
<a name="l03033"></a>03033 <span class="comment"># Build a parser</span>
<a name="l03034"></a>03034 <span class="comment"># -----------------------------------------------------------------------------</span>
<a name="l03035"></a>03035 
<a name="l03036"></a><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a5197e7b19c4d3126dd578b21d98a10a3">03036</a> <span class="keyword">def </span><a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a5197e7b19c4d3126dd578b21d98a10a3">yacc</a>(method=&#39;LALR&#39;, debug=yaccdebug, module=None, tabmodule=tab_module, start=None, 
<a name="l03037"></a>03037          check_recursion=1, optimize=0, write_tables=1, debugfile=debug_file,outputdir=<span class="stringliteral">&#39;&#39;</span>,
<a name="l03038"></a>03038          debuglog=<span class="keywordtype">None</span>, errorlog = <span class="keywordtype">None</span>, picklefile=<span class="keywordtype">None</span>):
<a name="l03039"></a>03039 
<a name="l03040"></a>03040     <span class="keyword">global</span> parse                 <span class="comment"># Reference to the parsing method of the last built parser</span>
<a name="l03041"></a>03041 
<a name="l03042"></a>03042     <span class="comment"># If pickling is enabled, table files are not created</span>
<a name="l03043"></a>03043 
<a name="l03044"></a>03044     <span class="keywordflow">if</span> picklefile:
<a name="l03045"></a>03045         write_tables = 0
<a name="l03046"></a>03046 
<a name="l03047"></a>03047     <span class="keywordflow">if</span> errorlog <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l03048"></a>03048         errorlog = <a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html">PlyLogger</a>(sys.stderr)
<a name="l03049"></a>03049 
<a name="l03050"></a>03050     <span class="comment"># Get the module dictionary used for the parser</span>
<a name="l03051"></a>03051     <span class="keywordflow">if</span> module:
<a name="l03052"></a>03052         _items = [(k,getattr(module,k)) <span class="keywordflow">for</span> k <span class="keywordflow">in</span> <a class="code" href="../../d3/d4b/lockscreen_8js.html#aec4b49f6f844eec3e3877aef25ed0b84">dir</a>(module)]
<a name="l03053"></a>03053         pdict = dict(_items)
<a name="l03054"></a>03054     <span class="keywordflow">else</span>:
<a name="l03055"></a>03055         pdict = <a class="code" href="../../dd/d7d/namespaceply_1_1yacc.html#a54b9c52bac1dac1a8fb36c9e2ac43c3d">get_caller_module_dict</a>(2)
<a name="l03056"></a>03056 
<a name="l03057"></a>03057     <span class="comment"># Collect parser information from the dictionary</span>
<a name="l03058"></a>03058     pinfo = <a class="code" href="../../dc/d97/classply_1_1yacc_1_1_parser_reflect.html">ParserReflect</a>(pdict,log=errorlog)
<a name="l03059"></a>03059     pinfo.get_all()
<a name="l03060"></a>03060 
<a name="l03061"></a>03061     <span class="keywordflow">if</span> pinfo.error:
<a name="l03062"></a>03062         <span class="keywordflow">raise</span> <a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">YaccError</a>(<span class="stringliteral">&quot;Unable to build parser&quot;</span>)
<a name="l03063"></a>03063 
<a name="l03064"></a>03064     <span class="comment"># Check signature against table files (if any)</span>
<a name="l03065"></a>03065     signature = pinfo.signature()
<a name="l03066"></a>03066 
<a name="l03067"></a>03067     <span class="comment"># Read the tables</span>
<a name="l03068"></a>03068     <span class="keywordflow">try</span>:
<a name="l03069"></a>03069         lr = <a class="code" href="../../d3/d2b/classply_1_1yacc_1_1_l_r_table.html">LRTable</a>()
<a name="l03070"></a>03070         <span class="keywordflow">if</span> picklefile:
<a name="l03071"></a>03071             read_signature = lr.read_pickle(picklefile)
<a name="l03072"></a>03072         <span class="keywordflow">else</span>:
<a name="l03073"></a>03073             read_signature = lr.read_table(tabmodule)
<a name="l03074"></a>03074         <span class="keywordflow">if</span> optimize <span class="keywordflow">or</span> (read_signature == signature):
<a name="l03075"></a>03075             <span class="keywordflow">try</span>:
<a name="l03076"></a>03076                 lr.bind_callables(pinfo.pdict)
<a name="l03077"></a>03077                 parser = <a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html">LRParser</a>(lr,pinfo.error_func)
<a name="l03078"></a>03078                 parse = parser.parse
<a name="l03079"></a>03079                 <span class="keywordflow">return</span> parser
<a name="l03080"></a>03080             <span class="keywordflow">except</span> Exception:
<a name="l03081"></a>03081                 e = sys.exc_info()[1]
<a name="l03082"></a>03082                 errorlog.warning(<span class="stringliteral">&quot;There was a problem loading the table file: %s&quot;</span>, repr(e))
<a name="l03083"></a>03083     <span class="keywordflow">except</span> VersionError:
<a name="l03084"></a>03084         e = sys.exc_info()
<a name="l03085"></a>03085         errorlog.warning(<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(e))
<a name="l03086"></a>03086     <span class="keywordflow">except</span> Exception:
<a name="l03087"></a>03087         <span class="keywordflow">pass</span>
<a name="l03088"></a>03088 
<a name="l03089"></a>03089     <span class="keywordflow">if</span> debuglog <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l03090"></a>03090         <span class="keywordflow">if</span> debug:
<a name="l03091"></a>03091             debuglog = <a class="code" href="../../d7/d55/classply_1_1yacc_1_1_ply_logger.html">PlyLogger</a>(<a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(debugfile,<span class="stringliteral">&quot;w&quot;</span>))
<a name="l03092"></a>03092         <span class="keywordflow">else</span>:
<a name="l03093"></a>03093             debuglog = <a class="code" href="../../da/d0e/classply_1_1yacc_1_1_null_logger.html">NullLogger</a>()
<a name="l03094"></a>03094 
<a name="l03095"></a>03095     debuglog.info(<span class="stringliteral">&quot;Created by PLY version %s (http://www.dabeaz.com/ply)&quot;</span>, __version__)
<a name="l03096"></a>03096 
<a name="l03097"></a>03097 
<a name="l03098"></a>03098     errors = 0
<a name="l03099"></a>03099 
<a name="l03100"></a>03100     <span class="comment"># Validate the parser information</span>
<a name="l03101"></a>03101     <span class="keywordflow">if</span> pinfo.validate_all():
<a name="l03102"></a>03102         <span class="keywordflow">raise</span> <a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">YaccError</a>(<span class="stringliteral">&quot;Unable to build parser&quot;</span>)
<a name="l03103"></a>03103     
<a name="l03104"></a>03104     <span class="keywordflow">if</span> <span class="keywordflow">not</span> pinfo.error_func:
<a name="l03105"></a>03105         errorlog.warning(<span class="stringliteral">&quot;no p_error() function is defined&quot;</span>)
<a name="l03106"></a>03106 
<a name="l03107"></a>03107     <span class="comment"># Create a grammar object</span>
<a name="l03108"></a>03108     grammar = <a class="code" href="../../de/dbe/classply_1_1yacc_1_1_grammar.html">Grammar</a>(pinfo.tokens)
<a name="l03109"></a>03109 
<a name="l03110"></a>03110     <span class="comment"># Set precedence level for terminals</span>
<a name="l03111"></a>03111     <span class="keywordflow">for</span> term, assoc, level <span class="keywordflow">in</span> pinfo.preclist:
<a name="l03112"></a>03112         <span class="keywordflow">try</span>:
<a name="l03113"></a>03113             grammar.set_precedence(term,assoc,level)
<a name="l03114"></a>03114         <span class="keywordflow">except</span> GrammarError:
<a name="l03115"></a>03115             e = sys.exc_info()[1]
<a name="l03116"></a>03116             errorlog.warning(<span class="stringliteral">&quot;%s&quot;</span>,<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(e))
<a name="l03117"></a>03117 
<a name="l03118"></a>03118     <span class="comment"># Add productions to the grammar</span>
<a name="l03119"></a>03119     <span class="keywordflow">for</span> funcname, gram <span class="keywordflow">in</span> pinfo.grammar:
<a name="l03120"></a>03120         file, line, prodname, syms = gram
<a name="l03121"></a>03121         <span class="keywordflow">try</span>:
<a name="l03122"></a>03122             grammar.add_production(prodname,syms,funcname,file,line)
<a name="l03123"></a>03123         <span class="keywordflow">except</span> GrammarError:
<a name="l03124"></a>03124             e = sys.exc_info()[1]
<a name="l03125"></a>03125             errorlog.error(<span class="stringliteral">&quot;%s&quot;</span>,<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(e))
<a name="l03126"></a>03126             errors = 1
<a name="l03127"></a>03127 
<a name="l03128"></a>03128     <span class="comment"># Set the grammar start symbols</span>
<a name="l03129"></a>03129     <span class="keywordflow">try</span>:
<a name="l03130"></a>03130         <span class="keywordflow">if</span> start <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l03131"></a>03131             grammar.set_start(pinfo.start)
<a name="l03132"></a>03132         <span class="keywordflow">else</span>:
<a name="l03133"></a>03133             grammar.set_start(start)
<a name="l03134"></a>03134     <span class="keywordflow">except</span> GrammarError:
<a name="l03135"></a>03135         e = sys.exc_info()[1]
<a name="l03136"></a>03136         errorlog.error(<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(e))
<a name="l03137"></a>03137         errors = 1
<a name="l03138"></a>03138 
<a name="l03139"></a>03139     <span class="keywordflow">if</span> errors:
<a name="l03140"></a>03140         <span class="keywordflow">raise</span> <a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">YaccError</a>(<span class="stringliteral">&quot;Unable to build parser&quot;</span>)
<a name="l03141"></a>03141 
<a name="l03142"></a>03142     <span class="comment"># Verify the grammar structure</span>
<a name="l03143"></a>03143     undefined_symbols = grammar.undefined_symbols()
<a name="l03144"></a>03144     <span class="keywordflow">for</span> sym, prod <span class="keywordflow">in</span> undefined_symbols:
<a name="l03145"></a>03145         errorlog.error(<span class="stringliteral">&quot;%s:%d: Symbol &#39;%s&#39; used, but not defined as a token or a rule&quot;</span>,prod.file,prod.line,sym)
<a name="l03146"></a>03146         errors = 1
<a name="l03147"></a>03147 
<a name="l03148"></a>03148     unused_terminals = grammar.unused_terminals()
<a name="l03149"></a>03149     <span class="keywordflow">if</span> unused_terminals:
<a name="l03150"></a>03150         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03151"></a>03151         debuglog.info(<span class="stringliteral">&quot;Unused terminals:&quot;</span>)
<a name="l03152"></a>03152         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03153"></a>03153         <span class="keywordflow">for</span> term <span class="keywordflow">in</span> unused_terminals:
<a name="l03154"></a>03154             errorlog.warning(<span class="stringliteral">&quot;Token &#39;%s&#39; defined, but not used&quot;</span>, term)
<a name="l03155"></a>03155             debuglog.info(<span class="stringliteral">&quot;    %s&quot;</span>, term)
<a name="l03156"></a>03156 
<a name="l03157"></a>03157     <span class="comment"># Print out all productions to the debug log</span>
<a name="l03158"></a>03158     <span class="keywordflow">if</span> debug:
<a name="l03159"></a>03159         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03160"></a>03160         debuglog.info(<span class="stringliteral">&quot;Grammar&quot;</span>)
<a name="l03161"></a>03161         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03162"></a>03162         <span class="keywordflow">for</span> n,p <span class="keywordflow">in</span> enumerate(grammar.Productions):
<a name="l03163"></a>03163             debuglog.info(<span class="stringliteral">&quot;Rule %-5d %s&quot;</span>, n, p)
<a name="l03164"></a>03164 
<a name="l03165"></a>03165     <span class="comment"># Find unused non-terminals</span>
<a name="l03166"></a>03166     unused_rules = grammar.unused_rules()
<a name="l03167"></a>03167     <span class="keywordflow">for</span> prod <span class="keywordflow">in</span> unused_rules:
<a name="l03168"></a>03168         errorlog.warning(<span class="stringliteral">&quot;%s:%d: Rule &#39;%s&#39; defined, but not used&quot;</span>, prod.file, prod.line, prod.name)
<a name="l03169"></a>03169 
<a name="l03170"></a>03170     <span class="keywordflow">if</span> len(unused_terminals) == 1:
<a name="l03171"></a>03171         errorlog.warning(<span class="stringliteral">&quot;There is 1 unused token&quot;</span>)
<a name="l03172"></a>03172     <span class="keywordflow">if</span> len(unused_terminals) &gt; 1:
<a name="l03173"></a>03173         errorlog.warning(<span class="stringliteral">&quot;There are %d unused tokens&quot;</span>, len(unused_terminals))
<a name="l03174"></a>03174 
<a name="l03175"></a>03175     <span class="keywordflow">if</span> len(unused_rules) == 1:
<a name="l03176"></a>03176         errorlog.warning(<span class="stringliteral">&quot;There is 1 unused rule&quot;</span>)
<a name="l03177"></a>03177     <span class="keywordflow">if</span> len(unused_rules) &gt; 1:
<a name="l03178"></a>03178         errorlog.warning(<span class="stringliteral">&quot;There are %d unused rules&quot;</span>, len(unused_rules))
<a name="l03179"></a>03179 
<a name="l03180"></a>03180     <span class="keywordflow">if</span> debug:
<a name="l03181"></a>03181         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03182"></a>03182         debuglog.info(<span class="stringliteral">&quot;Terminals, with rules where they appear&quot;</span>)
<a name="l03183"></a>03183         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03184"></a>03184         terms = <a class="code" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>(grammar.Terminals)
<a name="l03185"></a>03185         terms.sort()
<a name="l03186"></a>03186         <span class="keywordflow">for</span> term <span class="keywordflow">in</span> terms:
<a name="l03187"></a>03187             debuglog.info(<span class="stringliteral">&quot;%-20s : %s&quot;</span>, term, <span class="stringliteral">&quot; &quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>([<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(s) <span class="keywordflow">for</span> s <span class="keywordflow">in</span> grammar.Terminals[term]]))
<a name="l03188"></a>03188         
<a name="l03189"></a>03189         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03190"></a>03190         debuglog.info(<span class="stringliteral">&quot;Nonterminals, with rules where they appear&quot;</span>)
<a name="l03191"></a>03191         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03192"></a>03192         nonterms = <a class="code" href="../../d3/d87/mock__contact_8js.html#ad08d759db77b6861afcb4729fc620b95">list</a>(grammar.Nonterminals)
<a name="l03193"></a>03193         nonterms.sort()
<a name="l03194"></a>03194         <span class="keywordflow">for</span> nonterm <span class="keywordflow">in</span> nonterms:
<a name="l03195"></a>03195             debuglog.info(<span class="stringliteral">&quot;%-20s : %s&quot;</span>, nonterm, <span class="stringliteral">&quot; &quot;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>([<a class="code" href="../../df/d44/permission__manager_8js.html#a176e0fe9a3e516f5aa501f9dcf2eb97b">str</a>(s) <span class="keywordflow">for</span> s <span class="keywordflow">in</span> grammar.Nonterminals[nonterm]]))
<a name="l03196"></a>03196         debuglog.info(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03197"></a>03197 
<a name="l03198"></a>03198     <span class="keywordflow">if</span> check_recursion:
<a name="l03199"></a>03199         unreachable = grammar.find_unreachable()
<a name="l03200"></a>03200         <span class="keywordflow">for</span> u <span class="keywordflow">in</span> unreachable:
<a name="l03201"></a>03201             errorlog.warning(<span class="stringliteral">&quot;Symbol &#39;%s&#39; is unreachable&quot;</span>,u)
<a name="l03202"></a>03202 
<a name="l03203"></a>03203         infinite = grammar.infinite_cycles()
<a name="l03204"></a>03204         <span class="keywordflow">for</span> inf <span class="keywordflow">in</span> infinite:
<a name="l03205"></a>03205             errorlog.error(<span class="stringliteral">&quot;Infinite recursion detected for symbol &#39;%s&#39;&quot;</span>, inf)
<a name="l03206"></a>03206             errors = 1
<a name="l03207"></a>03207         
<a name="l03208"></a>03208     unused_prec = grammar.unused_precedence()
<a name="l03209"></a>03209     <span class="keywordflow">for</span> term, assoc <span class="keywordflow">in</span> unused_prec:
<a name="l03210"></a>03210         errorlog.error(<span class="stringliteral">&quot;Precedence rule &#39;%s&#39; defined for unknown symbol &#39;%s&#39;&quot;</span>, assoc, term)
<a name="l03211"></a>03211         errors = 1
<a name="l03212"></a>03212 
<a name="l03213"></a>03213     <span class="keywordflow">if</span> errors:
<a name="l03214"></a>03214         <span class="keywordflow">raise</span> <a class="code" href="../../d4/d21/classply_1_1yacc_1_1_yacc_error.html">YaccError</a>(<span class="stringliteral">&quot;Unable to build parser&quot;</span>)
<a name="l03215"></a>03215     
<a name="l03216"></a>03216     <span class="comment"># Run the LRGeneratedTable on the grammar</span>
<a name="l03217"></a>03217     <span class="keywordflow">if</span> debug:
<a name="l03218"></a>03218         errorlog.debug(<span class="stringliteral">&quot;Generating %s tables&quot;</span>, method)
<a name="l03219"></a>03219             
<a name="l03220"></a>03220     lr = <a class="code" href="../../dd/dab/classply_1_1yacc_1_1_l_r_generated_table.html">LRGeneratedTable</a>(grammar,method,debuglog)
<a name="l03221"></a>03221 
<a name="l03222"></a>03222     <span class="keywordflow">if</span> debug:
<a name="l03223"></a>03223         num_sr = len(lr.sr_conflicts)
<a name="l03224"></a>03224 
<a name="l03225"></a>03225         <span class="comment"># Report shift/reduce and reduce/reduce conflicts</span>
<a name="l03226"></a>03226         <span class="keywordflow">if</span> num_sr == 1:
<a name="l03227"></a>03227             errorlog.warning(<span class="stringliteral">&quot;1 shift/reduce conflict&quot;</span>)
<a name="l03228"></a>03228         <span class="keywordflow">elif</span> num_sr &gt; 1:
<a name="l03229"></a>03229             errorlog.warning(<span class="stringliteral">&quot;%d shift/reduce conflicts&quot;</span>, num_sr)
<a name="l03230"></a>03230 
<a name="l03231"></a>03231         num_rr = len(lr.rr_conflicts)
<a name="l03232"></a>03232         <span class="keywordflow">if</span> num_rr == 1:
<a name="l03233"></a>03233             errorlog.warning(<span class="stringliteral">&quot;1 reduce/reduce conflict&quot;</span>)
<a name="l03234"></a>03234         <span class="keywordflow">elif</span> num_rr &gt; 1:
<a name="l03235"></a>03235             errorlog.warning(<span class="stringliteral">&quot;%d reduce/reduce conflicts&quot;</span>, num_rr)
<a name="l03236"></a>03236 
<a name="l03237"></a>03237     <span class="comment"># Write out conflicts to the output file</span>
<a name="l03238"></a>03238     <span class="keywordflow">if</span> debug <span class="keywordflow">and</span> (lr.sr_conflicts <span class="keywordflow">or</span> lr.rr_conflicts):
<a name="l03239"></a>03239         debuglog.warning(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03240"></a>03240         debuglog.warning(<span class="stringliteral">&quot;Conflicts:&quot;</span>)
<a name="l03241"></a>03241         debuglog.warning(<span class="stringliteral">&quot;&quot;</span>)
<a name="l03242"></a>03242 
<a name="l03243"></a>03243         <span class="keywordflow">for</span> state, tok, resolution <span class="keywordflow">in</span> lr.sr_conflicts:
<a name="l03244"></a>03244             debuglog.warning(<span class="stringliteral">&quot;shift/reduce conflict for %s in state %d resolved as %s&quot;</span>,  tok, state, resolution)
<a name="l03245"></a>03245         
<a name="l03246"></a>03246         already_reported = {}
<a name="l03247"></a>03247         <span class="keywordflow">for</span> state, rule, rejected <span class="keywordflow">in</span> lr.rr_conflicts:
<a name="l03248"></a>03248             <span class="keywordflow">if</span> (state,<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(rule),<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(rejected)) <span class="keywordflow">in</span> already_reported:
<a name="l03249"></a>03249                 <span class="keywordflow">continue</span>
<a name="l03250"></a>03250             debuglog.warning(<span class="stringliteral">&quot;reduce/reduce conflict in state %d resolved using rule (%s)&quot;</span>, state, rule)
<a name="l03251"></a>03251             debuglog.warning(<span class="stringliteral">&quot;rejected rule (%s) in state %d&quot;</span>, rejected,state)
<a name="l03252"></a>03252             errorlog.warning(<span class="stringliteral">&quot;reduce/reduce conflict in state %d resolved using rule (%s)&quot;</span>, state, rule)
<a name="l03253"></a>03253             errorlog.warning(<span class="stringliteral">&quot;rejected rule (%s) in state %d&quot;</span>, rejected, state)
<a name="l03254"></a>03254             already_reported[state,<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(rule),<a class="code" href="../../d2/d7d/jsapi_8h.html#a5a0801283c5c25416c0888dc53f332d0">id</a>(rejected)] = 1
<a name="l03255"></a>03255         
<a name="l03256"></a>03256         warned_never = []
<a name="l03257"></a>03257         <span class="keywordflow">for</span> state, rule, rejected <span class="keywordflow">in</span> lr.rr_conflicts:
<a name="l03258"></a>03258             <span class="keywordflow">if</span> <span class="keywordflow">not</span> rejected.reduced <span class="keywordflow">and</span> (rejected <span class="keywordflow">not</span> <span class="keywordflow">in</span> warned_never):
<a name="l03259"></a>03259                 debuglog.warning(<span class="stringliteral">&quot;Rule (%s) is never reduced&quot;</span>, rejected)
<a name="l03260"></a>03260                 errorlog.warning(<span class="stringliteral">&quot;Rule (%s) is never reduced&quot;</span>, rejected)
<a name="l03261"></a>03261                 warned_never.append(rejected)
<a name="l03262"></a>03262 
<a name="l03263"></a>03263     <span class="comment"># Write the table file if requested</span>
<a name="l03264"></a>03264     <span class="keywordflow">if</span> write_tables:
<a name="l03265"></a>03265         lr.write_table(tabmodule,outputdir,signature)
<a name="l03266"></a>03266 
<a name="l03267"></a>03267     <span class="comment"># Write a pickled version of the tables</span>
<a name="l03268"></a>03268     <span class="keywordflow">if</span> picklefile:
<a name="l03269"></a>03269         lr.pickle_table(picklefile,signature)
<a name="l03270"></a>03270 
<a name="l03271"></a>03271     <span class="comment"># Build the parser</span>
<a name="l03272"></a>03272     lr.bind_callables(pinfo.pdict)
<a name="l03273"></a>03273     parser = <a class="code" href="../../d7/d00/classply_1_1yacc_1_1_l_r_parser.html">LRParser</a>(lr,pinfo.error_func)
<a name="l03274"></a>03274 
<a name="l03275"></a>03275     parse = parser.parse
<a name="l03276"></a>03276     <span class="keywordflow">return</span> parser
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d8/d61/yacc_8py.html">yacc.py</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:41に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
