<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: gaia_test.py ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d8/dfd/gaia__test_8py.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">gaia_test.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d8/dfd/gaia__test_8py.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../d3/dd6/namespacegaiatest_1_1gaia__test.html">00001</a> <span class="comment"># This Source Code Form is subject to the terms of the Mozilla Public</span>
<a name="l00002"></a>00002 <span class="comment"># License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a name="l00003"></a>00003 <span class="comment"># file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="keyword">import</span> json
<a name="l00006"></a>00006 <span class="keyword">import</span> os
<a name="l00007"></a>00007 <span class="keyword">import</span> sys
<a name="l00008"></a>00008 <span class="keyword">import</span> time
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keyword">from</span> marionette <span class="keyword">import</span> MarionetteTestCase
<a name="l00011"></a>00011 <span class="keyword">from</span> marionette.by <span class="keyword">import</span> By
<a name="l00012"></a>00012 <span class="keyword">from</span> marionette.errors <span class="keyword">import</span> NoSuchElementException
<a name="l00013"></a>00013 <span class="keyword">from</span> marionette.errors <span class="keyword">import</span> ElementNotVisibleException
<a name="l00014"></a>00014 <span class="keyword">from</span> marionette.errors <span class="keyword">import</span> TimeoutException
<a name="l00015"></a>00015 <span class="keyword">from</span> marionette.errors <span class="keyword">import</span> StaleElementException
<a name="l00016"></a>00016 <span class="keyword">from</span> marionette.errors <span class="keyword">import</span> InvalidResponseException
<a name="l00017"></a>00017 <span class="keyword">import</span> mozdevice
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html">00020</a> <span class="keyword">class </span><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html">LockScreen</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#ab6c4c651911e3ab9a283d5b8ebf3682e">00022</a>     <span class="keyword">def </span><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#a6a09a193c95a77dfe6f4888aaf7dadf0">__init__</a>(self, marionette):
<a name="l00023"></a>00023         self.<a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#ab6c4c651911e3ab9a283d5b8ebf3682e">marionette</a> = marionette
<a name="l00024"></a>00024         js = os.path.abspath(os.path.join(__file__, os.path.pardir, <span class="stringliteral">&#39;atoms&#39;</span>, <span class="stringliteral">&quot;gaia_lock_screen.js&quot;</span>))
<a name="l00025"></a>00025         self.marionette.import_script(js)
<a name="l00026"></a>00026 
<a name="l00027"></a>00027     @property
<a name="l00028"></a><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#ac2cd1639707c072ac4e95e242020ac2e">00028</a>     <span class="keyword">def </span><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#ac2cd1639707c072ac4e95e242020ac2e">is_locked</a>(self):
<a name="l00029"></a>00029         self.marionette.switch_to_frame()
<a name="l00030"></a>00030         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&#39;window.wrappedJSObject.LockScreen.locked&#39;</span>)
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#a6c84ee30713036d5e82e4e290789eb52">00032</a>     <span class="keyword">def </span><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#a6c84ee30713036d5e82e4e290789eb52">lock</a>(self):
<a name="l00033"></a>00033         self.marionette.switch_to_frame()
<a name="l00034"></a>00034         result = self.marionette.execute_async_script(<span class="stringliteral">&#39;GaiaLockScreen.lock()&#39;</span>)
<a name="l00035"></a>00035         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to lock screen&#39;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#a2b84c76a1a2f14a2ef4278604f30ce67">00037</a>     <span class="keyword">def </span><a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html#a2b84c76a1a2f14a2ef4278604f30ce67">unlock</a>(self):
<a name="l00038"></a>00038         self.marionette.switch_to_frame()
<a name="l00039"></a>00039         result = self.marionette.execute_async_script(<span class="stringliteral">&#39;GaiaLockScreen.unlock()&#39;</span>)
<a name="l00040"></a>00040         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to unlock screen&#39;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html">00043</a> <span class="keyword">class </span><a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html">GaiaApp</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#ac570cdb3d6e50ed1d0979ff67bb82463">00045</a>     <span class="keyword">def </span><a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#a8da45afcfbfe6d311183d0c2b32423f7">__init__</a>(self, origin=None, name=None, frame=None, src=None):
<a name="l00046"></a>00046         self.<a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#a8eccd851fe407c244cb7c7dddccc29e2">frame</a> = frame
<a name="l00047"></a>00047         self.<a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#a59f8bf8f5fc08bd2d70baaed87d3075e">frame_id</a> = frame
<a name="l00048"></a>00048         self.<a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#ac570cdb3d6e50ed1d0979ff67bb82463">src</a> = src
<a name="l00049"></a>00049         self.<a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#aa597616e6064ea44a1893afaebc31a3a">name</a> = name
<a name="l00050"></a>00050         self.<a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#af8a54177abd7c87dcd706d24b03f08d5">origin</a> = origin
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#a1122fa7c38ac9fa72f4675fad6fef093">00052</a>     <span class="keyword">def </span><a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#a1122fa7c38ac9fa72f4675fad6fef093">__eq__</a>(self, other):
<a name="l00053"></a>00053         <span class="keywordflow">return</span> self.<a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html#a99be7362fff7df30d68724c00866c42e">__dict__</a> == other.__dict__
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html">00056</a> <span class="keyword">class </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html">GaiaApps</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a8759ccc44f3345da4452c727f0444a2a">00058</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a454dd25c82c362c684ba5fceed911226">__init__</a>(self, marionette):
<a name="l00059"></a>00059         self.<a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a8759ccc44f3345da4452c727f0444a2a">marionette</a> = marionette
<a name="l00060"></a>00060         js = os.path.abspath(os.path.join(__file__, os.path.pardir, <span class="stringliteral">&#39;atoms&#39;</span>, <span class="stringliteral">&quot;gaia_apps.js&quot;</span>))
<a name="l00061"></a>00061         self.marionette.import_script(js)
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#ae68a5d92ba4f78d1217d1817886d3fc7">00063</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#ae68a5d92ba4f78d1217d1817886d3fc7">get_permission</a>(self, app_name, permission_name):
<a name="l00064"></a>00064         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaApps.getPermission(&#39;%s&#39;, &#39;%s&#39;)&quot;</span> % (app_name, permission_name))
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a60d237bba3a28e7306e88113fd6b80f4">00066</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a60d237bba3a28e7306e88113fd6b80f4">set_permission</a>(self, app_name, permission_name, value):
<a name="l00067"></a>00067         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaApps.setPermission(&#39;%s&#39;, &#39;%s&#39;, &#39;%s&#39;)&quot;</span> %
<a name="l00068"></a>00068                                                     (app_name, permission_name, value))
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#aa3f14cd5d9c1f6776cdab0c728406404">00070</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#aa3f14cd5d9c1f6776cdab0c728406404">launch</a>(self, name, switch_to_frame=True, url=None, launch_timeout=None):
<a name="l00071"></a>00071         self.marionette.switch_to_frame()
<a name="l00072"></a>00072         result = self.marionette.execute_async_script(<span class="stringliteral">&quot;GaiaApps.launchWithName(&#39;%s&#39;)&quot;</span> % name, script_timeout=launch_timeout)
<a name="l00073"></a>00073         <span class="keyword">assert</span> result, <span class="stringliteral">&quot;Failed to launch app with name &#39;%s&#39;&quot;</span> % name
<a name="l00074"></a>00074         app = <a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html">GaiaApp</a>(frame=result.get(<span class="stringliteral">&#39;frame&#39;</span>),
<a name="l00075"></a>00075                       src=result.get(<span class="stringliteral">&#39;src&#39;</span>),
<a name="l00076"></a>00076                       name=result.get(<span class="stringliteral">&#39;name&#39;</span>),
<a name="l00077"></a>00077                       origin=result.get(<span class="stringliteral">&#39;origin&#39;</span>))
<a name="l00078"></a>00078         <span class="keywordflow">if</span> app.frame_id <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00079"></a>00079             <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;App failed to launch; there is no app frame&quot;</span>)
<a name="l00080"></a>00080         <span class="keywordflow">if</span> switch_to_frame:
<a name="l00081"></a>00081             self.<a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#ae8fd92798a8f01a9539d122ee0eda180">switch_to_frame</a>(app.frame_id, url)
<a name="l00082"></a>00082         <span class="keywordflow">return</span> app
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     @property
<a name="l00085"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a8871a189f29e4cdbac33561da68e0fea">00085</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a8871a189f29e4cdbac33561da68e0fea">displayed_app</a>(self):
<a name="l00086"></a>00086         self.marionette.switch_to_frame()
<a name="l00087"></a>00087         result = self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaApps.displayedApp();&#39;</span>)
<a name="l00088"></a>00088         <span class="keywordflow">return</span> <a class="code" href="../../d9/d28/classgaiatest_1_1gaia__test_1_1_gaia_app.html">GaiaApp</a>(frame=result.get(<span class="stringliteral">&#39;frame&#39;</span>),
<a name="l00089"></a>00089                        src=result.get(<span class="stringliteral">&#39;src&#39;</span>),
<a name="l00090"></a>00090                        name=result.get(<span class="stringliteral">&#39;name&#39;</span>),
<a name="l00091"></a>00091                        origin=result.get(<span class="stringliteral">&#39;origin&#39;</span>))
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#afd9e1e71d40f0825496132f8d55fdf46">00093</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#afd9e1e71d40f0825496132f8d55fdf46">is_app_installed</a>(self, app_name):
<a name="l00094"></a>00094         self.marionette.switch_to_frame()
<a name="l00095"></a>00095         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&quot;GaiaApps.locateWithName(&#39;%s&#39;)&quot;</span> % app_name)
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a7f59b9576b01d27c268d08958fa3dcc1">00097</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a7f59b9576b01d27c268d08958fa3dcc1">uninstall</a>(self, name):
<a name="l00098"></a>00098         self.marionette.switch_to_frame()
<a name="l00099"></a>00099         self.marionette.execute_async_script(<span class="stringliteral">&quot;GaiaApps.uninstallWithName(&#39;%s&#39;)&quot;</span> % name)
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a918958dea65b98b4400f4affd17ded27">00101</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a918958dea65b98b4400f4affd17ded27">kill</a>(self, app):
<a name="l00102"></a>00102         self.marionette.switch_to_frame()
<a name="l00103"></a>00103         js = os.path.abspath(os.path.join(__file__, os.path.pardir, <span class="stringliteral">&#39;atoms&#39;</span>, <span class="stringliteral">&quot;gaia_apps.js&quot;</span>))
<a name="l00104"></a>00104         self.marionette.import_script(js)
<a name="l00105"></a>00105         result = self.marionette.execute_async_script(<span class="stringliteral">&quot;GaiaApps.kill(&#39;%s&#39;);&quot;</span> % app.origin)
<a name="l00106"></a>00106         <span class="keyword">assert</span> result, <span class="stringliteral">&quot;Failed to kill app with name &#39;%s&#39;&quot;</span> % app.name
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#aab8c969e59e96bb2700837c9c81c8d78">00108</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#aab8c969e59e96bb2700837c9c81c8d78">kill_all</a>(self):
<a name="l00109"></a>00109         self.marionette.switch_to_frame()
<a name="l00110"></a>00110         js = os.path.abspath(os.path.join(__file__, os.path.pardir, <span class="stringliteral">&#39;atoms&#39;</span>, <span class="stringliteral">&quot;gaia_apps.js&quot;</span>))
<a name="l00111"></a>00111         self.marionette.import_script(js)
<a name="l00112"></a>00112         self.marionette.execute_async_script(<span class="stringliteral">&quot;GaiaApps.killAll()&quot;</span>)
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a26c209b1b327a7aca92291ad21a4e3c2">00114</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#a26c209b1b327a7aca92291ad21a4e3c2">runningApps</a>(self):
<a name="l00115"></a>00115         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&quot;return GaiaApps.getRunningApps()&quot;</span>)
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#ae8fd92798a8f01a9539d122ee0eda180">00117</a>     <span class="keyword">def </span><a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html#ae8fd92798a8f01a9539d122ee0eda180">switch_to_frame</a>(self, app_frame, url=None, timeout=30):
<a name="l00118"></a>00118         self.marionette.switch_to_frame(app_frame)
<a name="l00119"></a>00119         start = time.time()
<a name="l00120"></a>00120         <span class="keywordflow">if</span> <span class="keywordflow">not</span> url:
<a name="l00121"></a>00121             <span class="keyword">def </span><a class="code" href="../../d1/d5b/namespacejcconv.html#a846efc552618562a262a88978ef66841">check</a>(now):
<a name="l00122"></a>00122                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;about:blank&quot;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> now
<a name="l00123"></a>00123         <span class="keywordflow">else</span>:
<a name="l00124"></a>00124             <span class="keyword">def </span><a class="code" href="../../d1/d5b/namespacejcconv.html#a846efc552618562a262a88978ef66841">check</a>(now):
<a name="l00125"></a>00125                 <span class="keywordflow">return</span> url <span class="keywordflow">in</span> now
<a name="l00126"></a>00126         <span class="keywordflow">while</span> (time.time() - start &lt; timeout):
<a name="l00127"></a>00127             <span class="keywordflow">if</span> <a class="code" href="../../d1/d5b/namespacejcconv.html#a846efc552618562a262a88978ef66841">check</a>(self.marionette.get_url()):
<a name="l00128"></a>00128                 <span class="keywordflow">return</span>
<a name="l00129"></a>00129             time.sleep(2)
<a name="l00130"></a>00130         <span class="keywordflow">raise</span> TimeoutException(<span class="stringliteral">&#39;Could not switch to app frame %s in time&#39;</span> % app_frame)
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html">00133</a> <span class="keyword">class </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html">GaiaData</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2edc6d7e7ff48c7e0b877624546331b3">00135</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a368b55ef83d11e5fa4bb6a42932c47d1">__init__</a>(self, marionette, testvars=None):
<a name="l00136"></a>00136         self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2d76299cdc35320b9884b2abf459d4a1">marionette</a> = marionette
<a name="l00137"></a>00137         self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2edc6d7e7ff48c7e0b877624546331b3">testvars</a> = testvars <span class="keywordflow">or</span> {}
<a name="l00138"></a>00138         js = os.path.abspath(os.path.join(__file__, os.path.pardir, <span class="stringliteral">&#39;atoms&#39;</span>, <span class="stringliteral">&quot;gaia_data_layer.js&quot;</span>))
<a name="l00139"></a>00139         self.marionette.import_script(js)
<a name="l00140"></a>00140         self.marionette.set_search_timeout(10000)
<a name="l00141"></a>00141 
<a name="l00142"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a60acd43032379a3a7a2bab26df44131c">00142</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a60acd43032379a3a7a2bab26df44131c">set_time</a>(self, date_number):
<a name="l00143"></a>00143         self.marionette.set_context(self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2d76299cdc35320b9884b2abf459d4a1">marionette</a>.CONTEXT_CHROME)
<a name="l00144"></a>00144         self.marionette.execute_script(<span class="stringliteral">&quot;window.navigator.mozTime.set(%s);&quot;</span> % date_number)
<a name="l00145"></a>00145         self.marionette.set_context(self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2d76299cdc35320b9884b2abf459d4a1">marionette</a>.CONTEXT_CONTENT)
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     @property
<a name="l00148"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a86fe57b632f803be0d79279e3621613e">00148</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a86fe57b632f803be0d79279e3621613e">all_contacts</a>(self):
<a name="l00149"></a>00149         self.marionette.switch_to_frame()
<a name="l00150"></a>00150         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.getAllContacts();&#39;</span>, special_powers=<span class="keyword">True</span>)
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     @property
<a name="l00153"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a7552d1b96b6f648d5312abdbbb551be4">00153</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a7552d1b96b6f648d5312abdbbb551be4">sim_contacts</a>(self):
<a name="l00154"></a>00154         self.marionette.switch_to_frame()
<a name="l00155"></a>00155         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.getSIMContacts();&#39;</span>, special_powers=<span class="keyword">True</span>)
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ab5c657405347f9f97f23453fcfe605c9">00157</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ab5c657405347f9f97f23453fcfe605c9">insert_contact</a>(self, contact):
<a name="l00158"></a>00158         self.marionette.switch_to_frame()
<a name="l00159"></a>00159         result = self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.insertContact(%s);&#39;</span> % json.dumps(contact), special_powers=<span class="keyword">True</span>)
<a name="l00160"></a>00160         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to insert contact %s&#39;</span> % contact
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a852fbebd1ed8f184115594df3cfe107f">00162</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a852fbebd1ed8f184115594df3cfe107f">remove_all_contacts</a>(self, default_script_timeout=60000):
<a name="l00163"></a>00163         self.marionette.switch_to_frame()
<a name="l00164"></a>00164         self.marionette.set_script_timeout(<a class="code" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a>(default_script_timeout, 1000 * len(self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a86fe57b632f803be0d79279e3621613e">all_contacts</a>)))
<a name="l00165"></a>00165         result = self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.removeAllContacts();&#39;</span>, special_powers=<span class="keyword">True</span>)
<a name="l00166"></a>00166         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to remove all contacts&#39;</span>
<a name="l00167"></a>00167         self.marionette.set_script_timeout(default_script_timeout)
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2e34c9598f6160e570e9b07957c211ce">00169</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2e34c9598f6160e570e9b07957c211ce">get_setting</a>(self, name):
<a name="l00170"></a>00170         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.getSetting(&quot;%s&quot;)&#39;</span> % name, special_powers=<span class="keyword">True</span>)
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     @property
<a name="l00173"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a0c11bb820984190ff2c9ca6d2544dcc2">00173</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a0c11bb820984190ff2c9ca6d2544dcc2">all_settings</a>(self):
<a name="l00174"></a>00174         <span class="keywordflow">return</span> self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2e34c9598f6160e570e9b07957c211ce">get_setting</a>(<span class="stringliteral">&#39;*&#39;</span>)
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#aa4926ed23380855ae9ea95424da5e9cc">00176</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#aa4926ed23380855ae9ea95424da5e9cc">set_setting</a>(self, name, value):
<a name="l00177"></a>00177         <span class="keyword">import</span> json
<a name="l00178"></a>00178         value = json.dumps(value)
<a name="l00179"></a>00179         result = self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.setSetting(&quot;%s&quot;, %s)&#39;</span> % (name, value), special_powers=<span class="keyword">True</span>)
<a name="l00180"></a>00180         <span class="keyword">assert</span> result, <span class="stringliteral">&quot;Unable to change setting with name &#39;%s&#39; to &#39;%s&#39;&quot;</span> % (name, value)
<a name="l00181"></a>00181 
<a name="l00182"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a34fb019653b662c6c9905a28a91e36b3">00182</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a34fb019653b662c6c9905a28a91e36b3">set_volume</a>(self, value):
<a name="l00183"></a>00183         channels = [<span class="stringliteral">&#39;master&#39;</span>, <span class="stringliteral">&#39;content&#39;</span>, <span class="stringliteral">&#39;notification&#39;</span>, <span class="stringliteral">&#39;alarm&#39;</span>, <span class="stringliteral">&#39;telephony&#39;</span>, <span class="stringliteral">&#39;bt_sco&#39;</span>]
<a name="l00184"></a>00184         <span class="keywordflow">for</span> channel <span class="keywordflow">in</span> channels:
<a name="l00185"></a>00185             self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#aa4926ed23380855ae9ea95424da5e9cc">set_setting</a>(<span class="stringliteral">&#39;audio.volume.%s&#39;</span> % channel, value)
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a5eda4e1ad41cb3f7e2fc799b6c3f8dd1">00187</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a5eda4e1ad41cb3f7e2fc799b6c3f8dd1">bluetooth_enable</a>(self):
<a name="l00188"></a>00188         self.marionette.switch_to_frame()
<a name="l00189"></a>00189         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaDataLayer.enableBluetooth()&quot;</span>)
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ad0e6ca778259b6df1bdea820526ee749">00191</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ad0e6ca778259b6df1bdea820526ee749">bluetooth_disable</a>(self):
<a name="l00192"></a>00192         self.marionette.switch_to_frame()
<a name="l00193"></a>00193         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaDataLayer.disableBluetooth()&quot;</span>)
<a name="l00194"></a>00194 
<a name="l00195"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ac08ca0e5f4cd1282aa137d94920ec822">00195</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ac08ca0e5f4cd1282aa137d94920ec822">bluetooth_pair_device</a>(self, device_name):
<a name="l00196"></a>00196         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.pairBluetoothDevice(&quot;%s&quot;)&#39;</span> % device_name)
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a92b5e339bb1670fcceb1dee26e4c827a">00198</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a92b5e339bb1670fcceb1dee26e4c827a">bluetooth_unpair_all_devices</a>(self):
<a name="l00199"></a>00199         self.marionette.switch_to_frame()
<a name="l00200"></a>00200         self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.unpairAllBluetoothDevices()&#39;</span>)
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#abda65a8ab1c80066fd229c4992dadd8b">00202</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#abda65a8ab1c80066fd229c4992dadd8b">bluetooth_set_device_name</a>(self, device_name):
<a name="l00203"></a>00203         result = self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.bluetoothSetDeviceName(%s);&#39;</span> % device_name)
<a name="l00204"></a>00204         <span class="keyword">assert</span> result, <span class="stringliteral">&quot;Unable to set device&#39;s bluetooth name to %s&quot;</span> % device_name
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#abaa0eebc963bdc7a5a91a274d907f1f8">00206</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#abaa0eebc963bdc7a5a91a274d907f1f8">bluetooth_set_device_discoverable_mode</a>(self, discoverable):
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (discoverable):
<a name="l00208"></a>00208             result = self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.bluetoothSetDeviceDiscoverableMode(true);&#39;</span>)
<a name="l00209"></a>00209         <span class="keywordflow">else</span>:
<a name="l00210"></a>00210             result = self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.bluetoothSetDeviceDiscoverableMode(false);&#39;</span>)
<a name="l00211"></a>00211         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Able to set the device bluetooth discoverable mode&#39;</span>
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     @property
<a name="l00214"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a611b783b6967a4ef6dbc84adcb5915a9">00214</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a611b783b6967a4ef6dbc84adcb5915a9">bluetooth_is_enabled</a>(self):
<a name="l00215"></a>00215         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&quot;return window.navigator.mozBluetooth.enabled&quot;</span>)
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     @property
<a name="l00218"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a19a5bbea9cdea3509f9ae4c3af8e7e1f">00218</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a19a5bbea9cdea3509f9ae4c3af8e7e1f">is_cell_data_enabled</a>(self):
<a name="l00219"></a>00219         <span class="keywordflow">return</span> self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2e34c9598f6160e570e9b07957c211ce">get_setting</a>(<span class="stringliteral">&#39;ril.data.enabled&#39;</span>)
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a3aff5b5ed8bb10b78080743101e7daab">00221</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a3aff5b5ed8bb10b78080743101e7daab">connect_to_cell_data</a>(self):
<a name="l00222"></a>00222         self.marionette.switch_to_frame()
<a name="l00223"></a>00223         result = self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaDataLayer.connectToCellData()&quot;</span>, special_powers=<span class="keyword">True</span>)
<a name="l00224"></a>00224         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to connect to cell data&#39;</span>
<a name="l00225"></a>00225 
<a name="l00226"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ac92def85fbbdcb6cad5026ea33b9495a">00226</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ac92def85fbbdcb6cad5026ea33b9495a">disable_cell_data</a>(self):
<a name="l00227"></a>00227         self.marionette.switch_to_frame()
<a name="l00228"></a>00228         result = self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaDataLayer.disableCellData()&quot;</span>, special_powers=<span class="keyword">True</span>)
<a name="l00229"></a>00229         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to disable cell data&#39;</span>
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     @property
<a name="l00232"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a89ec490a76eb68124d94ee74d6addc7b">00232</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a89ec490a76eb68124d94ee74d6addc7b">is_cell_data_connected</a>(self):
<a name="l00233"></a>00233         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&quot;return window.navigator.mozMobileConnection.data.connected;&quot;</span>)
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#abf5e5319bb5841604a9e6077e06c6d03">00235</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#abf5e5319bb5841604a9e6077e06c6d03">enable_cell_roaming</a>(self):
<a name="l00236"></a>00236         self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#aa4926ed23380855ae9ea95424da5e9cc">set_setting</a>(<span class="stringliteral">&#39;ril.data.roaming_enabled&#39;</span>, <span class="keyword">True</span>)
<a name="l00237"></a>00237 
<a name="l00238"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ad9182061bbcdefdf49d17033b8122d6d">00238</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ad9182061bbcdefdf49d17033b8122d6d">disable_cell_roaming</a>(self):
<a name="l00239"></a>00239         self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#aa4926ed23380855ae9ea95424da5e9cc">set_setting</a>(<span class="stringliteral">&#39;ril.data.roaming_enabled&#39;</span>, <span class="keyword">False</span>)
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     @property
<a name="l00242"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a396ead2359b531aec7599924e4baff20">00242</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a396ead2359b531aec7599924e4baff20">is_wifi_enabled</a>(self):
<a name="l00243"></a>00243         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&quot;return window.navigator.mozWifiManager.enabled;&quot;</span>)
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#affcc2a826a8a7717764e76821d8821b1">00245</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#affcc2a826a8a7717764e76821d8821b1">enable_wifi</a>(self):
<a name="l00246"></a>00246         self.marionette.switch_to_frame()
<a name="l00247"></a>00247         result = self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaDataLayer.enableWiFi()&quot;</span>, special_powers=<span class="keyword">True</span>)
<a name="l00248"></a>00248         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to enable WiFi&#39;</span>
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a91c89357d2a20eb248a424947a3ca11e">00250</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a91c89357d2a20eb248a424947a3ca11e">disable_wifi</a>(self):
<a name="l00251"></a>00251         self.marionette.switch_to_frame()
<a name="l00252"></a>00252         result = self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaDataLayer.disableWiFi()&quot;</span>, special_powers=<span class="keyword">True</span>)
<a name="l00253"></a>00253         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to disable WiFi&#39;</span>
<a name="l00254"></a>00254 
<a name="l00255"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2a349bd33232b42401be5d5614291010">00255</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a2a349bd33232b42401be5d5614291010">connect_to_wifi</a>(self, network=None):
<a name="l00256"></a>00256         network = network <span class="keywordflow">or</span> self.testvars.get(<span class="stringliteral">&#39;wifi&#39;</span>)
<a name="l00257"></a>00257         <span class="keyword">assert</span> network, <span class="stringliteral">&#39;No WiFi network provided&#39;</span>
<a name="l00258"></a>00258         self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#affcc2a826a8a7717764e76821d8821b1">enable_wifi</a>()
<a name="l00259"></a>00259         self.marionette.switch_to_frame()
<a name="l00260"></a>00260         result = self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaDataLayer.connectToWiFi(%s)&quot;</span> % json.dumps(network))
<a name="l00261"></a>00261         <span class="keyword">assert</span> result, <span class="stringliteral">&#39;Unable to connect to WiFi network&#39;</span>
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ae7717c7cdae27641f25cf1b4cda19c08">00263</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ae7717c7cdae27641f25cf1b4cda19c08">forget_all_networks</a>(self):
<a name="l00264"></a>00264         self.marionette.switch_to_frame()
<a name="l00265"></a>00265         self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.forgetAllNetworks()&#39;</span>)
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a7de55a1ad16f9173c8872fd2288a9faf">00267</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a7de55a1ad16f9173c8872fd2288a9faf">is_wifi_connected</a>(self, network=None):
<a name="l00268"></a>00268         network = network <span class="keywordflow">or</span> self.testvars.get(<span class="stringliteral">&#39;wifi&#39;</span>)
<a name="l00269"></a>00269         <span class="keyword">assert</span> network, <span class="stringliteral">&#39;No WiFi network provided&#39;</span>
<a name="l00270"></a>00270         self.marionette.switch_to_frame()
<a name="l00271"></a>00271         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&quot;return GaiaDataLayer.isWiFiConnected(%s)&quot;</span> % json.dumps(network))
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     @property
<a name="l00274"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a7c24e17fc1c4c625c51dc3c0077d9505">00274</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a7c24e17fc1c4c625c51dc3c0077d9505">known_networks</a>(self):
<a name="l00275"></a>00275         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&#39;return GaiaDataLayer.getKnownNetworks()&#39;</span>)
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     @property
<a name="l00278"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a1a5536587ce3f505f66433ad5723f573">00278</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a1a5536587ce3f505f66433ad5723f573">active_telephony_state</a>(self):
<a name="l00279"></a>00279         <span class="comment"># Returns the state of only the currently active call or None if no active call</span>
<a name="l00280"></a>00280         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&quot;return GaiaDataLayer.getMozTelephonyState()&quot;</span>)
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     @property
<a name="l00283"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#af35d8aa1a585d600a5e321ab9ca2504a">00283</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#af35d8aa1a585d600a5e321ab9ca2504a">is_antenna_available</a>(self):
<a name="l00284"></a>00284         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&#39;return window.navigator.mozFMRadio.antennaAvailable&#39;</span>)
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     @property
<a name="l00287"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#afb184b5a1727e56c657add34bc22e6bf">00287</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#afb184b5a1727e56c657add34bc22e6bf">is_fm_radio_enabled</a>(self):
<a name="l00288"></a>00288         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&#39;return window.navigator.mozFMRadio.enabled&#39;</span>)
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     @property
<a name="l00291"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a80f69c7809699ef3ad5b08728c0603e1">00291</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a80f69c7809699ef3ad5b08728c0603e1">fm_radio_frequency</a>(self):
<a name="l00292"></a>00292         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&#39;return window.navigator.mozFMRadio.frequency&#39;</span>)
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     @property
<a name="l00295"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ada66e4c8b57d0e3f7854c76df4a840ad">00295</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ada66e4c8b57d0e3f7854c76df4a840ad">media_files</a>(self):
<a name="l00296"></a>00296         result = []
<a name="l00297"></a>00297         result.extend(self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#aa8b7aea9e1c71c04af5e9f27da298d1a">music_files</a>)
<a name="l00298"></a>00298         result.extend(self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a575d97ded92d64800cb3cae20a29331c">picture_files</a>)
<a name="l00299"></a>00299         result.extend(self.<a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a0c6ba337746d867b976fffc9837e6b0e">video_files</a>)
<a name="l00300"></a>00300         <span class="keywordflow">return</span> result
<a name="l00301"></a>00301 
<a name="l00302"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a9e8302976c2c5d46185eab7c5026c12a">00302</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a9e8302976c2c5d46185eab7c5026c12a">delete_all_sms</a>(self):
<a name="l00303"></a>00303         self.marionette.switch_to_frame()
<a name="l00304"></a>00304         <span class="keywordflow">return</span> self.marionette.execute_async_script(<span class="stringliteral">&quot;return GaiaDataLayer.deleteAllSms();&quot;</span>, special_powers=<span class="keyword">True</span>)
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ac6c8d2edb5e86b01e18130eea29aaca3">00306</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#ac6c8d2edb5e86b01e18130eea29aaca3">delete_all_call_log_entries</a>(self):
<a name="l00307"></a>00307         <span class="stringliteral">&quot;&quot;&quot;The call log needs to be open and focused in order for this to work.&quot;&quot;&quot;</span>
<a name="l00308"></a>00308         self.marionette.execute_script(<span class="stringliteral">&#39;window.wrappedJSObject.RecentsDBManager.deleteAll();&#39;</span>)
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a5aef26c0683b91231cc5be7d418e8b18">00310</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a5aef26c0683b91231cc5be7d418e8b18">kill_active_call</a>(self):
<a name="l00311"></a>00311         self.marionette.execute_script(<span class="stringliteral">&quot;var telephony = window.navigator.mozTelephony; &quot;</span> +
<a name="l00312"></a>00312                                        <span class="stringliteral">&quot;if(telephony.active) telephony.active.hangUp();&quot;</span>)
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     @property
<a name="l00315"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#aa8b7aea9e1c71c04af5e9f27da298d1a">00315</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#aa8b7aea9e1c71c04af5e9f27da298d1a">music_files</a>(self):
<a name="l00316"></a>00316         <span class="keywordflow">return</span> self.marionette.execute_async_script(
<a name="l00317"></a>00317             <span class="stringliteral">&#39;return GaiaDataLayer.getAllMusic();&#39;</span>)
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     @property
<a name="l00320"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a575d97ded92d64800cb3cae20a29331c">00320</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a575d97ded92d64800cb3cae20a29331c">picture_files</a>(self):
<a name="l00321"></a>00321         <span class="keywordflow">return</span> self.marionette.execute_async_script(
<a name="l00322"></a>00322             <span class="stringliteral">&#39;return GaiaDataLayer.getAllPictures();&#39;</span>)
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     @property
<a name="l00325"></a><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a0c6ba337746d867b976fffc9837e6b0e">00325</a>     <span class="keyword">def </span><a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html#a0c6ba337746d867b976fffc9837e6b0e">video_files</a>(self):
<a name="l00326"></a>00326         <span class="keywordflow">return</span> self.marionette.execute_async_script(
<a name="l00327"></a>00327             <span class="stringliteral">&#39;return GaiaDataLayer.getAllVideos();&#39;</span>)
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html">00330</a> <span class="keyword">class </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html">GaiaDevice</a>(<a class="code" href="../../d5/d62/build__stage_2email_2shared_2style_2_r_e_a_d_m_e_8md.html#a3324c12c8fd4a56057ace952fd0d4bc5">object</a>):
<a name="l00331"></a>00331 
<a name="l00332"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a61a6e5ef1946d0650bcf528b42db61c5">00332</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a4c59956891fea58611eb952056103a5d">__init__</a>(self, marionette, testvars=None):
<a name="l00333"></a>00333         self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a279c9fba0dc47f8f0798b797e500a062">marionette</a> = marionette
<a name="l00334"></a>00334         self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a61a6e5ef1946d0650bcf528b42db61c5">testvars</a> = testvars <span class="keywordflow">or</span> {}
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     @property
<a name="l00337"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a4bb55e27f6d070e632c77341b212fded">00337</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a4bb55e27f6d070e632c77341b212fded">manager</a>(self):
<a name="l00338"></a>00338         <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;_manager&#39;</span>) <span class="keywordflow">and</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a4d28ccb30160e3ec75de76cdc6284d4a">_manager</a>:
<a name="l00339"></a>00339             <span class="keywordflow">return</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a4d28ccb30160e3ec75de76cdc6284d4a">_manager</a>
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a1a856fc988b11d166e30af4b6d97d20a">is_android_build</a>:
<a name="l00342"></a>00342             <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Device manager is only available for devices.&#39;</span>)
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         dm_type = os.environ.get(<span class="stringliteral">&#39;DM_TRANS&#39;</span>, <span class="stringliteral">&#39;adb&#39;</span>)
<a name="l00345"></a>00345         <span class="keywordflow">if</span> dm_type == <span class="stringliteral">&#39;adb&#39;</span>:
<a name="l00346"></a>00346             self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a4d28ccb30160e3ec75de76cdc6284d4a">_manager</a> = mozdevice.DeviceManagerADB()
<a name="l00347"></a>00347         <span class="keywordflow">elif</span> dm_type == <span class="stringliteral">&#39;sut&#39;</span>:
<a name="l00348"></a>00348             host = os.environ.get(<span class="stringliteral">&#39;TEST_DEVICE&#39;</span>)
<a name="l00349"></a>00349             <span class="keywordflow">if</span> <span class="keywordflow">not</span> host:
<a name="l00350"></a>00350                 <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Must specify host with SUT!&#39;</span>)
<a name="l00351"></a>00351             self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a4d28ccb30160e3ec75de76cdc6284d4a">_manager</a> = mozdevice.DeviceManagerSUT(host=host)
<a name="l00352"></a>00352         <span class="keywordflow">else</span>:
<a name="l00353"></a>00353             <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Unknown device manager type: %s&#39;</span> % dm_type)
<a name="l00354"></a>00354         <span class="keywordflow">return</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a4d28ccb30160e3ec75de76cdc6284d4a">_manager</a>
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     @property
<a name="l00357"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a1a856fc988b11d166e30af4b6d97d20a">00357</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a1a856fc988b11d166e30af4b6d97d20a">is_android_build</a>(self):
<a name="l00358"></a>00358         <span class="keywordflow">if</span> self.testvars.get(<span class="stringliteral">&#39;is_android_build&#39;</span>) <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00359"></a>00359             self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a61a6e5ef1946d0650bcf528b42db61c5">testvars</a>[<span class="stringliteral">&#39;is_android_build&#39;</span>] = <span class="stringliteral">&#39;Android&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a279c9fba0dc47f8f0798b797e500a062">marionette</a>.session_capabilities[<span class="stringliteral">&#39;platform&#39;</span>]
<a name="l00360"></a>00360         <span class="keywordflow">return</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a61a6e5ef1946d0650bcf528b42db61c5">testvars</a>[<span class="stringliteral">&#39;is_android_build&#39;</span>]
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     @property
<a name="l00363"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#aa60f569cb1818d519512e78057bc6794">00363</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#aa60f569cb1818d519512e78057bc6794">is_online</a>(self):
<a name="l00364"></a>00364         <span class="comment"># Returns true if the device has a network connection established (cell data, wifi, etc)</span>
<a name="l00365"></a>00365         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&#39;return window.navigator.onLine;&#39;</span>)
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     @property
<a name="l00368"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a8db3ebc8921250fc9ae75af6b2a1b9a0">00368</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a8db3ebc8921250fc9ae75af6b2a1b9a0">has_mobile_connection</a>(self):
<a name="l00369"></a>00369         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&#39;return window.navigator.mozMobileConnection !== undefined&#39;</span>)
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     @property
<a name="l00372"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a081c9dfedc2b8d074e4eaf2f7d4907d7">00372</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a081c9dfedc2b8d074e4eaf2f7d4907d7">has_wifi</a>(self):
<a name="l00373"></a>00373         <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;_has_wifi&#39;</span>):
<a name="l00374"></a>00374             self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a41497a3573bd41d1e5b75568ed40a771">_has_wifi</a> = self.marionette.execute_script(<span class="stringliteral">&#39;return window.navigator.mozWifiManager !== undefined&#39;</span>)
<a name="l00375"></a>00375         <span class="keywordflow">return</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a41497a3573bd41d1e5b75568ed40a771">_has_wifi</a>
<a name="l00376"></a>00376 
<a name="l00377"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a00beef7a4d56657baf30cd2a0fa4e471">00377</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a00beef7a4d56657baf30cd2a0fa4e471">push_file</a>(self, source, count=1, destination=&#39;&#39;, progress=None):
<a name="l00378"></a>00378         <span class="keywordflow">if</span> <span class="keywordflow">not</span> destination.count(<span class="stringliteral">&#39;.&#39;</span>) &gt; 0:
<a name="l00379"></a>00379             destination = <span class="stringliteral">&#39;/&#39;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>([destination, source.rpartition(os.path.sep)[-1]])
<a name="l00380"></a>00380         self.manager.mkDirs(destination)
<a name="l00381"></a>00381         self.manager.pushFile(source, destination)
<a name="l00382"></a>00382 
<a name="l00383"></a>00383         <span class="keywordflow">if</span> count &gt; 1:
<a name="l00384"></a>00384             <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, count + 1):
<a name="l00385"></a>00385                 remote_copy = <span class="stringliteral">&#39;_%s.&#39;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>(iter(destination.split(<span class="stringliteral">&#39;.&#39;</span>))) % i
<a name="l00386"></a>00386                 self.manager._checkCmd([<span class="stringliteral">&#39;shell&#39;</span>, <span class="stringliteral">&#39;dd&#39;</span>, <span class="stringliteral">&#39;if=%s&#39;</span> % destination, <span class="stringliteral">&#39;of=%s&#39;</span> % remote_copy])
<a name="l00387"></a>00387                 <span class="keywordflow">if</span> progress:
<a name="l00388"></a>00388                     progress.update(i)
<a name="l00389"></a>00389 
<a name="l00390"></a>00390             self.manager.removeFile(destination)
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a327f9376fd53e44f716abd59b4c00ff0">00392</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a327f9376fd53e44f716abd59b4c00ff0">restart_b2g</a>(self):
<a name="l00393"></a>00393         self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#af82650e38af15a82aa7bf9f4f0f6f1a9">stop_b2g</a>()
<a name="l00394"></a>00394         time.sleep(2)
<a name="l00395"></a>00395         self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#aac9eef82ee32868c0bc070c0629fe161">start_b2g</a>()
<a name="l00396"></a>00396 
<a name="l00397"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#aac9eef82ee32868c0bc070c0629fe161">00397</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#aac9eef82ee32868c0bc070c0629fe161">start_b2g</a>(self):
<a name="l00398"></a>00398         <span class="keywordflow">if</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a279c9fba0dc47f8f0798b797e500a062">marionette</a>.instance:
<a name="l00399"></a>00399             <span class="comment"># launch the gecko instance attached to marionette</span>
<a name="l00400"></a>00400             self.marionette.instance.start()
<a name="l00401"></a>00401         <span class="keywordflow">elif</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a1a856fc988b11d166e30af4b6d97d20a">is_android_build</a>:
<a name="l00402"></a>00402             self.manager.shellCheckOutput([<span class="stringliteral">&#39;start&#39;</span>, <span class="stringliteral">&#39;b2g&#39;</span>])
<a name="l00403"></a>00403         <span class="keywordflow">else</span>:
<a name="l00404"></a>00404             <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Unable to start B2G&#39;</span>)
<a name="l00405"></a>00405         self.marionette.wait_for_port()
<a name="l00406"></a>00406         self.marionette.start_session()
<a name="l00407"></a>00407         <span class="keywordflow">if</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a1a856fc988b11d166e30af4b6d97d20a">is_android_build</a>:
<a name="l00408"></a>00408             self.marionette.execute_async_script(<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00409"></a>00409 <span class="stringliteral">window.addEventListener(&#39;mozbrowserloadend&#39;, function loaded(aEvent) {</span>
<a name="l00410"></a>00410 <span class="stringliteral">  if (aEvent.target.src.indexOf(&#39;ftu&#39;) != -1 || aEvent.target.src.indexOf(&#39;homescreen&#39;) != -1) {</span>
<a name="l00411"></a>00411 <span class="stringliteral">    window.removeEventListener(&#39;mozbrowserloadend&#39;, loaded);</span>
<a name="l00412"></a>00412 <span class="stringliteral">    marionetteScriptFinished();</span>
<a name="l00413"></a>00413 <span class="stringliteral">  }</span>
<a name="l00414"></a>00414 <span class="stringliteral">});&quot;&quot;&quot;</span>, script_timeout=60000)
<a name="l00415"></a>00415 
<a name="l00416"></a><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#af82650e38af15a82aa7bf9f4f0f6f1a9">00416</a>     <span class="keyword">def </span><a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#af82650e38af15a82aa7bf9f4f0f6f1a9">stop_b2g</a>(self):
<a name="l00417"></a>00417         <span class="keywordflow">if</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a279c9fba0dc47f8f0798b797e500a062">marionette</a>.instance:
<a name="l00418"></a>00418             <span class="comment"># close the gecko instance attached to marionette</span>
<a name="l00419"></a>00419             self.marionette.instance.close()
<a name="l00420"></a>00420         <span class="keywordflow">elif</span> self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a1a856fc988b11d166e30af4b6d97d20a">is_android_build</a>:
<a name="l00421"></a>00421             self.manager.shellCheckOutput([<span class="stringliteral">&#39;stop&#39;</span>, <span class="stringliteral">&#39;b2g&#39;</span>])
<a name="l00422"></a>00422         <span class="keywordflow">else</span>:
<a name="l00423"></a>00423             <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Unable to stop B2G&#39;</span>)
<a name="l00424"></a>00424         self.marionette.client.close()
<a name="l00425"></a>00425         self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a279c9fba0dc47f8f0798b797e500a062">marionette</a>.session = <span class="keywordtype">None</span>
<a name="l00426"></a>00426         self.<a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html#a279c9fba0dc47f8f0798b797e500a062">marionette</a>.window = <span class="keywordtype">None</span>
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html">00429</a> <span class="keyword">class </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html">GaiaTestCase</a>(MarionetteTestCase):
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     _script_timeout = 60000
<a name="l00432"></a>00432     _search_timeout = 10000
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <span class="comment"># deafult timeout in seconds for the wait_for methods</span>
<a name="l00435"></a>00435     _default_timeout = 30
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#afacd0e35a388022337463912f856011a">00437</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#adf02105b9f6c19e9489e10bcad174237">__init__</a>(self, *args, **kwargs):
<a name="l00438"></a>00438         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#afacd0e35a388022337463912f856011a">restart</a> = kwargs.pop(<span class="stringliteral">&#39;restart&#39;</span>, <span class="keyword">False</span>)
<a name="l00439"></a>00439         kwargs.pop(<span class="stringliteral">&#39;iterations&#39;</span>, <span class="keywordtype">None</span>)
<a name="l00440"></a>00440         kwargs.pop(<span class="stringliteral">&#39;checkpoint_interval&#39;</span>, <span class="keywordtype">None</span>)
<a name="l00441"></a>00441         MarionetteTestCase.__init__(self, *args, **kwargs)
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a55d86da87c056783a27aa7871089ce6c">00443</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a55d86da87c056783a27aa7871089ce6c">setUp</a>(self):
<a name="l00444"></a>00444         <span class="keywordflow">try</span>:
<a name="l00445"></a>00445             MarionetteTestCase.setUp(self)
<a name="l00446"></a>00446         <span class="keywordflow">except</span> InvalidResponseException:
<a name="l00447"></a>00447             <span class="keywordflow">if</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#afacd0e35a388022337463912f856011a">restart</a>:
<a name="l00448"></a>00448                 <span class="keywordflow">pass</span>
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a> = <a class="code" href="../../d0/d3e/classgaiatest_1_1gaia__test_1_1_gaia_device.html">GaiaDevice</a>(self.marionette, self.testvars)
<a name="l00451"></a>00451         <span class="keywordflow">if</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#afacd0e35a388022337463912f856011a">restart</a> <span class="keywordflow">and</span> (self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.is_android_build <span class="keywordflow">or</span> self.marionette.instance):
<a name="l00452"></a>00452             self.device.stop_b2g()
<a name="l00453"></a>00453             <span class="keywordflow">if</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.is_android_build:
<a name="l00454"></a>00454                 <span class="comment"># revert device to a clean state</span>
<a name="l00455"></a>00455                 self.device.manager.removeDir(<span class="stringliteral">&#39;/data/local/storage/persistent&#39;</span>)
<a name="l00456"></a>00456                 self.device.manager.removeDir(<span class="stringliteral">&#39;/data/b2g/mozilla&#39;</span>)
<a name="l00457"></a>00457             self.device.start_b2g()
<a name="l00458"></a>00458 
<a name="l00459"></a>00459         <span class="comment"># the emulator can be really slow!</span>
<a name="l00460"></a>00460         self.marionette.set_script_timeout(self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a7f86244ffa87cb36aa3074ec5bc5eaaf">_script_timeout</a>)
<a name="l00461"></a>00461         self.marionette.set_search_timeout(self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a3c2312bf3fae87506809322d63e8b48b">_search_timeout</a>)
<a name="l00462"></a>00462         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ad96ca67d65a474eb1f567be84019cc6b">lockscreen</a> = <a class="code" href="../../d3/d95/classgaiatest_1_1gaia__test_1_1_lock_screen.html">LockScreen</a>(self.marionette)
<a name="l00463"></a>00463         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ac429c30c362a5a456c90401c710d7b8d">apps</a> = <a class="code" href="../../d0/d4e/classgaiatest_1_1gaia__test_1_1_gaia_apps.html">GaiaApps</a>(self.marionette)
<a name="l00464"></a>00464         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a22770a36e2ce9441a2d034aba32ebcf6">data_layer</a> = <a class="code" href="../../d3/d74/classgaiatest_1_1gaia__test_1_1_gaia_data.html">GaiaData</a>(self.marionette, self.testvars)
<a name="l00465"></a>00465         <span class="keyword">from</span> gaiatest.apps.keyboard.app <span class="keyword">import</span> Keyboard
<a name="l00466"></a>00466         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a9e02a4934b7b6dc7d87ae818199ebc12">keyboard</a> = Keyboard(self.marionette)
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a2ac52729193f2b9707e297a2ec4f8729">cleanUp</a>()
<a name="l00469"></a>00469 
<a name="l00470"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a2ac52729193f2b9707e297a2ec4f8729">00470</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a2ac52729193f2b9707e297a2ec4f8729">cleanUp</a>(self):
<a name="l00471"></a>00471         <span class="comment"># remove media</span>
<a name="l00472"></a>00472         <span class="keywordflow">if</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.is_android_build:
<a name="l00473"></a>00473             <span class="keywordflow">for</span> filename <span class="keywordflow">in</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a22770a36e2ce9441a2d034aba32ebcf6">data_layer</a>.media_files:
<a name="l00474"></a>00474                 <span class="comment"># filename is a fully qualified path</span>
<a name="l00475"></a>00475                 self.device.manager.removeFile(filename)
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         <span class="comment"># Switch off keyboard FTU screen</span>
<a name="l00478"></a>00478         self.data_layer.set_setting(<span class="stringliteral">&quot;keyboard.ftu.enabled&quot;</span>, <span class="keyword">False</span>)
<a name="l00479"></a>00479 
<a name="l00480"></a>00480         <span class="comment"># Change timezone back to PST</span>
<a name="l00481"></a>00481         self.data_layer.set_setting(<span class="stringliteral">&quot;time.timezone&quot;</span>, <span class="stringliteral">&quot;America/Los_Angeles&quot;</span>)
<a name="l00482"></a>00482         self.data_layer.set_setting(<span class="stringliteral">&quot;time.timezone.user-selected&quot;</span>, <span class="stringliteral">&quot;America/Los_Angeles&quot;</span>)
<a name="l00483"></a>00483 
<a name="l00484"></a>00484         <span class="comment"># restore settings from testvars</span>
<a name="l00485"></a>00485         [self.data_layer.set_setting(name, value) <span class="keywordflow">for</span> name, value <span class="keywordflow">in</span> self.testvars.get(<span class="stringliteral">&#39;settings&#39;</span>, {}).items()]
<a name="l00486"></a>00486 
<a name="l00487"></a>00487         <span class="comment"># unlock</span>
<a name="l00488"></a>00488         self.lockscreen.unlock()
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="comment"># If we are restarting all of these values are reset to default earlier in the setUp</span>
<a name="l00491"></a>00491         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#afacd0e35a388022337463912f856011a">restart</a>:
<a name="l00492"></a>00492 
<a name="l00493"></a>00493             <span class="comment"># disable passcode before restore settings from testvars</span>
<a name="l00494"></a>00494             self.data_layer.set_setting(<span class="stringliteral">&#39;lockscreen.passcode-lock.code&#39;</span>, <span class="stringliteral">&#39;1111&#39;</span>)
<a name="l00495"></a>00495             self.data_layer.set_setting(<span class="stringliteral">&#39;lockscreen.passcode-lock.enabled&#39;</span>, <span class="keyword">False</span>)
<a name="l00496"></a>00496 
<a name="l00497"></a>00497             <span class="comment"># Change language back to English</span>
<a name="l00498"></a>00498             self.data_layer.set_setting(<span class="stringliteral">&quot;language.current&quot;</span>, <span class="stringliteral">&quot;en-US&quot;</span>)
<a name="l00499"></a>00499 
<a name="l00500"></a>00500             <span class="comment"># Switch off spanish keyboard before test</span>
<a name="l00501"></a>00501             self.data_layer.set_setting(<span class="stringliteral">&quot;keyboard.layouts.spanish&quot;</span>, <span class="keyword">False</span>)
<a name="l00502"></a>00502 
<a name="l00503"></a>00503             <span class="comment"># Set do not track pref back to the default</span>
<a name="l00504"></a>00504             self.data_layer.set_setting(<span class="stringliteral">&#39;privacy.donottrackheader.value&#39;</span>, <span class="stringliteral">&#39;-1&#39;</span>)
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 
<a name="l00507"></a>00507             <span class="keywordflow">if</span> self.data_layer.get_setting(<span class="stringliteral">&#39;ril.radio.disabled&#39;</span>):
<a name="l00508"></a>00508                 <span class="comment"># enable the device radio, disable Airplane mode</span>
<a name="l00509"></a>00509                 self.data_layer.set_setting(<span class="stringliteral">&#39;ril.radio.disabled&#39;</span>, <span class="keyword">False</span>)
<a name="l00510"></a>00510 
<a name="l00511"></a>00511             <span class="comment"># disable carrier data connection</span>
<a name="l00512"></a>00512             <span class="keywordflow">if</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.has_mobile_connection:
<a name="l00513"></a>00513                 self.data_layer.disable_cell_data()
<a name="l00514"></a>00514 
<a name="l00515"></a>00515             self.data_layer.disable_cell_roaming()
<a name="l00516"></a>00516 
<a name="l00517"></a>00517             <span class="keywordflow">if</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.has_wifi:
<a name="l00518"></a>00518                 self.data_layer.enable_wifi()
<a name="l00519"></a>00519                 self.data_layer.forget_all_networks()
<a name="l00520"></a>00520                 self.data_layer.disable_wifi()
<a name="l00521"></a>00521 
<a name="l00522"></a>00522             <span class="comment"># remove data</span>
<a name="l00523"></a>00523             self.data_layer.remove_all_contacts(self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a7f86244ffa87cb36aa3074ec5bc5eaaf">_script_timeout</a>)
<a name="l00524"></a>00524 
<a name="l00525"></a>00525             <span class="comment"># reset to home screen</span>
<a name="l00526"></a>00526             self.marionette.execute_script(<span class="stringliteral">&quot;window.wrappedJSObject.dispatchEvent(new Event(&#39;home&#39;));&quot;</span>)
<a name="l00527"></a>00527 
<a name="l00528"></a>00528         <span class="comment"># kill any open apps</span>
<a name="l00529"></a>00529         self.apps.kill_all()
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         <span class="comment"># disable sound completely</span>
<a name="l00532"></a>00532         self.data_layer.set_volume(0)
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 
<a name="l00535"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a98b0b4f668164fe483646e7d44e20ec5">00535</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a98b0b4f668164fe483646e7d44e20ec5">install_marketplace</a>(self):
<a name="l00536"></a>00536         _yes_button_locator = (By.ID, <span class="stringliteral">&#39;app-install-install-button&#39;</span>)
<a name="l00537"></a>00537         mk = {<span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;Marketplace Dev&quot;</span>,
<a name="l00538"></a>00538               <span class="stringliteral">&quot;manifest&quot;</span>: <span class="stringliteral">&quot;https://marketplace-dev.allizom.org/manifest.webapp &quot;</span>,
<a name="l00539"></a>00539               }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.apps.is_app_installed(mk[<span class="stringliteral">&#39;name&#39;</span>]):
<a name="l00542"></a>00542             <span class="comment"># install the marketplace dev app</span>
<a name="l00543"></a>00543             self.marionette.execute_script(<span class="stringliteral">&#39;navigator.mozApps.install(&quot;%s&quot;)&#39;</span> % mk[<span class="stringliteral">&#39;manifest&#39;</span>])
<a name="l00544"></a>00544 
<a name="l00545"></a>00545             <span class="comment"># TODO add this to the system app object when we have one</span>
<a name="l00546"></a>00546             self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ae87c78f7a1e6470c436b8b0553e87bd3">wait_for_element_displayed</a>(*_yes_button_locator)
<a name="l00547"></a>00547             self.marionette.find_element(*_yes_button_locator).tap()
<a name="l00548"></a>00548             self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a19a9e39421a35de86943531891a6ff64">wait_for_element_not_displayed</a>(*_yes_button_locator)
<a name="l00549"></a>00549 
<a name="l00550"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#adc5ca4b805753b4799e703df25834827">00550</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#adc5ca4b805753b4799e703df25834827">connect_to_network</a>(self):
<a name="l00551"></a>00551         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.is_online:
<a name="l00552"></a>00552             <span class="keywordflow">try</span>:
<a name="l00553"></a>00553                 self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a85662d211a4d23bfe563046322ac6379">connect_to_local_area_network</a>()
<a name="l00554"></a>00554             <span class="keywordflow">except</span>:
<a name="l00555"></a>00555                 <span class="keywordflow">if</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.has_mobile_connection:
<a name="l00556"></a>00556                     self.data_layer.connect_to_cell_data()
<a name="l00557"></a>00557                 <span class="keywordflow">else</span>:
<a name="l00558"></a>00558                     <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Unable to connect to network&#39;</span>)
<a name="l00559"></a>00559         <span class="keyword">assert</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.is_online
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a85662d211a4d23bfe563046322ac6379">00561</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a85662d211a4d23bfe563046322ac6379">connect_to_local_area_network</a>(self):
<a name="l00562"></a>00562         <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.is_online:
<a name="l00563"></a>00563             <span class="keywordflow">if</span> self.testvars.get(<span class="stringliteral">&#39;wifi&#39;</span>) <span class="keywordflow">and</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.has_wifi:
<a name="l00564"></a>00564                 self.data_layer.connect_to_wifi()
<a name="l00565"></a>00565                 <span class="keyword">assert</span> self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aa5d857e4e11cfe047759636e30a6838c">device</a>.is_online
<a name="l00566"></a>00566             <span class="keywordflow">else</span>:
<a name="l00567"></a>00567                 <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Unable to connect to local area network&#39;</span>)
<a name="l00568"></a>00568 
<a name="l00569"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#af3c02f1264bac2f6ba93eaeab74b717c">00569</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#af3c02f1264bac2f6ba93eaeab74b717c">push_resource</a>(self, filename, count=1, destination=&#39;&#39;):
<a name="l00570"></a>00570         self.device.push_file(self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ac50d7e37fa0047ec81d66fbcd71f94aa">resource</a>(filename), count, <span class="stringliteral">&#39;/&#39;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>([<span class="stringliteral">&#39;sdcard&#39;</span>, destination]))
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ac50d7e37fa0047ec81d66fbcd71f94aa">00572</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ac50d7e37fa0047ec81d66fbcd71f94aa">resource</a>(self, filename):
<a name="l00573"></a>00573         <span class="keywordflow">return</span> os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="stringliteral">&#39;resources&#39;</span>, filename))
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a37ff38f2922763999c852750955cdab7">00575</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a37ff38f2922763999c852750955cdab7">change_orientation</a>(self, orientation):
<a name="l00576"></a>00576         <span class="stringliteral">&quot;&quot;&quot;  There are 4 orientation states which the phone can be passed in:</span>
<a name="l00577"></a>00577 <span class="stringliteral">        portrait-primary(which is the default orientation), landscape-primary, portrait-secondary and landscape-secondary</span>
<a name="l00578"></a>00578 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00579"></a>00579         self.marionette.execute_async_script(<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00580"></a>00580 <span class="stringliteral">            if (arguments[0] === arguments[1]) {</span>
<a name="l00581"></a>00581 <span class="stringliteral">              marionetteScriptFinished();</span>
<a name="l00582"></a>00582 <span class="stringliteral">            }</span>
<a name="l00583"></a>00583 <span class="stringliteral">            else {</span>
<a name="l00584"></a>00584 <span class="stringliteral">              var expected = arguments[1];</span>
<a name="l00585"></a>00585 <span class="stringliteral">              window.screen.onmozorientationchange = function(e) {</span>
<a name="l00586"></a>00586 <span class="stringliteral">                console.log(&quot;Received &#39;onmozorientationchange&#39; event.&quot;);</span>
<a name="l00587"></a>00587 <span class="stringliteral">                waitFor(</span>
<a name="l00588"></a>00588 <span class="stringliteral">                  function() {</span>
<a name="l00589"></a>00589 <span class="stringliteral">                    window.screen.onmozorientationchange = null;</span>
<a name="l00590"></a>00590 <span class="stringliteral">                    marionetteScriptFinished();</span>
<a name="l00591"></a>00591 <span class="stringliteral">                  },</span>
<a name="l00592"></a>00592 <span class="stringliteral">                  function() {</span>
<a name="l00593"></a>00593 <span class="stringliteral">                    return window.screen.mozOrientation === expected;</span>
<a name="l00594"></a>00594 <span class="stringliteral">                  }</span>
<a name="l00595"></a>00595 <span class="stringliteral">                );</span>
<a name="l00596"></a>00596 <span class="stringliteral">              };</span>
<a name="l00597"></a>00597 <span class="stringliteral">              console.log(&quot;Changing orientation to &#39;&quot; + arguments[1] + &quot;&#39;.&quot;);</span>
<a name="l00598"></a>00598 <span class="stringliteral">              window.screen.mozLockOrientation(arguments[1]);</span>
<a name="l00599"></a>00599 <span class="stringliteral">            };&quot;&quot;&quot;</span>, script_args=[self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aca3f7e80cebe150b38d3a6410bc18e5a">screen_orientation</a>, orientation])
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     @property
<a name="l00602"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a65687b0fb1782c79990cbf4c32387089">00602</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a65687b0fb1782c79990cbf4c32387089">screen_width</a>(self):
<a name="l00603"></a>00603         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&#39;return window.screen.width&#39;</span>)
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     @property
<a name="l00606"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aca3f7e80cebe150b38d3a6410bc18e5a">00606</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#aca3f7e80cebe150b38d3a6410bc18e5a">screen_orientation</a>(self):
<a name="l00607"></a>00607         <span class="keywordflow">return</span> self.marionette.execute_script(<span class="stringliteral">&#39;return window.screen.mozOrientation&#39;</span>)
<a name="l00608"></a>00608 
<a name="l00609"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a9a8d473860e3a6857f763005df31717d">00609</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a9a8d473860e3a6857f763005df31717d">wait_for_element_present</a>(self, by, locator, timeout=_default_timeout):
<a name="l00610"></a>00610         timeout = <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a41c4c29f6d7869f7621f2549cecccbf0">float</a>(timeout) + time.time()
<a name="l00611"></a>00611 
<a name="l00612"></a>00612         <span class="keywordflow">while</span> time.time() &lt; timeout:
<a name="l00613"></a>00613             time.sleep(0.5)
<a name="l00614"></a>00614             <span class="keywordflow">try</span>:
<a name="l00615"></a>00615                 <span class="keywordflow">return</span> self.marionette.find_element(by, locator)
<a name="l00616"></a>00616             <span class="keywordflow">except</span> NoSuchElementException:
<a name="l00617"></a>00617                 <span class="keywordflow">pass</span>
<a name="l00618"></a>00618         <span class="keywordflow">else</span>:
<a name="l00619"></a>00619             <span class="keywordflow">raise</span> TimeoutException(
<a name="l00620"></a>00620                 <span class="stringliteral">&#39;Element %s not present before timeout&#39;</span> % locator)
<a name="l00621"></a>00621 
<a name="l00622"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ac3f3d8f4ce3b11b80936ecff58f3b6a1">00622</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ac3f3d8f4ce3b11b80936ecff58f3b6a1">wait_for_element_not_present</a>(self, by, locator, timeout=_default_timeout):
<a name="l00623"></a>00623         timeout = <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a41c4c29f6d7869f7621f2549cecccbf0">float</a>(timeout) + time.time()
<a name="l00624"></a>00624 
<a name="l00625"></a>00625         <span class="keywordflow">while</span> time.time() &lt; timeout:
<a name="l00626"></a>00626             time.sleep(0.5)
<a name="l00627"></a>00627             <span class="keywordflow">try</span>:
<a name="l00628"></a>00628                 self.marionette.find_element(by, locator)
<a name="l00629"></a>00629             <span class="keywordflow">except</span> NoSuchElementException:
<a name="l00630"></a>00630                 <span class="keywordflow">break</span>
<a name="l00631"></a>00631         <span class="keywordflow">else</span>:
<a name="l00632"></a>00632             <span class="keywordflow">raise</span> TimeoutException(
<a name="l00633"></a>00633                 <span class="stringliteral">&#39;Element %s still present after timeout&#39;</span> % locator)
<a name="l00634"></a>00634 
<a name="l00635"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ae87c78f7a1e6470c436b8b0553e87bd3">00635</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ae87c78f7a1e6470c436b8b0553e87bd3">wait_for_element_displayed</a>(self, by, locator, timeout=_default_timeout):
<a name="l00636"></a>00636         timeout = <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a41c4c29f6d7869f7621f2549cecccbf0">float</a>(timeout) + time.time()
<a name="l00637"></a>00637         e = <span class="keywordtype">None</span>
<a name="l00638"></a>00638         <span class="keywordflow">while</span> time.time() &lt; timeout:
<a name="l00639"></a>00639             time.sleep(0.5)
<a name="l00640"></a>00640             <span class="keywordflow">try</span>:
<a name="l00641"></a>00641                 <span class="keywordflow">if</span> self.marionette.find_element(by, locator).is_displayed():
<a name="l00642"></a>00642                     <span class="keywordflow">break</span>
<a name="l00643"></a>00643             <span class="keywordflow">except</span> (NoSuchElementException, StaleElementException) <span class="keyword">as</span> e:
<a name="l00644"></a>00644                 <span class="keywordflow">pass</span>
<a name="l00645"></a>00645         <span class="keywordflow">else</span>:
<a name="l00646"></a>00646             <span class="comment"># This is an effortless way to give extra debugging information</span>
<a name="l00647"></a>00647             <span class="keywordflow">if</span> isinstance(e, NoSuchElementException):
<a name="l00648"></a>00648                 <span class="keywordflow">raise</span> TimeoutException(<span class="stringliteral">&#39;Element %s not present before timeout&#39;</span> % locator)
<a name="l00649"></a>00649             <span class="keywordflow">else</span>:
<a name="l00650"></a>00650                 <span class="keywordflow">raise</span> TimeoutException(<span class="stringliteral">&#39;Element %s present but not displayed before timeout&#39;</span> % locator)
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a19a9e39421a35de86943531891a6ff64">00652</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a19a9e39421a35de86943531891a6ff64">wait_for_element_not_displayed</a>(self, by, locator, timeout=_default_timeout):
<a name="l00653"></a>00653         timeout = <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a41c4c29f6d7869f7621f2549cecccbf0">float</a>(timeout) + time.time()
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         <span class="keywordflow">while</span> time.time() &lt; timeout:
<a name="l00656"></a>00656             time.sleep(0.5)
<a name="l00657"></a>00657             <span class="keywordflow">try</span>:
<a name="l00658"></a>00658                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.marionette.find_element(by, locator).is_displayed():
<a name="l00659"></a>00659                     <span class="keywordflow">break</span>
<a name="l00660"></a>00660             <span class="keywordflow">except</span> StaleElementException:
<a name="l00661"></a>00661                 <span class="keywordflow">pass</span>
<a name="l00662"></a>00662             <span class="keywordflow">except</span> NoSuchElementException:
<a name="l00663"></a>00663                 <span class="keywordflow">break</span>
<a name="l00664"></a>00664         <span class="keywordflow">else</span>:
<a name="l00665"></a>00665             <span class="keywordflow">raise</span> TimeoutException(
<a name="l00666"></a>00666                 <span class="stringliteral">&#39;Element %s still visible after timeout&#39;</span> % locator)
<a name="l00667"></a>00667 
<a name="l00668"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a665ed7dc4e1131529b18157f28a01f8a">00668</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a665ed7dc4e1131529b18157f28a01f8a">wait_for_condition</a>(self, method, timeout=_default_timeout,
<a name="l00669"></a>00669                            message=<span class="stringliteral">&quot;Condition timed out&quot;</span>):
<a name="l00670"></a>00670         <span class="stringliteral">&quot;&quot;&quot;Calls the method provided with the driver as an argument until the \</span>
<a name="l00671"></a>00671 <span class="stringliteral">        return value is not False.&quot;&quot;&quot;</span>
<a name="l00672"></a>00672         end_time = time.time() + timeout
<a name="l00673"></a>00673         <span class="keywordflow">while</span> time.time() &lt; end_time:
<a name="l00674"></a>00674             <span class="keywordflow">try</span>:
<a name="l00675"></a>00675                 value = method(self.marionette)
<a name="l00676"></a>00676                 <span class="keywordflow">if</span> value:
<a name="l00677"></a>00677                     <span class="keywordflow">return</span> value
<a name="l00678"></a>00678             <span class="keywordflow">except</span> (NoSuchElementException, StaleElementException):
<a name="l00679"></a>00679                 <span class="keywordflow">pass</span>
<a name="l00680"></a>00680             time.sleep(0.5)
<a name="l00681"></a>00681         <span class="keywordflow">else</span>:
<a name="l00682"></a>00682             <span class="keywordflow">raise</span> TimeoutException(message)
<a name="l00683"></a>00683 
<a name="l00684"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#af9452867f6872a2799f47a0b9d2e05ab">00684</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#af9452867f6872a2799f47a0b9d2e05ab">is_element_present</a>(self, by, locator):
<a name="l00685"></a>00685         <span class="keywordflow">try</span>:
<a name="l00686"></a>00686             self.marionette.find_element(by, locator)
<a name="l00687"></a>00687             <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l00688"></a>00688         <span class="keywordflow">except</span>:
<a name="l00689"></a>00689             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l00690"></a>00690 
<a name="l00691"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ada58c311c6c1d192d83ff13f6e1e9a21">00691</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ada58c311c6c1d192d83ff13f6e1e9a21">is_element_displayed</a>(self, by, locator):
<a name="l00692"></a>00692         <span class="keywordflow">try</span>:
<a name="l00693"></a>00693             <span class="keywordflow">return</span> self.marionette.find_element(by, locator).is_displayed()
<a name="l00694"></a>00694         <span class="keywordflow">except</span> (NoSuchElementException, ElementNotVisibleException):
<a name="l00695"></a>00695             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l00696"></a>00696 
<a name="l00697"></a><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a564371b4795a0fbb1a02d02949fd3527">00697</a>     <span class="keyword">def </span><a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a564371b4795a0fbb1a02d02949fd3527">tearDown</a>(self):
<a name="l00698"></a>00698         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ad96ca67d65a474eb1f567be84019cc6b">lockscreen</a> = <span class="keywordtype">None</span>
<a name="l00699"></a>00699         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#ac429c30c362a5a456c90401c710d7b8d">apps</a> = <span class="keywordtype">None</span>
<a name="l00700"></a>00700         self.<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html#a22770a36e2ce9441a2d034aba32ebcf6">data_layer</a> = <span class="keywordtype">None</span>
<a name="l00701"></a>00701         MarionetteTestCase.tearDown(self)
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 
<a name="l00704"></a><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html">00704</a> <span class="keyword">class </span><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html">GaiaEnduranceTestCase</a>(<a class="code" href="../../d6/de4/classgaiatest_1_1gaia__test_1_1_gaia_test_case.html">GaiaTestCase</a>):
<a name="l00705"></a>00705 
<a name="l00706"></a><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">00706</a>     <span class="keyword">def </span><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#aaec01ff339c593e5f4ed07d6c1de299b">__init__</a>(self, *args, **kwargs):
<a name="l00707"></a>00707         self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">iterations</a> = kwargs.pop(<span class="stringliteral">&#39;iterations&#39;</span>) <span class="keywordflow">or</span> 1
<a name="l00708"></a>00708         self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a05f71699427ece4c4e25371b9797ef8a">checkpoint_interval</a> = kwargs.pop(<span class="stringliteral">&#39;checkpoint_interval&#39;</span>) <span class="keywordflow">or</span> self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">iterations</a>
<a name="l00709"></a>00709         GaiaTestCase.__init__(self, *args, **kwargs)
<a name="l00710"></a>00710 
<a name="l00711"></a><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#abe4584fc332d945836f6ec94a5f25d01">00711</a>     <span class="keyword">def </span><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a64d98212f2c05f06aad7ab08fbb537c9">drive</a>(self, test, app):
<a name="l00712"></a>00712         self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#abe4584fc332d945836f6ec94a5f25d01">test_method</a> = test
<a name="l00713"></a>00713         self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#af61ffe0ec20cd0d9b74110b5572a49b1">app_under_test</a> = app
<a name="l00714"></a>00714 
<a name="l00715"></a>00715         <span class="comment"># Now drive the actual test case iterations</span>
<a name="l00716"></a>00716         <span class="keywordflow">for</span> count <span class="keywordflow">in</span> range(1, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">iterations</a> + 1):
<a name="l00717"></a>00717             self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a558083eeaf2821f0f971a5415115c87c">iteration</a> = count
<a name="l00718"></a>00718             self.marionette.log(<span class="stringliteral">&quot;%s iteration %d of %d&quot;</span> % (self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#abe4584fc332d945836f6ec94a5f25d01">test_method</a>.__name__, count, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">iterations</a>))
<a name="l00719"></a>00719             <span class="comment"># Print to console so can see what iteration we&#39;re on while test is running</span>
<a name="l00720"></a>00720             <span class="keywordflow">if</span> self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a558083eeaf2821f0f971a5415115c87c">iteration</a> == 1:
<a name="l00721"></a>00721                 <span class="keywordflow">print</span> <span class="stringliteral">&quot;\n&quot;</span>
<a name="l00722"></a>00722             <span class="keywordflow">print</span> <span class="stringliteral">&quot;Iteration %d of %d...&quot;</span> % (count, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">iterations</a>)
<a name="l00723"></a>00723             sys.stdout.flush()
<a name="l00724"></a>00724 
<a name="l00725"></a>00725             self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#abe4584fc332d945836f6ec94a5f25d01">test_method</a>()
<a name="l00726"></a>00726             <span class="comment"># Checkpoint time?</span>
<a name="l00727"></a>00727             <span class="keywordflow">if</span> ((count % self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a05f71699427ece4c4e25371b9797ef8a">checkpoint_interval</a>) == 0) <span class="keywordflow">or</span> count == self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">iterations</a>:
<a name="l00728"></a>00728                 self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#afd0c85ce04354ae2d949e092a882850c">checkpoint</a>()
<a name="l00729"></a>00729 
<a name="l00730"></a>00730         <span class="comment"># Finished, now process checkpoint data into .json output</span>
<a name="l00731"></a>00731         self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad3e304666f6c445e223eb132c2e4c687">process_checkpoint_data</a>()
<a name="l00732"></a>00732 
<a name="l00733"></a><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#afec8c2d524cd79f8b92fb5c8760226ea">00733</a>     <span class="keyword">def </span><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#afd0c85ce04354ae2d949e092a882850c">checkpoint</a>(self):
<a name="l00734"></a>00734         <span class="comment"># Console output so know what&#39;s happening if watching console</span>
<a name="l00735"></a>00735         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Checkpoint...&quot;</span>
<a name="l00736"></a>00736         sys.stdout.flush()
<a name="l00737"></a>00737         <span class="comment"># Sleep to give device idle time (for gc)</span>
<a name="l00738"></a>00738         idle_time = 30
<a name="l00739"></a>00739         self.marionette.log(<span class="stringliteral">&quot;sleeping %d seconds to give the device some idle time&quot;</span> % idle_time)
<a name="l00740"></a>00740         time.sleep(idle_time)
<a name="l00741"></a>00741 
<a name="l00742"></a>00742         <span class="comment"># Dump out some memory status info</span>
<a name="l00743"></a>00743         self.marionette.log(<span class="stringliteral">&quot;checkpoint&quot;</span>)
<a name="l00744"></a>00744         self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a79e69e9e519c7cef921cb845bb8779cd">cur_time</a> = time.strftime(<span class="stringliteral">&quot;%Y%m%d%H%M%S&quot;</span>, time.localtime())
<a name="l00745"></a>00745         <span class="comment"># If first checkpoint, create the file if it doesn&#39;t exist already</span>
<a name="l00746"></a>00746         <span class="keywordflow">if</span> self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a558083eeaf2821f0f971a5415115c87c">iteration</a> <span class="keywordflow">in</span> (0, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a05f71699427ece4c4e25371b9797ef8a">checkpoint_interval</a>):
<a name="l00747"></a>00747             self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a69525d2ddc27bfc2c282be83a093914e">checkpoint_path</a> = <span class="stringliteral">&quot;checkpoints&quot;</span>
<a name="l00748"></a>00748             <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a69525d2ddc27bfc2c282be83a093914e">checkpoint_path</a>):
<a name="l00749"></a>00749                 os.makedirs(self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a69525d2ddc27bfc2c282be83a093914e">checkpoint_path</a>, 0755)
<a name="l00750"></a>00750             self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#afec8c2d524cd79f8b92fb5c8760226ea">log_name</a> = <span class="stringliteral">&quot;%s/checkpoint_%s_%s.log&quot;</span> % (self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a69525d2ddc27bfc2c282be83a093914e">checkpoint_path</a>, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#abe4584fc332d945836f6ec94a5f25d01">test_method</a>.__name__, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a79e69e9e519c7cef921cb845bb8779cd">cur_time</a>)
<a name="l00751"></a>00751             with <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#afec8c2d524cd79f8b92fb5c8760226ea">log_name</a>, <span class="stringliteral">&#39;a&#39;</span>) <span class="keyword">as</span> log_file:
<a name="l00752"></a>00752                 log_file.write(<span class="stringliteral">&#39;%s Gaia Endurance Test: %s\n&#39;</span> % (self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a79e69e9e519c7cef921cb845bb8779cd">cur_time</a>, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#abe4584fc332d945836f6ec94a5f25d01">test_method</a>.__name__))
<a name="l00753"></a>00753         output_str = self.device.manager.shellCheckOutput([<span class="stringliteral">&quot;b2g-ps&quot;</span>])
<a name="l00754"></a>00754         with <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#afec8c2d524cd79f8b92fb5c8760226ea">log_name</a>, <span class="stringliteral">&#39;a&#39;</span>) <span class="keyword">as</span> log_file:
<a name="l00755"></a>00755             log_file.write(<span class="stringliteral">&#39;%s Checkpoint after iteration %d of %d:\n&#39;</span> % (self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a79e69e9e519c7cef921cb845bb8779cd">cur_time</a>, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a558083eeaf2821f0f971a5415115c87c">iteration</a>, self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">iterations</a>))
<a name="l00756"></a>00756             log_file.write(<span class="stringliteral">&#39;%s\n&#39;</span> % output_str)
<a name="l00757"></a>00757 
<a name="l00758"></a><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a14e5e7f2b8388a5908ff213d80fdec15">00758</a>     <span class="keyword">def </span><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a14e5e7f2b8388a5908ff213d80fdec15">close_app</a>(self):
<a name="l00759"></a>00759         <span class="comment"># Close the current app (self.app) by using the home button</span>
<a name="l00760"></a>00760         self.marionette.switch_to_frame()
<a name="l00761"></a>00761         self.marionette.execute_script(<span class="stringliteral">&quot;window.wrappedJSObject.dispatchEvent(new Event(&#39;home&#39;));&quot;</span>)
<a name="l00762"></a>00762 
<a name="l00763"></a>00763         <span class="comment"># Bring up the cards view</span>
<a name="l00764"></a>00764         _cards_view_locator = (<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;cards-view&#39;</span>)
<a name="l00765"></a>00765         self.marionette.execute_script(<span class="stringliteral">&quot;window.wrappedJSObject.dispatchEvent(new Event(&#39;holdhome&#39;));&quot;</span>)
<a name="l00766"></a>00766         self.wait_for_element_displayed(*_cards_view_locator)
<a name="l00767"></a>00767 
<a name="l00768"></a>00768         <span class="comment"># Sleep a bit</span>
<a name="l00769"></a>00769         time.sleep(5)
<a name="l00770"></a>00770 
<a name="l00771"></a>00771         <span class="comment"># Tap the close icon for the current app</span>
<a name="l00772"></a>00772         locator_part_two = <span class="stringliteral">&#39;#cards-view li.card[data-origin*=&quot;%s&quot;] .close-card&#39;</span> % self.app_under_test.lower()
<a name="l00773"></a>00773         _close_button_locator = (<span class="stringliteral">&#39;css selector&#39;</span>, locator_part_two)
<a name="l00774"></a>00774         close_card_app_button = self.marionette.find_element(*_close_button_locator)
<a name="l00775"></a>00775         close_card_app_button.tap()
<a name="l00776"></a>00776 
<a name="l00777"></a><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad3e304666f6c445e223eb132c2e4c687">00777</a>     <span class="keyword">def </span><a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad3e304666f6c445e223eb132c2e4c687">process_checkpoint_data</a>(self):
<a name="l00778"></a>00778         <span class="comment"># Process checkpoint data into .json</span>
<a name="l00779"></a>00779         self.marionette.log(<span class="stringliteral">&quot;processing checkpoint data from %s&quot;</span> % self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#afec8c2d524cd79f8b92fb5c8760226ea">log_name</a>)
<a name="l00780"></a>00780 
<a name="l00781"></a>00781         <span class="comment"># Open the checkpoint file</span>
<a name="l00782"></a>00782         checkpoint_file = <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#afec8c2d524cd79f8b92fb5c8760226ea">log_name</a>, <span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;)</span>
<a name="l00783"></a>00783 <span class="stringliteral"></span>
<a name="l00784"></a>00784 <span class="stringliteral">        </span><span class="comment"># Grab every b2g rss reading for each checkpoint</span>
<a name="l00785"></a>00785         b2g_rss_list = []
<a name="l00786"></a>00786         <span class="keywordflow">for</span> next_line <span class="keywordflow">in</span> checkpoint_file:
<a name="l00787"></a>00787             <span class="keywordflow">if</span> next_line.startswith(<span class="stringliteral">&quot;b2g&quot;</span>):
<a name="l00788"></a>00788                 b2g_rss_list.append(next_line.split()[5])
<a name="l00789"></a>00789 
<a name="l00790"></a>00790         <span class="comment"># Close the checkpoint file</span>
<a name="l00791"></a>00791         checkpoint_file.close()
<a name="l00792"></a>00792 
<a name="l00793"></a>00793         <span class="comment"># Calculate the average b2g_rss</span>
<a name="l00794"></a>00794         total = 0
<a name="l00795"></a>00795         <span class="keywordflow">for</span> b2g_mem_value <span class="keywordflow">in</span> b2g_rss_list:
<a name="l00796"></a>00796             total+=<a class="code" href="../../d9/d04/expat_8h.html#a14bb8924daea0b48c7803f281f66e390">int</a>(b2g_mem_value)
<a name="l00797"></a>00797         avg_rss = total/len(b2g_rss_list)
<a name="l00798"></a>00798 
<a name="l00799"></a>00799         <span class="comment"># Create a summary text file</span>
<a name="l00800"></a>00800         summary_name = self.log_name.replace(<span class="stringliteral">&#39;.log&#39;</span>, <span class="stringliteral">&#39;_summary.log&#39;</span>)
<a name="l00801"></a>00801         summary_file = <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(summary_name, <span class="stringliteral">&#39;w&#39;</span>)
<a name="l00802"></a>00802 
<a name="l00803"></a>00803         <span class="comment"># Write the summarized checkpoint data</span>
<a name="l00804"></a>00804         summary_file.write(<span class="stringliteral">&#39;test_name: %s\n&#39;</span> % self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#abe4584fc332d945836f6ec94a5f25d01">test_method</a>.__name__)
<a name="l00805"></a>00805         summary_file.write(<span class="stringliteral">&#39;completed: %s\n&#39;</span> % self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a79e69e9e519c7cef921cb845bb8779cd">cur_time</a>)
<a name="l00806"></a>00806         summary_file.write(<span class="stringliteral">&#39;app_under_test: %s\n&#39;</span> % self.app_under_test.lower())
<a name="l00807"></a>00807         summary_file.write(<span class="stringliteral">&#39;total_iterations: %d\n&#39;</span> % self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#ad6d58b1ea53c38247eb3312e3c810491">iterations</a>)
<a name="l00808"></a>00808         summary_file.write(<span class="stringliteral">&#39;checkpoint_interval: %d\n&#39;</span> % self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a05f71699427ece4c4e25371b9797ef8a">checkpoint_interval</a>)
<a name="l00809"></a>00809         summary_file.write(<span class="stringliteral">&#39;b2g_rss: &#39;</span>)
<a name="l00810"></a>00810         summary_file.write(<span class="stringliteral">&#39;, &#39;</span>.<a class="code" href="../../de/d11/path_8js.html#a9c4b06c29cf28f47c4f54ed4e30c85b3">join</a>(b2g_rss_list))
<a name="l00811"></a>00811         summary_file.write(<span class="stringliteral">&#39;\navg_rss: %d\n\n&#39;</span> % avg_rss)
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <span class="comment"># Close the summary file</span>
<a name="l00814"></a>00814         summary_file.close()
<a name="l00815"></a>00815 
<a name="l00816"></a>00816         <span class="comment"># Write to suite summary file</span>
<a name="l00817"></a>00817         suite_summary_file_name = <span class="stringliteral">&#39;%s/avg_b2g_rss_suite_summary.log&#39;</span> % self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#a69525d2ddc27bfc2c282be83a093914e">checkpoint_path</a>
<a name="l00818"></a>00818         suite_summary_file = <a class="code" href="../../df/d65/openaudio_8js.html#ad0452adbe6c8d74d2e2afaa489294b68">open</a>(suite_summary_file_name, <span class="stringliteral">&#39;a&#39;</span>)
<a name="l00819"></a>00819         suite_summary_file.write(<span class="stringliteral">&#39;%s: %s\n&#39;</span> % (self.<a class="code" href="../../d7/da2/classgaiatest_1_1gaia__test_1_1_gaia_endurance_test_case.html#abe4584fc332d945836f6ec94a5f25d01">test_method</a>.__name__, avg_rss))
<a name="l00820"></a>00820         suite_summary_file.close()
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d8/dfd/gaia__test_8py.html">gaia_test.py</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:52:02に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
