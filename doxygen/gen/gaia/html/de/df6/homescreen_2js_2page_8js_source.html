<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: page.js ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('de/df6/homescreen_2js_2page_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">page.js</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../de/df6/homescreen_2js_2page_8js.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ae2475e10618961c050dcba04e8c42331">00001</a> <span class="stringliteral">&#39;use strict&#39;</span>;
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> * Icon constructor</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * @param {Object} descriptor</span>
<a name="l00007"></a>00007 <span class="comment"> *                 An object that contains the data necessary to draw this</span>
<a name="l00008"></a>00008 <span class="comment"> *                 icon.</span>
<a name="l00009"></a>00009 <span class="comment"> * @param {Application} app [optional]</span>
<a name="l00010"></a>00010 <span class="comment"> *                      The Application or Bookmark object corresponding to</span>
<a name="l00011"></a>00011 <span class="comment"> *                      this icon.</span>
<a name="l00012"></a>00012 <span class="comment"> */</span>
<a name="l00013"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a19facd329fb2f940c5ad90e962828aca">00013</a> <span class="keyword">function</span> <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a19facd329fb2f940c5ad90e962828aca">Icon</a>(<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>, <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>) {
<a name="l00014"></a>00014   this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a> = <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00015"></a>00015   this.<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a> = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>;
<a name="l00016"></a>00016   this.updateAppStatus(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>);
<a name="l00017"></a>00017 }
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">// Support rendering icons for different screens</span>
<a name="l00021"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a55390d56661168977cb2f85733847f93">00021</a> var <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.devicePixelRatio;
<a name="l00022"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">00022</a> var <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> = 60;
<a name="l00023"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">00023</a> var <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a> = 4;
<a name="l00024"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a5c090fc6628b0210cf61884a6c25f75a">00024</a> var <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a5c090fc6628b0210cf61884a6c25f75a">ICONS_PER_ROW</a> = 4;
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a0eea4780de21d02d17f5a0a88400cc9a">00026</a> var <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a0eea4780de21d02d17f5a0a88400cc9a">DRAGGING_TRANSITION</a> = <span class="stringliteral">&#39;-moz-transform .3s&#39;</span>;
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a11766ffa2636a5071f93aca20241d11c">00028</a> <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a19facd329fb2f940c5ad90e962828aca">Icon</a>.prototype = {
<a name="l00029"></a>00029 
<a name="l00030"></a>00030   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a>: <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a>,
<a name="l00031"></a>00031 
<a name="l00032"></a>00032   <span class="comment">// It defines the time (in ms) to ensure that the onDragStop method finishes</span>
<a name="l00033"></a>00033   FALLBACK_DRAG_STOP_DELAY: 1000,
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   DEFAULT_BOOKMARK_ICON_URL: <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.protocol + <span class="stringliteral">&#39;//&#39;</span> +
<a name="l00036"></a>00036                     <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.host + <span class="stringliteral">&#39;/style/images/default_favicon.png&#39;</span>,
<a name="l00037"></a>00037   DEFAULT_ICON_URL: <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.protocol + <span class="stringliteral">&#39;//&#39;</span> + <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.host +
<a name="l00038"></a>00038                     <span class="stringliteral">&#39;/style/images/default.png&#39;</span>,
<a name="l00039"></a>00039   DOWNLOAD_ICON_URL: <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.protocol + <span class="stringliteral">&#39;//&#39;</span> + <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.host +
<a name="l00040"></a>00040                     <span class="stringliteral">&#39;/style/images/app_downloading.png&#39;</span>,
<a name="l00041"></a>00041   CANCELED_ICON_URL: <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.protocol + <span class="stringliteral">&#39;//&#39;</span> + <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.location.host +
<a name="l00042"></a>00042                     <span class="stringliteral">&#39;/style/images/app_paused.png&#39;</span>,
<a name="l00043"></a>00043 
<a name="l00044"></a>00044   <span class="comment">// These properties will be copied from the descriptor onto the icon&#39;s HTML</span>
<a name="l00045"></a>00045   <span class="comment">// element dataset and allow us to uniquely look up the Icon object from</span>
<a name="l00046"></a>00046   <span class="comment">// the HTML element.</span>
<a name="l00047"></a>00047   _descriptorIdentifiers: [<span class="stringliteral">&#39;manifestURL&#39;</span>, <span class="stringliteral">&#39;entry_point&#39;</span>, <span class="stringliteral">&#39;bookmarkURL&#39;</span>,
<a name="l00048"></a>00048                            <span class="stringliteral">&#39;useAsyncPanZoom&#39;</span>, <span class="stringliteral">&#39;desiredPos&#39;</span>],
<a name="l00049"></a>00049 
<a name="l00053"></a>00053   <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l00054"></a>00054 
<a name="l00058"></a>00058   getUID: <span class="keyword">function</span> icon_getUID() {
<a name="l00059"></a>00059     var <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a> = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061     <span class="keywordflow">return</span> (descriptor.manifestURL || descriptor.bookmarkURL) +
<a name="l00062"></a>00062            (descriptor.entry_point ? descriptor.entry_point : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00063"></a>00063   },
<a name="l00064"></a>00064 
<a name="l00065"></a>00065   isOfflineReady: <span class="keyword">function</span> icon_isOfflineReady() {
<a name="l00066"></a>00066     <span class="keywordflow">return</span> this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.type === <a class="code" href="../../df/d44/grid__components_8js.html#acb1b7986f3c9f443299948de66072e15">GridItemsFactory</a>.TYPE.COLLECTION ||
<a name="l00067"></a>00067       !(this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.isHosted &amp;&amp;
<a name="l00068"></a>00068       !this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.hasOfflineCache ||
<a name="l00069"></a>00069       this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.type === <a class="code" href="../../df/d44/grid__components_8js.html#acb1b7986f3c9f443299948de66072e15">GridItemsFactory</a>.TYPE.BOOKMARK);
<a name="l00070"></a>00070   },
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <span class="comment">/*</span>
<a name="l00073"></a>00073 <span class="comment">   * Renders the icon into the page</span>
<a name="l00074"></a>00074 <span class="comment">   */</span>
<a name="l00075"></a>00075   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ae7817194480cfc900873938c8e7dd602">render</a>: <span class="keyword">function</span> icon_render() {
<a name="l00076"></a>00076     <span class="comment">/*</span>
<a name="l00077"></a>00077 <span class="comment">     * &lt;li role=&quot;button&quot; aria-label=&quot;label&quot; class=&quot;icon&quot; data-manifestURL=&quot;zzz&quot;&gt;</span>
<a name="l00078"></a>00078 <span class="comment">     *   &lt;div&gt;</span>
<a name="l00079"></a>00079 <span class="comment">     *     &lt;img role=&quot;presentation&quot; src=&quot;the icon image path&quot;&gt;&lt;/img&gt;</span>
<a name="l00080"></a>00080 <span class="comment">     *     &lt;span class=&quot;label&quot;&gt;label&lt;/span&gt;</span>
<a name="l00081"></a>00081 <span class="comment">     *   &lt;/div&gt;</span>
<a name="l00082"></a>00082 <span class="comment">     *   &lt;span class=&quot;options&quot;&gt;&lt;/span&gt;</span>
<a name="l00083"></a>00083 <span class="comment">     * &lt;/li&gt;</span>
<a name="l00084"></a>00084 <span class="comment">     */</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     var <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a> = this.container = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;li&#39;</span>);
<a name="l00087"></a>00087     var dataset = container.dataset;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     dataset.offlineReady = this.isOfflineReady();
<a name="l00090"></a>00090     container.className = <span class="stringliteral">&#39;icon&#39;</span>;
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.hidden) {
<a name="l00092"></a>00092       <span class="keyword">delete</span> this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.hidden;
<a name="l00093"></a>00093       dataset.visible = <span class="keyword">false</span>;
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     var <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a> = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00097"></a>00097     dataset.isIcon = <span class="keyword">true</span>;
<a name="l00098"></a>00098     this._descriptorIdentifiers.forEach(<span class="keyword">function</span>(prop) {
<a name="l00099"></a>00099       var <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a> = descriptor[prop];
<a name="l00100"></a>00100       <span class="keywordflow">if</span> (value || value === 0)
<a name="l00101"></a>00101         dataset[prop] = value;
<a name="l00102"></a>00102     });
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="comment">// Collection (as bookmarks)</span>
<a name="l00105"></a>00105     <span class="keywordflow">if</span> (descriptor.type === <a class="code" href="../../df/d44/grid__components_8js.html#acb1b7986f3c9f443299948de66072e15">GridItemsFactory</a>.TYPE.COLLECTION) {
<a name="l00106"></a>00106       dataset.isCollection = <span class="keyword">true</span>;
<a name="l00107"></a>00107       dataset.collectionId = descriptor.id;
<a name="l00108"></a>00108       dataset.collectionName = descriptor.name;
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     var localizedName = this.getName();
<a name="l00112"></a>00112     container.setAttribute(<span class="stringliteral">&#39;role&#39;</span>, <span class="stringliteral">&#39;button&#39;</span>);
<a name="l00113"></a>00113     container.setAttribute(<span class="stringliteral">&#39;aria-label&#39;</span>, localizedName);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="comment">// Icon container</span>
<a name="l00116"></a>00116     var icon = this.icon = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;div&#39;</span>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="comment">// Image</span>
<a name="l00119"></a>00119     var img = this.img = <span class="keyword">new</span> Image();
<a name="l00120"></a>00120     img.setAttribute(<span class="stringliteral">&#39;role&#39;</span>, <span class="stringliteral">&#39;presentation&#39;</span>);
<a name="l00121"></a>00121     img.width = <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> + <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a>;
<a name="l00122"></a>00122     img.height = <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> + <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a>;
<a name="l00123"></a>00123     img.style.visibility = <span class="stringliteral">&#39;hidden&#39;</span>;
<a name="l00124"></a>00124     <span class="keywordflow">if</span> (descriptor.renderedIcon) {
<a name="l00125"></a>00125       this.displayRenderedIcon();
<a name="l00126"></a>00126     } <span class="keywordflow">else</span> {
<a name="l00127"></a>00127       this.fetchImageData();
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129     icon.appendChild(img);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="comment">// Label</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="comment">// wrapper of the label -&gt; overflow text should be centered</span>
<a name="l00134"></a>00134     <span class="comment">// in draggable mode</span>
<a name="l00135"></a>00135     var wrapper = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;span&#39;</span>);
<a name="l00136"></a>00136     wrapper.className = <span class="stringliteral">&#39;labelWrapper&#39;</span>;
<a name="l00137"></a>00137     var label = this.label = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;span&#39;</span>);
<a name="l00138"></a>00138     label.textContent = localizedName;
<a name="l00139"></a>00139     wrapper.appendChild(label);
<a name="l00140"></a>00140     this.applyOverflowTextMask();
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     icon.appendChild(wrapper);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     container.appendChild(icon);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (descriptor.removable === <span class="keyword">true</span>) {
<a name="l00147"></a>00147       this.appendOptions();
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="keywordflow">if</span> (this.downloading) {
<a name="l00151"></a>00151       <span class="comment">//XXX: Bug 816043 We need to force the repaint to show the span</span>
<a name="l00152"></a>00152       <span class="comment">// with the label and the animation (associated to the span)</span>
<a name="l00153"></a>00153       container.style.visibility = <span class="stringliteral">&#39;visible&#39;</span>;
<a name="l00154"></a>00154       icon.classList.add(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156   },
<a name="l00157"></a>00157 
<a name="l00158"></a>00158   appendOptions: <span class="keyword">function</span> icon_appendOptions() {
<a name="l00159"></a>00159     var <a class="code" href="../../d6/d46/system_2js_2icc_8js.html#a77e4041f4236c111378c64001ea99114">options</a> = this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.querySelector(<span class="stringliteral">&#39;.options&#39;</span>);
<a name="l00160"></a>00160     <span class="keywordflow">if</span> (options) {
<a name="l00161"></a>00161       <span class="keywordflow">return</span>;
<a name="l00162"></a>00162     }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <span class="comment">// Menu button to delete the app</span>
<a name="l00165"></a>00165     options = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;span&#39;</span>);
<a name="l00166"></a>00166     options.className = <span class="stringliteral">&#39;options&#39;</span>;
<a name="l00167"></a>00167     options.dataset.isIcon = <span class="keyword">true</span>;
<a name="l00168"></a>00168     this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.appendChild(options);
<a name="l00169"></a>00169   },
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   removeOptions: <span class="keyword">function</span> icon_removeOptions() {
<a name="l00172"></a>00172     var <a class="code" href="../../d6/d46/system_2js_2icc_8js.html#a77e4041f4236c111378c64001ea99114">options</a> = this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.querySelector(<span class="stringliteral">&#39;.options&#39;</span>);
<a name="l00173"></a>00173     <span class="keywordflow">if</span> (!options) {
<a name="l00174"></a>00174       <span class="keywordflow">return</span>;
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.removeChild(options);
<a name="l00178"></a>00178   },
<a name="l00179"></a>00179 
<a name="l00180"></a>00180   applyOverflowTextMask: <span class="keyword">function</span> icon_applyOverflowTextMask() {
<a name="l00181"></a>00181     var label = this.label;
<a name="l00182"></a>00182     <span class="keywordflow">if</span> (<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a70ea7e9f645f301b4ebd1e8258acbb72">TextOverflowDetective</a>.check(label.textContent)) {
<a name="l00183"></a>00183       label.parentNode.classList.add(<span class="stringliteral">&#39;mask&#39;</span>);
<a name="l00184"></a>00184     } <span class="keywordflow">else</span> {
<a name="l00185"></a>00185       label.parentNode.classList.remove(<span class="stringliteral">&#39;mask&#39;</span>);
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187   },
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   fetchImageData: <span class="keyword">function</span> icon_fetchImageData() {
<a name="l00190"></a>00190     var <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a> = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00191"></a>00191     var icon = descriptor.icon;
<a name="l00192"></a>00192     <span class="keywordflow">if</span> (!icon) {
<a name="l00193"></a>00193       this.loadCachedIcon();
<a name="l00194"></a>00194       <span class="keywordflow">return</span>;
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="comment">// Display the default/oldRendered icon before trying to get the icon.</span>
<a name="l00198"></a>00198     <span class="comment">// Sometimes when the network is quite bad the XHR can take time, and we</span>
<a name="l00199"></a>00199     <span class="comment">// have an empty space</span>
<a name="l00200"></a>00200     this.loadCachedIcon();
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <a class="code" href="../../de/dda/icon__retriever_8js.html#a52f720eceaf8b8733306f9481394f9da">IconRetriever</a>.get({
<a name="l00203"></a>00203       icon: <span class="keyword">this</span>,
<a name="l00204"></a>00204       <a class="code" href="../../db/df4/geoloc_8js.html#a15b4f92b0ef49ac05f43437f3d85ae46">success</a>: <span class="keyword">function</span>(blob) {
<a name="l00205"></a>00205         this.loadImageData(blob);
<a name="l00206"></a>00206       },
<a name="l00207"></a>00207       <a class="code" href="../../d0/de6/fake-oncall-desktop_8js.html#a6efd5e1eedff09b640ec574dc6dd2879">error</a>: <span class="keyword">function</span>() {
<a name="l00208"></a>00208         <span class="keywordflow">if</span> (this.icon &amp;&amp; !this.downloading &amp;&amp;
<a name="l00209"></a>00209             this.icon.classList.contains(<span class="stringliteral">&#39;loading&#39;</span>)) {
<a name="l00210"></a>00210           this.icon.classList.remove(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l00211"></a>00211           this.img.src = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213         this.loadCachedIcon();
<a name="l00214"></a>00214       }
<a name="l00215"></a>00215     });
<a name="l00216"></a>00216   },
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   loadCachedIcon: <span class="keyword">function</span> icon_loadCachedImage() {
<a name="l00219"></a>00219     var oldRenderedIcon = this.oldRenderedIcon;
<a name="l00220"></a>00220     <span class="keywordflow">if</span> (oldRenderedIcon &amp;&amp; oldRenderedIcon instanceof <a class="code" href="../../d7/d4b/namespacemozilla_1_1dom.html#a739d106dcb2584188674bb530d99233e">Blob</a>) {
<a name="l00221"></a>00221       this.renderBlob(oldRenderedIcon);
<a name="l00222"></a>00222     } <span class="keywordflow">else</span> {
<a name="l00223"></a>00223       this.loadDefaultIcon();
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225   },
<a name="l00226"></a>00226 
<a name="l00227"></a>00227   loadImageData: <span class="keyword">function</span> icon_loadImageData(blob) {
<a name="l00228"></a>00228     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l00229"></a>00229     var img = <span class="keyword">new</span> Image();
<a name="l00230"></a>00230     img.src = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.URL.createObjectURL(blob);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (this.icon &amp;&amp; !this.downloading) {
<a name="l00233"></a>00233       this.icon.classList.remove(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     img.onload = <span class="keyword">function</span> icon_loadSuccess() {
<a name="l00237"></a>00237       img.onload = img.onerror = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00238"></a>00238       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.URL.revokeObjectURL(img.src);
<a name="l00239"></a>00239       <span class="keyword">self</span>.renderImage(img);
<a name="l00240"></a>00240       <span class="keyword">self</span>.isDefaultIcon = <span class="keyword">false</span>;
<a name="l00241"></a>00241     };
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     img.onerror = <span class="keyword">function</span> icon_loadError() {
<a name="l00244"></a>00244       <a class="code" href="../../d9/d42/caldav__worker_8js.html#ac798a668e63cdb5c7af2b97ab014f85f">console</a>.error(<span class="stringliteral">&#39;error while loading the icon&#39;</span>, img.src, <span class="stringliteral">&#39;. Falling back &#39;</span> +
<a name="l00245"></a>00245           <span class="stringliteral">&#39;to default icon.&#39;</span>);
<a name="l00246"></a>00246       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.URL.revokeObjectURL(img.src);
<a name="l00247"></a>00247       <span class="keyword">self</span>.loadDefaultIcon(img);
<a name="l00248"></a>00248     };
<a name="l00249"></a>00249   },
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   loadDefaultIcon: <span class="keyword">function</span> icon_loadDefaultIcon(img) {
<a name="l00252"></a>00252     var image = img || <span class="keyword">new</span> Image();
<a name="l00253"></a>00253     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (<span class="keyword">self</span>.img &amp;&amp; <span class="keyword">self</span>.img.src) {
<a name="l00256"></a>00256       <span class="comment">// If there is one already loaded, do not continue...</span>
<a name="l00257"></a>00257       image.onload = image.onerror = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00258"></a>00258       <span class="keywordflow">return</span>;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     var blob = GridManager.getBlobByDefault(<span class="keyword">self</span>.<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>);
<a name="l00262"></a>00262     <span class="keywordflow">if</span> (blob === <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>) {
<a name="l00263"></a>00263       <span class="comment">// At this point theoretically the flow shouldn&#39;t go because the icons</span>
<a name="l00264"></a>00264       <span class="comment">// by default have to be loaded, but just in case to avoid race conditions</span>
<a name="l00265"></a>00265       image.src = <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#aa6bcd4dc418bb0efb5bc81b32871b840">getDefaultIcon</a>(<span class="keyword">self</span>.<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>);
<a name="l00266"></a>00266       image.onload = <span class="keyword">function</span> icon_defaultIconLoadSucess() {
<a name="l00267"></a>00267         image.onload = image.onerror = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00268"></a>00268         <span class="keyword">self</span>.renderImage(image);
<a name="l00269"></a>00269       };
<a name="l00270"></a>00270     } <span class="keywordflow">else</span> {
<a name="l00271"></a>00271       <span class="keyword">self</span>.renderBlob(blob);
<a name="l00272"></a>00272       image.onload = image.onerror = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     this.isDefaultIcon = <span class="keyword">true</span>;
<a name="l00276"></a>00276   },
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   renderImageForBookMark: <span class="keyword">function</span> icon_renderImageForBookmark(img) {
<a name="l00279"></a>00279     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l00280"></a>00280     var <a class="code" href="../../d3/d2e/webgl-demo_8js.html#a1c82fafbefefac03f47e6f1a3cad5b73">canvas</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;canvas&#39;</span>);
<a name="l00281"></a>00281     canvas.width = (<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> + <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a>) * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>;
<a name="l00282"></a>00282     canvas.height = (<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> + <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a>) * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>;
<a name="l00283"></a>00283     var ctx = canvas.getContext(<span class="stringliteral">&#39;2d&#39;</span>);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <span class="comment">// Draw the background</span>
<a name="l00286"></a>00286     var <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#aa550bd736a6ba92fe729eec3be3a51f5">background</a> = <span class="keyword">new</span> Image();
<a name="l00287"></a>00287     background.src = <span class="stringliteral">&#39;style/images/default_background.png&#39;</span>;
<a name="l00288"></a>00288     background.onload = <span class="keyword">function</span> icon_loadBackgroundSuccess() {
<a name="l00289"></a>00289       ctx.shadowColor = <span class="stringliteral">&#39;rgba(0,0,0,0.8)&#39;</span>;
<a name="l00290"></a>00290       ctx.shadowBlur = 2;
<a name="l00291"></a>00291       ctx.shadowOffsetY = 2;
<a name="l00292"></a>00292       ctx.drawImage(background, 2 * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>, 2 * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>,
<a name="l00293"></a>00293                     <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>, <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> * SCALE_RATIO);
<a name="l00294"></a>00294       <span class="comment">// Disable smoothing on icon resize</span>
<a name="l00295"></a>00295       ctx.shadowBlur = 0;
<a name="l00296"></a>00296       ctx.shadowOffsetY = 0;
<a name="l00297"></a>00297       ctx.mozImageSmoothingEnabled = <span class="keyword">false</span>;
<a name="l00298"></a>00298       ctx.drawImage(img, 16 * SCALE_RATIO, 16 * SCALE_RATIO,
<a name="l00299"></a>00299                     32 * SCALE_RATIO, 32 * SCALE_RATIO);
<a name="l00300"></a>00300       canvas.toBlob(<span class="keyword">self</span>.renderBlob.bind(<span class="keyword">self</span>));
<a name="l00301"></a>00301     };
<a name="l00302"></a>00302   },
<a name="l00303"></a>00303 
<a name="l00304"></a>00304   renderImage: <span class="keyword">function</span> icon_renderImage(img) {
<a name="l00305"></a>00305     <span class="keywordflow">if</span> (this.<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a> &amp;&amp; this.<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>.iconable) {
<a name="l00306"></a>00306       this.renderImageForBookMark(img);
<a name="l00307"></a>00307       <span class="keywordflow">return</span>;
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     var <a class="code" href="../../d3/d2e/webgl-demo_8js.html#a1c82fafbefefac03f47e6f1a3cad5b73">canvas</a> = this.createCanvas(img, this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.type);
<a name="l00311"></a>00311     canvas.toBlob(this.renderBlob.bind(<span class="keyword">this</span>));
<a name="l00312"></a>00312   },
<a name="l00313"></a>00313 
<a name="l00314"></a>00314   createCanvas: <span class="keyword">function</span> icon_createCanvas(img, <a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a>) {
<a name="l00315"></a>00315     var <a class="code" href="../../d3/d2e/webgl-demo_8js.html#a1c82fafbefefac03f47e6f1a3cad5b73">canvas</a> = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;canvas&#39;</span>);
<a name="l00316"></a>00316     canvas.width = (<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> + <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a>) * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>;
<a name="l00317"></a>00317     canvas.height = (<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> + <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a>) * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     var ctx = canvas.getContext(<span class="stringliteral">&#39;2d&#39;</span>);
<a name="l00320"></a>00320     ctx.clearRect(0, 0, canvas.width, canvas.height);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="comment">// Collection icons are self contained and should NOT be manipulated</span>
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (<a class="code" href="../../df/d44/permission__manager_8js.html#a5996578fe734dff3d2912807ee458e83">type</a> !== <a class="code" href="../../df/d44/grid__components_8js.html#acb1b7986f3c9f443299948de66072e15">GridItemsFactory</a>.TYPE.COLLECTION) {
<a name="l00324"></a>00324       ctx.shadowColor = <span class="stringliteral">&#39;rgba(0,0,0,0.8)&#39;</span>;
<a name="l00325"></a>00325       ctx.shadowBlur = 2;
<a name="l00326"></a>00326       ctx.shadowOffsetY = 2;
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">// Deal with very small or very large icons</span>
<a name="l00330"></a>00330     img.width =
<a name="l00331"></a>00331         Math.min(<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a>, Math.max(img.width, <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a>));
<a name="l00332"></a>00332     img.height =
<a name="l00333"></a>00333         Math.min(<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a>, Math.max(img.height, <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a>));
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     var <a class="code" href="../../d4/d8c/viewphoto_8js.html#adb90f9ed3668a895cc5b90a19bcdee13">width</a> = Math.min(img.width * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>,
<a name="l00336"></a>00336                          canvas.width - <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a> * <a class="code" href="../../d7/d68/apps_2communications_2contacts_2js_2contacts_8js.html#a55390d56661168977cb2f85733847f93">SCALE_RATIO</a>);
<a name="l00337"></a>00337     var <a class="code" href="../../d4/d8c/viewphoto_8js.html#a06f7a63ceb91351a4c31800c9a7af42f">height</a> = Math.min(img.width * SCALE_RATIO,
<a name="l00338"></a>00338                           canvas.height - <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9808de3722673f5ca7a881cdb994d3df">ICON_PADDING_IN_CANVAS</a> * SCALE_RATIO);
<a name="l00339"></a>00339     ctx.drawImage(img,
<a name="l00340"></a>00340                   (canvas.width - width) / 2,
<a name="l00341"></a>00341                   (canvas.height - height) / 2,
<a name="l00342"></a>00342                   width, height);
<a name="l00343"></a>00343     ctx.fill();
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="keywordflow">return</span> <a class="code" href="../../d3/d2e/webgl-demo_8js.html#a1c82fafbefefac03f47e6f1a3cad5b73">canvas</a>;
<a name="l00346"></a>00346   },
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   <span class="comment">// The url that is passed as a parameter to the callback must be revoked</span>
<a name="l00349"></a>00349   loadRenderedIcon: <span class="keyword">function</span> icon_loadRenderedIcon(<a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>) {
<a name="l00350"></a>00350     var img = this.img;
<a name="l00351"></a>00351     img.src = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.URL.createObjectURL(this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.renderedIcon);
<a name="l00352"></a>00352     <span class="keywordflow">if</span> (<a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>) {
<a name="l00353"></a>00353       img.onload = img.onerror = <span class="keyword">function</span> <a class="code" href="../../d4/daf/video_2js_2view_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>() {
<a name="l00354"></a>00354         <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>(this.src);
<a name="l00355"></a>00355         img.onload = img.onerror = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00356"></a>00356       };
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358   },
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   renderBlob: <span class="keyword">function</span> icon_renderBlob(blob) {
<a name="l00361"></a>00361     this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.renderedIcon = blob;
<a name="l00362"></a>00362     GridManager.markDirtyState();
<a name="l00363"></a>00363     this.displayRenderedIcon();
<a name="l00364"></a>00364   },
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   displayRenderedIcon: <span class="keyword">function</span> icon_displayRenderedIcon() {
<a name="l00367"></a>00367     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l00368"></a>00368     this.loadRenderedIcon(<span class="keyword">function</span> cleanup(<a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>) {
<a name="l00369"></a>00369       <span class="keyword">self</span>.img.style.visibility = <span class="stringliteral">&#39;visible&#39;</span>;
<a name="l00370"></a>00370       <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.URL.revokeObjectURL(<a class="code" href="../../d3/d4b/lockscreen_8js.html#a85c9a955e7da65bfd5fc9b87158c3570">url</a>);
<a name="l00371"></a>00371       <span class="keywordflow">if</span> (<span class="keyword">self</span>.needsShow)
<a name="l00372"></a>00372         <span class="keyword">self</span>.show();
<a name="l00373"></a>00373     });
<a name="l00374"></a>00374   },
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   <a class="code" href="../../d4/dc5/handled__call_8js.html#a849945b83cbf2e6fcd68a90c133c1824">show</a>: <span class="keyword">function</span> icon_show() {
<a name="l00377"></a>00377     <span class="comment">// Wait for the icon image to load until we start the animation.</span>
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (!this.img.naturalWidth) {
<a name="l00379"></a>00379       this.needsShow = <span class="keyword">true</span>;
<a name="l00380"></a>00380       <span class="keywordflow">return</span>;
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     this.needsShow = <span class="keyword">false</span>;
<a name="l00384"></a>00384     var <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a> = this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>;
<a name="l00385"></a>00385     container.dataset.visible = <span class="keyword">true</span>;
<a name="l00386"></a>00386     container.addEventListener(<span class="stringliteral">&#39;animationend&#39;</span>, <span class="keyword">function</span> animationEnd(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00387"></a>00387       container.removeEventListener(<span class="stringliteral">&#39;animationend&#39;</span>, animationEnd);
<a name="l00388"></a>00388       <span class="keyword">delete</span> container.dataset.visible;
<a name="l00389"></a>00389     });
<a name="l00390"></a>00390   },
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   updateAppStatus: <span class="keyword">function</span> icon_updateAppStatus(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>) {
<a name="l00393"></a>00393     <span class="comment">// change default icon size for tablet+ device</span>
<a name="l00394"></a>00394     <span class="keywordflow">if</span> (<a class="code" href="../../d7/da5/build__stage_2email_2shared_2js_2screen__layout_8js.html#a24f08bbe95dab8c81693a4b16670e6f6">ScreenLayout</a>.getCurrentLayout() !== <span class="stringliteral">&#39;tiny&#39;</span>) {
<a name="l00395"></a>00395       <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a86bc61a0f00d2ceb087886a5c6da92c1">MAX_ICON_SIZE</a> = 100;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>) {
<a name="l00398"></a>00398       this.downloading = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>.downloading;
<a name="l00399"></a>00399       this.cancelled = (<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>.installState === <span class="stringliteral">&#39;pending&#39;</span>) &amp;&amp; !<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>.downloading;
<a name="l00400"></a>00400     } <span class="keywordflow">else</span> {
<a name="l00401"></a>00401       this.downloading = <span class="keyword">false</span>;
<a name="l00402"></a>00402       this.cancelled = <span class="keyword">false</span>;
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404   },
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   <a class="code" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a>: <span class="keyword">function</span> icon_update(<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>, <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>) {
<a name="l00407"></a>00407     this.<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a> = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>;
<a name="l00408"></a>00408     this.updateAppStatus(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>);
<a name="l00409"></a>00409     var oldDescriptor = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00410"></a>00410     this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a> = <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00411"></a>00411     <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.removable === <span class="keyword">true</span> ? this.appendOptions() : this.removeOptions();
<a name="l00412"></a>00412 
<a name="l00413"></a>00413     <span class="comment">// Update dataset properties</span>
<a name="l00414"></a>00414     this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.dataset.offlineReady = this.isOfflineReady();
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.updateTime == oldDescriptor.updateTime &amp;&amp;
<a name="l00417"></a>00417         <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.icon == oldDescriptor.icon) {
<a name="l00418"></a>00418       this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.renderedIcon = oldDescriptor.renderedIcon;
<a name="l00419"></a>00419     } <span class="keywordflow">else</span> {
<a name="l00420"></a>00420       this.oldRenderedIcon = oldDescriptor.renderedIcon;
<a name="l00421"></a>00421       this.fetchImageData();
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.updateTime != oldDescriptor.updateTime ||
<a name="l00424"></a>00424         <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.name != oldDescriptor.name ||
<a name="l00425"></a>00425         <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.localizedName != oldDescriptor.localizedName) {
<a name="l00426"></a>00426       this.<a class="code" href="../../d3/d91/j3d_8js.html#aa896eca296d874b4719e6210a120ebe5">translate</a>();
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428   },
<a name="l00429"></a>00429 
<a name="l00430"></a>00430   showDownloading: <span class="keyword">function</span> icon_showDownloading() {
<a name="l00431"></a>00431     this.img.src = this.DOWNLOAD_ICON_URL;
<a name="l00432"></a>00432     this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.style.visibility = <span class="stringliteral">&#39;visible&#39;</span>;
<a name="l00433"></a>00433     this.icon.classList.add(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l00434"></a>00434   },
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   showCancelled: <span class="keyword">function</span> icon_showCancelled() {
<a name="l00437"></a>00437     this.img.src = this.CANCELED_ICON_URL;
<a name="l00438"></a>00438     this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.style.visibility = <span class="stringliteral">&#39;visible&#39;</span>;
<a name="l00439"></a>00439     this.icon.classList.remove(<span class="stringliteral">&#39;loading&#39;</span>);
<a name="l00440"></a>00440     this.fetchImageData();
<a name="l00441"></a>00441   },
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   <span class="keyword">remove</span>: <span class="keyword">function</span> icon_remove() {
<a name="l00444"></a>00444     this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.parentNode.removeChild(this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>);
<a name="l00445"></a>00445   },
<a name="l00446"></a>00446 
<a name="l00447"></a>00447   <span class="comment">/*</span>
<a name="l00448"></a>00448 <span class="comment">   * Sets a non-translationable name</span>
<a name="l00449"></a>00449 <span class="comment">   *</span>
<a name="l00450"></a>00450 <span class="comment">   * @param{string} non-translationable name</span>
<a name="l00451"></a>00451 <span class="comment">   */</span>
<a name="l00452"></a>00452   setName: <span class="keyword">function</span> icon_setName(<a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>) {
<a name="l00453"></a>00453     this.label.textContent = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.customName = <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>;
<a name="l00454"></a>00454     this.applyOverflowTextMask();
<a name="l00455"></a>00455     GridManager.markDirtyState();
<a name="l00456"></a>00456   },
<a name="l00457"></a>00457 
<a name="l00458"></a>00458   <span class="comment">/*</span>
<a name="l00459"></a>00459 <span class="comment">   * Returns the name icon</span>
<a name="l00460"></a>00460 <span class="comment">   */</span>
<a name="l00461"></a>00461   getName: <span class="keyword">function</span> icon_getName() {
<a name="l00462"></a>00462     var <a class="code" href="../../d8/dd0/extension__set_8h.html#a348efe6592512f937a672d5f5ec7d76a">desc</a> = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00463"></a>00463     <span class="keywordflow">return</span> desc.customName || desc.localizedName || desc.name;
<a name="l00464"></a>00464   },
<a name="l00465"></a>00465 
<a name="l00466"></a>00466   <span class="comment">/*</span>
<a name="l00467"></a>00467 <span class="comment">   * Sets the icon&#39;s image</span>
<a name="l00468"></a>00468 <span class="comment">   *</span>
<a name="l00469"></a>00469 <span class="comment">   * @param{string} the new icon</span>
<a name="l00470"></a>00470 <span class="comment">   */</span>
<a name="l00471"></a>00471   setImage: <span class="keyword">function</span> icon_setImage(image) {
<a name="l00472"></a>00472     this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.icon = image;
<a name="l00473"></a>00473     this.fetchImageData();
<a name="l00474"></a>00474   },
<a name="l00475"></a>00475 
<a name="l00476"></a>00476   <span class="comment">/*</span>
<a name="l00477"></a>00477 <span class="comment">   * Translates the label of the icon</span>
<a name="l00478"></a>00478 <span class="comment">   */</span>
<a name="l00479"></a>00479   <a class="code" href="../../d3/d91/j3d_8js.html#aa896eca296d874b4719e6210a120ebe5">translate</a>: <span class="keyword">function</span> icon_translate() {
<a name="l00480"></a>00480     var <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a> = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00481"></a>00481     <span class="keywordflow">if</span> (descriptor.type === <a class="code" href="../../df/d44/grid__components_8js.html#acb1b7986f3c9f443299948de66072e15">GridItemsFactory</a>.TYPE.BOOKMARK ||
<a name="l00482"></a>00482         descriptor.customName)
<a name="l00483"></a>00483       <span class="keywordflow">return</span>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     var <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a> = this.<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>;
<a name="l00486"></a>00486     <span class="keywordflow">if</span> (!app)
<a name="l00487"></a>00487       <span class="keywordflow">return</span>;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     var <a class="code" href="../../da/d88/mock__configurator_8js.html#a3c65d07fe933acaaf1205d12ce79b115">manifest</a> = app.manifest || app.updateManifest;
<a name="l00490"></a>00490     <span class="keywordflow">if</span> (!manifest)
<a name="l00491"></a>00491       <span class="keywordflow">return</span>;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     var localizedName;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="keywordflow">if</span> (descriptor.type === <a class="code" href="../../df/d44/grid__components_8js.html#acb1b7986f3c9f443299948de66072e15">GridItemsFactory</a>.TYPE.COLLECTION) {
<a name="l00496"></a>00496       localizedName = <a class="code" href="../../d0/d94/tools_2xpcwindow_2lib_2loader_8js.html#a1ab79c9277f7648d0dfe676bab65dde4">navigator</a>.mozL10n.get(manifest.name);
<a name="l00497"></a>00497     } <span class="keywordflow">else</span> {
<a name="l00498"></a>00498       var iconsAndNameHolder = <a class="code" href="../../da/d88/mock__configurator_8js.html#a3c65d07fe933acaaf1205d12ce79b115">manifest</a>;
<a name="l00499"></a>00499       var entryPoint = descriptor.entry_point;
<a name="l00500"></a>00500       <span class="keywordflow">if</span> (entryPoint)
<a name="l00501"></a>00501         iconsAndNameHolder = manifest.entry_points[entryPoint];
<a name="l00502"></a>00502 
<a name="l00503"></a>00503       localizedName = <span class="keyword">new</span> <a class="code" href="../../de/d15/build__stage_2email_2shared_2js_2manifest__helper_8js.html#a9e0e7d589d3b2abe846fcb2e30f9e2d4">ManifestHelper</a>(iconsAndNameHolder).name;
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     this.label.textContent = localizedName;
<a name="l00507"></a>00507     <span class="keywordflow">if</span> (descriptor.localizedName != localizedName) {
<a name="l00508"></a>00508       descriptor.localizedName = localizedName;
<a name="l00509"></a>00509       GridManager.markDirtyState();
<a name="l00510"></a>00510     }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     this.applyOverflowTextMask();
<a name="l00513"></a>00513   },
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <span class="comment">/*</span>
<a name="l00516"></a>00516 <span class="comment">   * This method is invoked when the drag gesture starts</span>
<a name="l00517"></a>00517 <span class="comment">   *</span>
<a name="l00518"></a>00518 <span class="comment">   * @param{int} x-coordinate</span>
<a name="l00519"></a>00519 <span class="comment">   *</span>
<a name="l00520"></a>00520 <span class="comment">   * @param{int} y-coordinate</span>
<a name="l00521"></a>00521 <span class="comment">   */</span>
<a name="l00522"></a>00522   onDragStart: <span class="keyword">function</span> icon_onDragStart(x, y) {
<a name="l00523"></a>00523     this.initX = x;
<a name="l00524"></a>00524     this.initY = y;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     var draggableElem = this.draggableElem = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;div&#39;</span>);
<a name="l00527"></a>00527     draggableElem.className = <span class="stringliteral">&#39;draggable&#39;</span>;
<a name="l00528"></a>00528     <span class="keywordflow">if</span> (this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.type !== <a class="code" href="../../df/d44/grid__components_8js.html#acb1b7986f3c9f443299948de66072e15">GridItemsFactory</a>.TYPE.COLLECTION) {
<a name="l00529"></a>00529       <span class="comment">// Collections cannot be appended to others so this operation isn&#39;t needed</span>
<a name="l00530"></a>00530       this.savePostion(draggableElem.dataset);
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     <span class="comment">// For some reason, cloning and moving a node re-triggers the blob</span>
<a name="l00534"></a>00534     <span class="comment">// URI to be validated. So we assign a new blob URI to the image</span>
<a name="l00535"></a>00535     <span class="comment">// and don&#39;t revoke it until we&#39;re finished with the animation.</span>
<a name="l00536"></a>00536     this.loadRenderedIcon();
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     var icon = this.icon.cloneNode();
<a name="l00539"></a>00539     var img = icon.querySelector(<span class="stringliteral">&#39;img&#39;</span>);
<a name="l00540"></a>00540     img.style.visibility = <span class="stringliteral">&#39;hidden&#39;</span>;
<a name="l00541"></a>00541     img.onload = img.onerror = <span class="keyword">function</span> unhide() {
<a name="l00542"></a>00542       img.style.visibility = <span class="stringliteral">&#39;visible&#39;</span>;
<a name="l00543"></a>00543     };
<a name="l00544"></a>00544     draggableElem.appendChild(icon);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     var <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a> = this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>;
<a name="l00547"></a>00547     container.dataset.dragging = <span class="stringliteral">&#39;true&#39;</span>;
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     var rectangle = container.getBoundingClientRect();
<a name="l00550"></a>00550     var style = draggableElem.style;
<a name="l00551"></a>00551     style.left = rectangle.left + <span class="stringliteral">&#39;px&#39;</span>;
<a name="l00552"></a>00552     style.top = rectangle.top + <span class="stringliteral">&#39;px&#39;</span>;
<a name="l00553"></a>00553     this.initXCenter = (rectangle.left + rectangle.right) / 2;
<a name="l00554"></a>00554     this.initYCenter = (rectangle.top + rectangle.bottom) / 2;
<a name="l00555"></a>00555     this.initHeight = rectangle.bottom - rectangle.top;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557     <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.body.appendChild(draggableElem);
<a name="l00558"></a>00558   },
<a name="l00559"></a>00559 
<a name="l00560"></a>00560   <span class="comment">/*</span>
<a name="l00561"></a>00561 <span class="comment">   * Saves the current container (page or dock) and  position.</span>
<a name="l00562"></a>00562 <span class="comment">   *</span>
<a name="l00563"></a>00563 <span class="comment">   * * pageType -&gt; &#39;dock&#39; or &#39;page&#39; types</span>
<a name="l00564"></a>00564 <span class="comment">   * * pageIndex -&gt; index of page (no needed for dock)</span>
<a name="l00565"></a>00565 <span class="comment">   * * iconIndex -&gt; index of icon inside page or dock container</span>
<a name="l00566"></a>00566 <span class="comment">   *</span>
<a name="l00567"></a>00567 <span class="comment">   * @param{Object} Source object to set results</span>
<a name="l00568"></a>00568 <span class="comment">   */</span>
<a name="l00569"></a>00569   savePostion: <span class="keyword">function</span> icon_savePosition(<a class="code" href="../../d2/d7d/jsapi_8h.html#a2219cf9467e8547184b3cf2b051e8067">obj</a>) {
<a name="l00570"></a>00570     var <a class="code" href="../../d7/d9d/time__test_8js.html#a9b03e8a9f4440c3c0c605b05ef1b0885">page</a>;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.parentNode === <a class="code" href="../../d4/d13/dock_8js.html#a68d9872efc4d55d7a43005612d267bcb">DockManager</a>.page.olist) {
<a name="l00573"></a>00573       page = <a class="code" href="../../d4/d13/dock_8js.html#a68d9872efc4d55d7a43005612d267bcb">DockManager</a>.page;
<a name="l00574"></a>00574       <a class="code" href="../../d2/d7d/jsapi_8h.html#a2219cf9467e8547184b3cf2b051e8067">obj</a>.pageType = <span class="stringliteral">&#39;dock&#39;</span>;
<a name="l00575"></a>00575     } <span class="keywordflow">else</span> {
<a name="l00576"></a>00576       page = GridManager.pageHelper.getCurrent();
<a name="l00577"></a>00577       <a class="code" href="../../d2/d7d/jsapi_8h.html#a2219cf9467e8547184b3cf2b051e8067">obj</a>.pageType = <span class="stringliteral">&#39;page&#39;</span>;
<a name="l00578"></a>00578       <a class="code" href="../../d2/d7d/jsapi_8h.html#a2219cf9467e8547184b3cf2b051e8067">obj</a>.pageIndex = GridManager.pageHelper.getCurrentPageNumber();
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <a class="code" href="../../d2/d7d/jsapi_8h.html#a2219cf9467e8547184b3cf2b051e8067">obj</a>.iconIndex = page.getIconIndex(this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>);
<a name="l00582"></a>00582   },
<a name="l00583"></a>00583 
<a name="l00584"></a>00584   addClassToDragElement: <span class="keyword">function</span> icon_addStyleToDragElement(className) {
<a name="l00585"></a>00585     this.draggableElem.classList.add(className);
<a name="l00586"></a>00586   },
<a name="l00587"></a>00587 
<a name="l00588"></a>00588   removeClassToDragElement: <span class="keyword">function</span> icon_addStyleToDragElement(className) {
<a name="l00589"></a>00589     this.draggableElem.classList.remove(className);
<a name="l00590"></a>00590   },
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="comment">/*</span>
<a name="l00593"></a>00593 <span class="comment">   * This method is invoked when the drag gesture finishes. If x and y are</span>
<a name="l00594"></a>00594 <span class="comment">   * defined, the icon flies to this position</span>
<a name="l00595"></a>00595 <span class="comment">   *</span>
<a name="l00596"></a>00596 <span class="comment">   * @param{Function} callback will be performed when animations finishes</span>
<a name="l00597"></a>00597 <span class="comment">   *</span>
<a name="l00598"></a>00598 <span class="comment">   * @param{Integer} x-coordinate</span>
<a name="l00599"></a>00599 <span class="comment">   *</span>
<a name="l00600"></a>00600 <span class="comment">   * @param{Integer} y-coordinate</span>
<a name="l00601"></a>00601 <span class="comment">   *</span>
<a name="l00602"></a>00602 <span class="comment">   * @param{Integer} scale factor of the animation</span>
<a name="l00603"></a>00603 <span class="comment">   */</span>
<a name="l00604"></a>00604   onDragStop: <span class="keyword">function</span> icon_onDragStop(<a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>, tx , ty, <a class="code" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">scale</a>) {
<a name="l00605"></a>00605     var <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a> = this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     var x = tx,
<a name="l00608"></a>00608         y = ty;
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/ical_8js.html#a6053319846c80bf9561a1958bb817380">typeof</a> x === <span class="stringliteral">&#39;undefined&#39;</span>) {
<a name="l00611"></a>00611       var rect = container.getBoundingClientRect();
<a name="l00612"></a>00612       x = (Math.abs(rect.left + rect.right) / 2) % <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.innerWidth;
<a name="l00613"></a>00613       x -= <span class="keyword">this</span>.initXCenter;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615       y = (rect.top + rect.bottom) / 2 +
<a name="l00616"></a>00616           (this.initHeight - (rect.bottom - rect.top)) / 2;
<a name="l00617"></a>00617       y -= this.initYCenter;
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     var draggableElem = this.draggableElem;
<a name="l00621"></a>00621     var style = draggableElem.style;
<a name="l00622"></a>00622     style.MozTransition = <span class="stringliteral">&#39;-moz-transform .4s&#39;</span>;
<a name="l00623"></a>00623     style.MozTransform = <span class="stringliteral">&#39;translate(&#39;</span> + x + <span class="stringliteral">&#39;px,&#39;</span> + y + <span class="stringliteral">&#39;px)&#39;</span>;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     var finishDrag = <span class="keyword">function</span>() {
<a name="l00626"></a>00626       <span class="keyword">delete</span> container.dataset.dragging;
<a name="l00627"></a>00627       <span class="keywordflow">if</span> (draggableElem) {
<a name="l00628"></a>00628         var img = draggableElem.querySelector(<span class="stringliteral">&#39;img&#39;</span>);
<a name="l00629"></a>00629         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.URL.revokeObjectURL(img.src);
<a name="l00630"></a>00630         draggableElem.parentNode.removeChild(draggableElem);
<a name="l00631"></a>00631       }
<a name="l00632"></a>00632       <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>();
<a name="l00633"></a>00633     };
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     <span class="comment">// We ensure that there is not an icon lost on the grid</span>
<a name="l00636"></a>00636     var fallbackID = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.setTimeout(<span class="keyword">function</span>() {
<a name="l00637"></a>00637       fallbackID = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00638"></a>00638       finishDrag();
<a name="l00639"></a>00639     }, this.FALLBACK_DRAG_STOP_DELAY);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     var <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a4a1b5640b674da15d6f1b87899e53789">content</a> = draggableElem.querySelector(<span class="stringliteral">&#39;div&#39;</span>);
<a name="l00642"></a>00642     <a class="code" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">scale</a> = <a class="code" href="../../d1/d22/ical_8js.html#a6053319846c80bf9561a1958bb817380">typeof</a> <a class="code" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">scale</a> !== <span class="stringliteral">&#39;undefined&#39;</span> ? <a class="code" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">scale</a> : 1;
<a name="l00643"></a>00643     content.style.MozTransform = <span class="stringliteral">&#39;scale(&#39;</span> + <a class="code" href="../../d3/d91/j3d_8js.html#a72467d06af86da2230d0bd24ace66356">scale</a> + <span class="charliteral">&#39;)&#39;</span>;
<a name="l00644"></a>00644     content.addEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, <span class="keyword">function</span> tEnd(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00645"></a>00645       <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target.removeEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, tEnd);
<a name="l00646"></a>00646       <span class="keywordflow">if</span> (fallbackID !== <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>) {
<a name="l00647"></a>00647         <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.clearTimeout(fallbackID);
<a name="l00648"></a>00648         finishDrag();
<a name="l00649"></a>00649       }
<a name="l00650"></a>00650     });
<a name="l00651"></a>00651   },
<a name="l00652"></a>00652 
<a name="l00653"></a>00653   getTop: <span class="keyword">function</span> icon_getTop() {
<a name="l00654"></a>00654     <span class="keywordflow">return</span> this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.getBoundingClientRect().top;
<a name="l00655"></a>00655   },
<a name="l00656"></a>00656 
<a name="l00657"></a>00657   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9ca727db19787905a22a480f7359ef77">getLeft</a>: <span class="keyword">function</span> icon_getLeft() {
<a name="l00658"></a>00658     <span class="keywordflow">return</span> this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.getBoundingClientRect().left;
<a name="l00659"></a>00659   },
<a name="l00660"></a>00660 
<a name="l00661"></a>00661   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a0c26f95c8c613c19cf6734254fc5f464">getWidth</a>: <span class="keyword">function</span> icon_getWidth() {
<a name="l00662"></a>00662     <span class="keywordflow">return</span> this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.getBoundingClientRect().width;
<a name="l00663"></a>00663   },
<a name="l00664"></a>00664 
<a name="l00665"></a>00665   <span class="comment">/*</span>
<a name="l00666"></a>00666 <span class="comment">   * Returns the descriptor object</span>
<a name="l00667"></a>00667 <span class="comment">   */</span>
<a name="l00668"></a>00668   getDescriptor: <span class="keyword">function</span> icon_getDescriptor() {
<a name="l00669"></a>00669     <span class="keywordflow">if</span> (this.isDefaultIcon) {
<a name="l00670"></a>00670       <span class="keyword">delete</span> this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.renderedIcon;
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     <span class="keywordflow">return</span> this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>;
<a name="l00674"></a>00674   }
<a name="l00675"></a>00675 };
<a name="l00676"></a>00676 
<a name="l00677"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#acb578e407b7ccb17a8fe25207e7e7c6b">00677</a> <span class="keyword">function</span> <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#acb578e407b7ccb17a8fe25207e7e7c6b">TemplateIcon</a>(iconable) {
<a name="l00678"></a>00678   var <a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a> = {
<a name="l00679"></a>00679     <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: <span class="stringliteral">&#39;templateIcon&#39;</span>,
<a name="l00680"></a>00680     <a class="code" href="../../df/d65/openaudio_8js.html#ac58b4771a596b2a4815b0c4f5109ef14">hidden</a>: <span class="keyword">true</span>,
<a name="l00681"></a>00681     renderedIcon: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>
<a name="l00682"></a>00682   };
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   var <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a> = {};
<a name="l00685"></a>00685   <span class="keywordflow">if</span> (iconable) {
<a name="l00686"></a>00686     app.iconable = <span class="keyword">true</span>;
<a name="l00687"></a>00687   }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a19facd329fb2f940c5ad90e962828aca">Icon</a>.call(<span class="keyword">this</span>, descriptor, app);
<a name="l00690"></a>00690 }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#acb578e407b7ccb17a8fe25207e7e7c6b">TemplateIcon</a>.prototype = {
<a name="l00693"></a>00693   __proto__: <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a19facd329fb2f940c5ad90e962828aca">Icon</a>.prototype,
<a name="l00694"></a>00694   loadDefaultIcon: <span class="keyword">function</span> ticon_loadDefaultIcon() {
<a name="l00695"></a>00695     var image = <span class="keyword">new</span> Image();
<a name="l00696"></a>00696     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l00697"></a>00697     image.src = <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#aa6bcd4dc418bb0efb5bc81b32871b840">getDefaultIcon</a>(<span class="keyword">self</span>.<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>);
<a name="l00698"></a>00698     image.onload = <span class="keyword">function</span> icon_defaultIconLoadSucess() {
<a name="l00699"></a>00699       image.onload = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00700"></a>00700       <span class="keyword">self</span>.renderImage(image);
<a name="l00701"></a>00701     };
<a name="l00702"></a>00702   },
<a name="l00703"></a>00703   renderBlob: <span class="keyword">function</span> ticon_renderBlob(blob) {
<a name="l00704"></a>00704     this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a1207a417b47b08dec9e8da04d8b1e334">descriptor</a>.renderedIcon = blob;
<a name="l00705"></a>00705   }
<a name="l00706"></a>00706 };
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 <span class="comment">/*</span>
<a name="l00709"></a>00709 <span class="comment"> * Page constructor</span>
<a name="l00710"></a>00710 <span class="comment"> *</span>
<a name="l00711"></a>00711 <span class="comment"> * @param {HTMLElement] container</span>
<a name="l00712"></a>00712 <span class="comment"> *                      HTML container element of the page.</span>
<a name="l00713"></a>00713 <span class="comment"> *</span>
<a name="l00714"></a>00714 <span class="comment"> * @param {Array} icons [optional]</span>
<a name="l00715"></a>00715 <span class="comment"> *                List of Icon objects.</span>
<a name="l00716"></a>00716 <span class="comment"> */</span>
<a name="l00717"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ad56e4154f98ee95c4bf8c8942a2f6425">00717</a> <span class="keyword">function</span> <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ad56e4154f98ee95c4bf8c8942a2f6425">Page</a>(<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>, icons, numberOfIcons) {
<a name="l00718"></a>00718   this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a> = this.movableContainer = <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>;
<a name="l00719"></a>00719   <span class="keywordflow">if</span> (icons)
<a name="l00720"></a>00720     this.<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ae7817194480cfc900873938c8e7dd602">render</a>(icons);
<a name="l00721"></a>00721   this.iconsWhileDragging = [];
<a name="l00722"></a>00722   this.maxIcons = numberOfIcons || GridManager.pageHelper.maxIconsPerPage;
<a name="l00723"></a>00723 }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ad56e4154f98ee95c4bf8c8942a2f6425">Page</a>.prototype = {
<a name="l00726"></a>00726 
<a name="l00727"></a>00727   <span class="comment">// After launching an app we disable the page during &lt;this time&gt; in order to</span>
<a name="l00728"></a>00728   <span class="comment">// prevent multiple open-app animations</span>
<a name="l00729"></a>00729   DISABLE_TAP_EVENT_DELAY: 600,
<a name="l00730"></a>00730 
<a name="l00731"></a>00731   FALLBACK_READY_EVENT_DELAY: 1000,
<a name="l00732"></a>00732 
<a name="l00733"></a>00733   <span class="comment">/*</span>
<a name="l00734"></a>00734 <span class="comment">   * Renders a page for a list of apps</span>
<a name="l00735"></a>00735 <span class="comment">   *</span>
<a name="l00736"></a>00736 <span class="comment">   * @param{Array} icons</span>
<a name="l00737"></a>00737 <span class="comment">   *               List of Icon objects.</span>
<a name="l00738"></a>00738 <span class="comment">   */</span>
<a name="l00739"></a>00739   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ae7817194480cfc900873938c8e7dd602">render</a>: <span class="keyword">function</span> pg_render(icons) {
<a name="l00740"></a>00740     this.olist = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.createElement(<span class="stringliteral">&#39;ol&#39;</span>);
<a name="l00741"></a>00741     <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = 0, icon; icon = icons[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++];) {
<a name="l00742"></a>00742       this.appendIcon(icon);
<a name="l00743"></a>00743     }
<a name="l00744"></a>00744     this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.appendChild(this.olist);
<a name="l00745"></a>00745   },
<a name="l00746"></a>00746 
<a name="l00747"></a>00747   <span class="comment">/*</span>
<a name="l00748"></a>00748 <span class="comment">   * Applies a translation effect to the page</span>
<a name="l00749"></a>00749 <span class="comment">   *</span>
<a name="l00750"></a>00750 <span class="comment">   * @param{int} scroll X</span>
<a name="l00751"></a>00751 <span class="comment">   * @param{int} duration</span>
<a name="l00752"></a>00752 <span class="comment">   */</span>
<a name="l00753"></a>00753   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a60edfbbb86b389b69bc1a3a4a4900cb0">moveByWithEffect</a>: <span class="keyword">function</span> pg_moveByWithEffect(scrollX, duration) {
<a name="l00754"></a>00754     var <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a> = this.movableContainer;
<a name="l00755"></a>00755     var style = container.style;
<a name="l00756"></a>00756     style.MozTransform = <span class="stringliteral">&#39;translateX(&#39;</span> + scrollX + <span class="stringliteral">&#39;px)&#39;</span>;
<a name="l00757"></a>00757     style.MozTransition = <span class="stringliteral">&#39;-moz-transform &#39;</span> + duration + <span class="stringliteral">&#39;ms ease&#39;</span>;
<a name="l00758"></a>00758   },
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   <span class="comment">/*</span>
<a name="l00761"></a>00761 <span class="comment">   * Applies a translation to the page</span>
<a name="l00762"></a>00762 <span class="comment">   *</span>
<a name="l00763"></a>00763 <span class="comment">   * @param{int} scroll X</span>
<a name="l00764"></a>00764 <span class="comment">   */</span>
<a name="l00765"></a>00765   moveBy: <span class="keyword">function</span> pg_moveBy(scrollX) {
<a name="l00766"></a>00766     var style = this.movableContainer.style;
<a name="l00767"></a>00767     style.MozTransform = <span class="stringliteral">&#39;translateX(&#39;</span> + scrollX + <span class="stringliteral">&#39;px)&#39;</span>;
<a name="l00768"></a>00768     style.MozTransition = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00769"></a>00769   },
<a name="l00770"></a>00770 
<a name="l00771"></a>00771   <a class="code" href="../../d5/dd7/apps_2communications_2ftu_2js_2app_8js.html#a7d18142e8b0bc568b1692cd28ba1d8a7">ready</a>: <span class="keyword">true</span>,
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   setReady: <span class="keyword">function</span> pg_setReady(<a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>) {
<a name="l00774"></a>00774     this.<a class="code" href="../../d5/dd7/apps_2communications_2ftu_2js_2app_8js.html#a7d18142e8b0bc568b1692cd28ba1d8a7">ready</a> = <a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>;
<a name="l00775"></a>00775     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>) {
<a name="l00776"></a>00776       this.<a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a>.dispatchEvent(<span class="keyword">new</span> <a class="code" href="../../d0/dfb/namespacemozilla_1_1dom_1_1prototypes_1_1id.html#addcec93baff9084aadf2519231ea4a28a9a0643019c2e900911fe21538df95595">CustomEvent</a>(<span class="stringliteral">&#39;onpageready&#39;</span>));
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778   },
<a name="l00779"></a>00779 
<a name="l00780"></a>00780   <span class="comment">/*</span>
<a name="l00781"></a>00781 <span class="comment">   * Changes position between two icons</span>
<a name="l00782"></a>00782 <span class="comment">   *</span>
<a name="l00783"></a>00783 <span class="comment">   * @param {Icon} originIcon</span>
<a name="l00784"></a>00784 <span class="comment">   *               The origin icon that&#39;s being dragged.</span>
<a name="l00785"></a>00785 <span class="comment">   *</span>
<a name="l00786"></a>00786 <span class="comment">   * @param {Icon} targetIcon</span>
<a name="l00787"></a>00787 <span class="comment">   *               The target icon that is replaced by the origin icon.</span>
<a name="l00788"></a>00788 <span class="comment">   */</span>
<a name="l00789"></a>00789   drop: <span class="keyword">function</span> pg_drop(originIcon, targetIcon) {
<a name="l00790"></a>00790     <span class="keywordflow">if</span> (!this.<a class="code" href="../../d5/dd7/apps_2communications_2ftu_2js_2app_8js.html#a7d18142e8b0bc568b1692cd28ba1d8a7">ready</a> || originIcon === targetIcon) {
<a name="l00791"></a>00791       <span class="keywordflow">return</span>;
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794     this.setReady(<span class="keyword">false</span>);
<a name="l00795"></a>00795 
<a name="l00796"></a>00796     var iconList = this.olist.children;
<a name="l00797"></a>00797     <span class="keywordflow">if</span> (originIcon &amp;&amp; targetIcon &amp;&amp; iconList.length &gt; 1) {
<a name="l00798"></a>00798       <span class="keywordflow">if</span> (this.iconsWhileDragging.length === 0)
<a name="l00799"></a>00799         this.iconsWhileDragging = Array.prototype.slice.call(iconList, 0,
<a name="l00800"></a>00800                                                              iconList.length);
<a name="l00801"></a>00801       this.animate(this.iconsWhileDragging, originIcon.container,
<a name="l00802"></a>00802                    targetIcon.container);
<a name="l00803"></a>00803     } <span class="keywordflow">else</span> {
<a name="l00804"></a>00804       <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(this.setReady.bind(<span class="keyword">this</span>, <span class="keyword">true</span>));
<a name="l00805"></a>00805     }
<a name="l00806"></a>00806   },
<a name="l00807"></a>00807 
<a name="l00808"></a>00808   animate: <span class="keyword">function</span> pg_animate(children, draggableNode, targetNode) {
<a name="l00809"></a>00809     var draggableIndex = children.indexOf(draggableNode);
<a name="l00810"></a>00810     var targetIndex = children.indexOf(targetNode);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812     <span class="keywordflow">if</span> (draggableIndex &lt; 0 || targetIndex &lt; 0 || targetIndex &gt;= this.maxIcons) {
<a name="l00813"></a>00813       <span class="comment">// Index is outside the bounds of the array, it doesn&#39;t make sense</span>
<a name="l00814"></a>00814       <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(this.setReady.bind(<span class="keyword">this</span>, <span class="keyword">true</span>));
<a name="l00815"></a>00815       <span class="keywordflow">return</span>;
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818     var upward = draggableIndex &lt; targetIndex;
<a name="l00819"></a>00819     this.draggableNode = draggableNode;
<a name="l00820"></a>00820     this.beforeNode = upward ? targetNode.nextSibling : targetNode;
<a name="l00821"></a>00821     this.<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a78f6c8393e8bb7c6e5c3bf383982408f">placeIcon</a>(draggableNode, draggableIndex, targetIndex);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l00824"></a>00824     targetNode.addEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, <span class="keyword">function</span> onTransitionEnd(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00825"></a>00825       <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target.removeEventListener(<span class="stringliteral">&#39;transitionend&#39;</span>, onTransitionEnd);
<a name="l00826"></a>00826       children.splice(draggableIndex, 1);
<a name="l00827"></a>00827       children.splice(targetIndex, 0, draggableNode);
<a name="l00828"></a>00828       <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(<span class="keyword">self</span>.setReady.bind(<span class="keyword">self</span>, <span class="keyword">true</span>));
<a name="l00829"></a>00829     });
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <span class="keywordflow">if</span> (upward) {
<a name="l00832"></a>00832       <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = draggableIndex + 1; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt;= targetIndex; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++)
<a name="l00833"></a>00833         this.<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a78f6c8393e8bb7c6e5c3bf383982408f">placeIcon</a>(children[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>], i, i - 1, <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a0eea4780de21d02d17f5a0a88400cc9a">DRAGGING_TRANSITION</a>);
<a name="l00834"></a>00834     } <span class="keywordflow">else</span> {
<a name="l00835"></a>00835       <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = targetIndex; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; draggableIndex; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++)
<a name="l00836"></a>00836         this.<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a78f6c8393e8bb7c6e5c3bf383982408f">placeIcon</a>(children[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>], i, i + 1, <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a0eea4780de21d02d17f5a0a88400cc9a">DRAGGING_TRANSITION</a>);
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838   },
<a name="l00839"></a>00839 
<a name="l00840"></a>00840   doDragLeave: <span class="keyword">function</span> pg_doReArrange(<a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>, reflow) {
<a name="l00841"></a>00841     this.iconsWhileDragging.forEach(<span class="keyword">function</span> <a class="code" href="../../db/dac/mock__picker_8js.html#aed26045338f591d889d2a8bf699451ef">reset</a>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>) {
<a name="l00842"></a>00842       <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.style.MozTransform = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.style.MozTransition = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00843"></a>00843       <span class="keyword">delete</span> <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.dataset.posX;
<a name="l00844"></a>00844       <span class="keyword">delete</span> <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.dataset.posY;
<a name="l00845"></a>00845     });
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     this.iconsWhileDragging = [];
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     <span class="keywordflow">if</span> (reflow &amp;&amp; this.olist.contains(<span class="keyword">this</span>.draggableNode))
<a name="l00850"></a>00850       this.olist.insertBefore(<span class="keyword">this</span>.draggableNode, <span class="keyword">this</span>.beforeNode);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852     <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>();
<a name="l00853"></a>00853   },
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   onDragLeave: <span class="keyword">function</span> pg_onDragLeave(<a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>, reflow) {
<a name="l00856"></a>00856     <span class="keywordflow">if</span> (this.iconsWhileDragging.length === 0) {
<a name="l00857"></a>00857       <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(<a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>);
<a name="l00858"></a>00858       <span class="keywordflow">return</span>;
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     <span class="keywordflow">if</span> (!this.<a class="code" href="../../d5/dd7/apps_2communications_2ftu_2js_2app_8js.html#a7d18142e8b0bc568b1692cd28ba1d8a7">ready</a>) {
<a name="l00862"></a>00862       var <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l00863"></a>00863       var ensureCallbackID = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00864"></a>00864       var onPageReady = <span class="keyword">function</span> onPageReady(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>) {
<a name="l00865"></a>00865         <a class="code" href="../../d1/d04/app__install__manager_8js.html#ab5902775854a8b8440bcd25e0fe1c120">e</a>.target.removeEventListener(<span class="stringliteral">&#39;onpageready&#39;</span>, onPageReady);
<a name="l00866"></a>00866         <span class="keywordflow">if</span> (ensureCallbackID !== <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>) {
<a name="l00867"></a>00867           <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.clearTimeout(ensureCallbackID);
<a name="l00868"></a>00868           <span class="keyword">self</span>.doDragLeave(<a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>, reflow);
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870       };
<a name="l00871"></a>00871       <span class="keyword">self</span>.container.addEventListener(<span class="stringliteral">&#39;onpageready&#39;</span>, onPageReady);
<a name="l00872"></a>00872 
<a name="l00873"></a>00873       <span class="comment">// We ensure that there is not a transitionend lost on dragging</span>
<a name="l00874"></a>00874       ensureCallbackID = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.setTimeout(<span class="keyword">function</span>() {
<a name="l00875"></a>00875         ensureCallbackID = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00876"></a>00876         <span class="keyword">self</span>.container.removeEventListener(<span class="stringliteral">&#39;onpageready&#39;</span>, onPageReady);
<a name="l00877"></a>00877         <span class="keyword">self</span>.doDragLeave(<span class="keyword">function</span> onfinish() {
<a name="l00878"></a>00878           <span class="keyword">self</span>.setReady(<span class="keyword">true</span>);
<a name="l00879"></a>00879           <a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>();
<a name="l00880"></a>00880         }, reflow);
<a name="l00881"></a>00881       }, this.FALLBACK_READY_EVENT_DELAY);
<a name="l00882"></a>00882 
<a name="l00883"></a>00883       <span class="keywordflow">return</span>;
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     this.doDragLeave(<a class="code" href="../../df/d44/permission__manager_8js.html#ab95eebdb2a4acb8510417bf0bdabc3c5">callback</a>, reflow);
<a name="l00887"></a>00887   },
<a name="l00888"></a>00888 
<a name="l00889"></a>00889   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a78f6c8393e8bb7c6e5c3bf383982408f">placeIcon</a>: <span class="keyword">function</span> pg_placeIcon(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>, from, <a class="code" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a>, transition) {
<a name="l00890"></a>00890     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>)
<a name="l00891"></a>00891       <span class="keywordflow">return</span>;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     var x = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.dataset.posX = parseInt(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.dataset.posX || 0) +
<a name="l00894"></a>00894                       ((Math.floor(<a class="code" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> % <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a5c090fc6628b0210cf61884a6c25f75a">ICONS_PER_ROW</a>) -
<a name="l00895"></a>00895                         Math.floor(from % ICONS_PER_ROW)) * 100);
<a name="l00896"></a>00896     var y = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.dataset.posY = parseInt(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.dataset.posY || 0) +
<a name="l00897"></a>00897                       ((Math.floor(<a class="code" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> / ICONS_PER_ROW) -
<a name="l00898"></a>00898                         Math.floor(from / ICONS_PER_ROW)) * 100);
<a name="l00899"></a>00899 
<a name="l00900"></a>00900     <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#a1f5517920aaab1f97bda91f10438fb05">window</a>.mozRequestAnimationFrame(<span class="keyword">function</span>() {
<a name="l00901"></a>00901       <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.style.MozTransform = <span class="stringliteral">&#39;translate(&#39;</span> + x + <span class="stringliteral">&#39;%, &#39;</span> + y + <span class="stringliteral">&#39;%)&#39;</span>;
<a name="l00902"></a>00902       <span class="keywordflow">if</span> (transition)
<a name="l00903"></a>00903         <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a>.style.MozTransition = transition;
<a name="l00904"></a>00904     });
<a name="l00905"></a>00905   },
<a name="l00906"></a>00906 
<a name="l00907"></a>00907   <span class="comment">/*</span>
<a name="l00908"></a>00908 <span class="comment">   * Implements the tap behaviour</span>
<a name="l00909"></a>00909 <span class="comment">   *</span>
<a name="l00910"></a>00910 <span class="comment">   * @param{Object} DOM element</span>
<a name="l00911"></a>00911 <span class="comment">   */</span>
<a name="l00912"></a>00912   tap: <span class="keyword">function</span> pg_tap(elem) {
<a name="l00913"></a>00913     <span class="keywordflow">if</span> (<a class="code" href="../../df/d5c/homescreen_2js_2homescreen_8js.html#af5ec79fceba71070f69014c899cbe746">Homescreen</a>.isInEditMode()) {
<a name="l00914"></a>00914       <span class="keywordflow">if</span> (elem.classList.contains(<span class="stringliteral">&#39;options&#39;</span>)) {
<a name="l00915"></a>00915         var icon = GridManager.getIcon(elem.parentNode.dataset);
<a name="l00916"></a>00916         <span class="keywordflow">if</span> (icon.app)
<a name="l00917"></a>00917           <a class="code" href="../../df/d5c/homescreen_2js_2homescreen_8js.html#af5ec79fceba71070f69014c899cbe746">Homescreen</a>.showAppDialog(icon);
<a name="l00918"></a>00918       }
<a name="l00919"></a>00919     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&#39;isIcon&#39;</span> in elem.dataset &amp;&amp; <span class="keyword">this</span>.olist &amp;&amp;
<a name="l00920"></a>00920                !<span class="keyword">this</span>.olist.getAttribute(<span class="stringliteral">&#39;disabled&#39;</span>)) {
<a name="l00921"></a>00921       var icon = GridManager.getIcon(elem.dataset);
<a name="l00922"></a>00922       <span class="keywordflow">if</span> (!icon.app)
<a name="l00923"></a>00923         <span class="keywordflow">return</span>;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925       <span class="keywordflow">if</span> (icon.descriptor.entry_point) {
<a name="l00926"></a>00926         icon.app.launch(icon.descriptor.entry_point);
<a name="l00927"></a>00927         this.disableTap();
<a name="l00928"></a>00928         <span class="keywordflow">return</span>;
<a name="l00929"></a>00929       }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931       <span class="keywordflow">if</span> (icon.cancelled) {
<a name="l00932"></a>00932         GridManager.showRestartDownloadDialog(icon);
<a name="l00933"></a>00933         <span class="keywordflow">return</span>;
<a name="l00934"></a>00934       }
<a name="l00935"></a>00935       icon.app.launch();
<a name="l00936"></a>00936       this.disableTap();
<a name="l00937"></a>00937     }
<a name="l00938"></a>00938   },
<a name="l00939"></a>00939 
<a name="l00940"></a>00940   <span class="comment">/*</span>
<a name="l00941"></a>00941 <span class="comment">   * Disables the tap event for the page</span>
<a name="l00942"></a>00942 <span class="comment">   *</span>
<a name="l00943"></a>00943 <span class="comment">   * @param{Integer} milliseconds</span>
<a name="l00944"></a>00944 <span class="comment">   */</span>
<a name="l00945"></a>00945   disableTap: <span class="keyword">function</span> pg_disableTap(icon, <a class="code" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>) {
<a name="l00946"></a>00946     var olist = this.olist;
<a name="l00947"></a>00947     olist.setAttribute(<span class="stringliteral">&#39;disabled&#39;</span>, <span class="keyword">true</span>);
<a name="l00948"></a>00948     <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(<span class="keyword">function</span> disableTapTimeout() {
<a name="l00949"></a>00949       olist.removeAttribute(<span class="stringliteral">&#39;disabled&#39;</span>);
<a name="l00950"></a>00950     }, <a class="code" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a> || this.DISABLE_TAP_EVENT_DELAY);
<a name="l00951"></a>00951   },
<a name="l00952"></a>00952 
<a name="l00953"></a>00953   <span class="comment">/*</span>
<a name="l00954"></a>00954 <span class="comment">   * Adds an icon at the position specified</span>
<a name="l00955"></a>00955 <span class="comment">   *</span>
<a name="l00956"></a>00956 <span class="comment">   * @param{Object} icon object</span>
<a name="l00957"></a>00957 <span class="comment">   * @param{Number} index to insert at</span>
<a name="l00958"></a>00958 <span class="comment">   */</span>
<a name="l00959"></a>00959   appendIconAt: <span class="keyword">function</span> pg_appendIconAt(icon, <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>) {
<a name="l00960"></a>00960     var olist = this.olist,
<a name="l00961"></a>00961         children = this.olist.children;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963     <span class="keywordflow">if</span> (children[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>] &amp;&amp; children[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>] === icon.container) {
<a name="l00964"></a>00964       <span class="keywordflow">return</span>;
<a name="l00965"></a>00965     }
<a name="l00966"></a>00966 
<a name="l00967"></a>00967     <span class="keywordflow">if</span> (!icon.container) {
<a name="l00968"></a>00968       icon.render();
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="keywordflow">if</span> (children[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>]) {
<a name="l00972"></a>00972       olist.insertBefore(icon.container, children[index]);
<a name="l00973"></a>00973     } <span class="keywordflow">else</span> {
<a name="l00974"></a>00974       olist.appendChild(icon.container);
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976   },
<a name="l00977"></a>00977 
<a name="l00978"></a>00978   <span class="comment">/*</span>
<a name="l00979"></a>00979 <span class="comment">   * Adds an icon to the begining of the page</span>
<a name="l00980"></a>00980 <span class="comment">   *</span>
<a name="l00981"></a>00981 <span class="comment">   * @param{Object} icon object</span>
<a name="l00982"></a>00982 <span class="comment">   */</span>
<a name="l00983"></a>00983   prependIcon: <span class="keyword">function</span> pg_prependIcon(icon) {
<a name="l00984"></a>00984     var olist = this.olist;
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (olist.children.length &gt; 0) {
<a name="l00986"></a>00986       olist.insertBefore(icon.container, olist.firstChild);
<a name="l00987"></a>00987     } <span class="keywordflow">else</span> {
<a name="l00988"></a>00988       olist.appendChild(icon.container);
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990   },
<a name="l00991"></a>00991 
<a name="l00992"></a>00992   <span class="comment">/*</span>
<a name="l00993"></a>00993 <span class="comment">   * Removes the last icon of the page and returns it</span>
<a name="l00994"></a>00994 <span class="comment">   */</span>
<a name="l00995"></a>00995   popIcon: <span class="keyword">function</span> pg_popIcon() {
<a name="l00996"></a>00996     var icon = this.getLastIcon();
<a name="l00997"></a>00997     icon.remove();
<a name="l00998"></a>00998     <span class="keywordflow">return</span> icon;
<a name="l00999"></a>00999   },
<a name="l01000"></a>01000 
<a name="l01001"></a>01001   insertBeforeLastIcon: <span class="keyword">function</span> pg_insertBeforeLastIcon(icon) {
<a name="l01002"></a>01002     var olist = this.olist;
<a name="l01003"></a>01003     <span class="keywordflow">if</span> (olist.children.length &gt; 0) {
<a name="l01004"></a>01004       olist.insertBefore(icon.container, olist.lastChild);
<a name="l01005"></a>01005     }
<a name="l01006"></a>01006   },
<a name="l01007"></a>01007 
<a name="l01008"></a>01008   <span class="comment">/*</span>
<a name="l01009"></a>01009 <span class="comment">   * Returns the last icon of the page</span>
<a name="l01010"></a>01010 <span class="comment">   */</span>
<a name="l01011"></a>01011   getLastIcon: <span class="keyword">function</span> pg_getLastIcon() {
<a name="l01012"></a>01012     var lastIcon = this.olist.lastChild;
<a name="l01013"></a>01013     <span class="keywordflow">if</span> (this.iconsWhileDragging.length &gt; 0)
<a name="l01014"></a>01014       lastIcon = this.iconsWhileDragging[this.iconsWhileDragging.length - 1];
<a name="l01015"></a>01015 
<a name="l01016"></a>01016     <span class="keywordflow">if</span> (!lastIcon)
<a name="l01017"></a>01017       <span class="keywordflow">return</span> <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l01018"></a>01018     <span class="keywordflow">return</span> GridManager.getIcon(lastIcon.dataset);
<a name="l01019"></a>01019   },
<a name="l01020"></a>01020 
<a name="l01021"></a>01021   <span class="comment">/*</span>
<a name="l01022"></a>01022 <span class="comment">   * Returns the last visible icon of the page</span>
<a name="l01023"></a>01023 <span class="comment">   */</span>
<a name="l01024"></a>01024   getLastVisibleIcon: <span class="keyword">function</span> pg_getLastVisibleIcon() {
<a name="l01025"></a>01025     <span class="keywordflow">if</span> (this.getNumIcons() &lt;= this.maxIcons) {
<a name="l01026"></a>01026       <span class="keywordflow">return</span> this.getLastIcon();
<a name="l01027"></a>01027     } <span class="keywordflow">else</span> {
<a name="l01028"></a>01028       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#a9ed71aaefba3c241c5255080e6a99884">node</a> = this.olist.children[this.maxIcons - 1];
<a name="l01029"></a>01029       <span class="keywordflow">if</span> (this.iconsWhileDragging.length &gt; 0)
<a name="l01030"></a>01030         node = this.iconsWhileDragging[this.maxIcons - 1];
<a name="l01031"></a>01031 
<a name="l01032"></a>01032       <span class="keywordflow">if</span> (!node) {
<a name="l01033"></a>01033         <span class="keywordflow">return</span> <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l01034"></a>01034       }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036       <span class="keywordflow">return</span> GridManager.getIcon(node.dataset);
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038   },
<a name="l01039"></a>01039 
<a name="l01040"></a>01040   <span class="comment">/*</span>
<a name="l01041"></a>01041 <span class="comment">   * Returns the first icon of the page</span>
<a name="l01042"></a>01042 <span class="comment">   */</span>
<a name="l01043"></a>01043   getFirstIcon: <span class="keyword">function</span> pg_getFirstIcon() {
<a name="l01044"></a>01044     var firstIcon = this.olist.firstChild;
<a name="l01045"></a>01045     <span class="keywordflow">if</span> (this.iconsWhileDragging.length &gt; 0)
<a name="l01046"></a>01046       firstIcon = this.iconsWhileDragging[0];
<a name="l01047"></a>01047 
<a name="l01048"></a>01048     <span class="keywordflow">if</span> (!firstIcon)
<a name="l01049"></a>01049       <span class="keywordflow">return</span> <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l01050"></a>01050     <span class="keywordflow">return</span> GridManager.getIcon(firstIcon.dataset);
<a name="l01051"></a>01051   },
<a name="l01052"></a>01052 
<a name="l01053"></a>01053   <span class="comment">/*</span>
<a name="l01054"></a>01054 <span class="comment">   * Move the apps in position higher than &#39;pos&#39; one position ahead if they have</span>
<a name="l01055"></a>01055 <span class="comment">   * a desiredPosition lower than their actual position</span>
<a name="l01056"></a>01056 <span class="comment">   */</span>
<a name="l01057"></a>01057   _moveAhead: <span class="keyword">function</span> pg_moveAhead(pos) {
<a name="l01058"></a>01058     <span class="comment">// When a new sv app is installed, the previously sv apps installed in</span>
<a name="l01059"></a>01059     <span class="comment">// higher positions will have been moved.</span>
<a name="l01060"></a>01060     <span class="comment">// This function restores their previous position if needed</span>
<a name="l01061"></a>01061     var iconList = this.olist.children;
<a name="l01062"></a>01062     var numIcons = iconList.length;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = pos; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; numIcons; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++) {
<a name="l01065"></a>01065       var iconPos = iconList[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].dataset &amp;&amp; iconList[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].dataset.desiredPos;
<a name="l01066"></a>01066       <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &gt; iconPos) {
<a name="l01067"></a>01067         this.olist.insertBefore(iconList[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>], iconList[i - 1]);
<a name="l01068"></a>01068       }
<a name="l01069"></a>01069     }
<a name="l01070"></a>01070   },
<a name="l01071"></a>01071 
<a name="l01072"></a>01072   <span class="comment">/*</span>
<a name="l01073"></a>01073 <span class="comment">   * Return true if the Page has free space, return false otherwise</span>
<a name="l01074"></a>01074 <span class="comment">   */</span>
<a name="l01075"></a>01075   hasEmptySlot: <span class="keyword">function</span> pg_hasEmptySlot() {
<a name="l01076"></a>01076     <span class="keywordflow">return</span> this.getNumIcons() &lt; this.maxIcons;
<a name="l01077"></a>01077   },
<a name="l01078"></a>01078 
<a name="l01079"></a>01079   <span class="comment">/*</span>
<a name="l01080"></a>01080 <span class="comment">   * Insert an icon in the page</span>
<a name="l01081"></a>01081 <span class="comment">   */</span>
<a name="l01082"></a>01082   _insertIcon: <span class="keyword">function</span> pg_insertIcon(icon) {
<a name="l01083"></a>01083     var iconList = this.olist.children;
<a name="l01084"></a>01084     var <a class="code" href="../../da/dce/details__test_8js.html#a88e6efb757b9907baa46a5755484f2bd">container</a> = icon.container;
<a name="l01085"></a>01085 
<a name="l01086"></a>01086     <span class="comment">// Inserts the icon in the closest possible space to its desired position,</span>
<a name="l01087"></a>01087     <span class="comment">// keeping the order of all existing icons with desired position</span>
<a name="l01088"></a>01088     <span class="keywordflow">if</span> (icon.descriptor &amp;&amp; icon.descriptor.desiredPos !== undefined &amp;&amp;
<a name="l01089"></a>01089         <a class="code" href="../../d1/d18/apps_2homescreen_2js_2configurator_8js.html#a631458f015485482332b0c56bf7e989c">Configurator</a>.isSimPresentOnFirstBoot) {
<a name="l01090"></a>01090       var desiredPos = icon.descriptor.desiredPos;
<a name="l01091"></a>01091       var <a class="code" href="../../da/d88/mock__configurator_8js.html#a3c65d07fe933acaaf1205d12ce79b115">manifest</a> = icon.descriptor.manifestURL;
<a name="l01092"></a>01092       <span class="comment">// Add to the installed SV apps array</span>
<a name="l01093"></a>01093       GridManager.svPreviouslyInstalledApps.push({<span class="stringliteral">&#39;manifest&#39;</span>: manifest});
<a name="l01094"></a>01094       var numIcons = iconList.length;
<a name="l01095"></a>01095       <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = 0; (<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; numIcons) &amp;&amp; (<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt;= desiredPos); <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++) {
<a name="l01096"></a>01096         var iconPos = iconList[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].dataset &amp;&amp; iconList[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].dataset.desiredPos;
<a name="l01097"></a>01097         <span class="keywordflow">if</span> ((iconPos &gt; desiredPos) || (<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> === desiredPos)) {
<a name="l01098"></a>01098           this.olist.insertBefore(container, iconList[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>]);
<a name="l01099"></a>01099           this._moveAhead(i + 1);
<a name="l01100"></a>01100           <span class="keywordflow">return</span>;
<a name="l01101"></a>01101         }
<a name="l01102"></a>01102       }
<a name="l01103"></a>01103     }
<a name="l01104"></a>01104     this.olist.appendChild(container);
<a name="l01105"></a>01105   },
<a name="l01106"></a>01106 
<a name="l01107"></a>01107   <span class="comment">/*</span>
<a name="l01108"></a>01108 <span class="comment">   * Appends an icon to the end of the page</span>
<a name="l01109"></a>01109 <span class="comment">   *</span>
<a name="l01110"></a>01110 <span class="comment">   * @param{Object} moz app or icon object</span>
<a name="l01111"></a>01111 <span class="comment">   */</span>
<a name="l01112"></a>01112   appendIcon: <span class="keyword">function</span> pg_appendIcon(icon) {
<a name="l01113"></a>01113     <span class="keywordflow">if</span> (!icon.container) {
<a name="l01114"></a>01114       icon.render();
<a name="l01115"></a>01115     }
<a name="l01116"></a>01116     this._insertIcon(icon);
<a name="l01117"></a>01117   },
<a name="l01118"></a>01118 
<a name="l01127"></a>01127   appendIconVisible: <span class="keyword">function</span> pg_appendIconVisible(icon) {
<a name="l01128"></a>01128     <span class="keywordflow">if</span> (this.getNumIcons() &gt;= this.maxIcons) {
<a name="l01129"></a>01129       this.insertBeforeLastIcon(icon);
<a name="l01130"></a>01130     } <span class="keywordflow">else</span> {
<a name="l01131"></a>01131       this.appendIcon(icon);
<a name="l01132"></a>01132     }
<a name="l01133"></a>01133   },
<a name="l01134"></a>01134 
<a name="l01135"></a>01135   containsIcon: <span class="keyword">function</span> pg_containsIcon(icon) {
<a name="l01136"></a>01136     <span class="keywordflow">return</span> icon.container.parentNode === this.olist;
<a name="l01137"></a>01137   },
<a name="l01138"></a>01138 
<a name="l01139"></a>01139   <span class="comment">/*</span>
<a name="l01140"></a>01140 <span class="comment">   * Removes the page container from the DOM tree.</span>
<a name="l01141"></a>01141 <span class="comment">   *</span>
<a name="l01142"></a>01142 <span class="comment">   * @note This does *not* take care of any icons that are left on</span>
<a name="l01143"></a>01143 <span class="comment">   * this page. Their DOM elements will be lost unless these icons are</span>
<a name="l01144"></a>01144 <span class="comment">   * explicitly moved to different pages.</span>
<a name="l01145"></a>01145 <span class="comment">   */</span>
<a name="l01146"></a>01146   <a class="code" href="../../db/d0b/_image_editor_8js.html#ab508a76bce0563fb932c738c5d3ff9ed">destroy</a>: <span class="keyword">function</span> pg_destroy() {
<a name="l01147"></a>01147     this.container.parentNode.removeChild(this.container);
<a name="l01148"></a>01148   },
<a name="l01149"></a>01149 
<a name="l01150"></a>01150   <span class="comment">/*</span>
<a name="l01151"></a>01151 <span class="comment">   * Returns the number of icons</span>
<a name="l01152"></a>01152 <span class="comment">   */</span>
<a name="l01153"></a>01153   getNumIcons: <span class="keyword">function</span> pg_getNumIcons() {
<a name="l01154"></a>01154     <span class="keywordflow">return</span> this.olist.children.length;
<a name="l01155"></a>01155   },
<a name="l01156"></a>01156 
<a name="l01160"></a>01160   getIconDescriptors: <span class="keyword">function</span> pg_getIconDescriptors() {
<a name="l01161"></a>01161     var <a class="code" href="../../da/df2/namespacexml2dict.html#aaabd7336a42f36f8a79edd9e5fc821cf">nodes</a> = this.olist.children;
<a name="l01162"></a>01162     <span class="keywordflow">return</span> Array.prototype.map.call(nodes, <span class="keyword">function</span> marshall(node) {
<a name="l01163"></a>01163       var icon = GridManager.getIcon(node.dataset);
<a name="l01164"></a>01164       <span class="keywordflow">return</span> icon.getDescriptor();
<a name="l01165"></a>01165     });
<a name="l01166"></a>01166   },
<a name="l01167"></a>01167 
<a name="l01168"></a>01168   getIndex: <span class="keyword">function</span> pg_getIndex() {
<a name="l01169"></a>01169     var pages = this.container.parentNode.children;
<a name="l01170"></a>01170     pages = Array.prototype.slice.call(pages, 0, pages.length);
<a name="l01171"></a>01171     <span class="keywordflow">return</span> pages.indexOf(this.container);
<a name="l01172"></a>01172   },
<a name="l01173"></a>01173 
<a name="l01174"></a>01174   getIconIndex: <span class="keyword">function</span> pg_getIconIndex(icon) {
<a name="l01175"></a>01175     var icons = this.olist.children;
<a name="l01176"></a>01176     icons = Array.prototype.slice.call(icons, 0, icons.length);
<a name="l01177"></a>01177     <span class="keywordflow">return</span> icons.indexOf(icon);
<a name="l01178"></a>01178   }
<a name="l01179"></a>01179 };
<a name="l01180"></a>01180 
<a name="l01181"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#aa6bcd4dc418bb0efb5bc81b32871b840">01181</a> <span class="keyword">function</span> <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#aa6bcd4dc418bb0efb5bc81b32871b840">getDefaultIcon</a>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>) {
<a name="l01182"></a>01182   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a> &amp;&amp; <a class="code" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>.iconable) {
<a name="l01183"></a>01183     <span class="keywordflow">return</span> <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a19facd329fb2f940c5ad90e962828aca">Icon</a>.prototype.DEFAULT_BOOKMARK_ICON_URL;
<a name="l01184"></a>01184   } <span class="keywordflow">else</span> {
<a name="l01185"></a>01185     <span class="keywordflow">return</span> <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a19facd329fb2f940c5ad90e962828aca">Icon</a>.prototype.DEFAULT_ICON_URL;
<a name="l01186"></a>01186   }
<a name="l01187"></a>01187 }
<a name="l01188"></a>01188 
<a name="l01189"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a3024b526ab18ca6ac2efbfb3cf177dcd">01189</a> <span class="keyword">function</span> <a class="code" href="../../d1/d83/toolkit_8js.html#a97d2dfc7eacd4130836f6cf8b6766d1e">extend</a>(subClass, superClass) {
<a name="l01190"></a>01190   var <a class="code" href="../../d9/d19/import__vcard__test_8js.html#a1fd406685cbdee605d0a7bebed56fdb0">F</a> = <span class="keyword">function</span>() {};
<a name="l01191"></a>01191   F.prototype = superClass.prototype;
<a name="l01192"></a>01192   subClass.prototype = <span class="keyword">new</span> <a class="code" href="../../d9/d19/import__vcard__test_8js.html#a1fd406685cbdee605d0a7bebed56fdb0">F</a>();
<a name="l01193"></a>01193   subClass.prototype.constructor = subClass;
<a name="l01194"></a>01194   subClass.uber = superClass.prototype;
<a name="l01195"></a>01195 }
<a name="l01196"></a>01196 
<a name="l01197"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a33934370bc191cfa7673e0e0728a64e5">01197</a> <span class="keyword">function</span> <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a33934370bc191cfa7673e0e0728a64e5">Dock</a>(container, icons) {
<a name="l01198"></a>01198   <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ad56e4154f98ee95c4bf8c8942a2f6425">Page</a>.call(<span class="keyword">this</span>, container, icons);
<a name="l01199"></a>01199 }
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 <a class="code" href="../../d1/d83/toolkit_8js.html#a97d2dfc7eacd4130836f6cf8b6766d1e">extend</a>(<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a33934370bc191cfa7673e0e0728a64e5">Dock</a>, <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ad56e4154f98ee95c4bf8c8942a2f6425">Page</a>);
<a name="l01202"></a>01202 
<a name="l01203"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a2482721a6e9eaa2f3e1ed61bdf191180">01203</a> var <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a2482721a6e9eaa2f3e1ed61bdf191180">dockProto</a> = <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a33934370bc191cfa7673e0e0728a64e5">Dock</a>.prototype;
<a name="l01204"></a>01204 
<a name="l01205"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ac7b2337a19327ca2e844183347069271">01205</a> dockProto.baseRender = <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ad56e4154f98ee95c4bf8c8942a2f6425">Page</a>.prototype.render;
<a name="l01206"></a>01206 
<a name="l01207"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ae7817194480cfc900873938c8e7dd602">01207</a> dockProto.render = <span class="keyword">function</span> dk_render(apps, <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>) {
<a name="l01208"></a>01208   this.<a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#ac7b2337a19327ca2e844183347069271">baseRender</a>(apps, <a class="code" href="../../d9/d04/expat_8h.html#acfcb72e11f425a604663d645d2a4ea80">target</a>);
<a name="l01209"></a>01209   this.movableContainer = this.olist;
<a name="l01210"></a>01210 };
<a name="l01211"></a>01211 
<a name="l01212"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a60edfbbb86b389b69bc1a3a4a4900cb0">01212</a> dockProto.moveByWithEffect = <span class="keyword">function</span> dk_moveByWithEffect(scrollX, duration) {
<a name="l01213"></a>01213   var container = this.movableContainer;
<a name="l01214"></a>01214   var style = container.style;
<a name="l01215"></a>01215   style.MozTransform = <span class="stringliteral">&#39;translateX(&#39;</span> + scrollX + <span class="stringliteral">&#39;px)&#39;</span>;
<a name="l01216"></a>01216   style.MozTransition = <span class="stringliteral">&#39;-moz-transform &#39;</span> + duration + <span class="stringliteral">&#39;ms ease&#39;</span>;
<a name="l01217"></a>01217 };
<a name="l01218"></a>01218 
<a name="l01219"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a7d321b9d19470f399af4afab9a30b727">01219</a> dockProto.moveByWithDuration = <span class="keyword">function</span> dk_moveByWithDuration(scrollX,
<a name="l01220"></a>01220                                                               duration) {
<a name="l01221"></a>01221   var style = this.movableContainer.style;
<a name="l01222"></a>01222   style.MozTransform = <span class="stringliteral">&#39;translateX(&#39;</span> + scrollX + <span class="stringliteral">&#39;px)&#39;</span>;
<a name="l01223"></a>01223   style.MozTransition = <span class="stringliteral">&#39;-moz-transform &#39;</span> + duration + <span class="stringliteral">&#39;ms ease&#39;</span>;
<a name="l01224"></a>01224 };
<a name="l01225"></a>01225 
<a name="l01226"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a9ca727db19787905a22a480f7359ef77">01226</a> dockProto.getLeft = <span class="keyword">function</span> dk_getLeft() {
<a name="l01227"></a>01227   <span class="keywordflow">return</span> this.olist.getBoundingClientRect().left;
<a name="l01228"></a>01228 };
<a name="l01229"></a>01229 
<a name="l01230"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a150b6912d3f8f5e5e2b40da2fd609dee">01230</a> dockProto.getTransform = <span class="keyword">function</span> dk_getTransform() {
<a name="l01231"></a>01231   <span class="keywordflow">return</span> this.movableContainer.style.MozTransform;
<a name="l01232"></a>01232 };
<a name="l01233"></a>01233 
<a name="l01237"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a544aa1f902d754721438e8c91bb9263e">01237</a> dockProto.getRight = <span class="keyword">function</span> dk_getRight() {
<a name="l01238"></a>01238   var children = this.olist.children;
<a name="l01239"></a>01239   var lastChild = children[children.length - 1];
<a name="l01240"></a>01240   <span class="keywordflow">if</span> (!lastChild) {
<a name="l01241"></a>01241     <span class="keywordflow">return</span> 0;
<a name="l01242"></a>01242   }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244   <span class="keywordflow">return</span> lastChild.getBoundingClientRect().right;
<a name="l01245"></a>01245 };
<a name="l01246"></a>01246 
<a name="l01247"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a0c26f95c8c613c19cf6734254fc5f464">01247</a> dockProto.getWidth = <span class="keyword">function</span> dk_getWidth() {
<a name="l01248"></a>01248   <span class="keywordflow">return</span> this.olist.clientWidth;
<a name="l01249"></a>01249 };
<a name="l01250"></a>01250 
<a name="l01251"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a78f6c8393e8bb7c6e5c3bf383982408f">01251</a> dockProto.placeIcon = <span class="keyword">function</span> pg_placeIcon(node, from, <a class="code" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a>, transition) {
<a name="l01252"></a>01252   <span class="keywordflow">if</span> (!node)
<a name="l01253"></a>01253     <span class="keywordflow">return</span>;
<a name="l01254"></a>01254 
<a name="l01255"></a>01255   var x = node.dataset.posX = parseInt(node.dataset.posX || 0) + (<a class="code" href="../../da/d32/prio_8h.html#a5d467a63df9ff99d33d6749038f6f421">to</a> - from) *
<a name="l01256"></a>01256                               100;
<a name="l01257"></a>01257 
<a name="l01258"></a>01258   node.style.MozTransform = <span class="stringliteral">&#39;translateX(&#39;</span> + x + <span class="stringliteral">&#39;%)&#39;</span>;
<a name="l01259"></a>01259   <span class="keywordflow">if</span> (transition)
<a name="l01260"></a>01260     node.style.MozTransition = transition;
<a name="l01261"></a>01261 };
<a name="l01262"></a>01262 
<a name="l01263"></a><a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a70ea7e9f645f301b4ebd1e8258acbb72">01263</a> var <a class="code" href="../../de/df6/homescreen_2js_2page_8js.html#a70ea7e9f645f301b4ebd1e8258acbb72">TextOverflowDetective</a> = (<span class="keyword">function</span>() {
<a name="l01264"></a>01264 
<a name="l01265"></a>01265   var iconFakeWrapperWidth;
<a name="l01266"></a>01266   var iconFakeLabel;
<a name="l01267"></a>01267 
<a name="l01268"></a>01268   <span class="keyword">function</span> <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>() {
<a name="l01269"></a>01269     var fakeIconName = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.querySelector(<span class="stringliteral">&#39;#fake-icon-name-wrapper&#39;</span>);
<a name="l01270"></a>01270     iconFakeWrapperWidth = fakeIconName.offsetWidth;
<a name="l01271"></a>01271     iconFakeLabel = <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.querySelector(<span class="stringliteral">&#39;#fake-icon-name&#39;</span>);
<a name="l01272"></a>01272   }
<a name="l01273"></a>01273 
<a name="l01274"></a>01274   <span class="keyword">function</span> <a class="code" href="../../d1/d5b/namespacejcconv.html#a846efc552618562a262a88978ef66841">check</a>(<a class="code" href="../../dd/dfa/classtext.html">text</a>) {
<a name="l01275"></a>01275     <span class="keywordflow">if</span> (!iconFakeLabel || !iconFakeWrapperWidth) {
<a name="l01276"></a>01276       <a class="code" href="../../db/dc0/mock__fb_8js.html#ae9b28e7b58edd8f38cd717eed7b3deb4">init</a>();
<a name="l01277"></a>01277     }
<a name="l01278"></a>01278     iconFakeLabel.textContent = <a class="code" href="../../db/de5/namespacedefault__timezones.html#ae7928ec4a8ba39a389a278ef371587b8">text</a>;
<a name="l01279"></a>01279     <span class="keywordflow">return</span> iconFakeLabel.offsetWidth &gt;= iconFakeWrapperWidth;
<a name="l01280"></a>01280   }
<a name="l01281"></a>01281 
<a name="l01282"></a>01282   <span class="keywordflow">return</span> {
<a name="l01283"></a>01283     <a class="code" href="../../d1/d5b/namespacejcconv.html#a846efc552618562a262a88978ef66841">check</a>: <a class="code" href="../../d1/d5b/namespacejcconv.html#a846efc552618562a262a88978ef66841">check</a>
<a name="l01284"></a>01284   };
<a name="l01285"></a>01285 })();
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../de/df6/homescreen_2js_2page_8js.html">page.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:54:31に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
