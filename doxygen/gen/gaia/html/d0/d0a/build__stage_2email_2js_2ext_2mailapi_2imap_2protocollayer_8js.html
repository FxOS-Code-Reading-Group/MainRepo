<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: protocollayer.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d0/d0a/build__stage_2email_2js_2ext_2mailapi_2imap_2protocollayer_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a>  </div>
  <div class="headertitle">
<div class="title">protocollayer.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../d0/d0a/build__stage_2email_2js_2ext_2mailapi_2imap_2protocollayer_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d0a/build__stage_2email_2js_2ext_2mailapi_2imap_2protocollayer_8js.html#aa254b3565b6f9488ddfb959de5ae6ad9">define</a> ('mailapi/imap/protocol/<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>',[ 'mailparser/mailparser', '../imapchew', '<a class="el" href="../../d4/dfa/tty_8js.html#aa4072ba4b6b56b0fb6f4801f17ab2b34">exports</a>'], <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>($mailparser, $imapchew, <a class="el" href="../../d4/dfa/tty_8js.html#aa4072ba4b6b56b0fb6f4801f17ab2b34">exports</a>){var INITIAL_FETCH_PARAMS={request:{headers:['FROM', 'TO', '<a class="el" href="../../d7/d99/about_gaia_8js.html#a0e3ff00a2f78b550948f44f69d8d0995">CC</a>', 'BCC', 'SUBJECT', 'REPLY-TO', 'MESSAGE-<a class="el" href="../../d1/d80/_telemetry_histogram_enums_8h.html#a094c367727273b4da2b960ca3b3edc06">ID</a>', 'REFERENCES'], struct:true, body:false}};var FLAG_FETCH_PARAMS={request:{struct:false, headers:false, body:false}};var SNIPPET_BYTES=256;var KNOWN_HEADERS_AGGR_COST=20, KNOWN_HEADERS_PER_COST=1, NEW_HEADERS_AGGR_COST=20, NEW_HEADERS_PER_COST=5, NEW_BODIES_PER_COST=30;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../db/d94/fb__sync__init_8js.html#a1fd6364597d4fb96e95ad0dae3c46dc5">Sync</a>(<a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>){this.storage=options.storage;this.connection=options.connection;this.knownHeaders=options.knownHeaders||[];this.knownUIDs=options.knownUIDs||[];this.newUIDs=options.newUIDs||[];this._progress=options.initialProgress||0.25;this._progressCost=(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">this.knownUIDs.length</a>?KNOWN_HEADERS_AGGR_COST:0)+KNOWN_HEADERS_PER_COST *<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">this.knownUIDs.length</a>+(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">this.newUIDs.length</a>?NEW_HEADERS_AGGR_COST:0)+NEW_HEADERS_PER_COST *<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">this.newUIDs.length</a>;<a class="el" href="../../d1/d04/app__install__manager_8js.html#a287ef4df227a3ceb44fea5838f75a88e">this.onprogress</a>=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;this.oncomplete=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;this._beginSync();}<a class="el" href="../../d6/dec/mocha-bin_8js.html#a240a06b4dda3a9e2e025ed5792cd5f4e">Sync.prototype</a>={_updateProgress:function(newProgress){this._progress+=newProgress;<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../d1/d04/app__install__manager_8js.html#a287ef4df227a3ceb44fea5838f75a88e">this.onprogress</a>){<a class="el" href="../../d1/d04/app__install__manager_8js.html#a287ef4df227a3ceb44fea5838f75a88e">this.onprogress</a>(0.25+0.75 *(this._progress/this._progressCost));}}, _beginSync:function(){var pending=1;var <a class="el" href="../../df/d44/permission__manager_8js.html#a67b9624a73d0c7dbd44bc7b41817b579">self</a>=<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> next(){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!--pending){self.storage.runAfterDeferredCalls(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!self.oncomplete) <a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>;self.oncomplete(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">self.newUIDs.length</a>, <a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">self.knownUIDs.length</a>);});}}<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">this.newUIDs.length</a>){pending++;this._handleNewUids(next);}<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">this.knownUIDs.length</a>){pending++;this._handleKnownUids(next);}window.setZeroTimeout(next);}, _handleNewUids:function(<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>){var newFetcher=this.connection.fetch(this.newUIDs, INITIAL_FETCH_PARAMS);var pendingSnippets=[];var <a class="el" href="../../df/d44/permission__manager_8js.html#a67b9624a73d0c7dbd44bc7b41817b579">self</a>=<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>;<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">newFetcher.on</a>('<a class="el" href="../../d2/d7d/jsapi_8h.html#a254bf0858da09c96a48daf64404eb4f8">message</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> onNewMessage(<a class="el" href="../../d5/dde/plerror_8h.html#a2c3cb87d009c003069b9a90f020f8a9f">msg</a>){<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">msg.on</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> onNewMsgEnd(){<a class="el" href="../../d9/d43/membuster_8js.html#aad81d14d4c8eea114056d7dc1f18f9b7">console.log</a>('new fetched, header processing, INTERNALDATE: ', msg.rawDate);try{var chewRep=$imapchew.chewHeaderAndBodyStructure(<a class="el" href="../../d5/dde/plerror_8h.html#a2c3cb87d009c003069b9a90f020f8a9f">msg</a>, self.storage.folderId, self.storage._issueNewHeaderId());<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">pendingSnippets.push</a>(chewRep);self.storage.addMessageHeader(chewRep.header);self.storage.addMessageBody(chewRep.header, chewRep.bodyInfo);}<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#af39c2275c702dbe367eb69898156da2a">catch</a>(ex){console.warn('<a class="el" href="../../d2/d7d/jsapi_8h.html#a254bf0858da09c96a48daf64404eb4f8">message</a> problem, skipping <a class="el" href="../../d2/d7d/jsapi_8h.html#a254bf0858da09c96a48daf64404eb4f8">message</a>', ex, '\<a class="el" href="../../d2/d7d/jsapi_8h.html#aa5a8b9a2d5edc8e2e7ba67d7e2ee4e69">n</a>', <a class="el" href="../../d6/d1b/pprthred_8h.html#afe76c3c951fe40bd646fbf0b89cbcd17">ex.stack</a>);}});});<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">newFetcher.on</a>('<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> onNewFetchError(err){console.warn('New UIDs fetch <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>, ideally harmless:', err);});<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">newFetcher.on</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>', <a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>);}, _handleKnownUids:function(<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>){var <a class="el" href="../../df/d44/permission__manager_8js.html#a67b9624a73d0c7dbd44bc7b41817b579">self</a>=<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>;var knownFetcher=this.connection.fetch(self.knownUIDs, FLAG_FETCH_PARAMS);var numFetched=0;<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">knownFetcher.on</a>('<a class="el" href="../../d2/d7d/jsapi_8h.html#a254bf0858da09c96a48daf64404eb4f8">message</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> onKnownMessage(<a class="el" href="../../d5/dde/plerror_8h.html#a2c3cb87d009c003069b9a90f020f8a9f">msg</a>){<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">msg.on</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> onKnownMsgEnd(){var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=numFetched++;<a class="el" href="../../d9/d43/membuster_8js.html#aad81d14d4c8eea114056d7dc1f18f9b7">console.log</a>('FETCHED', <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>, 'known <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>', self.knownHeaders[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, 'known srvid', self.knownHeaders[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].srvid, 'actual <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>', <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">msg.id</a>);<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(self.knownHeaders[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].srvid!==<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">msg.id</a>){<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a78826d1185ecdcfc63deffaedf15c7bd">self.knownUIDs.indexOf</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">msg.id</a>);<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>===-1){console.warn(&quot;Server fetch reports unexpected message:&quot;, msg.id);<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>;}}var header=self.knownHeaders[<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>];<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../dd/d78/shared_2js_2template_8js.html#a47ec4a4c23bf94a45f76da63b59df7af">header.flags.toString</a>()!==<a class="el" href="../../dd/d78/shared_2js_2template_8js.html#a47ec4a4c23bf94a45f76da63b59df7af">msg.flags.toString</a>()){console.warn('FLAGS:&quot;' + header.flags.toString() + '&quot;VS&quot;' +

         msg.flags.toString() + '&quot;');header.flags=<a class="el" href="../../de/d81/xpt__struct_8h.html#aa2585d779da0ab21273a8d92de9a0ebe">msg.flags</a>;self.storage.updateMessageHeader(<a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">header.date</a>, <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">header.id</a>, <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>, header);}else{self.storage.unchangedMessageHeader(header);}});});<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">knownFetcher.on</a>('<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> onKnownFetchError(err){console.warn('Known UIDs fetch <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>, ideally harmless:', err);});<a class="el" href="../../d0/d6e/build__stage_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#ac00bf23adf7cb4c5253268889722ca05">knownFetcher.on</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#abe43fe84431eb0cabf3c21ccc94bd756">end</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){self._updateProgress(KNOWN_HEADERS_AGGR_COST+KNOWN_HEADERS_PER_COST *<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">self.knownUIDs.length</a>);<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>();});}};<a class="el" href="../../db/d94/fb__sync__init_8js.html#a1fd6364597d4fb96e95ad0dae3c46dc5">exports.Sync</a>=<a class="el" href="../../db/d94/fb__sync__init_8js.html#a1fd6364597d4fb96e95ad0dae3c46dc5">Sync</a>;})</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="aa254b3565b6f9488ddfb959de5ae6ad9"></a><!-- doxytag: member="build_stage/email/js/ext/mailapi/imap/protocollayer.js::define" ref="aa254b3565b6f9488ddfb959de5ae6ad9" args="('mailapi/imap/protocol/sync',[ 'mailparser/mailparser', '../imapchew', 'exports'], function($mailparser, $imapchew, exports){var INITIAL_FETCH_PARAMS={request:{headers:['FROM', 'TO', 'CC', 'BCC', 'SUBJECT', 'REPLY&#45;TO', 'MESSAGE&#45;ID', 'REFERENCES'], struct:true, body:false}};var FLAG_FETCH_PARAMS={request:{struct:false, headers:false, body:false}};var SNIPPET_BYTES=256;var KNOWN_HEADERS_AGGR_COST=20, KNOWN_HEADERS_PER_COST=1, NEW_HEADERS_AGGR_COST=20, NEW_HEADERS_PER_COST=5, NEW_BODIES_PER_COST=30;function Sync(options){this.storage=options.storage;this.connection=options.connection;this.knownHeaders=options.knownHeaders||[];this.knownUIDs=options.knownUIDs||[];this.newUIDs=options.newUIDs||[];this._progress=options.initialProgress||0.25;this._progressCost=(this.knownUIDs.length?KNOWN_HEADERS_AGGR_COST:0)+KNOWN_HEADERS_PER_COST *this.knownUIDs.length+(this.newUIDs.length?NEW_HEADERS_AGGR_COST:0)+NEW_HEADERS_PER_COST *this.newUIDs.length;this.onprogress=null;this.oncomplete=null;this._beginSync();}Sync.prototype={_updateProgress:function(newProgress){this._progress+=newProgress;if(this.onprogress){this.onprogress(0.25+0.75 *(this._progress/this._progressCost));}}, _beginSync:function(){var pending=1;var self=this;function next(){if(!&#45;&#45;pending){self.storage.runAfterDeferredCalls(function(){if(!self.oncomplete) return;self.oncomplete(self.newUIDs.length, self.knownUIDs.length);});}}if(this.newUIDs.length){pending++;this._handleNewUids(next);}if(this.knownUIDs.length){pending++;this._handleKnownUids(next);}window.setZeroTimeout(next);}, _handleNewUids:function(callback){var newFetcher=this.connection.fetch(this.newUIDs, INITIAL_FETCH_PARAMS);var pendingSnippets=[];var self=this;newFetcher.on('message', function onNewMessage(msg){msg.on('end', function onNewMsgEnd(){console.log('new fetched, header processing, INTERNALDATE: ', msg.rawDate);try{var chewRep=$imapchew.chewHeaderAndBodyStructure(msg, self.storage.folderId, self.storage._issueNewHeaderId());pendingSnippets.push(chewRep);self.storage.addMessageHeader(chewRep.header);self.storage.addMessageBody(chewRep.header, chewRep.bodyInfo);}catch(ex){console.warn('message problem, skipping message', ex, '\n', ex.stack);}});});newFetcher.on('error', function onNewFetchError(err){console.warn('New UIDs fetch error, ideally harmless:', err);});newFetcher.on('end', callback);}, _handleKnownUids:function(callback){var self=this;var knownFetcher=this.connection.fetch(self.knownUIDs, FLAG_FETCH_PARAMS);var numFetched=0;knownFetcher.on('message', function onKnownMessage(msg){msg.on('end', function onKnownMsgEnd(){var i=numFetched++;console.log('FETCHED', i, 'known id', self.knownHeaders[i].id, 'known srvid', self.knownHeaders[i].srvid, 'actual id', msg.id);if(self.knownHeaders[i].srvid!==msg.id){i=self.knownUIDs.indexOf(msg.id);if(i===&#45;1){console.warn(&quot;Server fetch reports unexpected message:&quot;, msg.id);return;}}var header=self.knownHeaders[i];if(header.flags.toString()!==msg.flags.toString()){console.warn('FLAGS:&quot;' + header.flags.toString() + '&quot;VS&quot;' +

         msg.flags.toString() + '&quot;');header.flags=msg.flags;self.storage.updateMessageHeader(header.date, header.id, true, header);}else{self.storage.unchangedMessageHeader(header);}});});knownFetcher.on('error', function onKnownFetchError(err){console.warn('Known UIDs fetch error, ideally harmless:', err);});knownFetcher.on('end', function(){self._updateProgress(KNOWN_HEADERS_AGGR_COST+KNOWN_HEADERS_PER_COST *self.knownUIDs.length);callback();});}};exports.Sync=Sync;})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d14/build__stage_2email_2js_2mix_8js.html#ae57540f837ee76af1c71776a8f46ae53">define</a> </td>
          <td>(</td>
          <td class="paramtype">'mailapi/imap/protocol/<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d0/d0a/build__stage_2email_2js_2ext_2mailapi_2imap_2protocollayer_8js.html">protocollayer.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:57:46に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
