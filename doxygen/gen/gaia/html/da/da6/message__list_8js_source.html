<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: message_list.js ソースファイル</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('da/da6/message__list_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">message_list.js</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../da/da6/message__list_8js.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*jshint browser: true */</span>
<a name="l00002"></a>00002 <span class="comment">/*global define, console */</span>
<a name="l00003"></a>00003 <a class="code" href="../../d9/d2e/alameda_8js.html#a8a3a5595e65e7e2a2cf64c08ba74833f">define</a>(<span class="keyword">function</span>(<a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>) {
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 var templateNode = <a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>(<span class="stringliteral">&#39;tmpl!./message_list.html&#39;</span>),
<a name="l00006"></a>00006     msgHeaderItemNode = <a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>(<span class="stringliteral">&#39;tmpl!./msg/header_item.html&#39;</span>),
<a name="l00007"></a>00007     deleteConfirmMsgNode = <a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>(<span class="stringliteral">&#39;tmpl!./msg/delete_confirm.html&#39;</span>),
<a name="l00008"></a>00008     common = <a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>(<span class="stringliteral">&#39;mail_common&#39;</span>),
<a name="l00009"></a>00009     <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a> = <a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>(<span class="stringliteral">&#39;model&#39;</span>),
<a name="l00010"></a>00010     htmlCache = <a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>(<span class="stringliteral">&#39;html_cache&#39;</span>),
<a name="l00011"></a>00011     MessageListTopbar = <a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>(<span class="stringliteral">&#39;message_list_topbar&#39;</span>),
<a name="l00012"></a>00012     <a class="code" href="../../da/dce/details__test_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">mozL10n</a> = <a class="code" href="../../d9/d2e/alameda_8js.html#a4b4eb847520ff4e45de16db801e26133">require</a>(<span class="stringliteral">&#39;l10n!&#39;</span>),
<a name="l00013"></a>00013     Cards = common.Cards,
<a name="l00014"></a>00014     Toaster = common.Toaster,
<a name="l00015"></a>00015     <a class="code" href="../../d3/d42/camera_2js_2confirm_8js.html#a62ff52c410e9de0d9973e5297755e83c">ConfirmDialog</a> = common.ConfirmDialog,
<a name="l00016"></a>00016     batchAddClass = common.batchAddClass,
<a name="l00017"></a>00017     bindContainerClickAndHold = common.bindContainerClickAndHold,
<a name="l00018"></a>00018     bindContainerHandler = common.bindContainerHandler,
<a name="l00019"></a>00019     appendMatchItemTo = common.appendMatchItemTo,
<a name="l00020"></a>00020     displaySubject = common.displaySubject,
<a name="l00021"></a>00021     prettyDate = common.prettyDate;
<a name="l00022"></a>00022 
<a name="l00027"></a>00027 var SCROLL_MIN_BUFFER_SCREENS = 2;
<a name="l00031"></a>00031 var SCROLL_MAX_RETENTION_SCREENS = 7;
<a name="l00032"></a>00032 
<a name="l00037"></a>00037 var SCROLL_DELAY = 50;
<a name="l00038"></a>00038 
<a name="l00043"></a>00043 var MINIMUM_ITEMS_FOR_SCROLL_CALC = 10;
<a name="l00044"></a>00044 
<a name="l00048"></a>00048 var MAXIMUM_MS_BETWEEN_SNIPPET_REQUEST = 6000;
<a name="l00049"></a>00049 
<a name="l00053"></a>00053 var MAXIMUM_BYTES_PER_MESSAGE_DURING_SCROLL = 4 * 1024;
<a name="l00054"></a>00054 
<a name="l00103"></a>00103 <span class="keyword">function</span> MessageListCard(domNode, <a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a>, <a class="code" href="../../db/d7b/r_8js.html#a283fa4dd58795cf5b621404be6601e86">args</a>) {
<a name="l00104"></a>00104   this.domNode = domNode;
<a name="l00105"></a>00105   this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a> = <a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a>;
<a name="l00106"></a>00106   this.scrollNode = domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-list-scrollouter&#39;</span>)[0];
<a name="l00107"></a>00107 
<a name="l00108"></a>00108   <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a> === <span class="stringliteral">&#39;nonsearch&#39;</span>)
<a name="l00109"></a>00109     batchAddClass(domNode, <span class="stringliteral">&#39;msg-search-only&#39;</span>, <span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00110"></a>00110   <span class="keywordflow">else</span>
<a name="l00111"></a>00111     batchAddClass(domNode, <span class="stringliteral">&#39;msg-nonsearch-only&#39;</span>, <span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   this.messagesContainer =
<a name="l00114"></a>00114     domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-messages-container&#39;</span>)[0];
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   this.messageEmptyContainer =
<a name="l00117"></a>00117     domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-list-empty-container&#39;</span>)[0];
<a name="l00118"></a>00118   <span class="comment">// - message actions</span>
<a name="l00119"></a>00119   bindContainerClickAndHold(
<a name="l00120"></a>00120     this.messagesContainer,
<a name="l00121"></a>00121     <span class="comment">// clicking shows the message reader for a message</span>
<a name="l00122"></a>00122     this.onClickMessage.bind(<span class="keyword">this</span>),
<a name="l00123"></a>00123     <span class="comment">// press-and-hold shows the single-message mutation options</span>
<a name="l00124"></a>00124     this.onHoldMessage.bind(<span class="keyword">this</span>));
<a name="l00125"></a>00125 
<a name="l00126"></a>00126   <span class="comment">// - less-than-infinite scrolling</span>
<a name="l00127"></a>00127   this.scrollContainer =
<a name="l00128"></a>00128     domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-list-scrollouter&#39;</span>)[0];
<a name="l00129"></a>00129   this.scrollContainer.addEventListener(<span class="stringliteral">&#39;scroll&#39;</span>, this.onScroll.bind(<span class="keyword">this</span>),
<a name="l00130"></a>00130                                         <span class="keyword">false</span>);
<a name="l00131"></a>00131   this.syncingNode =
<a name="l00132"></a>00132     domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-messages-syncing&#39;</span>)[0];
<a name="l00133"></a>00133   this.syncMoreNode =
<a name="l00134"></a>00134     domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-messages-sync-more&#39;</span>)[0];
<a name="l00135"></a>00135   this.syncMoreNode
<a name="l00136"></a>00136     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onGetMoreMessages.bind(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138   <span class="comment">// - header buttons: non-edit mode</span>
<a name="l00139"></a>00139   domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-folder-list-btn&#39;</span>)[0]
<a name="l00140"></a>00140     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onShowFolders.bind(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00141"></a>00141   domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-compose-btn&#39;</span>)[0]
<a name="l00142"></a>00142     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onCompose.bind(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144   <span class="comment">// - toolbar: non-edit mode</span>
<a name="l00145"></a>00145   this.toolbar = {};
<a name="l00146"></a>00146   this.toolbar.searchBtn = domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-search-btn&#39;</span>)[0];
<a name="l00147"></a>00147   this.toolbar.searchBtn
<a name="l00148"></a>00148     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onSearchButton.bind(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00149"></a>00149   this.toolbar.editBtn = domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-edit-btn&#39;</span>)[0];
<a name="l00150"></a>00150   this.toolbar.editBtn
<a name="l00151"></a>00151     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.setEditMode.bind(<span class="keyword">this</span>, <span class="keyword">true</span>), <span class="keyword">false</span>);
<a name="l00152"></a>00152   this.toolbar.refreshBtn =
<a name="l00153"></a>00153     domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-refresh-btn&#39;</span>)[0];
<a name="l00154"></a>00154   this.toolbar.refreshBtn
<a name="l00155"></a>00155     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onRefresh.bind(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <span class="comment">// - header buttons: edit mode</span>
<a name="l00158"></a>00158   domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-listedit-cancel-btn&#39;</span>)[0]
<a name="l00159"></a>00159     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.setEditMode.bind(<span class="keyword">this</span>, <span class="keyword">false</span>), <span class="keyword">false</span>);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="comment">// - toolbar: edit mode</span>
<a name="l00162"></a>00162   domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-star-btn&#39;</span>)[0]
<a name="l00163"></a>00163     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onStarMessages.bind(<span class="keyword">this</span>, <span class="keyword">true</span>), <span class="keyword">false</span>);
<a name="l00164"></a>00164   domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-mark-read-btn&#39;</span>)[0]
<a name="l00165"></a>00165     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onMarkMessagesRead.bind(<span class="keyword">this</span>, <span class="keyword">true</span>), <span class="keyword">false</span>);
<a name="l00166"></a>00166   domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-delete-btn&#39;</span>)[0]
<a name="l00167"></a>00167     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onDeleteMessages.bind(<span class="keyword">this</span>, <span class="keyword">true</span>), <span class="keyword">false</span>);
<a name="l00168"></a>00168   this.toolbar.moveBtn = domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-move-btn&#39;</span>)[0];
<a name="l00169"></a>00169   this.toolbar.moveBtn
<a name="l00170"></a>00170     .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onMoveMessages.bind(<span class="keyword">this</span>, <span class="keyword">true</span>), <span class="keyword">false</span>);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="comment">// -- non-search mode</span>
<a name="l00173"></a>00173   <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a> === <span class="stringliteral">&#39;nonsearch&#39;</span>) {
<a name="l00174"></a>00174     <span class="comment">// - search teaser bar</span>
<a name="l00175"></a>00175     <span class="comment">// Focusing the teaser bar&#39;s text field is the same as hitting the search</span>
<a name="l00176"></a>00176     <span class="comment">// button.</span>
<a name="l00177"></a>00177     domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-search-text-tease&#39;</span>)[0]
<a name="l00178"></a>00178       .addEventListener(<span class="stringliteral">&#39;focus&#39;</span>, this.onSearchButton.bind(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180   <span class="comment">// -- search mode</span>
<a name="l00181"></a>00181   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a> === <span class="stringliteral">&#39;search&#39;</span>) {
<a name="l00182"></a>00182     domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-search-cancel&#39;</span>)[0]
<a name="l00183"></a>00183       .addEventListener(<span class="stringliteral">&#39;click&#39;</span>, this.onCancelSearch.bind(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     bindContainerHandler(
<a name="l00186"></a>00186       domNode.getElementsByClassName(<span class="stringliteral">&#39;filter&#39;</span>)[0],
<a name="l00187"></a>00187       <span class="stringliteral">&#39;click&#39;</span>, this.onSearchFilterClick.bind(<span class="keyword">this</span>));
<a name="l00188"></a>00188     this.searchInput = domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-search-text&#39;</span>)[0];
<a name="l00189"></a>00189     this.searchInput.addEventListener(
<a name="l00190"></a>00190       <span class="stringliteral">&#39;input&#39;</span>, this.onSearchTextChange.bind(<span class="keyword">this</span>), <span class="keyword">false</span>);
<a name="l00191"></a>00191   }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="comment">// convenience wrapper for context.</span>
<a name="l00194"></a>00194   this._onScroll = this._onScroll.bind(<span class="keyword">this</span>);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196   this.editMode = <span class="keyword">false</span>;
<a name="l00197"></a>00197   this.selectedMessages = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   this.curFolder = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00200"></a>00200   this.messagesSlice = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00201"></a>00201   this.isIncomingFolder = <span class="keyword">true</span>;
<a name="l00202"></a>00202   this._boundSliceRequestComplete = this.onSliceRequestComplete.bind(<span class="keyword">this</span>);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   this.usingCachedNode = !!<a class="code" href="../../db/d7b/r_8js.html#a283fa4dd58795cf5b621404be6601e86">args</a>.cachedNode;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   this._boundFolderChanged = this._folderChanged.bind(<span class="keyword">this</span>);
<a name="l00207"></a>00207   <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.latest(<span class="stringliteral">&#39;folder&#39;</span>, this._boundFolderChanged);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   this._boundOnNewMail = this.onNewMail.bind(<span class="keyword">this</span>);
<a name="l00210"></a>00210   <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.on(<span class="stringliteral">&#39;newInboxMessages&#39;</span>, this._boundOnNewMail);
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 MessageListCard.prototype = {
<a name="l00221"></a>00221   PROGRESS_CANDYBAR_TIMEOUT_MS: 2000,
<a name="l00222"></a>00222 
<a name="l00227"></a>00227   _topbar: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>,
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   postInsert: <span class="keyword">function</span>() {
<a name="l00230"></a>00230     this._hideSearchBoxByScrolling();
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a> === <span class="stringliteral">&#39;search&#39;</span>)
<a name="l00233"></a>00233       this.searchInput.focus();
<a name="l00234"></a>00234   },
<a name="l00235"></a>00235 
<a name="l00236"></a>00236   onSearchButton: <span class="keyword">function</span>() {
<a name="l00237"></a>00237     <span class="comment">// Do not bother if there is no current folder.</span>
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (!this.curFolder)
<a name="l00239"></a>00239       <span class="keywordflow">return</span>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     Cards.pushCard(
<a name="l00242"></a>00242       <span class="stringliteral">&#39;message_list&#39;</span>, <span class="stringliteral">&#39;search&#39;</span>, <span class="stringliteral">&#39;animate&#39;</span>,
<a name="l00243"></a>00243       {
<a name="l00244"></a>00244         folder: this.curFolder
<a name="l00245"></a>00245       });
<a name="l00246"></a>00246   },
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   setEditMode: <span class="keyword">function</span>(editMode) {
<a name="l00249"></a>00249     <span class="comment">// Do not bother if this is triggered before</span>
<a name="l00250"></a>00250     <span class="comment">// a folder has loaded.</span>
<a name="l00251"></a>00251     <span class="keywordflow">if</span> (!this.curFolder)
<a name="l00252"></a>00252       <span class="keywordflow">return</span>;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     var domNode = this.domNode;
<a name="l00255"></a>00255     <span class="comment">// XXX the manual DOM play here is now a bit overkill; we should very</span>
<a name="l00256"></a>00256     <span class="comment">// probably switch top having the CSS do this for us or at least invest</span>
<a name="l00257"></a>00257     <span class="comment">// some time in cleanup.</span>
<a name="l00258"></a>00258     var normalHeader = domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-list-header&#39;</span>)[0],
<a name="l00259"></a>00259         searchHeader = domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-search-header&#39;</span>)[0],
<a name="l00260"></a>00260         editHeader = domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-listedit-header&#39;</span>)[0],
<a name="l00261"></a>00261         normalToolbar =
<a name="l00262"></a>00262           domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-list-action-toolbar&#39;</span>)[0],
<a name="l00263"></a>00263         editToolbar =
<a name="l00264"></a>00264           domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-listedit-action-toolbar&#39;</span>)[0];
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     this.editMode = editMode;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (editMode) {
<a name="l00269"></a>00269       normalHeader.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00270"></a>00270       searchHeader.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00271"></a>00271       normalToolbar.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00272"></a>00272       editHeader.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00273"></a>00273       editToolbar.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00274"></a>00274       this.messagesContainer.classList.add(<span class="stringliteral">&#39;show-edit&#39;</span>);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276       this.selectedMessages = [];
<a name="l00277"></a>00277       var cbs = this.messagesContainer.querySelectorAll(<span class="stringliteral">&#39;input[type=checkbox]&#39;</span>);
<a name="l00278"></a>00278       <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = 0; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; cbs.length; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++) {
<a name="l00279"></a>00279         cbs[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].checked = <span class="keyword">false</span>;
<a name="l00280"></a>00280       }
<a name="l00281"></a>00281       this.selectedMessagesUpdated();
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283     <span class="keywordflow">else</span> {
<a name="l00284"></a>00284       <span class="keywordflow">if</span> (this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a> === <span class="stringliteral">&#39;nonsearch&#39;</span>)
<a name="l00285"></a>00285         normalHeader.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00286"></a>00286       <span class="keywordflow">else</span>
<a name="l00287"></a>00287         searchHeader.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00288"></a>00288       normalToolbar.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00289"></a>00289       editHeader.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00290"></a>00290       editToolbar.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00291"></a>00291       this.messagesContainer.classList.remove(<span class="stringliteral">&#39;show-edit&#39;</span>);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293       <span class="comment">// (Do this based on the DOM nodes actually present; if the user has been</span>
<a name="l00294"></a>00294       <span class="comment">// scrolling a lot, this.selectedMessages may contain messages that no</span>
<a name="l00295"></a>00295       <span class="comment">// longer have a domNode around.)</span>
<a name="l00296"></a>00296       var selectedMsgNodes =
<a name="l00297"></a>00297         domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-item-selected&#39;</span>);
<a name="l00298"></a>00298       <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = selectedMsgNodes.length - 1; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &gt;= 0; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>--) {
<a name="l00299"></a>00299         selectedMsgNodes[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].classList.remove(<span class="stringliteral">&#39;msg-header-item-selected&#39;</span>);
<a name="l00300"></a>00300       }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302       this.selectedMessages = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="comment">// UXXX do we want to disable the buttons if nothing is selected?</span>
<a name="l00306"></a>00306   },
<a name="l00307"></a>00307 
<a name="l00313"></a>00313   selectedMessagesUpdated: <span class="keyword">function</span>() {
<a name="l00314"></a>00314     var headerNode =
<a name="l00315"></a>00315       this.domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-listedit-header-label&#39;</span>)[0];
<a name="l00316"></a>00316     headerNode.textContent =
<a name="l00317"></a>00317       <a class="code" href="../../da/dce/details__test_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">mozL10n</a>.get(<span class="stringliteral">&#39;message-multiedit-header&#39;</span>,
<a name="l00318"></a>00318                   { <a class="code" href="../../d2/d7d/jsapi_8h.html#aa5a8b9a2d5edc8e2e7ba67d7e2ee4e69">n</a>: this.selectedMessages.length });
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     var starBtn = this.domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-star-btn&#39;</span>)[0],
<a name="l00321"></a>00321         readBtn = this.domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-mark-read-btn&#39;</span>)[0];
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="comment">// Enabling/disabling rules (not UX-signed-off):  Our bias is that people</span>
<a name="l00324"></a>00324     <span class="comment">// want to star messages and mark messages unread (since it they naturally</span>
<a name="l00325"></a>00325     <span class="comment">// end up unread), so unless messages are all in this state, we assume that</span>
<a name="l00326"></a>00326     <span class="comment">// is the desired action.</span>
<a name="l00327"></a>00327     var numStarred = 0, numRead = 0;
<a name="l00328"></a>00328     <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = 0; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; this.selectedMessages.length; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++) {
<a name="l00329"></a>00329       var <a class="code" href="../../d1/d04/app__install__manager_8js.html#aa32988dd09d5a9481dfadbb89d1426ab">msg</a> = this.selectedMessages[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>];
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (msg.isStarred)
<a name="l00331"></a>00331         numStarred++;
<a name="l00332"></a>00332       <span class="keywordflow">if</span> (msg.isRead)
<a name="l00333"></a>00333         numRead++;
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="comment">// Unstar if everything is starred, otherwise star</span>
<a name="l00337"></a>00337     this.setAsStarred = !(numStarred &amp;&amp; numStarred ===
<a name="l00338"></a>00338                           this.selectedMessages.length);
<a name="l00339"></a>00339     <span class="comment">// Mark read if everything is unread, otherwise unread</span>
<a name="l00340"></a>00340     this.setAsRead = (this.selectedMessages.length &amp;&amp; numRead === 0);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (!this.setAsStarred)
<a name="l00343"></a>00343       starBtn.classList.add(<span class="stringliteral">&#39;msg-btn-active&#39;</span>);
<a name="l00344"></a>00344     <span class="keywordflow">else</span>
<a name="l00345"></a>00345       starBtn.classList.remove(<span class="stringliteral">&#39;msg-btn-active&#39;</span>);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (this.setAsRead)
<a name="l00348"></a>00348       readBtn.classList.add(<span class="stringliteral">&#39;msg-btn-active&#39;</span>);
<a name="l00349"></a>00349     <span class="keywordflow">else</span>
<a name="l00350"></a>00350       readBtn.classList.remove(<span class="stringliteral">&#39;msg-btn-active&#39;</span>);
<a name="l00351"></a>00351   },
<a name="l00352"></a>00352 
<a name="l00353"></a>00353   _hideSearchBoxByScrolling: <span class="keyword">function</span>() {
<a name="l00354"></a>00354     <span class="comment">// scroll the search bit out of the way</span>
<a name="l00355"></a>00355     var searchBar =
<a name="l00356"></a>00356       this.domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-search-tease-bar&#39;</span>)[0];
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="comment">// Search bar could have been collapsed with a cache load, make sure</span>
<a name="l00359"></a>00359     <span class="comment">// it is visible</span>
<a name="l00360"></a>00360     searchBar.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     this.scrollNode.scrollTop = searchBar.offsetHeight;
<a name="l00363"></a>00363   },
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   onShowFolders: <span class="keyword">function</span>() {
<a name="l00366"></a>00366     var query = [<span class="stringliteral">&#39;folder_picker&#39;</span>, <span class="stringliteral">&#39;navigation&#39;</span>];
<a name="l00367"></a>00367     <span class="keywordflow">if</span> (Cards.hasCard(query)) {
<a name="l00368"></a>00368       Cards.moveToCard(query);
<a name="l00369"></a>00369     } <span class="keywordflow">else</span> {
<a name="l00370"></a>00370       <span class="comment">// Add navigation, but before the message list.</span>
<a name="l00371"></a>00371       Cards.pushCard(
<a name="l00372"></a>00372         <span class="stringliteral">&#39;folder_picker&#39;</span>, <span class="stringliteral">&#39;navigation&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>,
<a name="l00373"></a>00373         {
<a name="l00374"></a>00374           onPushed: <span class="keyword">function</span>() {
<a name="l00375"></a>00375             <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(<span class="keyword">function</span>() {
<a name="l00376"></a>00376             <span class="comment">// Do showCard here instead of using an &#39;animate&#39;</span>
<a name="l00377"></a>00377             <span class="comment">// for the pushCard call, since the styling of</span>
<a name="l00378"></a>00378             <span class="comment">// the folder_picker uses new images that need to</span>
<a name="l00379"></a>00379             <span class="comment">// load, and if &#39;animate&#39; is used, the banner</span>
<a name="l00380"></a>00380             <span class="comment">// gradient is not loaded during the transition.</span>
<a name="l00381"></a>00381             <span class="comment">// The setTimeout also gives the header image a</span>
<a name="l00382"></a>00382             <span class="comment">// chance to finish loading. Without it, there is</span>
<a name="l00383"></a>00383             <span class="comment">// still a white flash. Going lower than 50, not</span>
<a name="l00384"></a>00384             <span class="comment">// specifying a value, still resulted in white flash.</span>
<a name="l00385"></a>00385             Cards.moveToCard(query);
<a name="l00386"></a>00386           }, 50);
<a name="l00387"></a>00387           }.bind(<span class="keyword">this</span>)
<a name="l00388"></a>00388         },
<a name="l00389"></a>00389         <span class="comment">// Place to left of message list</span>
<a name="l00390"></a>00390         <span class="stringliteral">&#39;left&#39;</span>);
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392   },
<a name="l00393"></a>00393 
<a name="l00394"></a>00394   onCompose: <span class="keyword">function</span>() {
<a name="l00395"></a>00395     Cards.pushCard(<span class="stringliteral">&#39;compose&#39;</span>, <span class="stringliteral">&#39;default&#39;</span>, <span class="stringliteral">&#39;animate&#39;</span>);
<a name="l00396"></a>00396   },
<a name="l00397"></a>00397 
<a name="l00402"></a>00402   showFolder: <span class="keyword">function</span>(folder, forceNewSlice) {
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (folder === this.curFolder &amp;&amp; !forceNewSlice)
<a name="l00404"></a>00404       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (this.messagesSlice) {
<a name="l00407"></a>00407       this.messagesSlice.die();
<a name="l00408"></a>00408       this.messagesSlice = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00409"></a>00409       this.messagesContainer.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     this.curFolder = folder;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="keywordflow">switch</span> (folder.type) {
<a name="l00415"></a>00415       <span class="keywordflow">case</span> <span class="stringliteral">&#39;drafts&#39;</span>:
<a name="l00416"></a>00416       <span class="keywordflow">case</span> <span class="stringliteral">&#39;localdrafts&#39;</span>:
<a name="l00417"></a>00417       <span class="keywordflow">case</span> <span class="stringliteral">&#39;sent&#39;</span>:
<a name="l00418"></a>00418         this.isIncomingFolder = <span class="keyword">false</span>;
<a name="l00419"></a>00419         <span class="keywordflow">break</span>;
<a name="l00420"></a>00420       <span class="keywordflow">default</span>:
<a name="l00421"></a>00421         this.isIncomingFolder = <span class="keyword">true</span>;
<a name="l00422"></a>00422         <span class="keywordflow">break</span>;
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     this.domNode.getElementsByClassName(<span class="stringliteral">&#39;msg-list-header-folder-label&#39;</span>)[0]
<a name="l00426"></a>00426       .textContent = folder.name;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     this.hideEmptyLayout();
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="comment">// you can&#39;t refresh the localdrafts folder or move messages out of it.</span>
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (folder.type === <span class="stringliteral">&#39;localdrafts&#39;</span>) {
<a name="l00432"></a>00432       this.toolbar.refreshBtn.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00433"></a>00433       this.toolbar.moveBtn.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435     <span class="keywordflow">else</span> {
<a name="l00436"></a>00436       this.toolbar.refreshBtn.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00437"></a>00437       this.toolbar.moveBtn.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="comment">// We are creating a new slice, so any pending snippet requests are moot.</span>
<a name="l00441"></a>00441     this._snippetRequestPending = <span class="keyword">false</span>;
<a name="l00442"></a>00442     this.messagesSlice = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.api.viewFolderMessages(folder);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     this.messagesSlice.onsplice = this.onMessagesSplice.bind(<span class="keyword">this</span>);
<a name="l00445"></a>00445     this.messagesSlice.onchange = this.onMessagesChange.bind(<span class="keyword">this</span>);
<a name="l00446"></a>00446     this.messagesSlice.onstatus = this.onStatusChange.bind(<span class="keyword">this</span>);
<a name="l00447"></a>00447     this.messagesSlice.oncomplete = this._boundSliceRequestComplete;
<a name="l00448"></a>00448     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00449"></a>00449   },
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   showSearch: <span class="keyword">function</span>(folder, phrase, <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a>) {
<a name="l00452"></a>00452     <a class="code" href="../../d9/d42/caldav__worker_8js.html#ac798a668e63cdb5c7af2b97ab014f85f">console</a>.log(<span class="stringliteral">&#39;sf: showSearch. phrase:&#39;</span>, phrase, phrase.length);
<a name="l00453"></a>00453     var tab = this.domNode.getElementsByClassName(<span class="stringliteral">&#39;filter&#39;</span>)[0];
<a name="l00454"></a>00454     var <a class="code" href="../../da/df2/namespacexml2dict.html#aaabd7336a42f36f8a79edd9e5fc821cf">nodes</a> = tab.getElementsByClassName(<span class="stringliteral">&#39;msg-search-filter&#39;</span>);
<a name="l00455"></a>00455     <span class="keywordflow">if</span> (this.messagesSlice) {
<a name="l00456"></a>00456       this.messagesSlice.die();
<a name="l00457"></a>00457       this.messagesSlice = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00458"></a>00458       this.messagesContainer.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460     this.curFolder = folder;
<a name="l00461"></a>00461     this.curPhrase = phrase;
<a name="l00462"></a>00462     this.curFilter = <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a>;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = 0; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &lt; nodes.length; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++) {
<a name="l00465"></a>00465       <span class="keywordflow">if</span> (nodes[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].dataset.filter != <span class="keyword">this</span>.curFilter) {
<a name="l00466"></a>00466         nodes[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].setAttribute(<span class="stringliteral">&#39;aria-selected&#39;</span>, <span class="stringliteral">&#39;false&#39;</span>);
<a name="l00467"></a>00467         <span class="keywordflow">continue</span>;
<a name="l00468"></a>00468       }
<a name="l00469"></a>00469       nodes[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>].setAttribute(<span class="stringliteral">&#39;aria-selected&#39;</span>, <span class="stringliteral">&#39;true&#39;</span>);
<a name="l00470"></a>00470     }
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (phrase.length &lt; 1)
<a name="l00472"></a>00472       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474     <span class="comment">// We are creating a new slice, so any pending snippet requests are moot.</span>
<a name="l00475"></a>00475     this._snippetRequestPending = <span class="keyword">false</span>;
<a name="l00476"></a>00476     this.messagesSlice = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.api.searchFolderMessages(
<a name="l00477"></a>00477       folder, phrase,
<a name="l00478"></a>00478       {
<a name="l00479"></a>00479         <a class="code" href="../../dd/dc4/namespacesetup.html#a7b92894168460f935bc49467954c4a92">author</a>: <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a> === <span class="stringliteral">&#39;all&#39;</span> || <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a> === <span class="stringliteral">&#39;author&#39;</span>,
<a name="l00480"></a>00480         recipients: <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a> === <span class="stringliteral">&#39;all&#39;</span> || <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a> === <span class="stringliteral">&#39;recipients&#39;</span>,
<a name="l00481"></a>00481         <a class="code" href="../../da/dce/details__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>: <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a> === <span class="stringliteral">&#39;all&#39;</span> || <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a> === <span class="stringliteral">&#39;subject&#39;</span>,
<a name="l00482"></a>00482         body: <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a> === <span class="stringliteral">&#39;all&#39;</span> || <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#ab628e67f85699825109c59795f6ece42">filter</a> === <span class="stringliteral">&#39;body&#39;</span>
<a name="l00483"></a>00483       });
<a name="l00484"></a>00484     this.messagesSlice.onsplice = this.onMessagesSplice.bind(<span class="keyword">this</span>);
<a name="l00485"></a>00485     this.messagesSlice.onchange = this.updateMatchedMessageDom.bind(<span class="keyword">this</span>,
<a name="l00486"></a>00486                                                                     <span class="keyword">false</span>);
<a name="l00487"></a>00487     this.messagesSlice.onstatus = this.onStatusChange.bind(<span class="keyword">this</span>);
<a name="l00488"></a>00488     this.messagesSlice.oncomplete = this._boundSliceRequestComplete;
<a name="l00489"></a>00489     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00490"></a>00490   },
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   onSearchFilterClick: <span class="keyword">function</span>(filterNode, <a class="code" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>) {
<a name="l00493"></a>00493     this.showSearch(this.curFolder, this.searchInput.value,
<a name="l00494"></a>00494                     filterNode.dataset.filter);
<a name="l00495"></a>00495   },
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   onSearchTextChange: <span class="keyword">function</span>(<a class="code" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>) {
<a name="l00498"></a>00498     <a class="code" href="../../d9/d42/caldav__worker_8js.html#ac798a668e63cdb5c7af2b97ab014f85f">console</a>.log(<span class="stringliteral">&#39;sf: typed, now:&#39;</span>, this.searchInput.value);
<a name="l00499"></a>00499     this.showSearch(this.curFolder, this.searchInput.value, <span class="keyword">this</span>.curFilter);
<a name="l00500"></a>00500   },
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   onCancelSearch: <span class="keyword">function</span>(<a class="code" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>) {
<a name="l00503"></a>00503     <span class="keywordflow">try</span> {
<a name="l00504"></a>00504       <span class="keywordflow">if</span> (this.messagesSlice)
<a name="l00505"></a>00505         this.messagesSlice.die();
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     <span class="keywordflow">catch</span> (ex) {
<a name="l00508"></a>00508       <a class="code" href="../../d9/d42/caldav__worker_8js.html#ac798a668e63cdb5c7af2b97ab014f85f">console</a>.error(<span class="stringliteral">&#39;problem killing slice:&#39;</span>, ex, <span class="charliteral">&#39;\n&#39;</span>, ex.stack);
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510     this.messagesSlice = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00511"></a>00511     Cards.removeCardAndSuccessors(this.domNode, <span class="stringliteral">&#39;animate&#39;</span>);
<a name="l00512"></a>00512   },
<a name="l00513"></a>00513 
<a name="l00514"></a>00514   onGetMoreMessages: <span class="keyword">function</span>() {
<a name="l00515"></a>00515     <span class="keywordflow">if</span> (!this.messagesSlice)
<a name="l00516"></a>00516       <span class="keywordflow">return</span>;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     this.messagesSlice.requestGrowth(1, <span class="keyword">true</span>);
<a name="l00519"></a>00519     <span class="comment">// Provide instant feedback that they pressed the button by hiding the</span>
<a name="l00520"></a>00520     <span class="comment">// button.  However, don&#39;t show &#39;synchronizing&#39; because that might not</span>
<a name="l00521"></a>00521     <span class="comment">// actually happen.</span>
<a name="l00522"></a>00522     this.syncMoreNode.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00523"></a>00523   },
<a name="l00524"></a>00524 
<a name="l00525"></a>00525   onStatusChange: <span class="keyword">function</span>(newStatus) {
<a name="l00526"></a>00526     <span class="keywordflow">switch</span> (newStatus) {
<a name="l00527"></a>00527       <span class="keywordflow">case</span> <span class="stringliteral">&#39;synchronizing&#39;</span>:
<a name="l00528"></a>00528       <span class="keywordflow">case</span> <span class="stringliteral">&#39;syncblocked&#39;</span>:
<a name="l00529"></a>00529         this.syncingNode.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00530"></a>00530         this.syncMoreNode.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00531"></a>00531         this.hideEmptyLayout();
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         this.toolbar.refreshBtn.dataset.state = <span class="stringliteral">&#39;synchronizing&#39;</span>;
<a name="l00534"></a>00534         <span class="keywordflow">break</span>;
<a name="l00535"></a>00535       <span class="keywordflow">case</span> <span class="stringliteral">&#39;syncfailed&#39;</span>:
<a name="l00536"></a>00536         <span class="comment">// If there was a problem talking to the server, notify the user and</span>
<a name="l00537"></a>00537         <span class="comment">// provide a means to attempt to talk to the server again.  We have made</span>
<a name="l00538"></a>00538         <span class="comment">// onRefresh pretty clever, so it can do all the legwork on</span>
<a name="l00539"></a>00539         <span class="comment">// accomplishing this goal.</span>
<a name="l00540"></a>00540         Toaster.logRetryable(newStatus, this.onRefresh.bind(<span class="keyword">this</span>));
<a name="l00541"></a>00541 
<a name="l00542"></a>00542         <span class="comment">// Fall through...</span>
<a name="l00543"></a>00543       <span class="keywordflow">case</span> <span class="stringliteral">&#39;synced&#39;</span>:
<a name="l00544"></a>00544         this.toolbar.refreshBtn.dataset.state = <span class="stringliteral">&#39;synchronized&#39;</span>;
<a name="l00545"></a>00545         this.syncingNode.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00546"></a>00546         <span class="keywordflow">break</span>;
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548   },
<a name="l00549"></a>00549 
<a name="l00554"></a>00554   showEmptyLayout: <span class="keyword">function</span>() {
<a name="l00555"></a>00555     var <a class="code" href="../../dd/dfa/classtext.html">text</a> = this.domNode.
<a name="l00556"></a>00556       getElementsByClassName(<span class="stringliteral">&#39;msg-list-empty-message-text&#39;</span>)[0];
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     this._clearCachedMessages();
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     text.textContent = this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a> == <span class="stringliteral">&#39;search&#39;</span> ?
<a name="l00561"></a>00561       <a class="code" href="../../da/dce/details__test_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">mozL10n</a>.get(<span class="stringliteral">&#39;messages-search-empty&#39;</span>) :
<a name="l00562"></a>00562       <a class="code" href="../../da/dce/details__test_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">mozL10n</a>.get(<span class="stringliteral">&#39;messages-folder-empty&#39;</span>);
<a name="l00563"></a>00563     this.messageEmptyContainer.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00564"></a>00564     this.toolbar.editBtn.classList.add(<span class="stringliteral">&#39;disabled&#39;</span>);
<a name="l00565"></a>00565     this.toolbar.searchBtn.classList.add(<span class="stringliteral">&#39;disabled&#39;</span>);
<a name="l00566"></a>00566     this._hideSearchBoxByScrolling();
<a name="l00567"></a>00567   },
<a name="l00572"></a>00572   hideEmptyLayout: <span class="keyword">function</span>() {
<a name="l00573"></a>00573     this.messageEmptyContainer.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00574"></a>00574     this.toolbar.editBtn.classList.remove(<span class="stringliteral">&#39;disabled&#39;</span>);
<a name="l00575"></a>00575     this.toolbar.searchBtn.classList.remove(<span class="stringliteral">&#39;disabled&#39;</span>);
<a name="l00576"></a>00576   },
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 
<a name="l00582"></a>00582   onSliceRequestComplete: <span class="keyword">function</span>(newEmailCount) {
<a name="l00583"></a>00583     <span class="comment">// We always want our logic to fire, but complete auto-clears before firing.</span>
<a name="l00584"></a>00584     this.messagesSlice.oncomplete = this._boundSliceRequestComplete;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     <span class="keywordflow">if</span> (this.messagesSlice.userCanGrowDownwards)
<a name="l00587"></a>00587       this.syncMoreNode.classList.remove(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00588"></a>00588     <span class="keywordflow">else</span>
<a name="l00589"></a>00589       this.syncMoreNode.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="comment">// Show empty layout, unless this is a slice with fake data that</span>
<a name="l00592"></a>00592     <span class="comment">// will get changed soon.</span>
<a name="l00593"></a>00593     <span class="keywordflow">if</span> (this.messagesSlice.items.length === 0) {
<a name="l00594"></a>00594       this.showEmptyLayout();
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     this.onNewMail(newEmailCount);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="comment">// Consider requesting more data or discarding data based on scrolling that</span>
<a name="l00600"></a>00600     <span class="comment">// has happened since we issued the request.  (While requests were pending,</span>
<a name="l00601"></a>00601     <span class="comment">// onScroll ignored scroll events.)</span>
<a name="l00602"></a>00602     this._onScroll(<a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>);
<a name="l00603"></a>00603   },
<a name="l00604"></a>00604 
<a name="l00605"></a>00605   onNewMail: <span class="keyword">function</span>(newEmailCount) {
<a name="l00606"></a>00606     var inboxFolder = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.foldersSlice.getFirstFolderWithType(<span class="stringliteral">&#39;inbox&#39;</span>);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608     <span class="keywordflow">if</span> (inboxFolder.id === <span class="keyword">this</span>.curFolder.id &amp;&amp;
<a name="l00609"></a>00609         newEmailCount &amp;&amp; newEmailCount !== <a class="code" href="../../d2/da3/namespacegoogle_1_1protobuf_1_1internal.html#a2b5ccba6031cb434232aa272f11038e6">NaN</a> &amp;&amp; newEmailCount !== 0) {
<a name="l00610"></a>00610       <span class="keywordflow">if</span> (!Cards.isVisible(<span class="keyword">this</span>)) {
<a name="l00611"></a>00611         this._whenVisible = this.onNewMail.bind(<span class="keyword">this</span>, newEmailCount);
<a name="l00612"></a>00612         <span class="keywordflow">return</span>;
<a name="l00613"></a>00613       }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615       <span class="comment">// Decorate or update the little notification bar that tells the user</span>
<a name="l00616"></a>00616       <span class="comment">// how many new emails they&#39;ve received after a sync.</span>
<a name="l00617"></a>00617       <span class="keywordflow">if</span> (this._topbar &amp;&amp; this._topbar.getElement() !== <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>) {
<a name="l00618"></a>00618         <span class="comment">// Update the existing status bar.</span>
<a name="l00619"></a>00619         this._topbar.updateNewEmailCount(newEmailCount);
<a name="l00620"></a>00620       } <span class="keywordflow">else</span> {
<a name="l00621"></a>00621         this._topbar = <span class="keyword">new</span> MessageListTopbar(
<a name="l00622"></a>00622             this.scrollContainer, newEmailCount);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         var el =
<a name="l00625"></a>00625             <a class="code" href="../../dd/d64/apps_2email_2js_2ext_2mailapi_2worker-bootstrap_8js.html#af61dbe660d8213297c7fed5b5c99d223">document</a>.getElementsByClassName(MessageListTopbar.CLASS_NAME)[0];
<a name="l00626"></a>00626         this._topbar.decorate(el);
<a name="l00627"></a>00627         this._topbar.render();
<a name="l00628"></a>00628       }
<a name="l00629"></a>00629     }
<a name="l00630"></a>00630   },
<a name="l00631"></a>00631 
<a name="l00632"></a>00632   onScroll: <span class="keyword">function</span>(evt) {
<a name="l00633"></a>00633     <span class="keywordflow">if</span> (this._pendingScrollEvent) {
<a name="l00634"></a>00634       <span class="keywordflow">return</span>;
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637     this._pendingScrollEvent = <span class="keyword">true</span>;
<a name="l00638"></a>00638     this._scrollTimer = <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(this._onScroll, SCROLL_DELAY, evt);
<a name="l00639"></a>00639   },
<a name="l00640"></a>00640 
<a name="l00650"></a>00650   _onScroll: <span class="keyword">function</span>(<a class="code" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>) {
<a name="l00651"></a>00651     <span class="keywordflow">if</span> (this._pendingScrollEvent) {
<a name="l00652"></a>00652       this._pendingScrollEvent = <span class="keyword">false</span>;
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 
<a name="l00656"></a>00656     <span class="comment">// Defer processing until any pending requests have completed;</span>
<a name="l00657"></a>00657     <span class="comment">// `onSliceRequestComplete` will call us.</span>
<a name="l00658"></a>00658     <span class="keywordflow">if</span> (!this.messagesSlice || this.messagesSlice.pendingRequestCount)
<a name="l00659"></a>00659       <span class="keywordflow">return</span>;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (!this._hasSnippetRequest()) {
<a name="l00662"></a>00662       this._requestSnippets();
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665     var curScrollTop = this.scrollContainer.scrollTop,
<a name="l00666"></a>00666         viewHeight = this.scrollContainer.clientHeight;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668     var preScreens = curScrollTop / viewHeight,
<a name="l00669"></a>00669         postScreens = (this.scrollContainer.scrollHeight -
<a name="l00670"></a>00670                        (curScrollTop + viewHeight)) /
<a name="l00671"></a>00671                       viewHeight;
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     var shrinkLowIncl = 0,
<a name="l00674"></a>00674         shrinkHighIncl = this.messagesSlice.items.length - 1,
<a name="l00675"></a>00675         messageNode = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>, targOff;
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (preScreens &lt; SCROLL_MIN_BUFFER_SCREENS &amp;&amp;
<a name="l00677"></a>00677         !this.messagesSlice.atTop) {
<a name="l00678"></a>00678       this.messagesSlice.requestGrowth(-1);
<a name="l00679"></a>00679       <span class="keywordflow">return</span>;
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preScreens &gt; SCROLL_MAX_RETENTION_SCREENS) {
<a name="l00682"></a>00682       <span class="comment">// Take off one screen at a time.</span>
<a name="l00683"></a>00683       targOff = curScrollTop -
<a name="l00684"></a>00684                 (viewHeight * (SCROLL_MAX_RETENTION_SCREENS - 1));
<a name="l00685"></a>00685       <span class="keywordflow">for</span> (messageNode = this.messagesContainer.firstElementChild;
<a name="l00686"></a>00686            messageNode.offsetTop + messageNode.clientHeight &lt; targOff;
<a name="l00687"></a>00687            messageNode = messageNode.nextElementSibling) {
<a name="l00688"></a>00688         shrinkLowIncl++;
<a name="l00689"></a>00689       }
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692     <span class="keywordflow">if</span> (postScreens &lt; SCROLL_MIN_BUFFER_SCREENS &amp;&amp;
<a name="l00693"></a>00693         !this.messagesSlice.atBottom) {
<a name="l00694"></a>00694       this.messagesSlice.requestGrowth(1);
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (postScreens &gt; SCROLL_MAX_RETENTION_SCREENS) {
<a name="l00697"></a>00697       targOff = curScrollTop +
<a name="l00698"></a>00698                 this.scrollContainer.clientHeight +
<a name="l00699"></a>00699                 (viewHeight * (SCROLL_MAX_RETENTION_SCREENS - 1));
<a name="l00700"></a>00700       <span class="keywordflow">for</span> (messageNode = this.messagesContainer.lastElementChild;
<a name="l00701"></a>00701            messageNode.offsetTop &gt; targOff;
<a name="l00702"></a>00702            messageNode = messageNode.previousElementSibling) {
<a name="l00703"></a>00703         shrinkHighIncl--;
<a name="l00704"></a>00704       }
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707     <span class="keywordflow">if</span> (shrinkLowIncl !== 0 ||
<a name="l00708"></a>00708         shrinkHighIncl !== this.messagesSlice.items.length - 1) {
<a name="l00709"></a>00709       this.messagesSlice.requestShrinkage(shrinkLowIncl, shrinkHighIncl);
<a name="l00710"></a>00710     }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   },
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   _hasSnippetRequest: <span class="keyword">function</span>() {
<a name="l00715"></a>00715     var <a class="code" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a> = MAXIMUM_MS_BETWEEN_SNIPPET_REQUEST;
<a name="l00716"></a>00716     var now = Date.now();
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="comment">// if we before the maximum time to wait between requests...</span>
<a name="l00719"></a>00719     var beforeTimeout =
<a name="l00720"></a>00720       (this._lastSnippetRequest + <a class="code" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a>) &gt; now;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     <span class="comment">// there is an important case where the backend may be slow OR have some</span>
<a name="l00723"></a>00723     <span class="comment">// fatal error which would prevent us from ever requesting an new set of</span>
<a name="l00724"></a>00724     <span class="comment">// snippets because we wait until the last batch finishes... To prevent that</span>
<a name="l00725"></a>00725     <span class="comment">// from ever happening we maintain the request start time and if more then</span>
<a name="l00726"></a>00726     <span class="comment">// MAXIMUM_MS_BETWEEN_SNIPPET_REQUEST passes we issue a new request.</span>
<a name="l00727"></a>00727     <span class="keywordflow">if</span> (
<a name="l00728"></a>00728       this._snippetRequestPending &amp;&amp;
<a name="l00729"></a>00729       beforeTimeout
<a name="l00730"></a>00730     ) {
<a name="l00731"></a>00731       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00735"></a>00735   },
<a name="l00736"></a>00736 
<a name="l00737"></a>00737   _pendingSnippetRequest: <span class="keyword">function</span>() {
<a name="l00738"></a>00738     this._snippetRequestPending = <span class="keyword">true</span>;
<a name="l00739"></a>00739     this._lastSnippetRequest = Date.now();
<a name="l00740"></a>00740   },
<a name="l00741"></a>00741 
<a name="l00742"></a>00742   _clearSnippetRequest: <span class="keyword">function</span>() {
<a name="l00743"></a>00743     this._snippetRequestPending = <span class="keyword">false</span>;
<a name="l00744"></a>00744   },
<a name="l00745"></a>00745 
<a name="l00746"></a>00746   _requestSnippets: <span class="keyword">function</span>() {
<a name="l00747"></a>00747     var items = this.messagesSlice.items;
<a name="l00748"></a>00748     var <a class="code" href="../../d9/d04/expat_8h.html#a5df20ff5bc70fb664abe3912796e90df">len</a> = items.length;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     <span class="keywordflow">if</span> (!len)
<a name="l00751"></a>00751       <span class="keywordflow">return</span>;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     var clearSnippets = this._clearSnippetRequest.bind(<span class="keyword">this</span>);
<a name="l00754"></a>00754     var <a class="code" href="../../d6/d46/system_2js_2icc_8js.html#a77e4041f4236c111378c64001ea99114">options</a> = {
<a name="l00755"></a>00755       <span class="comment">// this is per message</span>
<a name="l00756"></a>00756       maximumBytesToFetch: MAXIMUM_BYTES_PER_MESSAGE_DURING_SCROLL
<a name="l00757"></a>00757     };
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     <span class="keywordflow">if</span> (len &lt; MINIMUM_ITEMS_FOR_SCROLL_CALC) {
<a name="l00760"></a>00760       this._pendingSnippetRequest();
<a name="l00761"></a>00761       this.messagesSlice.maybeRequestBodies(0, 9, options, clearSnippets);
<a name="l00762"></a>00762       <span class="keywordflow">return</span>;
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="comment">// get the scrollable offset</span>
<a name="l00766"></a>00766     <span class="keywordflow">if</span> (!this._scrollContainerOffset) {
<a name="l00767"></a>00767       this._scrollContainerRect =
<a name="l00768"></a>00768         this.scrollContainer.getBoundingClientRect();
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     var constOffset = this._scrollContainerRect.top;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773     <span class="comment">// determine where we are in the list;</span>
<a name="l00774"></a>00774     var topOffset = (
<a name="l00775"></a>00775       items[0].element.getBoundingClientRect().top - constOffset
<a name="l00776"></a>00776     );
<a name="l00777"></a>00777 
<a name="l00778"></a>00778     <span class="comment">// the distance between items. It is expected to remain fairly constant</span>
<a name="l00779"></a>00779     <span class="comment">// throughout the list so we only need to calculate it once.</span>
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     var distance = this._distanceBetweenMessages;
<a name="l00782"></a>00782     <span class="keywordflow">if</span> (!distance) {
<a name="l00783"></a>00783       this._distanceBetweenMessages = distance = Math.abs(
<a name="l00784"></a>00784         topOffset -
<a name="l00785"></a>00785         (items[1].element.getBoundingClientRect().top - constOffset)
<a name="l00786"></a>00786       );
<a name="l00787"></a>00787     }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789     <span class="comment">// starting offset to begin fetching snippets</span>
<a name="l00790"></a>00790     var startOffset = Math.floor(Math.abs(topOffset / distance));
<a name="l00791"></a>00791 
<a name="l00792"></a>00792     this._snippetsPerScrollTick = (
<a name="l00793"></a>00793       this._snippetsPerScrollTick ||
<a name="l00794"></a>00794       Math.ceil(this._scrollContainerRect.height / distance)
<a name="l00795"></a>00795     );
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     this._pendingSnippetRequest();
<a name="l00799"></a>00799     this.messagesSlice.maybeRequestBodies(
<a name="l00800"></a>00800       startOffset,
<a name="l00801"></a>00801       startOffset + this._snippetsPerScrollTick,
<a name="l00802"></a>00802       options,
<a name="l00803"></a>00803       clearSnippets
<a name="l00804"></a>00804     );
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   },
<a name="l00807"></a>00807 
<a name="l00812"></a>00812   _cacheListLimit: 7,
<a name="l00813"></a>00813 
<a name="l00818"></a>00818   _cacheDomTimeoutId: 0,
<a name="l00819"></a>00819 
<a name="l00823"></a>00823   _cacheDom: <span class="keyword">function</span>() {
<a name="l00824"></a>00824     this._cacheDomTimeoutId = 0;
<a name="l00825"></a>00825 
<a name="l00826"></a>00826     var cacheNode = this.domNode.cloneNode(<span class="keyword">true</span>);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     <span class="comment">// Hide search field as it will not operate and gets scrolled out</span>
<a name="l00830"></a>00830     <span class="comment">// of view after real load.</span>
<a name="l00831"></a>00831     var removableCacheNode = cacheNode.querySelector(<span class="stringliteral">&#39;.msg-search-tease-bar&#39;</span>);
<a name="l00832"></a>00832     <span class="keywordflow">if</span> (removableCacheNode)
<a name="l00833"></a>00833       removableCacheNode.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     <span class="comment">// Hide &quot;new mail&quot; topbar too</span>
<a name="l00836"></a>00836     removableCacheNode = cacheNode
<a name="l00837"></a>00837                            .querySelector(<span class="charliteral">&#39;.&#39;</span> + MessageListTopbar.CLASS_NAME);
<a name="l00838"></a>00838     <span class="keywordflow">if</span> (removableCacheNode)
<a name="l00839"></a>00839       removableCacheNode.classList.add(<span class="stringliteral">&#39;collapsed&#39;</span>);
<a name="l00840"></a>00840 
<a name="l00841"></a>00841     <span class="comment">// Trim the message list to _cacheListLimit.</span>
<a name="l00842"></a>00842     <span class="keywordflow">if</span> (this.messagesContainer.children.length &gt; <span class="keyword">this</span>._cacheListLimit) {
<a name="l00843"></a>00843       var msgContainer = cacheNode
<a name="l00844"></a>00844                         .getElementsByClassName(<span class="stringliteral">&#39;msg-messages-container&#39;</span>)[0];
<a name="l00845"></a>00845       <span class="keywordflow">for</span> (var childIndex = msgContainer.children.length - 1;
<a name="l00846"></a>00846                             childIndex &gt; <span class="keyword">this</span>._cacheListLimit - 1;
<a name="l00847"></a>00847                             childIndex--) {
<a name="l00848"></a>00848         var childNode = msgContainer.children[childIndex];
<a name="l00849"></a>00849         childNode.parentNode.removeChild(childNode);
<a name="l00850"></a>00850       }
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852     htmlCache.saveFromNode(cacheNode);
<a name="l00853"></a>00853   },
<a name="l00854"></a>00854 
<a name="l00861"></a>00861   _considerCacheDom: <span class="keyword">function</span>(<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>) {
<a name="l00862"></a>00862     <span class="comment">// Only bother if not already waiting to update cache and</span>
<a name="l00863"></a>00863     <span class="keywordflow">if</span> (!this._cacheDomTimeoutId &amp;&amp;
<a name="l00864"></a>00864         <span class="comment">// is for the folder that is considered cacheable (default inbox)</span>
<a name="l00865"></a>00865         this.cacheableFolderId === this.curFolder.id &amp;&amp;
<a name="l00866"></a>00866         <span class="comment">// if our slice is showing the newest messages in the folder and</span>
<a name="l00867"></a>00867         <span class="keyword">this</span>.messagesSlice.atTop &amp;&amp;
<a name="l00868"></a>00868         <span class="comment">// if actually got a numeric index and</span>
<a name="l00869"></a>00869         (<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> || <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> === 0) &amp;&amp;
<a name="l00870"></a>00870         <span class="comment">// if it affects the data we cache</span>
<a name="l00871"></a>00871         <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> &lt; this._cacheListLimit &amp;&amp;
<a name="l00872"></a>00872         <span class="comment">// is in non-search mode</span>
<a name="l00873"></a>00873         this.<a class="code" href="../../d2/d7d/jsapi_8h.html#a5e94be9423b9de6b3ab4057aca59293f">mode</a> === <span class="stringliteral">&#39;nonsearch&#39;</span>) {
<a name="l00874"></a>00874       this._cacheDomTimeoutId = <a class="code" href="../../da/da1/timers_8js.html#a619d004395c481cc1032f1c3747a04b9">setTimeout</a>(this._cacheDom.bind(<span class="keyword">this</span>), 600);
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876   },
<a name="l00877"></a>00877 
<a name="l00891"></a>00891   _clearCachedMessages: <span class="keyword">function</span>() {
<a name="l00892"></a>00892     <span class="keywordflow">if</span> (this.usingCachedNode) {
<a name="l00893"></a>00893       this.messagesContainer.innerHTML = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00894"></a>00894       this.usingCachedNode = <span class="keyword">false</span>;
<a name="l00895"></a>00895     }
<a name="l00896"></a>00896   },
<a name="l00897"></a>00897 
<a name="l00898"></a>00898   onMessagesSplice: <span class="keyword">function</span>(<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>, howMany, addedItems,
<a name="l00899"></a>00899                              requested, moreExpected, fake) {
<a name="l00900"></a>00900     <span class="comment">// If no work to do, just skip it.</span>
<a name="l00901"></a>00901     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> === 0 &amp;&amp; howMany === 0 &amp;&amp; !addedItems.length)
<a name="l00902"></a>00902       <span class="keywordflow">return</span>;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904     var prevHeight;
<a name="l00905"></a>00905     <span class="comment">// - removed messages</span>
<a name="l00906"></a>00906     <span class="keywordflow">if</span> (howMany) {
<a name="l00907"></a>00907       <span class="keywordflow">if</span> (fake &amp;&amp; <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> === 0 &amp;&amp; this.messagesSlice.items.length === howMany &amp;&amp;
<a name="l00908"></a>00908           !addedItems.length) {
<a name="l00909"></a>00909       } <span class="keywordflow">else</span> {
<a name="l00910"></a>00910         <span class="comment">// Regular remove for current call.</span>
<a name="l00911"></a>00911         <span class="comment">// Plan to fixup the scroll position if we are deleting a message that</span>
<a name="l00912"></a>00912         <span class="comment">// starts before the (visible) scrolled area.  (We add the container&#39;s</span>
<a name="l00913"></a>00913         <span class="comment">// start offset because it is as big as the occluding header bar.)</span>
<a name="l00914"></a>00914         prevHeight = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00915"></a>00915         <span class="keywordflow">if</span> (this.messagesSlice.items[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>].element.offsetTop &lt;
<a name="l00916"></a>00916             <span class="keyword">this</span>.scrollContainer.scrollTop + <span class="keyword">this</span>.messagesContainer.offsetTop) {
<a name="l00917"></a>00917           prevHeight = this.messagesContainer.clientHeight;
<a name="l00918"></a>00918         }
<a name="l00919"></a>00919 
<a name="l00920"></a>00920         <span class="keywordflow">for</span> (var <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> = <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> + howMany - 1; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a> &gt;= <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>; <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>--) {
<a name="l00921"></a>00921           var <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a> = this.messagesSlice.items[<a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>];
<a name="l00922"></a>00922           message.element.parentNode.removeChild(message.element);
<a name="l00923"></a>00923         }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925         <span class="comment">// If fixup is requred, adjust.</span>
<a name="l00926"></a>00926         <span class="keywordflow">if</span> (prevHeight !== <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>) {
<a name="l00927"></a>00927           this.scrollContainer.scrollTop -=
<a name="l00928"></a>00928             (prevHeight - this.messagesContainer.clientHeight);
<a name="l00929"></a>00929         }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931         <span class="comment">// Check the message count after deletion:</span>
<a name="l00932"></a>00932         <span class="keywordflow">if</span> (this.messagesContainer.children.length === 0) {
<a name="l00933"></a>00933           this.showEmptyLayout();
<a name="l00934"></a>00934         }
<a name="l00935"></a>00935       }
<a name="l00936"></a>00936     }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938     this._clearCachedMessages();
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <span class="comment">// - added/existing</span>
<a name="l00941"></a>00941     var insertBuddy, <span class="keyword">self</span> = <span class="keyword">this</span>;
<a name="l00942"></a>00942     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a> &gt;= this.messagesContainer.childElementCount)
<a name="l00943"></a>00943       insertBuddy = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00944"></a>00944     <span class="keywordflow">else</span>
<a name="l00945"></a>00945       insertBuddy = this.messagesContainer.children[<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>];
<a name="l00946"></a>00946     <span class="keywordflow">if</span> (insertBuddy &amp;&amp;
<a name="l00947"></a>00947         (insertBuddy.offsetTop &lt;
<a name="l00948"></a>00948          <span class="keyword">this</span>.scrollContainer.scrollTop + <span class="keyword">this</span>.messagesContainer.offsetTop))
<a name="l00949"></a>00949       prevHeight = this.messagesContainer.clientHeight;
<a name="l00950"></a>00950     <span class="keywordflow">else</span>
<a name="l00951"></a>00951       prevHeight = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <span class="comment">// Remove the no message text while new messages added:</span>
<a name="l00954"></a>00954     <span class="keywordflow">if</span> (addedItems.length &gt; 0) {
<a name="l00955"></a>00955       this.hideEmptyLayout();
<a name="l00956"></a>00956     }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958     addedItems.forEach(<span class="keyword">function</span>(message, <a class="code" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>) {
<a name="l00959"></a>00959       var domMessage;
<a name="l00960"></a>00960       domMessage = message.element = msgHeaderItemNode.cloneNode(<span class="keyword">true</span>);
<a name="l00961"></a>00961 
<a name="l00962"></a>00962       <span class="keywordflow">if</span> (<span class="keyword">self</span>.mode === <span class="stringliteral">&#39;nonsearch&#39;</span>) {
<a name="l00963"></a>00963         domMessage.message = <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>;
<a name="l00964"></a>00964         <span class="keyword">self</span>.updateMessageDom(<span class="keyword">true</span>, message);
<a name="l00965"></a>00965       }
<a name="l00966"></a>00966       <span class="keywordflow">else</span> {
<a name="l00967"></a>00967         domMessage.message = message.header;
<a name="l00968"></a>00968         <span class="keyword">self</span>.updateMatchedMessageDom(<span class="keyword">true</span>, message);
<a name="l00969"></a>00969       }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971       <span class="keyword">self</span>.messagesContainer.insertBefore(domMessage, insertBuddy);
<a name="l00972"></a>00972     });
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     <span class="keywordflow">if</span> (prevHeight) {
<a name="l00975"></a>00975       this.scrollContainer.scrollTop +=
<a name="l00976"></a>00976         (this.messagesContainer.clientHeight - prevHeight);
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="comment">// Only cache if it is an add or remove of items</span>
<a name="l00980"></a>00980     <span class="keywordflow">if</span> (addedItems.length || howMany) {
<a name="l00981"></a>00981       this._considerCacheDom(<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>);
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983   },
<a name="l00984"></a>00984 
<a name="l00985"></a>00985   onMessagesChange: <span class="keyword">function</span>(<a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>, <a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>) {
<a name="l00986"></a>00986     this.updateMessageDom(<span class="keyword">false</span>, message);
<a name="l00987"></a>00987 
<a name="l00988"></a>00988     <span class="comment">// Since the DOM change, cache may need to change.</span>
<a name="l00989"></a>00989     this._considerCacheDom(<a class="code" href="../../d2/d7d/jsapi_8h.html#aafd95f8c7a99b9189ede7cdf0871ebe8">index</a>);
<a name="l00990"></a>00990   },
<a name="l00991"></a>00991 
<a name="l00992"></a>00992   _updatePeepDom: <span class="keyword">function</span>(peep) {
<a name="l00993"></a>00993     peep.element.textContent = peep.name || peep.address;
<a name="l00994"></a>00994   },
<a name="l00995"></a>00995 
<a name="l00996"></a>00996   updateMessageDom: <span class="keyword">function</span>(firstTime, <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>) {
<a name="l00997"></a>00997     var msgNode = message.element;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999     <span class="comment">// ID is stored as a data- attribute so that it can survive</span>
<a name="l01000"></a>01000     <span class="comment">// serialization to HTML for storing in the HTML cache, and</span>
<a name="l01001"></a>01001     <span class="comment">// be usable before the actual data from the backend has</span>
<a name="l01002"></a>01002     <span class="comment">// loaded, as clicks to the message list are allowed before</span>
<a name="l01003"></a>01003     <span class="comment">// the back end is available. For this reason, click</span>
<a name="l01004"></a>01004     <span class="comment">// handlers should use dataset.id when wanting the ID.</span>
<a name="l01005"></a>01005     msgNode.dataset.id = message.id;
<a name="l01006"></a>01006 
<a name="l01007"></a>01007     <span class="comment">// some things only need to be done once</span>
<a name="l01008"></a>01008     var dateNode = msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-date&#39;</span>)[0];
<a name="l01009"></a>01009     <span class="keywordflow">if</span> (firstTime) {
<a name="l01010"></a>01010       var listPerson;
<a name="l01011"></a>01011       <span class="keywordflow">if</span> (this.isIncomingFolder)
<a name="l01012"></a>01012         listPerson = message.author;
<a name="l01013"></a>01013       <span class="comment">// XXX This is not to UX spec, but this is a stop-gap and that would</span>
<a name="l01014"></a>01014       <span class="comment">// require adding strings which we cannot justify as a slipstream fix.</span>
<a name="l01015"></a>01015       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message.to &amp;&amp; message.to.length)
<a name="l01016"></a>01016         listPerson = message.to[0];
<a name="l01017"></a>01017       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message.cc &amp;&amp; message.cc.length)
<a name="l01018"></a>01018         listPerson = message.cc[0];
<a name="l01019"></a>01019       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message.bcc &amp;&amp; message.bcc.length)
<a name="l01020"></a>01020         listPerson = message.bcc[0];
<a name="l01021"></a>01021       <span class="keywordflow">else</span>
<a name="l01022"></a>01022         listPerson = message.author;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024       <span class="comment">// author</span>
<a name="l01025"></a>01025       listPerson.element =
<a name="l01026"></a>01026         msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-author&#39;</span>)[0];
<a name="l01027"></a>01027       listPerson.onchange = this._updatePeepDom;
<a name="l01028"></a>01028       listPerson.onchange(listPerson);
<a name="l01029"></a>01029       <span class="comment">// date</span>
<a name="l01030"></a>01030       dateNode.dataset.time = message.date.valueOf();
<a name="l01031"></a>01031       dateNode.textContent = prettyDate(message.date);
<a name="l01032"></a>01032       <span class="comment">// subject</span>
<a name="l01033"></a>01033       displaySubject(msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-subject&#39;</span>)[0],
<a name="l01034"></a>01034                      <a class="code" href="../../d1/d04/app__install__manager_8js.html#ad031ac2c2bcd5e0fe9c6b67fc309acd4">message</a>);
<a name="l01035"></a>01035       <span class="comment">// attachments</span>
<a name="l01036"></a>01036       <span class="keywordflow">if</span> (message.hasAttachments)
<a name="l01037"></a>01037         msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-attachments&#39;</span>)[0]
<a name="l01038"></a>01038           .classList.add(<span class="stringliteral">&#39;msg-header-attachments-yes&#39;</span>);
<a name="l01039"></a>01039     }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     <span class="comment">// snippet</span>
<a name="l01042"></a>01042     msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-snippet&#39;</span>)[0]
<a name="l01043"></a>01043       .textContent = message.snippet;
<a name="l01044"></a>01044 
<a name="l01045"></a>01045     <span class="comment">// unread (we use very specific classes directly on the nodes rather than</span>
<a name="l01046"></a>01046     <span class="comment">// child selectors for hypothetical speed)</span>
<a name="l01047"></a>01047     var unreadNode =
<a name="l01048"></a>01048       msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-unread-section&#39;</span>)[0];
<a name="l01049"></a>01049     <span class="keywordflow">if</span> (message.isRead) {
<a name="l01050"></a>01050       unreadNode.classList.remove(<span class="stringliteral">&#39;msg-header-unread-section-unread&#39;</span>);
<a name="l01051"></a>01051       dateNode.classList.remove(<span class="stringliteral">&#39;msg-header-date-unread&#39;</span>);
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053     <span class="keywordflow">else</span> {
<a name="l01054"></a>01054       unreadNode.classList.add(<span class="stringliteral">&#39;msg-header-unread-section-unread&#39;</span>);
<a name="l01055"></a>01055       dateNode.classList.add(<span class="stringliteral">&#39;msg-header-date-unread&#39;</span>);
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057     <span class="comment">// star</span>
<a name="l01058"></a>01058     var starNode = msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-star&#39;</span>)[0];
<a name="l01059"></a>01059     <span class="keywordflow">if</span> (message.isStarred)
<a name="l01060"></a>01060       starNode.classList.add(<span class="stringliteral">&#39;msg-header-star-starred&#39;</span>);
<a name="l01061"></a>01061     <span class="keywordflow">else</span>
<a name="l01062"></a>01062       starNode.classList.remove(<span class="stringliteral">&#39;msg-header-star-starred&#39;</span>);
<a name="l01063"></a>01063   },
<a name="l01064"></a>01064 
<a name="l01065"></a>01065   updateMatchedMessageDom: <span class="keyword">function</span>(firstTime, matchedHeader) {
<a name="l01066"></a>01066     var msgNode = matchedHeader.element,
<a name="l01067"></a>01067         matches = matchedHeader.matches,
<a name="l01068"></a>01068         message = matchedHeader.header;
<a name="l01069"></a>01069 
<a name="l01070"></a>01070     <span class="comment">// Even though updateMatchedMessageDom is only used in searches,</span>
<a name="l01071"></a>01071     <span class="comment">// which likely will not be cached, the dataset.is is set to</span>
<a name="l01072"></a>01072     <span class="comment">// maintain parity withe updateMessageDom and so click handlers</span>
<a name="l01073"></a>01073     <span class="comment">// can always just use the dataset property.</span>
<a name="l01074"></a>01074     msgNode.dataset.id = matchedHeader.id;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076     <span class="comment">// some things only need to be done once</span>
<a name="l01077"></a>01077     var dateNode = msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-date&#39;</span>)[0];
<a name="l01078"></a>01078     <span class="keywordflow">if</span> (firstTime) {
<a name="l01079"></a>01079       <span class="comment">// author</span>
<a name="l01080"></a>01080       var authorNode = msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-author&#39;</span>)[0];
<a name="l01081"></a>01081       <span class="keywordflow">if</span> (matches.author) {
<a name="l01082"></a>01082         appendMatchItemTo(matches.author, authorNode);
<a name="l01083"></a>01083       }
<a name="l01084"></a>01084       <span class="keywordflow">else</span> {
<a name="l01085"></a>01085         <span class="comment">// we can only update the name if it wasn&#39;t matched on.</span>
<a name="l01086"></a>01086         message.author.element = authorNode;
<a name="l01087"></a>01087         message.author.onchange = this._updatePeepDom;
<a name="l01088"></a>01088         message.author.onchange(message.author);
<a name="l01089"></a>01089       }
<a name="l01090"></a>01090 
<a name="l01091"></a>01091       <span class="comment">// date</span>
<a name="l01092"></a>01092       dateNode.dataset.time = message.date.valueOf();
<a name="l01093"></a>01093       dateNode.textContent = prettyDate(message.date);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095       <span class="comment">// subject</span>
<a name="l01096"></a>01096       var subjectNode = msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-subject&#39;</span>)[0];
<a name="l01097"></a>01097       <span class="keywordflow">if</span> (matches.subject)
<a name="l01098"></a>01098         appendMatchItemTo(matches.subject[0], subjectNode);
<a name="l01099"></a>01099       <span class="keywordflow">else</span>
<a name="l01100"></a>01100         displaySubject(subjectNode, message);
<a name="l01101"></a>01101 
<a name="l01102"></a>01102       <span class="comment">// snippet</span>
<a name="l01103"></a>01103       var snippetNode = msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-snippet&#39;</span>)[0];
<a name="l01104"></a>01104       <span class="keywordflow">if</span> (matches.body)
<a name="l01105"></a>01105        appendMatchItemTo(matches.body[0], snippetNode);
<a name="l01106"></a>01106       <span class="keywordflow">else</span>
<a name="l01107"></a>01107         snippetNode.textContent = message.snippet;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109       <span class="comment">// attachments</span>
<a name="l01110"></a>01110       <span class="keywordflow">if</span> (message.hasAttachments)
<a name="l01111"></a>01111         msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-attachments&#39;</span>)[0]
<a name="l01112"></a>01112           .classList.add(<span class="stringliteral">&#39;msg-header-attachments-yes&#39;</span>);
<a name="l01113"></a>01113     }
<a name="l01114"></a>01114 
<a name="l01115"></a>01115     <span class="comment">// unread (we use very specific classes directly on the nodes rather than</span>
<a name="l01116"></a>01116     <span class="comment">// child selectors for hypothetical speed)</span>
<a name="l01117"></a>01117     var unreadNode =
<a name="l01118"></a>01118       msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-unread-section&#39;</span>)[0];
<a name="l01119"></a>01119     <span class="keywordflow">if</span> (message.isRead) {
<a name="l01120"></a>01120       unreadNode.classList.remove(<span class="stringliteral">&#39;msg-header-unread-section-unread&#39;</span>);
<a name="l01121"></a>01121       dateNode.classList.remove(<span class="stringliteral">&#39;msg-header-date-unread&#39;</span>);
<a name="l01122"></a>01122     }
<a name="l01123"></a>01123     <span class="keywordflow">else</span> {
<a name="l01124"></a>01124       unreadNode.classList.add(<span class="stringliteral">&#39;msg-header-unread-section-unread&#39;</span>);
<a name="l01125"></a>01125       dateNode.classList.add(<span class="stringliteral">&#39;msg-header-date-unread&#39;</span>);
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127     <span class="comment">// star</span>
<a name="l01128"></a>01128     var starNode = msgNode.getElementsByClassName(<span class="stringliteral">&#39;msg-header-star&#39;</span>)[0];
<a name="l01129"></a>01129     <span class="keywordflow">if</span> (message.isStarred)
<a name="l01130"></a>01130       starNode.classList.add(<span class="stringliteral">&#39;msg-header-star-starred&#39;</span>);
<a name="l01131"></a>01131     <span class="keywordflow">else</span>
<a name="l01132"></a>01132       starNode.classList.remove(<span class="stringliteral">&#39;msg-header-star-starred&#39;</span>);
<a name="l01133"></a>01133   },
<a name="l01134"></a>01134 
<a name="l01139"></a>01139   onCardVisible: <span class="keyword">function</span>() {
<a name="l01140"></a>01140     <span class="keywordflow">if</span> (this._whenVisible) {
<a name="l01141"></a>01141       var fn = this._whenVisible;
<a name="l01142"></a>01142       this._whenVisible = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l01143"></a>01143       fn();
<a name="l01144"></a>01144     }
<a name="l01145"></a>01145   },
<a name="l01146"></a>01146 
<a name="l01147"></a>01147   onClickMessage: <span class="keyword">function</span>(messageNode, <a class="code" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>) {
<a name="l01148"></a>01148     var <a class="code" href="../../d8/dbd/namespaceheader.html#aa5b53e6fddfb0e2e76fa4f5cf837317b">header</a> = messageNode.message;
<a name="l01149"></a>01149     <span class="keywordflow">if</span> (this.editMode) {
<a name="l01150"></a>01150       var idx = this.selectedMessages.indexOf(header);
<a name="l01151"></a>01151       var <a class="code" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a> = messageNode.querySelector(<span class="stringliteral">&#39;input[type=checkbox]&#39;</span>);
<a name="l01152"></a>01152       <span class="keywordflow">if</span> (idx !== -1) {
<a name="l01153"></a>01153         this.selectedMessages.splice(idx, 1);
<a name="l01154"></a>01154         cb.checked = <span class="keyword">false</span>;
<a name="l01155"></a>01155       }
<a name="l01156"></a>01156       <span class="keywordflow">else</span> {
<a name="l01157"></a>01157         this.selectedMessages.push(header);
<a name="l01158"></a>01158         cb.checked = <span class="keyword">true</span>;
<a name="l01159"></a>01159       }
<a name="l01160"></a>01160       this.selectedMessagesUpdated();
<a name="l01161"></a>01161       <span class="keywordflow">return</span>;
<a name="l01162"></a>01162     }
<a name="l01163"></a>01163 
<a name="l01164"></a>01164     <span class="keywordflow">if</span> (this.curFolder &amp;&amp; this.curFolder.type === <span class="stringliteral">&#39;localdrafts&#39;</span>) {
<a name="l01165"></a>01165       var composer = header.editAsDraft(<span class="keyword">function</span>() {
<a name="l01166"></a>01166         Cards.pushCard(<span class="stringliteral">&#39;compose&#39;</span>, <span class="stringliteral">&#39;default&#39;</span>, <span class="stringliteral">&#39;animate&#39;</span>,
<a name="l01167"></a>01167                        { composer: composer });
<a name="l01168"></a>01168       });
<a name="l01169"></a>01169       <span class="keywordflow">return</span>;
<a name="l01170"></a>01170     }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172     Cards.pushCard(
<a name="l01173"></a>01173       <span class="stringliteral">&#39;message_reader&#39;</span>, <span class="stringliteral">&#39;default&#39;</span>, <span class="stringliteral">&#39;animate&#39;</span>,
<a name="l01174"></a>01174       {
<a name="l01175"></a>01175         <span class="comment">// The header here may be undefined here, since the click</span>
<a name="l01176"></a>01176         <span class="comment">// could be on a cached HTML node before the back end has</span>
<a name="l01177"></a>01177         <span class="comment">// started up. It is OK if header is not available as the</span>
<a name="l01178"></a>01178         <span class="comment">// message_reader knows how to wait for the back end to</span>
<a name="l01179"></a>01179         <span class="comment">// start up to get the header value later.</span>
<a name="l01180"></a>01180         header: <a class="code" href="../../d8/dbd/namespaceheader.html#aa5b53e6fddfb0e2e76fa4f5cf837317b">header</a>,
<a name="l01181"></a>01181         <span class="comment">// Use the property on the HTML, since the click could be</span>
<a name="l01182"></a>01182         <span class="comment">// from a cached HTML node and the real data object may not</span>
<a name="l01183"></a>01183         <span class="comment">// be available yet.</span>
<a name="l01184"></a>01184         messageSuid: messageNode.dataset.id
<a name="l01185"></a>01185       });
<a name="l01186"></a>01186   },
<a name="l01187"></a>01187 
<a name="l01188"></a>01188   onHoldMessage: <span class="keyword">function</span>(messageNode, <a class="code" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>) {
<a name="l01189"></a>01189     <span class="keywordflow">if</span> (this.curFolder)
<a name="l01190"></a>01190       this.setEditMode(<span class="keyword">true</span>);
<a name="l01191"></a>01191   },
<a name="l01192"></a>01192 
<a name="l01193"></a>01193   onRefresh: <span class="keyword">function</span>() {
<a name="l01194"></a>01194     <span class="keywordflow">if</span> (!this.messagesSlice)
<a name="l01195"></a>01195       <span class="keywordflow">return</span>;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <span class="keywordflow">switch</span> (this.messagesSlice.status) {
<a name="l01198"></a>01198       <span class="comment">// If we&#39;re still synchronizing, then the user is not well served by</span>
<a name="l01199"></a>01199       <span class="comment">// queueing a refresh yet, let&#39;s just squash this.</span>
<a name="l01200"></a>01200       <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l01201"></a>01201       <span class="keywordflow">case</span> <span class="stringliteral">&#39;synchronizing&#39;</span>:
<a name="l01202"></a>01202         <span class="keywordflow">break</span>;
<a name="l01203"></a>01203       <span class="comment">// If we fully synchronized, then yes, let us refresh.</span>
<a name="l01204"></a>01204       <span class="keywordflow">case</span> <span class="stringliteral">&#39;synced&#39;</span>:
<a name="l01205"></a>01205         this.messagesSlice.refresh();
<a name="l01206"></a>01206         <span class="keywordflow">break</span>;
<a name="l01207"></a>01207       <span class="comment">// If we failed to talk to the server, then let&#39;s only do a refresh if we</span>
<a name="l01208"></a>01208       <span class="comment">// know about any messages.  Otherwise let&#39;s just create a new slice by</span>
<a name="l01209"></a>01209       <span class="comment">// forcing reentry into the folder.</span>
<a name="l01210"></a>01210       <span class="keywordflow">case</span> <span class="stringliteral">&#39;syncfailed&#39;</span>:
<a name="l01211"></a>01211         <span class="keywordflow">if</span> (this.messagesSlice.items.length)
<a name="l01212"></a>01212           this.messagesSlice.refresh();
<a name="l01213"></a>01213         <span class="keywordflow">else</span>
<a name="l01214"></a>01214           this.showFolder(this.curFolder, <span class="comment">/* force new slice */</span> <span class="keyword">true</span>);
<a name="l01215"></a>01215         <span class="keywordflow">break</span>;
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217   },
<a name="l01218"></a>01218 
<a name="l01219"></a>01219   onStarMessages: <span class="keyword">function</span>() {
<a name="l01220"></a>01220     var op = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.api.markMessagesStarred(this.selectedMessages,
<a name="l01221"></a>01221                                          this.setAsStarred);
<a name="l01222"></a>01222     this.setEditMode(<span class="keyword">false</span>);
<a name="l01223"></a>01223     Toaster.logMutation(op);
<a name="l01224"></a>01224   },
<a name="l01225"></a>01225 
<a name="l01226"></a>01226   onMarkMessagesRead: <span class="keyword">function</span>() {
<a name="l01227"></a>01227     var op = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.api.markMessagesRead(this.selectedMessages, this.setAsRead);
<a name="l01228"></a>01228     this.setEditMode(<span class="keyword">false</span>);
<a name="l01229"></a>01229     Toaster.logMutation(op);
<a name="l01230"></a>01230   },
<a name="l01231"></a>01231 
<a name="l01232"></a>01232   onDeleteMessages: <span class="keyword">function</span>() {
<a name="l01233"></a>01233     <span class="comment">// TODO: Batch delete back-end mail api is not ready for IMAP now.</span>
<a name="l01234"></a>01234     <span class="comment">//       Please verify this function under IMAP when api completed.</span>
<a name="l01235"></a>01235 
<a name="l01236"></a>01236     <span class="keywordflow">if</span> (this.selectedMessages.length === 0)
<a name="l01237"></a>01237       <span class="keywordflow">return</span>;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239     var <a class="code" href="../../d1/d04/app__install__manager_8js.html#a888e6068bf00699dfddf2b6ee25e6c7a">dialog</a> = deleteConfirmMsgNode.cloneNode(<span class="keyword">true</span>);
<a name="l01240"></a>01240     var <a class="code" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a4a1b5640b674da15d6f1b87899e53789">content</a> = dialog.getElementsByTagName(<span class="charliteral">&#39;p&#39;</span>)[0];
<a name="l01241"></a>01241     content.textContent = <a class="code" href="../../da/dce/details__test_8js.html#abf8c988c23b2b2f5ec3f1149b44bd820">mozL10n</a>.get(<span class="stringliteral">&#39;message-multiedit-delete-confirm&#39;</span>,
<a name="l01242"></a>01242                                       { <a class="code" href="../../d2/d7d/jsapi_8h.html#aa5a8b9a2d5edc8e2e7ba67d7e2ee4e69">n</a>: this.selectedMessages.length });
<a name="l01243"></a>01243     <a class="code" href="../../d3/d42/camera_2js_2confirm_8js.html#a62ff52c410e9de0d9973e5297755e83c">ConfirmDialog</a>.show(dialog,
<a name="l01244"></a>01244       { <span class="comment">// Confirm</span>
<a name="l01245"></a>01245         <span class="keywordtype">id</span>: <span class="stringliteral">&#39;msg-delete-ok&#39;</span>,
<a name="l01246"></a>01246         <a class="code" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">handler</a>: <span class="keyword">function</span>() {
<a name="l01247"></a>01247           var op = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.api.deleteMessages(this.selectedMessages);
<a name="l01248"></a>01248           Toaster.logMutation(op);
<a name="l01249"></a>01249           this.setEditMode(<span class="keyword">false</span>);
<a name="l01250"></a>01250         }.bind(<span class="keyword">this</span>)
<a name="l01251"></a>01251       },
<a name="l01252"></a>01252       { <span class="comment">// Cancel</span>
<a name="l01253"></a>01253         <span class="keywordtype">id</span>: <span class="stringliteral">&#39;msg-delete-cancel&#39;</span>,
<a name="l01254"></a>01254         <a class="code" href="../../de/deb/jsdbgapi_8h.html#a309e0bc04bd5e2de367147b08241aa6b">handler</a>: <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>
<a name="l01255"></a>01255       }
<a name="l01256"></a>01256     );
<a name="l01257"></a>01257   },
<a name="l01258"></a>01258 
<a name="l01259"></a>01259   onMoveMessages: <span class="keyword">function</span>() {
<a name="l01260"></a>01260     <span class="comment">// TODO: Batch move back-end mail api is not ready now.</span>
<a name="l01261"></a>01261     <span class="comment">//       Please verify this function when api landed.</span>
<a name="l01262"></a>01262     Cards.folderSelector(<span class="keyword">function</span>(folder) {
<a name="l01263"></a>01263       var op = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.api.moveMessages(this.selectedMessages, folder);
<a name="l01264"></a>01264       Toaster.logMutation(op);
<a name="l01265"></a>01265       this.setEditMode(<span class="keyword">false</span>);
<a name="l01266"></a>01266     }.bind(<span class="keyword">this</span>));
<a name="l01267"></a>01267   },
<a name="l01268"></a>01268 
<a name="l01269"></a>01269   _folderChanged: <span class="keyword">function</span>(folder) {
<a name="l01270"></a>01270     <span class="comment">// It is possible that the notification of latest folder is fired</span>
<a name="l01271"></a>01271     <span class="comment">// but in the meantime the foldersSlice could be cleared due to</span>
<a name="l01272"></a>01272     <span class="comment">// a change in the current account, before this listener is called.</span>
<a name="l01273"></a>01273     <span class="comment">// So skip this work if no foldersSlice, this method will be called</span>
<a name="l01274"></a>01274     <span class="comment">// again soon.</span>
<a name="l01275"></a>01275     <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.foldersSlice)
<a name="l01276"></a>01276       <span class="keywordflow">return</span>;
<a name="l01277"></a>01277 
<a name="l01278"></a>01278     <span class="comment">// Folder could have changed because account changed. Make sure</span>
<a name="l01279"></a>01279     <span class="comment">// the cacheableFolderId is still set correctly.</span>
<a name="l01280"></a>01280     var inboxFolder = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.foldersSlice.getFirstFolderWithType(<span class="stringliteral">&#39;inbox&#39;</span>);
<a name="l01281"></a>01281     this.cacheableFolderId = <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.account === <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.acctsSlice.defaultAccount ?
<a name="l01282"></a>01282                                                inboxFolder.id : <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l01283"></a>01283 
<a name="l01284"></a>01284     this.folder = folder;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286     <span class="keywordflow">if</span> (this.mode == <span class="stringliteral">&#39;nonsearch&#39;</span>) {
<a name="l01287"></a>01287       <span class="keywordflow">if</span> (this.showFolder(folder)) {
<a name="l01288"></a>01288         this._hideSearchBoxByScrolling();
<a name="l01289"></a>01289       }
<a name="l01290"></a>01290     } <span class="keywordflow">else</span> {
<a name="l01291"></a>01291       this.showSearch(folder, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;all&#39;</span>);
<a name="l01292"></a>01292     }
<a name="l01293"></a>01293   },
<a name="l01294"></a>01294 
<a name="l01295"></a>01295   <a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#a10a06623d857e96b7da92aac74d62d34">die</a>: <span class="keyword">function</span>() {
<a name="l01296"></a>01296     <span class="keywordflow">if</span> (this.messagesSlice) {
<a name="l01297"></a>01297       this.messagesSlice.die();
<a name="l01298"></a>01298       this.messagesSlice = <a class="code" href="../../d1/d04/app__install__manager_8js.html#a66d98f9009f0502b9a5ce70e907f8f27">null</a>;
<a name="l01299"></a>01299     }
<a name="l01300"></a>01300     <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.removeListener(<span class="stringliteral">&#39;folder&#39;</span>, this._boundFolderChanged);
<a name="l01301"></a>01301     <a class="code" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>.removeListener(<span class="stringliteral">&#39;newInboxMessages&#39;</span>, this._boundOnNewMail);
<a name="l01302"></a>01302   }
<a name="l01303"></a>01303 };
<a name="l01304"></a>01304 Cards.defineCard({
<a name="l01305"></a>01305   <a class="code" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>: <span class="stringliteral">&#39;message_list&#39;</span>,
<a name="l01306"></a>01306   <a class="code" href="../../df/d12/latin__test_8js.html#ad2cf4a40f77d475a65733c0477e3fba8">modes</a>: {
<a name="l01307"></a>01307     nonsearch: {
<a name="l01308"></a>01308       tray: <span class="keyword">false</span>
<a name="l01309"></a>01309     },
<a name="l01310"></a>01310     <a class="code" href="../../dc/d5e/apps_2email_2js_2ext_2mailapi_2imap_2probe_8js.html#a86efbc42dbdb988b9a864b83af26e0de">search</a>: {
<a name="l01311"></a>01311       tray: <span class="keyword">false</span>
<a name="l01312"></a>01312     }
<a name="l01313"></a>01313   },
<a name="l01314"></a>01314   <a class="code" href="../../d8/d14/_cloud_apps_8js.html#af72715521e98346fe28d30efb7887846">constructor</a>: MessageListCard,
<a name="l01315"></a>01315   templateNode: templateNode
<a name="l01316"></a>01316 });
<a name="l01317"></a>01317 
<a name="l01318"></a>01318 <span class="keywordflow">return</span> MessageListCard;
<a name="l01319"></a>01319 });
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../da/da6/message__list_8js.html">message_list.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:52:47に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
