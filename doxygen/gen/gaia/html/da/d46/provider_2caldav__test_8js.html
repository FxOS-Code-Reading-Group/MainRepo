<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>FxOS Code Reading: caldav_test.js</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">FxOS Code Reading
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- 作成： Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>メインページ</span></a></li>
      <li><a href="../../pages.html"><span>関連ページ</span></a></li>
      <li><a href="../../modules.html"><span>モジュール</span></a></li>
      <li><a href="../../namespaces.html"><span>パッケージ</span></a></li>
      <li><a href="../../annotated.html"><span>データ構造</span></a></li>
      <li class="current"><a href="../../files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>ファイル一覧</span></a></li>
      <li><a href="../../globals.html"><span>グローバル</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('da/d46/provider_2caldav__test_8js.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">関数</a>  </div>
  <div class="headertitle">
<div class="title">caldav_test.js</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="../../da/d46/provider_2caldav__test_8js_source.html">ソースコードを見る。</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
関数</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d46/provider_2caldav__test_8js.html#ac808867b6df981f6e429423b5e8d21ba">requireLib</a> ('ext/ical.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d46/provider_2caldav__test_8js.html#a4f8dc48a76b2d2112ea75f8ba1d5469e">requireApp</a> ('calendar/<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>/unit/service/helper.js')</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d46/provider_2caldav__test_8js.html#a2e85df1d3900a77fc66d6a6997ba08a8">suiteGroup</a> ('Provider.Caldav', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>;var <a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>;var controller;var <a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>;var accountStore;var calendarStore;var componentStore;var eventStore;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../df/d6d/prpdce_8h.html#a244bf4809fa769d3064852f1f46df24f">this.timeout</a>(10000);<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">app</a>=<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7b225fcb720e4d5ed2bbf60e28a25e6d">testSupport.calendar.app</a>();controller=app.serviceController;<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>=<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">app.db</a>;<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>=new Calendar.Provider.Caldav({app:app});calendarStore=app.store('<a class="el" href="../../da/deb/test_2marionette_2calendar_8js.html#a9e59614375174233310bf509a692b91a">Calendar</a>');accountStore=app.store('Account');componentStore=app.store('IcalComponent');eventStore=app.store('<a class="el" href="../../d8/dd1/test_2marionette_2event_8js.html#aded1d021a890cccaab7c7ebd7450f106">Event</a>');<a class="el" href="../../da/d84/openvideo_8js.html#a2a6896c38bfcbba014743ee706623b5d">db.open</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});testSupport.calendar.accountEnvironment(<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>,{_id: 'one', accountId: 'one', firstEventSyncDate:null, lastEventSyncToken:null});var account;var calendar;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){account=this.account;calendar=this.calendar;});var ical;suiteSetup(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../df/d6d/prpdce_8h.html#a244bf4809fa769d3064852f1f46df24f">this.timeout</a>(10000);ical=new ServiceSupport.Fixtures('ical');<a class="el" href="../../db/d6b/make__gaia__shared_8js.html#ac5aa547163f784b68be607a47eb170b1">ical.load</a>('daily_event');<a class="el" href="../../db/d6b/make__gaia__shared_8js.html#ac5aa547163f784b68be607a47eb170b1">ical.load</a>('recurring_event');ical.onready=<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>;});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){testSupport.calendar.clearStore(<a class="el" href="../../d1/d0b/browser__db_8js.html#a699c7194b69fa5470e5f97986af77ee1">db</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});teardown(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../dd/df0/dialogs__end__init_8js.html#acdb1449d11a5550a30ee4a18b9c7f133">db.close</a>();});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('initialization', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.instanceOf(<a class="el" href="../../d6/da8/facebook__connector__test_8js.html#ab17dfde70922e77b2bbcbd0192a12531">subject</a>, Calendar.Provider.Abstract);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(subject.service, app.serviceController);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('capabilites', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(subject.useUrl);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(subject.useCredentials);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#calendarCapabilities', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> testPrivilege(<a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>, privileges, expected){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>(<a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var calendar=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('calendar',{remote:{privilegeSet:privileges}});var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=subject.calendarCapabilities(calendar);<a class="el" href="../../d9/d08/assertions_8js.html#a8e00d9840873f843252e77018da707c3">assert.hasProperties</a>(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, expected);});}testPrivilege('missing privilegeSet', <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>,{canUpdateEvent:true, canDeleteEvent:true, canCreateEvent:true});testPrivilege('delete',['<a class="el" href="../../d3/d91/j3d_8js.html#a5f7fe5645bb93b36548a379a9726f9a2">unbind</a>'],{canDeleteEvent:true});testPrivilege('<a class="el" href="../../d1/dce/utils_81_83_8js.html#ab92647390e7481607cad94f9c4cf38f0">create</a>/<a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a>',['write-<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a4a1b5640b674da15d6f1b87899e53789">content</a>'],{canCreateEvent:true, canUpdateEvent:true});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#_handleServiceError', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var permErrors=[{input: '<a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a>-authentication', expect: 'Authentication'},{input: '<a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a>-invalid-entrypoint', expect: 'InvalidServer'}];<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> validatePermError(<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>){<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">error.input</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>;var givenErr;var expectedClass;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){expectedClass=<a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Calendar.Error</a>[error.expect];givenErr={<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">name:error.input</a>};<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=subject._handleServiceError(givenErr,{account:account});<a class="el" href="../../de/dfc/events_8js.html#a801b0668ecf79a79c81f75dbbabb4ebf">accountStore.once</a>('<a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../d9/d04/expat_8h.html#ac517f0c27408fbd365e7dd34e032faca">model</a>){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>===account._id){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();}});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('returned <a class="el" href="../../d9/d04/expat_8h.html#aebafa8f4412854cf6c37456c71ff5ee7">value</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.instanceOf(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, expectedClass);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('updated <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">account.error</a>, 'has <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">account.error.name</a>,(new expectedClass()).<a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>, '<a class="el" href="../../d8/dd4/ns_c_s_s_prop_list_8h.html#a2d75606ecb49f383eca31a7101127d95">marks</a> <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a> with <a class="el" href="../../d9/d04/expat_8h.html#a4a7cccd86625791f7f2ce3fb477aa9c1">name</a>');});});}<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">permErrors.forEach</a>(validatePermError);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('generic <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dfc/events_8js.html#a801b0668ecf79a79c81f75dbbabb4ebf">accountStore.once</a>('<a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){throw new <a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Error</a>('should not <a class="el" href="../../dd/d6d/mock__spinner_8js.html#ab10b009b0da48f61217a18daf8e20cd8">update</a> account store');});var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=subject._handleServiceError({name: '<a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a>-<a class="el" href="../../df/d25/fakeimap_8js.html#a207259f7e3cfd9800ed8f7d7224c7a68">server</a>-failure'},{account:account});assert.instanceOf(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, <a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Calendar.Error</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('new account', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var account=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('account');var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=subject._handleServiceError({name: '<a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a>-authentication'},{account:account});assert.instanceOf(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, <a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Calendar.Error</a>);});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#eventCapabilities', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('recurring', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:this.calendar._id, remote:{isRecurring:true}});var expected={canUpdate:false, canDelete:false, canCreate:false};var actual=subject.eventCapabilities(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, actual){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(actual, expected);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('without calendar permissions', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:this.calendar._id});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#a8e4d922ae3532f8bdfcadccef0881707">assert.isFalse</a>(event.remote.isRecurring);var expected={canUpdate:true, canCreate:true, canDelete:true};var actual=subject.eventCapabilities(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, actual){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(actual, expected);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('with calendar permissions', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.calendarCapabilities=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>{canCreateEvent:false, canDeleteEvent:true, canUpdateEvent:true};};var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:calendar._id});subject.eventCapabilities(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, caps){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(caps,{canCreate:false, canUpdate:true, canDelete:true});});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../d5/df8/pprio_8h.html#a67905f1db7d2b5941bf1fb80b55085f5">methods</a> that wrap <a class="el" href="../../df/d44/permission__manager_8js.html#ad9abb423164fcb98d6ad9333893e4682">request</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var calledWith;var <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>;var <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>;var <a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('account');});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> validateErrorHandling(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>, fields){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>={name: '<a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a>-authentication'};var pending=2;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> next(){--pending;<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(pending===0) <a class="el" href="../../d6/dec/mocha-bin_8js.html#a537e168ad693c5794e1977de944002a0">Calendar.nextTick</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);}accountStore.markWithError=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){};var realHandleServiceError=subject._handleServiceError;subject._handleServiceError=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(givenErr, detail){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(givenErr, <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>, 'sends <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>');<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">fields.forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(field){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(detail[field], 'detail.'+field);});next();<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> realHandleServiceError.apply(<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#af23f5f9187c304ed6a90a2c49a64fa48">this</a>, arguments);};<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(cbError){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(cbError, '<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a> recieves <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>');next();};}<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../df/d44/permission__manager_8js.html#ad9abb423164fcb98d6ad9333893e4682">controller.request</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calledWith=<a class="el" href="../../d1/d04/app__install__manager_8js.html#a7345f7c14b7ddbcc9efdc293d79bf303">Array.prototype.slice.call</a>(arguments);var <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>=arguments[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">arguments.length</a>-1];<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#adf7ce41cd256eda7ce1f6adeea723bd3">setTimeout</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>);}, 0);};});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#getAccount', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../db/df4/geoloc_8js.html#a15b4f92b0ef49ac05f43437f3d85ae46">success</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>={id: 'wow'};subject.getAccount(<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(cbResult, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(cbError, <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a> handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.getAccount(<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a>, validateErrorHandling(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>,['account']));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('offline handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var realOffline=app.offline;app.offline=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>};subject.getAccount(<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){app.offline=realOffline;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">cbError.name</a>, 'offline');});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#findCalendars', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.findCalendars(<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a>, validateErrorHandling(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>,['account']));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../db/df4/geoloc_8js.html#a15b4f92b0ef49ac05f43437f3d85ae46">success</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>={<a class="el" href="../../d2/de4/pdf_8js.html#a60466015cef6827275ce6b41f91e63a2">one:Factory.build</a>('caldav.calendar'), <a class="el" href="../../d2/de4/pdf_8js.html#a60466015cef6827275ce6b41f91e63a2">two:Factory.build</a>('caldav.calendar',{color:null})};<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;subject.findCalendars(<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(cbResult.one, result.one, 'does not <a class="el" href="../../d6/dec/mocha-bin_8js.html#a21876686982353783e59f222a45e6c6e">process</a> events with <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#ae28887b666238c40587d77cc5fb07500">color</a>');var withColor=<a class="el" href="../../d3/d52/blanket_8js.html#a3e70263fa1d00b23249fce45e65e5849">JSON.parse</a>(<a class="el" href="../../d1/d22/ical_8js.html#a8076921037776baf4e4838660048f802">JSON.stringify</a>(result.two));<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#ae28887b666238c40587d77cc5fb07500">withColor.color</a>=subject.defaultColor;assert.deepEqual(cbResult.two, withColor, 'adds <a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#ae28887b666238c40587d77cc5fb07500">color</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(cbError, <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('offline handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var realOffline=app.offline;app.offline=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>};subject.findCalendars(<a class="el" href="../../d2/d7d/jsapi_8h.html#a8908b6d42ac95ee6387e73b7ac543dae">input</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){app.offline=realOffline;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">cbError.name</a>, 'offline');});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#createEvent', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>;var <a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:calendar._id});<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=<a class="el" href="../../d1/dce/utils_81_83_8js.html#ab92647390e7481607cad94f9c4cf38f0">Factory.create</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>').remote;<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">result.id</a>= 'foo';result.syncToken= 'hit';result.icalComponent= 'xfoo';<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>=calendar._id+ '-foo';});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../db/df4/geoloc_8js.html#a15b4f92b0ef49ac05f43437f3d85ae46">success</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.createEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('icalComponent', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">componentStore.get</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>,{eventId:id, ical: 'xfoo'});});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">eventStore.get</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">id</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){var remote=result.remote;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a0ad0ebb641411c0c63079e4440033275">remote.id</a>, 'foo');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(remote.syncToken, 'hit');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!remote.icalComponent, 'does not have icalComponent');<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a> handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.createEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, validateErrorHandling(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>,['account', 'calendar']));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('offline handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var realOffline=app.offline;app.offline=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>};subject.createEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){app.offline=realOffline;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">cbError.name</a>, 'offline');});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#updateEvent', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>;var component;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var trans=eventStore.db.transaction(['events', 'icalComponents'], 'readwrite');trans.oncomplete=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:calendar._id});component=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('icalComponent',{eventId:event._id, ical: 'original'});eventStore.persist(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);componentStore.persist(component, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../db/df4/geoloc_8js.html#a15b4f92b0ef49ac05f43437f3d85ae46">success</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>=<a class="el" href="../../d1/dce/utils_81_83_8js.html#ab92647390e7481607cad94f9c4cf38f0">Factory.create</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>').remote;result.icalComponent= 'xfooo';result.syncToken= 'changedmefoo';subject.updateEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('sent <a class="el" href="../../d9/d04/expat_8h.html#aa11c5d56dba0976f16f07ea50b1999ba">data</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var details=calledWith[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">calledWith.length</a>-2];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../df/db4/_h_i_s_t_o_r_y_8md.html#a9bdb27563ba547d319ee562ba0f3bb98">details.event</a>, 'sends <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(details.icalComponent, 'original', 'icalComponent');});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('component', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">componentStore.get</a>(event._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, item){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(item,{eventId:event._id, ical: 'xfooo'});});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">eventStore.get</a>(event._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, item){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(item.remote.syncToken, result.syncToken);});});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a> handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.updateEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, validateErrorHandling(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>,['calendar', 'account']));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('offline handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var realOffline=app.offline;app.offline=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>};subject.updateEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){app.offline=realOffline;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">cbError.name</a>, 'offline');});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#deleteEvent', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:calendar._id});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('failure', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.deleteEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, validateErrorHandling(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>,['account', 'calendar']));});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../db/df4/geoloc_8js.html#a15b4f92b0ef49ac05f43437f3d85ae46">success</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.deleteEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(calledWith[0], '<a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(calledWith[1], 'deleteEvent');var <a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">slice</a>=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">calledWith.slice</a>(2, 5);<a class="el" href="../../d9/d08/assertions_8js.html#a8e00d9840873f843252e77018da707c3">assert.hasProperties</a>(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">slice</a>[0], account, 'sends account');<a class="el" href="../../d9/d08/assertions_8js.html#a8e00d9840873f843252e77018da707c3">assert.hasProperties</a>(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">slice</a>[1], calendar.remote, 'sends calendar');assert.deepEqual(<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">slice</a>[2], event.remote, 'sends <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>');});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('offline handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var realOffline=app.offline;var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:calendar._id});app.offline=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>};subject.deleteEvent(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){app.offline=realOffline;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">cbError.name</a>, 'offline');});});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#_cachedEventsFor', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var events=[];var calendar;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">events.length</a>=0;calendar=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('calendar');calendarStore.persist(calendar, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});var <a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>=0;<a class="el" href="../../dc/d9e/_playlist_drawer_8js.html#a089b2988a149c0d135aaab57e2231481">for</a>(;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>&lt; 2;<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>++){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:calendar._id, remote:{id:i, url: 'some_foo_'+<a class="el" href="../../da/d7d/sylvester_8js.html#a091f0effa2d52e9315e1f032073e953b">i</a>+ '.ics', syncToken:i}});<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">events.push</a>(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>);eventStore.persist(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});}<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var expected=<a class="el" href="../../d1/dce/utils_81_83_8js.html#ab92647390e7481607cad94f9c4cf38f0">Object.create</a>(<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>);<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">events.forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(item){expected[<a class="el" href="../../de/d8f/jsdebug_8h.html#a39bb9861b2cb39f94badb5db778de746">item.remote.url</a>]={syncToken:item.remote.syncToken, id:item._id};});subject._cachedEventsFor(calendar, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>, expected);});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#syncEvents', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var events=[];var calledWith;<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> addEvent(<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var <a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>=<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>();<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">events.push</a>(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>);eventStore.persist(<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});}<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calledWith=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">events.length</a>=0;subject._syncEvents=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calledWith=arguments;var <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>=calledWith[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">calledWith.length</a>-1];<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#adf7ce41cd256eda7ce1f6adeea723bd3">setTimeout</a>(<a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>, 0, <a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>);};var trans=db.transaction(['accounts', 'calendars'], 'readwrite');trans.oncomplete=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();};});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> with cached events', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){addEvent(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('<a class="el" href="../../df/dea/pkcs11t_8h.html#afaa077e4b9760c92cbaf0d838e743d8c">event</a>',{calendarId:calendar._id, remote:{url: 'one.ics', syncToken: 'one'}});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.syncEvents(account, calendar, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(calledWith[0], account, 'has account');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(calledWith[1], calendar, 'has calendar');var sentCache=calledWith[2];<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(sentCache, 'sends <a class="el" href="../../df/dc7/viewer_8js.html#a521016aa0ca9ff38bfba60ab069cb34b">cache</a>');<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(sentCache[events[0].<a class="el" href="../../de/d8f/jsdebug_8h.html#a39bb9861b2cb39f94badb5db778de746">remote.url</a>], 'sends <a class="el" href="../../de/d8f/jsdebug_8h.html#a39bb9861b2cb39f94badb5db778de746">url</a>');});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('offline handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var realOffline=app.offline;app.offline=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>};subject.syncEvents(account, calendar, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){app.offline=realOffline;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">cbError.name</a>, 'offline');});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> tokens <a class="el" href="../../d2/d7d/jsapi_8h.html#a99e36b20cb6cf83fe7c1f4bff6902ab6">match</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){calendar.lastEventSyncToken= '<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>';calendar.remote.syncToken= '<a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a>';});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var isAsync=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;subject.syncEvents(account, calendar, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!calledWith);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(isAsync, 'should be async');<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});isAsync=<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>;});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('offline handling', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var realOffline=app.offline;app.offline=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a930920b2bc42824a5c03be681830f4b2">true</a>};subject.syncEvents(account, calendar, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> <a class="el" href="../../d2/d7d/jsapi_8h.html#a9c0cec265243907d0da86b92bda26eca">cb</a>(cbError, cbResult){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){app.offline=realOffline;<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1956a27e1e0205d6704940d480413e03">cbError.name</a>, 'offline');});});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#_syncEvents', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var calledWith;var cached={};var <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>;<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">calendar.error</a>={};calendarStore.persist(calendar, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;subject.service.stream=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var <a class="el" href="../../d2/d7d/jsapi_8h.html#a52c9936fee3329d49b2cdede9b0fd7c8">args</a>=<a class="el" href="../../d4/d23/binary__string__view_8js.html#a611282d0b962f2d73c40c656cbe37aa5">Array.slice</a>(arguments);<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!args.shift()=== '<a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a>') throw new <a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Error</a>('expected <a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a> service');<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!args.shift()=== 'streamEvents') throw new <a class="el" href="../../dc/d06/calendar_2js_2error_8js.html#abd05c43175d3c93c6889542cefc822f3">Error</a>('expected streamEvents');calledWith=<a class="el" href="../../d2/d7d/jsapi_8h.html#a52c9936fee3329d49b2cdede9b0fd7c8">args</a>;var stream=new Calendar.Responder();<a class="el" href="../../df/d44/permission__manager_8js.html#ad9abb423164fcb98d6ad9333893e4682">stream.request</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>){<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#adf7ce41cd256eda7ce1f6adeea723bd3">setTimeout</a>(<a class="el" href="../../de/dc5/jsfriendapi_8h.html#ae9494ad8646a84b50bd3446d72433e82">callback</a>, 0, <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>);};<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> stream;};});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('with <a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">error</a>={name: '<a class="el" href="../../d9/d42/caldav__worker_8js.html#aef73e4c20c2dc733b2714c15b203256d">caldav</a>-authentication'};<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> oncomplete(cbErr){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.instanceOf(cbErr, Calendar.Error.Authentication);assert.deepEqual(cbErr.detail,{account:account, calendar:calendar});});}subject._syncEvents(account, calendar, cached, oncomplete);});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('with <a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a> syncDate', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var expectedSyncDate=new Date(2012, 0, 1);<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){calendar.firstEventSyncDate=expectedSyncDate;calendarStore.persist(calendar, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var expectedDate=new Date(expectedSyncDate.valueOf());expectedDate.setDate(expectedDate.getDate()-subject.daysToSyncInPast);var <a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>={startDate:expectedDate, cached:cached};<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">calendar.error</a>={};var pull=subject._syncEvents(account, calendar, cached, oncomplete);<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> oncomplete(){var expected=[account.toJSON(), calendar.remote, <a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>];assert.deepEqual(calledWith, expected);assert.instanceOf(pull, Calendar.Provider.CaldavPullEvents);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(pull.account, account);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(pull.calendar, calendar);<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">calendarStore.get</a>(calendar._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(!<a class="el" href="../../db/df4/geoloc_8js.html#ac3dbd5af3a73f4aa69249dd1c6b9c980">result.error</a>, 'clears errors');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(result.lastEventSyncToken, result.remote.syncToken, 'updates <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> token');assert.deepEqual(result.firstEventSyncDate, expectedSyncDate, '<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a> <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a> is never modified');});});}});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('without <a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a> <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var syncDate=Calendar.Calc.createDay(new Date());var expectedSyncDate=new Date(syncDate.valueOf());syncDate.setDate(syncDate.getDate()-subject.daysToSyncInPast);calendar.firstEventSyncDate=<a class="el" href="../../d3/d52/blanket_8js.html#a24d794dfc756320ffadb905d526299bc">null</a>;var <a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>={startDate:syncDate, cached:cached};subject._syncEvents(account, calendar, cached, oncomplete);<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> oncomplete(){var expected=[account.toJSON(), calendar.remote, <a class="el" href="../../dc/df3/plgetopt_8h.html#af88bfb344db31578251e79bdf8cbf4bc">options</a>];assert.deepEqual(calledWith, expected);<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#a18697261a961b9d0efde405b5a2b244f">calendarStore.get</a>(calendar._id, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, record){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){assert.deepEqual(record.firstEventSyncDate, expectedSyncDate, 'updates <a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a> <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#adc6ce99d08573e59428ba38ac0a50479">assert.equal</a>(record.lastEventSyncToken, record.remote.syncToken, 'updates <a class="el" href="../../db/d6d/mkdirp_8js.html#a303bde7c6fd15c62884d1439cdf55b10">sync</a> token');});});}});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('#ensureRecurrencesExpanded', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var maxDate=new Date(2013, 2, 17);<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('with no icalComponent records', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.ensureRecurrencesExpanded(maxDate, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, didExpand){<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#a8e4d922ae3532f8bdfcadccef0881707">assert.isFalse</a>(didExpand);});});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('with lastRecurrenceId after maxDate', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){var comp=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('icalComponent',{ical: '', eventId:22, lastRecurrenceId:new Date(2013, 2, 18)});componentStore.persist(comp, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(err) <a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(err);subject.ensureRecurrencesExpanded(maxDate, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, didExpand){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(err) <a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a> <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(err);<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#a8e4d922ae3532f8bdfcadccef0881707">assert.isFalse</a>(didExpand, 'expanded');});});});});<a class="el" href="../../d8/d0f/startup__events__test_8js.html#adac6c636af235a329cc774937d75601b">suite</a>('with simulated pre-expansion component', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){<a class="el" href="../../d5/dff/tests_2python_2gaia-ui-tests_2gaiatest_2atoms_2screenshot_8js.html#a6bc243e0e988691de46b9baa46ec6413">return</a>;var comp;var didExpand;var eventId;var givenLastRecur=new Date(2012, 10, 1);<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(){var jCal=<a class="el" href="../../d3/d52/blanket_8js.html#a3e70263fa1d00b23249fce45e65e5849">ICAL.parse</a>(ical.recurringEvent);var vcal=new <a class="el" href="../../d1/d22/ical_8js.html#a48960e8605148e94f4c8a386716cf485">ICAL.Component</a>(jCal[1]);var vevent=vcal.getFirstSubcomponent('vevent');eventId=calendar._id+ '-'+vevent.getFirstPropertyValue('uid');});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){didExpand=<a class="el" href="../../d7/dd2/qcmstypes_8h.html#a65e9886d74aaee76545e83dd09011727">false</a>;comp=<a class="el" href="../../d4/d6d/factory_8js.html#a95acddcf8d59f67c9a249c3266057e91">Factory</a>('icalComponent',{calendarId:calendar._id, eventId:eventId, ical:ical.recurringEvent, iterator:{}, lastRecurrenceId:Calendar.Calc.dateToTransport(givenLastRecur)});componentStore.persist(comp, <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>);<a class="el" href="../../d6/d1b/pprthred_8h.html#a0798cf327c99b856b5ecf03e5f4deb4d">app.serviceController.start</a>();});<a class="el" href="../../da/db6/ime__test_8js.html#a499aeb7e1826da3a383e443025bfc846">setup</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){subject.ensureRecurrencesExpanded(maxDate, <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(err, <a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>){didExpand=<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">result</a>;<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>();});});<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>('after expansion', <a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>){<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(didExpand, 'has expanded');var stores=['icalComponents', 'busytimes'];var trans=db.transaction(stores);var pending=0;var <a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>={};<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> next(){<a class="el" href="../../de/dfc/events_8js.html#aa27c1f7f883859f374ef91e69db597bd">if</a>(!(--pending)) <a class="el" href="../../de/dc7/share-receiver_8js.html#af9c6eaaef1f3af067f5ea1aff90ff861">done</a>(complete);}<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">stores.forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(store){pending++;var <a class="el" href="../../dd/d22/jsproxy_8h.html#a09fc6711374caa1db30372f814d0aa1b">obj</a>=<a class="el" href="../../d2/d02/fl_2js_2db_8js.html#acd333cd9c17134d907f3a57610b7c1ae">trans.objectStore</a>(store);obj.mozGetAll().<a class="el" href="../../df/d49/system_2camera_2js_2camera_8js.html#a845d7a743d9d72d08f80a15338dd1099">onsuccess</a>=<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d1/d03/locales_2_r_e_a_d_m_e_8md.html#abfc48c566ed05b3908825f01ea7462a4">e</a>){<a class="el" href="../../de/d4d/ns_i_d_o_m_speech_recognition_event_8idl.html#a004e752a63561c4c9bfd98d2be668a5d">results</a>[store]=<a class="el" href="../../d8/d64/ns_u_r_l_helper_8h.html#ad4dc7d3fd716004895ed4c669af1c61c">e.target.result</a>;next();};});<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a> complete(){<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">assert.length</a>(results.icalComponents, 1);<a class="el" href="../../da/ded/ds-test_8js.html#a96c639e17949eb5b6031072207d80575">assert.ok</a>(<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">results.busytimes.length</a>, 1);var comp=results.icalComponents[0];var lastRecur=Calendar.Calc.dateFromTransport(comp.lastRecurrenceId);var dates=[];<a class="el" href="../../d4/d00/tools_2xpcwindow_2lib_2modules_2debug_8js.html#aae3803cf3819ae1182550b783e1ea692">results.busytimes.forEach</a>(<a class="el" href="../../d9/dc4/pralarm_8h.html#a7b570f1c425a05af1046d4e6f37d5a0f">function</a>(<a class="el" href="../../d6/da5/certt_8h.html#a5e84b1bdd0770310d2a7fd739ab6dbee">time</a>){<a class="el" href="../../d5/da4/preferences_8js.html#a04cdfd02512383b1feea0e6fa7f5d3a3">dates.push</a>(time.startDate);});dates=dates.sort();<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(dates[0].valueOf() &gt; givenLastRecur.valueOf(), '<a class="el" href="../../d3/da1/shared_2resources_2apn_2_r_e_a_d_m_e_8md.html#aab9764d7f9e519400127ef5189844ed3">first</a> occurrence is after last given');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(dates[<a class="el" href="../../de/d81/xpt__struct_8h.html#a1892eba2086d12ac2b09005aeb09ea3b">dates.length</a>-1].valueOf()&lt; maxDate.valueOf(), 'last occurrence is before <a class="el" href="../../db/d13/ns_i_d_o_m_device_proximity_event_8idl.html#a0b0ede69e8156eb97acc579b88e883de">max</a> <a class="el" href="../../d3/d4b/lockscreen_8js.html#a94ea84d1e418dad15ea65e006b293fdd">date</a>');<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ac3f85391e7b9d85d3879b84b90623375">assert.isTrue</a>(lastRecur.valueOf() &gt; givenLastRecur.valueOf(), 'should expand beyond the given lastRecurId');}});});});})</td></tr>
</table>
<hr/><h2>関数</h2>
<a class="anchor" id="a4f8dc48a76b2d2112ea75f8ba1d5469e"></a><!-- doxytag: member="provider/caldav_test.js::requireApp" ref="a4f8dc48a76b2d2112ea75f8ba1d5469e" args="('calendar/test/unit/service/helper.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/d16/shared_2test_2unit_2mocks_2mock__settings__listener_8js.html#ada5f8f0f77028802cd46c92cb1ce8fce">requireApp</a> </td>
          <td>(</td>
          <td class="paramtype">'calendar/<a class="el" href="../../d2/dc5/homescreen__launcher__test_8js.html#ae39af8ac48077b957ecb9fe16f678936">test</a>/unit/service/helper.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac808867b6df981f6e429423b5e8d21ba"></a><!-- doxytag: member="provider/caldav_test.js::requireLib" ref="ac808867b6df981f6e429423b5e8d21ba" args="('ext/ical.js')" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/d0e/manager__test_8js.html#a160383846e1e348b6643e19d5c153d05">requireLib</a> </td>
          <td>(</td>
          <td class="paramtype">'ext/ical.js'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a2e85df1d3900a77fc66d6a6997ba08a8"></a><!-- doxytag: member="provider/caldav_test.js::suiteGroup" ref="a2e85df1d3900a77fc66d6a6997ba08a8" args="('Provider.Caldav', function(){var subject;var app;var controller;var db;var accountStore;var calendarStore;var componentStore;var eventStore;setup(function(done){this.timeout(10000);app=testSupport.calendar.app();controller=app.serviceController;db=app.db;subject=new Calendar.Provider.Caldav({app:app});calendarStore=app.store('Calendar');accountStore=app.store('Account');componentStore=app.store('IcalComponent');eventStore=app.store('Event');db.open(done);});testSupport.calendar.accountEnvironment(null,{_id: 'one', accountId: 'one', firstEventSyncDate:null, lastEventSyncToken:null});var account;var calendar;setup(function(){account=this.account;calendar=this.calendar;});var ical;suiteSetup(function(done){this.timeout(10000);ical=new ServiceSupport.Fixtures('ical');ical.load('daily_event');ical.load('recurring_event');ical.onready=done;});teardown(function(done){testSupport.calendar.clearStore(db, done);});teardown(function(){db.close();});test('initialization', function(){assert.instanceOf(subject, Calendar.Provider.Abstract);assert.equal(subject.service, app.serviceController);});test('capabilites', function(){assert.isTrue(subject.useUrl);assert.isTrue(subject.useCredentials);});suite('#calendarCapabilities', function(){function testPrivilege(name, privileges, expected){test(name, function(){var calendar=Factory('calendar',{remote:{privilegeSet:privileges}});var result=subject.calendarCapabilities(calendar);assert.hasProperties(result, expected);});}testPrivilege('missing privilegeSet', null,{canUpdateEvent:true, canDeleteEvent:true, canCreateEvent:true});testPrivilege('delete',['unbind'],{canDeleteEvent:true});testPrivilege('create/update',['write&#45;content'],{canCreateEvent:true, canUpdateEvent:true});});suite('#_handleServiceError', function(){var permErrors=[{input: 'caldav&#45;authentication', expect: 'Authentication'},{input: 'caldav&#45;invalid&#45;entrypoint', expect: 'InvalidServer'}];function validatePermError(error){suite(error.input, function(){var result;var givenErr;var expectedClass;setup(function(done){expectedClass=Calendar.Error[error.expect];givenErr={name:error.input};result=subject._handleServiceError(givenErr,{account:account});accountStore.once('update', function(id, model){if(id===account._id){done();}});});test('returned value', function(){assert.instanceOf(result, expectedClass);});test('updated error', function(){assert.ok(account.error, 'has error');assert.equal(account.error.name,(new expectedClass()).name, 'marks error with name');});});}permErrors.forEach(validatePermError);test('generic error', function(){accountStore.once('update', function(){throw new Error('should not update account store');});var result=subject._handleServiceError({name: 'caldav&#45;server&#45;failure'},{account:account});assert.instanceOf(result, Calendar.Error);});test('new account', function(){var account=Factory('account');var result=subject._handleServiceError({name: 'caldav&#45;authentication'},{account:account});assert.instanceOf(result, Calendar.Error);});});suite('#eventCapabilities', function(){test('recurring', function(done){var event=Factory('event',{calendarId:this.calendar._id, remote:{isRecurring:true}});var expected={canUpdate:false, canDelete:false, canCreate:false};var actual=subject.eventCapabilities(event, function(err, actual){done(function(){assert.deepEqual(actual, expected);});});});test('without calendar permissions', function(done){var event=Factory('event',{calendarId:this.calendar._id});assert.isFalse(event.remote.isRecurring);var expected={canUpdate:true, canCreate:true, canDelete:true};var actual=subject.eventCapabilities(event, function(err, actual){done(function(){assert.deepEqual(actual, expected);});});});test('with calendar permissions', function(done){subject.calendarCapabilities=function(){return{canCreateEvent:false, canDeleteEvent:true, canUpdateEvent:true};};var event=Factory('event',{calendarId:calendar._id});subject.eventCapabilities(event, function(err, caps){done(function(){assert.deepEqual(caps,{canCreate:false, canUpdate:true, canDelete:true});});});});});suite('methods that wrap request', function(){var calledWith;var error;var result;var input;setup(function(){input=Factory('account');});function validateErrorHandling(done, fields){error={name: 'caldav&#45;authentication'};var pending=2;function next(){&#45;&#45;pending;if(pending===0) Calendar.nextTick(done);}accountStore.markWithError=function(){};var realHandleServiceError=subject._handleServiceError;subject._handleServiceError=function(givenErr, detail){assert.equal(givenErr, error, 'sends error');fields.forEach(function(field){assert.ok(detail[field], 'detail.'+field);});next();return realHandleServiceError.apply(this, arguments);};return function(cbError){assert.ok(cbError, 'callback recieves error');next();};}setup(function(){controller.request=function(){calledWith=Array.prototype.slice.call(arguments);var cb=arguments[arguments.length&#45;1];setTimeout(function(){cb(error, result);}, 0);};});suite('#getAccount', function(){test('success', function(done){result={id: 'wow'};subject.getAccount(input, function cb(cbError, cbResult){done(function(){assert.equal(cbResult, result);assert.equal(cbError, error);});});});test('error handling', function(done){subject.getAccount(input, validateErrorHandling(done,['account']));});test('offline handling', function(done){var realOffline=app.offline;app.offline=function(){return true};subject.getAccount(input, function cb(cbError, cbResult){done(function(){app.offline=realOffline;assert.equal(cbError.name, 'offline');});});});});suite('#findCalendars', function(){test('error', function(done){subject.findCalendars(input, validateErrorHandling(done,['account']));});test('success', function(done){result={one:Factory.build('caldav.calendar'), two:Factory.build('caldav.calendar',{color:null})};error=null;subject.findCalendars(input, function cb(cbError, cbResult){done(function(){assert.equal(cbResult.one, result.one, 'does not process events with color');var withColor=JSON.parse(JSON.stringify(result.two));withColor.color=subject.defaultColor;assert.deepEqual(cbResult.two, withColor, 'adds color');assert.equal(cbError, error);});});});test('offline handling', function(done){var realOffline=app.offline;app.offline=function(){return true};subject.findCalendars(input, function cb(cbError, cbResult){done(function(){app.offline=realOffline;assert.equal(cbError.name, 'offline');});});});});suite('#createEvent', function(){var event;var id;setup(function(){error=null;event=Factory('event',{calendarId:calendar._id});result=Factory.create('event').remote;result.id= 'foo';result.syncToken= 'hit';result.icalComponent= 'xfoo';id=calendar._id+ '&#45;foo';});suite('success', function(){setup(function(done){subject.createEvent(event, done);});test('icalComponent', function(done){componentStore.get(id, function(err, result){done(function(){assert.deepEqual(result,{eventId:id, ical: 'xfoo'});});});});test('event', function(done){eventStore.get(id, function(err, result){var remote=result.remote;assert.equal(remote.id, 'foo');assert.equal(remote.syncToken, 'hit');assert.ok(!remote.icalComponent, 'does not have icalComponent');done();});});});test('error handling', function(done){subject.createEvent(event, validateErrorHandling(done,['account', 'calendar']));});test('offline handling', function(done){var realOffline=app.offline;app.offline=function(){return true};subject.createEvent(event, function cb(cbError, cbResult){done(function(){app.offline=realOffline;assert.equal(cbError.name, 'offline');});});});});suite('#updateEvent', function(){var event;var component;setup(function(done){var trans=eventStore.db.transaction(['events', 'icalComponents'], 'readwrite');trans.oncomplete=function(){done();};event=Factory('event',{calendarId:calendar._id});component=Factory('icalComponent',{eventId:event._id, ical: 'original'});eventStore.persist(event, done);componentStore.persist(component, done);});suite('success', function(){setup(function(done){error=null;result=Factory.create('event').remote;result.icalComponent= 'xfooo';result.syncToken= 'changedmefoo';subject.updateEvent(event, done);});test('sent data', function(){var details=calledWith[calledWith.length&#45;2];assert.ok(details.event, 'sends event');assert.equal(details.icalComponent, 'original', 'icalComponent');});test('component', function(done){componentStore.get(event._id, function(err, item){done(function(){assert.deepEqual(item,{eventId:event._id, ical: 'xfooo'});});});});test('event', function(done){eventStore.get(event._id, function(err, item){done(function(){assert.equal(item.remote.syncToken, result.syncToken);});});});});test('error handling', function(done){subject.updateEvent(event, validateErrorHandling(done,['calendar', 'account']));});test('offline handling', function(done){var realOffline=app.offline;app.offline=function(){return true};subject.updateEvent(event, function cb(cbError, cbResult){done(function(){app.offline=realOffline;assert.equal(cbError.name, 'offline');});});});});suite('#deleteEvent', function(){var event;setup(function(){event=Factory('event',{calendarId:calendar._id});});test('failure', function(done){subject.deleteEvent(event, validateErrorHandling(done,['account', 'calendar']));});test('success', function(done){subject.deleteEvent(event, function(){done(function(){assert.equal(calledWith[0], 'caldav');assert.equal(calledWith[1], 'deleteEvent');var slice=calledWith.slice(2, 5);assert.hasProperties(slice[0], account, 'sends account');assert.hasProperties(slice[1], calendar.remote, 'sends calendar');assert.deepEqual(slice[2], event.remote, 'sends event');});});});test('offline handling', function(done){var realOffline=app.offline;var event=Factory('event',{calendarId:calendar._id});app.offline=function(){return true};subject.deleteEvent(event, function cb(cbError, cbResult){done(function(){app.offline=realOffline;assert.equal(cbError.name, 'offline');});});});});});suite('#_cachedEventsFor', function(){var events=[];var calendar;setup(function(done){events.length=0;calendar=Factory('calendar');calendarStore.persist(calendar, done);});var i=0;for(;i&lt; 2;i++){setup(function(done){var event=Factory('event',{calendarId:calendar._id, remote:{id:i, url: 'some_foo_'+i+ '.ics', syncToken:i}});events.push(event);eventStore.persist(event, done);});}test('result', function(done){var expected=Object.create(null);events.forEach(function(item){expected[item.remote.url]={syncToken:item.remote.syncToken, id:item._id};});subject._cachedEventsFor(calendar, function(err, result){done(function(){assert.deepEqual(result, expected);});});});});suite('#syncEvents', function(){var events=[];var calledWith;function addEvent(cb){setup(function(done){var event=cb();events.push(event);eventStore.persist(event, done);});}setup(function(done){calledWith=null;events.length=0;subject._syncEvents=function(){calledWith=arguments;var cb=calledWith[calledWith.length&#45;1];setTimeout(cb, 0, null);};var trans=db.transaction(['accounts', 'calendars'], 'readwrite');trans.oncomplete=function(){done();};});suite('sync with cached events', function(){addEvent(function(){return Factory('event',{calendarId:calendar._id, remote:{url: 'one.ics', syncToken: 'one'}});});test('result', function(done){subject.syncEvents(account, calendar, function(){done(function(){assert.equal(calledWith[0], account, 'has account');assert.equal(calledWith[1], calendar, 'has calendar');var sentCache=calledWith[2];assert.ok(sentCache, 'sends cache');assert.ok(sentCache[events[0].remote.url], 'sends url');});});});test('offline handling', function(done){var realOffline=app.offline;app.offline=function(){return true};subject.syncEvents(account, calendar, function cb(cbError, cbResult){done(function(){app.offline=realOffline;assert.equal(cbError.name, 'offline');});});});});suite('sync tokens match', function(){setup(function(){calendar.lastEventSyncToken= 'sync';calendar.remote.syncToken= 'sync';});test('result', function(done){var isAsync=false;subject.syncEvents(account, calendar, function(){assert.ok(!calledWith);assert.ok(isAsync, 'should be async');done();});isAsync=true;});test('offline handling', function(done){var realOffline=app.offline;app.offline=function(){return true};subject.syncEvents(account, calendar, function cb(cbError, cbResult){done(function(){app.offline=realOffline;assert.equal(cbError.name, 'offline');});});});});});suite('#_syncEvents', function(){var calledWith;var cached={};var error;setup(function(done){calendar.error={};calendarStore.persist(calendar, done);});setup(function(){error=null;subject.service.stream=function(){var args=Array.slice(arguments);if(!args.shift()=== 'caldav') throw new Error('expected caldav service');if(!args.shift()=== 'streamEvents') throw new Error('expected streamEvents');calledWith=args;var stream=new Calendar.Responder();stream.request=function(callback){setTimeout(callback, 0, error);};return stream;};});test('with error', function(done){error={name: 'caldav&#45;authentication'};function oncomplete(cbErr){done(function(){assert.instanceOf(cbErr, Calendar.Error.Authentication);assert.deepEqual(cbErr.detail,{account:account, calendar:calendar});});}subject._syncEvents(account, calendar, cached, oncomplete);});suite('with first syncDate', function(){var expectedSyncDate=new Date(2012, 0, 1);setup(function(done){calendar.firstEventSyncDate=expectedSyncDate;calendarStore.persist(calendar, done);});test('result', function(done){var expectedDate=new Date(expectedSyncDate.valueOf());expectedDate.setDate(expectedDate.getDate()&#45;subject.daysToSyncInPast);var options={startDate:expectedDate, cached:cached};calendar.error={};var pull=subject._syncEvents(account, calendar, cached, oncomplete);function oncomplete(){var expected=[account.toJSON(), calendar.remote, options];assert.deepEqual(calledWith, expected);assert.instanceOf(pull, Calendar.Provider.CaldavPullEvents);assert.equal(pull.account, account);assert.equal(pull.calendar, calendar);calendarStore.get(calendar._id, function(err, result){done(function(){assert.ok(!result.error, 'clears errors');assert.equal(result.lastEventSyncToken, result.remote.syncToken, 'updates sync token');assert.deepEqual(result.firstEventSyncDate, expectedSyncDate, 'first sync date is never modified');});});}});});test('without first sync date', function(done){var syncDate=Calendar.Calc.createDay(new Date());var expectedSyncDate=new Date(syncDate.valueOf());syncDate.setDate(syncDate.getDate()&#45;subject.daysToSyncInPast);calendar.firstEventSyncDate=null;var options={startDate:syncDate, cached:cached};subject._syncEvents(account, calendar, cached, oncomplete);function oncomplete(){var expected=[account.toJSON(), calendar.remote, options];assert.deepEqual(calledWith, expected);calendarStore.get(calendar._id, function(err, record){done(function(){assert.deepEqual(record.firstEventSyncDate, expectedSyncDate, 'updates first sync date');assert.equal(record.lastEventSyncToken, record.remote.syncToken, 'updates sync token');});});}});});suite('#ensureRecurrencesExpanded', function(){var maxDate=new Date(2013, 2, 17);test('with no icalComponent records', function(done){subject.ensureRecurrencesExpanded(maxDate, function(err, didExpand){done(function(){assert.isFalse(didExpand);});});});test('with lastRecurrenceId after maxDate', function(done){var comp=Factory('icalComponent',{ical: '', eventId:22, lastRecurrenceId:new Date(2013, 2, 18)});componentStore.persist(comp, function(err){if(err) return done(err);subject.ensureRecurrencesExpanded(maxDate, function(err, didExpand){if(err) return done(err);done(function(){assert.isFalse(didExpand, 'expanded');});});});});suite('with simulated pre&#45;expansion component', function(){return;var comp;var didExpand;var eventId;var givenLastRecur=new Date(2012, 10, 1);setup(function(){var jCal=ICAL.parse(ical.recurringEvent);var vcal=new ICAL.Component(jCal[1]);var vevent=vcal.getFirstSubcomponent('vevent');eventId=calendar._id+ '&#45;'+vevent.getFirstPropertyValue('uid');});setup(function(done){didExpand=false;comp=Factory('icalComponent',{calendarId:calendar._id, eventId:eventId, ical:ical.recurringEvent, iterator:{}, lastRecurrenceId:Calendar.Calc.dateToTransport(givenLastRecur)});componentStore.persist(comp, done);app.serviceController.start();});setup(function(done){subject.ensureRecurrencesExpanded(maxDate, function(err, result){didExpand=result;done();});});test('after expansion', function(done){assert.isTrue(didExpand, 'has expanded');var stores=['icalComponents', 'busytimes'];var trans=db.transaction(stores);var pending=0;var results={};function next(){if(!(&#45;&#45;pending)) done(complete);}stores.forEach(function(store){pending++;var obj=trans.objectStore(store);obj.mozGetAll().onsuccess=function(e){results[store]=e.target.result;next();};});function complete(){assert.length(results.icalComponents, 1);assert.ok(results.busytimes.length, 1);var comp=results.icalComponents[0];var lastRecur=Calendar.Calc.dateFromTransport(comp.lastRecurrenceId);var dates=[];results.busytimes.forEach(function(time){dates.push(time.startDate);});dates=dates.sort();assert.isTrue(dates[0].valueOf() &gt; givenLastRecur.valueOf(), 'first occurrence is after last given');assert.isTrue(dates[dates.length&#45;1].valueOf()&lt; maxDate.valueOf(), 'last occurrence is before max date');assert.isTrue(lastRecur.valueOf() &gt; givenLastRecur.valueOf(), 'should expand beyond the given lastRecurId');}});});});})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d5e/views_2week__test_8js.html#ac63109f8f0c5b5ff6964f5d42af22de9">suiteGroup</a> </td>
          <td>(</td>
          <td class="paramtype">'Provider.Caldav'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全て</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>データ構造</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>ネームスペース</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>ファイル</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>関数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>変数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>型定義</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>列挙型</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>列挙型の値</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>フレンド</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>マクロ定義</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../da/d46/provider_2caldav__test_8js.html">caldav_test.js</a>      </li>

    <li class="footer">FxOS Code Readingに対してSat Oct 19 2013 00:55:48に生成されました。
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
